(self.webpackChunkActilogic=self.webpackChunkActilogic||[]).push([[179],{89:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(494),xe=Xe(703),h="\n  ",U={};function Y(Ne){var Q=Array.isArray(Ne);return function(J){var ne=re(U.plainArray,J);if(ne)return ne;if(Q&&J.length!==Ne.length)return"an array with "+Ne.length+" items";for(var Me=0;Me<J.length;Me++)if(ne=re(Q?Ne[Me]:Ne,J[Me]))return[Me].concat(ne)}}function re(Ne,Q){if(null!=Q||Ne.hasOwnProperty("__required")){var we=Ne(Q);if(we)return Array.isArray(we)?we:[we]}}function $(Ne,Q){var we=Ne.length,Ae=Ne[we-1],J=Ne.slice(0,we-1);return 0===J.length&&(J=["value"]),Q=xe(Q,{path:J}),"function"==typeof Ae?Ae(Q):ce(Q,function W(Ne){return"must be "+function me(Ne){return/^an? /.test(Ne)?Ne:/^[aeiou]/i.test(Ne)?"an "+Ne:/^[a-z]/i.test(Ne)?"a "+Ne:Ne}(Ne)+"."}(Ae))}function K(Ne){return Ne.length<2?Ne[0]:2===Ne.length?Ne.join(" or "):Ne.slice(0,-1).join(", ")+", or "+Ne.slice(-1)}function ce(Ne,Q){return(ue(Ne.path)?"Item at position ":"")+Ne.path.join(".")+" "+Q}function ue(Ne){return"number"==typeof Ne[Ne.length-1]||"number"==typeof Ne[0]}U.assert=function(Ne,Q){return Q=Q||{},function(we){var Ae=re(Ne,we);if(Ae){var J=$(Ae,Q);throw Q.apiName&&(J=Q.apiName+": "+J),new Error(J)}}},U.shape=function(Q){var we=function Te(Ne){return Object.keys(Ne||{}).map(function(Q){return{key:Q,value:Ne[Q]}})}(Q);return function(J){var ne=re(U.plainObject,J);if(ne)return ne;for(var Me,He=[],rt=0;rt<we.length;rt++)(ne=re(we[rt].value,J[Me=we[rt].key]))&&He.push([Me].concat(ne));return He.length<2?He[0]:function(mt){He=He.map(function(Et){return"- "+Et[0]+": "+$(Et,mt).split("\n").join(h)});var Pt=mt.path.join(".");return"The following properties"+("value"===Pt?"":" of "+Pt)+" have invalid values:"+h+He.join(h)}}},U.strictShape=function(Q){var we=U.shape(Q);return function(J){var ne=we(J);if(ne)return ne;var Me=Object.keys(J).reduce(function(Be,He){return void 0===Q[He]&&Be.push(He),Be},[]);return 0!==Me.length?function(){return"The following keys are invalid: "+Me.join(", ")}:void 0}},U.arrayOf=function(Q){return Y(Q)},U.tuple=function(){var Q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Y(Q)},U.required=function(Q){function we(Ae){return null==Ae?function(J){return ce(J,ue(J.path)?"cannot be undefined/null.":"is required.")}:Q.apply(this,arguments)}return we.__required=!0,we},U.oneOfType=function(){var Q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(Ae){var J=Q.map(function(ne){return re(ne,Ae)}).filter(Boolean);if(J.length===Q.length)return J.every(function(ne){return 1===ne.length&&"string"==typeof ne[0]})?K(J.map(function(ne){return ne[0]})):J.reduce(function(ne,Me){return Me.length>ne.length?Me:ne})}},U.equal=function(Q){return function(Ae){if(Ae!==Q)return JSON.stringify(Q)}},U.oneOf=function(){var Q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),we=Q.map(function(Ae){return U.equal(Ae)});return U.oneOfType.apply(this,we)},U.range=function(Q){var we=Q[0],Ae=Q[1];return function(ne){if(re(U.number,ne)||ne<we||ne>Ae)return"number between "+we+" & "+Ae+" (inclusive)"}},U.any=function(){},U.boolean=function(Q){if("boolean"!=typeof Q)return"boolean"},U.number=function(Q){if("number"!=typeof Q)return"number"},U.plainArray=function(Q){if(!Array.isArray(Q))return"array"},U.plainObject=function(Q){if(!lt(Q))return"object"},U.string=function(Q){if("string"!=typeof Q)return"string"},U.func=function(Q){if("function"!=typeof Q)return"function"},U.validate=re,U.processMessage=$,Nt.exports=U},518:Nt=>{Nt.exports=function xe(de,h,U){function Y(K,W){if(!h[K]){if(!de[K]){if(re)return re(K,!0);var ce=new Error("Cannot find module '"+K+"'");throw ce.code="MODULE_NOT_FOUND",ce}var ue=h[K]={exports:{}};de[K][0].call(ue.exports,function(Te){return Y(de[K][1][Te]||Te)},ue,ue.exports,xe,de,h,U)}return h[K].exports}for(var re=void 0,$=0;$<U.length;$++)Y(U[$]);return Y}({1:[function(xe,de,h){"use strict";var U={};function Y(K){return Math.floor(Math.abs(K)+.5)*(K>=0?1:-1)}function re(K,W,me){var ce=(K=Y(K*me))-(W=Y(W*me));ce<<=1,K-W<0&&(ce=~ce);for(var ue="";ce>=32;)ue+=String.fromCharCode(63+(32|31&ce)),ce>>=5;return ue+String.fromCharCode(ce+63)}function $(K){for(var W=[],me=0;me<K.length;me++){var ce=K[me].slice();W.push([ce[1],ce[0]])}return W}U.decode=function(K,W){for(var Ae,me=0,ce=0,ue=0,Te=[],Ne=0,Q=0,we=null,ne=Math.pow(10,Number.isInteger(W)?W:5);me<K.length;){we=null,Ne=0,Q=0;do{Q|=(31&(we=K.charCodeAt(me++)-63))<<Ne,Ne+=5}while(we>=32);Ae=1&Q?~(Q>>1):Q>>1,Ne=Q=0;do{Q|=(31&(we=K.charCodeAt(me++)-63))<<Ne,Ne+=5}while(we>=32);Te.push([(ce+=Ae)/ne,(ue+=1&Q?~(Q>>1):Q>>1)/ne])}return Te},U.encode=function(K,W){if(!K.length)return"";for(var me=Math.pow(10,Number.isInteger(W)?W:5),ce=re(K[0][0],0,me)+re(K[0][1],0,me),ue=1;ue<K.length;ue++){var Te=K[ue],Ne=K[ue-1];ce+=re(Te[0],Ne[0],me),ce+=re(Te[1],Ne[1],me)}return ce},U.fromGeoJSON=function(K,W){if(K&&"Feature"===K.type&&(K=K.geometry),!K||"LineString"!==K.type)throw new Error("Input must be a GeoJSON LineString");return U.encode($(K.coordinates),W)},U.toGeoJSON=function(K,W){return{type:"LineString",coordinates:$(U.decode(K,W))}},"object"==typeof de&&de.exports&&(de.exports=U)},{}],2:[function(xe,de,h){"use strict";var U=xe("is-obj"),Y=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;function $(me){if(null==me)throw new TypeError("Sources cannot be null or undefined");return Object(me)}function K(me,ce,ue){var Te=ce[ue];if(null!=Te){if(Y.call(me,ue)&&null==me[ue])throw new TypeError("Cannot convert undefined or null to object ("+ue+")");me[ue]=Y.call(me,ue)&&U(Te)?W(Object(me[ue]),ce[ue]):Te}}function W(me,ce){if(me===ce)return me;for(var ue in ce=Object(ce))Y.call(ce,ue)&&K(me,ce,ue);if(Object.getOwnPropertySymbols)for(var Te=Object.getOwnPropertySymbols(ce),Ne=0;Ne<Te.length;Ne++)re.call(ce,Te[Ne])&&K(me,ce,Te[Ne]);return me}de.exports=function(ce){ce=$(ce);for(var ue=1;ue<arguments.length;ue++)W(ce,arguments[ue]);return ce}},{"is-obj":5}],3:[function(xe,de,h){function U(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function Y(W){return"function"==typeof W}function $(W){return"object"==typeof W&&null!==W}function K(W){return void 0===W}de.exports=U,U.EventEmitter=U,U.prototype._events=void 0,U.prototype._maxListeners=void 0,U.defaultMaxListeners=10,U.prototype.setMaxListeners=function(W){if(!function re(W){return"number"==typeof W}(W)||W<0||isNaN(W))throw TypeError("n must be a positive number");return this._maxListeners=W,this},U.prototype.emit=function(W){var me,ce,ue,Te,Ne,Q;if(this._events||(this._events={}),"error"===W&&(!this._events.error||$(this._events.error)&&!this._events.error.length)){if((me=arguments[1])instanceof Error)throw me;var we=new Error('Uncaught, unspecified "error" event. ('+me+")");throw we.context=me,we}if(K(ce=this._events[W]))return!1;if(Y(ce))switch(arguments.length){case 1:ce.call(this);break;case 2:ce.call(this,arguments[1]);break;case 3:ce.call(this,arguments[1],arguments[2]);break;default:Te=Array.prototype.slice.call(arguments,1),ce.apply(this,Te)}else if($(ce))for(Te=Array.prototype.slice.call(arguments,1),ue=(Q=ce.slice()).length,Ne=0;Ne<ue;Ne++)Q[Ne].apply(this,Te);return!0},U.prototype.on=U.prototype.addListener=function(W,me){var ce;if(!Y(me))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",W,Y(me.listener)?me.listener:me),this._events[W]?$(this._events[W])?this._events[W].push(me):this._events[W]=[this._events[W],me]:this._events[W]=me,$(this._events[W])&&!this._events[W].warned&&(ce=K(this._maxListeners)?U.defaultMaxListeners:this._maxListeners)&&ce>0&&this._events[W].length>ce&&(this._events[W].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[W].length),"function"==typeof console.trace&&console.trace()),this},U.prototype.once=function(W,me){if(!Y(me))throw TypeError("listener must be a function");var ce=!1;function ue(){this.removeListener(W,ue),ce||(ce=!0,me.apply(this,arguments))}return ue.listener=me,this.on(W,ue),this},U.prototype.removeListener=function(W,me){var ce,ue,Te,Ne;if(!Y(me))throw TypeError("listener must be a function");if(!this._events||!this._events[W])return this;if(Te=(ce=this._events[W]).length,ue=-1,ce===me||Y(ce.listener)&&ce.listener===me)delete this._events[W],this._events.removeListener&&this.emit("removeListener",W,me);else if($(ce)){for(Ne=Te;Ne-- >0;)if(ce[Ne]===me||ce[Ne].listener&&ce[Ne].listener===me){ue=Ne;break}if(ue<0)return this;1===ce.length?(ce.length=0,delete this._events[W]):ce.splice(ue,1),this._events.removeListener&&this.emit("removeListener",W,me)}return this},U.prototype.removeAllListeners=function(W){var me,ce;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[W]&&delete this._events[W],this;if(0===arguments.length){for(me in this._events)"removeListener"!==me&&this.removeAllListeners(me);return this.removeAllListeners("removeListener"),this._events={},this}if(Y(ce=this._events[W]))this.removeListener(W,ce);else if(ce)for(;ce.length;)this.removeListener(W,ce[ce.length-1]);return delete this._events[W],this},U.prototype.listeners=function(W){return this._events&&this._events[W]?Y(this._events[W])?[this._events[W]]:this._events[W].slice():[]},U.prototype.listenerCount=function(W){if(this._events){var me=this._events[W];if(Y(me))return 1;if(me)return me.length}return 0},U.listenerCount=function(W,me){return W.listenerCount(me)}},{}],4:[function(xe,de,h){!function(){var Y={};void 0!==h?de.exports=Y:this.fuzzy=Y,Y.simpleFilter=function(re,$){return $.filter(function(K){return Y.test(re,K)})},Y.test=function(re,$){return null!==Y.match(re,$)},Y.match=function(re,$,K){var Ae,W=0,me=[],ce=$.length,ue=0,Te=0,Ne=(K=K||{}).pre||"",Q=K.post||"",we=K.caseSensitive&&$||$.toLowerCase();re=K.caseSensitive&&re||re.toLowerCase();for(var J=0;J<ce;J++)Ae=$[J],we[J]===re[W]?(Ae=Ne+Ae+Q,W+=1,Te+=1+Te):Te=0,ue+=Te,me[me.length]=Ae;return W===re.length?(ue=we===re?1/0:ue,{rendered:me.join(""),score:ue}):null},Y.filter=function(re,$,K){return $&&0!==$.length?"string"!=typeof re?$:(K=K||{},$.reduce(function(W,me,ce,ue){var Te=me;K.extract&&(Te=K.extract(me));var Ne=Y.match(re,Te,K);return null!=Ne&&(W[W.length]={string:Ne.rendered,score:Ne.score,index:ce,original:me}),W},[]).sort(function(W,me){return me.score-W.score||W.index-me.index})):[]}}()},{}],5:[function(xe,de,h){"use strict";de.exports=function(U){var Y=typeof U;return null!==U&&("object"===Y||"function"===Y)}},{}],6:[function(xe,de,h){de.exports=/<%=([\s\S]+?)%>/g},{}],7:[function(xe,de,h){(function(U){var K=/^\s+|\s+$/g,W=/^[-+]0x[0-9a-f]+$/i,me=/^0b[01]+$/i,ce=/^0o[0-7]+$/i,ue=parseInt,Ne="object"==typeof self&&self&&self.Object===Object&&self,Q="object"==typeof U&&U&&U.Object===Object&&U||Ne||Function("return this")(),Ae=Object.prototype.toString,J=Math.max,ne=Math.min,Me=function(){return Q.Date.now()};function He(gt){var Et=typeof gt;return!!gt&&("object"==Et||"function"==Et)}function Pt(gt){if("number"==typeof gt)return gt;if(function mt(gt){return"symbol"==typeof gt||function rt(gt){return!!gt&&"object"==typeof gt}(gt)&&"[object Symbol]"==Ae.call(gt)}(gt))return NaN;if(He(gt)){var Et="function"==typeof gt.valueOf?gt.valueOf():gt;gt=He(Et)?Et+"":Et}if("string"!=typeof gt)return 0===gt?gt:+gt;gt=gt.replace(K,"");var Ot=me.test(gt);return Ot||ce.test(gt)?ue(gt.slice(2),Ot?2:8):W.test(gt)?NaN:+gt}de.exports=function Be(gt,Et,Ot){var ut,it,cn,wn,sn,On,un=0,Nn=!1,ir=!1,kt=!0;if("function"!=typeof gt)throw new TypeError("Expected a function");function Pn(Qn){var yn=ut,hr=it;return ut=it=void 0,un=Qn,wn=gt.apply(hr,yn)}function nt(Qn){return un=Qn,sn=setTimeout(fn,Et),Nn?Pn(Qn):wn}function $t(Qn){var yn=Qn-On;return void 0===On||yn>=Et||yn<0||ir&&Qn-un>=cn}function fn(){var Qn=Me();if($t(Qn))return bt(Qn);sn=setTimeout(fn,function Tt(Qn){var jn=Et-(Qn-On);return ir?ne(jn,cn-(Qn-un)):jn}(Qn))}function bt(Qn){return sn=void 0,kt&&ut?Pn(Qn):(ut=it=void 0,wn)}function ur(){var Qn=Me(),yn=$t(Qn);if(ut=arguments,it=this,On=Qn,yn){if(void 0===sn)return nt(On);if(ir)return sn=setTimeout(fn,Et),Pn(On)}return void 0===sn&&(sn=setTimeout(fn,Et)),wn}return Et=Pt(Et)||0,He(Ot)&&(Nn=!!Ot.leading,cn=(ir="maxWait"in Ot)?J(Pt(Ot.maxWait)||0,Et):cn,kt="trailing"in Ot?!!Ot.trailing:kt),ur.cancel=function kn(){void 0!==sn&&clearTimeout(sn),un=0,ut=On=it=sn=void 0},ur.flush=function Gr(){return void 0===sn?wn:bt(Me())},ur}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(xe,de,h){(function(U){var re="__lodash_hash_undefined__",W=9007199254740991,me="[object Arguments]",ce="[object Array]",Te="[object Boolean]",Ne="[object Date]",Q="[object Error]",we="[object Function]",J="[object Map]",ne="[object Number]",Be="[object Object]",He="[object Promise]",mt="[object RegExp]",Pt="[object Set]",gt="[object String]",Et="[object Symbol]",ut="[object WeakMap]",it="[object ArrayBuffer]",cn="[object DataView]",$t=/^\[object .+?Constructor\]$/,fn=/^(?:0|[1-9]\d*)$/,bt={};bt["[object Float32Array]"]=bt["[object Float64Array]"]=bt["[object Int8Array]"]=bt["[object Int16Array]"]=bt["[object Int32Array]"]=bt["[object Uint8Array]"]=bt["[object Uint8ClampedArray]"]=bt["[object Uint16Array]"]=bt["[object Uint32Array]"]=!0,bt[me]=bt[ce]=bt[it]=bt[Te]=bt[cn]=bt[Ne]=bt[Q]=bt[we]=bt[J]=bt[ne]=bt[Be]=bt[mt]=bt[Pt]=bt[gt]=bt[ut]=!1;var kn="object"==typeof U&&U&&U.Object===Object&&U,Gr="object"==typeof self&&self&&self.Object===Object&&self,ur=kn||Gr||Function("return this")(),Qn="object"==typeof h&&h&&!h.nodeType&&h,yn=Qn&&"object"==typeof de&&de&&!de.nodeType&&de,hr=yn&&yn.exports===Qn,jn=hr&&kn.process,Ai=function(){try{return jn&&jn.binding&&jn.binding("util")}catch(pe){}}(),qr=Ai&&Ai.isTypedArray;function Nr(pe,ze){for(var ht=-1,Jt=null==pe?0:pe.length;++ht<Jt;)if(ze(pe[ht],ht,pe))return!0;return!1}function Vo(pe,ze){return pe.has(ze)}function Pi(pe){var ze=-1,ht=Array(pe.size);return pe.forEach(function(Jt,dr){ht[++ze]=[dr,Jt]}),ht}function $o(pe){var ze=-1,ht=Array(pe.size);return pe.forEach(function(Jt){ht[++ze]=Jt}),ht}var pe,os=Array.prototype,ss=Object.prototype,Is=ur["__core-js_shared__"],qs=Function.prototype.toString,xi=ss.hasOwnProperty,Zs=(pe=/[^.]+$/.exec(Is&&Is.keys&&Is.keys.IE_PROTO||""))?"Symbol(src)_1."+pe:"",ki=ss.toString,Ms=RegExp("^"+qs.call(xi).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bi=hr?ur.Buffer:void 0,Zr=ur.Symbol,Yn=ur.Uint8Array,io=ss.propertyIsEnumerable,er=os.splice,Ni=Zr?Zr.toStringTag:void 0,Go=Object.getOwnPropertySymbols,oe=bi?bi.isBuffer:void 0,z=function ro(pe,ze){return function(ht){return pe(ze(ht))}}(Object.keys,Object),V=Fn(ur,"DataView"),ie=Fn(ur,"Map"),se=Fn(ur,"Promise"),De=Fn(ur,"Set"),Ie=Fn(ur,"WeakMap"),Oe=Fn(Object,"create"),ke=gr(V),Ve=gr(ie),st=gr(se),It=gr(De),ot=gr(Ie),rn=Zr?Zr.prototype:void 0,Wt=rn?rn.valueOf:void 0;function Xt(pe){var ze=-1,ht=null==pe?0:pe.length;for(this.clear();++ze<ht;){var Jt=pe[ze];this.set(Jt[0],Jt[1])}}function Ln(pe){var ze=-1,ht=null==pe?0:pe.length;for(this.clear();++ze<ht;){var Jt=pe[ze];this.set(Jt[0],Jt[1])}}function wi(pe){var ze=-1,ht=null==pe?0:pe.length;for(this.clear();++ze<ht;){var Jt=pe[ze];this.set(Jt[0],Jt[1])}}function hi(pe){var ze=-1,ht=null==pe?0:pe.length;for(this.__data__=new wi;++ze<ht;)this.add(pe[ze])}function Xi(pe){var ze=this.__data__=new Ln(pe);this.size=ze.size}function xn(pe,ze){var ht=Sr(pe),Jt=!ht&&yo(pe),dr=!ht&&!Jt&&li(pe),Mn=!ht&&!Jt&&!dr&&ti(pe),At=ht||Jt||dr||Mn,nr=At?function no(pe,ze){for(var ht=-1,Jt=Array(pe);++ht<pe;)Jt[ht]=ze(ht);return Jt}(pe.length,String):[],yi=nr.length;for(var or in pe)(ze||xi.call(pe,or))&&(!At||!("length"==or||dr&&("offset"==or||"parent"==or)||Mn&&("buffer"==or||"byteLength"==or||"byteOffset"==or)||Ze(or,yi)))&&nr.push(or);return nr}function Po(pe,ze){for(var ht=pe.length;ht--;)if(wr(pe[ht][0],ze))return ht;return-1}function Ar(pe){return null==pe?void 0===pe?"[object Undefined]":"[object Null]":Ni&&Ni in Object(pe)?function Yl(pe){var ze=xi.call(pe,Ni),ht=pe[Ni];try{pe[Ni]=void 0;var Jt=!0}catch(Mn){}var dr=ki.call(pe);return Jt&&(ze?pe[Ni]=ht:delete pe[Ni]),dr}(pe):function Xr(pe){return ki.call(pe)}(pe)}function gi(pe){return qo(pe)&&Ar(pe)==me}function ko(pe,ze,ht,Jt,dr){return pe===ze||(null==pe||null==ze||!qo(pe)&&!qo(ze)?pe!=pe&&ze!=ze:function xr(pe,ze,ht,Jt,dr,Mn){var At=Sr(pe),nr=Sr(ze),yi=At?ce:Se(pe),or=nr?ce:Se(ze),Lt=(yi=yi==me?Be:yi)==Be,Cn=(or=or==me?Be:or)==Be,Gn=yi==or;if(Gn&&li(pe)){if(!li(ze))return!1;At=!0,Lt=!1}if(Gn&&!Lt)return Mn||(Mn=new Xi),At||ti(pe)?Ri(pe,ze,ht,Jt,dr,Mn):function so(pe,ze,ht,Jt,dr,Mn,At){switch(ht){case cn:if(pe.byteLength!=ze.byteLength||pe.byteOffset!=ze.byteOffset)return!1;pe=pe.buffer,ze=ze.buffer;case it:return!(pe.byteLength!=ze.byteLength||!Mn(new Yn(pe),new Yn(ze)));case Te:case Ne:case ne:return wr(+pe,+ze);case Q:return pe.name==ze.name&&pe.message==ze.message;case mt:case gt:return pe==ze+"";case J:var nr=Pi;case Pt:if(nr||(nr=$o),pe.size!=ze.size&&!(1&Jt))return!1;var or=At.get(pe);if(or)return or==ze;Jt|=2,At.set(pe,ze);var Lt=Ri(nr(pe),nr(ze),Jt,dr,Mn,At);return At.delete(pe),Lt;case Et:if(Wt)return Wt.call(pe)==Wt.call(ze)}return!1}(pe,ze,yi,ht,Jt,dr,Mn);if(!(1&ht)){var jr=Lt&&xi.call(pe,"__wrapped__"),di=Cn&&xi.call(ze,"__wrapped__");if(jr||di){var Ir=jr?pe.value():pe,ni=di?ze.value():ze;return Mn||(Mn=new Xi),dr(Ir,ni,ht,Jt,Mn)}}return!!Gn&&(Mn||(Mn=new Xi),function Ps(pe,ze,ht,Jt,dr,Mn){var At=1&ht,nr=us(pe),yi=nr.length;if(yi!=us(ze).length&&!At)return!1;for(var Cn=yi;Cn--;){var Gn=nr[Cn];if(!(At?Gn in ze:xi.call(ze,Gn)))return!1}var jr=Mn.get(pe);if(jr&&Mn.get(ze))return jr==ze;var di=!0;Mn.set(pe,ze),Mn.set(ze,pe);for(var Ir=At;++Cn<yi;){var ni=pe[Gn=nr[Cn]],pr=ze[Gn];if(Jt)var Os=At?Jt(pr,ni,Gn,ze,pe,Mn):Jt(ni,pr,Gn,pe,ze,Mn);if(!(void 0===Os?ni===pr||dr(ni,pr,ht,Jt,Mn):Os)){di=!1;break}Ir||(Ir="constructor"==Gn)}if(di&&!Ir){var vo=pe.constructor,Rn=ze.constructor;vo!=Rn&&"constructor"in pe&&"constructor"in ze&&!("function"==typeof vo&&vo instanceof vo&&"function"==typeof Rn&&Rn instanceof Rn)&&(di=!1)}return Mn.delete(pe),Mn.delete(ze),di}(pe,ze,ht,Jt,dr,Mn))}(pe,ze,ht,Jt,ko,dr))}function ii(pe){return!(!Rs(pe)||function An(pe){return!!Zs&&Zs in pe}(pe))&&(ks(pe)?Ms:$t).test(gr(pe))}function _i(pe){if(!function Xn(pe){var ze=pe&&pe.constructor;return pe===("function"==typeof ze&&ze.prototype||ss)}(pe))return z(pe);var ze=[];for(var ht in Object(pe))xi.call(pe,ht)&&"constructor"!=ht&&ze.push(ht);return ze}function Ri(pe,ze,ht,Jt,dr,Mn){var At=1&ht,nr=pe.length,yi=ze.length;if(nr!=yi&&!(At&&yi>nr))return!1;var or=Mn.get(pe);if(or&&Mn.get(ze))return or==ze;var Lt=-1,Cn=!0,Gn=2&ht?new hi:void 0;for(Mn.set(pe,ze),Mn.set(ze,pe);++Lt<nr;){var jr=pe[Lt],di=ze[Lt];if(Jt)var Ir=At?Jt(di,jr,Lt,ze,pe,Mn):Jt(jr,di,Lt,pe,ze,Mn);if(void 0!==Ir){if(Ir)continue;Cn=!1;break}if(Gn){if(!Nr(ze,function(ni,pr){if(!Vo(Gn,pr)&&(jr===ni||dr(jr,ni,ht,Jt,Mn)))return Gn.push(pr)})){Cn=!1;break}}else if(jr!==di&&!dr(jr,di,ht,Jt,Mn)){Cn=!1;break}}return Mn.delete(pe),Mn.delete(ze),Cn}function us(pe){return function Wr(pe,ze,ht){var Jt=ze(pe);return Sr(pe)?Jt:function Mo(pe,ze){for(var ht=-1,Jt=ze.length,dr=pe.length;++ht<Jt;)pe[dr+ht]=ze[ht];return pe}(Jt,ht(pe))}(pe,Br,Jl)}function Na(pe,ze){var ht=pe.__data__;return function _t(pe){var ze=typeof pe;return"string"==ze||"number"==ze||"symbol"==ze||"boolean"==ze?"__proto__"!==pe:null===pe}(ze)?ht["string"==typeof ze?"string":"hash"]:ht.map}function Fn(pe,ze){var ht=function mi(pe,ze){return null==pe?void 0:pe[ze]}(pe,ze);return ii(ht)?ht:void 0}Xt.prototype.clear=function nn(){this.__data__=Oe?Oe(null):{},this.size=0},Xt.prototype.delete=function $e(pe){var ze=this.has(pe)&&delete this.__data__[pe];return this.size-=ze?1:0,ze},Xt.prototype.get=function tr(pe){var ze=this.__data__;if(Oe){var ht=ze[pe];return ht===re?void 0:ht}return xi.call(ze,pe)?ze[pe]:void 0},Xt.prototype.has=function Gt(pe){var ze=this.__data__;return Oe?void 0!==ze[pe]:xi.call(ze,pe)},Xt.prototype.set=function Wn(pe,ze){var ht=this.__data__;return this.size+=this.has(pe)?0:1,ht[pe]=Oe&&void 0===ze?re:ze,this},Ln.prototype.clear=function as(){this.__data__=[],this.size=0},Ln.prototype.delete=function Ao(pe){var ze=this.__data__,ht=Po(ze,pe);return!(ht<0||(ht==ze.length-1?ze.pop():er.call(ze,ht,1),--this.size,0))},Ln.prototype.get=function Mt(pe){var ze=this.__data__,ht=Po(ze,pe);return ht<0?void 0:ze[ht][1]},Ln.prototype.has=function pn(pe){return Po(this.__data__,pe)>-1},Ln.prototype.set=function tn(pe,ze){var ht=this.__data__,Jt=Po(ht,pe);return Jt<0?(++this.size,ht.push([pe,ze])):ht[Jt][1]=ze,this},wi.prototype.clear=function ls(){this.size=0,this.__data__={hash:new Xt,map:new(ie||Ln),string:new Xt}},wi.prototype.delete=function Bn(pe){var ze=Na(this,pe).delete(pe);return this.size-=ze?1:0,ze},wi.prototype.get=function gn(pe){return Na(this,pe).get(pe)},wi.prototype.has=function cs(pe){return Na(this,pe).has(pe)},wi.prototype.set=function Cr(pe,ze){var ht=Na(this,pe),Jt=ht.size;return ht.set(pe,ze),this.size+=ht.size==Jt?0:1,this},hi.prototype.add=hi.prototype.push=function Dr(pe){return this.__data__.set(pe,re),this},hi.prototype.has=function Kl(pe){return this.__data__.has(pe)},Xi.prototype.clear=function Ws(){this.__data__=new Ln,this.size=0},Xi.prototype.delete=function oo(pe){var ze=this.__data__,ht=ze.delete(pe);return this.size=ze.size,ht},Xi.prototype.get=function As(pe){return this.__data__.get(pe)},Xi.prototype.has=function Xs(pe){return this.__data__.has(pe)},Xi.prototype.set=function qn(pe,ze){var ht=this.__data__;if(ht instanceof Ln){var Jt=ht.__data__;if(!ie||Jt.length<199)return Jt.push([pe,ze]),this.size=++ht.size,this;ht=this.__data__=new wi(Jt)}return ht.set(pe,ze),this.size=ht.size,this};var Jl=Go?function(pe){return null==pe?[]:(pe=Object(pe),function zi(pe,ze){for(var ht=-1,Jt=null==pe?0:pe.length,dr=0,Mn=[];++ht<Jt;){var At=pe[ht];ze(At,ht,pe)&&(Mn[dr++]=At)}return Mn}(Go(pe),function(ze){return io.call(pe,ze)}))}:function _r(){return[]},Se=Ar;function Ze(pe,ze){return!!(ze=null==ze?W:ze)&&("number"==typeof pe||fn.test(pe))&&pe>-1&&pe%1==0&&pe<ze}function gr(pe){if(null!=pe){try{return qs.call(pe)}catch(ze){}try{return pe+""}catch(ze){}}return""}function wr(pe,ze){return pe===ze||pe!=pe&&ze!=ze}(V&&Se(new V(new ArrayBuffer(1)))!=cn||ie&&Se(new ie)!=J||se&&Se(se.resolve())!=He||De&&Se(new De)!=Pt||Ie&&Se(new Ie)!=ut)&&(Se=function(pe){var ze=Ar(pe),ht=ze==Be?pe.constructor:void 0,Jt=ht?gr(ht):"";if(Jt)switch(Jt){case ke:return cn;case Ve:return J;case st:return He;case It:return Pt;case ot:return ut}return ze});var yo=gi(function(){return arguments}())?gi:function(pe){return qo(pe)&&xi.call(pe,"callee")&&!io.call(pe,"callee")},Sr=Array.isArray;var li=oe||function Bi(){return!1};function ks(pe){if(!Rs(pe))return!1;var ze=Ar(pe);return ze==we||"[object GeneratorFunction]"==ze||"[object AsyncFunction]"==ze||"[object Proxy]"==ze}function ci(pe){return"number"==typeof pe&&pe>-1&&pe%1==0&&pe<=W}function Rs(pe){var ze=typeof pe;return null!=pe&&("object"==ze||"function"==ze)}function qo(pe){return null!=pe&&"object"==typeof pe}var ti=qr?function Wi(pe){return function(ze){return pe(ze)}}(qr):function Ho(pe){return qo(pe)&&ci(pe.length)&&!!bt[Ar(pe)]};function Br(pe){return function xl(pe){return null!=pe&&ci(pe.length)&&!ks(pe)}(pe)?xn(pe):_i(pe)}de.exports=function bl(pe,ze){return ko(pe,ze)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(xe,de,h){(function(U){var Y=xe("lodash._reinterpolate"),re=xe("lodash.templatesettings"),me=9007199254740991,ce="[object Arguments]",Ae="[object Error]",J="[object Function]",rt="[object Object]",Ot="[object Symbol]",$t=/\b__p \+= '';/g,fn=/\b(__p \+=) '' \+/g,bt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Gr=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ur=/^\[object .+?Constructor\]$/,Qn=/^(?:0|[1-9]\d*)$/,yn=/($^)/,hr=/['\n\r\u2028\u2029\\]/g,jn={};jn["[object Float32Array]"]=jn["[object Float64Array]"]=jn["[object Int8Array]"]=jn["[object Int16Array]"]=jn["[object Int32Array]"]=jn["[object Uint8Array]"]=jn["[object Uint8ClampedArray]"]=jn["[object Uint16Array]"]=jn["[object Uint32Array]"]=!0,jn[ce]=jn["[object Array]"]=jn["[object ArrayBuffer]"]=jn["[object Boolean]"]=jn["[object DataView]"]=jn["[object Date]"]=jn[Ae]=jn[J]=jn["[object Map]"]=jn["[object Number]"]=jn[rt]=jn["[object RegExp]"]=jn["[object Set]"]=jn["[object String]"]=jn["[object WeakMap]"]=!1;var Ai={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},qr="object"==typeof U&&U&&U.Object===Object&&U,zi="object"==typeof self&&self&&self.Object===Object&&self,Mo=qr||zi||Function("return this")(),Nr="object"==typeof h&&h&&!h.nodeType&&h,no=Nr&&"object"==typeof de&&de&&!de.nodeType&&de,Wi=no&&no.exports===Nr,Vo=Wi&&qr.process,mi=function(){try{return no&&no.require&&no.require("util").types||Vo&&Vo.binding&&Vo.binding("util")}catch(Ze){}}(),Pi=mi&&mi.isTypedArray;function ro(Se,Ze,_t){switch(_t.length){case 0:return Se.call(Ze);case 1:return Se.call(Ze,_t[0]);case 2:return Se.call(Ze,_t[0],_t[1]);case 3:return Se.call(Ze,_t[0],_t[1],_t[2])}return Se.apply(Ze,_t)}function $o(Se,Ze){for(var _t=-1,An=null==Se?0:Se.length,Xn=Array(An);++_t<An;)Xn[_t]=Ze(Se[_t],_t,Se);return Xn}function Is(Se){return"\\"+Ai[Se]}function xi(Se,Ze){return function(_t){return Se(Ze(_t))}}var Se,ki=Object.prototype,Ms=Mo["__core-js_shared__"],bi=Function.prototype.toString,Zr=ki.hasOwnProperty,Yn=(Se=/[^.]+$/.exec(Ms&&Ms.keys&&Ms.keys.IE_PROTO||""))?"Symbol(src)_1."+Se:"",io=ki.toString,er=bi.call(Object),Ni=RegExp("^"+bi.call(Zr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Go=Wi?Mo.Buffer:void 0,oe=Mo.Symbol,z=xi(Object.getPrototypeOf,Object),V=ki.propertyIsEnumerable,ie=oe?oe.toStringTag:void 0,se=function(){try{var Se=function tn(Se,Ze){var _t=function qs(Se,Ze){return null==Se?void 0:Se[Ze]}(Se,Ze);return function nn(Se){return!(!gi(Se)||function gn(Se){return!!Yn&&Yn in Se}(Se))&&(Wr(Se)?Ni:ur).test(function Ws(Se){if(null!=Se){try{return bi.call(Se)}catch(Ze){}try{return Se+""}catch(Ze){}}return""}(Se))}(_t)?_t:void 0}(Object,"defineProperty");return Se({},"",{}),Se}catch(Ze){}}(),De=Go?Go.isBuffer:void 0,Ie=xi(Object.keys,Object),Oe=Math.max,ke=Date.now,Ve=oe?oe.prototype:void 0,st=Ve?Ve.toString:void 0;function It(Se,Ze){var _t=Xs(Se),An=!_t&&As(Se),Xn=!_t&&!An&&xn(Se),Xr=!_t&&!An&&!Xn&&Ho(Se),gr=_t||An||Xn||Xr,wr=gr?function os(Se,Ze){for(var _t=-1,An=Array(Se);++_t<Se;)An[_t]=Ze(_t);return An}(Se.length,String):[],yo=wr.length;for(var Sr in Se)(Ze||Zr.call(Se,Sr))&&(!gr||!("length"==Sr||Xn&&("offset"==Sr||"parent"==Sr)||Xr&&("buffer"==Sr||"byteLength"==Sr||"byteOffset"==Sr)||ls(Sr,yo)))&&wr.push(Sr);return wr}function ot(Se,Ze,_t){var An=Se[Ze];(!Zr.call(Se,Ze)||!oo(An,_t)||void 0===_t&&!(Ze in Se))&&rn(Se,Ze,_t)}function rn(Se,Ze,_t){"__proto__"==Ze&&se?se(Se,Ze,{configurable:!0,enumerable:!0,value:_t,writable:!0}):Se[Ze]=_t}function Wt(Se){return null==Se?void 0===Se?"[object Undefined]":"[object Null]":ie&&ie in Object(Se)?function wi(Se){var Ze=Zr.call(Se,ie),_t=Se[ie];try{Se[ie]=void 0;var An=!0}catch(Xr){}var Xn=io.call(Se);return An&&(Ze?Se[ie]=_t:delete Se[ie]),Xn}(Se):function hi(Se){return io.call(Se)}(Se)}function Xt(Se){return ko(Se)&&Wt(Se)==ce}function Gt(Se){if(!gi(Se))return function Cr(Se){var Ze=[];if(null!=Se)for(var _t in Object(Se))Ze.push(_t);return Ze}(Se);var Ze=cs(Se),_t=[];for(var An in Se)"constructor"==An&&(Ze||!Zr.call(Se,An))||_t.push(An);return _t}function Wn(Se,Ze){return Kl(function Dr(Se,Ze,_t){return Ze=Oe(void 0===Ze?Se.length-1:Ze,0),function(){for(var An=arguments,Xn=-1,Xr=Oe(An.length-Ze,0),gr=Array(Xr);++Xn<Xr;)gr[Xn]=An[Ze+Xn];Xn=-1;for(var wr=Array(Ze+1);++Xn<Ze;)wr[Xn]=An[Xn];return wr[Ze]=_t(gr),ro(Se,this,wr)}}(Se,Ze,Yl),Se+"")}var Ln=se?function(Se,Ze){return se(Se,"toString",{configurable:!0,enumerable:!1,value:Fn(Ze),writable:!0})}:Yl;function as(Se){if("string"==typeof Se)return Se;if(Xs(Se))return $o(Se,as)+"";if(function ii(Se){return"symbol"==typeof Se||ko(Se)&&Wt(Se)==Ot}(Se))return st?st.call(Se):"";var Ze=Se+"";return"0"==Ze&&1/Se==-Infinity?"-0":Ze}function pn(Se,Ze,_t,An){return void 0===Se||oo(Se,ki[_t])&&!Zr.call(An,_t)?Ze:Se}function ls(Se,Ze){var _t=typeof Se;return!!(Ze=null==Ze?me:Ze)&&("number"==_t||"symbol"!=_t&&Qn.test(Se))&&Se>-1&&Se%1==0&&Se<Ze}function Bn(Se,Ze,_t){if(!gi(_t))return!1;var An=typeof Ze;return!!("number"==An?qn(_t)&&ls(Ze,_t.length):"string"==An&&Ze in _t)&&oo(_t[Ze],Se)}function cs(Se){var Ze=Se&&Se.constructor;return Se===("function"==typeof Ze&&Ze.prototype||ki)}var Kl=function Xi(Se){var Ze=0,_t=0;return function(){var An=ke(),Xn=16-(An-_t);if(_t=An,Xn>0){if(++Ze>=800)return arguments[0]}else Ze=0;return Se.apply(void 0,arguments)}}(Ln);function oo(Se,Ze){return Se===Ze||Se!=Se&&Ze!=Ze}var As=Xt(function(){return arguments}())?Xt:function(Se){return ko(Se)&&Zr.call(Se,"callee")&&!V.call(Se,"callee")},Xs=Array.isArray;function qn(Se){return null!=Se&&Ar(Se.length)&&!Wr(Se)}var xn=De||function Jl(){return!1};function Po(Se){if(!ko(Se))return!1;var Ze=Wt(Se);return Ze==Ae||"[object DOMException]"==Ze||"string"==typeof Se.message&&"string"==typeof Se.name&&!function xr(Se){if(!ko(Se)||Wt(Se)!=rt)return!1;var Ze=z(Se);if(null===Ze)return!0;var _t=Zr.call(Ze,"constructor")&&Ze.constructor;return"function"==typeof _t&&_t instanceof _t&&bi.call(_t)==er}(Se)}function Wr(Se){if(!gi(Se))return!1;var Ze=Wt(Se);return Ze==J||"[object GeneratorFunction]"==Ze||"[object AsyncFunction]"==Ze||"[object Proxy]"==Ze}function Ar(Se){return"number"==typeof Se&&Se>-1&&Se%1==0&&Se<=me}function gi(Se){var Ze=typeof Se;return null!=Se&&("object"==Ze||"function"==Ze)}function ko(Se){return null!=Se&&"object"==typeof Se}var Ho=Pi?function Ss(Se){return function(Ze){return Se(Ze)}}(Pi):function $e(Se){return ko(Se)&&Ar(Se.length)&&!!jn[Wt(Se)]};var Ri=function Mt(Se){return Wn(function(Ze,_t){var An=-1,Xn=_t.length,Xr=Xn>1?_t[Xn-1]:void 0,gr=Xn>2?_t[2]:void 0;for(Xr=Se.length>3&&"function"==typeof Xr?(Xn--,Xr):void 0,gr&&Bn(_t[0],_t[1],gr)&&(Xr=Xn<3?void 0:Xr,Xn=1),Ze=Object(Ze);++An<Xn;){var wr=_t[An];wr&&Se(Ze,wr,An,Xr)}return Ze})}(function(Se,Ze,_t,An){!function Ao(Se,Ze,_t,An){var Xn=!_t;_t||(_t={});for(var Xr=-1,gr=Ze.length;++Xr<gr;){var wr=Ze[Xr],yo=An?An(_t[wr],Se[wr],wr,_t,Se):void 0;void 0===yo&&(yo=Se[wr]),Xn?rn(_t,wr,yo):ot(_t,wr,yo)}return _t}(Ze,function Ps(Se){return qn(Se)?It(Se,!0):Gt(Se)}(Ze),Se,An)});function so(Se){return qn(Se)?It(Se):function tr(Se){if(!cs(Se))return Ie(Se);var Ze=[];for(var _t in Object(Se))Zr.call(Se,_t)&&"constructor"!=_t&&Ze.push(_t);return Ze}(Se)}var Na=Wn(function(Se,Ze){try{return ro(Se,void 0,Ze)}catch(_t){return Po(_t)?_t:new Error(_t)}});function Fn(Se){return function(){return Se}}function Yl(Se){return Se}de.exports=function us(Se,Ze,_t){var An=re.imports._.templateSettings||re;_t&&Bn(Se,Ze,_t)&&(Ze=void 0),Se=function _i(Se){return null==Se?"":as(Se)}(Se),Ze=Ri({},Ze,An,pn);var wr,yo,Xn=Ri({},Ze.imports,An.imports,pn),Xr=so(Xn),gr=function ss(Se,Ze){return $o(Ze,function(_t){return Se[_t]})}(Xn,Xr),Sr=0,xl=Ze.interpolate||yn,li="__p += '",bl=RegExp((Ze.escape||yn).source+"|"+xl.source+"|"+(xl===Y?Gr:yn).source+"|"+(Ze.evaluate||yn).source+"|$","g"),ks=Zr.call(Ze,"sourceURL")?"//# sourceURL="+(Ze.sourceURL+"").replace(/[\r\n]/g," ")+"\n":"";Se.replace(bl,function(qo,ti,Br,_r,Bi,pe){return Br||(Br=_r),li+=Se.slice(Sr,pe).replace(hr,Is),ti&&(wr=!0,li+="' +\n__e("+ti+") +\n'"),Bi&&(yo=!0,li+="';\n"+Bi+";\n__p += '"),Br&&(li+="' +\n((__t = ("+Br+")) == null ? '' : __t) +\n'"),Sr=pe+qo.length,qo}),li+="';\n";var ci=Zr.call(Ze,"variable")&&Ze.variable;ci||(li="with (obj) {\n"+li+"\n}\n"),li=(yo?li.replace($t,""):li).replace(fn,"$1").replace(bt,"$1;"),li="function("+(ci||"obj")+") {\n"+(ci?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(wr?", __e = _.escape":"")+(yo?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+li+"return __p\n}";var Rs=Na(function(){return Function(Xr,ks+"return "+li).apply(void 0,gr)});if(Rs.source=li,Po(Rs))throw Rs;return Rs}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._reinterpolate":6,"lodash.templatesettings":10}],10:[function(xe,de,h){(function(U){var Y=xe("lodash._reinterpolate"),K="[object Symbol]",me=/[&<>"']/g,ce=RegExp(me.source),we="object"==typeof self&&self&&self.Object===Object&&self,Ae="object"==typeof U&&U&&U.Object===Object&&U||we||Function("return this")();var Me=function ne(kt){return function(Pn){return null==kt?void 0:kt[Pn]}}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Be=Object.prototype,He=Be.hasOwnProperty,rt=Be.toString,mt=Ae.Symbol,Pt=mt?mt.toStringTag:void 0,gt=mt?mt.prototype:void 0,Et=gt?gt.toString:void 0;function ut(kt){return null==kt?void 0===kt?"[object Undefined]":"[object Null]":Pt&&Pt in Object(kt)?function cn(kt){var Pn=He.call(kt,Pt),nt=kt[Pt];try{kt[Pt]=void 0;var Tt=!0}catch(fn){}var $t=rt.call(kt);return Tt&&(Pn?kt[Pt]=nt:delete kt[Pt]),$t}(kt):function wn(kt){return rt.call(kt)}(kt)}function it(kt){if("string"==typeof kt)return kt;if(sn(kt))return function J(kt,Pn){for(var nt=-1,Tt=null==kt?0:kt.length,$t=Array(Tt);++nt<Tt;)$t[nt]=Pn(kt[nt],nt,kt);return $t}(kt,it)+"";if(function un(kt){return"symbol"==typeof kt||function On(kt){return null!=kt&&"object"==typeof kt}(kt)&&ut(kt)==K}(kt))return Et?Et.call(kt):"";var Pn=kt+"";return"0"==Pn&&1/kt==-Infinity?"-0":Pn}var sn=Array.isArray;de.exports={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:Y,variable:"",imports:{_:{escape:function ir(kt){return(kt=function Nn(kt){return null==kt?"":it(kt)}(kt))&&ce.test(kt)?kt.replace(me,Me):kt}}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._reinterpolate":6}],11:[function(xe,de,h){var U=xe("./_root");de.exports=U.Symbol},{"./_root":18}],12:[function(xe,de,h){var U=xe("./_Symbol"),Y=xe("./_getRawTag"),re=xe("./_objectToString"),W=U?U.toStringTag:void 0;de.exports=function me(ce){return null==ce?void 0===ce?"[object Undefined]":"[object Null]":W&&W in Object(ce)?Y(ce):re(ce)}},{"./_Symbol":11,"./_getRawTag":15,"./_objectToString":16}],13:[function(xe,de,h){(function(U){de.exports="object"==typeof U&&U&&U.Object===Object&&U}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(xe,de,h){var Y=xe("./_overArg")(Object.getPrototypeOf,Object);de.exports=Y},{"./_overArg":17}],15:[function(xe,de,h){var U=xe("./_Symbol"),Y=Object.prototype,re=Y.hasOwnProperty,$=Y.toString,K=U?U.toStringTag:void 0;de.exports=function W(me){var ce=re.call(me,K),ue=me[K];try{me[K]=void 0;var Te=!0}catch(Q){}var Ne=$.call(me);return Te&&(ce?me[K]=ue:delete me[K]),Ne}},{"./_Symbol":11}],16:[function(xe,de,h){var Y=Object.prototype.toString;de.exports=function re($){return Y.call($)}},{}],17:[function(xe,de,h){de.exports=function U(Y,re){return function($){return Y(re($))}}},{}],18:[function(xe,de,h){var U=xe("./_freeGlobal"),Y="object"==typeof self&&self&&self.Object===Object&&self,re=U||Y||Function("return this")();de.exports=re},{"./_freeGlobal":13}],19:[function(xe,de,h){de.exports=function U(Y){return null!=Y&&"object"==typeof Y}},{}],20:[function(xe,de,h){var U=xe("./_baseGetTag"),Y=xe("./_getPrototype"),re=xe("./isObjectLike"),me=Function.prototype.toString,ce=Object.prototype.hasOwnProperty,ue=me.call(Object);de.exports=function Te(Ne){if(!re(Ne)||"[object Object]"!=U(Ne))return!1;var Q=Y(Ne);if(null===Q)return!0;var we=ce.call(Q,"constructor")&&Q.constructor;return"function"==typeof we&&we instanceof we&&me.call(we)==ue}},{"./_baseGetTag":12,"./_getPrototype":14,"./isObjectLike":19}],21:[function(xe,de,h){var Y,re,U=de.exports={};function $(){throw new Error("setTimeout has not been defined")}function K(){throw new Error("clearTimeout has not been defined")}function W(ne){if(Y===setTimeout)return setTimeout(ne,0);if((Y===$||!Y)&&setTimeout)return Y=setTimeout,setTimeout(ne,0);try{return Y(ne,0)}catch(Me){try{return Y.call(null,ne,0)}catch(Be){return Y.call(this,ne,0)}}}!function(){try{Y="function"==typeof setTimeout?setTimeout:$}catch(ne){Y=$}try{re="function"==typeof clearTimeout?clearTimeout:K}catch(ne){re=K}}();var Te,ce=[],ue=!1,Ne=-1;function Q(){!ue||!Te||(ue=!1,Te.length?ce=Te.concat(ce):Ne=-1,ce.length&&we())}function we(){if(!ue){var ne=W(Q);ue=!0;for(var Me=ce.length;Me;){for(Te=ce,ce=[];++Ne<Me;)Te&&Te[Ne].run();Ne=-1,Me=ce.length}Te=null,ue=!1,function me(ne){if(re===clearTimeout)return clearTimeout(ne);if((re===K||!re)&&clearTimeout)return re=clearTimeout,clearTimeout(ne);try{return re(ne)}catch(Me){try{return re.call(null,ne)}catch(Be){return re.call(this,ne)}}}(ne)}}function Ae(ne,Me){this.fun=ne,this.array=Me}function J(){}U.nextTick=function(ne){var Me=new Array(arguments.length-1);if(arguments.length>1)for(var Be=1;Be<arguments.length;Be++)Me[Be-1]=arguments[Be];ce.push(new Ae(ne,Me)),1===ce.length&&!ue&&W(we)},Ae.prototype.run=function(){this.fun.apply(null,this.array)},U.title="browser",U.browser=!0,U.env={},U.argv=[],U.version="",U.versions={},U.on=J,U.addListener=J,U.once=J,U.off=J,U.removeListener=J,U.removeAllListeners=J,U.emit=J,U.prependListener=J,U.prependOnceListener=J,U.listeners=function(ne){return[]},U.binding=function(ne){throw new Error("process.binding is not supported")},U.cwd=function(){return"/"},U.chdir=function(ne){throw new Error("process.chdir is not supported")},U.umask=function(){return 0}},{}],22:[function(xe,de,h){"use strict";function U(re){return function($){var K=$.dispatch,W=$.getState;return function(me){return function(ce){return"function"==typeof ce?ce(K,W,re):me(ce)}}}}h.__esModule=!0;var Y=U();Y.withExtraArgument=U,h.default=Y},{}],23:[function(xe,de,h){"use strict";h.__esModule=!0;var U=Object.assign||function(W){for(var me=1;me<arguments.length;me++){var ce=arguments[me];for(var ue in ce)Object.prototype.hasOwnProperty.call(ce,ue)&&(W[ue]=ce[ue])}return W};h.default=function K(){for(var W=arguments.length,me=Array(W),ce=0;ce<W;ce++)me[ce]=arguments[ce];return function(ue){return function(Te,Ne,Q){var J,we=ue(Te,Ne,Q),Ae=we.dispatch,ne={getState:we.getState,dispatch:function(Be){return Ae(Be)}};return J=me.map(function(Me){return Me(ne)}),Ae=re.default.apply(void 0,J)(we.dispatch),U({},we,{dispatch:Ae})}}};var re=function $(W){return W&&W.__esModule?W:{default:W}}(xe("./compose"))},{"./compose":26}],24:[function(xe,de,h){"use strict";function U(re,$){return function(){return $(re.apply(void 0,arguments))}}h.__esModule=!0,h.default=function Y(re,$){if("function"==typeof re)return U(re,$);if("object"!=typeof re||null===re)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===re?"null":typeof re)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var K=Object.keys(re),W={},me=0;me<K.length;me++){var ce=K[me],ue=re[ce];"function"==typeof ue&&(W[ce]=U(ue,$))}return W}},{}],25:[function(xe,de,h){(function(U){"use strict";h.__esModule=!0,h.default=function Ne(Q){for(var we=Object.keys(Q),Ae={},J=0;J<we.length;J++){var ne=we[J];"production"!==U.env.NODE_ENV&&void 0===Q[ne]&&(0,W.default)('No reducer provided for key "'+ne+'"'),"function"==typeof Q[ne]&&(Ae[ne]=Q[ne])}var Me=Object.keys(Ae),Be=void 0;"production"!==U.env.NODE_ENV&&(Be={});var He=void 0;try{!function Te(Q){Object.keys(Q).forEach(function(we){var Ae=Q[we];if(void 0===Ae(void 0,{type:Y.ActionTypes.INIT}))throw new Error('Reducer "'+we+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===Ae(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+we+"\" returned undefined when probed with a random type. Don't try to handle "+Y.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(Ae)}catch(rt){He=rt}return function(){var mt=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Pt=arguments[1];if(He)throw He;if("production"!==U.env.NODE_ENV){var gt=ue(mt,Ae,Pt,Be);gt&&(0,W.default)(gt)}for(var Et=!1,Ot={},ut=0;ut<Me.length;ut++){var it=Me[ut],wn=mt[it],sn=(0,Ae[it])(wn,Pt);if(void 0===sn){var On=ce(it,Pt);throw new Error(On)}Ot[it]=sn,Et=Et||sn!==wn}return Et?Ot:mt}};var Y=xe("./createStore"),$=me(xe("lodash/isPlainObject")),W=me(xe("./utils/warning"));function me(Q){return Q&&Q.__esModule?Q:{default:Q}}function ce(Q,we){var Ae=we&&we.type;return"Given action "+(Ae&&'"'+Ae.toString()+'"'||"an action")+', reducer "'+Q+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function ue(Q,we,Ae,J){var ne=Object.keys(we),Me=Ae&&Ae.type===Y.ActionTypes.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(0===ne.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!(0,$.default)(Q))return"The "+Me+' has unexpected type of "'+{}.toString.call(Q).match(/\s([a-z|A-Z]+)/)[1]+'". Expected argument to be an object with the following keys: "'+ne.join('", "')+'"';var Be=Object.keys(Q).filter(function(He){return!we.hasOwnProperty(He)&&!J[He]});return Be.forEach(function(He){J[He]=!0}),Be.length>0?"Unexpected "+(Be.length>1?"keys":"key")+' "'+Be.join('", "')+'" found in '+Me+'. Expected to find one of the known reducer keys instead: "'+ne.join('", "')+'". Unexpected keys will be ignored.':void 0}}).call(this,xe("_process"))},{"./createStore":27,"./utils/warning":29,_process:21,"lodash/isPlainObject":20}],26:[function(xe,de,h){"use strict";h.__esModule=!0,h.default=function U(){for(var Y=arguments.length,re=Array(Y),$=0;$<Y;$++)re[$]=arguments[$];return 0===re.length?function(K){return K}:1===re.length?re[0]:re.reduce(function(K,W){return function(){return K(W.apply(void 0,arguments))}})}},{}],27:[function(xe,de,h){"use strict";h.__esModule=!0,h.ActionTypes=void 0,h.default=function me(ce,ue,Te){var Ne;if("function"==typeof ue&&void 0===Te&&(Te=ue,ue=void 0),void 0!==Te){if("function"!=typeof Te)throw new Error("Expected the enhancer to be a function.");return Te(me)(ce,ue)}if("function"!=typeof ce)throw new Error("Expected the reducer to be a function.");var Q=ce,we=ue,Ae=[],J=Ae,ne=!1;function Me(){J===Ae&&(J=Ae.slice())}function Be(){return we}function He(gt){if("function"!=typeof gt)throw new Error("Expected listener to be a function.");var Et=!0;return Me(),J.push(gt),function(){if(Et){Et=!1,Me();var ut=J.indexOf(gt);J.splice(ut,1)}}}function rt(gt){if(!(0,Y.default)(gt))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===gt.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(ne)throw new Error("Reducers may not dispatch actions.");try{ne=!0,we=Q(we,gt)}finally{ne=!1}for(var Et=Ae=J,Ot=0;Ot<Et.length;Ot++)(0,Et[Ot])();return gt}return rt({type:W.INIT}),(Ne={dispatch:rt,subscribe:He,getState:Be,replaceReducer:function mt(gt){if("function"!=typeof gt)throw new Error("Expected the nextReducer to be a function.");Q=gt,rt({type:W.INIT})}})[$.default]=function Pt(){var gt,Et=He;return(gt={subscribe:function(ut){if("object"!=typeof ut)throw new TypeError("Expected the observer to be an object.");function it(){ut.next&&ut.next(Be())}return it(),{unsubscribe:Et(it)}}})[$.default]=function(){return this},gt},Ne};var Y=K(xe("lodash/isPlainObject")),$=K(xe("symbol-observable"));function K(ce){return ce&&ce.__esModule?ce:{default:ce}}var W=h.ActionTypes={INIT:"@@redux/INIT"}},{"lodash/isPlainObject":20,"symbol-observable":33}],28:[function(xe,de,h){(function(U){"use strict";h.__esModule=!0,h.compose=h.applyMiddleware=h.bindActionCreators=h.combineReducers=h.createStore=void 0;var re=Ae(xe("./createStore")),K=Ae(xe("./combineReducers")),me=Ae(xe("./bindActionCreators")),ue=Ae(xe("./applyMiddleware")),Ne=Ae(xe("./compose")),we=Ae(xe("./utils/warning"));function Ae(ne){return ne&&ne.__esModule?ne:{default:ne}}function J(){}"production"!==U.env.NODE_ENV&&"string"==typeof J.name&&"isCrushed"!==J.name&&(0,we.default)("You are currently using minified code outside of NODE_ENV === 'production'. This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) to ensure you have the correct code for your production build."),h.createStore=re.default,h.combineReducers=K.default,h.bindActionCreators=me.default,h.applyMiddleware=ue.default,h.compose=Ne.default}).call(this,xe("_process"))},{"./applyMiddleware":23,"./bindActionCreators":24,"./combineReducers":25,"./compose":26,"./createStore":27,"./utils/warning":29,_process:21}],29:[function(xe,de,h){"use strict";h.__esModule=!0,h.default=function U(Y){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(Y);try{throw new Error(Y)}catch(re){}}},{}],30:[function(xe,de,h){"use strict";var U=xe("./src/suggestions");window.Suggestions=de.exports=U},{"./src/suggestions":32}],31:[function(xe,de,h){var U=function(Y){return this.component=Y,this.items=[],this.active=0,this.element=document.createElement("ul"),this.element.className="suggestions",this.selectingListItem=!1,Y.el.parentNode.insertBefore(this.element,Y.el.nextSibling),this};U.prototype.show=function(){this.element.style.display="block"},U.prototype.hide=function(){this.element.style.display="none"},U.prototype.add=function(Y){this.items.push(Y)},U.prototype.clear=function(){this.items=[],this.active=0},U.prototype.isEmpty=function(){return!this.items.length},U.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var Y=0;Y<this.items.length;Y++)this.drawItem(this.items[Y],this.active===Y);this.show()}else this.hide()},U.prototype.drawItem=function(Y,re){var $=document.createElement("li"),K=document.createElement("a");re&&($.className+=" active"),K.innerHTML=Y.string,$.appendChild(K),this.element.appendChild($),$.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),$.addEventListener("mouseup",function(){this.handleMouseUp.call(this,Y)}.bind(this))},U.prototype.handleMouseUp=function(Y){this.selectingListItem=!1,this.component.value(Y.original),this.clear(),this.draw()},U.prototype.move=function(Y){this.active=Y,this.draw()},U.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},U.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},de.exports=U},{}],32:[function(xe,de,h){"use strict";var U=xe("xtend"),Y=xe("fuzzy"),re=xe("./list"),$=function(K,W,me){return this.options=U({minLength:2,limit:5,filter:!0},me=me||{}),this.el=K,this.data=W||[],this.list=new re(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(ce){this.handleKeyUp(ce.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(ce){this.handleKeyDown(ce)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(ce){this.handlePaste(ce)}.bind(this)),this};$.prototype.handleKeyUp=function(K){40===K||38===K||27===K||13===K||9===K||this.handleInputChange(this.el.value)},$.prototype.handleKeyDown=function(K){switch(K.keyCode){case 13:case 9:K.preventDefault(),this.list.isEmpty()||(this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},$.prototype.handleBlur=function(){this.list.selectingListItem||this.list.hide()},$.prototype.handlePaste=function(K){if(K.clipboardData)this.handleInputChange(K.clipboardData.getData("Text"));else{var W=this;setTimeout(function(){W.handleInputChange(K.target.value)},100)}},$.prototype.handleInputChange=function(K){this.query=this.normalize(K),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(W){for(var me=0;me<W.length&&(this.list.add(W[me]),me!==this.options.limit-1);me++);this.list.draw()}.bind(this))},$.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},$.prototype.update=function(K){this.data=K,this.handleKeyUp()},$.prototype.clear=function(){this.data=[],this.list.clear()},$.prototype.normalize=function(K){return K.toLowerCase()},$.prototype.match=function(K,W){return K.indexOf(W)>-1},$.prototype.value=function(K){if(this.selected=K,this.el.value=this.getItemValue(K),document.createEvent){var W=document.createEvent("HTMLEvents");W.initEvent("change",!0,!1),this.el.dispatchEvent(W)}else this.el.fireEvent("onchange")},$.prototype.getCandidates=function(K){var W={pre:"<strong>",post:"</strong>",extract:function(ce){return this.getItemValue(ce)}.bind(this)};K(this.options.filter?Y.filter(this.query,this.data,W):this.data.map(function(ce){for(var ue=this.getItemValue(ce),Te=this.normalize(ue),Ne=Te.lastIndexOf(this.query);Ne>-1;){var Q=Ne+this.query.length;ue=ue.slice(0,Ne)+"<strong>"+ue.slice(Ne,Q)+"</strong>"+ue.slice(Q),Ne=Te.slice(0,Ne).lastIndexOf(this.query)}return{original:ce,string:ue}}.bind(this)))},$.prototype.getItemValue=function(K){return K},de.exports=$},{"./list":31,fuzzy:4,xtend:37}],33:[function(xe,de,h){(function(U){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var K,re=function $(me){return me&&me.__esModule?me:{default:me}}(xe("./ponyfill.js"));K="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==U?U:void 0!==de?de:Function("return this")();var W=(0,re.default)(K);h.default=W}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ponyfill.js":34}],34:[function(xe,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.default=function U(Y){var re,$=Y.Symbol;return"function"==typeof $?$.observable?re=$.observable:(re=$("observable"),$.observable=re):re="@@observable",re}},{}],35:[function(xe,de,h){var U=xe("turf-meta").coordEach;de.exports=function(Y){var re=[1/0,1/0,-1/0,-1/0];return U(Y,function($){re[0]>$[0]&&(re[0]=$[0]),re[1]>$[1]&&(re[1]=$[1]),re[2]<$[0]&&(re[2]=$[0]),re[3]<$[1]&&(re[3]=$[1])}),re}},{"turf-meta":36}],36:[function(xe,de,h){function U(K,W,me){var ce,ue,Te,Ne,Q,we,Ae,J,Me,ne=0,Be="FeatureCollection"===K.type,He="Feature"===K.type,rt=Be?K.features.length:1;for(ce=0;ce<rt;ce++)for(we=(Me="GeometryCollection"===(J=Be?K.features[ce].geometry:He?K.geometry:K).type)?J.geometries.length:1,Ne=0;Ne<we;Ne++)if(Ae=(Q=Me?J.geometries[Ne]:J).coordinates,ne=!me||"Polygon"!==Q.type&&"MultiPolygon"!==Q.type?0:1,"Point"===Q.type)W(Ae);else if("LineString"===Q.type||"MultiPoint"===Q.type)for(ue=0;ue<Ae.length;ue++)W(Ae[ue]);else if("Polygon"===Q.type||"MultiLineString"===Q.type)for(ue=0;ue<Ae.length;ue++)for(Te=0;Te<Ae[ue].length-ne;Te++)W(Ae[ue][Te]);else{if("MultiPolygon"!==Q.type)throw new Error("Unknown Geometry Type");for(ue=0;ue<Ae.length;ue++)for(Te=0;Te<Ae[ue].length;Te++)for(l=0;l<Ae[ue][Te].length-ne;l++)W(Ae[ue][Te][l])}}function re(K,W){var me;switch(K.type){case"FeatureCollection":for(features=K.features,me=0;me<K.features.length;me++)W(K.features[me].properties);break;case"Feature":W(K.properties)}}de.exports.coordEach=U,de.exports.coordReduce=function Y(K,W,me,ce){return U(K,function(ue){me=W(me,ue)},ce),me},de.exports.propEach=re,de.exports.propReduce=function $(K,W,me){return re(K,function(ce){me=W(me,ce)}),me}},{}],37:[function(xe,de,h){de.exports=function Y(){for(var re={},$=0;$<arguments.length;$++){var K=arguments[$];for(var W in K)U.call(K,W)&&(re[W]=K[W])}return re};var U=Object.prototype.hasOwnProperty},{}],38:[function(xe,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.queryOrigin=function Me(nt){return{type:Y.ORIGIN_QUERY,query:nt}},h.queryDestination=function Be(nt){return{type:Y.DESTINATION_QUERY,query:nt}},h.queryOriginCoordinates=He,h.queryDestinationCoordinates=rt,h.clearOrigin=function mt(){return function(nt){nt({type:Y.ORIGIN_CLEAR}),nt(Pn("clear",{type:"origin"})),nt(ne(null))}},h.clearDestination=function Pt(){return function(nt){nt({type:Y.DESTINATION_CLEAR}),nt(Pn("clear",{type:"destination"})),nt(ne(null))}},h.setOptions=function gt(nt){return{type:Y.SET_OPTIONS,options:nt}},h.hoverMarker=function Et(nt){return function(Tt){Tt(function Q(nt){return{type:Y.HOVER_MARKER,hoverMarker:nt}}(nt?$.default.createPoint(nt,{id:"hover"}):{}))}},h.setRouteIndex=Ot,h.createOrigin=ut,h.createDestination=it,h.setProfile=function cn(nt){return function(Tt,$t){var fn=$t(),bt=fn.origin,kn=fn.destination;Tt({type:Y.DIRECTIONS_PROFILE,profile:nt}),Tt(Pn("profile",{profile:nt})),bt.geometry&&kn.geometry&&Tt(we())}},h.reverse=function wn(){return function(nt,Tt){var $t=Tt();$t.destination.geometry&&nt(ce($t.destination.geometry.coordinates)),$t.origin.geometry&&nt(ue($t.origin.geometry.coordinates)),$t.origin.geometry&&$t.destination.geometry&&nt(we());for(var fn=document.getElementsByClassName("suggestions"),bt=0;bt<fn.length;bt++)fn[bt].style.visibility="hidden"}},h.setOriginFromCoordinates=function sn(nt){return function(Tt){if($.default.validCoords(nt)||(nt=[$.default.wrap(nt[0]),$.default.wrap(nt[1])]),isNaN(nt[0])&&isNaN(nt[1]))return Tt(ne(new Error("Coordinates are not valid")));Tt(He(nt)),Tt(ut(nt))}},h.setDestinationFromCoordinates=function On(nt){return function(Tt){if($.default.validCoords(nt)||(nt=[$.default.wrap(nt[0]),$.default.wrap(nt[1])]),isNaN(nt[0])&&isNaN(nt[1]))return Tt(ne(new Error("Coordinates are not valid")));Tt(it(nt)),Tt(rt(nt))}},h.addWaypoint=function un(nt,Tt){return function($t,fn){var bt=fn(),kn=bt.destination,Gr=bt.waypoints;Gr.splice(nt,0,J(Tt)),$t(Ne(Gr)),kn.geometry&&$t(we())}},h.setWaypoint=function Nn(nt,Tt){return function($t,fn){var bt=fn(),kn=bt.destination,Gr=bt.waypoints;Gr[nt]=J(Tt),$t(Ne(Gr)),kn.geometry&&$t(we())}},h.removeWaypoint=function ir(nt){return function(Tt,$t){var fn=$t(),bt=fn.destination,kn=fn.waypoints;Tt(Ne(kn=kn.filter(function(Gr){return!$.default.coordinateMatch(Gr,nt)}))),bt.geometry&&Tt(we())}},h.eventSubscribe=function kt(nt,Tt){return function($t,fn){var kn=fn().events;return kn[nt]=kn[nt]||[],kn[nt].push(Tt),{type:Y.EVENTS,events:kn}}},h.eventEmit=Pn;var Y=function W(nt){if(nt&&nt.__esModule)return nt;var Tt={};if(null!=nt)for(var $t in nt)Object.prototype.hasOwnProperty.call(nt,$t)&&(Tt[$t]=nt[$t]);return Tt.default=nt,Tt}(xe("../constants/action_types")),$=function K(nt){return nt&&nt.__esModule?nt:{default:nt}}(xe("../utils"));var me=new XMLHttpRequest;function ce(nt){return function(Tt){var $t=$.default.createPoint(nt,{id:"origin","marker-symbol":"A"});Tt({type:Y.ORIGIN,origin:$t}),Tt(Pn("origin",{feature:$t}))}}function ue(nt){return function(Tt){var $t=$.default.createPoint(nt,{id:"destination","marker-symbol":"B"});Tt({type:Y.DESTINATION,destination:$t}),Tt(Pn("destination",{feature:$t}))}}function Te(nt){return function(Tt){Tt({type:Y.DIRECTIONS,directions:nt}),Tt(Pn("route",{route:nt}))}}function Ne(nt){return{type:Y.WAYPOINTS,waypoints:nt}}function we(){return function(nt,Tt){var $t=Tt(),fn=$t.api,bt=$t.accessToken,kn=$t.routeIndex,Gr=$t.profile,ur=$t.alternatives,Qn=$t.congestion,yn=$t.destination,hr=$t.language,jn=$t.exclude;if(yn&&yn.geometry){var Ai=function Ae(nt){var Tt=nt(),fn=Tt.destination,bt=Tt.waypoints,kn=[];return kn.push(Tt.origin.geometry.coordinates.join(",")),kn.push(";"),bt.length&&bt.forEach(function(Gr){kn.push(Gr.geometry.coordinates.join(",")),kn.push(";")}),kn.push(fn.geometry.coordinates.join(",")),encodeURIComponent(kn.join(""))}(Tt),qr=[];qr.push("geometries=polyline"),ur&&qr.push("alternatives=true"),Qn&&qr.push("annotations=congestion"),qr.push("steps=true"),qr.push("overview=full"),hr&&qr.push("language="+hr),jn&&qr.push("exclude="+jn),bt&&qr.push("access_token="+bt),me.abort(),me.open("GET",""+fn+Gr+"/"+Ai+".json?"+qr.join("&"),!0),me.onload=function(){if(!(me.status>=200&&me.status<400))return nt(Te([])),nt(ne(JSON.parse(me.responseText).message));var zi=JSON.parse(me.responseText);if(zi.error)return nt(Te([])),nt(ne(zi.error));nt(ne(null)),zi.routes[kn]||nt(Ot(0)),nt(Te(zi.routes)),nt(ce(zi.waypoints[0].location)),nt(ue(zi.waypoints[zi.waypoints.length-1].location))},me.onerror=function(){return nt(Te([])),nt(ne(JSON.parse(me.responseText).message))},me.send()}}}function J(nt){var Tt={id:"waypoint"};return Object.assign(nt,{properties:nt.properties?Object.assign(nt.properties,Tt):Tt})}function ne(nt){return function(Tt){Tt({type:"ERROR",error:nt}),nt&&Tt(Pn("error",{error:nt}))}}function He(nt){return{type:Y.ORIGIN_FROM_COORDINATES,coordinates:nt}}function rt(nt){return{type:Y.DESTINATION_FROM_COORDINATES,coordinates:nt}}function Ot(nt){return{type:Y.ROUTE_INDEX,routeIndex:nt}}function ut(nt){return function(Tt,$t){var bt=$t().destination;Tt(ce(nt)),bt.geometry&&Tt(we())}}function it(nt){return function(Tt,$t){var bt=$t().origin;Tt(ue(nt)),bt.geometry&&Tt(we())}}function Pn(nt,Tt){var $t=this;return function(fn,bt){var Gr=bt().events;if(!Gr[nt])return{type:Y.EVENTS,events:Gr};for(var ur=Gr[nt].slice(),Qn=0;Qn<ur.length;Qn++)ur[Qn].call($t,Tt)}}},{"../constants/action_types":39,"../utils":47}],39:[function(xe,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.DESTINATION="DESTINATION",h.DESTINATION_CLEAR="DESTINATION_CLEAR",h.DESTINATION_QUERY="DESTINATION_QUERY",h.DESTINATION_FROM_COORDINATES="DESTINATION_FROM_COORDINATES",h.DIRECTIONS="DIRECTIONS",h.DIRECTIONS_PROFILE="DIRECTIONS_PROFILE",h.EVENTS="EVENTS",h.ERROR="ERROR",h.HOVER_MARKER="HOVER_MARKER",h.ORIGIN="ORIGIN",h.ORIGIN_CLEAR="ORIGIN_CLEAR",h.ORIGIN_QUERY="ORIGIN_QUERY",h.ORIGIN_FROM_COORDINATES="ORIGIN_FROM_COORDINATES",h.ROUTE_INDEX="ROUTE_INDEX",h.SET_OPTIONS="SET_OPTIONS",h.WAYPOINTS="WAYPOINTS"},{}],40:[function(xe,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(we){return typeof we}:function(we){return we&&"function"==typeof Symbol&&we.constructor===Symbol&&we!==Symbol.prototype?"symbol":typeof we},Y=function(){function we(Ae,J){for(var ne=0;ne<J.length;ne++){var Me=J[ne];Me.enumerable=Me.enumerable||!1,Me.configurable=!0,"value"in Me&&(Me.writable=!0),Object.defineProperty(Ae,Me.key,Me)}}return function(Ae,J,ne){return J&&we(Ae.prototype,J),ne&&we(Ae,ne),Ae}}(),$=Te(xe("suggestions")),W=Te(xe("lodash.debounce")),me=xe("events"),ue=Te(xe("../utils"));function Te(we){return we&&we.__esModule?we:{default:we}}var Q=function(){function we(Ae){(function Ne(we,Ae){if(!(we instanceof Ae))throw new TypeError("Cannot call a class as a function")})(this,we),this._ev=new me.EventEmitter,this.options=Ae,this.api=Ae&&Ae.api||"https://api.mapbox.com/geocoding/v5/mapbox.places/"}return Y(we,[{key:"onAdd",value:function(J){this._map=J,this.request=new XMLHttpRequest;var ne=document.createElement("div");ne.className="mapboxgl-ctrl-geocoder";var Me=document.createElement("span");Me.className="geocoder-icon geocoder-icon-search";var Be=this._inputEl=document.createElement("input");Be.type="text",Be.placeholder=this.options.placeholder,Be.addEventListener("keydown",(0,W.default)(function(Pt){if(!Pt.target.value)return this._clearEl.classList.remove("active");Pt.metaKey||-1!==[9,27,37,39,13,38,40].indexOf(Pt.keyCode)||this._queryFromInput(Pt.target.value)}.bind(this)),200),Be.addEventListener("change",function(Pt){Pt.target.value&&this._clearEl.classList.add("active");var gt=this._typeahead.selected;if(gt){if(this.options.flyTo)if(gt.bbox&&gt.context&&gt.context.length<=3||gt.bbox&&!gt.context){var Et=gt.bbox;J.fitBounds([[Et[0],Et[1]],[Et[2],Et[3]]])}else J.flyTo({center:gt.center,zoom:this.options.zoom});this._input=gt,this.fire("result",{result:gt})}}.bind(this));var He=document.createElement("div");He.classList.add("geocoder-pin-right");var rt=this._clearEl=document.createElement("button");rt.className="geocoder-icon geocoder-icon-close",rt.addEventListener("click",this._clear.bind(this));var mt=this._loadingEl=document.createElement("span");return mt.className="geocoder-icon geocoder-icon-loading",He.appendChild(rt),He.appendChild(mt),ne.appendChild(Me),ne.appendChild(Be),ne.appendChild(He),this.options.container&&(this.options.position=!1),this._typeahead=new $.default(Be,[],{filter:!1}),this._typeahead.getItemValue=function(Pt){return Pt.place_name},ne}},{key:"_geocode",value:function(J,ne){this._loadingEl.classList.add("active"),this.fire("loading");var Me=this.options,Be=["placeholder","zoom","flyTo","accessToken"],He=Object.keys(this.options).filter(function(mt){return-1===Be.indexOf(mt)}).map(function(mt){return mt+"="+Me[mt]}),rt=this.options.accessToken?this.options.accessToken:mapboxgl.accessToken;He.push("access_token="+rt),this.request.abort(),this.request.open("GET",this.api+encodeURIComponent(J.trim())+".json?"+He.join("&"),!0),this.request.onload=function(){if(this._loadingEl.classList.remove("active"),this.request.status>=200&&this.request.status<400){var mt=JSON.parse(this.request.responseText);return mt.features.length?this._clearEl.classList.add("active"):(this._clearEl.classList.remove("active"),this._typeahead.selected=null),this.fire("results",{results:mt.features}),this._typeahead.update(mt.features),ne(mt.features)}this.fire("error",{error:JSON.parse(this.request.responseText).message})}.bind(this),this.request.onerror=function(){this._loadingEl.classList.remove("active"),this.fire("error",{error:JSON.parse(this.request.responseText).message})}.bind(this),this.request.send()}},{key:"_queryFromInput",value:function(J){(J=J.trim())||this._clear(),J.length>2&&this._geocode(J,function(ne){this._results=ne}.bind(this))}},{key:"_change",value:function(){var J=document.createEvent("HTMLEvents");J.initEvent("change",!0,!1),this._inputEl.dispatchEvent(J)}},{key:"_query",value:function(J){!J||("object"===(void 0===J?"undefined":U(J))&&J.length&&(J=[ue.default.wrap(J[0]),ue.default.wrap(J[1])].join()),this._geocode(J,function(ne){if(ne.length){var Me=ne[0];this._results=ne,this._typeahead.selected=Me,this._inputEl.value=Me.place_name,this._change()}}.bind(this)))}},{key:"_setInput",value:function(J){!J||("object"===(void 0===J?"undefined":U(J))&&J.length&&(J=[ue.default.roundWithOriginalPrecision(ue.default.wrap(J[0]),J[0]),ue.default.roundWithOriginalPrecision(ue.default.wrap(J[1]),J[1])].join()),this._inputEl.value=J,this._input=null,this._typeahead.selected=null,this._typeahead.clear(),this._change())}},{key:"_clear",value:function(){this._input=null,this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._change(),this._inputEl.focus(),this._clearEl.classList.remove("active"),this.fire("clear")}},{key:"getResult",value:function(){return this._input}},{key:"query",value:function(J){return this._query(J),this}},{key:"setInput",value:function(J){return this._setInput(J),this}},{key:"on",value:function(J,ne){return this._ev.on(J,ne),this._ev.on("error",function(Me){console.log(Me)}),this}},{key:"fire",value:function(J,ne){return this._ev.emit(J,ne),this}},{key:"off",value:function(J,ne){return this._ev.removeListener(J,ne),this}}]),we}();h.default=Q},{"../utils":47,events:3,"lodash.debounce":7,suggestions:30}],41:[function(xe,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var U=function(){function Ae(J,ne){for(var Me=0;Me<ne.length;Me++){var Be=ne[Me];Be.enumerable=Be.enumerable||!1,Be.configurable=!0,"value"in Be&&(Be.writable=!0),Object.defineProperty(J,Be.key,Be)}}return function(J,ne,Me){return ne&&Ae(J.prototype,ne),Me&&Ae(J,Me),J}}(),re=Te(xe("./geocoder")),K=Te(xe("lodash.template")),me=Te(xe("lodash.isequal")),ue=Te(xe("turf-extent"));function Te(Ae){return Ae&&Ae.__esModule?Ae:{default:Ae}}var Q=(0,K.default)("<div class='mapbox-directions-component mapbox-directions-inputs'>\n  <div class='mapbox-directions-component-keyline'>\n    <div class='mapbox-directions-origin'>\n      <label class='mapbox-form-label'>\n        <span class='directions-icon directions-icon-depart'></span>\n      </label>\n      <div id='mapbox-directions-origin-input'></div>\n    </div>\n\n    <button\n      class='directions-icon directions-icon-reverse directions-reverse js-reverse-inputs'\n      title='Reverse origin &amp; destination'>\n    </button>\n\n    <div class='mapbox-directions-destination'>\n      <label class='mapbox-form-label'>\n        <span class='directions-icon directions-icon-arrive'></span>\n      </label>\n      <div id='mapbox-directions-destination-input'></div>\n    </div>\n  </div>\n\n  <% if (controls.profileSwitcher) { %>\n  <div class='mapbox-directions-profile mapbox-directions-component-keyline mapbox-directions-clearfix'><input\n      id='mapbox-directions-profile-driving-traffic'\n      type='radio'\n      name='profile'\n      value='mapbox/driving-traffic'\n      <% if (profile === 'mapbox/driving-traffic') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-driving-traffic'>Traffic</label>\n    <input\n      id='mapbox-directions-profile-driving'\n      type='radio'\n      name='profile'\n      value='mapbox/driving'\n      <% if (profile === 'mapbox/driving') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-driving'>Driving</label>\n    <input\n      id='mapbox-directions-profile-walking'\n      type='radio'\n      name='profile'\n      value='mapbox/walking'\n      <% if (profile === 'mapbox/walking') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-walking'>Walking</label>\n    <input\n      id='mapbox-directions-profile-cycling'\n      type='radio'\n      name='profile'\n      value='mapbox/cycling'\n      <% if (profile === 'mapbox/cycling') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-cycling'>Cycling</label>\n  </div>\n  <% } %>\n</div>\n"),we=function(){function Ae(J,ne,Me,Be){!function Ne(Ae,J){if(!(Ae instanceof J))throw new TypeError("Cannot call a class as a function")}(this,Ae);var He=ne.getState();J.innerHTML=Q({originQuery:He.originQuery,destinationQuery:He.destinationQuery,profile:He.profile,controls:He.controls}),this.container=J,this.actions=Me,this.store=ne,this._map=Be,this.onAdd(),this.render()}return U(Ae,[{key:"animateToCoordinates",value:function(ne,Me){var Be=this.store.getState(),He=Be.origin,rt=Be.destination,mt=Be.routePadding;if(He.geometry&&rt.geometry&&!(0,me.default)(He.geometry,rt.geometry)){var Pt=(0,ue.default)({type:"FeatureCollection",features:[He,rt]});this._map.fitBounds([[Pt[0],Pt[1]],[Pt[2],Pt[3]]],{padding:mt})}else this._map.flyTo({center:Me})}},{key:"onAdd",value:function(){var ne=this,Me=this.actions,Be=Me.clearOrigin,He=Me.clearDestination,rt=Me.createOrigin,mt=Me.createDestination,Pt=Me.setProfile,gt=Me.reverse,Et=this.store.getState(),Ot=Et.geocoder,ut=Et.accessToken,it=Et.flyTo,wn=Et.placeholderDestination,sn=Et.zoom;this.originInput=new re.default(Object.assign({},{accessToken:ut},Ot,{flyTo:it,placeholder:Et.placeholderOrigin,zoom:sn}));var On=this.originInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-origin-input").appendChild(On),this.destinationInput=new re.default(Object.assign({},{accessToken:ut},Ot,{flyTo:it,placeholder:wn,zoom:sn}));var Nn=this.destinationInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-destination-input").appendChild(Nn),this.originInput.on("result",function(kt){var Pn=kt.result.center;rt(Pn),ne.animateToCoordinates("origin",Pn)}),this.originInput.on("clear",Be),this.destinationInput.on("result",function(kt){var Pn=kt.result.center;mt(Pn),ne.animateToCoordinates("destination",Pn)}),this.destinationInput.on("clear",He);var ir=this.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(ir,function(kt){kt.addEventListener("change",function(){Pt(kt.value)})}),this.container.querySelector(".js-reverse-inputs").addEventListener("click",function(){var kt=ne.store.getState(),Pn=kt.origin,nt=kt.destination;Pn&&ne.actions.queryDestination(Pn.geometry.coordinates),nt&&ne.actions.queryOrigin(nt.geometry.coordinates),gt()})}},{key:"render",value:function(){var ne=this;this.store.subscribe(function(){var Me=ne.store.getState(),Be=Me.originQuery,He=Me.destinationQuery,rt=Me.originQueryCoordinates,mt=Me.destinationQueryCoordinates;Be&&(ne.originInput.query(Be),ne.actions.queryOrigin(null)),He&&(ne.destinationInput.query(He),ne.actions.queryDestination(null)),rt&&(ne.originInput.setInput(rt),ne.animateToCoordinates("origin",rt),ne.actions.queryOriginCoordinates(null)),mt&&(ne.destinationInput.setInput(mt),ne.animateToCoordinates("destination",mt),ne.actions.queryDestinationCoordinates(null))})}}]),Ae}();h.default=we},{"./geocoder":40,"lodash.isequal":8,"lodash.template":9,"turf-extent":35}],42:[function(xe,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var U=function(){function we(Ae,J){for(var ne=0;ne<J.length;ne++){var Me=J[ne];Me.enumerable=Me.enumerable||!1,Me.configurable=!0,"value"in Me&&(Me.writable=!0),Object.defineProperty(Ae,Me.key,Me)}}return function(Ae,J,ne){return J&&we(Ae.prototype,J),ne&&we(Ae,ne),Ae}}(),re=ce(xe("../utils")),K=ce(xe("lodash.template")),me=ce(xe("lodash.isequal"));function ce(we){return we&&we.__esModule?we:{default:we}}var Te=(0,K.default)("<div class='directions-control directions-control-directions'>\n  <div class='mapbox-directions-component mapbox-directions-route-summary<% if (routes > 1) { %> mapbox-directions-multiple<% } %>'>\n    <% if (routes > 1) { %>\n    <div class='mapbox-directions-routes mapbox-directions-clearfix'>\n      <% for (var i = 0; i < routes; i++) { %>\n        <input type='radio' name='routes' id='<%= i %>' <% if (i === routeIndex) { %>checked<% } %>>\n        <label for='<%= i %>' class='mapbox-directions-route'><%= i + 1 %></label>\n      <% } %>\n    </div>\n    <% } %>\n    <h1><%- duration %></h1>\n    <span><%- distance %></span>\n  </div>\n\n  <div class='mapbox-directions-instructions'>\n    <div class='mapbox-directions-instructions-wrapper'>\n      <ol class='mapbox-directions-steps'>\n        <% steps.forEach(function(step) { %>\n          <%\n            var distance = step.distance ? format(step.distance) : false;\n            var icon = step.maneuver.modifier ? step.maneuver.modifier.replace(/\\s+/g, '-').toLowerCase() : step.maneuver.type.replace(/\\s+/g, '-').toLowerCase();\n\n            if (step.maneuver.type === 'arrive' || step.maneuver.type === 'depart') {\n              icon = step.maneuver.type;\n            }\n\n            if (step.maneuver.type === 'roundabout' || step.maneuver.type === 'rotary') {\n              icon= 'roundabout';\n            }\n\n            var lng = step.maneuver.location[0];\n            var lat = step.maneuver.location[1];\n          %>\n          <li\n            data-lat='<%= lat %>'\n            data-lng='<%= lng %>'\n            class='mapbox-directions-step'>\n            <span class='directions-icon directions-icon-<%= icon %>'></span>\n            <div class='mapbox-directions-step-maneuver'>\n              <%= step.maneuver.instruction %>\n            </div>\n            <% if (distance) { %>\n              <div class='mapbox-directions-step-distance'>\n                <%= distance %>\n              </div>\n            <% } %>\n          </li>\n        <% }); %>\n      </ol>\n    </div>\n  </div>\n</div>\n"),Ne=(0,K.default)("<div class='directions-control directions-control-directions'>\n  <div class='mapbox-directions-error'>\n    <%= error %>\n  </div>\n</div>\n"),Q=function(){function we(Ae,J,ne,Me){(function ue(we,Ae){if(!(we instanceof Ae))throw new TypeError("Cannot call a class as a function")})(this,we),this.container=Ae,this.actions=ne,this.store=J,this._map=Me,this.directions={},this.render()}return U(we,[{key:"render",value:function(){var J=this;this.store.subscribe(function(){var ne=J.actions,Me=ne.hoverMarker,Be=ne.setRouteIndex,He=J.store.getState(),rt=He.routeIndex,mt=He.unit,Pt=He.directions,gt=He.error,Et=He.compile,Ot=!(0,me.default)(Pt[rt],J.directions);if(gt)J.container.innerHTML=Ne({error:gt});else if(Pt.length&&Ot){var ut=J.directions=Pt[rt];Et&&ut.legs.forEach(function(wn){wn.steps.forEach(function(sn){sn.maneuver.instruction=Et("en",sn)})}),J.container.innerHTML=Te({routeIndex:rt,routes:Pt.length,steps:ut.legs[0].steps,format:re.default.format[mt],duration:re.default.format[mt](ut.distance),distance:re.default.format.duration(ut.duration)});var it=J.container.querySelectorAll(".mapbox-directions-step");Array.prototype.forEach.call(it,function(wn){var sn=wn.getAttribute("data-lng"),On=wn.getAttribute("data-lat");wn.addEventListener("mouseover",function(){Me([sn,On])}),wn.addEventListener("mouseout",function(){Me(null)}),wn.addEventListener("click",function(){J._map.flyTo({center:[sn,On],zoom:16})})});var cn=J.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(cn,function(wn){wn.addEventListener("change",function(sn){Be(parseInt(sn.target.id,10))})})}else J.container.innerHTML&&Ot&&(J.container.innerHTML="")})}}]),we}();h.default=Q},{"../utils":47,"lodash.isequal":8,"lodash.template":9}],43:[function(xe,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var U=function(){function Et(Ot,ut){for(var it=0;it<ut.length;it++){var cn=ut[it];cn.enumerable=cn.enumerable||!1,cn.configurable=!0,"value"in cn&&(cn.writable=!0),Object.defineProperty(Ot,cn.key,cn)}}return function(Ot,ut,it){return ut&&Et(Ot.prototype,ut),it&&Et(Ot,it),Ot}}(),Y=xe("redux"),$=He(xe("redux-thunk")),K=xe("@mapbox/polyline"),me=He(xe("./utils")),ue=He(xe("./reducers")),Ne=function Be(Et){if(Et&&Et.__esModule)return Et;var Ot={};if(null!=Et)for(var ut in Et)Object.prototype.hasOwnProperty.call(Et,ut)&&(Ot[ut]=Et[ut]);return Ot.default=Et,Ot}(xe("./actions")),we=He(xe("./directions_style")),J=He(xe("./controls/inputs")),Me=He(xe("./controls/instructions"));function He(Et){return Et&&Et.__esModule?Et:{default:Et}}var Pt=(0,Y.applyMiddleware)($.default)(Y.createStore)(ue.default),gt=function(){function Et(Ot){(function rt(Et,Ot){if(!(Et instanceof Ot))throw new TypeError("Cannot call a class as a function")})(this,Et),this.actions=(0,Y.bindActionCreators)(Ne,Pt.dispatch),this.actions.setOptions(Ot||{}),this.options=Ot||{},this.onDragDown=this._onDragDown.bind(this),this.onDragMove=this._onDragMove.bind(this),this.onDragUp=this._onDragUp.bind(this),this.move=this._move.bind(this),this.onClick=this._clickHandler().bind(this)}return U(Et,[{key:"onAdd",value:function(ut){var it=this;this._map=ut;var wn=Pt.getState().controls,sn=this.container=document.createElement("div");sn.className="mapboxgl-ctrl-directions mapboxgl-ctrl";var On=document.createElement("div");On.className="directions-control directions-control-inputs",new J.default(On,Pt,this.actions,this._map);var un=document.createElement("div");return un.className="directions-control directions-control-instructions",new Me.default(un,Pt,{hoverMarker:this.actions.hoverMarker,setRouteIndex:this.actions.setRouteIndex},this._map),wn.inputs&&sn.appendChild(On),wn.instructions&&sn.appendChild(un),this.subscribedActions(),this._map.loaded()?this.mapState():this._map.on("load",function(){return it.mapState()}),sn}},{key:"onRemove",value:function(ut){return this.container.parentNode.removeChild(this.container),this.removeRoutes(),ut.off("mousedown",this.onDragDown),ut.off("mousemove",this.move),ut.off("touchstart",this.onDragDown),ut.off("touchstart",this.move),ut.off("click",this.onClick),this.storeUnsubscribe&&(this.storeUnsubscribe(),delete this.storeUnsubscribe),we.default.forEach(function(it){ut.getLayer(it.id)&&ut.removeLayer(it.id)}),ut.getSource("directions")&&ut.removeSource("directions"),this._map=null,this}},{key:"mapState",value:function(){var ut=this,it=Pt.getState(),On=it.styles,un=it.interactive;this.actions.eventEmit("profile",{profile:it.profile}),this._map.addSource("directions",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),On&&On.length&&On.forEach(function(kt){return ut._map.addLayer(kt)}),we.default.forEach(function(kt){ut._map.getLayer(kt.id)||ut._map.addLayer(kt)}),un&&(this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick),this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown))}},{key:"subscribedActions",value:function(){var ut=this;this.storeUnsubscribe=Pt.subscribe(function(){var it=Pt.getState(),On=it.directions,un=it.routeIndex,Nn={type:"FeatureCollection",features:[it.origin,it.destination,it.hoverMarker].filter(function(ir){return ir.geometry})};On.length&&On.forEach(function(ir,kt){var Pn=[];(0,K.decode)(ir.geometry,5).map(function(Tt){return Tt.reverse()}).forEach(function(Tt,$t){var fn=Pn[Pn.length-1],bt=ir.legs[0].annotation&&ir.legs[0].annotation.congestion&&ir.legs[0].annotation.congestion[$t-1];if(!fn||bt&&fn.properties.congestion!==bt){var kn={geometry:{type:"LineString",coordinates:[]},properties:{"route-index":kt,route:kt===un?"selected":"alternate"}};fn&&kn.geometry.coordinates.push(fn.geometry.coordinates[fn.geometry.coordinates.length-1]),kn.geometry.coordinates.push(Tt),bt&&(kn.properties.congestion=ir.legs[0].annotation.congestion[$t-1]),Pn.push(kn)}else fn.geometry.coordinates.push(Tt)}),Nn.features=Nn.features.concat(Pn),kt===un&&ir.legs[0].steps.forEach(function(Tt){"waypoint"===Tt.maneuver.type&&Nn.features.push({type:"Feature",geometry:Tt.maneuver.location,properties:{id:"waypoint"}})})}),ut._map.style&&ut._map.getSource("directions")&&ut._map.getSource("directions").setData(Nn)})}},{key:"_clickHandler",value:function(){var ut=null;return function(cn){if(ut)clearTimeout(ut),ut=null,this._map.zoomIn();else{var wn=this._onSingleClick.bind(this);ut=setTimeout(function(){wn(cn),ut=null},250)}}}},{key:"_onSingleClick",value:function(ut){var it=this,cn=Pt.getState(),sn=[ut.lngLat.lng,ut.lngLat.lat];if(cn.origin.geometry){var On=this._map.queryRenderedFeatures(ut.point,{layers:["directions-origin-point","directions-destination-point","directions-waypoint-point","directions-route-line-alt"]});On.length?(On.forEach(function(Nn){"directions-waypoint-point"===Nn.layer.id&&it.actions.removeWaypoint(Nn)}),"alternate"===On[0].properties.route&&this.actions.setRouteIndex(On[0].properties["route-index"])):(this.actions.setDestinationFromCoordinates(sn),this._map.flyTo({center:sn}))}else this.actions.setOriginFromCoordinates(sn)}},{key:"_move",value:function(ut){var it=this,wn=Pt.getState().hoverMarker,sn=this._map.queryRenderedFeatures(ut.point,{layers:["directions-route-line-alt","directions-route-line","directions-origin-point","directions-destination-point","directions-hover-point"]});this._map.getCanvas().style.cursor=sn.length?"pointer":"",sn.length?(this.isCursorOverPoint=sn[0],this._map.dragPan.disable(),sn.forEach(function(On){"directions-route-line"===On.layer.id?it.actions.hoverMarker([ut.lngLat.lng,ut.lngLat.lat]):wn.geometry&&it.actions.hoverMarker(null)})):this.isCursorOverPoint&&(this.isCursorOverPoint=!1,this._map.dragPan.enable())}},{key:"_onDragDown",value:function(){!this.isCursorOverPoint||(this.isDragging=this.isCursorOverPoint,this._map.getCanvas().style.cursor="grab",this._map.on("mousemove",this.onDragMove),this._map.on("mouseup",this.onDragUp),this._map.on("touchmove",this.onDragMove),this._map.on("touchend",this.onDragUp))}},{key:"_onDragMove",value:function(ut){if(this.isDragging){var it=[ut.lngLat.lng,ut.lngLat.lat];switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.createOrigin(it);break;case"directions-destination-point":this.actions.createDestination(it);break;case"directions-hover-point":this.actions.hoverMarker(it)}}}},{key:"_onDragUp",value:function(){if(this.isDragging){var ut=Pt.getState(),it=ut.hoverMarker,cn=ut.origin,wn=ut.destination;switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.setOriginFromCoordinates(cn.geometry.coordinates);break;case"directions-destination-point":this.actions.setDestinationFromCoordinates(wn.geometry.coordinates);break;case"directions-hover-point":it.geometry&&!me.default.coordinateMatch(this.isDragging,it)&&this.actions.addWaypoint(0,it)}this.isDragging=!1,this._map.getCanvas().style.cursor="",this._map.off("touchmove",this.onDragMove),this._map.off("touchend",this.onDragUp),this._map.off("mousemove",this.onDragMove),this._map.off("mouseup",this.onDragUp)}}},{key:"interactive",value:function(ut){return ut?(this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown),this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick)):(this._map.off("touchstart",this.move),this._map.off("touchstart",this.onDragDown),this._map.off("mousedown",this.onDragDown),this._map.off("mousemove",this.move),this._map.off("click",this.onClick)),this}},{key:"getOrigin",value:function(){return Pt.getState().origin}},{key:"setOrigin",value:function(ut){return"string"==typeof ut?this.actions.queryOrigin(ut):this.actions.setOriginFromCoordinates(ut),this}},{key:"getDestination",value:function(){return Pt.getState().destination}},{key:"setDestination",value:function(ut){return"string"==typeof ut?this.actions.queryDestination(ut):this.actions.setDestinationFromCoordinates(ut),this}},{key:"reverse",value:function(){return this.actions.reverse(),this}},{key:"addWaypoint",value:function(ut,it){return it.type||(it=me.default.createPoint(it,{id:"waypoint"})),this.actions.addWaypoint(ut,it),this}},{key:"setWaypoint",value:function(ut,it){return it.type||(it=me.default.createPoint(it,{id:"waypoint"})),this.actions.setWaypoint(ut,it),this}},{key:"removeWaypoint",value:function(ut){var it=Pt.getState();return this.actions.removeWaypoint(it.waypoints[ut]),this}},{key:"getWaypoints",value:function(){return Pt.getState().waypoints}},{key:"removeRoutes",value:function(){return this.actions.clearOrigin(),this.actions.clearDestination(),this}},{key:"on",value:function(ut,it){return this.actions.eventSubscribe(ut,it),this}}]),Et}();h.default=gt},{"./actions":38,"./controls/inputs":41,"./controls/instructions":42,"./directions_style":44,"./reducers":46,"./utils":47,"@mapbox/polyline":1,redux:28,"redux-thunk":22}],44:[function(xe,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.default=[{id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#bbb","line-width":4},filter:["all",["in","$type","LineString"],["in","route","alternate"]]},{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":12},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":{property:"congestion",type:"categorical",default:"#4882c5",stops:[["unknown","#4882c5"],["low","#4882c5"],["moderate","#f09a46"],["heavy","#e34341"],["severe","#8b2342"]]},"line-width":7},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-hover-point-casing",type:"circle",source:"directions",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-hover-point",type:"circle",source:"directions",paint:{"circle-radius":6,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-waypoint-point-casing",type:"circle",source:"directions",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-waypoint-point",type:"circle",source:"directions",paint:{"circle-radius":6,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-origin-point",type:"circle",source:"directions",paint:{"circle-radius":18,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-origin-label",type:"symbol",source:"directions",layout:{"text-field":"A","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions",paint:{"circle-radius":18,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]},{id:"directions-destination-label",type:"symbol",source:"directions",layout:{"text-field":"B","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}]},{}],45:[function(xe,de,h){"use strict";var Y=function re($){return $&&$.__esModule?$:{default:$}}(xe("./directions"));de.exports=Y.default},{"./directions":43}],46:[function(xe,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0});var Y=function W(ue){if(ue&&ue.__esModule)return ue;var Te={};if(null!=ue)for(var Ne in ue)Object.prototype.hasOwnProperty.call(ue,Ne)&&(Te[Ne]=ue[Ne]);return Te.default=ue,Te}(xe("../constants/action_types.js")),$=function K(ue){return ue&&ue.__esModule?ue:{default:ue}}(xe("deep-assign"));var me={api:"https://api.mapbox.com/directions/v5/",profile:"mapbox/driving-traffic",alternatives:!1,congestion:!1,unit:"imperial",flyTo:!0,placeholderOrigin:"Choose a starting place",placeholderDestination:"Choose destination",zoom:16,language:"en",compile:null,proximity:!1,styles:[],controls:{profileSwitcher:!0,inputs:!0,instructions:!0},geocoder:{},interactive:!0,events:{},origin:{},destination:{},hoverMarker:{},waypoints:[],originQuery:null,destinationQuery:null,originQueryCoordinates:null,destinationQueryCoordinates:null,directions:[],routeIndex:0,routePadding:80};h.default=function ce(){var ue=arguments.length>0&&void 0!==arguments[0]?arguments[0]:me,Te=arguments[1];switch(Te.type){case Y.SET_OPTIONS:return(0,$.default)({},ue,Te.options);case Y.DIRECTIONS_PROFILE:return Object.assign({},ue,{profile:Te.profile});case Y.ORIGIN:return Object.assign({},ue,{origin:Te.origin,hoverMarker:{}});case Y.DESTINATION:return Object.assign({},ue,{destination:Te.destination,hoverMarker:{}});case Y.HOVER_MARKER:return Object.assign({},ue,{hoverMarker:Te.hoverMarker});case Y.WAYPOINTS:return Object.assign({},ue,{waypoints:Te.waypoints});case Y.ORIGIN_QUERY:return Object.assign({},ue,{originQuery:Te.query});case Y.DESTINATION_QUERY:return Object.assign({},ue,{destinationQuery:Te.query});case Y.ORIGIN_FROM_COORDINATES:return Object.assign({},ue,{originQueryCoordinates:Te.coordinates});case Y.DESTINATION_FROM_COORDINATES:return Object.assign({},ue,{destinationQueryCoordinates:Te.coordinates});case Y.ORIGIN_CLEAR:return Object.assign({},ue,{origin:{},originQuery:"",waypoints:[],directions:[]});case Y.DESTINATION_CLEAR:return Object.assign({},ue,{destination:{},destinationQuery:"",waypoints:[],directions:[]});case Y.DIRECTIONS:return Object.assign({},ue,{directions:Te.directions});case Y.ROUTE_INDEX:return Object.assign({},ue,{routeIndex:Te.routeIndex});case Y.ERROR:return Object.assign({},ue,{error:Te.error});default:return ue}}},{"../constants/action_types.js":39,"deep-assign":2}],47:[function(xe,de,h){"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.default={format:{duration:function(ce){var ue=Math.floor(ce/60),Te=Math.floor(ue/60);return ce%=60,ue%=60,0===Te&&0===ue?ce+"s":0===Te?ue+"min":Te+"h "+ue+"min"},imperial:function(ce){var ue=ce/1609.344;return ue>=100?ue.toFixed(0)+"mi":ue>=10?ue.toFixed(1)+"mi":ue>=.1?ue.toFixed(2)+"mi":(5280*ue).toFixed(0)+"ft"},metric:function(ce){return ce>=1e5?(ce/1e3).toFixed(0)+"km":ce>=1e4?(ce/1e3).toFixed(1)+"km":ce>=100?(ce/1e3).toFixed(2)+"km":ce.toFixed(0)+"m"}},coordinateMatch:function Y(me,ce){return ce=ce.geometry.coordinates,(me=me.geometry.coordinates).join()===ce.join()||me[0].toFixed(3)===ce[0].toFixed(3)&&me[1].toFixed(3)===ce[1].toFixed(3)},createPoint:function K(me,ce){return{type:"Feature",geometry:{type:"Point",coordinates:me},properties:ce||{}}},validCoords:function U(me){return me[0]>=-180&&me[0]<=180&&me[1]>=-90&&me[1]<=90},wrap:function re(me){var ue=((me- -180)%360+360)%360-180;return-180===ue?180:ue},roundWithOriginalPrecision:function $(me,ce){var ue=0;return Math.floor(ce)!==ce&&(ue=ce.toString().split(".")[1].length),me.toFixed(Math.min(ue,5))}}},{}]},{},[45])(45)},564:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(652).x0;function xe(de){this.origin=de.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=de.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=de,this.send=this.send.bind(this),this.countries=de.countries?de.countries.split(","):null,this.types=de.types?de.types.split(","):null,this.bbox=de.bbox?de.bbox:null,this.language=de.language?de.language.split(","):null,this.limit=de.limit?+de.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(de),this.eventQueue=new Array,this.flushInterval=de.flushInterval||1e3,this.maxQueueSize=de.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}xe.prototype={select:function(de,h){var U=this.getSelectedIndex(de,h),Y=this.getEventPayload("search.select",h);if(Y.resultIndex=U,Y.resultPlaceName=de.place_name,Y.resultId=de.id,(U!==this.lastSentIndex||Y.queryString!==this.lastSentInput)&&-1!=U&&(this.lastSentIndex=U,this.lastSentInput=Y.queryString,Y.queryString))return this.push(Y)},start:function(de){var h=this.getEventPayload("search.start",de);if(h.queryString)return this.push(h)},keyevent:function(de,h){if(de.key&&!de.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(de.keyCode)){var U=this.getEventPayload("search.keystroke",h);if(U.lastAction=de.key,U.queryString)return this.push(U)}},send:function(de,h){if(!this.enableEventLogging)return h?h():void 0;var U=this.getRequestOptions(de);this.request(U,function(Y){return Y?this.handleError(Y,h):h?h():void 0}.bind(this))},getRequestOptions:function(de){return Array.isArray(de)||(de=[de]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(de)}},getEventPayload:function(de,h){var U;U=h.options.proximity?"object"==typeof h.options.proximity?[h.options.proximity.longitude,h.options.proximity.latitude]:"ip"===h.options.proximity?[999,999]:h.options.proximity:null;var Y=h._map?h._map.getZoom():void 0,re={event:de,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:h.options.autocomplete,fuzzyMatch:h.options.fuzzyMatch,proximity:U,limit:h.options.limit,routing:h.options.routing,worldview:h.options.worldview,mapZoom:Y,keyboardLocale:this.locale};return re.queryString="search.select"===de?h.inputString:"search.select"!=de&&h._inputEl?h._inputEl.value:h.inputString,re},request:function(de,h){var U=new XMLHttpRequest;for(var Y in U.onreadystatechange=function(){if(4==this.readyState)return h(204==this.status?null:this.statusText)},U.open(de.method,de.host+"/"+de.path,!0),de.headers)U.setRequestHeader(Y,de.headers[Y]);U.send(de.body)},handleError:function(de,h){if(h)return h(de)},generateSessionID:function(){return lt()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(de,h){if(h._typeahead){var Y=de.id;return h._typeahead.data.map(function(K){return K.id}).indexOf(Y)}},shouldEnableLogging:function(de){return!(!1===de.enableEventLogging||de.origin&&-1==de.origin.indexOf("api.mapbox.com")||de.localGeocoder||de.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(de,h){this.eventQueue.push(de),(this.eventQueue.length>=this.maxQueueSize||h)&&this.flush()},remove:function(){this.flush()}},Nt.exports=xe},424:Nt=>{Nt.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},569:Nt=>{function Bt(){}Bt.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const Xe={enableHighAccuracy:!0};return new Promise(function(lt,xe){window.navigator.geolocation.getCurrentPosition(lt,xe,Xe)})}},Nt.exports=Bt},545:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(11),xe=Xe(82),de=Xe(703),h=Xe(69).EventEmitter,U=Xe(424),Y=Xe(471),re=Xe(75),$=Xe(564),K=Xe(234),W=Xe(775),me=Xe(569),ce=Xe(777);function Ne(Q){this._eventEmitter=new h,this.options=de({},this.options,Q),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new me}Ne.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(Q){return Q.place_name},render:function(Q){var we=Q.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+we[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+we.splice(1,we.length).join(",")+"</div></div>"}},addTo:function(Q){function we(Ae,J){if(!document.body.contains(J))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const ne=Ae.onAdd();J.appendChild(ne)}if(Q._controlContainer)Q.addControl(this);else if(Q instanceof HTMLElement)we(this,Q);else{if("string"!=typeof Q)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const Ae=document.querySelectorAll(Q);if(0===Ae.length)throw new Error("Element ",Q,"not found.");if(Ae.length>1)throw new Error("Geocoder can only be added to a single html element");we(this,Ae[0])}}},onAdd:function(Q){if(Q&&"string"!=typeof Q&&(this._map=Q),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=re(Y({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new $(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var we=this.container=document.createElement("div");we.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var Ae=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",xe(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(mt){this.eventManager.keyevent(mt,this)}.bind(this));var J=document.createElement("div");J.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var ne=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(ne),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),J.appendChild(this._clearEl),J.appendChild(this._loadingEl),we.appendChild(Ae),we.appendChild(this._inputEl),we.appendChild(J),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var Me=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(Me),J.appendChild(this._geolocateEl),this._showGeolocateButton()}var Be=this._typeahead=new lt(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),Be.getItemValue=this.options.getItemValue;var He=Be.list.draw,rt=this._footerNode=function Te(){var Q=document.createElement("div");return Q.className="mapboxgl-ctrl-geocoder--powered-by",Q.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',Q}();return Be.list.draw=function(){He.call(this),rt.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),rt.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(rt)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),we},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(Q){this._hideLoadingIcon();const we={geometry:{type:"Point",coordinates:[Q.coords.longitude,Q.coords.latitude]}};this._handleMarker(we),this._fly(we),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(we),this._showClearButton(),this.fresh=!1;const Ae={limit:1,language:[this.options.language],query:we.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(we.geometry.coordinates[0]+","+we.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:we})):this.geocoderService.reverseGeocode(Ae).send().then(function(J){const ne=J.body.features[0];if(ne){const Me=ce.transformFeatureToGeolocationText(ne,this.options.addressAccuracy);this._setInputValue(Me),ne.user_coordinates=we.geometry.coordinates,this._eventEmitter.emit("result",{result:ne})}else this._eventEmitter.emit("result",{result:{user_coordinates:we.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(Q){1===Q.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(Q,we){var Ae=document.createElementNS("http://www.w3.org/2000/svg","svg");return Ae.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+Q),Ae.setAttribute("viewBox","0 0 18 18"),Ae.setAttribute("xml:space","preserve"),Ae.setAttribute("width",18),Ae.setAttribute("height",18),Ae.innerHTML=we,Ae},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(Q){this._inputEl.value=Q,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(Q){var we=(Q.clipboardData||window.clipboardData).getData("text");we.length>=this.options.minLength&&this._geocode(we)},_onKeyDown:function(Q){var we=27,Ae=9;if(Q.keyCode===we&&this.options.clearAndBlurOnEsc)return this._clear(Q),this._inputEl.blur();var J=Q.target&&Q.target.shadowRoot?Q.target.shadowRoot.activeElement:Q.target;if(!J||!J.value)return this.fresh=!0,Q.keyCode!==Ae&&this.clear(Q),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!Q.metaKey&&-1===[Ae,we,37,39,13,38,40].indexOf(Q.keyCode)&&J.value.length>=this.options.minLength&&this._geocode(J.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(Q){this.options.clearOnBlur&&this._clearOnBlur(Q),this.options.collapsed&&this._collapse()},_onChange:function(){var Q=this._typeahead.selected;Q&&JSON.stringify(Q)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(Q),this.options.marker&&this._mapboxgl&&this._handleMarker(Q),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(Q),this._eventEmitter.emit("result",{result:Q}),this.eventManager.select(Q,this))},_fly:function(Q){var we;if(Q.properties&&U[Q.properties.short_code])we=de({},this.options.flyTo),this._map&&this._map.fitBounds(U[Q.properties.short_code].bbox,we);else if(Q.bbox){var Ae=Q.bbox;we=de({},this.options.flyTo),this._map&&this._map.fitBounds([[Ae[0],Ae[1]],[Ae[2],Ae[3]]],we)}else we=de({},{zoom:this.options.zoom},this.options.flyTo),Q.center?we.center=Q.center:Q.geometry&&Q.geometry.type&&"Point"===Q.geometry.type&&Q.geometry.coordinates&&(we.center=Q.geometry.coordinates),this._map&&this._map.flyTo(we)},_requestType:function(Q,we){return Q.localGeocoderOnly?1:Q.reverseGeocode&&/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(we)?2:0},_setupConfig:function(Q,we){const J=/[\s,]+/;var ne=this,Me=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(He,rt){return null==ne.options[rt]||(He[rt]=["countries","types","language"].indexOf(rt)>-1?ne.options[rt].split(J):ne.options[rt],"proximity"===rt&&"number"==typeof ne.options[rt].longitude&&"number"==typeof ne.options[rt].latitude&&(He[rt]=[ne.options[rt].longitude,ne.options[rt].latitude])),He},{});switch(Q){case 2:var Be=we.split(J).map(function(He){return parseFloat(He,10)});ne.options.flipCoordinates||Be.reverse(),Me=de(Me,{query:Be,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(He){He in Me&&delete Me[He]});break;case 0:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(we)&&(we=we.replace(/,/g," ")),Me=de(Me,{query:we})}return Me},_geocode:function(Q){this.inputString=Q,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:Q});const we=this._requestType(this.options,Q),Ae=this._setupConfig(we,Q);var J;switch(we){case 1:J=Promise.resolve();break;case 0:J=this.geocoderService.forwardGeocode(Ae).send();break;case 2:J=this.geocoderService.reverseGeocode(Ae).send()}var ne=this.options.localGeocoder&&this.options.localGeocoder(Q)||[],Me=[],Be=null;return J.catch(function(He){Be=He}.bind(this)).then(function(He){this._hideLoadingIcon();var rt={};return He?"200"==He.statusCode&&((rt=He.body).request=He.request,rt.headers=He.headers):rt={type:"FeatureCollection",features:[]},rt.config=Ae,this.fresh&&(this.eventManager.start(this),this.fresh=!1),rt.features=rt.features?ne.concat(rt.features):ne,this.options.externalGeocoder?(Me=this.options.externalGeocoder(Q,rt.features)||Promise.resolve([])).then(function(mt){return rt.features=rt.features?mt.concat(rt.features):mt,rt},function(){return rt}):rt}.bind(this)).then(function(He){if(Be)throw Be;this.options.filter&&He.features.length&&(He.features=He.features.filter(this.options.filter)),He.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",He),this._typeahead.update(He.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",He))}.bind(this)).catch(function(He){this._hideLoadingIcon(),this._hideAttribution(),ne.length&&this.options.localGeocoder||Me.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(ne)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:ne}),this._eventEmitter.emit("error",{error:He})}.bind(this)),J},_clear:function(Q){Q&&Q.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(Q){this._clear(Q),this._inputEl.focus()},_clearOnBlur:function(Q){Q.relatedTarget&&this._clear(Q)},_onQueryResult:function(Q){var we=Q.body;if(we.features.length){var Ae=we.features[0];this._typeahead.selected=Ae,this._inputEl.value=Ae.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var Q=this._map.getCenter().wrap();this.setProximity({longitude:Q.lng,latitude:Q.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(Q){return this._geocode(Q).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(Q){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(Q)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var Q=this.options.language.split(",")[0],we=W.language(Q),Ae=K.placeholder[we];if(Ae)return Ae}return"Search"},setInput:function(Q){return this._inputEl.value=Q,this._typeahead.selected=null,this._typeahead.clear(),Q.length>=this.options.minLength&&this._geocode(Q),this},setProximity:function(Q,we=!0){return this.options.proximity=Q,we&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(Q){return Q&&"function"==typeof Q&&(this._typeahead.render=Q),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(Q){var we=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=Q||this.options.language||we,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(Q){return this.options.zoom=Q,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(Q){return this.options.flyTo=Q,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(Q){return this.placeholder=Q||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(Q){return this.options.bbox=Q,this},getCountries:function(){return this.options.countries},setCountries:function(Q){return this.options.countries=Q,this},getTypes:function(){return this.options.types},setTypes:function(Q){return this.options.types=Q,this},getMinLength:function(){return this.options.minLength},setMinLength:function(Q){return this.options.minLength=Q,this._typeahead&&(this._typeahead.options.minLength=Q),this},getLimit:function(){return this.options.limit},setLimit:function(Q){return this.options.limit=Q,this._typeahead&&(this._typeahead.options.limit=Q),this},getFilter:function(){return this.options.filter},setFilter:function(Q){return this.options.filter=Q,this},setOrigin:function(Q){return this.options.origin=Q,this.geocoderService=re(Y({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(Q){return this.options.accessToken=Q,this.geocoderService=re(Y({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(Q){return this.options.autocomplete=Q,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(Q){return this.options.fuzzyMatch=Q,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(Q){return this.options.routing=Q,this},getRouting:function(){return this.options.routing},setWorldview:function(Q){return this.options.worldview=Q,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(Q){if(this._map){this._removeMarker();var Ae=de({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(Ae),Q.center?this.mapMarker.setLngLat(Q.center).addTo(this._map):Q.geometry&&Q.geometry.type&&"Point"===Q.geometry.type&&Q.geometry.coordinates&&this.mapMarker.setLngLat(Q.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(Q,we){return this._eventEmitter.on(Q,we),this},off:function(Q,we){return this._eventEmitter.removeListener(Q,we),this.eventManager.remove(),this}},Nt.exports=Ne},234:Nt=>{"use strict";Nt.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},777:Nt=>{function Xe(lt){const xe=lt.address||"",de=lt.text||"",h=lt.place_name||"",Y={address:h.split(",")[0],houseNumber:xe,street:de,placeName:h};return lt.context.forEach(function(re){const $=re.id.split(".")[0];Y[$]=re.text}),Y}Nt.exports={transformFeatureToGeolocationText:function Bt(lt,xe){const de=Xe(lt),h=["address","street","place","country"];if("function"==typeof xe)return xe(de);const Y=h.indexOf(xe);return(-1===Y?h:h.slice(Y)).reduce(function(re,$){return de[$]?(""!==re&&(re+=", "),re+de[$]):re},"")},getAddressInfo:Xe}},11:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(83);Nt.exports=lt,"undefined"!=typeof window&&(window.Suggestions=lt)},636:Nt=>{"use strict";var Bt=function(Xe){return this.component=Xe,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,Xe.el.parentNode.insertBefore(this.wrapper,Xe.el.nextSibling),this};Bt.prototype.show=function(){this.element.style.display="block"},Bt.prototype.hide=function(){this.element.style.display="none"},Bt.prototype.add=function(Xe){this.items.push(Xe)},Bt.prototype.clear=function(){this.items=[],this.active=0},Bt.prototype.isEmpty=function(){return!this.items.length},Bt.prototype.isVisible=function(){return"block"===this.element.style.display},Bt.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var Xe=0;Xe<this.items.length;Xe++)this.drawItem(this.items[Xe],this.active===Xe);this.show()}else this.hide()},Bt.prototype.drawItem=function(Xe,lt){var xe=document.createElement("li"),de=document.createElement("a");lt&&(xe.className+=" active"),de.innerHTML=Xe.string,xe.appendChild(de),this.element.appendChild(xe),xe.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),xe.addEventListener("mouseup",function(){this.handleMouseUp.call(this,Xe)}.bind(this))},Bt.prototype.handleMouseUp=function(Xe){this.selectingListItem=!1,this.component.value(Xe.original),this.clear(),this.draw()},Bt.prototype.move=function(Xe){this.active=Xe,this.draw()},Bt.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},Bt.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},Bt.prototype.drawError=function(Xe){var lt=document.createElement("li");lt.innerHTML=Xe,this.element.appendChild(lt),this.show()},Nt.exports=Bt},83:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(703),xe=Xe(780),de=Xe(636),h=function(U,Y,re){return this.options=lt({minLength:2,limit:5,filter:!0,hideOnBlur:!0},re=re||{}),this.el=U,this.data=Y||[],this.list=new de(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function($){this.handleKeyUp($.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function($){this.handleKeyDown($)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function($){this.handlePaste($)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};h.prototype.handleKeyUp=function(U){40===U||38===U||27===U||13===U||9===U||this.handleInputChange(this.el.value)},h.prototype.handleKeyDown=function(U){switch(U.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&U.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},h.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},h.prototype.handlePaste=function(U){if(U.clipboardData)this.handleInputChange(U.clipboardData.getData("Text"));else{var Y=this;setTimeout(function(){Y.handleInputChange(U.target.value)},100)}},h.prototype.handleInputChange=function(U){this.query=this.normalize(U),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(Y){for(var re=0;re<Y.length&&(this.list.add(Y[re]),re!==this.options.limit-1);re++);this.list.draw()}.bind(this))},h.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},h.prototype.update=function(U){this.data=U,this.handleKeyUp()},h.prototype.clear=function(){this.data=[],this.list.clear()},h.prototype.normalize=function(U){return U.toLowerCase()},h.prototype.match=function(U,Y){return U.indexOf(Y)>-1},h.prototype.value=function(U){if(this.selected=U,this.el.value=this.getItemValue(U),document.createEvent){var Y=document.createEvent("HTMLEvents");Y.initEvent("change",!0,!1),this.el.dispatchEvent(Y)}else this.el.fireEvent("onchange")},h.prototype.getCandidates=function(U){var Y={pre:"<strong>",post:"</strong>",extract:function($){return this.getItemValue($)}.bind(this)};U(this.options.filter?xe.filter(this.query,this.data,Y).map(function($){return{original:$.original,string:this.render($.original,$.string)}}.bind(this)):this.data.map(function($){return{original:$,string:this.render($)}}.bind(this)))},h.prototype.getItemValue=function(U){return U},h.prototype.render=function(U,Y){if(Y)return Y;for(var re=this.getItemValue(U.original?U.original:U),$=this.normalize(re),K=$.lastIndexOf(this.query);K>-1;){var W=K+this.query.length;re=re.slice(0,K)+"<strong>"+re.slice(K,W)+"</strong>"+re.slice(W),K=$.slice(0,K).lastIndexOf(this.query)}return re},h.prototype.renderError=function(U){this.list.drawError(U)},Nt.exports=h},471:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(454);Nt.exports=lt},454:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(753),xe=Xe(176);function de(U){xe.call(this,U)}(de.prototype=Object.create(xe.prototype)).constructor=de,de.prototype.sendRequest=lt.browserSend,de.prototype.abortRequest=lt.browserAbort,Nt.exports=function h(U){return new de(U)}},753:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(332),xe=Xe(158),de=Xe(719),h=Xe(829),U={};function $(ce){var ue=ce.total,Te=ce.loaded;return{total:ue,transferred:Te,percent:100*Te/ue}}function K(ce,ue){return new Promise(function(Te,Ne){ue.onprogress=function(Ae){ce.emitter.emit(de.EVENT_PROGRESS_DOWNLOAD,$(Ae))};var Q=ce.file;Q&&(ue.upload.onprogress=function(Ae){ce.emitter.emit(de.EVENT_PROGRESS_UPLOAD,$(Ae))}),ue.onerror=function(Ae){Ne(Ae)},ue.onabort=function(){var Ae=new xe({request:ce,type:de.ERROR_REQUEST_ABORTED});Ne(Ae)},ue.onload=function(){if(delete U[ce.id],ue.status<200||ue.status>=400){var Ae=new xe({request:ce,body:ue.response,statusCode:ue.status});Ne(Ae)}else Te(ue)};var we=ce.body;"string"==typeof we?ue.send(we):we?ue.send(JSON.stringify(we)):Q?ue.send(Q):ue.send(),U[ce.id]=ue}).then(function(Te){return function re(ce,ue){return new lt(ce,{body:ue.response,headers:h(ue.getAllResponseHeaders()),statusCode:ue.status})}(ce,Te)})}function W(ce,ue){var Te=ce.url(ue),Ne=new window.XMLHttpRequest;return Ne.open(ce.method,Te),Object.keys(ce.headers).forEach(function(Q){Ne.setRequestHeader(Q,ce.headers[Q])}),Ne}Nt.exports={browserAbort:function Y(ce){var ue=U[ce.id];!ue||(ue.abort(),delete U[ce.id])},sendRequestXhr:K,browserSend:function me(ce){return Promise.resolve().then(function(){var ue=W(ce,ce.client.accessToken);return K(ce,ue)})},createRequestXhr:W}},176:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(129),xe=Xe(538),de=Xe(719);function h(U){if(!U||!U.accessToken)throw new Error("Cannot create a client without an access token");lt(U.accessToken),this.accessToken=U.accessToken,this.origin=U.origin||de.API_ORIGIN}h.prototype.createRequest=function(Y){return new xe(this,Y)},Nt.exports=h},158:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(719);Nt.exports=function xe(de){var U,h=de.type||lt.ERROR_HTTP;if(de.body)try{U=JSON.parse(de.body)}catch(re){U=de.body}else U=null;var Y=de.message||null;Y||("string"==typeof U?Y=U:U&&"string"==typeof U.message?Y=U.message:h===lt.ERROR_REQUEST_ABORTED&&(Y="Request aborted")),this.message=Y,this.type=h,this.statusCode=de.statusCode||null,this.request=de.request,this.body=U}},538:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(129),xe=Xe(703),de=Xe(661),h=Xe(449),U=Xe(719),Y=1;function re($,K){if(!$)throw new Error("MapiRequest requires a client");if(!K||!K.path||!K.method)throw new Error("MapiRequest requires an options object with path and method properties");var W={};K.body&&(W["content-type"]="application/json");var me=xe(W,K.headers),ce=Object.keys(me).reduce(function(ue,Te){return ue[Te.toLowerCase()]=me[Te],ue},{});this.id=Y++,this._options=K,this.emitter=new de,this.client=$,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=K.path,this.method=K.method,this.origin=K.origin||$.origin,this.query=K.query||{},this.params=K.params||{},this.body=K.body||null,this.file=K.file||null,this.encoding=K.encoding||"utf8",this.sendFileAs=K.sendFileAs||null,this.headers=ce}re.prototype.url=function(K){var W=h.prependOrigin(this.path,this.origin);W=h.appendQueryObject(W,this.query);var me=this.params,ce=null==K?this.client.accessToken:K;if(ce){W=h.appendQueryParam(W,"access_token",ce);var ue=lt(ce).user;me=xe({ownerId:ue},me)}return h.interpolateRouteParams(W,me)},re.prototype.send=function(){var K=this;if(K.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return K.sent=!0,K.client.sendRequest(K).then(function(W){return K.response=W,K.emitter.emit(U.EVENT_RESPONSE,W),W},function(W){throw K.error=W,K.emitter.emit(U.EVENT_ERROR,W),W})},re.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},re.prototype.eachPage=function(K){var W=this;function me(Te){K(null,Te,function Ne(){delete W._nextPageRequest;var Q=Te.nextPage();Q&&(W._nextPageRequest=Q,ue(Q))})}function ce(Te){K(Te,null,function(){})}function ue(Te){Te.send().then(me,ce)}ue(this)},re.prototype.clone=function(){return this._extend()},re.prototype._extend=function(K){var W=xe(this._options,K);return new re(this.client,W)},Nt.exports=re},332:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(699);function xe(de,h){this.request=de,this.headers=h.headers,this.rawBody=h.body,this.statusCode=h.statusCode;try{this.body=JSON.parse(h.body||"{}")}catch(U){this.body=h.body}this.links=lt(this.headers.link)}xe.prototype.hasNextPage=function(){return!!this.links.next},xe.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Nt.exports=xe},719:Nt=>{"use strict";Nt.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},829:Nt=>{"use strict";Nt.exports=function Xe(lt){var xe={};return lt&&lt.trim().split(/[\r|\n]+/).forEach(function(de){var h=function Bt(lt){var xe=lt.indexOf(":");return{name:lt.substring(0,xe).trim().toLowerCase(),value:lt.substring(xe+1).trim()}}(de);xe[h.name]=h.value}),xe}},699:Nt=>{"use strict";Nt.exports=function lt(xe){return xe?xe.split(/,\s*</).reduce(function(de,h){var U=function Xe(xe){var de=xe.match(/<?([^>]*)>(.*)/);if(!de)return null;var h=de[1],U=de[2].split(";"),Y=null,re=U.reduce(function($,K){var W=function Bt(xe){var de=xe.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return de?{key:de[1],value:de[2]}:null}(K);return W?"rel"===W.key?(Y||(Y=W.value),$):($[W.key]=W.value,$):$},{});return Y?{url:h,rel:Y,params:re}:null}(h);return U?(U.rel.split(/\s+/).forEach(function(re){de[re]||(de[re]={url:U.url,params:U.params})}),de):de},{}):{}}},449:Nt=>{"use strict";function Xe(U){return Array.isArray(U)?function Bt(U){return U.map(encodeURIComponent).join(",")}(U):encodeURIComponent(String(U))}function lt(U,Y,re){if(!1===re||null===re)return U;var $=/\?/.test(U)?"&":"?",K=encodeURIComponent(Y);return void 0!==re&&""!==re&&!0!==re&&(K+="="+Xe(re)),""+U+$+K}Nt.exports={appendQueryObject:function xe(U,Y){if(!Y)return U;var re=U;return Object.keys(Y).forEach(function($){var K=Y[$];void 0!==K&&(Array.isArray(K)&&(K=K.filter(function(W){return null!=W}).join(",")),re=lt(re,$,K))}),re},appendQueryParam:lt,prependOrigin:function de(U,Y){if(!Y||"http"===U.slice(0,4))return U;var re="/"===U[0]?"":"/";return""+Y.replace(/\/$/,"")+re+U},interpolateRouteParams:function h(U,Y){return Y?U.replace(/\/:([a-zA-Z0-9]+)/g,function(re,$){var K=Y[$];if(void 0===K)throw new Error("Unspecified route parameter "+$);return"/"+Xe(K)}):U}}},661:Nt=>{"use strict";var Bt=Object.prototype.hasOwnProperty,Xe="~";function lt(){}function xe(Y,re,$){this.fn=Y,this.context=re,this.once=$||!1}function de(Y,re,$,K,W){if("function"!=typeof $)throw new TypeError("The listener must be a function");var me=new xe($,K||Y,W),ce=Xe?Xe+re:re;return Y._events[ce]?Y._events[ce].fn?Y._events[ce]=[Y._events[ce],me]:Y._events[ce].push(me):(Y._events[ce]=me,Y._eventsCount++),Y}function h(Y,re){0==--Y._eventsCount?Y._events=new lt:delete Y._events[re]}function U(){this._events=new lt,this._eventsCount=0}Object.create&&(lt.prototype=Object.create(null),(new lt).__proto__||(Xe=!1)),U.prototype.eventNames=function(){var $,K,re=[];if(0===this._eventsCount)return re;for(K in $=this._events)Bt.call($,K)&&re.push(Xe?K.slice(1):K);return Object.getOwnPropertySymbols?re.concat(Object.getOwnPropertySymbols($)):re},U.prototype.listeners=function(re){var K=this._events[Xe?Xe+re:re];if(!K)return[];if(K.fn)return[K.fn];for(var W=0,me=K.length,ce=new Array(me);W<me;W++)ce[W]=K[W].fn;return ce},U.prototype.listenerCount=function(re){var K=this._events[Xe?Xe+re:re];return K?K.fn?1:K.length:0},U.prototype.emit=function(re,$,K,W,me,ce){var ue=Xe?Xe+re:re;if(!this._events[ue])return!1;var Q,we,Te=this._events[ue],Ne=arguments.length;if(Te.fn){switch(Te.once&&this.removeListener(re,Te.fn,void 0,!0),Ne){case 1:return Te.fn.call(Te.context),!0;case 2:return Te.fn.call(Te.context,$),!0;case 3:return Te.fn.call(Te.context,$,K),!0;case 4:return Te.fn.call(Te.context,$,K,W),!0;case 5:return Te.fn.call(Te.context,$,K,W,me),!0;case 6:return Te.fn.call(Te.context,$,K,W,me,ce),!0}for(we=1,Q=new Array(Ne-1);we<Ne;we++)Q[we-1]=arguments[we];Te.fn.apply(Te.context,Q)}else{var J,Ae=Te.length;for(we=0;we<Ae;we++)switch(Te[we].once&&this.removeListener(re,Te[we].fn,void 0,!0),Ne){case 1:Te[we].fn.call(Te[we].context);break;case 2:Te[we].fn.call(Te[we].context,$);break;case 3:Te[we].fn.call(Te[we].context,$,K);break;case 4:Te[we].fn.call(Te[we].context,$,K,W);break;default:if(!Q)for(J=1,Q=new Array(Ne-1);J<Ne;J++)Q[J-1]=arguments[J];Te[we].fn.apply(Te[we].context,Q)}}return!0},U.prototype.on=function(re,$,K){return de(this,re,$,K,!1)},U.prototype.once=function(re,$,K){return de(this,re,$,K,!0)},U.prototype.removeListener=function(re,$,K,W){var me=Xe?Xe+re:re;if(!this._events[me])return this;if(!$)return h(this,me),this;var ce=this._events[me];if(ce.fn)ce.fn===$&&(!W||ce.once)&&(!K||ce.context===K)&&h(this,me);else{for(var ue=0,Te=[],Ne=ce.length;ue<Ne;ue++)(ce[ue].fn!==$||W&&!ce[ue].once||K&&ce[ue].context!==K)&&Te.push(ce[ue]);Te.length?this._events[me]=1===Te.length?Te[0]:Te:h(this,me)}return this},U.prototype.removeAllListeners=function(re){var $;return re?this._events[$=Xe?Xe+re:re]&&h(this,$):(this._events=new lt,this._eventsCount=0),this},U.prototype.off=U.prototype.removeListener,U.prototype.addListener=U.prototype.on,U.prefixed=Xe,U.EventEmitter=U,Nt.exports=U},75:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(703),xe=Xe(801),de=Xe(313),h=Xe(836),U=Xe(497),Y={},re=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Y.forwardGeocode=function($){xe.assertShape({query:xe.required(xe.string),mode:xe.oneOf("mapbox.places","mapbox.places-permanent"),countries:xe.arrayOf(xe.string),proximity:xe.oneOf(xe.coordinates,"ip"),types:xe.arrayOf(xe.oneOf(re)),autocomplete:xe.boolean,bbox:xe.arrayOf(xe.number),limit:xe.number,language:xe.arrayOf(xe.string),routing:xe.boolean,fuzzyMatch:xe.boolean,worldview:xe.string})($),$.mode=$.mode||"mapbox.places";var K=h(lt({country:$.countries},de($,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:de($,["mode","query"]),query:K})},Y.reverseGeocode=function($){xe.assertShape({query:xe.required(xe.coordinates),mode:xe.oneOf("mapbox.places","mapbox.places-permanent"),countries:xe.arrayOf(xe.string),types:xe.arrayOf(xe.oneOf(re)),bbox:xe.arrayOf(xe.number),limit:xe.number,language:xe.arrayOf(xe.string),reverseMode:xe.oneOf("distance","score"),routing:xe.boolean,worldview:xe.string})($),$.mode=$.mode||"mapbox.places";var K=h(lt({country:$.countries},de($,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:de($,["mode","query"]),query:K})},Nt.exports=U(Y)},497:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(176),xe=Xe(454);Nt.exports=function de(h){return function(U){var Y;Y=lt.prototype.isPrototypeOf(U)?U:xe(U);var re=Object.create(h);return re.client=Y,re}}},621:Nt=>{"use strict";Nt.exports=function Bt(Xe,lt){return Object.keys(Xe).reduce(function(xe,de){return xe[de]=lt(de,Xe[de]),xe},{})}},313:Nt=>{"use strict";Nt.exports=function Bt(Xe,lt){var xe=function(de,h){return-1!==lt.indexOf(de)&&void 0!==h};return"function"==typeof lt&&(xe=lt),Object.keys(Xe).filter(function(de){return xe(de,Xe[de])}).reduce(function(de,h){return de[h]=Xe[h],de},{})}},836:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(621);Nt.exports=function xe(de){return lt(de,function(h,U){return"boolean"==typeof U?JSON.stringify(U):U})}},801:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(703),xe=Xe(89);Nt.exports=lt(xe,{file:function de(re){return"undefined"!=typeof window?re instanceof global.Blob||re instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof re&&void 0===re.pipe?"Filename or Readable stream":void 0},date:function U(re){var $="date";if("boolean"==typeof re)return $;try{var K=new Date(re);if(K.getTime&&isNaN(K.getTime()))return $}catch(W){return $}},coordinates:function Y(re){return xe.tuple(xe.number,xe.number)(re)},assertShape:function h(re,$){return xe.assert(xe.strictShape(re),$)}})},129:(Nt,Bt,Xe)=>{"use strict";var lt=Xe(49),xe={};function U(Y,re){return Object.prototype.hasOwnProperty.call(Y,re)}Nt.exports=function de(Y){if(xe[Y])return xe[Y];var re=Y.split("."),$=re[0],K=re[1];if(!K)throw new Error("Invalid token");var W=function h(Y){try{return JSON.parse(lt.decode(Y))}catch(re){throw new Error("Invalid token")}}(K),me={usage:$,user:W.u};return U(W,"a")&&(me.authorization=W.a),U(W,"exp")&&(me.expires=1e3*W.exp),U(W,"iat")&&(me.created=1e3*W.iat),U(W,"scopes")&&(me.scopes=W.scopes),U(W,"client")&&(me.client=W.client),U(W,"ll")&&(me.lastLogin=W.ll),U(W,"iu")&&(me.impersonator=W.iu),xe[Y]=me,me}},37:(Nt,Bt,Xe)=>{"use strict";function lt(t){return"function"==typeof t}let xe=!1;const de={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else xe&&console.log("RxJS: Back to a better error behavior. Thank you. <3");xe=t},get useDeprecatedSynchronousErrorHandling(){return xe}};function h(t){setTimeout(()=>{throw t},0)}const U={closed:!0,next(t){},error(t){if(de.useDeprecatedSynchronousErrorHandling)throw t;h(t)},complete(){}},Y=Array.isArray||(t=>t&&"number"==typeof t.length);function re(t){return null!==t&&"object"==typeof t}const K=(()=>{function t(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((n,a)=>`${a+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return t.prototype=Object.create(Error.prototype),t})();class W{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:a,_unsubscribe:u,_subscriptions:m}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof W)n.remove(this);else if(null!==n)for(let v=0;v<n.length;++v)n[v].remove(this);if(lt(u)){a&&(this._unsubscribe=void 0);try{u.call(this)}catch(v){e=v instanceof K?me(v.errors):[v]}}if(Y(m)){let v=-1,T=m.length;for(;++v<T;){const I=m[v];if(re(I))try{I.unsubscribe()}catch(O){e=e||[],O instanceof K?e=e.concat(me(O.errors)):e.push(O)}}}if(e)throw new K(e)}add(e){let n=e;if(!e)return W.EMPTY;switch(typeof e){case"function":n=new W(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof W)){const m=n;n=new W,n._subscriptions=[m]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:a}=n;if(null===a)n._parentOrParents=this;else if(a instanceof W){if(a===this)return n;n._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return n;a.push(this)}const u=this._subscriptions;return null===u?this._subscriptions=[n]:u.push(n),n}remove(e){const n=this._subscriptions;if(n){const a=n.indexOf(e);-1!==a&&n.splice(a,1)}}}var t;function me(t){return t.reduce((e,n)=>e.concat(n instanceof K?n.errors:n),[])}W.EMPTY=((t=new W).closed=!0,t);const ce="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class Te extends W{constructor(e,n,a){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=U;break;case 1:if(!e){this.destination=U;break}if("object"==typeof e){e instanceof Te?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new Ne(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new Ne(this,e,n,a)}}[ce](){return this}static create(e,n,a){const u=new Te(e,n,a);return u.syncErrorThrowable=!1,u}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class Ne extends Te{constructor(e,n,a,u){super(),this._parentSubscriber=e;let m,v=this;lt(n)?m=n:n&&(m=n.next,a=n.error,u=n.complete,n!==U&&(v=Object.create(n),lt(v.unsubscribe)&&this.add(v.unsubscribe.bind(v)),v.unsubscribe=this.unsubscribe.bind(this))),this._context=v,this._next=m,this._error=a,this._complete=u}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:n}=this;de.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?this.__tryOrSetError(n,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:n}=this,{useDeprecatedSynchronousErrorHandling:a}=de;if(this._error)a&&n.syncErrorThrowable?(this.__tryOrSetError(n,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(n.syncErrorThrowable)a?(n.syncErrorValue=e,n.syncErrorThrown=!0):h(e),this.unsubscribe();else{if(this.unsubscribe(),a)throw e;h(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const n=()=>this._complete.call(this._context);de.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,n){try{e.call(this._context,n)}catch(a){if(this.unsubscribe(),de.useDeprecatedSynchronousErrorHandling)throw a;h(a)}}__tryOrSetError(e,n,a){if(!de.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,a)}catch(u){return de.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=u,e.syncErrorThrown=!0,!0):(h(u),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const Ae="function"==typeof Symbol&&Symbol.observable||"@@observable";function J(t){return t}let Be=(()=>{class t{constructor(n){this._isScalar=!1,n&&(this._subscribe=n)}lift(n){const a=new t;return a.source=this,a.operator=n,a}subscribe(n,a,u){const{operator:m}=this,v=function we(t,e,n){if(t){if(t instanceof Te)return t;if(t[ce])return t[ce]()}return t||e||n?new Te(t,e,n):new Te(U)}(n,a,u);if(v.add(m?m.call(v,this.source):this.source||de.useDeprecatedSynchronousErrorHandling&&!v.syncErrorThrowable?this._subscribe(v):this._trySubscribe(v)),de.useDeprecatedSynchronousErrorHandling&&v.syncErrorThrowable&&(v.syncErrorThrowable=!1,v.syncErrorThrown))throw v.syncErrorValue;return v}_trySubscribe(n){try{return this._subscribe(n)}catch(a){de.useDeprecatedSynchronousErrorHandling&&(n.syncErrorThrown=!0,n.syncErrorValue=a),function Q(t){for(;t;){const{closed:e,destination:n,isStopped:a}=t;if(e||a)return!1;t=n&&n instanceof Te?n:null}return!0}(n)?n.error(a):console.warn(a)}}forEach(n,a){return new(a=He(a))((u,m)=>{let v;v=this.subscribe(T=>{try{n(T)}catch(I){m(I),v&&v.unsubscribe()}},m,u)})}_subscribe(n){const{source:a}=this;return a&&a.subscribe(n)}[Ae](){return this}pipe(...n){return 0===n.length?this:function Me(t){return 0===t.length?J:1===t.length?t[0]:function(n){return t.reduce((a,u)=>u(a),n)}}(n)(this)}toPromise(n){return new(n=He(n))((a,u)=>{let m;this.subscribe(v=>m=v,v=>u(v),()=>a(m))})}}return t.create=e=>new t(e),t})();function He(t){if(t||(t=de.Promise||Promise),!t)throw new Error("no Promise impl found");return t}const mt=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})();class Pt extends W{constructor(e,n){super(),this.subject=e,this.subscriber=n,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,n=e.observers;if(this.subject=null,!n||0===n.length||e.isStopped||e.closed)return;const a=n.indexOf(this.subscriber);-1!==a&&n.splice(a,1)}}class gt extends Te{constructor(e){super(e),this.destination=e}}let Et=(()=>{class t extends Be{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[ce](){return new gt(this)}lift(n){const a=new Ot(this,this);return a.operator=n,a}next(n){if(this.closed)throw new mt;if(!this.isStopped){const{observers:a}=this,u=a.length,m=a.slice();for(let v=0;v<u;v++)m[v].next(n)}}error(n){if(this.closed)throw new mt;this.hasError=!0,this.thrownError=n,this.isStopped=!0;const{observers:a}=this,u=a.length,m=a.slice();for(let v=0;v<u;v++)m[v].error(n);this.observers.length=0}complete(){if(this.closed)throw new mt;this.isStopped=!0;const{observers:n}=this,a=n.length,u=n.slice();for(let m=0;m<a;m++)u[m].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(n){if(this.closed)throw new mt;return super._trySubscribe(n)}_subscribe(n){if(this.closed)throw new mt;return this.hasError?(n.error(this.thrownError),W.EMPTY):this.isStopped?(n.complete(),W.EMPTY):(this.observers.push(n),new Pt(this,n))}asObservable(){const n=new Be;return n.source=this,n}}return t.create=(e,n)=>new Ot(e,n),t})();class Ot extends Et{constructor(e,n){super(),this.destination=e,this.source=n}next(e){const{destination:n}=this;n&&n.next&&n.next(e)}error(e){const{destination:n}=this;n&&n.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:n}=this;return n?this.source.subscribe(e):W.EMPTY}}function ut(t){return t&&"function"==typeof t.schedule}function it(t,e){return function(a){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return a.lift(new cn(t,e))}}class cn{constructor(e,n){this.project=e,this.thisArg=n}call(e,n){return n.subscribe(new wn(e,this.project,this.thisArg))}}class wn extends Te{constructor(e,n,a){super(e),this.project=n,this.count=0,this.thisArg=a||this}_next(e){let n;try{n=this.project.call(this.thisArg,e,this.count++)}catch(a){return void this.destination.error(a)}this.destination.next(n)}}const sn=t=>e=>{for(let n=0,a=t.length;n<a&&!e.closed;n++)e.next(t[n]);e.complete()},Nn=function un(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}(),nt=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function Tt(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const $t=t=>{if(t&&"function"==typeof t[Ae])return(t=>e=>{const n=t[Ae]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)})(t);if(nt(t))return sn(t);if(Tt(t))return(t=>e=>(t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,h),e))(t);if(t&&"function"==typeof t[Nn])return(t=>e=>{const n=t[Nn]();for(;;){let a;try{a=n.next()}catch(u){return e.error(u),e}if(a.done){e.complete();break}if(e.next(a.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e})(t);{const n=`You provided ${re(t)?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(n)}};function kn(t,e){return new Be(n=>{const a=new W;let u=0;return a.add(e.schedule(function(){u!==t.length?(n.next(t[u++]),n.closed||a.add(this.schedule())):n.complete()})),a})}function hr(t,e){return e?function yn(t,e){if(null!=t){if(function ur(t){return t&&"function"==typeof t[Ae]}(t))return function fn(t,e){return new Be(n=>{const a=new W;return a.add(e.schedule(()=>{const u=t[Ae]();a.add(u.subscribe({next(m){a.add(e.schedule(()=>n.next(m)))},error(m){a.add(e.schedule(()=>n.error(m)))},complete(){a.add(e.schedule(()=>n.complete()))}}))})),a})}(t,e);if(Tt(t))return function bt(t,e){return new Be(n=>{const a=new W;return a.add(e.schedule(()=>t.then(u=>{a.add(e.schedule(()=>{n.next(u),a.add(e.schedule(()=>n.complete()))}))},u=>{a.add(e.schedule(()=>n.error(u)))}))),a})}(t,e);if(nt(t))return kn(t,e);if(function Qn(t){return t&&"function"==typeof t[Nn]}(t)||"string"==typeof t)return function Gr(t,e){if(!t)throw new Error("Iterable cannot be null");return new Be(n=>{const a=new W;let u;return a.add(()=>{u&&"function"==typeof u.return&&u.return()}),a.add(e.schedule(()=>{u=t[Nn](),a.add(e.schedule(function(){if(n.closed)return;let m,v;try{const T=u.next();m=T.value,v=T.done}catch(T){return void n.error(T)}v?n.complete():(n.next(m),this.schedule())}))})),a})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof Be?t:new Be($t(t))}class jn extends Te{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class qr extends Te{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function Mo(t,e){if(e.closed)return;if(t instanceof Be)return t.subscribe(e);let n;try{n=$t(t)(e)}catch(a){e.error(a)}return n}function Nr(t,e,n=Number.POSITIVE_INFINITY){return"function"==typeof e?a=>a.pipe(Nr((u,m)=>hr(t(u,m)).pipe(it((v,T)=>e(u,v,m,T))),n)):("number"==typeof e&&(n=e),a=>a.lift(new no(t,n)))}class no{constructor(e,n=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=n}call(e,n){return n.subscribe(new Wi(e,this.project,this.concurrent))}}class Wi extends qr{constructor(e,n,a=Number.POSITIVE_INFINITY){super(e),this.project=n,this.concurrent=a,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let n;const a=this.index++;try{n=this.project(e,a)}catch(u){return void this.destination.error(u)}this.active++,this._innerSub(n)}_innerSub(e){const n=new jn(this),a=this.destination;a.add(n);const u=Mo(e,n);u!==n&&a.add(u)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function mi(t=Number.POSITIVE_INFINITY){return Nr(J,t)}function Pi(t,e){return e?kn(t,e):new Be(sn(t))}function ro(...t){let e=Number.POSITIVE_INFINITY,n=null,a=t[t.length-1];return ut(a)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof a&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof Be?t[0]:mi(e)(Pi(t,n))}function $o(){return function(e){return e.lift(new os(e))}}class os{constructor(e){this.connectable=e}call(e,n){const{connectable:a}=this;a._refCount++;const u=new Ss(e,a),m=n.subscribe(u);return u.closed||(u.connection=a.connect()),m}}class Ss extends Te{constructor(e,n){super(e),this.connectable=n}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const n=e._refCount;if(n<=0)return void(this.connection=null);if(e._refCount=n-1,n>1)return void(this.connection=null);const{connection:a}=this,u=e._connection;this.connection=null,u&&(!a||u===a)&&u.unsubscribe()}}class ss extends Be{constructor(e,n){super(),this.source=e,this.subjectFactory=n,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new W,e.add(this.source.subscribe(new qs(this.getSubject(),this))),e.closed&&(this._connection=null,e=W.EMPTY)),e}refCount(){return $o()(this)}}const Is=(()=>{const t=ss.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}})();class qs extends gt{constructor(e,n){super(e),this.connectable=n}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const n=e._connection;e._refCount=0,e._subject=null,e._connection=null,n&&n.unsubscribe()}}}function ki(t,e){return function(a){let u;if(u="function"==typeof t?t:function(){return t},"function"==typeof e)return a.lift(new Ms(u,e));const m=Object.create(a,Is);return m.source=a,m.subjectFactory=u,m}}class Ms{constructor(e,n){this.subjectFactory=e,this.selector=n}call(e,n){const{selector:a}=this,u=this.subjectFactory(),m=a(u).subscribe(e);return m.add(n.subscribe(u)),m}}function bi(){return new Et}function Yn(t){for(let e in t)if(t[e]===Yn)return e;throw Error("Could not find renamed property on target object.")}function er(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(er).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function Ni(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const Go=Yn({__forward_ref__:Yn});function oe(t){return t.__forward_ref__=oe,t.toString=function(){return er(this())},t}function z(t){return function V(t){return"function"==typeof t&&t.hasOwnProperty(Go)&&t.__forward_ref__===oe}(t)?t():t}class se extends Error{constructor(e,n){super(function De(t,e){return`NG0${Math.abs(t)}${e?": "+e:""}`}(e,n)),this.code=e}}function Ie(t){return"string"==typeof t?t:null==t?"":String(t)}function Oe(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Ie(t)}function It(t,e){const n=e?` in ${e}`:"";throw new se(-201,`No provider for ${Oe(t)} found${n}`)}function pn(t,e){null==t&&function tn(t,e,n,a){throw new Error(`ASSERTION ERROR: ${t}`+(null==a?"":` [Expected=> ${n} ${a} ${e} <=Actual]`))}(e,t,null,"!=")}function gn(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}const cs=gn;function Cr(t){return{providers:t.providers||[],imports:t.imports||[]}}function hi(t){return Dr(t,oo)||Dr(t,Xs)}function Dr(t,e){return t.hasOwnProperty(e)?t[e]:null}function Ws(t){return t&&(t.hasOwnProperty(As)||t.hasOwnProperty(qn))?t[As]:null}const oo=Yn({\u0275prov:Yn}),As=Yn({\u0275inj:Yn}),Xs=Yn({ngInjectableDef:Yn}),qn=Yn({ngInjectorDef:Yn});var xn=(()=>((xn=xn||{})[xn.Default=0]="Default",xn[xn.Host=1]="Host",xn[xn.Self=2]="Self",xn[xn.SkipSelf=4]="SkipSelf",xn[xn.Optional=8]="Optional",xn))();let Po;function Ar(t){const e=Po;return Po=t,e}function gi(t,e,n){const a=hi(t);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:n&xn.Optional?null:void 0!==e?e:void It(er(t),"Injector")}function xr(t){return{toString:t}.toString()}var ii=(()=>((ii=ii||{})[ii.OnPush=0]="OnPush",ii[ii.Default=1]="Default",ii))(),Ri=(()=>(function(t){t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom"}(Ri||(Ri={})),Ri))();const so="undefined"!=typeof globalThis&&globalThis,Ps="undefined"!=typeof window&&window,us="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Fn=so||"undefined"!=typeof global&&global||Ps||us,Se={},Ze=[],_t=Yn({\u0275cmp:Yn}),An=Yn({\u0275dir:Yn}),Xn=Yn({\u0275pipe:Yn}),Xr=Yn({\u0275mod:Yn}),gr=Yn({\u0275fac:Yn}),wr=Yn({__NG_ELEMENT_ID__:Yn});let yo=0;function Sr(t){return xr(()=>{const n={},a={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===ii.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||Ze,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||Ri.Emulated,id:"c",styles:t.styles||Ze,_:null,setInput:null,schemas:t.schemas||null,tView:null},u=t.directives,m=t.features,v=t.pipes;return a.id+=yo++,a.inputs=qo(t.inputs,n),a.outputs=qo(t.outputs),m&&m.forEach(T=>T(a)),a.directiveDefs=u?()=>("function"==typeof u?u():u).map(li):null,a.pipeDefs=v?()=>("function"==typeof v?v():v).map(bl):null,a})}function li(t){return _r(t)||function Bi(t){return t[An]||null}(t)}function bl(t){return function pe(t){return t[Xn]||null}(t)}const ks={};function ci(t){return xr(()=>{const e={type:t.type,bootstrap:t.bootstrap||Ze,declarations:t.declarations||Ze,imports:t.imports||Ze,exports:t.exports||Ze,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(ks[t.id]=t.type),e})}function qo(t,e){if(null==t)return Se;const n={};for(const a in t)if(t.hasOwnProperty(a)){let u=t[a],m=u;Array.isArray(u)&&(m=u[1],u=u[0]),n[u]=a,e&&(e[u]=m)}return n}const ti=Sr;function _r(t){return t[_t]||null}function ze(t,e){const n=t[Xr]||null;if(!n&&!0===e)throw new Error(`Type ${er(t)} does not have '\u0275mod' property.`);return n}function Ro(t){return Array.isArray(t)&&"object"==typeof t[1]}function xo(t){return Array.isArray(t)&&!0===t[1]}function wl(t){return 0!=(8&t.flags)}function Ql(t){return 2==(2&t.flags)}function ec(t){return 1==(1&t.flags)}function Ki(t){return null!==t.template}function Of(t){return 0!=(512&t[2])}function Ua(t,e){return t.hasOwnProperty(gr)?t[gr]:null}class Bf{constructor(e,n,a){this.previousValue=e,this.currentValue=n,this.firstChange=a}isFirstChange(){return this.firstChange}}function hs(){return Xu}function Xu(t){return t.type.prototype.ngOnChanges&&(t.setInput=Cl),Xc}function Xc(){const t=Kc(this),e=null==t?void 0:t.current;if(e){const n=t.previous;if(n===Se)t.previous=e;else for(let a in e)n[a]=e[a];t.current=null,this.ngOnChanges(e)}}function Cl(t,e,n,a){const u=Kc(t)||function Ku(t,e){return t[Dl]=e}(t,{previous:Se,current:null}),m=u.current||(u.current={}),v=u.previous,T=this.declaredInputs[n],I=v[T];m[T]=new Bf(I&&I.currentValue,e,v===Se),t[a]=e}hs.ngInherit=!0;const Dl="__ngSimpleChanges__";function Kc(t){return t[Dl]||null}let va;function Pr(t){return!!t.listen}const Qc={createRenderer:(t,e)=>function $a(){return void 0!==va?va:"undefined"!=typeof document?document:void 0}()};function Ur(t){for(;Array.isArray(t);)t=t[0];return t}function Yi(t,e){return Ur(e[t.index])}function rc(t,e){return t.data[e]}function ji(t,e){const n=e[t];return Ro(n)?n:n[0]}function Js(t){return 4==(4&t[2])}function ic(t){return 128==(128&t[2])}function ds(t,e){return null==e?null:t[e]}function eu(t){t[18]=0}function tu(t,e){t[5]+=e;let n=t,a=t[3];for(;null!==a&&(1===e&&1===n[5]||-1===e&&0===n[5]);)a[5]+=e,n=a,a=a[3]}const bn={lFrame:oh(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Ju(){return bn.bindingsEnabled}function ft(){return bn.lFrame.lView}function rr(){return bn.lFrame.tView}function Ti(){let t=zs();for(;null!==t&&64===t.type;)t=t.parent;return t}function zs(){return bn.lFrame.currentTNode}function Ui(t,e){const n=bn.lFrame;n.currentTNode=t,n.isParent=e}function Wo(){return bn.lFrame.isParent}function qa(){return bn.isInCheckNoChangesMode}function ba(t){bn.isInCheckNoChangesMode=t}function ea(){return bn.lFrame.bindingIndex++}function nh(t,e){const n=bn.lFrame;n.bindingIndex=n.bindingRootIndex=t,Za(e)}function Za(t){bn.lFrame.currentDirectiveIndex=t}function rh(){return bn.lFrame.currentQueryIndex}function ru(t){bn.lFrame.currentQueryIndex=t}function bd(t){const e=t[1];return 2===e.type?e.declTNode:1===e.type?t[6]:null}function iu(t,e,n){if(n&xn.SkipSelf){let u=e,m=t;for(;!(u=u.parent,null!==u||n&xn.Host||(u=bd(m),null===u||(m=m[15],10&u.type))););if(null===u)return!1;e=u,t=m}const a=bn.lFrame=ih();return a.currentTNode=e,a.lView=t,!0}function sc(t){const e=ih(),n=t[1];bn.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function ih(){const t=bn.lFrame,e=null===t?null:t.child;return null===e?oh(t):e}function oh(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function ou(){const t=bn.lFrame;return bn.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const sh=ou;function ac(){const t=ou();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Vi(){return bn.lFrame.selectedIndex}function ta(t){bn.lFrame.selectedIndex=t}function Vr(){const t=bn.lFrame;return rc(t.tView,t.selectedIndex)}function Wa(t,e){for(let n=e.directiveStart,a=e.directiveEnd;n<a;n++){const m=t.data[n].type.prototype,{ngAfterContentInit:v,ngAfterContentChecked:T,ngAfterViewInit:I,ngAfterViewChecked:O,ngOnDestroy:N}=m;v&&(t.contentHooks||(t.contentHooks=[])).push(-n,v),T&&((t.contentHooks||(t.contentHooks=[])).push(n,T),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(n,T)),I&&(t.viewHooks||(t.viewHooks=[])).push(-n,I),O&&((t.viewHooks||(t.viewHooks=[])).push(n,O),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(n,O)),null!=N&&(t.destroyHooks||(t.destroyHooks=[])).push(n,N)}}function Xa(t,e,n){Dd(t,e,3,n)}function Ka(t,e,n,a){(3&t[2])===n&&Dd(t,e,n,a)}function lh(t,e){let n=t[2];(3&n)===e&&(n&=2047,n+=1,t[2]=n)}function Dd(t,e,n,a){const m=null!=a?a:-1,v=e.length-1;let T=0;for(let I=void 0!==a?65535&t[18]:0;I<v;I++)if("number"==typeof e[I+1]){if(T=e[I],null!=a&&T>=a)break}else e[I]<0&&(t[18]+=65536),(T<m||-1==m)&&(ch(t,n,e,I),t[18]=(4294901760&t[18])+I+2),I++}function ch(t,e,n,a){const u=n[a]<0,m=n[a+1],T=t[u?-n[a]:n[a]];if(u){if(t[2]>>11<t[18]>>16&&(3&t[2])===e){t[2]+=2048;try{m.call(T)}finally{}}}else try{m.call(T)}finally{}}class Ya{constructor(e,n,a){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=a}}function co(t,e,n){const a=Pr(t);let u=0;for(;u<n.length;){const m=n[u];if("number"==typeof m){if(0!==m)break;u++;const v=n[u++],T=n[u++],I=n[u++];a?t.setAttribute(e,T,I,v):e.setAttributeNS(v,T,I)}else{const v=m,T=n[++u];el(v)?a&&t.setProperty(e,v,T):a?t.setAttribute(e,v,T):e.setAttribute(v,T),u++}}return u}function kr(t){return 3===t||4===t||6===t}function el(t){return 64===t.charCodeAt(0)}function na(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let a=0;a<e.length;a++){const u=e[a];"number"==typeof u?n=u:0===n||p(t,n,u,null,-1===n||2===n?e[++a]:null)}}return t}function p(t,e,n,a,u){let m=0,v=t.length;if(-1===e)v=-1;else for(;m<t.length;){const T=t[m++];if("number"==typeof T){if(T===e){v=-1;break}if(T>e){v=m-1;break}}}for(;m<t.length;){const T=t[m];if("number"==typeof T)break;if(T===n){if(null===a)return void(null!==u&&(t[m+1]=u));if(a===t[m+1])return void(t[m+2]=u)}m++,null!==a&&m++,null!==u&&m++}-1!==v&&(t.splice(v,0,e),m=v+1),t.splice(m++,0,n),null!==a&&t.splice(m++,0,a),null!==u&&t.splice(m++,0,u)}function i(t){return-1!==t}function d(t){return 32767&t}function b(t,e){let n=function _(t){return t>>16}(t),a=e;for(;n>0;)a=a[15],n--;return a}let w=!0;function C(t){const e=w;return w=t,e}let L=0;function H(t,e){const n=X(t,e);if(-1!==n)return n;const a=e[1];a.firstCreatePass&&(t.injectorIndex=e.length,te(a.data,t),te(e,null),te(a.blueprint,null));const u=G(t,e),m=t.injectorIndex;if(i(u)){const v=d(u),T=b(u,e),I=T[1].data;for(let O=0;O<8;O++)e[m+O]=T[v+O]|I[v+O]}return e[m+8]=u,m}function te(t,e){t.push(0,0,0,0,0,0,0,0,e)}function X(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function G(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,a=null,u=e;for(;null!==u;){const m=u[1],v=m.type;if(a=2===v?m.declTNode:1===v?u[6]:null,null===a)return-1;if(n++,u=u[15],-1!==a.injectorIndex)return a.injectorIndex|n<<16}return-1}function ge(t,e,n){!function B(t,e,n){let a;"string"==typeof n?a=n.charCodeAt(0)||0:n.hasOwnProperty(wr)&&(a=n[wr]),null==a&&(a=n[wr]=L++);const u=255&a;e.data[t+(u>>5)]|=1<<u}(t,e,n)}function fe(t,e,n){if(n&xn.Optional)return t;It(e,"NodeInjector")}function _e(t,e,n,a){if(n&xn.Optional&&void 0===a&&(a=null),0==(n&(xn.Self|xn.Host))){const u=t[9],m=Ar(void 0);try{return u?u.get(e,a,n&xn.Optional):gi(e,a,n&xn.Optional)}finally{Ar(m)}}return fe(a,e,n)}function ve(t,e,n,a=xn.Default,u){if(null!==t){const m=function Je(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(wr)?t[wr]:void 0;return"number"==typeof e?e>=0?255&e:Ce:e}(n);if("function"==typeof m){if(!iu(e,t,a))return a&xn.Host?fe(u,n,a):_e(e,n,a,u);try{const v=m(a);if(null!=v||a&xn.Optional)return v;It(n)}finally{sh()}}else if("number"==typeof m){let v=null,T=X(t,e),I=-1,O=a&xn.Host?e[16][6]:null;for((-1===T||a&xn.SkipSelf)&&(I=-1===T?G(t,e):e[T+8],-1!==I&&je(a,!1)?(v=e[1],T=d(I),e=b(I,e)):T=-1);-1!==T;){const N=e[1];if(Dt(m,T,N.data)){const Z=Ue(T,e,n,v,a,O);if(Z!==he)return Z}I=e[T+8],-1!==I&&je(a,e[1].data[T+8]===O)&&Dt(m,T,e)?(v=N,T=d(I),e=b(I,e)):T=-1}}}return _e(e,n,a,u)}const he={};function Ce(){return new yt(Ti(),ft())}function Ue(t,e,n,a,u,m){const v=e[1],T=v.data[t+8],N=We(T,v,n,null==a?Ql(T)&&w:a!=v&&0!=(3&T.type),u&xn.Host&&m===T);return null!==N?et(e,v,N,T):he}function We(t,e,n,a,u){const m=t.providerIndexes,v=e.data,T=1048575&m,I=t.directiveStart,N=m>>20,ye=u?T+N:t.directiveEnd;for(let be=a?T:T+N;be<ye;be++){const Ge=v[be];if(be<I&&n===Ge||be>=I&&Ge.type===n)return be}if(u){const be=v[I];if(be&&Ki(be)&&be.type===n)return I}return null}function et(t,e,n,a){let u=t[n];const m=e.data;if(function uh(t){return t instanceof Ya}(u)){const v=u;v.resolving&&function ke(t,e){const n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new se(-200,`Circular dependency in DI detected for ${t}${n}`)}(Oe(m[n]));const T=C(v.canSeeViewProviders);v.resolving=!0;const I=v.injectImpl?Ar(v.injectImpl):null;iu(t,a,xn.Default);try{u=t[n]=v.factory(void 0,m,t,a),e.firstCreatePass&&n>=a.directiveStart&&function Cd(t,e,n){const{ngOnChanges:a,ngOnInit:u,ngDoCheck:m}=e.type.prototype;if(a){const v=Xu(e);(n.preOrderHooks||(n.preOrderHooks=[])).push(t,v),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,v)}u&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-t,u),m&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t,m),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,m))}(n,m[n],e)}finally{null!==I&&Ar(I),C(T),v.resolving=!1,sh()}}return u}function Dt(t,e,n){return!!(n[e+(t>>5)]&1<<t)}function je(t,e){return!(t&xn.Self||t&xn.Host&&e)}class yt{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,a){return ve(this._tNode,this._lView,e,a,n)}}function Ke(t){return function ae(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const n=t.attrs;if(n){const a=n.length;let u=0;for(;u<a;){const m=n[u];if(kr(m))break;if(0===m)u+=2;else if("number"==typeof m)for(u++;u<a&&"string"==typeof n[u];)u++;else{if(m===e)return n[u+1];u+=2}}}return null}(Ti(),t)}const Qt="__parameters__";function En(t,e,n){return xr(()=>{const a=function an(t){return function(...n){if(t){const a=t(...n);for(const u in a)this[u]=a[u]}}}(e);function u(...m){if(this instanceof u)return a.apply(this,m),this;const v=new u(...m);return T.annotation=v,T;function T(I,O,N){const Z=I.hasOwnProperty(Qt)?I[Qt]:Object.defineProperty(I,Qt,{value:[]})[Qt];for(;Z.length<=N;)Z.push(null);return(Z[N]=Z[N]||[]).push(v),I}}return n&&(u.prototype=Object.create(n.prototype)),u.prototype.ngMetadataName=t,u.annotationCls=u,u})}class Yt{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=gn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const ri=new Yt("AnalyzeForEntryComponents");function si(t,e){void 0===e&&(e=t);for(let n=0;n<t.length;n++){let a=t[n];Array.isArray(a)?(e===t&&(e=t.slice(0,n)),si(a,e)):e!==t&&e.push(a)}return e}function wo(t,e){t.forEach(n=>Array.isArray(n)?wo(n,e):e(n))}function Eo(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Bs(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}const Fo={},Ea="__NG_DI_FLAG__",ra="ngTempTokenPath",ly=/\n/gm,Fm="__source",uy=Yn({provide:String,useValue:Yn});let cu;function gh(t){const e=cu;return cu=t,e}function ia(t,e=xn.Default){if(void 0===cu)throw new se(203,"");return null===cu?gi(t,void 0,e):cu.get(t,e&xn.Optional?null:void 0,e)}function hn(t,e=xn.Default){return(function Wr(){return Po}()||ia)(z(t),e)}const ai=hn;function In(t){const e=[];for(let n=0;n<t.length;n++){const a=z(t[n]);if(Array.isArray(a)){if(0===a.length)throw new se(900,"");let u,m=xn.Default;for(let v=0;v<a.length;v++){const T=a[v],I=$f(T);"number"==typeof I?-1===I?u=T.token:m|=I:u=T}e.push(hn(u,m))}else e.push(hn(a))}return e}function js(t,e){return t[Ea]=e,t.prototype[Ea]=e,t}function $f(t){return t[Ea]}const uu=js(En("Inject",t=>({token:t})),-1),Us=js(En("Optional"),8),Ta=js(En("SkipSelf"),4);class xh{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const bh=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Xm=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Di=(()=>((Di=Di||{})[Di.NONE=0]="NONE",Di[Di.HTML=1]="HTML",Di[Di.STYLE=2]="STYLE",Di[Di.SCRIPT=3]="SCRIPT",Di[Di.URL=4]="URL",Di[Di.RESOURCE_URL=5]="RESOURCE_URL",Di))();function Th(t){const e=function Ch(){const t=ft();return t&&t[12]}();return e?e.sanitize(Di.URL,t)||"":function du(t,e){const n=function Ca(t){return t instanceof xh&&t.getTypeName()||null}(t);if(null!=n&&n!==e){if("ResourceURL"===n&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===e}(t,"URL")?function Ci(t){return t instanceof xh?t.changingThisBreaksApplicationSecurity:t}(t):function wh(t){return(t=String(t)).match(bh)||t.match(Xm)?t:"unsafe:"+t}(Ie(t))}const _u="__ngContext__";function To(t,e){t[_u]=e}function op(t){const e=function Dh(t){return t[_u]||null}(t);return e?Array.isArray(e)?e:e.lView:null}function vu(t){return t.ngOriginalError}function rg(t,...e){t.error(...e)}class xu{constructor(){this._console=console}handleError(e){const n=this._findOriginalError(e),a=function Sh(t){return t&&t.ngErrorLogger||rg}(e);a(this._console,"ERROR",e),n&&a(this._console,"ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&vu(e);for(;n&&vu(n);)n=vu(n);return n||null}}const up=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Fn))();function Sa(t){return t instanceof Function?t():t}var gs=(()=>((gs=gs||{})[gs.Important=1]="Important",gs[gs.DashCase=2]="DashCase",gs))();function Nd(t,e){return undefined(t,e)}function Ah(t){const e=t[3];return xo(e)?e[3]:e}function fp(t){return Eu(t[13])}function pp(t){return Eu(t[4])}function Eu(t){for(;null!==t&&!xo(t);)t=t[4];return t}function _c(t,e,n,a,u){if(null!=a){let m,v=!1;xo(a)?m=a:Ro(a)&&(v=!0,a=a[0]);const T=Ur(a);0===t&&null!==n?null==u?fg(e,n,T):xc(e,n,T,u||null,!0):1===t&&null!==n?xc(e,n,T,u||null,!0):2===t?function mg(t,e,n){const a=kh(t,e);a&&function Uy(t,e,n,a){Pr(t)?t.removeChild(e,n,a):e.removeChild(n)}(t,a,e,n)}(e,T,v):3===t&&e.destroyNode(T),null!=m&&function vp(t,e,n,a,u){const m=n[7];m!==Ur(n)&&_c(e,t,a,m,u);for(let T=10;T<n.length;T++){const I=n[T];Su(I[1],I,t,e,a,m)}}(e,t,m,n,u)}}function vc(t,e,n){if(Pr(t))return t.createElement(e,n);{const a=null!==n?function fd(t){const e=t.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(n):null;return null===a?t.createElement(e):t.createElementNS(a,e)}}function ug(t,e){const n=t[9],a=n.indexOf(e),u=e[3];1024&e[2]&&(e[2]&=-1025,tu(u,-1)),n.splice(a,1)}function mp(t,e){if(t.length<=10)return;const n=10+e,a=t[n];if(a){const u=a[17];null!==u&&u!==t&&ug(u,a),e>0&&(t[n-1][4]=a[4]);const m=Bs(t,10+e);!function lg(t,e){Su(t,e,e[11],2,null,null),e[0]=null,e[6]=null}(a[1],a);const v=m[19];null!==v&&v.detachView(m[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function hg(t,e){if(!(256&e[2])){const n=e[11];Pr(n)&&n.destroyNode&&Su(t,e,n,3,null,null),function zy(t){let e=t[13];if(!e)return Tu(t[1],t);for(;e;){let n=null;if(Ro(e))n=e[13];else{const a=e[10];a&&(n=a)}if(!n){for(;e&&!e[4]&&e!==t;)Ro(e)&&Tu(e[1],e),e=e[3];null===e&&(e=t),Ro(e)&&Tu(e[1],e),n=e&&e[4]}e=n}}(e)}}function Tu(t,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function dg(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let a=0;a<n.length;a+=2){const u=e[n[a]];if(!(u instanceof Ya)){const m=n[a+1];if(Array.isArray(m))for(let v=0;v<m.length;v+=2){const T=u[m[v]],I=m[v+1];try{I.call(T)}finally{}}else try{m.call(u)}finally{}}}}(t,e),function jy(t,e){const n=t.cleanup,a=e[7];let u=-1;if(null!==n)for(let m=0;m<n.length-1;m+=2)if("string"==typeof n[m]){const v=n[m+1],T="function"==typeof v?v(e):Ur(e[v]),I=a[u=n[m+2]],O=n[m+3];"boolean"==typeof O?T.removeEventListener(n[m],I,O):O>=0?a[u=O]():a[u=-O].unsubscribe(),m+=2}else{const v=a[u=n[m+1]];n[m].call(v)}if(null!==a){for(let m=u+1;m<a.length;m++)a[m]();e[7]=null}}(t,e),1===e[1].type&&Pr(e[11])&&e[11].destroy();const n=e[17];if(null!==n&&xo(e[3])){n!==e[3]&&ug(n,e);const a=e[19];null!==a&&a.detachView(t)}}}function gp(t,e,n){return function _p(t,e,n){let a=e;for(;null!==a&&40&a.type;)a=(e=a).parent;if(null===a)return n[0];if(2&a.flags){const u=t.data[a.directiveStart].encapsulation;if(u===Ri.None||u===Ri.Emulated)return null}return Yi(a,n)}(t,e.parent,n)}function xc(t,e,n,a,u){Pr(t)?t.insertBefore(e,n,a,u):e.insertBefore(n,a,u)}function fg(t,e,n){Pr(t)?t.appendChild(e,n):e.appendChild(n)}function pg(t,e,n,a,u){null!==a?xc(t,e,n,a,u):fg(t,e,n)}function kh(t,e){return Pr(t)?t.parentNode(e):e.parentNode}let jd=function oa(t,e,n){return 40&t.type?Yi(t,n):null};function Ud(t,e,n,a){const u=gp(t,a,e),m=e[11],T=function Hi(t,e,n){return jd(t,e,n)}(a.parent||e[6],a,e);if(null!=u)if(Array.isArray(n))for(let I=0;I<n.length;I++)pg(m,u,n[I],T,!1);else pg(m,u,n,T,!1)}function Vd(t,e){if(null!==e){const n=e.type;if(3&n)return Yi(e,t);if(4&n)return yp(-1,t[e.index]);if(8&n){const a=e.child;if(null!==a)return Vd(t,a);{const u=t[e.index];return xo(u)?yp(-1,u):Ur(u)}}if(32&n)return Nd(e,t)()||Ur(t[e.index]);{const a=Du(t,e);return null!==a?Array.isArray(a)?a[0]:Vd(Ah(t[16]),a):Vd(t,e.next)}}return null}function Du(t,e){return null!==e?t[16][6].projection[e.projection]:null}function yp(t,e){const n=10+t+1;if(n<e.length){const a=e[n],u=a[1].firstChild;if(null!==u)return Vd(a,u)}return e[7]}function $d(t,e,n,a,u,m,v){for(;null!=n;){const T=a[n.index],I=n.type;if(v&&0===e&&(T&&To(Ur(T),a),n.flags|=4),64!=(64&n.flags))if(8&I)$d(t,e,n.child,a,u,m,!1),_c(e,t,u,T,m);else if(32&I){const O=Nd(n,a);let N;for(;N=O();)_c(e,t,u,N,m);_c(e,t,u,T,m)}else 16&I?Mr(t,e,a,n,u,m):_c(e,t,u,T,m);n=v?n.projectionNext:n.next}}function Su(t,e,n,a,u,m){$d(n,a,t.firstChild,e,u,m,!1)}function Mr(t,e,n,a,u,m){const v=n[16],I=v[6].projection[a.projection];if(Array.isArray(I))for(let O=0;O<I.length;O++)_c(e,t,u,I[O],m);else $d(t,e,I,v[3],u,m,!0)}function xp(t,e,n){Pr(t)?t.setAttribute(e,"style",n):e.style.cssText=n}function sa(t,e,n){Pr(t)?""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n):e.className=n}function wc(t,e,n){let a=t.length;for(;;){const u=t.indexOf(e,n);if(-1===u)return u;if(0===u||t.charCodeAt(u-1)<=32){const m=e.length;if(u+m===a||t.charCodeAt(u+m)<=32)return u}n=u+1}}const _g="ng-template";function Gy(t,e,n){let a=0;for(;a<t.length;){let u=t[a++];if(n&&"class"===u){if(u=t[a],-1!==wc(u.toLowerCase(),e,0))return!0}else if(1===u){for(;a<t.length&&"string"==typeof(u=t[a++]);)if(u.toLowerCase()===e)return!0;return!1}}return!1}function yg(t){return 4===t.type&&t.value!==_g}function Hy(t,e,n){return e===(4!==t.type||n?t.value:_g)}function qy(t,e,n){let a=4;const u=t.attrs||[],m=function Gd(t){for(let e=0;e<t.length;e++)if(kr(t[e]))return e;return t.length}(u);let v=!1;for(let T=0;T<e.length;T++){const I=e[T];if("number"!=typeof I){if(!v)if(4&a){if(a=2|1&a,""!==I&&!Hy(t,I,n)||""===I&&1===e.length){if(aa(a))return!1;v=!0}}else{const O=8&a?I:e[++T];if(8&a&&null!==t.attrs){if(!Gy(t.attrs,O,n)){if(aa(a))return!1;v=!0}continue}const Z=Zy(8&a?"class":I,u,yg(t),n);if(-1===Z){if(aa(a))return!1;v=!0;continue}if(""!==O){let ye;ye=Z>m?"":u[Z+1].toLowerCase();const be=8&a?ye:null;if(be&&-1!==wc(be,O,0)||2&a&&O!==ye){if(aa(a))return!1;v=!0}}}}else{if(!v&&!aa(a)&&!aa(I))return!1;if(v&&aa(I))continue;v=!1,a=I|1&a}}return aa(a)||v}function aa(t){return 0==(1&t)}function Zy(t,e,n,a){if(null===e)return-1;let u=0;if(a||!n){let m=!1;for(;u<e.length;){const v=e[u];if(v===t)return u;if(3===v||6===v)m=!0;else{if(1===v||2===v){let T=e[++u];for(;"string"==typeof T;)T=e[++u];continue}if(4===v)break;if(0===v){u+=4;continue}}u+=m?1:2}return-1}return function Iu(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){const a=t[n];if("number"==typeof a)return-1;if(a===e)return n;n++}return-1}(e,t)}function vg(t,e,n=!1){for(let a=0;a<e.length;a++)if(qy(t,e[a],n))return!0;return!1}function bg(t,e){return t?":not("+e.trim()+")":e}function Xy(t){let e=t[0],n=1,a=2,u="",m=!1;for(;n<t.length;){let v=t[n];if("string"==typeof v)if(2&a){const T=t[++n];u+="["+v+(T.length>0?'="'+T+'"':"")+"]"}else 8&a?u+="."+v:4&a&&(u+=" "+v);else""!==u&&!aa(v)&&(e+=bg(m,u),u=""),a=v,m=m||!aa(a);n++}return""!==u&&(e+=bg(m,u)),e}const $n={};function Ec(t){es(rr(),ft(),Vi()+t,qa())}function es(t,e,n,a){if(!a)if(3==(3&e[2])){const m=t.preOrderCheckHooks;null!==m&&Xa(e,m,n)}else{const m=t.preOrderHooks;null!==m&&Ka(e,m,0,n)}ta(n)}function zh(t,e){const n=t.contentQueries;if(null!==n)for(let a=0;a<n.length;a+=2){const u=n[a],m=n[a+1];if(-1!==m){const v=t.data[m];ru(u),v.contentQueries(2,e[m],m)}}}function Cc(t,e,n,a,u,m,v,T,I,O){const N=e.blueprint.slice();return N[0]=u,N[2]=140|a,eu(N),N[3]=N[15]=t,N[8]=n,N[10]=v||t&&t[10],N[11]=T||t&&t[11],N[12]=I||t&&t[12]||null,N[9]=O||t&&t[9]||null,N[6]=m,N[16]=2==e.type?t[16]:N,N}function Ul(t,e,n,a,u){let m=t.data[e];if(null===m)m=function Ma(t,e,n,a,u){const m=zs(),v=Wo(),I=t.data[e]=function lv(t,e,n,a,u,m){return{type:n,index:a,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:u,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,v?m:m&&m.parent,n,e,a,u);return null===t.firstChild&&(t.firstChild=I),null!==m&&(v?null==m.child&&null!==I.parent&&(m.child=I):null===m.next&&(m.next=I)),I}(t,e,n,a,u),function eh(){return bn.lFrame.inI18n}()&&(m.flags|=64);else if(64&m.type){m.type=n,m.value=a,m.attrs=u;const v=function Sl(){const t=bn.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();m.injectorIndex=null===v?-1:v.injectorIndex}return Ui(m,!0),m}function Pu(t,e,n,a){if(0===n)return-1;const u=e.length;for(let m=0;m<n;m++)e.push(a),t.blueprint.push(a),t.data.push(null);return u}function Dc(t,e,n){sc(e);try{const a=t.viewQuery;null!==a&&df(1,a,n);const u=t.template;null!==u&&Mg(t,e,u,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&zh(t,e),t.staticViewQueries&&df(2,t.viewQuery,n);const m=t.components;null!==m&&function av(t,e){for(let n=0;n<e.length;n++)Aa(t,e[n])}(e,m)}catch(a){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),a}finally{e[2]&=-5,ac()}}function Sc(t,e,n,a){const u=e[2];if(256==(256&u))return;sc(e);const m=qa();try{eu(e),function Qu(t){return bn.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==n&&Mg(t,e,n,2,a);const v=3==(3&u);if(!m)if(v){const O=t.preOrderCheckHooks;null!==O&&Xa(e,O,null)}else{const O=t.preOrderHooks;null!==O&&Ka(e,O,0,null),lh(e,0)}if(function hv(t){for(let e=fp(t);null!==e;e=pp(e)){if(!e[2])continue;const n=e[9];for(let a=0;a<n.length;a++){const u=n[a],m=u[3];0==(1024&u[2])&&tu(m,1),u[2]|=1024}}}(e),function Ug(t){for(let e=fp(t);null!==e;e=pp(e))for(let n=10;n<e.length;n++){const a=e[n],u=a[1];ic(a)&&Sc(u,a,u.template,a[8])}}(e),null!==t.contentQueries&&zh(t,e),!m)if(v){const O=t.contentCheckHooks;null!==O&&Xa(e,O)}else{const O=t.contentHooks;null!==O&&Ka(e,O,1),lh(e,1)}!function sv(t,e){const n=t.hostBindingOpCodes;if(null!==n)try{for(let a=0;a<n.length;a++){const u=n[a];if(u<0)ta(~u);else{const m=u,v=n[++a],T=n[++a];nh(v,m),T(2,e[m])}}}finally{ta(-1)}}(t,e);const T=t.components;null!==T&&function Mp(t,e){for(let n=0;n<e.length;n++)Vg(t,e[n])}(e,T);const I=t.viewQuery;if(null!==I&&df(2,I,a),!m)if(v){const O=t.viewCheckHooks;null!==O&&Xa(e,O)}else{const O=t.viewHooks;null!==O&&Ka(e,O,2),lh(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),m||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,tu(e[3],-1))}finally{ac()}}function rf(t,e,n,a){const u=e[10],m=!qa(),v=Js(e);try{m&&!v&&u.begin&&u.begin(),v&&Dc(t,e,a),Sc(t,e,n,a)}finally{m&&!v&&u.end&&u.end()}}function Mg(t,e,n,a,u){const m=Vi(),v=2&a;try{ta(-1),v&&e.length>20&&es(t,e,20,qa()),n(a,u)}finally{ta(m)}}function of(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=sf(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function sf(t,e,n,a,u,m,v,T,I,O){const N=20+a,Z=N+u,ye=function Nh(t,e){const n=[];for(let a=0;a<e;a++)n.push(a<t?null:$n);return n}(N,Z),be="function"==typeof O?O():O;return ye[1]={type:t,blueprint:ye,template:n,queries:null,viewQuery:T,declTNode:e,data:ye.slice().fill(null,N),bindingStartIndex:N,expandoStartIndex:Z,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof v?v():v,firstChild:null,schemas:I,consts:be,incompleteFirstPass:!1}}function kp(t,e,n,a){const u=Up(e);null===n?u.push(a):(u.push(n),t.firstCreatePass&&Vp(t).push(a,u.length-1))}function kg(t,e,n){for(let a in t)if(t.hasOwnProperty(a)){const u=t[a];(n=null===n?{}:n).hasOwnProperty(a)?n[a].push(e,u):n[a]=[e,u]}return n}function Lg(t,e,n,a,u,m){const v=m.hostBindings;if(v){let T=t.hostBindingOpCodes;null===T&&(T=t.hostBindingOpCodes=[]);const I=~e.index;(function Op(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(T)!=I&&T.push(I),T.push(a,u,v)}}function Lp(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function zp(t,e){e.flags|=2,(t.components||(t.components=[])).push(e.index)}function Ng(t,e,n){if(n){if(e.exportAs)for(let a=0;a<e.exportAs.length;a++)n[e.exportAs[a]]=t;Ki(e)&&(n[""]=t)}}function Np(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function Bg(t,e,n,a,u){t.data[a]=u;const m=u.factory||(u.factory=Ua(u.type)),v=new Ya(m,Ki(u),null);t.blueprint[a]=v,n[a]=v,Lg(t,e,0,a,Pu(t,n,u.hostVars,$n),u)}function uv(t,e,n){const a=Yi(e,t),u=of(n),m=t[10],v=xs(t,Cc(t,u,null,n.onPush?64:16,a,e,m,m.createRenderer(a,n),null,null));t[e.index]=v}function ua(t,e,n,a,u,m){const v=Yi(t,e);!function Ru(t,e,n,a,u,m,v){if(null==m)Pr(t)?t.removeAttribute(e,u,n):e.removeAttribute(u);else{const T=null==v?Ie(m):v(m,a||"",u);Pr(t)?t.setAttribute(e,u,T,n):n?e.setAttributeNS(n,u,T):e.setAttribute(u,T)}}(e[11],v,m,t.value,n,a,u)}function jg(t,e,n,a,u,m){const v=m[e];if(null!==v){const T=a.setInput;for(let I=0;I<v.length;){const O=v[I++],N=v[I++],Z=v[I++];null!==T?a.setInput(n,Z,O,N):n[N]=Z}}}function Co(t,e){let n=null,a=0;for(;a<e.length;){const u=e[a];if(0!==u)if(5!==u){if("number"==typeof u)break;t.hasOwnProperty(u)&&(null===n&&(n=[]),n.push(u,t[u],e[a+1])),a+=2}else a+=2;else a+=4}return n}function Vg(t,e){const n=ji(e,t);if(ic(n)){const a=n[1];80&n[2]?Sc(a,n,a.template,n[8]):n[5]>0&&ns(n)}}function ns(t){for(let a=fp(t);null!==a;a=pp(a))for(let u=10;u<a.length;u++){const m=a[u];if(1024&m[2]){const v=m[1];Sc(v,m,v.template,m[8])}else m[5]>0&&ns(m)}const n=t[1].components;if(null!==n)for(let a=0;a<n.length;a++){const u=ji(n[a],t);ic(u)&&u[5]>0&&ns(u)}}function Aa(t,e){const n=ji(e,t),a=n[1];(function $l(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])})(a,n),Dc(a,n,n[8])}function xs(t,e){return t[13]?t[14][4]=e:t[13]=e,t[14]=e,e}function Pa(t){for(;t;){t[2]|=64;const e=Ah(t);if(Of(t)&&!e)return t;t=e}return null}function hf(t,e,n){const a=e[10];a.begin&&a.begin();try{Sc(t,e,t.template,n)}catch(u){throw Gp(e,u),u}finally{a.end&&a.end()}}function Bp(t){!function uf(t){for(let e=0;e<t.components.length;e++){const n=t.components[e],a=op(n),u=a[1];rf(u,a,u.template,n)}}(t[8])}function df(t,e,n){ru(0),e(t,n)}const $g=(()=>Promise.resolve(null))();function Up(t){return t[7]||(t[7]=[])}function Vp(t){return t.cleanup||(t.cleanup=[])}function Gp(t,e){const n=t[9],a=n?n.get(xu,null):null;a&&a.handleError(e)}function ul(t,e,n,a,u){for(let m=0;m<n.length;){const v=n[m++],T=n[m++],I=e[v],O=t.data[v];null!==O.setInput?O.setInput(I,u,a,T):I[T]=u}}function ka(t,e,n){const a=function Ha(t,e){return Ur(e[t])}(e,t);!function ag(t,e,n){Pr(t)?t.setValue(e,n):e.textContent=n}(t[11],a,n)}function Mc(t,e,n){let a=n?t.styles:null,u=n?t.classes:null,m=0;if(null!==e)for(let v=0;v<e.length;v++){const T=e[v];"number"==typeof T?m=T:1==m?u=Ni(u,T):2==m&&(a=Ni(a,T+": "+e[++v]+";"))}n?t.styles=a:t.stylesWithoutHost=a,n?t.classes=u:t.classesWithoutHost=u}const jh=new Yt("INJECTOR",-1);class ha{get(e,n=Fo){if(n===Fo){const a=new Error(`NullInjectorError: No provider for ${er(e)}!`);throw a.name="NullInjectorError",a}return n}}const Uh=new Yt("Set Injector scope."),Ac={},da={};let hl;function Hp(){return void 0===hl&&(hl=new ha),hl}function qp(t,e=null,n=null,a){const u=Vh(t,e,n,a);return u._resolveInjectorDefTypes(),u}function Vh(t,e=null,n=null,a){return new Hg(t,n,e||Hp(),a)}class Hg{constructor(e,n,a,u=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const m=[];n&&wo(n,T=>this.processProvider(T,e,n)),wo([e],T=>this.processInjectorType(T,[],m)),this.records.set(jh,Gl(void 0,this));const v=this.records.get(Uh);this.scope=null!=v?v.value:null,this.source=u||("object"==typeof e?null:er(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,n=Fo,a=xn.Default){this.assertNotDestroyed();const u=gh(this),m=Ar(void 0);try{if(!(a&xn.SkipSelf)){let T=this.records.get(e);if(void 0===T){const I=function Gh(t){return"function"==typeof t||"object"==typeof t&&t instanceof Yt}(e)&&hi(e);T=I&&this.injectableDefInScope(I)?Gl(ff(e),Ac):null,this.records.set(e,T)}if(null!=T)return this.hydrate(e,T)}return(a&xn.Self?Hp():this.parent).get(e,n=a&xn.Optional&&n===Fo?null:n)}catch(v){if("NullInjectorError"===v.name){if((v[ra]=v[ra]||[]).unshift(er(e)),u)throw v;return function Er(t,e,n,a){const u=t[ra];throw e[Fm]&&u.unshift(e[Fm]),t.message=function Nm(t,e,n,a=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let u=er(e);if(Array.isArray(e))u=e.map(er).join(" -> ");else if("object"==typeof e){let m=[];for(let v in e)if(e.hasOwnProperty(v)){let T=e[v];m.push(v+":"+("string"==typeof T?JSON.stringify(T):er(T)))}u=`{${m.join(", ")}}`}return`${n}${a?"("+a+")":""}[${u}]: ${t.replace(ly,"\n  ")}`}("\n"+t.message,u,n,a),t.ngTokenPath=u,t[ra]=null,t}(v,e,"R3InjectorError",this.source)}throw v}finally{Ar(m),gh(u)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((a,u)=>e.push(er(u))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new se(205,!1)}processInjectorType(e,n,a){if(!(e=z(e)))return!1;let u=Ws(e);const m=null==u&&e.ngModule||void 0,v=void 0===m?e:m,T=-1!==a.indexOf(v);if(void 0!==m&&(u=Ws(m)),null==u)return!1;if(null!=u.imports&&!T){let N;a.push(v);try{wo(u.imports,Z=>{this.processInjectorType(Z,n,a)&&(void 0===N&&(N=[]),N.push(Z))})}finally{}if(void 0!==N)for(let Z=0;Z<N.length;Z++){const{ngModule:ye,providers:be}=N[Z];wo(be,Ge=>this.processProvider(Ge,ye,be||Ze))}}this.injectorDefTypes.add(v);const I=Ua(v)||(()=>new v);this.records.set(v,Gl(I,Ac));const O=u.providers;if(null!=O&&!T){const N=e;wo(O,Z=>this.processProvider(Z,N,O))}return void 0!==m&&void 0!==e.providers}processProvider(e,n,a){let u=bs(e=z(e))?e:z(e&&e.provide);const m=function qg(t,e,n){return Zp(t)?Gl(void 0,t.useValue):Gl(function Zg(t,e,n){let a;if(bs(t)){const u=z(t);return Ua(u)||ff(u)}if(Zp(t))a=()=>z(t.useValue);else if(function gv(t){return!(!t||!t.useFactory)}(t))a=()=>t.useFactory(...In(t.deps||[]));else if(function Wg(t){return!(!t||!t.useExisting)}(t))a=()=>hn(z(t.useExisting));else{const u=z(t&&(t.useClass||t.provide));if(!function yv(t){return!!t.deps}(t))return Ua(u)||ff(u);a=()=>new u(...In(t.deps))}return a}(t),Ac)}(e);if(bs(e)||!0!==e.multi)this.records.get(u);else{let v=this.records.get(u);v||(v=Gl(void 0,Ac,!0),v.factory=()=>In(v.multi),this.records.set(u,v)),u=e,v.multi.push(e)}this.records.set(u,m)}hydrate(e,n){return n.value===Ac&&(n.value=da,n.value=n.factory()),"object"==typeof n.value&&n.value&&function $h(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(e){if(!e.providedIn)return!1;const n=z(e.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function ff(t){const e=hi(t),n=null!==e?e.factory:Ua(t);if(null!==n)return n;if(t instanceof Yt)throw new se(204,!1);if(t instanceof Function)return function mv(t){const e=t.length;if(e>0)throw function Ml(t,e){const n=[];for(let a=0;a<t;a++)n.push(e);return n}(e,"?"),new se(204,!1);const n=function Kl(t){const e=t&&(t[oo]||t[Xs]);if(e){const n=function Xi(t){if(t.hasOwnProperty("name"))return t.name;const e=(""+t).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),e}return null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new se(204,!1)}function Gl(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function Zp(t){return null!==t&&"object"==typeof t&&uy in t}function bs(t){return"function"==typeof t}let qi=(()=>{class t{static create(n,a){var u;if(Array.isArray(n))return qp({name:""},a,n,"");{const m=null!==(u=n.name)&&void 0!==u?u:"";return qp({name:m},n.parent,n.providers,m)}}}return t.THROW_IF_NOT_FOUND=Fo,t.NULL=new ha,t.\u0275prov=gn({token:t,providedIn:"any",factory:()=>hn(jh)}),t.__NG_ELEMENT_ID__=-1,t})();function q(t,e){Wa(op(t)[1],Ti())}let qe=null;function tt(){if(!qe){const t=Fn.Symbol;if(t&&t.iterator)qe=t.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<e.length;++n){const a=e[n];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(qe=a)}}}return qe}function ln(t,e,n){return!Object.is(t[e],n)&&(t[e]=n,!0)}function Zt(t,e,n,a){const u=ln(t,e,n);return ln(t,e+1,a)||u}function ar(t,e,n,a){const u=ft();return ln(u,ea(),e)&&(rr(),ua(Vr(),u,t,e,n,a)),ar}function Un(t,e,n,a,u,m,v,T,I,O){const Z=function Sn(t,e,n,a,u,m){const v=Zt(t,e,n,a);return Zt(t,e+2,u,m)||v}(t,function fs(){return bn.lFrame.bindingIndex}(),n,u,v,I);return function Oo(t){const e=bn.lFrame,n=e.bindingIndex;return e.bindingIndex=e.bindingIndex+t,n}(4),Z?e+Ie(n)+a+Ie(u)+m+Ie(v)+T+Ie(I)+O:$n}function Tn(t,e=xn.Default){const n=ft();return null===n?hn(t,e):ve(Ti(),n,z(t),e)}function Cv(){throw new Error("invalid")}function Qp(t,e,n){const a=ft();return ln(a,ea(),e)&&function ts(t,e,n,a,u,m,v,T){const I=Yi(e,n);let N,O=e.inputs;!T&&null!=O&&(N=O[a])?(ul(t,n,N,a,u),Ql(e)&&function Bh(t,e){const n=ji(e,t);16&n[2]||(n[2]|=64)}(n,e.index)):3&e.type&&(a=function Rg(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(a),u=null!=v?v(u,e.value||"",a):u,Pr(m)?m.setProperty(I,a,u):el(a)||(I.setProperty?I.setProperty(a,u):I[a]=u))}(rr(),Vr(),a,t,e,a[11],n,!1),Qp}function Dv(t,e,n,a,u){const v=u?"class":"style";ul(t,n,e.inputs[v],v,a)}function is(t,e,n,a){const u=ft(),m=rr(),v=20+t,T=u[11],I=u[v]=vc(T,e,function Td(){return bn.lFrame.currentNamespace}()),O=m.firstCreatePass?function OT(t,e,n,a,u,m,v){const T=e.consts,O=Ul(e,t,2,u,ds(T,m));return function Ic(t,e,n,a){let u=!1;if(Ju()){const m=function Fp(t,e,n){const a=t.directiveRegistry;let u=null;if(a)for(let m=0;m<a.length;m++){const v=a[m];vg(n,v.selectors,!1)&&(u||(u=[]),ge(H(n,e),t,v.type),Ki(v)?(zp(t,n),u.unshift(v)):u.push(v))}return u}(t,e,n),v=null===a?null:{"":-1};if(null!==m){u=!0,Np(n,t.data.length,m.length);for(let N=0;N<m.length;N++){const Z=m[N];Z.providersResolver&&Z.providersResolver(Z)}let T=!1,I=!1,O=Pu(t,e,m.length,null);for(let N=0;N<m.length;N++){const Z=m[N];n.mergedAttrs=na(n.mergedAttrs,Z.hostAttrs),Bg(t,n,e,O,Z),Ng(O,Z,v),null!==Z.contentQueries&&(n.flags|=8),(null!==Z.hostBindings||null!==Z.hostAttrs||0!==Z.hostVars)&&(n.flags|=128);const ye=Z.type.prototype;!T&&(ye.ngOnChanges||ye.ngOnInit||ye.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n.index),T=!0),!I&&(ye.ngOnChanges||ye.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n.index),I=!0),O++}!function cv(t,e){const a=e.directiveEnd,u=t.data,m=e.attrs,v=[];let T=null,I=null;for(let O=e.directiveStart;O<a;O++){const N=u[O],Z=N.inputs,ye=null===m||yg(e)?null:Co(Z,m);v.push(ye),T=kg(Z,O,T),I=kg(N.outputs,O,I)}null!==T&&(T.hasOwnProperty("class")&&(e.flags|=16),T.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=v,e.inputs=T,e.outputs=I}(t,n)}v&&function zg(t,e,n){if(e){const a=t.localNames=[];for(let u=0;u<e.length;u+=2){const m=n[e[u+1]];if(null==m)throw new se(-301,!1);a.push(e[u],m)}}}(n,a,v)}return n.mergedAttrs=na(n.mergedAttrs,n.attrs),u}(e,n,O,ds(T,v)),null!==O.attrs&&Mc(O,O.attrs,!1),null!==O.mergedAttrs&&Mc(O,O.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,O),O}(v,m,u,0,e,n,a):m.data[v];Ui(O,!0);const N=O.mergedAttrs;null!==N&&co(T,I,N);const Z=O.classes;null!==Z&&sa(T,I,Z);const ye=O.styles;return null!==ye&&xp(T,I,ye),64!=(64&O.flags)&&Ud(m,u,I,O),0===function _d(){return bn.lFrame.elementDepthCount}()&&To(I,u),function yd(){bn.lFrame.elementDepthCount++}(),ec(O)&&(function Ap(t,e,n){!Ju()||(function Fg(t,e,n,a){const u=n.directiveStart,m=n.directiveEnd;t.firstCreatePass||H(n,e),To(a,e);const v=n.initialInputs;for(let T=u;T<m;T++){const I=t.data[T],O=Ki(I);O&&uv(e,n,I);const N=et(e,t,T,n);To(N,e),null!==v&&jg(0,T-u,N,I,0,v),O&&(ji(n.index,e)[8]=N)}}(t,e,n,Yi(n,e)),128==(128&n.flags)&&function cl(t,e,n){const a=n.directiveStart,u=n.directiveEnd,v=n.index,T=function nu(){return bn.lFrame.currentDirectiveIndex}();try{ta(v);for(let I=a;I<u;I++){const O=t.data[I],N=e[I];Za(I),(null!==O.hostBindings||0!==O.hostVars||null!==O.hostAttrs)&&Lp(O,N)}}finally{ta(-1),Za(T)}}(t,e,n))}(m,u,O),function Ag(t,e,n){if(wl(e)){const u=e.directiveEnd;for(let m=e.directiveStart;m<u;m++){const v=t.data[m];v.contentQueries&&v.contentQueries(1,n[m],m)}}}(m,O,u)),null!==a&&function Pp(t,e,n=Yi){const a=e.localNames;if(null!==a){let u=e.index+1;for(let m=0;m<a.length;m+=2){const v=a[m+1],T=-1===v?n(e,t):t[v];t[u++]=T}}}(u,O),is}function Es(){let t=Ti();Wo()?function Qs(){bn.lFrame.isParent=!1}():(t=t.parent,Ui(t,!1));const e=t;!function vd(){bn.lFrame.elementDepthCount--}();const n=rr();return n.firstCreatePass&&(Wa(n,t),wl(t)&&n.queries.elementEnd(t)),null!=e.classesWithoutHost&&function Qa(t){return 0!=(16&t.flags)}(e)&&Dv(n,e,ft(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function hh(t){return 0!=(32&t.flags)}(e)&&Dv(n,e,ft(),e.stylesWithoutHost,!1),Es}function zu(t,e,n,a){return is(t,e,n,a),Es(),zu}function t_(t){return!!t&&"function"==typeof t.then}const $0=function V0(t){return!!t&&"function"==typeof t.subscribe};function em(t,e,n,a){const u=ft(),m=rr(),v=Ti();return function H0(t,e,n,a,u,m,v,T){const I=ec(a),N=t.firstCreatePass&&Vp(t),Z=e[8],ye=Up(e);let be=!0;if(3&a.type||T){const Rt=Yi(a,e),Ut=T?T(Rt):Rt,ct=ye.length,dn=T?Jn=>T(Ur(Jn[a.index])):a.index;if(Pr(n)){let Jn=null;if(!T&&I&&(Jn=function zT(t,e,n,a){const u=t.cleanup;if(null!=u)for(let m=0;m<u.length-1;m+=2){const v=u[m];if(v===n&&u[m+1]===a){const T=e[7],I=u[m+2];return T.length>I?T[I]:null}"string"==typeof v&&(m+=2)}return null}(t,e,u,a.index)),null!==Jn)(Jn.__ngLastListenerFn__||Jn).__ngNextListenerFn__=m,Jn.__ngLastListenerFn__=m,be=!1;else{m=Mv(a,e,Z,m,!1);const Or=n.listen(Ut,u,m);ye.push(m,Or),N&&N.push(u,dn,ct,ct+1)}}else m=Mv(a,e,Z,m,!0),Ut.addEventListener(u,m,v),ye.push(m),N&&N.push(u,dn,ct,v)}else m=Mv(a,e,Z,m,!1);const Ge=a.outputs;let vt;if(be&&null!==Ge&&(vt=Ge[u])){const Rt=vt.length;if(Rt)for(let Ut=0;Ut<Rt;Ut+=2){const ga=e[vt[Ut]][vt[Ut+1]].subscribe(m),id=ye.length;ye.push(m,ga),N&&N.push(u,a.index,id,-(id+1))}}}(m,u,u[11],v,t,e,!!n,a),em}function q0(t,e,n,a){try{return!1!==n(a)}catch(u){return Gp(t,u),!1}}function Mv(t,e,n,a,u){return function m(v){if(v===Function)return a;const T=2&t.flags?ji(t.index,e):e;0==(32&e[2])&&Pa(T);let I=q0(e,0,a,v),O=m.__ngNextListenerFn__;for(;O;)I=q0(e,0,O,v)&&I,O=O.__ngNextListenerFn__;return u&&!1===I&&(v.preventDefault(),v.returnValue=!1),I}}function ml(t,e=""){const n=ft(),a=rr(),u=t+20,m=a.firstCreatePass?Ul(a,u,1,e,null):a.data[u],v=n[u]=function yc(t,e){return Pr(t)?t.createText(e):t.createTextNode(e)}(n[11],e);Ud(a,n,v,m),Ui(m,!1)}function r_(t,e,n){const a=ft(),u=function yr(t,e,n,a){return ln(t,ea(),n)?e+Ie(n)+a:$n}(a,t,e,n);return u!==$n&&ka(a,Vi(),u),r_}function kv(t,e,n,a,u,m,v,T,I){const O=ft(),N=Un(O,t,e,n,a,u,m,v,T,I);return N!==$n&&ka(O,Vi(),N),kv}const i_="en-US";let Nb=i_;class c1{}class ID{resolveComponentFactory(e){throw function SD(t){const e=Error(`No component factory found for ${er(t)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=t,e}(e)}}let sm=(()=>{class t{}return t.NULL=new ID,t})();function MD(){return wf(Ti(),ft())}function wf(t,e){return new Nu(Yi(t,e))}let Nu=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=MD,t})();function AD(t){return t instanceof Nu?t.nativeElement:t}class h1{}let c_=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>function kD(){const t=ft(),n=ji(Ti().index,t);return function PD(t){return t[11]}(Ro(n)?n:t)}(),t})(),RD=(()=>{class t{}return t.\u0275prov=gn({token:t,providedIn:"root",factory:()=>null}),t})();class u_{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const OD=new u_("13.3.4"),Bv={};function h_(t,e,n,a,u=!1){for(;null!==n;){const m=e[n.index];if(null!==m&&a.push(Ur(m)),xo(m))for(let T=10;T<m.length;T++){const I=m[T],O=I[1].firstChild;null!==O&&h_(I[1],I,O,a)}const v=n.type;if(8&v)h_(t,e,n.child,a);else if(32&v){const T=Nd(n,e);let I;for(;I=T();)a.push(I)}else if(16&v){const T=Du(e,n);if(Array.isArray(T))a.push(...T);else{const I=Ah(e[16]);h_(I[1],I,T,a,!0)}}n=u?n.projectionNext:n.next}return a}class am{constructor(e,n){this._lView=e,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,n=e[1];return h_(n,e,n.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(xo(e)){const n=e[8],a=n?n.indexOf(this):-1;a>-1&&(mp(e,a),Bs(n,a))}this._attachedToViewContainer=!1}hg(this._lView[1],this._lView)}onDestroy(e){kp(this._lView[1],this._lView,null,e)}markForCheck(){Pa(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){hf(this._lView[1],this._lView,this.context)}checkNoChanges(){!function jp(t,e,n){ba(!0);try{hf(t,e,n)}finally{ba(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new se(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Fy(t,e){Su(t,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new se(902,"");this._appRef=e}}class LD extends am{constructor(e){super(e),this._view=e}detectChanges(){Bp(this._view)}checkNoChanges(){!function dv(t){ba(!0);try{Bp(t)}finally{ba(!1)}}(this._view)}get context(){return null}}class d1 extends sm{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const n=_r(e);return new jv(n,this.ngModule)}}function f1(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}class jv extends c1{constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=function Ky(t){return t.map(Xy).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return f1(this.componentDef.inputs)}get outputs(){return f1(this.componentDef.outputs)}create(e,n,a,u){const m=(u=u||this.ngModule)?function zD(t,e){return{get:(n,a,u)=>{const m=t.get(n,Bv,u);return m!==Bv||a===Bv?m:e.get(n,a,u)}}}(e,u.injector):e,v=m.get(h1,Qc),T=m.get(RD,null),I=v.createRenderer(null,this.componentDef),O=this.componentDef.selectors[0][0]||"div",N=a?function Pg(t,e,n){if(Pr(t))return t.selectRootElement(e,n===Ri.ShadowDom);let a="string"==typeof e?t.querySelector(e):e;return a.textContent="",a}(I,a,this.componentDef.encapsulation):vc(v.createRenderer(null,this.componentDef),O,function FD(t){const e=t.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(O)),Z=this.componentDef.onPush?576:528,ye=function j(t,e){return{components:[],scheduler:t||up,clean:$g,playerHandler:e||null,flags:0}}(),be=sf(0,null,null,1,0,null,null,null,null,null),Ge=Cc(null,be,ye,Z,null,null,v,I,T,m);let vt,Rt;sc(Ge);try{const Ut=function k(t,e,n,a,u,m){const v=n[1];n[20]=t;const I=Ul(v,20,2,"#host",null),O=I.mergedAttrs=e.hostAttrs;null!==O&&(Mc(I,O,!0),null!==t&&(co(u,t,O),null!==I.classes&&sa(u,t,I.classes),null!==I.styles&&xp(u,t,I.styles)));const N=a.createRenderer(t,e),Z=Cc(n,of(e),null,e.onPush?64:16,n[20],I,a,N,m||null,null);return v.firstCreatePass&&(ge(H(I,n),v,e.type),zp(v,I),Np(I,n.length,1)),xs(n,Z),n[20]=Z}(N,this.componentDef,Ge,v,I);if(N)if(a)co(I,N,["ng-version",OD.full]);else{const{attrs:ct,classes:dn}=function bp(t){const e=[],n=[];let a=1,u=2;for(;a<t.length;){let m=t[a];if("string"==typeof m)2===u?""!==m&&e.push(m,t[++a]):8===u&&n.push(m);else{if(!aa(u))break;u=m}a++}return{attrs:e,classes:n}}(this.componentDef.selectors[0]);ct&&co(I,N,ct),dn&&dn.length>0&&sa(I,N,dn.join(" "))}if(Rt=rc(be,20),void 0!==n){const ct=Rt.projection=[];for(let dn=0;dn<this.ngContentSelectors.length;dn++){const Jn=n[dn];ct.push(null!=Jn?Array.from(Jn):null)}}vt=function F(t,e,n,a,u){const m=n[1],v=function Rp(t,e,n){const a=Ti();t.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),Bg(t,a,e,Pu(t,e,1,null),n));const u=et(e,t,a.directiveStart,a);To(u,e);const m=Yi(a,e);return m&&To(m,e),u}(m,n,e);if(a.components.push(v),t[8]=v,u&&u.forEach(I=>I(v,e)),e.contentQueries){const I=Ti();e.contentQueries(1,v,I.directiveStart)}const T=Ti();return!m.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(ta(T.index),Lg(n[1],T,0,T.directiveStart,T.directiveEnd,e),Lp(e,v)),v}(Ut,this.componentDef,Ge,ye,[q]),Dc(be,Ge,null)}finally{ac()}return new BD(this.componentType,vt,wf(Rt,Ge),Ge,Rt)}}class BD extends class DD{}{constructor(e,n,a,u,m){super(),this.location=a,this._rootLView=u,this._tNode=m,this.instance=n,this.hostView=this.changeDetectorRef=new LD(u),this.componentType=e}get injector(){return new yt(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}class Lc{}class p1{}const Ef=new Map;class _1 extends Lc{constructor(e,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new d1(this);const a=ze(e);this._bootstrapComponents=Sa(a.bootstrap),this._r3Injector=Vh(e,n,[{provide:Lc,useValue:this},{provide:sm,useValue:this.componentFactoryResolver}],er(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,n=qi.THROW_IF_NOT_FOUND,a=xn.Default){return e===qi||e===Lc||e===jh?this:this._r3Injector.get(e,n,a)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Uv extends p1{constructor(e){super(),this.moduleType=e,null!==ze(e)&&function UD(t){const e=new Set;!function n(a){const u=ze(a,!0),m=u.id;null!==m&&(function m1(t,e,n){if(e&&e!==n)throw new Error(`Duplicate module registered for ${t} - ${er(e)} vs ${er(e.name)}`)}(m,Ef.get(m),a),Ef.set(m,a));const v=Sa(u.imports);for(const T of v)e.has(T)||(e.add(T),n(T))}(t)}(e)}create(e){return new _1(this.moduleType,e)}}function Vv(t,e,n){const a=function vi(){const t=bn.lFrame;let e=t.bindingRootIndex;return-1===e&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}()+t,u=ft();return u[a]===$n?function Dn(t,e,n){return t[e]=n}(u,a,n?e.call(n):e()):function mn(t,e){return t[e]}(u,a)}function $v(t){return e=>{setTimeout(t,void 0,e)}}const Cs=class iS extends Et{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,n,a){var u,m,v;let T=e,I=n||(()=>null),O=a;if(e&&"object"==typeof e){const Z=e;T=null===(u=Z.next)||void 0===u?void 0:u.bind(Z),I=null===(m=Z.error)||void 0===m?void 0:m.bind(Z),O=null===(v=Z.complete)||void 0===v?void 0:v.bind(Z)}this.__isAsync&&(I=$v(I),T&&(T=$v(T)),O&&(O=$v(O)));const N=super.subscribe({next:T,error:I,complete:O});return e instanceof W&&e.add(N),N}};function oS(){return this._results[tt()]()}class Gv{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=tt(),a=Gv.prototype;a[n]||(a[n]=oS)}get changes(){return this._changes||(this._changes=new Cs)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,n){return this._results.reduce(e,n)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,n){const a=this;a.dirty=!1;const u=si(e);(this._changesDetected=!function Yr(t,e,n){if(t.length!==e.length)return!1;for(let a=0;a<t.length;a++){let u=t[a],m=e[a];if(n&&(u=n(u),m=n(m)),m!==u)return!1}return!0}(a._results,u,n))&&(a._results=u,a.length=u.length,a.last=u[this.length-1],a.first=u[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Fc=(()=>{class t{}return t.__NG_ELEMENT_ID__=lS,t})();const sS=Fc,aS=class extends sS{constructor(e,n,a){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=a}createEmbeddedView(e){const n=this._declarationTContainer.tViews,a=Cc(this._declarationLView,n,e,16,null,n.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const m=this._declarationLView[19];return null!==m&&(a[19]=m.createEmbeddedView(n)),Dc(n,a,e),new am(a)}};function lS(){return d_(Ti(),ft())}function d_(t,e){return 4&t.type?new aS(e,t,wf(t,e)):null}let Ra=(()=>{class t{}return t.__NG_ELEMENT_ID__=cS,t})();function cS(){return C1(Ti(),ft())}const uS=Ra,E1=class extends uS{constructor(e,n,a){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=a}get element(){return wf(this._hostTNode,this._hostLView)}get injector(){return new yt(this._hostTNode,this._hostLView)}get parentInjector(){const e=G(this._hostTNode,this._hostLView);if(i(e)){const n=b(e,this._hostLView),a=d(e);return new yt(n[1].data[a+8],n)}return new yt(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const n=T1(this._lContainer);return null!==n&&n[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,n,a){const u=e.createEmbeddedView(n||{});return this.insert(u,a),u}createComponent(e,n,a,u,m){const v=e&&!function Kr(t){return"function"==typeof t}(e);let T;if(v)T=n;else{const Z=n||{};T=Z.index,a=Z.injector,u=Z.projectableNodes,m=Z.ngModuleRef}const I=v?e:new jv(_r(e)),O=a||this.parentInjector;if(!m&&null==I.ngModule){const ye=(v?O:this.parentInjector).get(Lc,null);ye&&(m=ye)}const N=I.create(O,u,void 0,m);return this.insert(N.hostView,T),N}insert(e,n){const a=e._lView,u=a[1];if(function Yu(t){return xo(t[3])}(a)){const N=this.indexOf(e);if(-1!==N)this.detach(N);else{const Z=a[3],ye=new E1(Z,Z[6],Z[3]);ye.detach(ye.indexOf(e))}}const m=this._adjustIndex(n),v=this._lContainer;!function Ny(t,e,n,a){const u=10+a,m=n.length;a>0&&(n[u-1][4]=e),a<m-10?(e[4]=n[u],Eo(n,10+a,e)):(n.push(e),e[4]=null),e[3]=n;const v=e[17];null!==v&&n!==v&&function By(t,e){const n=t[9];e[16]!==e[3][3][16]&&(t[2]=!0),null===n?t[9]=[e]:n.push(e)}(v,e);const T=e[19];null!==T&&T.insertView(t),e[2]|=128}(u,a,v,m);const T=yp(m,v),I=a[11],O=kh(I,v[7]);return null!==O&&function cg(t,e,n,a,u,m){a[0]=u,a[6]=e,Su(t,a,n,1,u,m)}(u,v[6],I,a,O,T),e.attachToViewContainerRef(),Eo(Hv(v),m,e),e}move(e,n){return this.insert(e,n)}indexOf(e){const n=T1(this._lContainer);return null!==n?n.indexOf(e):-1}remove(e){const n=this._adjustIndex(e,-1),a=mp(this._lContainer,n);a&&(Bs(Hv(this._lContainer),n),hg(a[1],a))}detach(e){const n=this._adjustIndex(e,-1),a=mp(this._lContainer,n);return a&&null!=Bs(Hv(this._lContainer),n)?new am(a):null}_adjustIndex(e,n=0){return null==e?this.length+n:e}};function T1(t){return t[8]}function Hv(t){return t[8]||(t[8]=[])}function C1(t,e){let n;const a=e[t.index];if(xo(a))n=a;else{let u;if(8&t.type)u=Ur(a);else{const m=e[11];u=m.createComment("");const v=Yi(t,e);xc(m,kh(m,v),u,function Vy(t,e){return Pr(t)?t.nextSibling(e):e.nextSibling}(m,v),!1)}e[t.index]=n=function Vl(t,e,n,a){return new Array(t,!0,!1,e,null,0,a,n,null,null)}(a,e,u,t),xs(e,n)}return new E1(n,t,e)}class qv{constructor(e){this.queryList=e,this.matches=null}clone(){return new qv(this.queryList)}setDirty(){this.queryList.setDirty()}}class Zv{constructor(e=[]){this.queries=e}createEmbeddedView(e){const n=e.queries;if(null!==n){const a=null!==e.contentQueries?e.contentQueries[0]:n.length,u=[];for(let m=0;m<a;m++){const v=n.getByIndex(m);u.push(this.queries[v.indexInDeclarationView].clone())}return new Zv(u)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let n=0;n<this.queries.length;n++)null!==P1(e,n).matches&&this.queries[n].setDirty()}}class D1{constructor(e,n,a=null){this.predicate=e,this.flags=n,this.read=a}}class Wv{constructor(e=[]){this.queries=e}elementStart(e,n){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(e,n)}elementEnd(e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(e)}embeddedTView(e){let n=null;for(let a=0;a<this.length;a++){const u=null!==n?n.length:0,m=this.getByIndex(a).embeddedTView(e,u);m&&(m.indexInDeclarationView=a,null!==n?n.push(m):n=[m])}return null!==n?new Wv(n):null}template(e,n){for(let a=0;a<this.queries.length;a++)this.queries[a].template(e,n)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Xv{constructor(e,n=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(e,n){this.isApplyingToNode(n)&&this.matchTNode(e,n)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,n){this.elementStart(e,n)}embeddedTView(e,n){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,n),new Xv(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let a=e.parent;for(;null!==a&&8&a.type&&a.index!==n;)a=a.parent;return n===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(e,n){const a=this.metadata.predicate;if(Array.isArray(a))for(let u=0;u<a.length;u++){const m=a[u];this.matchTNodeWithReadOption(e,n,fS(n,m)),this.matchTNodeWithReadOption(e,n,We(n,e,m,!1,!1))}else a===Fc?4&n.type&&this.matchTNodeWithReadOption(e,n,-1):this.matchTNodeWithReadOption(e,n,We(n,e,a,!1,!1))}matchTNodeWithReadOption(e,n,a){if(null!==a){const u=this.metadata.read;if(null!==u)if(u===Nu||u===Ra||u===Fc&&4&n.type)this.addMatch(n.index,-2);else{const m=We(n,e,u,!1,!1);null!==m&&this.addMatch(n.index,m)}else this.addMatch(n.index,a)}}addMatch(e,n){null===this.matches?this.matches=[e,n]:this.matches.push(e,n)}}function fS(t,e){const n=t.localNames;if(null!==n)for(let a=0;a<n.length;a+=2)if(n[a]===e)return n[a+1];return null}function mS(t,e,n,a){return-1===n?function pS(t,e){return 11&t.type?wf(t,e):4&t.type?d_(t,e):null}(e,t):-2===n?function gS(t,e,n){return n===Nu?wf(e,t):n===Fc?d_(e,t):n===Ra?C1(e,t):void 0}(t,e,a):et(t,t[1],n,e)}function S1(t,e,n,a){const u=e[19].queries[a];if(null===u.matches){const m=t.data,v=n.matches,T=[];for(let I=0;I<v.length;I+=2){const O=v[I];T.push(O<0?null:mS(e,m[O],v[I+1],n.metadata.read))}u.matches=T}return u.matches}function Kv(t,e,n,a){const u=t.queries.getByIndex(n),m=u.matches;if(null!==m){const v=S1(t,e,u,n);for(let T=0;T<m.length;T+=2){const I=m[T];if(I>0)a.push(v[T/2]);else{const O=m[T+1],N=e[-I];for(let Z=10;Z<N.length;Z++){const ye=N[Z];ye[17]===ye[3]&&Kv(ye[1],ye,O,a)}if(null!==N[9]){const Z=N[9];for(let ye=0;ye<Z.length;ye++){const be=Z[ye];Kv(be[1],be,O,a)}}}}}return a}function f_(t){const e=ft(),n=rr(),a=rh();ru(a+1);const u=P1(n,a);if(t.dirty&&Js(e)===(2==(2&u.metadata.flags))){if(null===u.matches)t.reset([]);else{const m=u.crossesNgTemplate?Kv(n,e,a,[]):S1(n,e,u,a);t.reset(m,AD),t.notifyOnChanges()}return!0}return!1}function Yv(t,e,n,a){const u=rr();if(u.firstCreatePass){const m=Ti();A1(u,new D1(e,n,a),m.index),function yS(t,e){const n=t.contentQueries||(t.contentQueries=[]);e!==(n.length?n[n.length-1]:-1)&&n.push(t.queries.length-1,e)}(u,t),2==(2&n)&&(u.staticContentQueries=!0)}M1(u,ft(),n)}function p_(){return function _S(t,e){return t[19].queries[e].queryList}(ft(),rh())}function M1(t,e,n){const a=new Gv(4==(4&n));kp(t,e,a,a.destroy),null===e[19]&&(e[19]=new Zv),e[19].queries.push(new qv(a))}function A1(t,e,n){null===t.queries&&(t.queries=new Wv),t.queries.track(new Xv(e,n))}function P1(t,e){return t.queries.getByIndex(e)}function __(...t){}const y_=new Yt("Application Initializer");let rx=(()=>{class t{constructor(n){this.appInits=n,this.resolve=__,this.reject=__,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,u)=>{this.resolve=a,this.reject=u})}runInitializers(){if(this.initialized)return;const n=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let u=0;u<this.appInits.length;u++){const m=this.appInits[u]();if(t_(m))n.push(m);else if($0(m)){const v=new Promise((T,I)=>{m.subscribe({complete:T,error:I})});n.push(v)}}Promise.all(n).then(()=>{a()}).catch(u=>{this.reject(u)}),0===n.length&&a(),this.initialized=!0}}return t.\u0275fac=function(n){return new(n||t)(hn(y_,8))},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const hm=new Yt("AppId",{providedIn:"root",factory:function W1(){return`${ix()}${ix()}${ix()}`}});function ix(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const X1=new Yt("Platform Initializer"),dm=new Yt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),K1=new Yt("appBootstrapListener");let FS=(()=>{class t{log(n){console.log(n)}warn(n){console.warn(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const Bu=new Yt("LocaleId",{providedIn:"root",factory:()=>ai(Bu,xn.Optional|xn.SkipSelf)||function zS(){return"undefined"!=typeof $localize&&$localize.locale||i_}()});class BS{constructor(e,n){this.ngModuleFactory=e,this.componentFactories=n}}let Y1=(()=>{class t{compileModuleSync(n){return new Uv(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const a=this.compileModuleSync(n),m=Sa(ze(n).declarations).reduce((v,T)=>{const I=_r(T);return I&&v.push(new jv(I)),v},[]);return new BS(a,m)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const US=(()=>Promise.resolve(0))();function ox(t){"undefined"==typeof Zone?US.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class Io{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Cs(!1),this.onMicrotaskEmpty=new Cs(!1),this.onStable=new Cs(!1),this.onError=new Cs(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!a&&n,u.shouldCoalesceRunChangeDetection=a,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function VS(){let t=Fn.requestAnimationFrame,e=Fn.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&e){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const a=e[Zone.__symbol__("OriginalDelegate")];a&&(e=a)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function HS(t){const e=()=>{!function GS(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Fn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,ax(t),t.isCheckStableRunning=!0,sx(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),ax(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,a,u,m,v,T)=>{try{return J1(t),n.invokeTask(u,m,v,T)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||t.shouldCoalesceRunChangeDetection)&&e(),Q1(t)}},onInvoke:(n,a,u,m,v,T,I)=>{try{return J1(t),n.invoke(u,m,v,T,I)}finally{t.shouldCoalesceRunChangeDetection&&e(),Q1(t)}},onHasTask:(n,a,u,m)=>{n.hasTask(u,m),a===u&&("microTask"==m.change?(t._hasPendingMicrotasks=m.microTask,ax(t),sx(t)):"macroTask"==m.change&&(t.hasPendingMacrotasks=m.macroTask))},onHandleError:(n,a,u,m)=>(n.handleError(u,m),t.runOutsideAngular(()=>t.onError.emit(m)),!1)})}(u)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Io.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Io.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,n,a){return this._inner.run(e,n,a)}runTask(e,n,a,u){const m=this._inner,v=m.scheduleEventTask("NgZoneEvent: "+u,e,$S,__,__);try{return m.runTask(v,n,a)}finally{m.cancelTask(v)}}runGuarded(e,n,a){return this._inner.runGuarded(e,n,a)}runOutsideAngular(e){return this._outer.run(e)}}const $S={};function sx(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function ax(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function J1(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Q1(t){t._nesting--,sx(t)}class qS{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Cs,this.onMicrotaskEmpty=new Cs,this.onStable=new Cs,this.onError=new Cs}run(e,n,a){return e.apply(n,a)}runGuarded(e,n,a){return e.apply(n,a)}runOutsideAngular(e){return e()}runTask(e,n,a,u){return e.apply(n,a)}}let lx=(()=>{class t{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Io.assertNotInAngularZone(),ox(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())ox(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(n)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,a,u){let m=-1;a&&a>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(v=>v.timeoutId!==m),n(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:n,timeoutId:m,updateCb:u})}whenStable(n,a,u){if(u&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,a,u),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,a,u){return[]}}return t.\u0275fac=function(n){return new(n||t)(hn(Io))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),ZS=(()=>{class t{constructor(){this._applications=new Map,cx.addToWindow(this)}registerApplication(n,a){this._applications.set(n,a)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,a=!0){return cx.findTestabilityInTree(this,n,a)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();class WS{addToWindow(e){}findTestabilityInTree(e,n,a){return null}}let cx=new WS,Kh=null;const ew=new Yt("AllowMultipleToken"),tw=new Yt("PlatformOnDestroy");class nw{constructor(e,n){this.name=e,this.token=n}}function rw(t,e,n=[]){const a=`Platform: ${e}`,u=new Yt(a);return(m=[])=>{let v=ux();if(!v||v.injector.get(ew,!1)){const T=[...n,...m,{provide:u,useValue:!0}];t?t(T):function JS(t){if(Kh&&!Kh.get(ew,!1))throw new se(400,"");Kh=t;const e=t.get(iw),n=t.get(X1,null);n&&n.forEach(a=>a())}(function eI(t=[],e){return qi.create({name:e,providers:[{provide:Uh,useValue:"platform"},{provide:tw,useValue:()=>Kh=null},...t]})}(T,a))}return function QS(t){const e=ux();if(!e)throw new se(401,"");return e}()}}function ux(){var t;return null!==(t=null==Kh?void 0:Kh.get(iw))&&void 0!==t?t:null}let iw=(()=>{class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,a){const T=function tI(t,e){let n;return n="noop"===t?new qS:("zone.js"===t?void 0:t)||new Io({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),n}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),I=[{provide:Io,useValue:T}];return T.run(()=>{const O=qi.create({providers:I,parent:this.injector,name:n.moduleType.name}),N=n.create(O),Z=N.injector.get(xu,null);if(!Z)throw new se(402,"");return T.runOutsideAngular(()=>{const ye=T.onError.subscribe({next:be=>{Z.handleError(be)}});N.onDestroy(()=>{hx(this._modules,N),ye.unsubscribe()})}),function nI(t,e,n){try{const a=n();return t_(a)?a.catch(u=>{throw e.runOutsideAngular(()=>t.handleError(u)),u}):a}catch(a){throw e.runOutsideAngular(()=>t.handleError(a)),a}}(Z,T,()=>{const ye=N.injector.get(rx);return ye.runInitializers(),ye.donePromise.then(()=>(function AC(t){pn(t,"Expected localeId to be defined"),"string"==typeof t&&(Nb=t.toLowerCase().replace(/_/g,"-"))}(N.injector.get(Bu,i_)||i_),this._moduleDoBootstrap(N),N))})})}bootstrapModule(n,a=[]){const u=ow({},a);return function KS(t,e,n){const a=new Uv(n);return Promise.resolve(a)}(0,0,n).then(m=>this.bootstrapModuleFactory(m,u))}_moduleDoBootstrap(n){const a=n.injector.get(v_);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(u=>a.bootstrap(u));else{if(!n.instance.ngDoBootstrap)throw new se(403,"");n.instance.ngDoBootstrap(a)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new se(404,"");this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a());const n=this._injector.get(tw,null);null==n||n(),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(n){return new(n||t)(hn(qi))},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();function ow(t,e){return Array.isArray(e)?e.reduce(ow,t):Object.assign(Object.assign({},t),e)}let v_=(()=>{class t{constructor(n,a,u,m){this._zone=n,this._injector=a,this._exceptionHandler=u,this._initStatus=m,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const v=new Be(I=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{I.next(this._stable),I.complete()})}),T=new Be(I=>{let O;this._zone.runOutsideAngular(()=>{O=this._zone.onStable.subscribe(()=>{Io.assertNotInAngularZone(),ox(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,I.next(!0))})})});const N=this._zone.onUnstable.subscribe(()=>{Io.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{I.next(!1)}))});return()=>{O.unsubscribe(),N.unsubscribe()}});this.isStable=ro(v,T.pipe(function Zr(){return t=>$o()(ki(bi)(t))}()))}bootstrap(n,a){if(!this._initStatus.done)throw new se(405,"");let u;u=n instanceof c1?n:this._injector.get(sm).resolveComponentFactory(n),this.componentTypes.push(u.componentType);const m=function YS(t){return t.isBoundToModule}(u)?void 0:this._injector.get(Lc),T=u.create(qi.NULL,[],a||u.selector,m),I=T.location.nativeElement,O=T.injector.get(lx,null),N=O&&T.injector.get(ZS);return O&&N&&N.registerApplication(I,O),T.onDestroy(()=>{this.detachView(T.hostView),hx(this.components,T),N&&N.unregisterApplication(I)}),this._loadComponent(T),T}tick(){if(this._runningTick)throw new se(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const a=n;this._views.push(a),a.attachToAppRef(this)}detachView(n){const a=n;hx(this._views,a),a.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(K1,[]).concat(this._bootstrapListeners).forEach(u=>u(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(n){return new(n||t)(hn(Io),hn(qi),hn(xu),hn(rx))},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function hx(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}let aw=!0,dx=(()=>{class t{}return t.__NG_ELEMENT_ID__=oI,t})();function oI(t){return function sI(t,e,n){if(Ql(t)&&!n){const a=ji(t.index,e);return new am(a,a)}return 47&t.type?new am(e[16],e):null}(Ti(),ft(),16==(16&t))}const vI=rw(null,"core",[]);let xI=(()=>{class t{constructor(n){}}return t.\u0275fac=function(n){return new(n||t)(hn(v_))},t.\u0275mod=ci({type:t}),t.\u0275inj=Cr({}),t})(),E_=null;function ju(){return E_}const fa=new Yt("DocumentToken");let Jh=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:function(){return function TI(){return hn(yw)}()},providedIn:"platform"}),t})();const CI=new Yt("Location Initialized");let yw=(()=>{class t extends Jh{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ju().getBaseHref(this._doc)}onPopState(n){const a=ju().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",n,!1),()=>a.removeEventListener("popstate",n)}onHashChange(n){const a=ju().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",n,!1),()=>a.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,a,u){vw()?this._history.pushState(n,a,u):this.location.hash=u}replaceState(n,a,u){vw()?this._history.replaceState(n,a,u):this.location.hash=u}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return t.\u0275fac=function(n){return new(n||t)(hn(fa))},t.\u0275prov=gn({token:t,factory:function(){return function DI(){return new yw(hn(fa))}()},providedIn:"platform"}),t})();function vw(){return!!window.history.pushState}function _x(t,e){if(0==t.length)return e;if(0==e.length)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e}function xw(t){const e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)}function zc(t){return t&&"?"!==t[0]?"?"+t:t}let Cf=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:function(){return function SI(t){const e=hn(fa).location;return new bw(hn(Jh),e&&e.origin||"")}()},providedIn:"root"}),t})();const yx=new Yt("appBaseHref");let bw=(()=>{class t extends Cf{constructor(n,a){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==a&&(a=this._platformLocation.getBaseHrefFromDOM()),null==a)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=a}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return _x(this._baseHref,n)}path(n=!1){const a=this._platformLocation.pathname+zc(this._platformLocation.search),u=this._platformLocation.hash;return u&&n?`${a}${u}`:a}pushState(n,a,u,m){const v=this.prepareExternalUrl(u+zc(m));this._platformLocation.pushState(n,a,v)}replaceState(n,a,u,m){const v=this.prepareExternalUrl(u+zc(m));this._platformLocation.replaceState(n,a,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var a,u;null===(u=(a=this._platformLocation).historyGo)||void 0===u||u.call(a,n)}}return t.\u0275fac=function(n){return new(n||t)(hn(Jh),hn(yx,8))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),II=(()=>{class t extends Cf{constructor(n,a){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=a&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let a=this._platformLocation.hash;return null==a&&(a="#"),a.length>0?a.substring(1):a}prepareExternalUrl(n){const a=_x(this._baseHref,n);return a.length>0?"#"+a:a}pushState(n,a,u,m){let v=this.prepareExternalUrl(u+zc(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.pushState(n,a,v)}replaceState(n,a,u,m){let v=this.prepareExternalUrl(u+zc(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.replaceState(n,a,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var a,u;null===(u=(a=this._platformLocation).historyGo)||void 0===u||u.call(a,n)}}return t.\u0275fac=function(n){return new(n||t)(hn(Jh),hn(yx,8))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),vx=(()=>{class t{constructor(n,a){this._subject=new Cs,this._urlChangeListeners=[],this._platformStrategy=n;const u=this._platformStrategy.getBaseHref();this._platformLocation=a,this._baseHref=xw(ww(u)),this._platformStrategy.onPopState(m=>{this._subject.emit({url:this.path(!0),pop:!0,state:m.state,type:m.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,a=""){return this.path()==this.normalize(n+zc(a))}normalize(n){return t.stripTrailingSlash(function AI(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,ww(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,a="",u=null){this._platformStrategy.pushState(u,"",n,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+zc(a)),u)}replaceState(n,a="",u=null){this._platformStrategy.replaceState(u,"",n,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+zc(a)),u)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){var a,u;null===(u=(a=this._platformStrategy).historyGo)||void 0===u||u.call(a,n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)}))}_notifyUrlChangeListeners(n="",a){this._urlChangeListeners.forEach(u=>u(n,a))}subscribe(n,a,u){return this._subject.subscribe({next:n,error:a,complete:u})}}return t.normalizeQueryParams=zc,t.joinWithSlash=_x,t.stripTrailingSlash=xw,t.\u0275fac=function(n){return new(n||t)(hn(Cf),hn(Jh))},t.\u0275prov=gn({token:t,factory:function(){return function MI(){return new vx(hn(Cf),hn(Jh))}()},providedIn:"root"}),t})();function ww(t){return t.replace(/\/index.html$/,"")}function Pw(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const a=n.indexOf("="),[u,m]=-1==a?[n,""]:[n.slice(0,a),n.slice(a+1)];if(u.trim()===e)return decodeURIComponent(m)}return null}let HM=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ci({type:t}),t.\u0275inj=Cr({}),t})();const Fw="browser";function zw(t){return t===Fw}let XM=(()=>{class t{}return t.\u0275prov=gn({token:t,providedIn:"root",factory:()=>new KM(hn(fa),window)}),t})();class KM{constructor(e,n){this.document=e,this.window=n,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const n=function YM(t,e){const n=t.getElementById(e)||t.getElementsByName(e)[0];if(n)return n;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const a=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let u=a.currentNode;for(;u;){const m=u.shadowRoot;if(m){const v=m.getElementById(e)||m.querySelector(`[name="${e}"]`);if(v)return v}u=a.nextNode()}}return null}(this.document,e);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=e)}}scrollToElement(e){const n=e.getBoundingClientRect(),a=n.left+this.window.pageXOffset,u=n.top+this.window.pageYOffset,m=this.offset();this.window.scrollTo(a-m[0],u-m[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=Nw(this.window.history)||Nw(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function Nw(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class Bw{}class Rx extends class JM extends class EI{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function wI(t){E_||(E_=t)}(new Rx)}onAndCancel(e,n,a){return e.addEventListener(n,a,!1),()=>{e.removeEventListener(n,a,!1)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return(n=n||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return"window"===n?window:"document"===n?e:"body"===n?e.body:null}getBaseHref(e){const n=function QM(){return gm=gm||document.querySelector("base"),gm?gm.getAttribute("href"):null}();return null==n?null:function eA(t){R_=R_||document.createElement("a"),R_.setAttribute("href",t);const e=R_.pathname;return"/"===e.charAt(0)?e:`/${e}`}(n)}resetBaseElement(){gm=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Pw(document.cookie,e)}}let R_,gm=null;const jw=new Yt("TRANSITION_ID"),nA=[{provide:y_,useFactory:function tA(t,e,n){return()=>{n.get(rx).donePromise.then(()=>{const a=ju(),u=e.querySelectorAll(`style[ng-transition="${t}"]`);for(let m=0;m<u.length;m++)a.remove(u[m])})}},deps:[jw,fa,qi],multi:!0}];class Ox{static init(){!function XS(t){cx=t}(new Ox)}addToWindow(e){Fn.getAngularTestability=(a,u=!0)=>{const m=e.findTestabilityInTree(a,u);if(null==m)throw new Error("Could not find testability for element.");return m},Fn.getAllAngularTestabilities=()=>e.getAllTestabilities(),Fn.getAllAngularRootElements=()=>e.getAllRootElements(),Fn.frameworkStabilizers||(Fn.frameworkStabilizers=[]),Fn.frameworkStabilizers.push(a=>{const u=Fn.getAllAngularTestabilities();let m=u.length,v=!1;const T=function(I){v=v||I,m--,0==m&&a(v)};u.forEach(function(I){I.whenStable(T)})})}findTestabilityInTree(e,n,a){if(null==n)return null;const u=e.getTestability(n);return null!=u?u:a?ju().isShadowRoot(n)?this.findTestabilityInTree(e,n.host,!0):this.findTestabilityInTree(e,n.parentElement,!0):null}}let rA=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const O_=new Yt("EventManagerPlugins");let L_=(()=>{class t{constructor(n,a){this._zone=a,this._eventNameToPlugin=new Map,n.forEach(u=>u.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,a,u){return this._findPluginFor(a).addEventListener(n,a,u)}addGlobalEventListener(n,a,u){return this._findPluginFor(a).addGlobalEventListener(n,a,u)}getZone(){return this._zone}_findPluginFor(n){const a=this._eventNameToPlugin.get(n);if(a)return a;const u=this._plugins;for(let m=0;m<u.length;m++){const v=u[m];if(v.supports(n))return this._eventNameToPlugin.set(n,v),v}throw new Error(`No event manager plugin found for event ${n}`)}}return t.\u0275fac=function(n){return new(n||t)(hn(O_),hn(Io))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();class Uw{constructor(e){this._doc=e}addGlobalEventListener(e,n,a){const u=ju().getGlobalEventTarget(this._doc,e);if(!u)throw new Error(`Unsupported event target ${u} for event ${n}`);return this.addEventListener(u,n,a)}}let Vw=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(n){const a=new Set;n.forEach(u=>{this._stylesSet.has(u)||(this._stylesSet.add(u),a.add(u))}),this.onStylesAdded(a)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),_m=(()=>{class t extends Vw{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,a,u){n.forEach(m=>{const v=this._doc.createElement("style");v.textContent=m,u.push(a.appendChild(v))})}addHost(n){const a=[];this._addStylesToHost(this._stylesSet,n,a),this._hostNodes.set(n,a)}removeHost(n){const a=this._hostNodes.get(n);a&&a.forEach($w),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((a,u)=>{this._addStylesToHost(n,u,a)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach($w))}}return t.\u0275fac=function(n){return new(n||t)(hn(fa))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();function $w(t){ju().remove(t)}const Lx={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Fx=/%COMP%/g;function F_(t,e,n){for(let a=0;a<e.length;a++){let u=e[a];Array.isArray(u)?F_(t,u,n):(u=u.replace(Fx,t),n.push(u))}return n}function qw(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let zx=(()=>{class t{constructor(n,a,u){this.eventManager=n,this.sharedStylesHost=a,this.appId=u,this.rendererByCompId=new Map,this.defaultRenderer=new Nx(n)}createRenderer(n,a){if(!n||!a)return this.defaultRenderer;switch(a.encapsulation){case Ri.Emulated:{let u=this.rendererByCompId.get(a.id);return u||(u=new cA(this.eventManager,this.sharedStylesHost,a,this.appId),this.rendererByCompId.set(a.id,u)),u.applyToHost(n),u}case 1:case Ri.ShadowDom:return new uA(this.eventManager,this.sharedStylesHost,n,a);default:if(!this.rendererByCompId.has(a.id)){const u=F_(a.id,a.styles,[]);this.sharedStylesHost.addStyles(u),this.rendererByCompId.set(a.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(n){return new(n||t)(hn(L_),hn(_m),hn(hm))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();class Nx{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,n){return n?document.createElementNS(Lx[n]||n,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,n){e.appendChild(n)}insertBefore(e,n,a){e&&e.insertBefore(n,a)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let a="string"==typeof e?document.querySelector(e):e;if(!a)throw new Error(`The selector "${e}" did not match any elements`);return n||(a.textContent=""),a}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,a,u){if(u){n=u+":"+n;const m=Lx[u];m?e.setAttributeNS(m,n,a):e.setAttribute(n,a)}else e.setAttribute(n,a)}removeAttribute(e,n,a){if(a){const u=Lx[a];u?e.removeAttributeNS(u,n):e.removeAttribute(`${a}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,a,u){u&(gs.DashCase|gs.Important)?e.style.setProperty(n,a,u&gs.Important?"important":""):e.style[n]=a}removeStyle(e,n,a){a&gs.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,a){e[n]=a}setValue(e,n){e.nodeValue=n}listen(e,n,a){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,n,qw(a)):this.eventManager.addEventListener(e,n,qw(a))}}class cA extends Nx{constructor(e,n,a,u){super(e),this.component=a;const m=F_(u+"-"+a.id,a.styles,[]);n.addStyles(m),this.contentAttr=function sA(t){return"_ngcontent-%COMP%".replace(Fx,t)}(u+"-"+a.id),this.hostAttr=function aA(t){return"_nghost-%COMP%".replace(Fx,t)}(u+"-"+a.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,n){const a=super.createElement(e,n);return super.setAttribute(a,this.contentAttr,""),a}}class uA extends Nx{constructor(e,n,a,u){super(e),this.sharedStylesHost=n,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const m=F_(u.id,u.styles,[]);for(let v=0;v<m.length;v++){const T=document.createElement("style");T.textContent=m[v],this.shadowRoot.appendChild(T)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,a){return super.insertBefore(this.nodeOrShadowRoot(e),n,a)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let hA=(()=>{class t extends Uw{constructor(n){super(n)}supports(n){return!0}addEventListener(n,a,u){return n.addEventListener(a,u,!1),()=>this.removeEventListener(n,a,u)}removeEventListener(n,a,u){return n.removeEventListener(a,u)}}return t.\u0275fac=function(n){return new(n||t)(hn(fa))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const Ww=["alt","control","meta","shift"],fA={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Xw={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},pA={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let mA=(()=>{class t extends Uw{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,a,u){const m=t.parseEventName(a),v=t.eventCallback(m.fullKey,u,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ju().onAndCancel(n,m.domEventName,v))}static parseEventName(n){const a=n.toLowerCase().split("."),u=a.shift();if(0===a.length||"keydown"!==u&&"keyup"!==u)return null;const m=t._normalizeKey(a.pop());let v="";if(Ww.forEach(I=>{const O=a.indexOf(I);O>-1&&(a.splice(O,1),v+=I+".")}),v+=m,0!=a.length||0===m.length)return null;const T={};return T.domEventName=u,T.fullKey=v,T}static getEventFullKey(n){let a="",u=function gA(t){let e=t.key;if(null==e){if(e=t.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&Xw.hasOwnProperty(e)&&(e=Xw[e]))}return fA[e]||e}(n);return u=u.toLowerCase()," "===u?u="space":"."===u&&(u="dot"),Ww.forEach(m=>{m!=u&&pA[m](n)&&(a+=m+".")}),a+=u,a}static eventCallback(n,a,u){return m=>{t.getEventFullKey(m)===n&&u.runGuarded(()=>a(m))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return t.\u0275fac=function(n){return new(n||t)(hn(fa))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const xA=rw(vI,"browser",[{provide:dm,useValue:Fw},{provide:X1,useValue:function _A(){Rx.makeCurrent(),Ox.init()},multi:!0},{provide:fa,useFactory:function vA(){return function Ys(t){va=t}(document),document},deps:[]}]),bA=[{provide:Uh,useValue:"root"},{provide:xu,useFactory:function yA(){return new xu},deps:[]},{provide:O_,useClass:hA,multi:!0,deps:[fa,Io,dm]},{provide:O_,useClass:mA,multi:!0,deps:[fa]},{provide:zx,useClass:zx,deps:[L_,_m,hm]},{provide:h1,useExisting:zx},{provide:Vw,useExisting:_m},{provide:_m,useClass:_m,deps:[fa]},{provide:lx,useClass:lx,deps:[Io]},{provide:L_,useClass:L_,deps:[O_,Io]},{provide:Bw,useClass:rA,deps:[]}];let wA=(()=>{class t{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:t,providers:[{provide:hm,useValue:n.appId},{provide:jw,useExisting:hm},nA]}}}return t.\u0275fac=function(n){return new(n||t)(hn(t,12))},t.\u0275mod=ci({type:t}),t.\u0275inj=Cr({providers:bA,imports:[HM,xI]}),t})();function Hn(...t){let e=t[t.length-1];return ut(e)?(t.pop(),kn(t,e)):Pi(t)}"undefined"!=typeof window&&window;class yl extends Et{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const n=super._subscribe(e);return n&&!n.closed&&e.next(this._value),n}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new mt;return this._value}next(e){super.next(this._value=e)}}class RA extends Te{notifyNext(e,n,a,u,m){this.destination.next(n)}notifyError(e,n){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class OA extends Te{constructor(e,n,a){super(),this.parent=e,this.outerValue=n,this.outerIndex=a,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function LA(t,e,n,a,u=new OA(t,n,a)){if(!u.closed)return e instanceof Be?e.subscribe(u):$t(e)(u)}const Jw={};class zA{constructor(e){this.resultSelector=e}call(e,n){return n.subscribe(new NA(e,this.resultSelector))}}class NA extends RA{constructor(e,n){super(e),this.resultSelector=n,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(Jw),this.observables.push(e)}_complete(){const e=this.observables,n=e.length;if(0===n)this.destination.complete();else{this.active=n,this.toRespond=n;for(let a=0;a<n;a++)this.add(LA(this,e[a],void 0,a))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,n,a){const u=this.values,v=this.toRespond?u[a]===Jw?--this.toRespond:this.toRespond:0;u[a]=n,0===v&&(this.resultSelector?this._tryResultSelector(u):this.destination.next(u.slice()))}_tryResultSelector(e){let n;try{n=this.resultSelector.apply(this,e)}catch(a){return void this.destination.error(a)}this.destination.next(n)}}function Df(t,e){return new Be(e?n=>e.schedule(BA,0,{error:t,subscriber:n}):n=>n.error(t))}function BA({error:t,subscriber:e}){e.error(t)}const z_=(()=>{function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t})();function N_(...t){return function jA(){return mi(1)}()(Hn(...t))}const Sf=new Be(t=>t.complete());function B_(t){return t?function UA(t){return new Be(e=>t.schedule(()=>e.complete()))}(t):Sf}function j_(t){return new Be(e=>{let n;try{n=t()}catch(u){return void e.error(u)}return(n?hr(n):B_()).subscribe(e)})}function Fa(t,e){return"function"==typeof e?n=>n.pipe(Fa((a,u)=>hr(t(a,u)).pipe(it((m,v)=>e(a,m,u,v))))):n=>n.lift(new VA(t))}class VA{constructor(e){this.project=e}call(e,n){return n.subscribe(new $A(e,this.project))}}class $A extends qr{constructor(e,n){super(e),this.project=n,this.index=0}_next(e){let n;const a=this.index++;try{n=this.project(e,a)}catch(u){return void this.destination.error(u)}this._innerSub(n)}_innerSub(e){const n=this.innerSubscription;n&&n.unsubscribe();const a=new jn(this),u=this.destination;u.add(a),this.innerSubscription=Mo(e,a),this.innerSubscription!==a&&u.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const Qw=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})();function Bc(t){return e=>0===t?B_():e.lift(new GA(t))}class GA{constructor(e){if(this.total=e,this.total<0)throw new Qw}call(e,n){return n.subscribe(new HA(e,this.total))}}class HA extends Te{constructor(e,n){super(e),this.total=n,this.count=0}_next(e){const n=this.total,a=++this.count;a<=n&&(this.destination.next(e),a===n&&(this.destination.complete(),this.unsubscribe()))}}function eE(t,e){let n=!1;return arguments.length>=2&&(n=!0),function(u){return u.lift(new ZA(t,e,n))}}class ZA{constructor(e,n,a=!1){this.accumulator=e,this.seed=n,this.hasSeed=a}call(e,n){return n.subscribe(new WA(e,this.accumulator,this.seed,this.hasSeed))}}class WA extends Te{constructor(e,n,a,u){super(e),this.accumulator=n,this._seed=a,this.hasSeed=u,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const n=this.index++;let a;try{a=this.accumulator(this.seed,e,n)}catch(u){this.destination.error(u)}this.seed=a,this.destination.next(a)}}function pa(t,e){return function(a){return a.lift(new XA(t,e))}}class XA{constructor(e,n){this.predicate=e,this.thisArg=n}call(e,n){return n.subscribe(new KA(e,this.predicate,this.thisArg))}}class KA extends Te{constructor(e,n,a){super(e),this.predicate=n,this.thisArg=a,this.count=0}_next(e){let n;try{n=this.predicate.call(this.thisArg,e,this.count++)}catch(a){return void this.destination.error(a)}n&&this.destination.next(e)}}function Qh(t){return function(n){const a=new YA(t),u=n.lift(a);return a.caught=u}}class YA{constructor(e){this.selector=e}call(e,n){return n.subscribe(new JA(e,this.selector,this.caught))}}class JA extends qr{constructor(e,n,a){super(e),this.selector=n,this.caught=a}error(e){if(!this.isStopped){let n;try{n=this.selector(e,this.caught)}catch(m){return void super.error(m)}this._unsubscribeAndRecycle();const a=new jn(this);this.add(a);const u=Mo(n,a);u!==a&&this.add(u)}}}function If(t,e){return Nr(t,e,1)}function jx(t){return function(n){return 0===t?B_():n.lift(new QA(t))}}class QA{constructor(e){if(this.total=e,this.total<0)throw new Qw}call(e,n){return n.subscribe(new e2(e,this.total))}}class e2 extends Te{constructor(e,n){super(e),this.total=n,this.ring=new Array,this.count=0}_next(e){const n=this.ring,a=this.total,u=this.count++;n.length<a?n.push(e):n[u%a]=e}_complete(){const e=this.destination;let n=this.count;if(n>0){const a=this.count>=this.total?this.total:this.count,u=this.ring;for(let m=0;m<a;m++){const v=n++%a;e.next(u[v])}}e.complete()}}function tE(t=r2){return e=>e.lift(new t2(t))}class t2{constructor(e){this.errorFactory=e}call(e,n){return n.subscribe(new n2(e,this.errorFactory))}}class n2 extends Te{constructor(e,n){super(e),this.errorFactory=n,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(n){e=n}this.destination.error(e)}}}function r2(){return new z_}function nE(t=null){return e=>e.lift(new i2(t))}class i2{constructor(e){this.defaultValue=e}call(e,n){return n.subscribe(new o2(e,this.defaultValue))}}class o2 extends Te{constructor(e,n){super(e),this.defaultValue=n,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function Mf(t,e){const n=arguments.length>=2;return a=>a.pipe(t?pa((u,m)=>t(u,m,a)):J,Bc(1),n?nE(e):tE(()=>new z_))}function jc(){}function Hs(t,e,n){return function(u){return u.lift(new a2(t,e,n))}}class a2{constructor(e,n,a){this.nextOrObserver=e,this.error=n,this.complete=a}call(e,n){return n.subscribe(new l2(e,this.nextOrObserver,this.error,this.complete))}}class l2 extends Te{constructor(e,n,a,u){super(e),this._tapNext=jc,this._tapError=jc,this._tapComplete=jc,this._tapError=a||jc,this._tapComplete=u||jc,lt(n)?(this._context=this,this._tapNext=n):n&&(this._context=n,this._tapNext=n.next||jc,this._tapError=n.error||jc,this._tapComplete=n.complete||jc)}_next(e){try{this._tapNext.call(this._context,e)}catch(n){return void this.destination.error(n)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(n){return void this.destination.error(n)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class u2{constructor(e){this.callback=e}call(e,n){return n.subscribe(new h2(e,this.callback))}}class h2 extends Te{constructor(e,n){super(e),this.add(new W(n))}}class Uc{constructor(e,n){this.id=e,this.url=n}}class Ux extends Uc{constructor(e,n,a="imperative",u=null){super(e,n),this.navigationTrigger=a,this.restoredState=u}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ym extends Uc{constructor(e,n,a){super(e,n),this.urlAfterRedirects=a}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class rE extends Uc{constructor(e,n,a){super(e,n),this.reason=a}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class d2 extends Uc{constructor(e,n,a){super(e,n),this.error=a}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class f2 extends Uc{constructor(e,n,a,u){super(e,n),this.urlAfterRedirects=a,this.state=u}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class p2 extends Uc{constructor(e,n,a,u){super(e,n),this.urlAfterRedirects=a,this.state=u}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class m2 extends Uc{constructor(e,n,a,u,m){super(e,n),this.urlAfterRedirects=a,this.state=u,this.shouldActivate=m}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class g2 extends Uc{constructor(e,n,a,u){super(e,n),this.urlAfterRedirects=a,this.state=u}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _2 extends Uc{constructor(e,n,a,u){super(e,n),this.urlAfterRedirects=a,this.state=u}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class iE{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class oE{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class y2{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class v2{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class x2{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class b2{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class sE{constructor(e,n,a){this.routerEvent=e,this.position=n,this.anchor=a}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const mr="primary";class w2{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n[0]:n}return null}getAll(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Af(t){return new w2(t)}const aE="ngNavigationCancelingError";function Vx(t){const e=Error("NavigationCancelingError: "+t);return e[aE]=!0,e}function T2(t,e,n){const a=n.path.split("/");if(a.length>t.length||"full"===n.pathMatch&&(e.hasChildren()||a.length<t.length))return null;const u={};for(let m=0;m<a.length;m++){const v=a[m],T=t[m];if(v.startsWith(":"))u[v.substring(1)]=T;else if(v!==T.path)return null}return{consumed:t.slice(0,a.length),posParams:u}}function Wl(t,e){const n=t?Object.keys(t):void 0,a=e?Object.keys(e):void 0;if(!n||!a||n.length!=a.length)return!1;let u;for(let m=0;m<n.length;m++)if(u=n[m],!lE(t[u],e[u]))return!1;return!0}function lE(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;const n=[...t].sort(),a=[...e].sort();return n.every((u,m)=>a[m]===u)}return t===e}function cE(t){return Array.prototype.concat.apply([],t)}function uE(t){return t.length>0?t[t.length-1]:null}function Uo(t,e){for(const n in t)t.hasOwnProperty(n)&&e(t[n],n)}function Xl(t){return $0(t)?t:t_(t)?hr(Promise.resolve(t)):Hn(t)}const S2={exact:function fE(t,e,n){if(!td(t.segments,e.segments)||!U_(t.segments,e.segments,n)||t.numberOfChildren!==e.numberOfChildren)return!1;for(const a in e.children)if(!t.children[a]||!fE(t.children[a],e.children[a],n))return!1;return!0},subset:pE},hE={exact:function I2(t,e){return Wl(t,e)},subset:function M2(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>lE(t[n],e[n]))},ignored:()=>!0};function dE(t,e,n){return S2[n.paths](t.root,e.root,n.matrixParams)&&hE[n.queryParams](t.queryParams,e.queryParams)&&!("exact"===n.fragment&&t.fragment!==e.fragment)}function pE(t,e,n){return mE(t,e,e.segments,n)}function mE(t,e,n,a){if(t.segments.length>n.length){const u=t.segments.slice(0,n.length);return!(!td(u,n)||e.hasChildren()||!U_(u,n,a))}if(t.segments.length===n.length){if(!td(t.segments,n)||!U_(t.segments,n,a))return!1;for(const u in e.children)if(!t.children[u]||!pE(t.children[u],e.children[u],a))return!1;return!0}{const u=n.slice(0,t.segments.length),m=n.slice(t.segments.length);return!!(td(t.segments,u)&&U_(t.segments,u,a)&&t.children[mr])&&mE(t.children[mr],e,m,a)}}function U_(t,e,n){return e.every((a,u)=>hE[n](t[u].parameters,a.parameters))}class ed{constructor(e,n,a){this.root=e,this.queryParams=n,this.fragment=a}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Af(this.queryParams)),this._queryParamMap}toString(){return k2.serialize(this)}}class br{constructor(e,n){this.segments=e,this.children=n,this.parent=null,Uo(n,(a,u)=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return V_(this)}}class vm{constructor(e,n){this.path=e,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Af(this.parameters)),this._parameterMap}toString(){return xE(this)}}function td(t,e){return t.length===e.length&&t.every((n,a)=>n.path===e[a].path)}class gE{}class _E{parse(e){const n=new U2(e);return new ed(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(e){const n=`/${xm(e.root,!0)}`,a=function L2(t){const e=Object.keys(t).map(n=>{const a=t[n];return Array.isArray(a)?a.map(u=>`${$_(n)}=${$_(u)}`).join("&"):`${$_(n)}=${$_(a)}`}).filter(n=>!!n);return e.length?`?${e.join("&")}`:""}(e.queryParams),u="string"==typeof e.fragment?`#${function R2(t){return encodeURI(t)}(e.fragment)}`:"";return`${n}${a}${u}`}}const k2=new _E;function V_(t){return t.segments.map(e=>xE(e)).join("/")}function xm(t,e){if(!t.hasChildren())return V_(t);if(e){const n=t.children[mr]?xm(t.children[mr],!1):"",a=[];return Uo(t.children,(u,m)=>{m!==mr&&a.push(`${m}:${xm(u,!1)}`)}),a.length>0?`${n}(${a.join("//")})`:n}{const n=function P2(t,e){let n=[];return Uo(t.children,(a,u)=>{u===mr&&(n=n.concat(e(a,u)))}),Uo(t.children,(a,u)=>{u!==mr&&(n=n.concat(e(a,u)))}),n}(t,(a,u)=>u===mr?[xm(t.children[mr],!1)]:[`${u}:${xm(a,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[mr]?`${V_(t)}/${n[0]}`:`${V_(t)}/(${n.join("//")})`}}function yE(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function $_(t){return yE(t).replace(/%3B/gi,";")}function $x(t){return yE(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function G_(t){return decodeURIComponent(t)}function vE(t){return G_(t.replace(/\+/g,"%20"))}function xE(t){return`${$x(t.path)}${function O2(t){return Object.keys(t).map(e=>`;${$x(e)}=${$x(t[e])}`).join("")}(t.parameters)}`}const F2=/^[^\/()?;=#]+/;function H_(t){const e=t.match(F2);return e?e[0]:""}const z2=/^[^=?&#]+/,B2=/^[^&#]+/;class U2{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new br([],{}):new br([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(e.length>0||Object.keys(n).length>0)&&(a[mr]=new br(e,n)),a}parseSegment(){const e=H_(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new vm(G_(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const n=H_(this.remaining);if(!n)return;this.capture(n);let a="";if(this.consumeOptional("=")){const u=H_(this.remaining);u&&(a=u,this.capture(a))}e[G_(n)]=G_(a)}parseQueryParam(e){const n=function N2(t){const e=t.match(z2);return e?e[0]:""}(this.remaining);if(!n)return;this.capture(n);let a="";if(this.consumeOptional("=")){const v=function j2(t){const e=t.match(B2);return e?e[0]:""}(this.remaining);v&&(a=v,this.capture(a))}const u=vE(n),m=vE(a);if(e.hasOwnProperty(u)){let v=e[u];Array.isArray(v)||(v=[v],e[u]=v),v.push(m)}else e[u]=m}parseParens(e){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const a=H_(this.remaining),u=this.remaining[a.length];if("/"!==u&&")"!==u&&";"!==u)throw new Error(`Cannot parse url '${this.url}'`);let m;a.indexOf(":")>-1?(m=a.substr(0,a.indexOf(":")),this.capture(m),this.capture(":")):e&&(m=mr);const v=this.parseChildren();n[m]=1===Object.keys(v).length?v[mr]:new br([],v),this.consumeOptional("//")}return n}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class bE{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const n=this.pathFromRoot(e);return n.length>1?n[n.length-2]:null}children(e){const n=Gx(e,this._root);return n?n.children.map(a=>a.value):[]}firstChild(e){const n=Gx(e,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(e){const n=Hx(e,this._root);return n.length<2?[]:n[n.length-2].children.map(u=>u.value).filter(u=>u!==e)}pathFromRoot(e){return Hx(e,this._root).map(n=>n.value)}}function Gx(t,e){if(t===e.value)return e;for(const n of e.children){const a=Gx(t,n);if(a)return a}return null}function Hx(t,e){if(t===e.value)return[e];for(const n of e.children){const a=Hx(t,n);if(a.length)return a.unshift(e),a}return[]}class Vc{constructor(e,n){this.value=e,this.children=n}toString(){return`TreeNode(${this.value})`}}function Pf(t){const e={};return t&&t.children.forEach(n=>e[n.value.outlet]=n),e}class wE extends bE{constructor(e,n){super(e),this.snapshot=n,qx(this,e)}toString(){return this.snapshot.toString()}}function EE(t,e){const n=function V2(t,e){const v=new q_([],{},{},"",{},mr,e,null,t.root,-1,{});return new CE("",new Vc(v,[]))}(t,e),a=new yl([new vm("",{})]),u=new yl({}),m=new yl({}),v=new yl({}),T=new yl(""),I=new kf(a,u,v,T,m,mr,e,n.root);return I.snapshot=n.root,new wE(new Vc(I,[]),n)}class kf{constructor(e,n,a,u,m,v,T,I){this.url=e,this.params=n,this.queryParams=a,this.fragment=u,this.data=m,this.outlet=v,this.component=T,this._futureSnapshot=I}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(it(e=>Af(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(it(e=>Af(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function TE(t,e="emptyOnly"){const n=t.pathFromRoot;let a=0;if("always"!==e)for(a=n.length-1;a>=1;){const u=n[a],m=n[a-1];if(u.routeConfig&&""===u.routeConfig.path)a--;else{if(m.component)break;a--}}return function $2(t){return t.reduce((e,n)=>({params:Object.assign(Object.assign({},e.params),n.params),data:Object.assign(Object.assign({},e.data),n.data),resolve:Object.assign(Object.assign({},e.resolve),n._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(a))}class q_{constructor(e,n,a,u,m,v,T,I,O,N,Z){this.url=e,this.params=n,this.queryParams=a,this.fragment=u,this.data=m,this.outlet=v,this.component=T,this.routeConfig=I,this._urlSegment=O,this._lastPathIndex=N,this._resolve=Z}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Af(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Af(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(a=>a.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class CE extends bE{constructor(e,n){super(n),this.url=e,qx(this,n)}toString(){return DE(this._root)}}function qx(t,e){e.value._routerState=t,e.children.forEach(n=>qx(t,n))}function DE(t){const e=t.children.length>0?` { ${t.children.map(DE).join(", ")} } `:"";return`${t.value}${e}`}function Zx(t){if(t.snapshot){const e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,Wl(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),Wl(e.params,n.params)||t.params.next(n.params),function C2(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Wl(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),Wl(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Wx(t,e){const n=Wl(t.params,e.params)&&function A2(t,e){return td(t,e)&&t.every((n,a)=>Wl(n.parameters,e[a].parameters))}(t.url,e.url);return n&&!(!t.parent!=!e.parent)&&(!t.parent||Wx(t.parent,e.parent))}function bm(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){const a=n.value;a._futureSnapshot=e.value;const u=function H2(t,e,n){return e.children.map(a=>{for(const u of n.children)if(t.shouldReuseRoute(a.value,u.value.snapshot))return bm(t,a,u);return bm(t,a)})}(t,e,n);return new Vc(a,u)}{if(t.shouldAttach(e.value)){const m=t.retrieve(e.value);if(null!==m){const v=m.route;return v.value._futureSnapshot=e.value,v.children=e.children.map(T=>bm(t,T)),v}}const a=function q2(t){return new kf(new yl(t.url),new yl(t.params),new yl(t.queryParams),new yl(t.fragment),new yl(t.data),t.outlet,t.component,t)}(e.value),u=e.children.map(m=>bm(t,m));return new Vc(a,u)}}function Z_(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function wm(t){return"object"==typeof t&&null!=t&&t.outlets}function Xx(t,e,n,a,u){let m={};if(a&&Uo(a,(T,I)=>{m[I]=Array.isArray(T)?T.map(O=>`${O}`):`${T}`}),t===e)return new ed(n,m,u);const v=SE(t,e,n);return new ed(v,m,u)}function SE(t,e,n){const a={};return Uo(t.children,(u,m)=>{a[m]=u===e?n:SE(u,e,n)}),new br(t.segments,a)}class IE{constructor(e,n,a){if(this.isAbsolute=e,this.numberOfDoubleDots=n,this.commands=a,e&&a.length>0&&Z_(a[0]))throw new Error("Root segment cannot have matrix parameters");const u=a.find(wm);if(u&&u!==uE(a))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Kx{constructor(e,n,a){this.segmentGroup=e,this.processChildren=n,this.index=a}}function ME(t,e,n){if(t||(t=new br([],{})),0===t.segments.length&&t.hasChildren())return W_(t,e,n);const a=function J2(t,e,n){let a=0,u=e;const m={match:!1,pathIndex:0,commandIndex:0};for(;u<t.segments.length;){if(a>=n.length)return m;const v=t.segments[u],T=n[a];if(wm(T))break;const I=`${T}`,O=a<n.length-1?n[a+1]:null;if(u>0&&void 0===I)break;if(I&&O&&"object"==typeof O&&void 0===O.outlets){if(!PE(I,O,v))return m;a+=2}else{if(!PE(I,{},v))return m;a++}u++}return{match:!0,pathIndex:u,commandIndex:a}}(t,e,n),u=n.slice(a.commandIndex);if(a.match&&a.pathIndex<t.segments.length){const m=new br(t.segments.slice(0,a.pathIndex),{});return m.children[mr]=new br(t.segments.slice(a.pathIndex),t.children),W_(m,0,u)}return a.match&&0===u.length?new br(t.segments,{}):a.match&&!t.hasChildren()?Yx(t,e,n):a.match?W_(t,0,u):Yx(t,e,n)}function W_(t,e,n){if(0===n.length)return new br(t.segments,{});{const a=function Y2(t){return wm(t[0])?t[0].outlets:{[mr]:t}}(n),u={};return Uo(a,(m,v)=>{"string"==typeof m&&(m=[m]),null!==m&&(u[v]=ME(t.children[v],e,m))}),Uo(t.children,(m,v)=>{void 0===a[v]&&(u[v]=m)}),new br(t.segments,u)}}function Yx(t,e,n){const a=t.segments.slice(0,e);let u=0;for(;u<n.length;){const m=n[u];if(wm(m)){const I=Q2(m.outlets);return new br(a,I)}if(0===u&&Z_(n[0])){a.push(new vm(t.segments[e].path,AE(n[0]))),u++;continue}const v=wm(m)?m.outlets[mr]:`${m}`,T=u<n.length-1?n[u+1]:null;v&&T&&Z_(T)?(a.push(new vm(v,AE(T))),u+=2):(a.push(new vm(v,{})),u++)}return new br(a,{})}function Q2(t){const e={};return Uo(t,(n,a)=>{"string"==typeof n&&(n=[n]),null!==n&&(e[a]=Yx(new br([],{}),0,n))}),e}function AE(t){const e={};return Uo(t,(n,a)=>e[a]=`${n}`),e}function PE(t,e,n){return t==n.path&&Wl(e,n.parameters)}class tP{constructor(e,n,a,u){this.routeReuseStrategy=e,this.futureState=n,this.currState=a,this.forwardEvent=u}activate(e){const n=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,a,e),Zx(this.futureState.root),this.activateChildRoutes(n,a,e)}deactivateChildRoutes(e,n,a){const u=Pf(n);e.children.forEach(m=>{const v=m.value.outlet;this.deactivateRoutes(m,u[v],a),delete u[v]}),Uo(u,(m,v)=>{this.deactivateRouteAndItsChildren(m,a)})}deactivateRoutes(e,n,a){const u=e.value,m=n?n.value:null;if(u===m)if(u.component){const v=a.getContext(u.outlet);v&&this.deactivateChildRoutes(e,n,v.children)}else this.deactivateChildRoutes(e,n,a);else m&&this.deactivateRouteAndItsChildren(n,a)}deactivateRouteAndItsChildren(e,n){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,n):this.deactivateRouteAndOutlet(e,n)}detachAndStoreRouteSubtree(e,n){const a=n.getContext(e.value.outlet),u=a&&e.value.component?a.children:n,m=Pf(e);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],u);if(a&&a.outlet){const v=a.outlet.detach(),T=a.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:v,route:e,contexts:T})}}deactivateRouteAndOutlet(e,n){const a=n.getContext(e.value.outlet),u=a&&e.value.component?a.children:n,m=Pf(e);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],u);a&&a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated(),a.attachRef=null,a.resolver=null,a.route=null)}activateChildRoutes(e,n,a){const u=Pf(n);e.children.forEach(m=>{this.activateRoutes(m,u[m.value.outlet],a),this.forwardEvent(new b2(m.value.snapshot))}),e.children.length&&this.forwardEvent(new v2(e.value.snapshot))}activateRoutes(e,n,a){const u=e.value,m=n?n.value:null;if(Zx(u),u===m)if(u.component){const v=a.getOrCreateContext(u.outlet);this.activateChildRoutes(e,n,v.children)}else this.activateChildRoutes(e,n,a);else if(u.component){const v=a.getOrCreateContext(u.outlet);if(this.routeReuseStrategy.shouldAttach(u.snapshot)){const T=this.routeReuseStrategy.retrieve(u.snapshot);this.routeReuseStrategy.store(u.snapshot,null),v.children.onOutletReAttached(T.contexts),v.attachRef=T.componentRef,v.route=T.route.value,v.outlet&&v.outlet.attach(T.componentRef,T.route.value),Zx(T.route.value),this.activateChildRoutes(e,null,v.children)}else{const T=function nP(t){for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(u.snapshot),I=T?T.module.componentFactoryResolver:null;v.attachRef=null,v.route=u,v.resolver=I,v.outlet&&v.outlet.activateWith(u,I),this.activateChildRoutes(e,null,v.children)}}else this.activateChildRoutes(e,null,a)}}class Jx{constructor(e,n){this.routes=e,this.module=n}}function Vu(t){return"function"==typeof t}function nd(t){return t instanceof ed}const Em=Symbol("INITIAL_VALUE");function Tm(){return Fa(t=>function FA(...t){let e,n;return ut(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Y(t[0])&&(t=t[0]),Pi(t,n).lift(new zA(e))}(t.map(e=>e.pipe(Bc(1),function qA(...t){const e=t[t.length-1];return ut(e)?(t.pop(),n=>N_(t,n,e)):n=>N_(t,n)}(Em)))).pipe(eE((e,n)=>{let a=!1;return n.reduce((u,m,v)=>u!==Em?u:(m===Em&&(a=!0),a||!1!==m&&v!==n.length-1&&!nd(m)?u:m),e)},Em),pa(e=>e!==Em),it(e=>nd(e)?e:!0===e),Bc(1)))}class lP{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Cm,this.attachRef=null}}class Cm{constructor(){this.contexts=new Map}onChildOutletCreated(e,n){const a=this.getOrCreateContext(e);a.outlet=n,this.contexts.set(e,a)}onChildOutletDestroyed(e){const n=this.getContext(e);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let n=this.getContext(e);return n||(n=new lP,this.contexts.set(e,n)),n}getContext(e){return this.contexts.get(e)||null}}let X_=(()=>{class t{constructor(n,a,u,m,v){this.parentContexts=n,this.location=a,this.resolver=u,this.changeDetector=v,this.activated=null,this._activatedRoute=null,this.activateEvents=new Cs,this.deactivateEvents=new Cs,this.attachEvents=new Cs,this.detachEvents=new Cs,this.name=m||mr,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,a){this.activated=n,this._activatedRoute=a,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,a){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const v=(a=a||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),T=this.parentContexts.getOrCreateContext(this.name).children,I=new cP(n,T,this.location.injector);this.activated=this.location.createComponent(v,this.location.length,I),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(n){return new(n||t)(Tn(Cm),Tn(Ra),Tn(sm),Ke("name"),Tn(dx))},t.\u0275dir=ti({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),t})();class cP{constructor(e,n,a){this.route=e,this.childContexts=n,this.parent=a}get(e,n){return e===kf?this.route:e===Cm?this.childContexts:this.parent.get(e,n)}}let kE=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Sr({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,a){1&n&&zu(0,"router-outlet")},directives:[X_],encapsulation:2}),t})();function RE(t,e=""){for(let n=0;n<t.length;n++){const a=t[n];uP(a,hP(e,a))}}function uP(t,e){t.children&&RE(t.children,e)}function hP(t,e){return e?t||e.path?t&&!e.path?`${t}/`:!t&&e.path?e.path:`${t}/${e.path}`:"":t}function Qx(t){const e=t.children&&t.children.map(Qx),n=e?Object.assign(Object.assign({},t),{children:e}):Object.assign({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==mr&&(n.component=kE),n}function za(t){return t.outlet||mr}function OE(t,e){const n=t.filter(a=>za(a)===e);return n.push(...t.filter(a=>za(a)!==e)),n}const LE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function K_(t,e,n){var a;if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?Object.assign({},LE):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const m=(e.matcher||T2)(n,t,e);if(!m)return Object.assign({},LE);const v={};Uo(m.posParams,(I,O)=>{v[O]=I.path});const T=m.consumed.length>0?Object.assign(Object.assign({},v),m.consumed[m.consumed.length-1].parameters):v;return{matched:!0,consumedSegments:m.consumed,remainingSegments:n.slice(m.consumed.length),parameters:T,positionalParamSegments:null!==(a=m.posParams)&&void 0!==a?a:{}}}function Y_(t,e,n,a,u="corrected"){if(n.length>0&&function pP(t,e,n){return n.some(a=>J_(t,e,a)&&za(a)!==mr)}(t,n,a)){const v=new br(e,function fP(t,e,n,a){const u={};u[mr]=a,a._sourceSegment=t,a._segmentIndexShift=e.length;for(const m of n)if(""===m.path&&za(m)!==mr){const v=new br([],{});v._sourceSegment=t,v._segmentIndexShift=e.length,u[za(m)]=v}return u}(t,e,a,new br(n,t.children)));return v._sourceSegment=t,v._segmentIndexShift=e.length,{segmentGroup:v,slicedSegments:[]}}if(0===n.length&&function mP(t,e,n){return n.some(a=>J_(t,e,a))}(t,n,a)){const v=new br(t.segments,function dP(t,e,n,a,u,m){const v={};for(const T of a)if(J_(t,n,T)&&!u[za(T)]){const I=new br([],{});I._sourceSegment=t,I._segmentIndexShift="legacy"===m?t.segments.length:e.length,v[za(T)]=I}return Object.assign(Object.assign({},u),v)}(t,e,n,a,t.children,u));return v._sourceSegment=t,v._segmentIndexShift=e.length,{segmentGroup:v,slicedSegments:n}}const m=new br(t.segments,t.children);return m._sourceSegment=t,m._segmentIndexShift=e.length,{segmentGroup:m,slicedSegments:n}}function J_(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path}function FE(t,e,n,a){return!!(za(t)===a||a!==mr&&J_(e,n,t))&&("**"===t.path||K_(e,t,n).matched)}function zE(t,e,n){return 0===e.length&&!t.children[n]}class Q_{constructor(e){this.segmentGroup=e||null}}class NE{constructor(e){this.urlTree=e}}function Dm(t){return Df(new Q_(t))}function BE(t){return Df(new NE(t))}function gP(t){return Df(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`))}class vP{constructor(e,n,a,u,m){this.configLoader=n,this.urlSerializer=a,this.urlTree=u,this.config=m,this.allowRedirects=!0,this.ngModule=e.get(Lc)}apply(){const e=Y_(this.urlTree.root,[],[],this.config).segmentGroup,n=new br(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,n,mr).pipe(it(m=>this.createUrlTree(e0(m),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Qh(m=>{if(m instanceof NE)return this.allowRedirects=!1,this.match(m.urlTree);throw m instanceof Q_?this.noMatchError(m):m}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,mr).pipe(it(u=>this.createUrlTree(e0(u),e.queryParams,e.fragment))).pipe(Qh(u=>{throw u instanceof Q_?this.noMatchError(u):u}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,n,a){const u=e.segments.length>0?new br([],{[mr]:e}):e;return new ed(u,n,a)}expandSegmentGroup(e,n,a,u){return 0===a.segments.length&&a.hasChildren()?this.expandChildren(e,n,a).pipe(it(m=>new br([],m))):this.expandSegment(e,a,n,a.segments,u,!0)}expandChildren(e,n,a){const u=[];for(const m of Object.keys(a.children))"primary"===m?u.unshift(m):u.push(m);return hr(u).pipe(If(m=>{const v=a.children[m],T=OE(n,m);return this.expandSegmentGroup(e,T,v,m).pipe(it(I=>({segment:I,outlet:m})))}),eE((m,v)=>(m[v.outlet]=v.segment,m),{}),function s2(t,e){const n=arguments.length>=2;return a=>a.pipe(t?pa((u,m)=>t(u,m,a)):J,jx(1),n?nE(e):tE(()=>new z_))}())}expandSegment(e,n,a,u,m,v){return hr(a).pipe(If(T=>this.expandSegmentAgainstRoute(e,n,a,T,u,m,v).pipe(Qh(O=>{if(O instanceof Q_)return Hn(null);throw O}))),Mf(T=>!!T),Qh((T,I)=>{if(T instanceof z_||"EmptyError"===T.name)return zE(n,u,m)?Hn(new br([],{})):Dm(n);throw T}))}expandSegmentAgainstRoute(e,n,a,u,m,v,T){return FE(u,n,m,v)?void 0===u.redirectTo?this.matchSegmentAgainstRoute(e,n,u,m,v):T&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,n,a,u,m,v):Dm(n):Dm(n)}expandSegmentAgainstRouteUsingRedirect(e,n,a,u,m,v){return"**"===u.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,a,u,v):this.expandRegularSegmentAgainstRouteUsingRedirect(e,n,a,u,m,v)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,a,u){const m=this.applyRedirectCommands([],a.redirectTo,{});return a.redirectTo.startsWith("/")?BE(m):this.lineralizeSegments(a,m).pipe(Nr(v=>{const T=new br(v,{});return this.expandSegment(e,T,n,v,u,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,n,a,u,m,v){const{matched:T,consumedSegments:I,remainingSegments:O,positionalParamSegments:N}=K_(n,u,m);if(!T)return Dm(n);const Z=this.applyRedirectCommands(I,u.redirectTo,N);return u.redirectTo.startsWith("/")?BE(Z):this.lineralizeSegments(u,Z).pipe(Nr(ye=>this.expandSegment(e,n,a,ye.concat(O),v,!1)))}matchSegmentAgainstRoute(e,n,a,u,m){if("**"===a.path)return a.loadChildren?(a._loadedConfig?Hn(a._loadedConfig):this.configLoader.load(e.injector,a)).pipe(it(Z=>(a._loadedConfig=Z,new br(u,{})))):Hn(new br(u,{}));const{matched:v,consumedSegments:T,remainingSegments:I}=K_(n,a,u);return v?this.getChildConfig(e,a,u).pipe(Nr(N=>{const Z=N.module,ye=N.routes,{segmentGroup:be,slicedSegments:Ge}=Y_(n,T,I,ye),vt=new br(be.segments,be.children);if(0===Ge.length&&vt.hasChildren())return this.expandChildren(Z,ye,vt).pipe(it(dn=>new br(T,dn)));if(0===ye.length&&0===Ge.length)return Hn(new br(T,{}));const Rt=za(a)===m;return this.expandSegment(Z,vt,ye,Ge,Rt?mr:m,!0).pipe(it(ct=>new br(T.concat(ct.segments),ct.children)))})):Dm(n)}getChildConfig(e,n,a){return n.children?Hn(new Jx(n.children,e)):n.loadChildren?void 0!==n._loadedConfig?Hn(n._loadedConfig):this.runCanLoadGuards(e.injector,n,a).pipe(Nr(u=>u?this.configLoader.load(e.injector,n).pipe(it(m=>(n._loadedConfig=m,m))):function _P(t){return Df(Vx(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`))}(n))):Hn(new Jx([],e))}runCanLoadGuards(e,n,a){const u=n.canLoad;if(!u||0===u.length)return Hn(!0);const m=u.map(v=>{const T=e.get(v);let I;if(function iP(t){return t&&Vu(t.canLoad)}(T))I=T.canLoad(n,a);else{if(!Vu(T))throw new Error("Invalid CanLoad guard");I=T(n,a)}return Xl(I)});return Hn(m).pipe(Tm(),Hs(v=>{if(!nd(v))return;const T=Vx(`Redirecting to "${this.urlSerializer.serialize(v)}"`);throw T.url=v,T}),it(v=>!0===v))}lineralizeSegments(e,n){let a=[],u=n.root;for(;;){if(a=a.concat(u.segments),0===u.numberOfChildren)return Hn(a);if(u.numberOfChildren>1||!u.children[mr])return gP(e.redirectTo);u=u.children[mr]}}applyRedirectCommands(e,n,a){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),e,a)}applyRedirectCreatreUrlTree(e,n,a,u){const m=this.createSegmentGroup(e,n.root,a,u);return new ed(m,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(e,n){const a={};return Uo(e,(u,m)=>{if("string"==typeof u&&u.startsWith(":")){const T=u.substring(1);a[m]=n[T]}else a[m]=u}),a}createSegmentGroup(e,n,a,u){const m=this.createSegments(e,n.segments,a,u);let v={};return Uo(n.children,(T,I)=>{v[I]=this.createSegmentGroup(e,T,a,u)}),new br(m,v)}createSegments(e,n,a,u){return n.map(m=>m.path.startsWith(":")?this.findPosParam(e,m,u):this.findOrReturn(m,a))}findPosParam(e,n,a){const u=a[n.path.substring(1)];if(!u)throw new Error(`Cannot redirect to '${e}'. Cannot find '${n.path}'.`);return u}findOrReturn(e,n){let a=0;for(const u of n){if(u.path===e.path)return n.splice(a),u;a++}return e}}function e0(t){const e={};for(const a of Object.keys(t.children)){const m=e0(t.children[a]);(m.segments.length>0||m.hasChildren())&&(e[a]=m)}return function xP(t){if(1===t.numberOfChildren&&t.children[mr]){const e=t.children[mr];return new br(t.segments.concat(e.segments),e.children)}return t}(new br(t.segments,e))}class jE{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class ey{constructor(e,n){this.component=e,this.route=n}}function wP(t,e,n){const a=t._root;return Sm(a,e?e._root:null,n,[a.value])}function ty(t,e,n){const a=function TP(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(e);return(a?a.module.injector:n).get(t)}function Sm(t,e,n,a,u={canDeactivateChecks:[],canActivateChecks:[]}){const m=Pf(e);return t.children.forEach(v=>{(function CP(t,e,n,a,u={canDeactivateChecks:[],canActivateChecks:[]}){const m=t.value,v=e?e.value:null,T=n?n.getContext(t.value.outlet):null;if(v&&m.routeConfig===v.routeConfig){const I=function DP(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!td(t.url,e.url);case"pathParamsOrQueryParamsChange":return!td(t.url,e.url)||!Wl(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Wx(t,e)||!Wl(t.queryParams,e.queryParams);default:return!Wx(t,e)}}(v,m,m.routeConfig.runGuardsAndResolvers);I?u.canActivateChecks.push(new jE(a)):(m.data=v.data,m._resolvedData=v._resolvedData),Sm(t,e,m.component?T?T.children:null:n,a,u),I&&T&&T.outlet&&T.outlet.isActivated&&u.canDeactivateChecks.push(new ey(T.outlet.component,v))}else v&&Im(e,T,u),u.canActivateChecks.push(new jE(a)),Sm(t,null,m.component?T?T.children:null:n,a,u)})(v,m[v.value.outlet],n,a.concat([v.value]),u),delete m[v.value.outlet]}),Uo(m,(v,T)=>Im(v,n.getContext(T),u)),u}function Im(t,e,n){const a=Pf(t),u=t.value;Uo(a,(m,v)=>{Im(m,u.component?e?e.children.getContext(v):null:e,n)}),n.canDeactivateChecks.push(new ey(u.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,u))}class LP{}function UE(t){return new Be(e=>e.error(t))}class zP{constructor(e,n,a,u,m,v){this.rootComponentType=e,this.config=n,this.urlTree=a,this.url=u,this.paramsInheritanceStrategy=m,this.relativeLinkResolution=v}recognize(){const e=Y_(this.urlTree.root,[],[],this.config.filter(v=>void 0===v.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,e,mr);if(null===n)return null;const a=new q_([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},mr,this.rootComponentType,null,this.urlTree.root,-1,{}),u=new Vc(a,n),m=new CE(this.url,u);return this.inheritParamsAndData(m._root),m}inheritParamsAndData(e){const n=e.value,a=TE(n,this.paramsInheritanceStrategy);n.params=Object.freeze(a.params),n.data=Object.freeze(a.data),e.children.forEach(u=>this.inheritParamsAndData(u))}processSegmentGroup(e,n,a){return 0===n.segments.length&&n.hasChildren()?this.processChildren(e,n):this.processSegment(e,n,n.segments,a)}processChildren(e,n){const a=[];for(const m of Object.keys(n.children)){const v=n.children[m],T=OE(e,m),I=this.processSegmentGroup(T,v,m);if(null===I)return null;a.push(...I)}const u=VE(a);return function NP(t){t.sort((e,n)=>e.value.outlet===mr?-1:n.value.outlet===mr?1:e.value.outlet.localeCompare(n.value.outlet))}(u),u}processSegment(e,n,a,u){for(const m of e){const v=this.processSegmentAgainstRoute(m,n,a,u);if(null!==v)return v}return zE(n,a,u)?[]:null}processSegmentAgainstRoute(e,n,a,u){if(e.redirectTo||!FE(e,n,a,u))return null;let m,v=[],T=[];if("**"===e.path){const be=a.length>0?uE(a).parameters:{};m=new q_(a,be,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,HE(e),za(e),e.component,e,$E(n),GE(n)+a.length,qE(e))}else{const be=K_(n,e,a);if(!be.matched)return null;v=be.consumedSegments,T=be.remainingSegments,m=new q_(v,be.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,HE(e),za(e),e.component,e,$E(n),GE(n)+v.length,qE(e))}const I=function BP(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(e),{segmentGroup:O,slicedSegments:N}=Y_(n,v,T,I.filter(be=>void 0===be.redirectTo),this.relativeLinkResolution);if(0===N.length&&O.hasChildren()){const be=this.processChildren(I,O);return null===be?null:[new Vc(m,be)]}if(0===I.length&&0===N.length)return[new Vc(m,[])];const Z=za(e)===u,ye=this.processSegment(I,O,N,Z?mr:u);return null===ye?null:[new Vc(m,ye)]}}function jP(t){const e=t.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function VE(t){const e=[],n=new Set;for(const a of t){if(!jP(a)){e.push(a);continue}const u=e.find(m=>a.value.routeConfig===m.value.routeConfig);void 0!==u?(u.children.push(...a.children),n.add(u)):e.push(a)}for(const a of n){const u=VE(a.children);e.push(new Vc(a.value,u))}return e.filter(a=>!n.has(a))}function $E(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function GE(t){let e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,n+=e._segmentIndexShift?e._segmentIndexShift:0;return n-1}function HE(t){return t.data||{}}function qE(t){return t.resolve||{}}function ZE(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function t0(t){return Fa(e=>{const n=t(e);return n?hr(n).pipe(it(()=>e)):Hn(e)})}class WP extends class ZP{shouldDetach(e){return!1}store(e,n){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,n){return e.routeConfig===n.routeConfig}}{}const n0=new Yt("ROUTES");class WE{constructor(e,n,a,u){this.injector=e,this.compiler=n,this.onLoadStartListener=a,this.onLoadEndListener=u}load(e,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const u=this.loadModuleFactory(n.loadChildren).pipe(it(m=>{this.onLoadEndListener&&this.onLoadEndListener(n);const v=m.create(e);return new Jx(cE(v.injector.get(n0,void 0,xn.Self|xn.Optional)).map(Qx),v)}),Qh(m=>{throw n._loader$=void 0,m}));return n._loader$=new ss(u,()=>new Et).pipe($o()),n._loader$}loadModuleFactory(e){return Xl(e()).pipe(Nr(n=>n instanceof p1?Hn(n):hr(this.compiler.compileModuleAsync(n))))}}class KP{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,n){return e}}function YP(t){throw t}function JP(t,e,n){return e.parse("/")}function XE(t,e){return Hn(null)}const QP={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ek={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ma=(()=>{class t{constructor(n,a,u,m,v,T,I){this.rootComponentType=n,this.urlSerializer=a,this.rootContexts=u,this.location=m,this.config=I,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Et,this.errorHandler=YP,this.malformedUriErrorHandler=JP,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:XE,afterPreactivation:XE},this.urlHandlingStrategy=new KP,this.routeReuseStrategy=new WP,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=v.get(Lc),this.console=v.get(FS);const Z=v.get(Io);this.isNgZoneEnabled=Z instanceof Io&&Io.isInAngularZone(),this.resetConfig(I),this.currentUrlTree=function D2(){return new ed(new br([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new WE(v,T,ye=>this.triggerEvent(new iE(ye)),ye=>this.triggerEvent(new oE(ye))),this.routerState=EE(this.currentUrlTree,this.rootComponentType),this.transitions=new yl({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var n;return null===(n=this.location.getState())||void 0===n?void 0:n.\u0275routerPageId}setupNavigations(n){const a=this.events;return n.pipe(pa(u=>0!==u.id),it(u=>Object.assign(Object.assign({},u),{extractedUrl:this.urlHandlingStrategy.extract(u.rawUrl)})),Fa(u=>{let m=!1,v=!1;return Hn(u).pipe(Hs(T=>{this.currentNavigation={id:T.id,initialUrl:T.currentRawUrl,extractedUrl:T.extractedUrl,trigger:T.source,extras:T.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Fa(T=>{const I=this.browserUrlTree.toString(),O=!this.navigated||T.extractedUrl.toString()!==I||I!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||O)&&this.urlHandlingStrategy.shouldProcessUrl(T.rawUrl))return KE(T.source)&&(this.browserUrlTree=T.extractedUrl),Hn(T).pipe(Fa(Z=>{const ye=this.transitions.getValue();return a.next(new Ux(Z.id,this.serializeUrl(Z.extractedUrl),Z.source,Z.restoredState)),ye!==this.transitions.getValue()?Sf:Promise.resolve(Z)}),function bP(t,e,n,a){return Fa(u=>function yP(t,e,n,a,u){return new vP(t,e,n,a,u).apply()}(t,e,n,u.extractedUrl,a).pipe(it(m=>Object.assign(Object.assign({},u),{urlAfterRedirects:m}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Hs(Z=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:Z.urlAfterRedirects})}),function UP(t,e,n,a,u){return Nr(m=>function FP(t,e,n,a,u="emptyOnly",m="legacy"){try{const v=new zP(t,e,n,a,u,m).recognize();return null===v?UE(new LP):Hn(v)}catch(v){return UE(v)}}(t,e,m.urlAfterRedirects,n(m.urlAfterRedirects),a,u).pipe(it(v=>Object.assign(Object.assign({},m),{targetSnapshot:v}))))}(this.rootComponentType,this.config,Z=>this.serializeUrl(Z),this.paramsInheritanceStrategy,this.relativeLinkResolution),Hs(Z=>{if("eager"===this.urlUpdateStrategy){if(!Z.extras.skipLocationChange){const be=this.urlHandlingStrategy.merge(Z.urlAfterRedirects,Z.rawUrl);this.setBrowserUrl(be,Z)}this.browserUrlTree=Z.urlAfterRedirects}const ye=new f2(Z.id,this.serializeUrl(Z.extractedUrl),this.serializeUrl(Z.urlAfterRedirects),Z.targetSnapshot);a.next(ye)}));if(O&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:ye,extractedUrl:be,source:Ge,restoredState:vt,extras:Rt}=T,Ut=new Ux(ye,this.serializeUrl(be),Ge,vt);a.next(Ut);const ct=EE(be,this.rootComponentType).snapshot;return Hn(Object.assign(Object.assign({},T),{targetSnapshot:ct,urlAfterRedirects:be,extras:Object.assign(Object.assign({},Rt),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=T.rawUrl,T.resolve(null),Sf}),t0(T=>{const{targetSnapshot:I,id:O,extractedUrl:N,rawUrl:Z,extras:{skipLocationChange:ye,replaceUrl:be}}=T;return this.hooks.beforePreactivation(I,{navigationId:O,appliedUrlTree:N,rawUrlTree:Z,skipLocationChange:!!ye,replaceUrl:!!be})}),Hs(T=>{const I=new p2(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(I)}),it(T=>Object.assign(Object.assign({},T),{guards:wP(T.targetSnapshot,T.currentSnapshot,this.rootContexts)})),function SP(t,e){return Nr(n=>{const{targetSnapshot:a,currentSnapshot:u,guards:{canActivateChecks:m,canDeactivateChecks:v}}=n;return 0===v.length&&0===m.length?Hn(Object.assign(Object.assign({},n),{guardsResult:!0})):function IP(t,e,n,a){return hr(t).pipe(Nr(u=>function OP(t,e,n,a,u){const m=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return m&&0!==m.length?Hn(m.map(T=>{const I=ty(T,e,u);let O;if(function aP(t){return t&&Vu(t.canDeactivate)}(I))O=Xl(I.canDeactivate(t,e,n,a));else{if(!Vu(I))throw new Error("Invalid CanDeactivate guard");O=Xl(I(t,e,n,a))}return O.pipe(Mf())})).pipe(Tm()):Hn(!0)}(u.component,u.route,n,e,a)),Mf(u=>!0!==u,!0))}(v,a,u,t).pipe(Nr(T=>T&&function rP(t){return"boolean"==typeof t}(T)?function MP(t,e,n,a){return hr(e).pipe(If(u=>N_(function PP(t,e){return null!==t&&e&&e(new y2(t)),Hn(!0)}(u.route.parent,a),function AP(t,e){return null!==t&&e&&e(new x2(t)),Hn(!0)}(u.route,a),function RP(t,e,n){const a=e[e.length-1],m=e.slice(0,e.length-1).reverse().map(v=>function EP(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(v)).filter(v=>null!==v).map(v=>j_(()=>Hn(v.guards.map(I=>{const O=ty(I,v.node,n);let N;if(function sP(t){return t&&Vu(t.canActivateChild)}(O))N=Xl(O.canActivateChild(a,t));else{if(!Vu(O))throw new Error("Invalid CanActivateChild guard");N=Xl(O(a,t))}return N.pipe(Mf())})).pipe(Tm())));return Hn(m).pipe(Tm())}(t,u.path,n),function kP(t,e,n){const a=e.routeConfig?e.routeConfig.canActivate:null;if(!a||0===a.length)return Hn(!0);const u=a.map(m=>j_(()=>{const v=ty(m,e,n);let T;if(function oP(t){return t&&Vu(t.canActivate)}(v))T=Xl(v.canActivate(e,t));else{if(!Vu(v))throw new Error("Invalid CanActivate guard");T=Xl(v(e,t))}return T.pipe(Mf())}));return Hn(u).pipe(Tm())}(t,u.route,n))),Mf(u=>!0!==u,!0))}(a,m,t,e):Hn(T)),it(T=>Object.assign(Object.assign({},n),{guardsResult:T})))})}(this.ngModule.injector,T=>this.triggerEvent(T)),Hs(T=>{if(nd(T.guardsResult)){const O=Vx(`Redirecting to "${this.serializeUrl(T.guardsResult)}"`);throw O.url=T.guardsResult,O}const I=new m2(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot,!!T.guardsResult);this.triggerEvent(I)}),pa(T=>!!T.guardsResult||(this.restoreHistory(T),this.cancelNavigationTransition(T,""),!1)),t0(T=>{if(T.guards.canActivateChecks.length)return Hn(T).pipe(Hs(I=>{const O=new g2(I.id,this.serializeUrl(I.extractedUrl),this.serializeUrl(I.urlAfterRedirects),I.targetSnapshot);this.triggerEvent(O)}),Fa(I=>{let O=!1;return Hn(I).pipe(function VP(t,e){return Nr(n=>{const{targetSnapshot:a,guards:{canActivateChecks:u}}=n;if(!u.length)return Hn(n);let m=0;return hr(u).pipe(If(v=>function $P(t,e,n,a){return function GP(t,e,n,a){const u=ZE(t);if(0===u.length)return Hn({});const m={};return hr(u).pipe(Nr(v=>function HP(t,e,n,a){const u=ty(t,e,a);return Xl(u.resolve?u.resolve(e,n):u(e,n))}(t[v],e,n,a).pipe(Hs(T=>{m[v]=T}))),jx(1),Nr(()=>ZE(m).length===u.length?Hn(m):Sf))}(t._resolve,t,e,a).pipe(it(m=>(t._resolvedData=m,t.data=Object.assign(Object.assign({},t.data),TE(t,n).resolve),null)))}(v.route,a,t,e)),Hs(()=>m++),jx(1),Nr(v=>m===u.length?Hn(n):Sf))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Hs({next:()=>O=!0,complete:()=>{O||(this.restoreHistory(I),this.cancelNavigationTransition(I,"At least one route resolver didn't emit any value."))}}))}),Hs(I=>{const O=new _2(I.id,this.serializeUrl(I.extractedUrl),this.serializeUrl(I.urlAfterRedirects),I.targetSnapshot);this.triggerEvent(O)}))}),t0(T=>{const{targetSnapshot:I,id:O,extractedUrl:N,rawUrl:Z,extras:{skipLocationChange:ye,replaceUrl:be}}=T;return this.hooks.afterPreactivation(I,{navigationId:O,appliedUrlTree:N,rawUrlTree:Z,skipLocationChange:!!ye,replaceUrl:!!be})}),it(T=>{const I=function G2(t,e,n){const a=bm(t,e._root,n?n._root:void 0);return new wE(a,e)}(this.routeReuseStrategy,T.targetSnapshot,T.currentRouterState);return Object.assign(Object.assign({},T),{targetRouterState:I})}),Hs(T=>{this.currentUrlTree=T.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(T.urlAfterRedirects,T.rawUrl),this.routerState=T.targetRouterState,"deferred"===this.urlUpdateStrategy&&(T.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,T),this.browserUrlTree=T.urlAfterRedirects)}),((t,e,n)=>it(a=>(new tP(e,a.targetRouterState,a.currentRouterState,n).activate(t),a)))(this.rootContexts,this.routeReuseStrategy,T=>this.triggerEvent(T)),Hs({next(){m=!0},complete(){m=!0}}),function c2(t){return e=>e.lift(new u2(t))}(()=>{var T;m||v||this.cancelNavigationTransition(u,`Navigation ID ${u.id} is not equal to the current navigation id ${this.navigationId}`),(null===(T=this.currentNavigation)||void 0===T?void 0:T.id)===u.id&&(this.currentNavigation=null)}),Qh(T=>{if(v=!0,function E2(t){return t&&t[aE]}(T)){const I=nd(T.url);I||(this.navigated=!0,this.restoreHistory(u,!0));const O=new rE(u.id,this.serializeUrl(u.extractedUrl),T.message);a.next(O),I?setTimeout(()=>{const N=this.urlHandlingStrategy.merge(T.url,this.rawUrlTree),Z={skipLocationChange:u.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||KE(u.source)};this.scheduleNavigation(N,"imperative",null,Z,{resolve:u.resolve,reject:u.reject,promise:u.promise})},0):u.resolve(!1)}else{this.restoreHistory(u,!0);const I=new d2(u.id,this.serializeUrl(u.extractedUrl),T);a.next(I);try{u.resolve(this.errorHandler(T))}catch(O){u.reject(O)}}return Sf}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),n))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const a="popstate"===n.type?"popstate":"hashchange";"popstate"===a&&setTimeout(()=>{var u;const m={replaceUrl:!0},v=(null===(u=n.state)||void 0===u?void 0:u.navigationId)?n.state:null;if(v){const I=Object.assign({},v);delete I.navigationId,delete I.\u0275routerPageId,0!==Object.keys(I).length&&(m.state=I)}const T=this.parseUrl(n.url);this.scheduleNavigation(T,a,v,m)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){RE(n),this.config=n.map(Qx),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,a={}){const{relativeTo:u,queryParams:m,fragment:v,queryParamsHandling:T,preserveFragment:I}=a,O=u||this.routerState.root,N=I?this.currentUrlTree.fragment:v;let Z=null;switch(T){case"merge":Z=Object.assign(Object.assign({},this.currentUrlTree.queryParams),m);break;case"preserve":Z=this.currentUrlTree.queryParams;break;default:Z=m||null}return null!==Z&&(Z=this.removeEmptyProps(Z)),function Z2(t,e,n,a,u){if(0===n.length)return Xx(e.root,e.root,e.root,a,u);const m=function W2(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new IE(!0,0,t);let e=0,n=!1;const a=t.reduce((u,m,v)=>{if("object"==typeof m&&null!=m){if(m.outlets){const T={};return Uo(m.outlets,(I,O)=>{T[O]="string"==typeof I?I.split("/"):I}),[...u,{outlets:T}]}if(m.segmentPath)return[...u,m.segmentPath]}return"string"!=typeof m?[...u,m]:0===v?(m.split("/").forEach((T,I)=>{0==I&&"."===T||(0==I&&""===T?n=!0:".."===T?e++:""!=T&&u.push(T))}),u):[...u,m]},[]);return new IE(n,e,a)}(n);if(m.toRoot())return Xx(e.root,e.root,new br([],{}),a,u);const v=function X2(t,e,n){if(t.isAbsolute)return new Kx(e.root,!0,0);if(-1===n.snapshot._lastPathIndex){const m=n.snapshot._urlSegment;return new Kx(m,m===e.root,0)}const a=Z_(t.commands[0])?0:1;return function K2(t,e,n){let a=t,u=e,m=n;for(;m>u;){if(m-=u,a=a.parent,!a)throw new Error("Invalid number of '../'");u=a.segments.length}return new Kx(a,!1,u-m)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+a,t.numberOfDoubleDots)}(m,e,t),T=v.processChildren?W_(v.segmentGroup,v.index,m.commands):ME(v.segmentGroup,v.index,m.commands);return Xx(e.root,v.segmentGroup,T,a,u)}(O,this.currentUrlTree,n,Z,null!=N?N:null)}navigateByUrl(n,a={skipLocationChange:!1}){const u=nd(n)?n:this.parseUrl(n),m=this.urlHandlingStrategy.merge(u,this.rawUrlTree);return this.scheduleNavigation(m,"imperative",null,a)}navigate(n,a={skipLocationChange:!1}){return function tk(t){for(let e=0;e<t.length;e++){const n=t[e];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${e}`)}}(n),this.navigateByUrl(this.createUrlTree(n,a),a)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let a;try{a=this.urlSerializer.parse(n)}catch(u){a=this.malformedUriErrorHandler(u,this.urlSerializer,n)}return a}isActive(n,a){let u;if(u=!0===a?Object.assign({},QP):!1===a?Object.assign({},ek):a,nd(n))return dE(this.currentUrlTree,n,u);const m=this.parseUrl(n);return dE(this.currentUrlTree,m,u)}removeEmptyProps(n){return Object.keys(n).reduce((a,u)=>{const m=n[u];return null!=m&&(a[u]=m),a},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new ym(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,a,u,m,v){var T,I;if(this.disposed)return Promise.resolve(!1);let O,N,Z;v?(O=v.resolve,N=v.reject,Z=v.promise):Z=new Promise((Ge,vt)=>{O=Ge,N=vt});const ye=++this.navigationId;let be;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(u=this.location.getState()),be=u&&u.\u0275routerPageId?u.\u0275routerPageId:m.replaceUrl||m.skipLocationChange?null!==(T=this.browserPageId)&&void 0!==T?T:0:(null!==(I=this.browserPageId)&&void 0!==I?I:0)+1):be=0,this.setTransition({id:ye,targetPageId:be,source:a,restoredState:u,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:m,resolve:O,reject:N,promise:Z,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Z.catch(Ge=>Promise.reject(Ge))}setBrowserUrl(n,a){const u=this.urlSerializer.serialize(n),m=Object.assign(Object.assign({},a.extras.state),this.generateNgRouterState(a.id,a.targetPageId));this.location.isCurrentPathEqualTo(u)||a.extras.replaceUrl?this.location.replaceState(u,"",m):this.location.go(u,"",m)}restoreHistory(n,a=!1){var u,m;if("computed"===this.canceledNavigationResolution){const v=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(u=this.currentNavigation)||void 0===u?void 0:u.finalUrl)||0===v?this.currentUrlTree===(null===(m=this.currentNavigation)||void 0===m?void 0:m.finalUrl)&&0===v&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(v)}else"replace"===this.canceledNavigationResolution&&(a&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,a){const u=new rE(n.id,this.serializeUrl(n.extractedUrl),a);this.triggerEvent(u),n.resolve(!1)}generateNgRouterState(n,a){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:a}:{navigationId:n}}}return t.\u0275fac=function(n){Cv()},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();function KE(t){return"imperative"!==t}let r0=(()=>{class t{constructor(n,a,u,m,v){this.router=n,this.route=a,this.tabIndexAttribute=u,this.renderer=m,this.el=v,this.commands=null,this.onChanges=new Et,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){if(null!=this.tabIndexAttribute)return;const a=this.renderer,u=this.el.nativeElement;null!==n?a.setAttribute(u,"tabindex",n):a.removeAttribute(u,"tabindex")}ngOnChanges(n){this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const n={skipLocationChange:Rf(this.skipLocationChange),replaceUrl:Rf(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,n),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Rf(this.preserveFragment)})}}return t.\u0275fac=function(n){return new(n||t)(Tn(ma),Tn(kf),Ke("tabindex"),Tn(c_),Tn(Nu))},t.\u0275dir=ti({type:t,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(n,a){1&n&&em("click",function(){return a.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[hs]}),t})(),ny=(()=>{class t{constructor(n,a,u){this.router=n,this.route=a,this.locationStrategy=u,this.commands=null,this.href=null,this.onChanges=new Et,this.subscription=n.events.subscribe(m=>{m instanceof ym&&this.updateTargetUrlAndHref()})}set routerLink(n){this.commands=null!=n?Array.isArray(n)?n:[n]:null}ngOnChanges(n){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(n,a,u,m,v){if(0!==n||a||u||m||v||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const T={skipLocationChange:Rf(this.skipLocationChange),replaceUrl:Rf(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,T),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Rf(this.preserveFragment)})}}return t.\u0275fac=function(n){return new(n||t)(Tn(ma),Tn(kf),Tn(Cf))},t.\u0275dir=ti({type:t,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(n,a){1&n&&em("click",function(m){return a.onClick(m.button,m.ctrlKey,m.shiftKey,m.altKey,m.metaKey)}),2&n&&ar("target",a.target)("href",a.href,Th)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[hs]}),t})();function Rf(t){return""===t||!!t}let YE=(()=>{class t{constructor(n,a,u,m,v,T){this.router=n,this.element=a,this.renderer=u,this.cdr=m,this.link=v,this.linkWithHref=T,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Cs,this.routerEventsSubscription=n.events.subscribe(I=>{I instanceof ym&&this.update()})}ngAfterContentInit(){Hn(this.links.changes,this.linksWithHrefs.changes,Hn(null)).pipe(mi()).subscribe(n=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var n;null===(n=this.linkInputChangesSubscription)||void 0===n||n.unsubscribe();const a=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(u=>!!u).map(u=>u.onChanges);this.linkInputChangesSubscription=hr(a).pipe(mi()).subscribe(u=>{this.isActive!==this.isLinkActive(this.router)(u)&&this.update()})}set routerLinkActive(n){const a=Array.isArray(n)?n:n.split(" ");this.classes=a.filter(u=>!!u)}ngOnChanges(n){this.update()}ngOnDestroy(){var n;this.routerEventsSubscription.unsubscribe(),null===(n=this.linkInputChangesSubscription)||void 0===n||n.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const n=this.hasActiveLinks();this.isActive!==n&&(this.isActive=n,this.cdr.markForCheck(),this.classes.forEach(a=>{n?this.renderer.addClass(this.element.nativeElement,a):this.renderer.removeClass(this.element.nativeElement,a)}),this.isActiveChange.emit(n))})}isLinkActive(n){const a=function nk(t){return!!t.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return u=>!!u.urlTree&&n.isActive(u.urlTree,a)}hasActiveLinks(){const n=this.isLinkActive(this.router);return this.link&&n(this.link)||this.linkWithHref&&n(this.linkWithHref)||this.links.some(n)||this.linksWithHrefs.some(n)}}return t.\u0275fac=function(n){return new(n||t)(Tn(ma),Tn(Nu),Tn(c_),Tn(dx),Tn(r0,8),Tn(ny,8))},t.\u0275dir=ti({type:t,selectors:[["","routerLinkActive",""]],contentQueries:function(n,a,u){if(1&n&&(Yv(u,r0,5),Yv(u,ny,5)),2&n){let m;f_(m=p_())&&(a.links=m),f_(m=p_())&&(a.linksWithHrefs=m)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[hs]}),t})();class JE{}class QE{preload(e,n){return Hn(null)}}let eT=(()=>{class t{constructor(n,a,u,m){this.router=n,this.injector=u,this.preloadingStrategy=m,this.loader=new WE(u,a,I=>n.triggerEvent(new iE(I)),I=>n.triggerEvent(new oE(I)))}setUpPreloading(){this.subscription=this.router.events.pipe(pa(n=>n instanceof ym),If(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(Lc);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,a){const u=[];for(const m of a)if(m.loadChildren&&!m.canLoad&&m._loadedConfig){const v=m._loadedConfig;u.push(this.processRoutes(v.module,v.routes))}else m.loadChildren&&!m.canLoad?u.push(this.preloadConfig(n,m)):m.children&&u.push(this.processRoutes(n,m.children));return hr(u).pipe(mi(),it(m=>{}))}preloadConfig(n,a){return this.preloadingStrategy.preload(a,()=>(a._loadedConfig?Hn(a._loadedConfig):this.loader.load(n.injector,a)).pipe(Nr(m=>(a._loadedConfig=m,this.processRoutes(m.module,m.routes)))))}}return t.\u0275fac=function(n){return new(n||t)(hn(ma),hn(Y1),hn(qi),hn(JE))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),o0=(()=>{class t{constructor(n,a,u={}){this.router=n,this.viewportScroller=a,this.options=u,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},u.scrollPositionRestoration=u.scrollPositionRestoration||"disabled",u.anchorScrolling=u.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof Ux?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof ym&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof sE&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,a){this.router.triggerEvent(new sE(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,a))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(n){Cv()},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const rd=new Yt("ROUTER_CONFIGURATION"),tT=new Yt("ROUTER_FORROOT_GUARD"),ik=[vx,{provide:gE,useClass:_E},{provide:ma,useFactory:function ck(t,e,n,a,u,m,v={},T,I){const O=new ma(null,t,e,n,a,u,cE(m));return T&&(O.urlHandlingStrategy=T),I&&(O.routeReuseStrategy=I),function uk(t,e){t.errorHandler&&(e.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(e.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(e.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(e.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(e.urlUpdateStrategy=t.urlUpdateStrategy),t.canceledNavigationResolution&&(e.canceledNavigationResolution=t.canceledNavigationResolution)}(v,O),v.enableTracing&&O.events.subscribe(N=>{var Z,ye;null===(Z=console.group)||void 0===Z||Z.call(console,`Router Event: ${N.constructor.name}`),console.log(N.toString()),console.log(N),null===(ye=console.groupEnd)||void 0===ye||ye.call(console)}),O},deps:[gE,Cm,vx,qi,Y1,n0,rd,[class XP{},new Us],[class qP{},new Us]]},Cm,{provide:kf,useFactory:function hk(t){return t.routerState.root},deps:[ma]},eT,QE,class rk{preload(e,n){return n().pipe(Qh(()=>Hn(null)))}},{provide:rd,useValue:{enableTracing:!1}}];function ok(){return new nw("Router",ma)}let nT=(()=>{class t{constructor(n,a){}static forRoot(n,a){return{ngModule:t,providers:[ik,rT(n),{provide:tT,useFactory:lk,deps:[[ma,new Us,new Ta]]},{provide:rd,useValue:a||{}},{provide:Cf,useFactory:ak,deps:[Jh,[new uu(yx),new Us],rd]},{provide:o0,useFactory:sk,deps:[ma,XM,rd]},{provide:JE,useExisting:a&&a.preloadingStrategy?a.preloadingStrategy:QE},{provide:nw,multi:!0,useFactory:ok},[s0,{provide:y_,multi:!0,useFactory:dk,deps:[s0]},{provide:iT,useFactory:fk,deps:[s0]},{provide:K1,multi:!0,useExisting:iT}]]}}static forChild(n){return{ngModule:t,providers:[rT(n)]}}}return t.\u0275fac=function(n){return new(n||t)(hn(tT,8),hn(ma,8))},t.\u0275mod=ci({type:t}),t.\u0275inj=Cr({}),t})();function sk(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new o0(t,e,n)}function ak(t,e,n={}){return n.useHash?new II(t,e):new bw(t,e)}function lk(t){return"guarded"}function rT(t){return[{provide:ri,multi:!0,useValue:t},{provide:n0,multi:!0,useValue:t}]}let s0=(()=>{class t{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Et}appInitializer(){return this.injector.get(CI,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let a=null;const u=new Promise(T=>a=T),m=this.injector.get(ma),v=this.injector.get(rd);return"disabled"===v.initialNavigation?(m.setUpLocationChangeListener(),a(!0)):"enabled"===v.initialNavigation||"enabledBlocking"===v.initialNavigation?(m.hooks.afterPreactivation=()=>this.initNavigation?Hn(null):(this.initNavigation=!0,a(!0),this.resultOfPreactivationDone),m.initialNavigation()):a(!0),u})}bootstrapListener(n){const a=this.injector.get(rd),u=this.injector.get(eT),m=this.injector.get(o0),v=this.injector.get(ma),T=this.injector.get(v_);n===T.components[0]&&(("enabledNonBlocking"===a.initialNavigation||void 0===a.initialNavigation)&&v.initialNavigation(),u.setUpPreloading(),m.init(),v.resetRootComponentType(T.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return t.\u0275fac=function(n){return new(n||t)(hn(qi))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();function dk(t){return t.appInitializer.bind(t)}function fk(t){return t.bootstrapListener.bind(t)}const iT=new Yt("Router Initializer"),$u={production:!0,appVersion:Xe(147).i8,environmentName:"Production",CompanyName:"Actilogic",AuthorName:"Antonio Joboy",mapbox:{accessToken:"pk.eyJ1IjoiYW50b25pb2pvYm95IiwiYSI6ImNsMXBhd3hsYTBhb24zY2tiaTNjMG1mMTcifQ.Y7o3Fo3xLvPXMAbTnrc7IA"}};let mk=(()=>{class t{constructor(){this.environment=$u}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Sr({type:t,selectors:[["app-home"]],decls:4,vars:1,template:function(n,a){1&n&&(is(0,"p"),ml(1,"home works!"),Es(),is(2,"p"),ml(3),Es()),2&n&&(Ec(3),r_(" Current environment: ",a.environment.environmentName,"\n"))},styles:[""]}),t})();function oT(t,e,n,a,u,m,v){try{var T=t[m](v),I=T.value}catch(O){return void n(O)}T.done?e(I):Promise.resolve(I).then(a,u)}function sT(t){return function(){var e=this,n=arguments;return new Promise(function(a,u){var m=t.apply(e,n);function v(I){oT(m,a,u,v,T,"next",I)}function T(I){oT(m,a,u,v,T,"throw",I)}v(void 0)})}}class gk{constructor(e){this.title="",this.ttl="",this.link="",this.description="",this.language="",this.copyright="",this.lastBuildDate="",this.image=null,this.item=null,this.rss=null,this.title=e.title,this.ttl=e.ttl,this.link=e.link,this.description=e.description,this.language=e.language,this.copyright=e.copyright,this.lastBuildDate=e.lastBuildDate,this.image=e.image,this.item=e.item,this.rss=e.rss}toString(){return this.copyright}}class $c{constructor(){}xmlToJson(e){let n={};if(1===e.nodeType){if(e.attributes.length>0){n["@attributes"]={};for(let a=0;a<e.attributes.length;a+=1){const u=e.attributes.item(a);n["@attributes"][u.nodeName]=u.nodeValue}}}else 3===e.nodeType&&(n=e.nodeValue);if(e.hasChildNodes()&&1===e.childNodes.length&&3===e.childNodes[0].nodeType)n=e.childNodes[0].nodeValue;else if(e.hasChildNodes())for(let a=0;a<e.childNodes.length;a+=1){const u=e.childNodes.item(a),m=u.nodeName;if(void 0===n[m])n[m]=this.xmlToJson(u);else{if(void 0===n[m].push){const v=n[m];n[m]=[],n[m].push(v)}n[m].push(this.xmlToJson(u))}}return n}}$c.\u0275fac=function(e){return new(e||$c)},$c.\u0275prov=gn({token:$c,factory:$c.\u0275fac,providedIn:"root"}),$c.ngInjectableDef=cs({factory:function(){return new $c},token:$c,providedIn:"root"});class aT{}class lT{}class Gc{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(n=>{const a=n.indexOf(":");if(a>0){const u=n.slice(0,a),m=u.toLowerCase(),v=n.slice(a+1).trim();this.maybeSetNormalizedName(u,m),this.headers.has(m)?this.headers.get(m).push(v):this.headers.set(m,[v])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(n=>{let a=e[n];const u=n.toLowerCase();"string"==typeof a&&(a=[a]),a.length>0&&(this.headers.set(u,a),this.maybeSetNormalizedName(n,u))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const n=this.headers.get(e.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,n){return this.clone({name:e,value:n,op:"a"})}set(e,n){return this.clone({name:e,value:n,op:"s"})}delete(e,n){return this.clone({name:e,value:n,op:"d"})}maybeSetNormalizedName(e,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,e)}init(){this.lazyInit&&(this.lazyInit instanceof Gc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(n=>{this.headers.set(n,e.headers.get(n)),this.normalizedNames.set(n,e.normalizedNames.get(n))})}clone(e){const n=new Gc;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Gc?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([e]),n}applyUpdate(e){const n=e.name.toLowerCase();switch(e.op){case"a":case"s":let a=e.value;if("string"==typeof a&&(a=[a]),0===a.length)return;this.maybeSetNormalizedName(e.name,n);const u=("a"===e.op?this.headers.get(n):void 0)||[];u.push(...a),this.headers.set(n,u);break;case"d":const m=e.value;if(m){let v=this.headers.get(n);if(!v)return;v=v.filter(T=>-1===m.indexOf(T)),0===v.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,v)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>e(this.normalizedNames.get(n),this.headers.get(n)))}}class _k{encodeKey(e){return cT(e)}encodeValue(e){return cT(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const vk=/%(\d[a-f0-9])/gi,xk={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function cT(t){return encodeURIComponent(t).replace(vk,(e,n)=>{var a;return null!==(a=xk[n])&&void 0!==a?a:e})}function uT(t){return`${t}`}class Gu{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new _k,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function yk(t,e){const n=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(u=>{const m=u.indexOf("="),[v,T]=-1==m?[e.decodeKey(u),""]:[e.decodeKey(u.slice(0,m)),e.decodeValue(u.slice(m+1))],I=n.get(v)||[];I.push(T),n.set(v,I)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(n=>{const a=e.fromObject[n];this.map.set(n,Array.isArray(a)?a:[a])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const n=this.map.get(e);return n?n[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,n){return this.clone({param:e,value:n,op:"a"})}appendAll(e){const n=[];return Object.keys(e).forEach(a=>{const u=e[a];Array.isArray(u)?u.forEach(m=>{n.push({param:a,value:m,op:"a"})}):n.push({param:a,value:u,op:"a"})}),this.clone(n)}set(e,n){return this.clone({param:e,value:n,op:"s"})}delete(e,n){return this.clone({param:e,value:n,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const n=this.encoder.encodeKey(e);return this.map.get(e).map(a=>n+"="+this.encoder.encodeValue(a)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const n=new Gu({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(e),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const n=("a"===e.op?this.map.get(e.param):void 0)||[];n.push(uT(e.value)),this.map.set(e.param,n);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let a=this.map.get(e.param)||[];const u=a.indexOf(uT(e.value));-1!==u&&a.splice(u,1),a.length>0?this.map.set(e.param,a):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class bk{constructor(){this.map=new Map}set(e,n){return this.map.set(e,n),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function hT(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function dT(t){return"undefined"!=typeof Blob&&t instanceof Blob}function fT(t){return"undefined"!=typeof FormData&&t instanceof FormData}class Mm{constructor(e,n,a,u){let m;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function wk(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||u?(this.body=void 0!==a?a:null,m=u):m=a,m&&(this.reportProgress=!!m.reportProgress,this.withCredentials=!!m.withCredentials,m.responseType&&(this.responseType=m.responseType),m.headers&&(this.headers=m.headers),m.context&&(this.context=m.context),m.params&&(this.params=m.params)),this.headers||(this.headers=new Gc),this.context||(this.context=new bk),this.params){const v=this.params.toString();if(0===v.length)this.urlWithParams=n;else{const T=n.indexOf("?");this.urlWithParams=n+(-1===T?"?":T<n.length-1?"&":"")+v}}else this.params=new Gu,this.urlWithParams=n}serializeBody(){return null===this.body?null:hT(this.body)||dT(this.body)||fT(this.body)||function Ek(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Gu?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||fT(this.body)?null:dT(this.body)?this.body.type||null:hT(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Gu?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var n;const a=e.method||this.method,u=e.url||this.url,m=e.responseType||this.responseType,v=void 0!==e.body?e.body:this.body,T=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,I=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let O=e.headers||this.headers,N=e.params||this.params;const Z=null!==(n=e.context)&&void 0!==n?n:this.context;return void 0!==e.setHeaders&&(O=Object.keys(e.setHeaders).reduce((ye,be)=>ye.set(be,e.setHeaders[be]),O)),e.setParams&&(N=Object.keys(e.setParams).reduce((ye,be)=>ye.set(be,e.setParams[be]),N)),new Mm(a,u,v,{params:N,headers:O,context:Z,reportProgress:I,responseType:m,withCredentials:T})}}var to=(()=>((to=to||{})[to.Sent=0]="Sent",to[to.UploadProgress=1]="UploadProgress",to[to.ResponseHeader=2]="ResponseHeader",to[to.DownloadProgress=3]="DownloadProgress",to[to.Response=4]="Response",to[to.User=5]="User",to))();class a0{constructor(e,n=200,a="OK"){this.headers=e.headers||new Gc,this.status=void 0!==e.status?e.status:n,this.statusText=e.statusText||a,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class l0 extends a0{constructor(e={}){super(e),this.type=to.ResponseHeader}clone(e={}){return new l0({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class ry extends a0{constructor(e={}){super(e),this.type=to.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new ry({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class pT extends a0{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function c0(t,e){return{body:e,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let mT=(()=>{class t{constructor(n){this.handler=n}request(n,a,u={}){let m;if(n instanceof Mm)m=n;else{let I,O;I=u.headers instanceof Gc?u.headers:new Gc(u.headers),u.params&&(O=u.params instanceof Gu?u.params:new Gu({fromObject:u.params})),m=new Mm(n,a,void 0!==u.body?u.body:null,{headers:I,context:u.context,params:O,reportProgress:u.reportProgress,responseType:u.responseType||"json",withCredentials:u.withCredentials})}const v=Hn(m).pipe(If(I=>this.handler.handle(I)));if(n instanceof Mm||"events"===u.observe)return v;const T=v.pipe(pa(I=>I instanceof ry));switch(u.observe||"body"){case"body":switch(m.responseType){case"arraybuffer":return T.pipe(it(I=>{if(null!==I.body&&!(I.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return I.body}));case"blob":return T.pipe(it(I=>{if(null!==I.body&&!(I.body instanceof Blob))throw new Error("Response is not a Blob.");return I.body}));case"text":return T.pipe(it(I=>{if(null!==I.body&&"string"!=typeof I.body)throw new Error("Response is not a string.");return I.body}));default:return T.pipe(it(I=>I.body))}case"response":return T;default:throw new Error(`Unreachable: unhandled observe type ${u.observe}}`)}}delete(n,a={}){return this.request("DELETE",n,a)}get(n,a={}){return this.request("GET",n,a)}head(n,a={}){return this.request("HEAD",n,a)}jsonp(n,a){return this.request("JSONP",n,{params:(new Gu).append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,a={}){return this.request("OPTIONS",n,a)}patch(n,a,u={}){return this.request("PATCH",n,c0(u,a))}post(n,a,u={}){return this.request("POST",n,c0(u,a))}put(n,a,u={}){return this.request("PUT",n,c0(u,a))}}return t.\u0275fac=function(n){return new(n||t)(hn(aT))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();class gT{constructor(e,n){this.next=e,this.interceptor=n}handle(e){return this.interceptor.intercept(e,this.next)}}const _T=new Yt("HTTP_INTERCEPTORS");let Tk=(()=>{class t{intercept(n,a){return a.handle(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const Ck=/^\)\]\}',?\n/;let yT=(()=>{class t{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Be(a=>{const u=this.xhrFactory.build();if(u.open(n.method,n.urlWithParams),n.withCredentials&&(u.withCredentials=!0),n.headers.forEach((be,Ge)=>u.setRequestHeader(be,Ge.join(","))),n.headers.has("Accept")||u.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const be=n.detectContentTypeHeader();null!==be&&u.setRequestHeader("Content-Type",be)}if(n.responseType){const be=n.responseType.toLowerCase();u.responseType="json"!==be?be:"text"}const m=n.serializeBody();let v=null;const T=()=>{if(null!==v)return v;const be=u.statusText||"OK",Ge=new Gc(u.getAllResponseHeaders()),vt=function Dk(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(u)||n.url;return v=new l0({headers:Ge,status:u.status,statusText:be,url:vt}),v},I=()=>{let{headers:be,status:Ge,statusText:vt,url:Rt}=T(),Ut=null;204!==Ge&&(Ut=void 0===u.response?u.responseText:u.response),0===Ge&&(Ge=Ut?200:0);let ct=Ge>=200&&Ge<300;if("json"===n.responseType&&"string"==typeof Ut){const dn=Ut;Ut=Ut.replace(Ck,"");try{Ut=""!==Ut?JSON.parse(Ut):null}catch(Jn){Ut=dn,ct&&(ct=!1,Ut={error:Jn,text:Ut})}}ct?(a.next(new ry({body:Ut,headers:be,status:Ge,statusText:vt,url:Rt||void 0})),a.complete()):a.error(new pT({error:Ut,headers:be,status:Ge,statusText:vt,url:Rt||void 0}))},O=be=>{const{url:Ge}=T(),vt=new pT({error:be,status:u.status||0,statusText:u.statusText||"Unknown Error",url:Ge||void 0});a.error(vt)};let N=!1;const Z=be=>{N||(a.next(T()),N=!0);let Ge={type:to.DownloadProgress,loaded:be.loaded};be.lengthComputable&&(Ge.total=be.total),"text"===n.responseType&&!!u.responseText&&(Ge.partialText=u.responseText),a.next(Ge)},ye=be=>{let Ge={type:to.UploadProgress,loaded:be.loaded};be.lengthComputable&&(Ge.total=be.total),a.next(Ge)};return u.addEventListener("load",I),u.addEventListener("error",O),u.addEventListener("timeout",O),u.addEventListener("abort",O),n.reportProgress&&(u.addEventListener("progress",Z),null!==m&&u.upload&&u.upload.addEventListener("progress",ye)),u.send(m),a.next({type:to.Sent}),()=>{u.removeEventListener("error",O),u.removeEventListener("abort",O),u.removeEventListener("load",I),u.removeEventListener("timeout",O),n.reportProgress&&(u.removeEventListener("progress",Z),null!==m&&u.upload&&u.upload.removeEventListener("progress",ye)),u.readyState!==u.DONE&&u.abort()}})}}return t.\u0275fac=function(n){return new(n||t)(hn(Bw))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();const u0=new Yt("XSRF_COOKIE_NAME"),h0=new Yt("XSRF_HEADER_NAME");class vT{}let Sk=(()=>{class t{constructor(n,a,u){this.doc=n,this.platform=a,this.cookieName=u,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=Pw(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return t.\u0275fac=function(n){return new(n||t)(hn(fa),hn(dm),hn(u0))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),d0=(()=>{class t{constructor(n,a){this.tokenService=n,this.headerName=a}intercept(n,a){const u=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||u.startsWith("http://")||u.startsWith("https://"))return a.handle(n);const m=this.tokenService.getToken();return null!==m&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,m)})),a.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(hn(vT),hn(h0))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),Ik=(()=>{class t{constructor(n,a){this.backend=n,this.injector=a,this.chain=null}handle(n){if(null===this.chain){const a=this.injector.get(_T,[]);this.chain=a.reduceRight((u,m)=>new gT(u,m),this.backend)}return this.chain.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(hn(lT),hn(qi))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),Mk=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:d0,useClass:Tk}]}}static withOptions(n={}){return{ngModule:t,providers:[n.cookieName?{provide:u0,useValue:n.cookieName}:[],n.headerName?{provide:h0,useValue:n.headerName}:[]]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ci({type:t}),t.\u0275inj=Cr({providers:[d0,{provide:_T,useExisting:d0,multi:!0},{provide:vT,useClass:Sk},{provide:u0,useValue:"XSRF-TOKEN"},{provide:h0,useValue:"X-XSRF-TOKEN"}]}),t})(),Ak=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ci({type:t}),t.\u0275inj=Cr({providers:[mT,{provide:aT,useClass:Ik},yT,{provide:lT,useExisting:yT}],imports:[[Mk.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})(),xT=(()=>{class t{constructor(n){this.http=n,this.fuelWatchURL="https://www.fuelwatch.wa.gov.au/fuelwatch/fuelWatchRSS?",this.CORS_PROXY="https://cors-anywhere.herokuapp.com/"}get(){var n=$u.production?this.fuelWatchURL:this.CORS_PROXY+this.fuelWatchURL;return console.log("fetching from",n),this.http.get(n)}static test(){return console.log("test function called"),"this is the returened data from test"}}return t.\u0275fac=function(n){return new(n||t)(hn(mT))},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Pk=(()=>{class t{constructor(){this.fuelEfficiency=0}ngOnInit(){document.getElementById("openbtn").addEventListener("click",function(){document.getElementById("mySidepanel").style.width="250px"}),document.getElementById("closebtn").addEventListener("click",function(){document.getElementById("mySidepanel").style.width="0"})}ngOnChanges(n){alert("new efficiency"+this.fuelEfficiency);for(let a in n)"feed"===a&&(this.fuelEfficiency=n[a].currentValue)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Sr({type:t,selectors:[["app-fuel-calc"]],features:[hs],decls:7,vars:0,consts:[[1,"panel"],["id","openbtn",1,"openbtn"],["id","mySidepanel",1,"sidepanel"],[3,"fuelEfficiency"]],template:function(n,a){1&n&&(is(0,"div",0)(1,"button",1),ml(2,"Fuel Calculations"),Es(),is(3,"div",2)(4,"p"),ml(5,"fuel-calc works!"),Es(),is(6,"input",3),em("fuelEfficiency",function(){return a.fuelEfficiency}),Es()()())},styles:[".panel[_ngcontent-%COMP%]{height:250px;width:0;position:fixed;z-index:2;top:0;left:0;background-color:#fff;overflow-x:hidden;padding-top:10px;transition:.5s}.sidepanel[_ngcontent-%COMP%]{height:250px;width:0;position:fixed;z-index:1;top:0;left:0;background-color:#fff;overflow-x:hidden;padding-top:60px;transition:.5s}.sidepanel[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{padding:8px 8px 8px 32px;text-decoration:none;font-size:25px;color:#818181;display:block;transition:.3s;position:fixed}.sidepanel[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{position:fixed;color:#f1f1f1}.sidepanel[_ngcontent-%COMP%]   .closebtn[_ngcontent-%COMP%]{position:fixed;top:0;right:25px;font-size:36px;margin-left:50px}.openbtn[_ngcontent-%COMP%]{font-size:20px;cursor:pointer;position:fixed;background-color:#111;color:#fff;border:none;z-index:2}.openbtn[_ngcontent-%COMP%]:hover{background-color:#444;position:fixed}"]}),t})(),kk=(()=>{class t{constructor(n){this.viewContainerRef=n}}return t.\u0275fac=function(n){return new(n||t)(Tn(Ra))},t.\u0275dir=ti({type:t,selectors:[["","dynamicChildLoader",""]]}),t})(),Rk=(()=>{class t{constructor(){}getPosition(){return new Promise((n,a)=>{navigator.geolocation.getCurrentPosition(u=>{n({lng:u.coords.longitude,lat:u.coords.latitude})},u=>{a(u)})})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=gn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Hu=Xe(898),Ok=Xe(518),Lk=Xe(545),Fk=Xe.n(Lk);let zk=(()=>{class t{constructor(){this.style="mapbox://styles/antoniojoboy/cl2569rep000415mf7upq7j1m",this.lat=-31.9523,this.lng=115.8613,this.perth={lng:this.lng,lat:this.lat,coordinates:[this.lng,this.lat]},this.currentLocation=this.perth.coordinates,this.zoom=13,this.Icon_pump="../../assets/Mapbox-marker/Fuel-Saver/pump-256x256.png",this.geojson={},this.locationService=new Rk,this.feed={},Hu.accessToken=$u.mapbox.accessToken,this.directions=new Ok({accessToken:Hu.accessToken,interactive:!1,unit:"metric"})}ngOnInit(){this.map=new Hu.Map({container:"map",style:this.style,zoom:this.zoom,center:this.currentLocation}),this.addMapControls(),this.map.on("load",()=>{this.gotoCurrentLocation(),this.map.loadImage(this.Icon_pump,(n,a)=>{if(n)throw n;this.map.addImage("pump",a),this.addFuelStations()})}),this.map.on("click","stations",n=>{var a=n.features[0].geometry.coordinates.slice(),u=JSON.parse(n.features[0].properties.popup).html;console.log("station.features[0]",n.features[0]);var m=this.map.queryRenderedFeatures(n.point,{layers:["stations"]}),v=m;for(m.length&&(v=m[0]);Math.abs(n.lngLat.lng-a[0])>180;)a[0]+=n.lngLat.lng>a[0]?360:-360;console.log("feature()",v),(new Hu.Popup).setLngLat(a).setHTML(u).addTo(this.map);var T=this;document.getElementById("calcCost").addEventListener("click",function(){T.directions.setOrigin(T.currentLocation),T.directions.setDestination([JSON.parse(v.properties.coordinates)[0],JSON.parse(v.properties.coordinates)[1]]),console.log("feature",v),console.log("self",T),console.log("feature.properties.coordinates withouth conversion",JSON.parse(v.properties.coordinates)[0]),console.log("feature.properties.coordinates withouth conversion",JSON.parse(v.properties.coordinates)[0],JSON.parse(v.properties.coordinates)[1]),console.log("feature.properties.coordinates",JSON.parse(v.properties.coordinates)[0],JSON.parse(v.properties.coordinates)[1])})}),this.map.on("mouseenter","stations",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave","stations",()=>{this.map.getCanvas().style.cursor=""})}addMapControls(){this.map.addControl(new(Fk())({accessToken:Hu.accessToken,mapboxgl:Hu,marker:!0,placeholder:"  Search for places",proximity:{longitude:this.perth.lng,latitude:this.perth.lat}})),this.map.addControl(this.directions,"top-right"),this.map.addControl(new Hu.NavigationControl,"bottom-right"),this.map.addControl(new Hu.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"bottom-right")}goTo(n){console.log("location",n),console.log("about to fly to 1",n),this.map.flyTo({center:n,zoom:this.zoom+3,essential:!0}),console.log("flew")}ngOnChanges(n){for(let a in n)"feed"===a&&(this.FuelWatchFeedtoGeoJSON(n[a].currentValue),this.addFuelStations())}addFuelStations(){console.log("adding from this",this.geojson);var n=this.map.getSource("fuelStations");n?n.setData(this.geojson):this.map.addSource("fuelStations",{type:"geojson",data:this.geojson}),this.map.addLayer({id:"stations",type:"symbol",source:"fuelStations",layout:{"icon-image":"pump","icon-size":.1}})}FuelWatchFeedtoGeoJSON(n){var a={type:"FeatureCollection",features:[]};n.item.forEach(u=>{a.features.push({type:"Feature",geometry:{type:"Point",coordinates:[u.longitude,u.latitude]},properties:{title:u.title,description:u.description,popup:{html:this.toPopup(u)},coordinates:[u.longitude,u.latitude]}})}),this.geojson=a,console.log("this.geojson",this.geojson)}toPopup(n){return`\n    <div class="simplebar-content" style="padding: 0px;">\n    <div class="fuel-station__name-wrapper">\n        <div class="container-fluid">\n\n            <div class="row position-relative">\n                <div class="col-8 col-lg-9">\n                    <div>\n                        <h2>${n["trading-name"]}</h2>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <div class="fuel-station__address-wrapper">\n\n        <hr class="divider">\n\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-12">\n                    <span>Address: ${n.address}</span>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="col-12">\n                    <div class="fuel-station__contact-number">\n                        Call: <a href="tel:${n.phone}">${n.phone}</a>\n                    </div>\n                </div>\n            </div>\n\n            <hr class="divider">\n\n        </div>\n\n    </div>\n\n    <div class="fuel-station__pricing-wrapper ng-star-inserted">\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-12">\n                    <h4 class="fuel-price__title">ULP prices</h4>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="col-6 ng-star-inserted">\n                    <div>\n                        <p class="h2">\n                            ${n.price}\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="fuel-station__direction-wrapper ng-star-inserted">\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-12">\n                    <button id="calcCost" \n                        <span class="mat-button-wrapper">\n                            Calculate cost to get there\n                        </span>\n                        <span matripple="" class="mat-ripple mat-button-ripple"></span>\n                        <span class="mat-button-focus-overlay"> </span>\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n`}test(){alert("testing function")}gotoCurrentLocation(){this.locationService.getPosition().then(n=>{console.log(`Positon: ${n.lng} ${n.lat}`),this.currentLocation=[n.lng,n.lat],this.goTo(this.currentLocation)})}getLocation(){this.locationService.getPosition().then(n=>{console.log(`Positon: ${n.lng} ${n.lat}`)})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Sr({type:t,selectors:[["app-fuel-map"]],viewQuery:function(n,a){if(1&n&&function I1(t,e,n){const a=rr();a.firstCreatePass&&(A1(a,new D1(t,e,n),-1),2==(2&e)&&(a.staticViewQueries=!0)),M1(a,ft(),e)}(kk,7),2&n){let u;f_(u=p_())&&(a.dynamicChild=u.first)}},inputs:{feed:"feed"},features:[hs],decls:4,vars:0,consts:[["id","map-container"],["id","map"]],template:function(n,a){1&n&&(is(0,"p"),ml(1,"fuel-map works!"),Es(),is(2,"div",0),zu(3,"div",1),Es())},styles:["#map-container[_ngcontent-%COMP%]{top:10;bottom:0}#map[_ngcontent-%COMP%]{position:fixed;top:0;bottom:0;width:100%;z-index:1}.marker[_ngcontent-%COMP%]{background-size:cover;width:50px;height:50px;border-radius:50%}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:200px}.mapboxgl-popup-content[_ngcontent-%COMP%]{text-align:center;font-family:Open Sans,sans-serif}"]}),t})();const Nk=[{path:"home",component:mk},{path:"FuelSaver",component:(()=>{class t{constructor(n,a){this.FuelWatch=n,this.FuelWatchService=a,this.environment=$u,this.FuelWatchFeedList=null,this.ngxXml2jsonService=new $c,this.Feed=new gk({})}ngOnInit(){var n=this;return sT(function*(){yield n.loadData()})()}loadData(){var n=this;return sT(function*(){n.FuelWatchService.get().subscribe(a=>{var m=n.parseXML(a.rss.channel);n.Feed=m.rss.channel},a=>{if($u.production)console.error("Error in loading the fuel watch rss Feed",a);else{var m=n.parseXML(a.error.text);n.Feed=m.rss.channel}})})()}parseXML(n){var u=(new DOMParser).parseFromString(n,"text/xml");return this.ngxXml2jsonService.xmlToJson(u)}}return t.\u0275fac=function(n){return new(n||t)(Tn(xT),Tn(xT))},t.\u0275cmp=Sr({type:t,selectors:[["app-fuel-saver"]],decls:2,vars:1,consts:[[3,"feed"]],template:function(n,a){1&n&&zu(0,"app-fuel-calc")(1,"app-fuel-map",0),2&n&&(Ec(1),Qp("feed",a.Feed))},directives:[Pk,zk],styles:[""]}),t})()},{path:"",redirectTo:"/",pathMatch:"full"},{path:"**",redirectTo:"/",pathMatch:"full"}];let Bk=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ci({type:t}),t.\u0275inj=Cr({imports:[[nT.forRoot(Nk)],nT]}),t})();const jk=function(){return["/home"]},Uk=function(){return["/FuelSaver"]};let Vk=(()=>{class t{constructor(){}ngOnInit(){var n=document.getElementById("myTopnav");"topnav"===n.className?n.className+=" responsive":n.className="topnav",document.getElementById("myTopnav").getElementsByClassName("btn")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Sr({type:t,selectors:[["app-navigation-bar"]],decls:10,vars:4,consts:[[1,"navbar","navbar-fixed-top","navbar-dark","bg-inverse"],["rel","stylesheet","href","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"],[1,"title"],["id","myTopnav",1,"topnav"],["routerLinkActive","active",3,"routerLink"]],template:function(n,a){1&n&&(is(0,"nav",0),zu(1,"link",1),is(2,"div",2),ml(3," Actilogic "),Es(),is(4,"div",3)(5,"a",4),ml(6,"Home"),Es(),is(7,"a",4),ml(8,"Fuel Saver"),Es()()(),zu(9,"router-outlet")),2&n&&(Ec(5),Qp("routerLink",Vv(2,jk)),Ec(2),Qp("routerLink",Vv(3,Uk)))},directives:[ny,YE,X_],styles:[".topnav[_ngcontent-%COMP%]{background-color:#333;overflow:hidden}.topnav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{float:left;display:block;color:#f2f2f2;text-align:center;padding:14px 16px;text-decoration:none;font-size:17px}.topnav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#ddd;color:#000}.topnav[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:#04aa6d;color:#fff}.topnav[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:none}.title[_ngcontent-%COMP%]{display:block;padding:5px 10px;color:#1fc551;font-size:3em;letter-spacing:1px;text-align:center;text-decoration:none;text-transform:uppercase}.title[_ngcontent-%COMP%]:hover{background:rgba(0,0,0,0)}"]}),t})(),$k=(()=>{class t{constructor(){this.a=123,this.environment=$u,this.year=(new Date).getFullYear()}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Sr({type:t,selectors:[["app-footer"]],decls:3,vars:4,consts:[[1,"footer-basic"],[1,"copyright"]],template:function(n,a){1&n&&(is(0,"footer",0)(1,"p",1),ml(2),Es()()),2&n&&(Ec(2),kv("",a.environment.CompanyName," \xa9 ",a.year," ",a.environment.AuthorName," version: ",a.environment.appVersion,""))},styles:[".footer-basic[_ngcontent-%COMP%]{padding:40px 0;background-color:#fff;color:#4b4c4d;width:100%;height:60px;margin-top:auto;right:0;bottom:0;left:0;flex-shrink:0}.footer-basic[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:0;list-style:none;text-align:center;font-size:18px;line-height:1.6;margin-bottom:0}.footer-basic[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:0 10px}.footer-basic[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:inherit;text-decoration:none;opacity:.8}.footer-basic[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{opacity:1}.footer-basic[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]{text-align:center;padding-bottom:25px}.footer-basic[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:24px;width:40px;height:40px;line-height:40px;display:inline-block;text-align:center;border-radius:50%;border:1px solid #ccc;margin:0 8px;color:inherit;opacity:.75}.footer-basic[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{opacity:.9}.footer-basic[_ngcontent-%COMP%]   .copyright[_ngcontent-%COMP%]{margin-top:15px;text-align:center;font-size:13px;color:#aaa;margin-bottom:0}"]}),t})(),Gk=(()=>{class t{constructor(){this.title="Actilogic"}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Sr({type:t,selectors:[["app-root"]],decls:3,vars:0,template:function(n,a){1&n&&zu(0,"app-navigation-bar")(1,"app-footer")(2,"router-outlet")},directives:[Vk,$k,X_],styles:['[_nghost-%COMP%]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;font-size:14px;color:#333;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{margin:8px 0;color:#f0f8ff}p[_ngcontent-%COMP%]{margin:0;color:#f0f8ff}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{background-color:#171716}a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:visited, a[_ngcontent-%COMP%]:hover{color:#1976d2;text-decoration:none}a[_ngcontent-%COMP%]:hover{color:#125699}footer[_ngcontent-%COMP%]{margin-top:8px;display:flex;align-items:center;line-height:20px}footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center}svg#clouds[_ngcontent-%COMP%]{position:fixed;background-color:#171716;bottom:-160px;left:-230px;z-index:-10;width:1920px}@media screen and (max-width: 767px){.card-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.circle-link), .terminal[_ngcontent-%COMP%]{width:100%}.card[_ngcontent-%COMP%]:not(.highlight-card){height:16px;margin:8px 0}.card.highlight-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:72px}svg#rocket-smoke[_ngcontent-%COMP%]{right:120px;transform:rotate(-5deg)}}@media screen and (max-width: 575px){svg#rocket-smoke[_ngcontent-%COMP%]{display:none;visibility:hidden}}']}),t})();function f0(t,e,n,a){return lt(n)&&(a=n,n=void 0),a?f0(t,e,n).pipe(it(u=>Y(u)?a(...u):a(u))):new Be(u=>{bT(t,e,function m(v){u.next(arguments.length>1?Array.prototype.slice.call(arguments):v)},u,n)})}function bT(t,e,n,a,u){let m;if(function Zk(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){const v=t;t.addEventListener(e,n,u),m=()=>v.removeEventListener(e,n,u)}else if(function qk(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){const v=t;t.on(e,n),m=()=>v.off(e,n)}else if(function Hk(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){const v=t;t.addListener(e,n),m=()=>v.removeListener(e,n)}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(let v=0,T=t.length;v<T;v++)bT(t[v],e,n,a,u)}a.add(m)}const qu=new Be(jc);class Xk extends W{constructor(e,n){super()}schedule(e,n=0){return this}}let wT=(()=>{class t{constructor(n,a=t.now){this.SchedulerAction=n,this.now=a}schedule(n,a=0,u){return new this.SchedulerAction(this,n).schedule(u,a)}}return t.now=()=>Date.now(),t})();class Zu extends wT{constructor(e,n=wT.now){super(e,()=>Zu.delegate&&Zu.delegate!==this?Zu.delegate.now():n()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,n=0,a){return Zu.delegate&&Zu.delegate!==this?Zu.delegate.schedule(e,n,a):super.schedule(e,n,a)}flush(e){const{actions:n}=this;if(this.active)return void n.push(e);let a;this.active=!0;do{if(a=e.execute(e.state,e.delay))break}while(e=n.shift());if(this.active=!1,a){for(;e=n.shift();)e.unsubscribe();throw a}}}const Yk=new Zu(class Kk extends Xk{constructor(e,n){super(e,n),this.scheduler=e,this.work=n,this.pending=!1}schedule(e,n=0){if(this.closed)return this;this.state=e;const a=this.id,u=this.scheduler;return null!=a&&(this.id=this.recycleAsyncId(u,a,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(u,this.id,n),this}requestAsyncId(e,n,a=0){return setInterval(e.flush.bind(e,this),a)}recycleAsyncId(e,n,a=0){if(null!==a&&this.delay===a&&!1===this.pending)return n;clearInterval(n)}execute(e,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const a=this._execute(e,n);if(a)return a;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,n){let u,a=!1;try{this.work(e)}catch(m){a=!0,u=!!m&&m||new Error(m)}if(a)return this.unsubscribe(),u}_unsubscribe(){const e=this.id,n=this.scheduler,a=n.actions,u=a.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==u&&a.splice(u,1),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null}});class vl{constructor(e,n,a){this.kind=e,this.value=n,this.error=a,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,n,a){switch(this.kind){case"N":return e&&e(this.value);case"E":return n&&n(this.error);case"C":return a&&a()}}accept(e,n,a){return e&&"function"==typeof e.next?this.observe(e):this.do(e,n,a)}toObservable(){switch(this.kind){case"N":return Hn(this.value);case"E":return Df(this.error);case"C":return B_()}throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new vl("N",e):vl.undefinedValueNotification}static createError(e){return new vl("E",void 0,e)}static createComplete(){return vl.completeNotification}}vl.completeNotification=new vl("C"),vl.undefinedValueNotification=new vl("N",void 0);class eR{constructor(e,n){this.delay=e,this.scheduler=n}call(e,n){return n.subscribe(new p0(e,this.delay,this.scheduler))}}class p0 extends Te{constructor(e,n,a){super(e),this.delay=n,this.scheduler=a,this.queue=[],this.active=!1,this.errored=!1}static dispatch(e){const n=e.source,a=n.queue,u=e.scheduler,m=e.destination;for(;a.length>0&&a[0].time-u.now()<=0;)a.shift().notification.observe(m);if(a.length>0){const v=Math.max(0,a[0].time-u.now());this.schedule(e,v)}else this.unsubscribe(),n.active=!1}_schedule(e){this.active=!0,this.destination.add(e.schedule(p0.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}scheduleNotification(e){if(!0===this.errored)return;const n=this.scheduler,a=new tR(n.now()+this.delay,e);this.queue.push(a),!1===this.active&&this._schedule(n)}_next(e){this.scheduleNotification(vl.createNext(e))}_error(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()}_complete(){this.scheduleNotification(vl.createComplete()),this.unsubscribe()}}class tR{constructor(e,n){this.time=e,this.notification=n}}const Am="Service workers are disabled or not supported by this browser";class iy{constructor(e){if(this.serviceWorker=e,e){const a=f0(e,"controllerchange").pipe(it(()=>e.controller)),m=N_(j_(()=>Hn(e.controller)),a);this.worker=m.pipe(pa(N=>!!N)),this.registration=this.worker.pipe(Fa(()=>e.getRegistration()));const O=f0(e,"message").pipe(it(N=>N.data)).pipe(pa(N=>N&&N.type)).pipe(function Wk(t){return t?ki(()=>new Et,t):ki(new Et)}());O.connect(),this.events=O}else this.worker=this.events=this.registration=function nR(t){return j_(()=>Df(new Error(t)))}(Am)}postMessage(e,n){return this.worker.pipe(Bc(1),Hs(a=>{a.postMessage(Object.assign({action:e},n))})).toPromise().then(()=>{})}postMessageWithOperation(e,n,a){const u=this.waitForOperationCompleted(a),m=this.postMessage(e,n);return Promise.all([m,u]).then(([,v])=>v)}generateNonce(){return Math.round(1e7*Math.random())}eventsOfType(e){let n;return n="string"==typeof e?a=>a.type===e:a=>e.includes(a.type),this.events.pipe(pa(n))}nextEventOfType(e){return this.eventsOfType(e).pipe(Bc(1))}waitForOperationCompleted(e){return this.eventsOfType("OPERATION_COMPLETED").pipe(pa(n=>n.nonce===e),Bc(1),it(n=>{if(void 0!==n.result)return n.result;throw new Error(n.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}}let rR=(()=>{class t{constructor(n){if(this.sw=n,this.subscriptionChanges=new Et,!n.isEnabled)return this.messages=qu,this.notificationClicks=qu,void(this.subscription=qu);this.messages=this.sw.eventsOfType("PUSH").pipe(it(u=>u.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(it(u=>u.data)),this.pushManager=this.sw.registration.pipe(it(u=>u.pushManager));const a=this.pushManager.pipe(Fa(u=>u.getSubscription()));this.subscription=ro(a,this.subscriptionChanges)}get isEnabled(){return this.sw.isEnabled}requestSubscription(n){if(!this.sw.isEnabled)return Promise.reject(new Error(Am));const a={userVisibleOnly:!0};let u=this.decodeBase64(n.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),m=new Uint8Array(new ArrayBuffer(u.length));for(let v=0;v<u.length;v++)m[v]=u.charCodeAt(v);return a.applicationServerKey=m,this.pushManager.pipe(Fa(v=>v.subscribe(a)),Bc(1)).toPromise().then(v=>(this.subscriptionChanges.next(v),v))}unsubscribe(){return this.sw.isEnabled?this.subscription.pipe(Bc(1),Fa(a=>{if(null===a)throw new Error("Not subscribed to push notifications.");return a.unsubscribe().then(u=>{if(!u)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})})).toPromise():Promise.reject(new Error(Am))}decodeBase64(n){return atob(n)}}return t.\u0275fac=function(n){return new(n||t)(hn(iy))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})(),iR=(()=>{class t{constructor(n){if(this.sw=n,!n.isEnabled)return this.versionUpdates=qu,this.available=qu,this.activated=qu,void(this.unrecoverable=qu);this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY"]),this.available=this.versionUpdates.pipe(pa(a=>"VERSION_READY"===a.type),it(a=>({type:"UPDATE_AVAILABLE",current:a.currentVersion,available:a.latestVersion}))),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED"),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}get isEnabled(){return this.sw.isEnabled}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(Am));const n=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:n},n)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(Am));const n=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:n},n)}}return t.\u0275fac=function(n){return new(n||t)(hn(iy))},t.\u0275prov=gn({token:t,factory:t.\u0275fac}),t})();class m0{}const ET=new Yt("NGSW_REGISTER_SCRIPT");function oR(t,e,n,a){return()=>{if(!zw(a)||!("serviceWorker"in navigator)||!1===n.enabled)return;let m;if(navigator.serviceWorker.addEventListener("controllerchange",()=>{null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})}),"function"==typeof n.registrationStrategy)m=n.registrationStrategy();else{const[T,...I]=(n.registrationStrategy||"registerWhenStable:30000").split(":");switch(T){case"registerImmediately":m=Hn(null);break;case"registerWithDelay":m=TT(+I[0]||0);break;case"registerWhenStable":m=I[0]?ro(CT(t),TT(+I[0])):CT(t);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${n.registrationStrategy}`)}}t.get(Io).runOutsideAngular(()=>m.pipe(Bc(1)).subscribe(()=>navigator.serviceWorker.register(e,{scope:n.scope}).catch(T=>console.error("Service worker registration failed with:",T))))}}function TT(t){return Hn(null).pipe(function Qk(t,e=Yk){const a=function Jk(t){return t instanceof Date&&!isNaN(+t)}(t)?+t-e.now():Math.abs(t);return u=>u.lift(new eR(a,e))}(t))}function CT(t){return t.get(v_).isStable.pipe(pa(n=>n))}function sR(t,e){return new iy(zw(e)&&!1!==t.enabled?navigator.serviceWorker:void 0)}let aR=(()=>{class t{static register(n,a={}){return{ngModule:t,providers:[{provide:ET,useValue:n},{provide:m0,useValue:a},{provide:iy,useFactory:sR,deps:[m0,dm]},{provide:y_,useFactory:oR,deps:[qi,ET,m0,dm],multi:!0}]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ci({type:t}),t.\u0275inj=Cr({providers:[rR,iR]}),t})(),lR=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=ci({type:t,bootstrap:[Gk]}),t.\u0275inj=Cr({providers:[],imports:[[wA,Bk,Ak,aR.register("ngsw-worker.js",{enabled:$u.production,registrationStrategy:"registerWhenStable:30000"})]]}),t})();$u.production&&function iI(){aw=!1}(),xA().bootstrapModule(lR).catch(t=>console.error(t))},49:function(Nt,Bt,Xe){var lt;Nt=Xe.nmd(Nt),function(xe){"object"==typeof global&&global;var Y=function(Te){this.message=Te};(Y.prototype=new Error).name="InvalidCharacterError";var re=function(Te){throw new Y(Te)},$="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",K=/[\t\n\f\r ]/g,ce={encode:function(Te){Te=String(Te),/[^\0-\xFF]/.test(Te)&&re("The string to be encoded contains characters outside of the Latin1 range.");for(var Ae,J,ne,Be,Ne=Te.length%3,Q="",we=-1,He=Te.length-Ne;++we<He;)Ae=Te.charCodeAt(we)<<16,J=Te.charCodeAt(++we)<<8,ne=Te.charCodeAt(++we),Q+=$.charAt((Be=Ae+J+ne)>>18&63)+$.charAt(Be>>12&63)+$.charAt(Be>>6&63)+$.charAt(63&Be);return 2==Ne?(Ae=Te.charCodeAt(we)<<8,J=Te.charCodeAt(++we),Q+=$.charAt((Be=Ae+J)>>10)+$.charAt(Be>>4&63)+$.charAt(Be<<2&63)+"="):1==Ne&&(Be=Te.charCodeAt(we),Q+=$.charAt(Be>>2)+$.charAt(Be<<4&63)+"=="),Q},decode:function(Te){var Ne=(Te=String(Te).replace(K,"")).length;Ne%4==0&&(Ne=(Te=Te.replace(/==?$/,"")).length),(Ne%4==1||/[^+a-zA-Z0-9/]/.test(Te))&&re("Invalid character: the string to be decoded is not correctly encoded.");for(var we,Ae,Q=0,J="",ne=-1;++ne<Ne;)Ae=$.indexOf(Te.charAt(ne)),we=Q%4?64*we+Ae:Ae,Q++%4&&(J+=String.fromCharCode(255&we>>(-2*Q&6)));return J},version:"0.1.0"};void 0!==(lt=function(){return ce}.call(Bt,Xe,Bt,Nt))&&(Nt.exports=lt)}()},69:Nt=>{"use strict";var lt,Bt="object"==typeof Reflect?Reflect:null,Xe=Bt&&"function"==typeof Bt.apply?Bt.apply:function(ne,Me,Be){return Function.prototype.apply.call(ne,Me,Be)};lt=Bt&&"function"==typeof Bt.ownKeys?Bt.ownKeys:Object.getOwnPropertySymbols?function(ne){return Object.getOwnPropertyNames(ne).concat(Object.getOwnPropertySymbols(ne))}:function(ne){return Object.getOwnPropertyNames(ne)};var de=Number.isNaN||function(ne){return ne!=ne};function h(){h.init.call(this)}Nt.exports=h,Nt.exports.once=function Q(J,ne){return new Promise(function(Me,Be){function He(mt){J.removeListener(ne,rt),Be(mt)}function rt(){"function"==typeof J.removeListener&&J.removeListener("error",He),Me([].slice.call(arguments))}Ae(J,ne,rt,{once:!0}),"error"!==ne&&function we(J,ne,Me){"function"==typeof J.on&&Ae(J,"error",ne,Me)}(J,He,{once:!0})})},h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var U=10;function Y(J){if("function"!=typeof J)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof J)}function re(J){return void 0===J._maxListeners?h.defaultMaxListeners:J._maxListeners}function $(J,ne,Me,Be){var He,rt,mt;if(Y(Me),void 0===(rt=J._events)?(rt=J._events=Object.create(null),J._eventsCount=0):(void 0!==rt.newListener&&(J.emit("newListener",ne,Me.listener?Me.listener:Me),rt=J._events),mt=rt[ne]),void 0===mt)mt=rt[ne]=Me,++J._eventsCount;else if("function"==typeof mt?mt=rt[ne]=Be?[Me,mt]:[mt,Me]:Be?mt.unshift(Me):mt.push(Me),(He=re(J))>0&&mt.length>He&&!mt.warned){mt.warned=!0;var Pt=new Error("Possible EventEmitter memory leak detected. "+mt.length+" "+String(ne)+" listeners added. Use emitter.setMaxListeners() to increase limit");Pt.name="MaxListenersExceededWarning",Pt.emitter=J,Pt.type=ne,Pt.count=mt.length,function xe(J){console&&console.warn&&console.warn(J)}(Pt)}return J}function K(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function W(J,ne,Me){var Be={fired:!1,wrapFn:void 0,target:J,type:ne,listener:Me},He=K.bind(Be);return He.listener=Me,Be.wrapFn=He,He}function me(J,ne,Me){var Be=J._events;if(void 0===Be)return[];var He=Be[ne];return void 0===He?[]:"function"==typeof He?Me?[He.listener||He]:[He]:Me?function Ne(J){for(var ne=new Array(J.length),Me=0;Me<ne.length;++Me)ne[Me]=J[Me].listener||J[Me];return ne}(He):ue(He,He.length)}function ce(J){var ne=this._events;if(void 0!==ne){var Me=ne[J];if("function"==typeof Me)return 1;if(void 0!==Me)return Me.length}return 0}function ue(J,ne){for(var Me=new Array(ne),Be=0;Be<ne;++Be)Me[Be]=J[Be];return Me}function Ae(J,ne,Me,Be){if("function"==typeof J.on)Be.once?J.once(ne,Me):J.on(ne,Me);else{if("function"!=typeof J.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof J);J.addEventListener(ne,function He(rt){Be.once&&J.removeEventListener(ne,He),Me(rt)})}}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(J){if("number"!=typeof J||J<0||de(J))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+J+".");U=J}}),h.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(ne){if("number"!=typeof ne||ne<0||de(ne))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ne+".");return this._maxListeners=ne,this},h.prototype.getMaxListeners=function(){return re(this)},h.prototype.emit=function(ne){for(var Me=[],Be=1;Be<arguments.length;Be++)Me.push(arguments[Be]);var He="error"===ne,rt=this._events;if(void 0!==rt)He=He&&void 0===rt.error;else if(!He)return!1;if(He){var mt;if(Me.length>0&&(mt=Me[0]),mt instanceof Error)throw mt;var Pt=new Error("Unhandled error."+(mt?" ("+mt.message+")":""));throw Pt.context=mt,Pt}var gt=rt[ne];if(void 0===gt)return!1;if("function"==typeof gt)Xe(gt,this,Me);else{var Et=gt.length,Ot=ue(gt,Et);for(Be=0;Be<Et;++Be)Xe(Ot[Be],this,Me)}return!0},h.prototype.on=h.prototype.addListener=function(ne,Me){return $(this,ne,Me,!1)},h.prototype.prependListener=function(ne,Me){return $(this,ne,Me,!0)},h.prototype.once=function(ne,Me){return Y(Me),this.on(ne,W(this,ne,Me)),this},h.prototype.prependOnceListener=function(ne,Me){return Y(Me),this.prependListener(ne,W(this,ne,Me)),this},h.prototype.off=h.prototype.removeListener=function(ne,Me){var Be,He,rt,mt,Pt;if(Y(Me),void 0===(He=this._events))return this;if(void 0===(Be=He[ne]))return this;if(Be===Me||Be.listener===Me)0==--this._eventsCount?this._events=Object.create(null):(delete He[ne],He.removeListener&&this.emit("removeListener",ne,Be.listener||Me));else if("function"!=typeof Be){for(rt=-1,mt=Be.length-1;mt>=0;mt--)if(Be[mt]===Me||Be[mt].listener===Me){Pt=Be[mt].listener,rt=mt;break}if(rt<0)return this;0===rt?Be.shift():function Te(J,ne){for(;ne+1<J.length;ne++)J[ne]=J[ne+1];J.pop()}(Be,rt),1===Be.length&&(He[ne]=Be[0]),void 0!==He.removeListener&&this.emit("removeListener",ne,Pt||Me)}return this},h.prototype.removeAllListeners=function(ne){var Me,Be,He;if(void 0===(Be=this._events))return this;if(void 0===Be.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Be[ne]&&(0==--this._eventsCount?this._events=Object.create(null):delete Be[ne]),this;if(0===arguments.length){var mt,rt=Object.keys(Be);for(He=0;He<rt.length;++He)"removeListener"!==(mt=rt[He])&&this.removeAllListeners(mt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(Me=Be[ne]))this.removeListener(ne,Me);else if(void 0!==Me)for(He=Me.length-1;He>=0;He--)this.removeListener(ne,Me[He]);return this},h.prototype.listeners=function(ne){return me(this,ne,!0)},h.prototype.rawListeners=function(ne){return me(this,ne,!1)},h.listenerCount=function(J,ne){return"function"==typeof J.listenerCount?J.listenerCount(ne):ce.call(J,ne)},h.prototype.listenerCount=ce,h.prototype.eventNames=function(){return this._eventsCount>0?lt(this._events):[]}},780:Nt=>{var Xe;Nt.exports=Xe={},Xe.simpleFilter=function(lt,xe){return xe.filter(function(de){return Xe.test(lt,de)})},Xe.test=function(lt,xe){return null!==Xe.match(lt,xe)},Xe.match=function(lt,xe,de){var ce,h=0,U=[],Y=xe.length,re=0,$=0,K=(de=de||{}).pre||"",W=de.post||"",me=de.caseSensitive&&xe||xe.toLowerCase();lt=de.caseSensitive&&lt||lt.toLowerCase();for(var ue=0;ue<Y;ue++)ce=xe[ue],me[ue]===lt[h]?(ce=K+ce+W,h+=1,$+=1+$):$=0,re+=$,U[U.length]=ce;return h===lt.length?(re=me===lt?1/0:re,{rendered:U.join(""),score:re}):null},Xe.filter=function(lt,xe,de){return xe&&0!==xe.length?"string"!=typeof lt?xe:(de=de||{},xe.reduce(function(h,U,Y,re){var $=U;de.extract&&($=de.extract(U));var K=Xe.match(lt,$,de);return null!=K&&(h[h.length]={string:K.rendered,score:K.score,index:Y,original:U}),h},[]).sort(function(h,U){return U.score-h.score||h.index-U.index})):[]}},494:Nt=>{"use strict";var Bt=Object.prototype.toString;Nt.exports=function(Xe){var lt;return"[object Object]"===Bt.call(Xe)&&(null===(lt=Object.getPrototypeOf(Xe))||lt===Object.getPrototypeOf({}))}},82:Nt=>{var xe=/^\s+|\s+$/g,de=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,U=/^0o[0-7]+$/i,Y=parseInt,re="object"==typeof global&&global&&global.Object===Object&&global,$="object"==typeof self&&self&&self.Object===Object&&self,K=re||$||Function("return this")(),me=Object.prototype.toString,ce=Math.max,ue=Math.min,Te=function(){return K.Date.now()};function Q(ne){var Me=typeof ne;return!!ne&&("object"==Me||"function"==Me)}function J(ne){if("number"==typeof ne)return ne;if(function Ae(ne){return"symbol"==typeof ne||function we(ne){return!!ne&&"object"==typeof ne}(ne)&&"[object Symbol]"==me.call(ne)}(ne))return NaN;if(Q(ne)){var Me="function"==typeof ne.valueOf?ne.valueOf():ne;ne=Q(Me)?Me+"":Me}if("string"!=typeof ne)return 0===ne?ne:+ne;ne=ne.replace(xe,"");var Be=h.test(ne);return Be||U.test(ne)?Y(ne.slice(2),Be?2:8):de.test(ne)?NaN:+ne}Nt.exports=function Ne(ne,Me,Be){var He,rt,mt,Pt,gt,Et,Ot=0,ut=!1,it=!1,cn=!0;if("function"!=typeof ne)throw new TypeError("Expected a function");function wn(Tt){var $t=He,fn=rt;return He=rt=void 0,Ot=Tt,Pt=ne.apply(fn,$t)}function sn(Tt){return Ot=Tt,gt=setTimeout(Nn,Me),ut?wn(Tt):Pt}function un(Tt){var $t=Tt-Et;return void 0===Et||$t>=Me||$t<0||it&&Tt-Ot>=mt}function Nn(){var Tt=Te();if(un(Tt))return ir(Tt);gt=setTimeout(Nn,function On(Tt){var bt=Me-(Tt-Et);return it?ue(bt,mt-(Tt-Ot)):bt}(Tt))}function ir(Tt){return gt=void 0,cn&&He?wn(Tt):(He=rt=void 0,Pt)}function nt(){var Tt=Te(),$t=un(Tt);if(He=arguments,rt=this,Et=Tt,$t){if(void 0===gt)return sn(Et);if(it)return gt=setTimeout(Nn,Me),wn(Et)}return void 0===gt&&(gt=setTimeout(Nn,Me)),Pt}return Me=J(Me)||0,Q(Be)&&(ut=!!Be.leading,mt=(it="maxWait"in Be)?ce(J(Be.maxWait)||0,Me):mt,cn="trailing"in Be?!!Be.trailing:cn),nt.cancel=function kt(){void 0!==gt&&clearTimeout(gt),Ot=0,He=Et=rt=gt=void 0},nt.flush=function Pn(){return void 0===gt?Pt:ir(Te())},nt}},898:function(Nt){Nt.exports=function(){"use strict";var Bt,Xe,lt;function xe(h,U){if(Bt)if(Xe){var Y="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Bt+")(sharedChunk); ("+Xe+")(sharedChunk); self.onerror = null;",re={};Bt(re),lt=U(re),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(lt.workerUrl=window.URL.createObjectURL(new Blob([Y],{type:"text/javascript"})))}else Xe=U;else Bt=U}return xe(0,function(h){var U="2.8.1",Y=re;function re(o,r,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=c,this.p2x=s,this.p2y=c}re.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},re.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},re.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},re.prototype.solveCurveX=function(o,r){var s,c,f,g,y;for(void 0===r&&(r=1e-6),f=o,y=0;y<8;y++){if(g=this.sampleCurveX(f)-o,Math.abs(g)<r)return f;var x=this.sampleCurveDerivativeX(f);if(Math.abs(x)<1e-6)break;f-=g/x}if((f=o)<(s=0))return s;if(f>(c=1))return c;for(;s<c;){if(g=this.sampleCurveX(f),Math.abs(g-o)<r)return f;o>g?s=f:c=f,f=.5*(c-s)+s}return f},re.prototype.solve=function(o,r){return this.sampleCurveY(this.solveCurveX(o,r))};var $=K;function K(o,r){this.x=o,this.y=r}K.prototype={clone:function(){return new K(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,r){return this.clone()._rotateAround(o,r)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var r=o.x-this.x,s=o.y-this.y;return r*r+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,r){return Math.atan2(this.x*r-this.y*o,this.x*o+this.y*r)},_matMult:function(o){var r=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=r,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var r=Math.cos(o),s=Math.sin(o),c=s*this.x+r*this.y;return this.x=r*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,r){var s=Math.cos(o),c=Math.sin(o),f=r.y+c*(this.x-r.x)+s*(this.y-r.y);return this.x=r.x+s*(this.x-r.x)-c*(this.y-r.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},K.convert=function(o){return o instanceof K?o:Array.isArray(o)?new K(o[0],o[1]):o};var W="undefined"!=typeof self?self:{};const me=Math.PI/180,ce=180/Math.PI;function ue(o){return o*me}function Te(o){return o*ce}const Ne=[[0,0],[1,0],[1,1],[0,1]];function Q(o){if(o<=0)return 0;if(o>=1)return 1;const r=o*o,s=r*o;return 4*(o<.5?s:3*(o-r)+s-.75)}function we(o,r,s,c){const f=new Y(o,r,s,c);return function(g){return f.solve(g)}}const Ae=we(.25,.1,.25,1);function J(o,r,s){return Math.min(s,Math.max(r,o))}function ne(o,r,s){return(s=J((s-o)/(r-o),0,1))*s*(3-2*s)}function Me(o,r,s){const c=s-r,f=((o-r)%c+c)%c+r;return f===r?s:f}function Be(o,r,s){if(!o.length)return s(null,[]);let c=o.length;const f=new Array(o.length);let g=null;o.forEach((y,x)=>{r(y,(E,D)=>{E&&(g=E),f[x]=D,0==--c&&s(g,f)})})}function He(o){const r=[];for(const s in o)r.push(o[s]);return r}function rt(o,...r){for(const s of r)for(const c in s)o[c]=s[c];return o}let mt=1;function Pt(){return mt++}function gt(){return function o(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Et(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Ot(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function ut(o,r){o.forEach(s=>{r[s]&&(r[s]=r[s].bind(r))})}function it(o,r){return-1!==o.indexOf(r,o.length-r.length)}function cn(o,r,s){const c={};for(const f in o)c[f]=r.call(s||this,o[f],f,o);return c}function wn(o,r,s){const c={};for(const f in o)r.call(s||this,o[f],f,o)&&(c[f]=o[f]);return c}function sn(o){return Array.isArray(o)?o.map(sn):"object"==typeof o&&o?cn(o,sn):o}const On={};function un(o){On[o]||("undefined"!=typeof console&&console.warn(o),On[o]=!0)}function Nn(o,r,s){return(s.y-o.y)*(r.x-o.x)>(r.y-o.y)*(s.x-o.x)}function ir(o){let r=0;for(let s,c,f=0,g=o.length,y=g-1;f<g;y=f++)s=o[f],c=o[y],r+=(c.x-s.x)*(s.y+c.y);return r}function kt(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Pn(o){const r={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,f,g)=>{const y=f||g;return r[c]=!y||y.toLowerCase(),""}),r["max-age"]){const s=parseInt(r["max-age"],10);isNaN(s)?delete r["max-age"]:r["max-age"]=s}return r}let nt,Tt,$t,fn,bt=null;function kn(o){if(null==bt){const r=o.navigator?o.navigator.userAgent:null;bt=!!o.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return bt}function Gr(o){try{const r=W[o];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const ur={now:()=>void 0!==$t?$t:W.performance.now(),setNow(o){$t=o},restoreNow(){$t=void 0},frame(o){const r=W.requestAnimationFrame(o);return{cancel:()=>W.cancelAnimationFrame(r)}},getImageData(o,r=0){const{width:s,height:c}=o;fn||(fn=W.document.createElement("canvas"));const f=fn.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return(s>fn.width||c>fn.height)&&(fn.width=s,fn.height=c),f.clearRect(-r,-r,s+2*r,c+2*r),f.drawImage(o,0,0,s,c),f.getImageData(-r,-r,s+2*r,c+2*r)},resolveURL:o=>(nt||(nt=W.document.createElement("a")),nt.href=o,nt.href),get devicePixelRatio(){return W.devicePixelRatio},get prefersReducedMotion(){return!!W.matchMedia&&(null==Tt&&(Tt=W.matchMedia("(prefers-reduced-motion: reduce)")),Tt.matches)}};let Qn;const yn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Qn){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Qn=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch(r){Qn=o}}return Qn},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},hr={supported:!1,testSupport:function(o){!qr&&Ai&&(zi?Mo(o):jn=o)}};let jn,Ai,qr=!1,zi=!1;function Mo(o){const r=o.createTexture();o.bindTexture(o.TEXTURE_2D,r);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Ai),o.isContextLost())return;hr.supported=!0}catch(s){}o.deleteTexture(r),qr=!0}W.document&&(Ai=W.document.createElement("img"),Ai.onload=function(){jn&&Mo(jn),jn=null,zi=!0},Ai.onerror=function(){qr=!0,jn=null},Ai.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Nr="01",no="NO_ACCESS_TOKEN";function Wi(o){return 0===o.indexOf("mapbox:")}function Vo(o){return yn.API_URL_REGEX.test(o)}const mi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Pi(o){const r=o.match(mi);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function ro(o){const r=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${r}`}function $o(o){if(!o)return null;const r=o.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(W.atob(r[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class os{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const s=$o(yn.ACCESS_TOKEN);let c="";return c=s&&s.u?W.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(f,g)=>String.fromCharCode(Number("0x"+g)))):yn.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const r=Gr("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{const f=W.localStorage.getItem(s);f&&(this.eventData=JSON.parse(f));const g=W.localStorage.getItem(c);g&&(this.anonId=g)}catch(f){un("Unable to read from LocalStorage")}}saveEventData(){const r=Gr("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{W.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&W.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(f){un("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,s,c,f){if(!yn.EVENTS_URL)return;const g=Pi(yn.EVENTS_URL);g.params.push(`access_token=${f||yn.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:Nr,userId:this.anonId},x=s?rt(y,s):y,E={url:ro(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=De(E,D=>{this.pendingRequest=null,c(D),this.saveEventData(),this.processRequests(f)})}queueRequest(r,s){this.queue.push(r),this.processRequests(s)}}const Ss=new class extends os{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,r){yn.EVENTS_URL&&yn.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>Wi(s)||Vo(s))&&this.queueRequest(Date.now(),r)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=$o(yn.ACCESS_TOKEN),s=r?r.u:yn.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;Ot(this.anonId)||(this.anonId=gt(),c=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),y=new Date(f),x=(f-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||g.getDate()!==y.getDate()}else c=!0;c?this.postEvent(f,{"enabled.telemetry":!1},g=>{g||(this.eventData.lastSuccess=f,this.eventData.tokenU=s)},o):this.processRequests()}},ss=Ss.postTurnstileEvent.bind(Ss),Is=new class extends os{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,r,s,c){this.skuToken=r,this.errorCb=c,yn.EVENTS_URL&&(s||yn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(no)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:s}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Ot(this.anonId)||(this.anonId=gt()),this.postEvent(s,{skuToken:this.skuToken},c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},o))}},qs=Is.postMapLoadEvent.bind(Is),xi=new class extends os{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,r,s,c){if(!yn.API_URL||!yn.SESSION_PATH)return;const f=Pi(yn.API_URL+yn.SESSION_PATH);f.params.push(`sku=${r||""}`),f.params.push(`access_token=${c||yn.ACCESS_TOKEN||""}`);const g={url:ro(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Ie(g,y=>{this.pendingRequest=null,s(y),this.saveEventData(),this.processRequests(c)})}getSessionAPI(o,r,s,c){this.skuToken=r,this.errorCb=c,yn.SESSION_PATH&&yn.API_URL&&(s||yn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(no)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:s}=this.queue.shift();r&&this.success[r]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},o)}},Zs=xi.getSessionAPI.bind(xi),ki=new Set,Ms="mapbox-tiles";let bi,Zr,Yn=500,io=50;function er(){W.caches&&!bi&&(bi=W.caches.open(Ms))}function Ni(o){const r=o.indexOf("?");return r<0?o:o.slice(0,r)}let Go=1/0;const oe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(oe);class z extends Error{constructor(r,s,c){401===s&&Vo(c)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const V=kt()?()=>self.worker&&self.worker.referrer:()=>("blob:"===W.location.protocol?W.parent:W).location.href,ie=function(o,r){if(!(/^file:/.test(s=o.url)||/^file:/.test(V())&&!/^\w+:/.test(s))){if(W.fetch&&W.Request&&W.AbortController&&W.Request.prototype.hasOwnProperty("signal"))return function(c,f){const g=new W.AbortController,y=new W.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:V(),signal:g.signal});let x=!1,E=!1;const D=(M=y.url).indexOf("sku=")>0&&Vo(M);var M;"json"===c.type&&y.headers.set("Accept","application/json");const A=(F,j,q)=>{if(E)return;if(F&&"SecurityError"!==F.message&&un(F),j&&q)return k(j);const ee=Date.now();W.fetch(y).then(le=>{if(le.ok){const Ee=D?le.clone():null;return k(le,Ee,ee)}return f(new z(le.statusText,le.status,c.url))}).catch(le=>{20!==le.code&&f(new Error(le.message))})},k=(F,j,q)=>{("arrayBuffer"===c.type?F.arrayBuffer():"json"===c.type?F.json():F.text()).then(ee=>{E||(j&&q&&function(le,Ee,Pe){if(er(),!bi)return;const Re={status:Ee.status,statusText:Ee.statusText,headers:new W.Headers};Ee.headers.forEach((Ye,Qe)=>Re.headers.set(Qe,Ye));const Le=Pn(Ee.headers.get("Cache-Control")||"");if(Le["no-store"])return;Le["max-age"]&&Re.headers.set("Expires",new Date(Pe+1e3*Le["max-age"]).toUTCString());const Fe=Re.headers.get("Expires");Fe&&(new Date(Fe).getTime()-Pe<42e4||function(Ye,Qe){if(void 0===Zr)try{new Response(new ReadableStream),Zr=!0}catch(at){Zr=!1}Zr?Qe(Ye.body):Ye.blob().then(Qe)}(Ee,Ye=>{const Qe=new W.Response(Ye,Re);er(),bi&&bi.then(at=>at.put(Ni(le.url),Qe)).catch(at=>un(at.message))}))}(y,j,q),x=!0,f(null,ee,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(ee=>{E||f(new Error(ee.message))})};return D?function(F,j){if(er(),!bi)return j(null);const q=Ni(F.url);bi.then(ee=>{ee.match(q).then(le=>{const Ee=function(Pe){if(!Pe)return!1;const Re=new Date(Pe.headers.get("Expires")||0),Le=Pn(Pe.headers.get("Cache-Control")||"");return Re>Date.now()&&!Le["no-cache"]}(le);ee.delete(q),Ee&&ee.put(q,le.clone()),j(null,le,Ee)}).catch(j)}).catch(j)}(y,A):A(null,null),{cancel:()=>{E=!0,x||g.abort()}}}(o,r);if(kt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,r,void 0,!0)}var s;return function(c,f){const g=new W.XMLHttpRequest;g.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(g.responseType="arraybuffer");for(const y in c.headers)g.setRequestHeader(y,c.headers[y]);return"json"===c.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===c.credentials,g.onerror=()=>{f(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let y=g.response;if("json"===c.type)try{y=JSON.parse(g.response)}catch(x){return f(x)}f(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else f(new z(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}}(o,r)},se=function(o,r){return ie(rt(o,{type:"arrayBuffer"}),r)},De=function(o,r){return ie(rt(o,{method:"POST"}),r)},Ie=function(o,r){return ie(rt(o,{method:"GET"}),r)};function Oe(o){const r=W.document.createElement("a");return r.href=o,r.protocol===W.document.location.protocol&&r.host===W.document.location.host}const ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ve,st;Ve=[],st=0;const It=function(o,r){if(hr.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),st>=yn.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:o,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Ve.push(g),g}st++;let s=!1;const c=()=>{if(!s)for(s=!0,st--;Ve.length&&st<yn.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Ve.shift(),{requestParameters:y,callback:x,cancelled:E}=g;E||(g.cancel=It(y,x).cancel)}},f=se(o,(g,y,x,E)=>{c(),g?r(g):y&&(W.createImageBitmap?function(D,M){const A=new W.Blob([new Uint8Array(D)],{type:"image/png"});W.createImageBitmap(A).then(k=>{M(null,k)}).catch(k=>{M(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(D,M)=>r(D,M,x,E)):function(D,M){const A=new W.Image,k=W.URL;A.onload=()=>{M(null,A),k.revokeObjectURL(A.src),A.onload=null,W.requestAnimationFrame(()=>{A.src=ke})},A.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new W.Blob([new Uint8Array(D)],{type:"image/png"});A.src=D.byteLength?k.createObjectURL(F):ke}(y,(D,M)=>r(D,M,x,E)))});return{cancel:()=>{f.cancel(),c()}}};function ot(o,r,s){s[o]&&-1!==s[o].indexOf(r)||(s[o]=s[o]||[],s[o].push(r))}function rn(o,r,s){if(s&&s[o]){const c=s[o].indexOf(r);-1!==c&&s[o].splice(c,1)}}class Wt{constructor(r,s={}){rt(this,s),this.type=r}}class Xt extends Wt{constructor(r,s={}){super("error",rt({error:r},s))}}class nn{on(r,s){return this._listeners=this._listeners||{},ot(r,s,this._listeners),this}off(r,s){return rn(r,s,this._listeners),rn(r,s,this._oneTimeListeners),this}once(r,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},ot(r,s,this._oneTimeListeners),this):new Promise(c=>this.once(r,c))}fire(r,s){"string"==typeof r&&(r=new Wt(r,s||{}));const c=r.type;if(this.listens(c)){r.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of f)x.call(this,r);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of g)rn(c,x,this._oneTimeListeners),x.call(this,r);const y=this._eventedParent;y&&(rt(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(r))}else r instanceof Xt&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,s){return this._eventedParent=r,this._eventedParentData=s,this}}var $e=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function tr(o,...r){for(const s of r)for(const c in s)o[c]=s[c];return o}function Gt(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Wn(o){if(Array.isArray(o))return o.map(Wn);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const r={};for(const s in o)r[s]=Wn(o[s]);return r}return Gt(o)}class Ln extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}class as{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[c,f]of s)this.bindings[c]=f}concat(r){return new as(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Ao={kind:"null"},Mt={kind:"number"},pn={kind:"string"},tn={kind:"boolean"},wi={kind:"color"},ls={kind:"object"},Bn={kind:"value"},gn={kind:"collator"},cs={kind:"formatted"},Cr={kind:"resolvedImage"};function hi(o,r){return{kind:"array",itemType:o,N:r}}function Dr(o){if("array"===o.kind){const r=Dr(o.itemType);return"number"==typeof o.N?`array<${r}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${r}>`}return o.kind}const Kl=[Ao,Mt,pn,tn,wi,cs,ls,hi(Bn),Cr];function Xi(o,r){if("error"===r.kind)return null;if("array"===o.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!Xi(o.itemType,r.itemType))&&("number"!=typeof o.N||o.N===r.N))return null}else{if(o.kind===r.kind)return null;if("value"===o.kind)for(const s of Kl)if(!Xi(s,r))return null}return`Expected ${Dr(o)} but found ${Dr(r)} instead.`}function Ws(o,r){return r.some(s=>s.kind===o.kind)}function oo(o,r){return r.some(s=>"null"===s?null===o:"array"===s?Array.isArray(o):"object"===s?o&&!Array.isArray(o)&&"object"==typeof o:s===typeof o)}function As(o){var r={exports:{}};return o(r,r.exports),r.exports}var Xs=As(function(o,r){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(x){return(x=Math.round(x))<0?0:x>255?255:x}function f(x){return c("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function g(x){return(E="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:E>1?1:E;var E}function y(x,E,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?x+(E-x)*D*6:2*D<1?E:3*D<2?x+(E-x)*(2/3-D)*6:x}try{r.parseCSSColor=function(x){var E,D=x.replace(/ /g,"").toLowerCase();if(D in s)return s[D].slice();if("#"===D[0])return 4===D.length?(E=parseInt(D.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===D.length&&(E=parseInt(D.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var M=D.indexOf("("),A=D.indexOf(")");if(-1!==M&&A+1===D.length){var k=D.substr(0,M),F=D.substr(M+1,A-(M+1)).split(","),j=1;switch(k){case"rgba":if(4!==F.length)return null;j=g(F.pop());case"rgb":return 3!==F.length?null:[f(F[0]),f(F[1]),f(F[2]),j];case"hsla":if(4!==F.length)return null;j=g(F.pop());case"hsl":if(3!==F.length)return null;var q=(parseFloat(F[0])%360+360)%360/360,ee=g(F[1]),le=g(F[2]),Ee=le<=.5?le*(ee+1):le+ee-le*ee,Pe=2*le-Ee;return[c(255*y(Pe,Ee,q+1/3)),c(255*y(Pe,Ee,q)),c(255*y(Pe,Ee,q-1/3)),j];default:return null}}return null}}catch(x){}});class qn{constructor(r,s,c,f=1){this.r=r,this.g=s,this.b=c,this.a=f}static parse(r){if(!r)return;if(r instanceof qn)return r;if("string"!=typeof r)return;const s=Xs.parseCSSColor(r);return s?new qn(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[r,s,c,f]=this.toArray();return`rgba(${Math.round(r)},${Math.round(s)},${Math.round(c)},${f})`}toArray(){const{r,g:s,b:c,a:f}=this;return 0===f?[0,0,0,0]:[255*r/f,255*s/f,255*c/f,f]}}qn.black=new qn(0,0,0,1),qn.white=new qn(1,1,1,1),qn.transparent=new qn(0,0,0,0),qn.red=new qn(1,0,0,1),qn.blue=new qn(0,0,1,1);class xn{constructor(r,s,c){this.sensitivity=r?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Po{constructor(r,s,c,f,g){this.text=r.normalize?r.normalize():r,this.image=s,this.scale=c,this.fontStack=f,this.textColor=g}}class Wr{constructor(r){this.sections=r}static fromString(r){return new Wr([new Po(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof Wr?r:Wr.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const s of this.sections){if(s.image){r.push(["image",s.image.name]);continue}r.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),r.push(c)}return r}}class Ar{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Ar({name:r,available:!1}):null}serialize(){return["image",this.name]}}function gi(o,r,s,c){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[o,r,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[o,r,s,c]:[o,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ko(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof qn||o instanceof xn||o instanceof Wr||o instanceof Ar)return!0;if(Array.isArray(o)){for(const r of o)if(!ko(r))return!1;return!0}if("object"==typeof o){for(const r in o)if(!ko(o[r]))return!1;return!0}return!1}function xr(o){if(null===o)return Ao;if("string"==typeof o)return pn;if("boolean"==typeof o)return tn;if("number"==typeof o)return Mt;if(o instanceof qn)return wi;if(o instanceof xn)return gn;if(o instanceof Wr)return cs;if(o instanceof Ar)return Cr;if(Array.isArray(o)){const r=o.length;let s;for(const c of o){const f=xr(c);if(s){if(s===f)continue;s=Bn;break}s=f}return hi(s||Bn,r)}return ls}function ii(o){const r=typeof o;return null===o?"":"string"===r||"number"===r||"boolean"===r?String(o):o instanceof qn||o instanceof Wr||o instanceof Ar?o.toString():JSON.stringify(o)}class Ho{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(2!==r.length)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ko(r[1]))return s.error("invalid value");const c=r[1];let f=xr(c);const g=s.expectedType;return"array"!==f.kind||0!==f.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(f=g),new Ho(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof qn?["rgba"].concat(this.value.toArray()):this.value instanceof Wr?this.value.serialize():this.value}}class _i{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const Ri={string:pn,number:Mt,boolean:tn,object:ls};class so{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let c,f=1;const g=r[0];if("array"===g){let x,E;if(r.length>2){const D=r[1];if("string"!=typeof D||!(D in Ri)||"object"===D)return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=Ri[D],f++}else x=Bn;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=r[2],f++}c=hi(x,E)}else c=Ri[g];const y=[];for(;f<r.length;f++){const x=s.parse(r[f],f,Bn);if(!x)return null;y.push(x)}return new so(c,y)}evaluate(r){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(r);if(!Xi(this.type,xr(c)))return c;if(s===this.args.length-1)throw new _i(`Expected value to be of type ${Dr(this.type)}, but found ${Dr(xr(c))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,s=[r.kind];if("array"===r.kind){const c=r.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){s.push(c.kind);const f=r.N;("number"==typeof f||this.args.length>1)&&s.push(f)}}return s.concat(this.args.map(c=>c.serialize()))}}class Ps{constructor(r){this.type=cs,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const c=r[1];if(!Array.isArray(c)&&"object"==typeof c)return s.error("First argument must be an image or text section.");const f=[];let g=!1;for(let y=1;y<=r.length-1;++y){const x=r[y];if(g&&"object"==typeof x&&!Array.isArray(x)){g=!1;let E=null;if(x["font-scale"]&&(E=s.parse(x["font-scale"],1,Mt),!E))return null;let D=null;if(x["text-font"]&&(D=s.parse(x["text-font"],1,hi(pn)),!D))return null;let M=null;if(x["text-color"]&&(M=s.parse(x["text-color"],1,wi),!M))return null;const A=f[f.length-1];A.scale=E,A.font=D,A.textColor=M}else{const E=s.parse(r[y],1,Bn);if(!E)return null;const D=E.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:E,scale:null,font:null,textColor:null})}}return new Ps(f)}evaluate(r){return new Wr(this.sections.map(s=>{const c=s.content.evaluate(r);return xr(c)===Cr?new Po("",c,null,null,null):new Po(ii(c),null,s.scale?s.scale.evaluate(r):null,s.font?s.font.evaluate(r).join(","):null,s.textColor?s.textColor.evaluate(r):null)}))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const s of this.sections){r.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),r.push(c)}return r}}class us{constructor(r){this.type=Cr,this.input=r}static parse(r,s){if(2!==r.length)return s.error("Expected two arguments.");const c=s.parse(r[1],1,pn);return c?new us(c):s.error("No image name provided.")}evaluate(r){const s=this.input.evaluate(r),c=Ar.fromString(s);return c&&r.availableImages&&(c.available=r.availableImages.indexOf(s)>-1),c}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Na={"to-boolean":tn,"to-color":wi,"to-number":Mt,"to-string":pn};class Fn{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const c=r[0];if(("to-boolean"===c||"to-string"===c)&&2!==r.length)return s.error("Expected one argument.");const f=Na[c],g=[];for(let y=1;y<r.length;y++){const x=s.parse(r[y],y,Bn);if(!x)return null;g.push(x)}return new Fn(f,g)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let s,c;for(const f of this.args){if(s=f.evaluate(r),c=null,s instanceof qn)return s;if("string"==typeof s){const g=r.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:gi(s[0],s[1],s[2],s[3]),!c))return new qn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new _i(c||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const c of this.args){if(s=c.evaluate(r),null===s)return 0;const f=Number(s);if(!isNaN(f))return f}throw new _i(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?Wr.fromString(ii(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?Ar.fromString(ii(this.args[0].evaluate(r))):ii(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ps([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new us(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(s=>{r.push(s.serialize())}),r}}const Yl=["Unknown","Point","LineString","Polygon"];class Jl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Yl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:c,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*s-r[0])+this.featureDistanceData.bearing[1]*(f*s-r[1])}return 0}parseColor(r){let s=this._parseColorCache[r];return s||(s=this._parseColorCache[r]=qn.parse(r)),s}}class Se{constructor(r,s,c,f){this.name=r,this.type=s,this._evaluate=c,this.args=f}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,s){const c=r[0],f=Se.definitions[c];if(!f)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,x=y.filter(([D])=>!Array.isArray(D)||D.length===r.length-1);let E=null;for(const[D,M]of x){E=new ht(s.registry,s.path,null,s.scope);const A=[];let k=!1;for(let F=1;F<r.length;F++){const j=r[F],q=Array.isArray(D)?D[F-1]:D.type,ee=E.parse(j,1+A.length,q);if(!ee){k=!0;break}A.push(ee)}if(!k)if(Array.isArray(D)&&D.length!==A.length)E.error(`Expected ${D.length} arguments, but found ${A.length} instead.`);else{for(let F=0;F<A.length;F++){const j=Array.isArray(D)?D[F]:D.type,q=A[F];E.concat(F+1).checkSubtype(j,q.type)}if(0===E.errors.length)return new Se(c,g,M,A)}}if(1===x.length)s.errors.push(...E.errors);else{const D=(x.length?x:y).map(([A])=>{return k=A,Array.isArray(k)?`(${k.map(Dr).join(", ")})`:`(${Dr(k.type)}...)`;var k}).join(" | "),M=[];for(let A=1;A<r.length;A++){const k=s.parse(r[A],1+M.length);if(!k)return null;M.push(Dr(k.type))}s.error(`Expected arguments of type ${D}, but found (${M.join(", ")}) instead.`)}return null}static register(r,s){Se.definitions=s;for(const c in s)r[c]=Se}}class Ze{constructor(r,s,c){this.type=gn,this.locale=c,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(2!==r.length)return s.error("Expected one argument.");const c=r[1];if("object"!=typeof c||Array.isArray(c))return s.error("Collator options argument must be an object.");const f=s.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,tn);if(!f)return null;const g=s.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,tn);if(!g)return null;let y=null;return c.locale&&(y=s.parse(c.locale,1,pn),!y)?null:new Ze(f,g,y)}evaluate(r){return new xn(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const _t=8192;function An(o,r){o[0]=Math.min(o[0],r[0]),o[1]=Math.min(o[1],r[1]),o[2]=Math.max(o[2],r[0]),o[3]=Math.max(o[3],r[1])}function Xn(o,r){return!(o[0]<=r[0]||o[2]>=r[2]||o[1]<=r[1]||o[3]>=r[3])}function Xr(o,r){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,f=Math.pow(2,r.z);return[Math.round(s*f*_t),Math.round(c*f*_t)]}function gr(o,r,s){const c=o[0]-r[0],f=o[1]-r[1],g=o[0]-s[0],y=o[1]-s[1];return c*y-g*f==0&&c*g<=0&&f*y<=0}function wr(o,r){let s=!1;for(let y=0,x=r.length;y<x;y++){const E=r[y];for(let D=0,M=E.length;D<M-1;D++){if(gr(o,E[D],E[D+1]))return!1;(f=E[D])[1]>(c=o)[1]!=(g=E[D+1])[1]>c[1]&&c[0]<(g[0]-f[0])*(c[1]-f[1])/(g[1]-f[1])+f[0]&&(s=!s)}}var c,f,g;return s}function yo(o,r){for(let s=0;s<r.length;s++)if(wr(o,r[s]))return!0;return!1}function Sr(o,r,s,c){const f=c[0]-s[0],g=c[1]-s[1],y=(o[0]-s[0])*g-f*(o[1]-s[1]),x=(r[0]-s[0])*g-f*(r[1]-s[1]);return y>0&&x<0||y<0&&x>0}function xl(o,r,s){for(const D of s)for(let M=0;M<D.length-1;++M)if((x=[(y=D[M+1])[0]-(g=D[M])[0],y[1]-g[1]])[0]*(E=[(f=r)[0]-(c=o)[0],f[1]-c[1]])[1]-x[1]*E[0]!=0&&Sr(c,f,g,y)&&Sr(g,y,c,f))return!0;var c,f,g,y,x,E;return!1}function li(o,r){for(let s=0;s<o.length;++s)if(!wr(o[s],r))return!1;for(let s=0;s<o.length-1;++s)if(xl(o[s],o[s+1],r))return!1;return!0}function bl(o,r){for(let s=0;s<r.length;s++)if(li(o,r[s]))return!0;return!1}function ks(o,r,s){const c=[];for(let f=0;f<o.length;f++){const g=[];for(let y=0;y<o[f].length;y++){const x=Xr(o[f][y],s);An(r,x),g.push(x)}c.push(g)}return c}function ci(o,r,s){const c=[];for(let f=0;f<o.length;f++){const g=ks(o[f],r,s);c.push(g)}return c}function Rs(o,r,s,c){if(o[0]<s[0]||o[0]>s[2]){const f=.5*c;let g=o[0]-s[0]>f?-c:s[0]-o[0]>f?c:0;0===g&&(g=o[0]-s[2]>f?-c:s[2]-o[0]>f?c:0),o[0]+=g}An(r,o)}function qo(o,r,s,c){const f=Math.pow(2,c.z)*_t,g=[c.x*_t,c.y*_t],y=[];if(!o)return y;for(const x of o)for(const E of x){const D=[E.x+g[0],E.y+g[1]];Rs(D,r,s,f),y.push(D)}return y}function ti(o,r,s,c){const f=Math.pow(2,c.z)*_t,g=[c.x*_t,c.y*_t],y=[];if(!o)return y;for(const E of o){const D=[];for(const M of E){const A=[M.x+g[0],M.y+g[1]];An(r,A),D.push(A)}y.push(D)}if(r[2]-r[0]<=f/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of y)for(const D of E)Rs(D,r,s,f)}var x;return y}class Br{constructor(r,s){this.type=tn,this.geojson=r,this.geometries=s}static parse(r,s){if(2!==r.length)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ko(r[1])){const c=r[1];if("FeatureCollection"===c.type)for(let f=0;f<c.features.length;++f){const g=c.features[f].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new Br(c,c.features[f].geometry)}else if("Feature"===c.type){const f=c.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Br(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new Br(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(s,c){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(!y)return!1;if("Polygon"===c.type){const x=ks(c.coordinates,g,y),E=qo(s.geometry(),f,g,y);if(!Xn(f,g))return!1;for(const D of E)if(!wr(D,x))return!1}if("MultiPolygon"===c.type){const x=ci(c.coordinates,g,y),E=qo(s.geometry(),f,g,y);if(!Xn(f,g))return!1;for(const D of E)if(!yo(D,x))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(s,c){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(!y)return!1;if("Polygon"===c.type){const x=ks(c.coordinates,g,y),E=ti(s.geometry(),f,g,y);if(!Xn(f,g))return!1;for(const D of E)if(!li(D,x))return!1}if("MultiPolygon"===c.type){const x=ci(c.coordinates,g,y),E=ti(s.geometry(),f,g,y);if(!Xn(f,g))return!1;for(const D of E)if(!bl(D,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function _r(o){if(o instanceof Se&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof Br)return!1;let r=!0;return o.eachChild(s=>{r&&!_r(s)&&(r=!1)}),r}function Bi(o){if(o instanceof Se&&"feature-state"===o.name)return!1;let r=!0;return o.eachChild(s=>{r&&!Bi(s)&&(r=!1)}),r}function pe(o,r){if(o instanceof Se&&r.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!pe(c,r)&&(s=!1)}),s}class ze{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(2!==r.length||"string"!=typeof r[1])return s.error("'var' expression requires exactly one string literal argument.");const c=r[1];return s.scope.has(c)?new ze(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ht{constructor(r,s=[],c,f=new as,g=[]){this.registry=r,this.path=s,this.key=s.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=g,this.expectedType=c}parse(r,s,c,f,g={}){return s?this.concat(s,c,f)._parse(r,g):this._parse(r,g)}_parse(r,s){function c(f,g,y){return"assert"===y?new so(g,[f]):"coerce"===y?new Fn(g,[f]):f}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=r[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[f];if(g){let y=g.parse(r,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,E=y.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==E.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(x,E))return null}else y=c(y,x,s.typeAnnotation||"coerce");else y=c(y,x,s.typeAnnotation||"assert")}if(!(y instanceof Ho)&&"resolvedImage"!==y.type.kind&&Jt(y)){const x=new Jl;try{y=new Ho(y.type,y.evaluate(x))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,s,c){const f="number"==typeof r?this.path.concat(r):this.path,g=c?this.scope.concat(c):this.scope;return new ht(this.registry,f,s||null,g,this.errors)}error(r,...s){const c=`${this.key}${s.map(f=>`[${f}]`).join("")}`;this.errors.push(new Ln(c,r))}checkSubtype(r,s){const c=Xi(r,s);return c&&this.error(c),c}}function Jt(o){if(o instanceof ze)return Jt(o.boundExpression);if(o instanceof Se&&"error"===o.name||o instanceof Ze||o instanceof Br)return!1;const r=o instanceof Fn||o instanceof so;let s=!0;return o.eachChild(c=>{s=r?s&&Jt(c):s&&c instanceof Ho}),!!s&&_r(o)&&pe(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function dr(o,r){const s=o.length-1;let c,f,g=0,y=s,x=0;for(;g<=y;)if(x=Math.floor((g+y)/2),c=o[x],f=o[x+1],c<=r){if(x===s||r<f)return x;g=x+1}else{if(!(c>r))throw new _i("Input is not a number.");y=x-1}return 0}class Mn{constructor(r,s,c){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[f,g]of c)this.labels.push(f),this.outputs.push(g)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(r[1],1,Mt);if(!c)return null;const f=[];let g=null;s.expectedType&&"value"!==s.expectedType.kind&&(g=s.expectedType);for(let y=1;y<r.length;y+=2){const x=1===y?-1/0:r[y],E=r[y+1],D=y,M=y+1;if("number"!=typeof x)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const A=s.parse(E,M,g);if(!A)return null;g=g||A.type,f.push([x,A])}return new Mn(g,c,f)}evaluate(r){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(r);const f=this.input.evaluate(r);if(f<=s[0])return c[0].evaluate(r);const g=s.length;return f>=s[g-1]?c[g-1].evaluate(r):c[dr(s,f)].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&r.push(this.labels[s]),r.push(this.outputs[s].serialize());return r}}function At(o,r,s){return o*(1-s)+r*s}var nr=Object.freeze({__proto__:null,number:At,color:function(o,r,s){return new qn(At(o.r,r.r,s),At(o.g,r.g,s),At(o.b,r.b,s),At(o.a,r.a,s))},array:function(o,r,s){return o.map((c,f)=>At(c,r[f],s))}});const Lt=4/29,Cn=6/29,Gn=3*Cn*Cn,jr=Math.PI/180,di=180/Math.PI;function Ir(o){return o>.008856451679035631?Math.pow(o,1/3):o/Gn+Lt}function ni(o){return o>Cn?o*o*o:Gn*(o-Lt)}function pr(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Os(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function vo(o){const r=Os(o.r),s=Os(o.g),c=Os(o.b),f=Ir((.4124564*r+.3575761*s+.1804375*c)/.95047),g=Ir((.2126729*r+.7151522*s+.072175*c)/1);return{l:116*g-16,a:500*(f-g),b:200*(g-Ir((.0193339*r+.119192*s+.9503041*c)/1.08883)),alpha:o.a}}function Rn(o){let r=(o.l+16)/116,s=isNaN(o.a)?r:r+o.a/500,c=isNaN(o.b)?r:r-o.b/200;return r=1*ni(r),s=.95047*ni(s),c=1.08883*ni(c),new qn(pr(3.2404542*s-1.5371385*r-.4985314*c),pr(-.969266*s+1.8760108*r+.041556*c),pr(.0556434*s-.2040259*r+1.0572252*c),o.alpha)}function Hc(o,r,s){const c=r-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const Ls={forward:vo,reverse:Rn,interpolate:function(o,r,s){return{l:At(o.l,r.l,s),a:At(o.a,r.a,s),b:At(o.b,r.b,s),alpha:At(o.alpha,r.alpha,s)}}},Ba={forward:function(o){const{l:r,a:s,b:c}=vo(o),f=Math.atan2(c,s)*di;return{h:f<0?f+360:f,c:Math.sqrt(s*s+c*c),l:r,alpha:o.a}},reverse:function(o){const r=o.h*jr,s=o.c;return Rn({l:o.l,a:Math.cos(r)*s,b:Math.sin(r)*s,alpha:o.alpha})},interpolate:function(o,r,s){return{h:Hc(o.h,r.h,s),c:At(o.c,r.c,s),l:At(o.l,r.l,s),alpha:At(o.alpha,r.alpha,s)}}};var _a=Object.freeze({__proto__:null,lab:Ls,hcl:Ba});class Hr{constructor(r,s,c,f,g){this.type=r,this.operator=s,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[y,x]of g)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(r,s,c,f){let g=0;if("exponential"===r.name)g=ya(s,r.base,c,f);else if("linear"===r.name)g=ya(s,1,c,f);else if("cubic-bezier"===r.name){const y=r.controlPoints;g=new Y(y[0],y[1],y[2],y[3]).solve(ya(s,1,c,f))}return g}static parse(r,s){let[c,f,g,...y]=r;if(!Array.isArray(f)||0===f.length)return s.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const D=f[1];if("number"!=typeof D)return s.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:D}}else{if("cubic-bezier"!==f[0])return s.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const D=f.slice(1);if(4!==D.length||D.some(M=>"number"!=typeof M||M<0||M>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:D}}}if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,Mt),!g)return null;const x=[];let E=null;"interpolate-hcl"===c||"interpolate-lab"===c?E=wi:s.expectedType&&"value"!==s.expectedType.kind&&(E=s.expectedType);for(let D=0;D<y.length;D+=2){const M=y[D],A=y[D+1],k=D+3,F=D+4;if("number"!=typeof M)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(x.length&&x[x.length-1][0]>=M)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const j=s.parse(A,F,E);if(!j)return null;E=E||j.type,x.push([M,j])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new Hr(E,c,f,g,x):s.error(`Type ${Dr(E)} is not interpolatable.`)}evaluate(r){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(r);const f=this.input.evaluate(r);if(f<=s[0])return c[0].evaluate(r);const g=s.length;if(f>=s[g-1])return c[g-1].evaluate(r);const y=dr(s,f),x=Hr.interpolationFactor(this.interpolation,f,s[y],s[y+1]),E=c[y].evaluate(r),D=c[y+1].evaluate(r);return"interpolate"===this.operator?nr[this.type.kind.toLowerCase()](E,D,x):"interpolate-hcl"===this.operator?Ba.reverse(Ba.interpolate(Ba.forward(E),Ba.forward(D),x)):Ls.reverse(Ls.interpolate(Ls.forward(E),Ls.forward(D),x))}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,r,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function ya(o,r,s,c){const f=c-s,g=o-s;return 0===f?0:1===r?g/f:(Math.pow(r,g)-1)/(Math.pow(r,f)-1)}class Fs{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expectected at least one argument.");let c=null;const f=s.expectedType;f&&"value"!==f.kind&&(c=f);const g=[];for(const x of r.slice(1)){const E=s.parse(x,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,g.push(E)}const y=f&&g.some(x=>Xi(f,x.type));return new Fs(y?Bn:c,g)}evaluate(r){let s,c=null,f=0;for(const g of this.args){if(f++,c=g.evaluate(r),c&&c instanceof Ar&&!c.available&&(s||(s=c),c=null,f===this.args.length))return s;if(null!==c)break}return c}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class ao{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const c=[];for(let g=1;g<r.length-1;g+=2){const y=r[g];if("string"!=typeof y)return s.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=s.parse(r[g+1],g+1);if(!x)return null;c.push([y,x])}const f=s.parse(r[r.length-1],r.length-1,s.expectedType,c);return f?new ao(c,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[s,c]of this.bindings)r.push(s,c.serialize());return r.push(this.result.serialize()),r}}class Lr{constructor(r,s,c){this.type=r,this.index=s,this.input=c}static parse(r,s){if(3!==r.length)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,Mt),f=s.parse(r[2],2,hi(s.expectedType||Bn));return c&&f?new Lr(f.type.itemType,c,f):null}evaluate(r){const s=this.index.evaluate(r),c=this.input.evaluate(r);if(s<0)throw new _i(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new _i(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new _i(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class qc{constructor(r,s){this.type=tn,this.needle=r,this.haystack=s}static parse(r,s){if(3!==r.length)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,Bn),f=s.parse(r[2],2,Bn);return c&&f?Ws(c.type,[tn,pn,Mt,Ao,Bn])?new qc(c,f):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(c.type)} instead`):null}evaluate(r){const s=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(null==c)return!1;if(!oo(s,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(xr(s))} instead.`);if(!oo(c,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${Dr(xr(c))} instead.`);return c.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Zc{constructor(r,s,c){this.type=Mt,this.needle=r,this.haystack=s,this.fromIndex=c}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,Bn),f=s.parse(r[2],2,Bn);if(!c||!f)return null;if(!Ws(c.type,[tn,pn,Mt,Ao,Bn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(c.type)} instead`);if(4===r.length){const g=s.parse(r[3],3,Mt);return g?new Zc(c,f,g):null}return new Zc(c,f)}evaluate(r){const s=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!oo(s,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${Dr(xr(s))} instead.`);if(!oo(c,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${Dr(xr(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(r);return c.indexOf(s,f)}return c.indexOf(s)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ro{constructor(r,s,c,f,g,y){this.inputType=r,this.type=s,this.input=c,this.cases=f,this.outputs=g,this.otherwise=y}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return s.error("Expected an even number of arguments.");let c,f;s.expectedType&&"value"!==s.expectedType.kind&&(f=s.expectedType);const g={},y=[];for(let D=2;D<r.length-1;D+=2){let M=r[D];const A=r[D+1];Array.isArray(M)||(M=[M]);const k=s.concat(D);if(0===M.length)return k.error("Expected at least one branch label.");for(const j of M){if("number"!=typeof j&&"string"!=typeof j)return k.error("Branch labels must be numbers or strings.");if("number"==typeof j&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof j&&Math.floor(j)!==j)return k.error("Numeric branch labels must be integer values.");if(c){if(k.checkSubtype(c,xr(j)))return null}else c=xr(j);if(void 0!==g[String(j)])return k.error("Branch labels must be unique.");g[String(j)]=y.length}const F=s.parse(A,D,f);if(!F)return null;f=f||F.type,y.push(F)}const x=s.parse(r[1],1,Bn);if(!x)return null;const E=s.parse(r[r.length-1],r.length-1,f);return E?"value"!==x.type.kind&&s.concat(1).checkSubtype(c,x.type)?null:new Ro(c,f,x,g,y,E):null}evaluate(r){const s=this.input.evaluate(r);return(xr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],f={};for(const y of s){const x=f[this.cases[y]];void 0===x?(f[this.cases[y]]=c.length,c.push([this.cases[y],[y]])):c[x][1].push(y)}const g=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,x]of c)r.push(1===x.length?g(x[0]):x.map(g)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}class xo{constructor(r,s,c){this.type=r,this.branches=s,this.otherwise=c}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&"value"!==s.expectedType.kind&&(c=s.expectedType);const f=[];for(let y=1;y<r.length-1;y+=2){const x=s.parse(r[y],y,tn);if(!x)return null;const E=s.parse(r[y+1],y+1,c);if(!E)return null;f.push([x,E]),c=c||E.type}const g=s.parse(r[r.length-1],r.length-1,c);return g?new xo(c,f,g):null}evaluate(r){for(const[s,c]of this.branches)if(s.evaluate(r))return c.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,c]of this.branches)r(s),r(c);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class wl{constructor(r,s,c,f){this.type=r,this.input=s,this.beginIndex=c,this.endIndex=f}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,Bn),f=s.parse(r[2],2,Mt);if(!c||!f)return null;if(!Ws(c.type,[hi(Bn),pn,Bn]))return s.error(`Expected first argument to be of type array or string, but found ${Dr(c.type)} instead`);if(4===r.length){const g=s.parse(r[3],3,Mt);return g?new wl(c.type,c,f,g):null}return new wl(c.type,c,f)}evaluate(r){const s=this.input.evaluate(r),c=this.beginIndex.evaluate(r);if(!oo(s,["string","array"]))throw new _i(`Expected first argument to be of type array or string, but found ${Dr(xr(s))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(r);return s.slice(c,f)}return s.slice(c)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ql(o,r){return"=="===o||"!="===o?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function ec(o,r,s,c){return 0===c.compare(r,s)}function Ki(o,r,s){const c="=="!==o&&"!="!==o;return class DT{constructor(g,y,x){this.type=tn,this.lhs=g,this.rhs=y,this.collator=x,this.hasUntypedArgument="value"===g.type.kind||"value"===y.type.kind}static parse(g,y){if(3!==g.length&&4!==g.length)return y.error("Expected two or three arguments.");const x=g[0];let E=y.parse(g[1],1,Bn);if(!E)return null;if(!Ql(x,E.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${Dr(E.type)}'.`);let D=y.parse(g[2],2,Bn);if(!D)return null;if(!Ql(x,D.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${Dr(D.type)}'.`);if(E.type.kind!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return y.error(`Cannot compare types '${Dr(E.type)}' and '${Dr(D.type)}'.`);c&&("value"===E.type.kind&&"value"!==D.type.kind?E=new so(D.type,[E]):"value"!==E.type.kind&&"value"===D.type.kind&&(D=new so(E.type,[D])));let M=null;if(4===g.length){if("string"!==E.type.kind&&"string"!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return y.error("Cannot use collator to compare non-string types.");if(M=y.parse(g[3],3,gn),!M)return null}return new DT(E,D,M)}evaluate(g){const y=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const E=xr(y),D=xr(x);if(E.kind!==D.kind||"string"!==E.kind&&"number"!==E.kind)throw new _i(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${E.kind}, ${D.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=xr(y),D=xr(x);if("string"!==E.kind||"string"!==D.kind)return r(g,y,x)}return this.collator?s(g,y,x,this.collator.evaluate(g)):r(g,y,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[o];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const Of=Ki("==",function(o,r,s){return r===s},ec),Pm=Ki("!=",function(o,r,s){return r!==s},function(o,r,s,c){return!ec(0,r,s,c)}),od=Ki("<",function(o,r,s){return r<s},function(o,r,s,c){return c.compare(r,s)<0}),Lf=Ki(">",function(o,r,s){return r>s},function(o,r,s,c){return c.compare(r,s)>0}),km=Ki("<=",function(o,r,s){return r<=s},function(o,r,s,c){return c.compare(r,s)<=0}),Rm=Ki(">=",function(o,r,s){return r>=s},function(o,r,s,c){return c.compare(r,s)>=0});class sd{constructor(r,s,c,f,g){this.type=pn,this.number=r,this.locale=s,this.currency=c,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(r,s){if(3!==r.length)return s.error("Expected two arguments.");const c=s.parse(r[1],1,Mt);if(!c)return null;const f=r[2];if("object"!=typeof f||Array.isArray(f))return s.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=s.parse(f.locale,1,pn),!g))return null;let y=null;if(f.currency&&(y=s.parse(f.currency,1,pn),!y))return null;let x=null;if(f["min-fraction-digits"]&&(x=s.parse(f["min-fraction-digits"],1,Mt),!x))return null;let E=null;return f["max-fraction-digits"]&&(E=s.parse(f["max-fraction-digits"],1,Mt),!E)?null:new sd(c,g,y,x,E)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Wu{constructor(r){this.type=Mt,this.input=r}static parse(r,s){if(2!==r.length)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const c=s.parse(r[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?s.error(`Expected argument of type string or array, but found ${Dr(c.type)} instead.`):new Wu(c):null}evaluate(r){const s=this.input.evaluate(r);if("string"==typeof s||Array.isArray(s))return s.length;throw new _i(`Expected value to be of type string or array, but found ${Dr(xr(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(s=>{r.push(s.serialize())}),r}}const El={"==":Of,"!=":Pm,">":Lf,"<":od,">=":Rm,"<=":km,array:so,at:Lr,boolean:so,case:xo,coalesce:Fs,collator:Ze,format:Ps,image:us,in:qc,"index-of":Zc,interpolate:Hr,"interpolate-hcl":Hr,"interpolate-lab":Hr,length:Wu,let:ao,literal:Ho,match:Ro,number:so,"number-format":sd,object:so,slice:wl,step:Mn,string:so,"to-boolean":Fn,"to-color":Fn,"to-number":Fn,"to-string":Fn,var:ze,within:Br};function ad(o,[r,s,c,f]){r=r.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const g=f?f.evaluate(o):1,y=gi(r,s,c,g);if(y)throw new _i(y);return new qn(r/255*g,s/255*g,c/255*g,g)}function Ff(o,r){return o in r}function ld(o,r){const s=r[o];return void 0===s?null:s}function ja(o){return{type:o}}function cd(o){return{result:"success",value:o}}function Tl(o){return{result:"error",value:o}}function tc(o){return"data-driven"===o["property-type"]||"cross-faded-data-driven"===o["property-type"]}function zf(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function ud(o){return!!o.expression&&o.expression.interpolated}function fr(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function Ks(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function Nf(o){return o}function hd(o,r){const s="color"===r.type,c=o.stops&&"object"==typeof o.stops[0][0],f=c||!(c||void 0!==o.property),g=o.type||(ud(r)?"exponential":"interval");if(s&&((o=tr({},o)).stops&&(o.stops=o.stops.map(D=>[D[0],qn.parse(D[1])])),o.default=qn.parse(o.default?o.default:r.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!_a[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let y,x,E;if("exponential"===g)y=hs;else if("interval"===g)y=Bf;else if("categorical"===g){y=Ua,x=Object.create(null);for(const D of o.stops)x[D[0]]=D[1];E=typeof o.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);y=Xu}if(c){const D={},M=[];for(let F=0;F<o.stops.length;F++){const j=o.stops[F],q=j[0].zoom;void 0===D[q]&&(D[q]={zoom:q,type:o.type,property:o.property,default:o.default,stops:[]},M.push(q)),D[q].stops.push([j[0].value,j[1]])}const A=[];for(const F of M)A.push([D[F].zoom,hd(D[F],r)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Hr.interpolationFactor.bind(void 0,k),zoomStops:A.map(F=>F[0]),evaluate:({zoom:F},j)=>hs({stops:A,base:o.base},r,F).evaluate(F,j)}}if(f){const D="exponential"===g?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Hr.interpolationFactor.bind(void 0,D),zoomStops:o.stops.map(M=>M[0]),evaluate:({zoom:M})=>y(o,r,M,x,E)}}return{kind:"source",evaluate(D,M){const A=M&&M.properties?M.properties[o.property]:void 0;return void 0===A?Wc(o.default,r.default):y(o,r,A,x,E)}}}function Wc(o,r,s){return void 0!==o?o:void 0!==r?r:void 0!==s?s:void 0}function Ua(o,r,s,c,f){return Wc(typeof s===f?c[s]:void 0,o.default,r.default)}function Bf(o,r,s){if("number"!==fr(s))return Wc(o.default,r.default);const c=o.stops.length;if(1===c||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const f=dr(o.stops.map(g=>g[0]),s);return o.stops[f][1]}function hs(o,r,s){const c=void 0!==o.base?o.base:1;if("number"!==fr(s))return Wc(o.default,r.default);const f=o.stops.length;if(1===f||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[f-1][0])return o.stops[f-1][1];const g=dr(o.stops.map(M=>M[0]),s),y=function(M,A,k,F){const j=F-k,q=M-k;return 0===j?0:1===A?q/j:(Math.pow(A,q)-1)/(Math.pow(A,j)-1)}(s,c,o.stops[g][0],o.stops[g+1][0]),x=o.stops[g][1],E=o.stops[g+1][1];let D=nr[r.type]||Nf;if(o.colorSpace&&"rgb"!==o.colorSpace){const M=_a[o.colorSpace];D=(A,k)=>M.reverse(M.interpolate(M.forward(A),M.forward(k),y))}return"function"==typeof x.evaluate?{evaluate(...M){const A=x.evaluate.apply(void 0,M),k=E.evaluate.apply(void 0,M);if(void 0!==A&&void 0!==k)return D(A,k,y)}}:D(x,E,y)}function Xu(o,r,s){return"color"===r.type?s=qn.parse(s):"formatted"===r.type?s=Wr.fromString(s.toString()):"resolvedImage"===r.type?s=Ar.fromString(s.toString()):fr(s)===r.type||"enum"===r.type&&r.values[s]||(s=void 0),Wc(s,o.default,r.default)}Se.register(El,{error:[{kind:"error"},[pn],(o,[r])=>{throw new _i(r.evaluate(o))}],typeof:[pn,[Bn],(o,[r])=>Dr(xr(r.evaluate(o)))],"to-rgba":[hi(Mt,4),[wi],(o,[r])=>r.evaluate(o).toArray()],rgb:[wi,[Mt,Mt,Mt],ad],rgba:[wi,[Mt,Mt,Mt,Mt],ad],has:{type:tn,overloads:[[[pn],(o,[r])=>Ff(r.evaluate(o),o.properties())],[[pn,ls],(o,[r,s])=>Ff(r.evaluate(o),s.evaluate(o))]]},get:{type:Bn,overloads:[[[pn],(o,[r])=>ld(r.evaluate(o),o.properties())],[[pn,ls],(o,[r,s])=>ld(r.evaluate(o),s.evaluate(o))]]},"feature-state":[Bn,[pn],(o,[r])=>ld(r.evaluate(o),o.featureState||{})],properties:[ls,[],o=>o.properties()],"geometry-type":[pn,[],o=>o.geometryType()],id:[Bn,[],o=>o.id()],zoom:[Mt,[],o=>o.globals.zoom],pitch:[Mt,[],o=>o.globals.pitch||0],"distance-from-center":[Mt,[],o=>o.distanceFromCenter()],"heatmap-density":[Mt,[],o=>o.globals.heatmapDensity||0],"line-progress":[Mt,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[Mt,[],o=>o.globals.skyRadialProgress||0],accumulated:[Bn,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[Mt,ja(Mt),(o,r)=>{let s=0;for(const c of r)s+=c.evaluate(o);return s}],"*":[Mt,ja(Mt),(o,r)=>{let s=1;for(const c of r)s*=c.evaluate(o);return s}],"-":{type:Mt,overloads:[[[Mt,Mt],(o,[r,s])=>r.evaluate(o)-s.evaluate(o)],[[Mt],(o,[r])=>-r.evaluate(o)]]},"/":[Mt,[Mt,Mt],(o,[r,s])=>r.evaluate(o)/s.evaluate(o)],"%":[Mt,[Mt,Mt],(o,[r,s])=>r.evaluate(o)%s.evaluate(o)],ln2:[Mt,[],()=>Math.LN2],pi:[Mt,[],()=>Math.PI],e:[Mt,[],()=>Math.E],"^":[Mt,[Mt,Mt],(o,[r,s])=>Math.pow(r.evaluate(o),s.evaluate(o))],sqrt:[Mt,[Mt],(o,[r])=>Math.sqrt(r.evaluate(o))],log10:[Mt,[Mt],(o,[r])=>Math.log(r.evaluate(o))/Math.LN10],ln:[Mt,[Mt],(o,[r])=>Math.log(r.evaluate(o))],log2:[Mt,[Mt],(o,[r])=>Math.log(r.evaluate(o))/Math.LN2],sin:[Mt,[Mt],(o,[r])=>Math.sin(r.evaluate(o))],cos:[Mt,[Mt],(o,[r])=>Math.cos(r.evaluate(o))],tan:[Mt,[Mt],(o,[r])=>Math.tan(r.evaluate(o))],asin:[Mt,[Mt],(o,[r])=>Math.asin(r.evaluate(o))],acos:[Mt,[Mt],(o,[r])=>Math.acos(r.evaluate(o))],atan:[Mt,[Mt],(o,[r])=>Math.atan(r.evaluate(o))],min:[Mt,ja(Mt),(o,r)=>Math.min(...r.map(s=>s.evaluate(o)))],max:[Mt,ja(Mt),(o,r)=>Math.max(...r.map(s=>s.evaluate(o)))],abs:[Mt,[Mt],(o,[r])=>Math.abs(r.evaluate(o))],round:[Mt,[Mt],(o,[r])=>{const s=r.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[Mt,[Mt],(o,[r])=>Math.floor(r.evaluate(o))],ceil:[Mt,[Mt],(o,[r])=>Math.ceil(r.evaluate(o))],"filter-==":[tn,[pn,Bn],(o,[r,s])=>o.properties()[r.value]===s.value],"filter-id-==":[tn,[Bn],(o,[r])=>o.id()===r.value],"filter-type-==":[tn,[pn],(o,[r])=>o.geometryType()===r.value],"filter-<":[tn,[pn,Bn],(o,[r,s])=>{const c=o.properties()[r.value],f=s.value;return typeof c==typeof f&&c<f}],"filter-id-<":[tn,[Bn],(o,[r])=>{const s=o.id(),c=r.value;return typeof s==typeof c&&s<c}],"filter->":[tn,[pn,Bn],(o,[r,s])=>{const c=o.properties()[r.value],f=s.value;return typeof c==typeof f&&c>f}],"filter-id->":[tn,[Bn],(o,[r])=>{const s=o.id(),c=r.value;return typeof s==typeof c&&s>c}],"filter-<=":[tn,[pn,Bn],(o,[r,s])=>{const c=o.properties()[r.value],f=s.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[tn,[Bn],(o,[r])=>{const s=o.id(),c=r.value;return typeof s==typeof c&&s<=c}],"filter->=":[tn,[pn,Bn],(o,[r,s])=>{const c=o.properties()[r.value],f=s.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[tn,[Bn],(o,[r])=>{const s=o.id(),c=r.value;return typeof s==typeof c&&s>=c}],"filter-has":[tn,[Bn],(o,[r])=>r.value in o.properties()],"filter-has-id":[tn,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[tn,[hi(pn)],(o,[r])=>r.value.indexOf(o.geometryType())>=0],"filter-id-in":[tn,[hi(Bn)],(o,[r])=>r.value.indexOf(o.id())>=0],"filter-in-small":[tn,[pn,hi(Bn)],(o,[r,s])=>s.value.indexOf(o.properties()[r.value])>=0],"filter-in-large":[tn,[pn,hi(Bn)],(o,[r,s])=>function(c,f,g,y){for(;g<=y;){const x=g+y>>1;if(f[x]===c)return!0;f[x]>c?y=x-1:g=x+1}return!1}(o.properties()[r.value],s.value,0,s.value.length-1)],all:{type:tn,overloads:[[[tn,tn],(o,[r,s])=>r.evaluate(o)&&s.evaluate(o)],[ja(tn),(o,r)=>{for(const s of r)if(!s.evaluate(o))return!1;return!0}]]},any:{type:tn,overloads:[[[tn,tn],(o,[r,s])=>r.evaluate(o)||s.evaluate(o)],[ja(tn),(o,r)=>{for(const s of r)if(s.evaluate(o))return!0;return!1}]]},"!":[tn,[tn],(o,[r])=>!r.evaluate(o)],"is-supported-script":[tn,[pn],(o,[r])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(r.evaluate(o))}],upcase:[pn,[pn],(o,[r])=>r.evaluate(o).toUpperCase()],downcase:[pn,[pn],(o,[r])=>r.evaluate(o).toLowerCase()],concat:[pn,ja(Bn),(o,r)=>r.map(s=>ii(s.evaluate(o))).join("")],"resolved-locale":[pn,[gn],(o,[r])=>r.evaluate(o).resolvedLocale()]});class Xc{constructor(r,s){var c;this.expression=r,this._warningHistory={},this._evaluator=new Jl,this._defaultValue=s?"color"===(c=s).type&&Ks(c.default)?new qn(0,0,0,0):"color"===c.type?qn.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(r,s,c,f,g,y,x,E){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,s,c,f,g,y,x,E){this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new _i(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function Cl(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in El}function Dl(o,r){const s=new ht(El,[],r?function(f){const g={color:wi,string:pn,number:Mt,enum:pn,boolean:tn,formatted:cs,resolvedImage:Cr};return"array"===f.type?hi(g[f.value]||Bn,f.length):g[f.type]}(r):void 0),c=s.parse(o,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return c?cd(new Xc(c,r)):Tl(s.errors)}class Kc{constructor(r,s){this.kind=r,this._styleExpression=s,this.isStateDependent="constant"!==r&&!Bi(s.expression)}evaluateWithoutErrorHandling(r,s,c,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,s,c,f,g,y)}evaluate(r,s,c,f,g,y){return this._styleExpression.evaluate(r,s,c,f,g,y)}}class Ku{constructor(r,s,c,f){this.kind=r,this.zoomStops=c,this._styleExpression=s,this.isStateDependent="camera"!==r&&!Bi(s.expression),this.interpolationType=f}evaluateWithoutErrorHandling(r,s,c,f,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,s,c,f,g,y)}evaluate(r,s,c,f,g,y){return this._styleExpression.evaluate(r,s,c,f,g,y)}interpolationFactor(r,s,c){return this.interpolationType?Hr.interpolationFactor(this.interpolationType,r,s,c):0}}function Yc(o,r){if("error"===(o=Dl(o,r)).result)return o;const s=o.value.expression,c=_r(s);if(!c&&!tc(r))return Tl([new Ln("","data expressions not supported")]);const f=pe(s,["zoom","pitch","distance-from-center"]);if(!f&&!zf(r))return Tl([new Ln("","zoom expressions not supported")]);const g=lo(s);return g||f?g instanceof Ln?Tl([g]):g instanceof Hr&&!ud(r)?Tl([new Ln("",'"interpolate" expressions cannot be used with this property')]):cd(g?new Ku(c?"camera":"composite",o.value,g.labels,g instanceof Hr?g.interpolation:void 0):new Kc(c?"constant":"source",o.value)):Tl([new Ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Jc{constructor(r,s){this._parameters=r,this._specification=s,tr(this,hd(this._parameters,this._specification))}static deserialize(r){return new Jc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function lo(o){let r=null;if(o instanceof ao)r=lo(o.result);else if(o instanceof Fs){for(const s of o.args)if(r=lo(s),r)break}else(o instanceof Mn||o instanceof Hr)&&o.input instanceof Se&&"zoom"===o.input.name&&(r=o);return r instanceof Ln||o.eachChild(s=>{const c=lo(s);c instanceof Ln?r=c:!r&&c?r=new Ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&c&&r!==c&&(r=new Ln("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class Ft{constructor(r,s,c,f){this.message=(r?`${r}: `:"")+c,f&&(this.identifier=f),null!=s&&s.__line__&&(this.line=s.__line__)}}function Zo(o){const r=o.key,s=o.value,c=o.valueSpec||{},f=o.objectElementValidators||{},g=o.style,y=o.styleSpec;let x=[];const E=fr(s);if("object"!==E)return[new Ft(r,s,`object expected, ${E} found`)];for(const D in s){const M=D.split(".")[0],A=c[M]||c["*"];let k;f[M]?k=f[M]:c[M]?k=Ei:f["*"]?k=f["*"]:c["*"]&&(k=Ei),k?x=x.concat(k({key:(r&&`${r}.`)+D,value:s[D],valueSpec:A,style:g,styleSpec:y,object:s,objectKey:D},s)):x.push(new Ft(r,s[D],`unknown property "${D}"`))}for(const D in c)f[D]||c[D].required&&void 0===c[D].default&&void 0===s[D]&&x.push(new Ft(r,s,`missing required property "${D}"`));return x}function Va(o){const r=o.value,s=o.valueSpec,c=o.style,f=o.styleSpec,g=o.key,y=o.arrayElementValidator||Ei;if("array"!==fr(r))return[new Ft(g,r,`array expected, ${fr(r)} found`)];if(s.length&&r.length!==s.length)return[new Ft(g,r,`array length ${s.length} expected, length ${r.length} found`)];if(s["min-length"]&&r.length<s["min-length"])return[new Ft(g,r,`array length at least ${s["min-length"]} expected, length ${r.length} found`)];let x={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};f.$version<7&&(x.function=s.function),"object"===fr(s.value)&&(x=s.value);let E=[];for(let D=0;D<r.length;D++)E=E.concat(y({array:r,arrayIndex:D,value:r[D],valueSpec:x,style:c,styleSpec:f,key:`${g}[${D}]`}));return E}function dd(o){const r=o.key,s=o.value,c=o.valueSpec;let f=fr(s);if("number"===f&&s!=s&&(f="NaN"),"number"!==f)return[new Ft(r,s,`number expected, ${f} found`)];if("minimum"in c){let g=c.minimum;if("array"===fr(c.minimum)&&(g=c.minimum[o.arrayIndex]),s<g)return[new Ft(r,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in c){let g=c.maximum;if("array"===fr(c.maximum)&&(g=c.maximum[o.arrayIndex]),s>g)return[new Ft(r,s,`${s} is greater than the maximum value ${g}`)]}return[]}function fd(o){const r=o.valueSpec,s=Gt(o.value.type);let c,f,g,y={};const x="categorical"!==s&&void 0===o.value.property,E=!x,D="array"===fr(o.value.stops)&&"array"===fr(o.value.stops[0])&&"object"===fr(o.value.stops[0][0]),M=Zo({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(F){if("identity"===s)return[new Ft(F.key,F.value,'identity function may not have a "stops" property')];let j=[];const q=F.value;return j=j.concat(Va({key:F.key,value:q,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:A})),"array"===fr(q)&&0===q.length&&j.push(new Ft(F.key,q,"array must have at least one stop")),j},default:function(F){return Ei({key:F.key,value:F.value,valueSpec:r,style:F.style,styleSpec:F.styleSpec})}}});return"identity"===s&&x&&M.push(new Ft(o.key,o.value,'missing required property "property"')),"identity"===s||o.value.stops||M.push(new Ft(o.key,o.value,'missing required property "stops"')),"exponential"===s&&o.valueSpec.expression&&!ud(o.valueSpec)&&M.push(new Ft(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(E&&!tc(o.valueSpec)?M.push(new Ft(o.key,o.value,"property functions not supported")):x&&!zf(o.valueSpec)&&M.push(new Ft(o.key,o.value,"zoom functions not supported"))),"categorical"!==s&&!D||void 0!==o.value.property||M.push(new Ft(o.key,o.value,'"property" property is required')),M;function A(F){let j=[];const q=F.value,ee=F.key;if("array"!==fr(q))return[new Ft(ee,q,`array expected, ${fr(q)} found`)];if(2!==q.length)return[new Ft(ee,q,`array length 2 expected, length ${q.length} found`)];if(D){if("object"!==fr(q[0]))return[new Ft(ee,q,`object expected, ${fr(q[0])} found`)];if(void 0===q[0].zoom)return[new Ft(ee,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new Ft(ee,q,"object stop key must have value")];const le=Gt(q[0].zoom);if("number"!=typeof le)return[new Ft(ee,q[0].zoom,"stop zoom values must be numbers")];if(g&&g>le)return[new Ft(ee,q[0].zoom,"stop zoom values must appear in ascending order")];le!==g&&(g=le,f=void 0,y={}),j=j.concat(Zo({key:`${ee}[0]`,value:q[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:dd,value:k}}))}else j=j.concat(k({key:`${ee}[0]`,value:q[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},q));return Cl(Wn(q[1]))?j.concat([new Ft(`${ee}[1]`,q[1],"expressions are not allowed in function stops.")]):j.concat(Ei({key:`${ee}[1]`,value:q[1],valueSpec:r,style:F.style,styleSpec:F.styleSpec}))}function k(F,j){const q=fr(F.value),ee=Gt(F.value),le=null!==F.value?F.value:j;if(c){if(q!==c)return[new Ft(F.key,le,`${q} stop domain type must match previous stop domain type ${c}`)]}else c=q;if("number"!==q&&"string"!==q&&"boolean"!==q&&"number"!=typeof ee&&"string"!=typeof ee&&"boolean"!=typeof ee)return[new Ft(F.key,le,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==s){let Ee=`number expected, ${q} found`;return tc(r)&&void 0===s&&(Ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ft(F.key,le,Ee)]}return"categorical"!==s||"number"!==q||"number"==typeof ee&&isFinite(ee)&&Math.floor(ee)===ee?"categorical"!==s&&"number"===q&&"number"==typeof ee&&"number"==typeof f&&void 0!==f&&ee<f?[new Ft(F.key,le,"stop domain values must appear in ascending order")]:(f=ee,"categorical"===s&&ee in y?[new Ft(F.key,le,"stop domain values must be unique")]:(y[ee]=!0,[])):[new Ft(F.key,le,`integer expected, found ${String(ee)}`)]}}function va(o){const r=("property"===o.expressionContext?Yc:Dl)(Wn(o.value),o.valueSpec);if("error"===r.result)return r.value.map(c=>new Ft(`${o.key}${c.key}`,o.value,c.message));const s=r.value.expression||r.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!s.outputDefined())return[new Ft(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!Bi(s))return[new Ft(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return Ys(s,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!pe(s,["zoom","feature-state"]))return[new Ft(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!_r(s))return[new Ft(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ys(o,r){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const f of r.valueSpec.expression.parameters)s.delete(f);if(0===s.size)return[];const c=[];return o instanceof Se&&s.has(o.name)?[new Ft(r.key,r.value,`["${o.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(o.eachChild(f=>{c.push(...Ys(f,r))}),c)}function $a(o){const r=o.key,s=o.value,c=o.valueSpec,f=[];return Array.isArray(c.values)?-1===c.values.indexOf(Gt(s))&&f.push(new Ft(r,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(c.values).indexOf(Gt(s))&&f.push(new Ft(r,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),f}function Ga(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const r of o.slice(1))if(!Ga(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function Pr(o,r="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ga(o)||(o=Yi(o));const s=o;let c=!0;try{c=function(D){if(!Ur(D))return D;let M=Wn(D);return pd(M),M=Qc(M),M}(s)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const f=$e[`filter_${r}`],g=Dl(c,f);let y=null;if("error"===g.result)throw new Error(g.value.map(D=>`${D.key}: ${D.message}`).join(", "));y=(D,M,A)=>g.value.evaluate(D,M,{},A);let x=null,E=null;if(c!==s){const D=Dl(s,f);if("error"===D.result)throw new Error(D.value.map(M=>`${M.key}: ${M.message}`).join(", "));x=(M,A,k,F,j)=>D.value.evaluate(M,A,{},k,void 0,void 0,F,j),E=!_r(D.value.expression)}return y=y,{filter:y,dynamicFilter:x||void 0,needGeometry:Ha(c),needFeature:!!E}}function Qc(o){if(!Array.isArray(o))return o;const r=function(s){if(md.has(s[0]))for(let c=1;c<s.length;c++)if(Ur(s[c]))return!0;return s}(o);return!0===r?r:r.map(s=>Qc(s))}function pd(o){let r=!1;const s=[];if("case"===o[0]){for(let c=1;c<o.length-1;c+=2)r=r||Ur(o[c]),s.push(o[c+1]);s.push(o[o.length-1])}else if("match"===o[0]){r=r||Ur(o[1]);for(let c=2;c<o.length-1;c+=2)s.push(o[c+1]);s.push(o[o.length-1])}else if("step"===o[0]){r=r||Ur(o[1]);for(let c=1;c<o.length-1;c+=2)s.push(o[c+1])}r&&(o.length=0,o.push("any",...s));for(let c=1;c<o.length;c++)pd(o[c])}function Ur(o){if(!Array.isArray(o))return!1;if("pitch"===(r=o[0])||"distance-from-center"===r)return!0;var r;for(let s=1;s<o.length;s++)if(Ur(o[s]))return!0;return!1}const md=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function gd(o,r){return o<r?-1:o>r?1:0}function Ha(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let r=1;r<o.length;r++)if(Ha(o[r]))return!0;return!1}function Yi(o){if(!o)return!0;const r=o[0];return o.length<=1?"any"!==r:"=="===r?nc(o[1],o[2],"=="):"!="===r?ji(nc(o[1],o[2],"==")):"<"===r||">"===r||"<="===r||">="===r?nc(o[1],o[2],r):"any"===r?(s=o.slice(1),["any"].concat(s.map(Yi))):"all"===r?["all"].concat(o.slice(1).map(Yi)):"none"===r?["all"].concat(o.slice(1).map(Yi).map(ji)):"in"===r?rc(o[1],o.slice(2)):"!in"===r?ji(rc(o[1],o.slice(2))):"has"===r?xa(o[1]):"!has"===r?ji(xa(o[1])):"within"!==r||o;var s}function nc(o,r,s){switch(o){case"$type":return[`filter-type-${s}`,r];case"$id":return[`filter-id-${s}`,r];default:return[`filter-${s}`,o,r]}}function rc(o,r){if(0===r.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(s=>typeof s!=typeof r[0])?["filter-in-large",o,["literal",r.sort(gd)]]:["filter-in-small",o,["literal",r]]}}function xa(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function ji(o){return["!",o]}function Js(o){return Ga(Wn(o.value))?va(tr({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):ic(o)}function ic(o){const r=o.value,s=o.key;if("array"!==fr(r))return[new Ft(s,r,`array expected, ${fr(r)} found`)];const c=o.styleSpec;let f,g=[];if(r.length<1)return[new Ft(s,r,"filter array must have at least 1 element")];switch(g=g.concat($a({key:`${s}[0]`,value:r[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Gt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Gt(r[1])&&g.push(new Ft(s,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&g.push(new Ft(s,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(f=fr(r[1]),"string"!==f&&g.push(new Ft(`${s}[1]`,r[1],`string expected, ${f} found`)));for(let y=2;y<r.length;y++)f=fr(r[y]),"$type"===Gt(r[1])?g=g.concat($a({key:`${s}[${y}]`,value:r[y],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&g.push(new Ft(`${s}[${y}]`,r[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<r.length;y++)g=g.concat(ic({key:`${s}[${y}]`,value:r[y],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":f=fr(r[1]),2!==r.length?g.push(new Ft(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==f&&g.push(new Ft(`${s}[1]`,r[1],`string expected, ${f} found`));break;case"within":f=fr(r[1]),2!==r.length?g.push(new Ft(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==f&&g.push(new Ft(`${s}[1]`,r[1],`object expected, ${f} found`))}return g}function Yu(o,r){const s=o.key,c=o.style,f=o.styleSpec,g=o.value,y=o.objectKey,x=f[`${r}_${o.layerType}`];if(!x)return[];const E=y.match(/^(.*)-transition$/);if("paint"===r&&E&&x[E[1]]&&x[E[1]].transition)return Ei({key:s,value:g,valueSpec:f.transition,style:c,styleSpec:f});const D=o.valueSpec||x[y];if(!D)return[new Ft(s,g,`unknown property "${y}"`)];let M;if("string"===fr(g)&&tc(D)&&!D.tokens&&(M=/^{([^}]+)}$/.exec(g)))return[new Ft(s,g,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const A=[];return"symbol"===o.layerType&&("text-field"===y&&c&&!c.glyphs&&A.push(new Ft(s,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&Ks(Wn(g))&&"identity"===Gt(g.type)&&A.push(new Ft(s,g,'"text-font" does not support identity functions'))),A.concat(Ei({key:o.key,value:g,valueSpec:D,style:c,styleSpec:f,expressionContext:"property",propertyType:r,propertyKey:y}))}function ds(o){return Yu(o,"paint")}function eu(o){return Yu(o,"layout")}function tu(o){let r=[];const s=o.value,c=o.key,f=o.style,g=o.styleSpec;s.type||s.ref||r.push(new Ft(c,s,'either "type" or "ref" is required'));let y=Gt(s.type);const x=Gt(s.ref);if(s.id){const E=Gt(s.id);for(let D=0;D<o.arrayIndex;D++){const M=f.layers[D];Gt(M.id)===E&&r.push(new Ft(c,s.id,`duplicate layer id "${s.id}", previously used at line ${M.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(D=>{D in s&&r.push(new Ft(c,s[D],`"${D}" is prohibited for ref layers`))}),f.layers.forEach(D=>{Gt(D.id)===x&&(E=D)}),E?E.ref?r.push(new Ft(c,s.ref,"ref cannot reference another ref layer")):y=Gt(E.type):"string"==typeof x&&r.push(new Ft(c,s.ref,`ref layer "${x}" not found`))}else if("background"!==y&&"sky"!==y)if(s.source){const E=f.sources&&f.sources[s.source],D=E&&Gt(E.type);E?"vector"===D&&"raster"===y?r.push(new Ft(c,s.source,`layer "${s.id}" requires a raster source`)):"raster"===D&&"raster"!==y?r.push(new Ft(c,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==D||s["source-layer"]?"raster-dem"===D&&"hillshade"!==y?r.push(new Ft(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!s.paint||!s.paint["line-gradient"]||"geojson"===D&&E.lineMetrics||r.push(new Ft(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Ft(c,s,`layer "${s.id}" must specify a "source-layer"`)):r.push(new Ft(c,s.source,`source "${s.source}" not found`))}else r.push(new Ft(c,s,'missing required property "source"'));return r=r.concat(Zo({key:c,value:s,valueSpec:g.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ei({key:`${c}.type`,value:s.type,valueSpec:g.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:E=>Js(tr({layerType:y},E)),layout:E=>Zo({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>eu(tr({layerType:y},D))}}),paint:E=>Zo({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>ds(tr({layerType:y},D))}})}})),r}function bn(o){const r=o.value,s=o.key,c=fr(r);return"string"!==c?[new Ft(s,r,`string expected, ${c} found`)]:[]}const jf={promoteId:function({key:o,value:r}){if("string"===fr(r))return bn({key:o,value:r});{const s=[];for(const c in r)s.push(...bn({key:`${o}.${c}`,value:r[c]}));return s}}};function _d(o){const r=o.value,s=o.key,c=o.styleSpec,f=o.style;if(!r.type)return[new Ft(s,r,'"type" is required')];const g=Gt(r.type);let y;switch(g){case"vector":case"raster":case"raster-dem":return y=Zo({key:s,value:r,valueSpec:c[`source_${g.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:jf}),y;case"geojson":if(y=Zo({key:s,value:r,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:jf}),r.cluster)for(const x in r.clusterProperties){const[E,D]=r.clusterProperties[x],M="string"==typeof E?[E,["accumulated"],["get",x]]:E;y.push(...va({key:`${s}.${x}.map`,value:D,expressionContext:"cluster-map"})),y.push(...va({key:`${s}.${x}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return y;case"video":return Zo({key:s,value:r,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return Zo({key:s,value:r,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new Ft(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $a({key:`${s}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:c})}}function yd(o){const r=o.value,s=o.styleSpec,c=s.light,f=o.style;let g=[];const y=fr(r);if(void 0===r)return g;if("object"!==y)return g=g.concat([new Ft("light",r,`object expected, ${y} found`)]),g;for(const x in r){const E=x.match(/^(.*)-transition$/);g=g.concat(E&&c[E[1]]&&c[E[1]].transition?Ei({key:x,value:r[x],valueSpec:s.transition,style:f,styleSpec:s}):c[x]?Ei({key:x,value:r[x],valueSpec:c[x],style:f,styleSpec:s}):[new Ft(x,r[x],`unknown property "${x}"`)])}return g}function vd(o){const r=o.value,s=o.key,c=o.style,f=o.styleSpec,g=f.terrain;let y=[];const x=fr(r);if(void 0===r)return y;if("object"!==x)return y=y.concat([new Ft("terrain",r,`object expected, ${x} found`)]),y;for(const E in r){const D=E.match(/^(.*)-transition$/);y=y.concat(D&&g[D[1]]&&g[D[1]].transition?Ei({key:E,value:r[E],valueSpec:f.transition,style:c,styleSpec:f}):g[E]?Ei({key:E,value:r[E],valueSpec:g[E],style:c,styleSpec:f}):[new Ft(E,r[E],`unknown property "${E}"`)])}if(r.source){const E=c.sources&&c.sources[r.source],D=E&&Gt(E.type);E?"raster-dem"!==D&&y.push(new Ft(s,r.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):y.push(new Ft(s,r.source,`source "${r.source}" not found`))}else y.push(new Ft(s,r,'terrain is missing required property "source"'));return y}function Ju(o){const r=o.value,s=o.style,c=o.styleSpec,f=c.fog;let g=[];const y=fr(r);if(void 0===r)return g;if("object"!==y)return g=g.concat([new Ft("fog",r,`object expected, ${y} found`)]),g;for(const x in r){const E=x.match(/^(.*)-transition$/);g=g.concat(E&&f[E[1]]&&f[E[1]].transition?Ei({key:x,value:r[x],valueSpec:c.transition,style:s,styleSpec:c}):f[x]?Ei({key:x,value:r[x],valueSpec:f[x],style:s,styleSpec:c}):[new Ft(x,r[x],`unknown property "${x}"`)])}return g}const oc={"*":()=>[],array:Va,boolean:function(o){const r=o.value,s=o.key,c=fr(r);return"boolean"!==c?[new Ft(s,r,`boolean expected, ${c} found`)]:[]},number:dd,color:function(o){const r=o.key,s=o.value,c=fr(s);return"string"!==c?[new Ft(r,s,`color expected, ${c} found`)]:null===Xs.parseCSSColor(s)?[new Ft(r,s,`color expected, "${s}" found`)]:[]},enum:$a,filter:Js,function:fd,layer:tu,object:Zo,source:_d,light:yd,terrain:vd,fog:Ju,string:bn,formatted:function(o){return 0===bn(o).length?[]:va(o)},resolvedImage:function(o){return 0===bn(o).length?[]:va(o)},projection:function(o){const r=o.value,s=o.styleSpec,c=s.projection,f=o.style;let g=[];const y=fr(r);if("object"===y)for(const x in r)g=g.concat(Ei({key:x,value:r[x],valueSpec:c[x],style:f,styleSpec:s}));else"string"!==y&&(g=g.concat([new Ft("projection",r,`object or string expected, ${y} found`)]));return g}};function Ei(o){const r=o.value,s=o.valueSpec,c=o.styleSpec;return s.expression&&Ks(Gt(r))?fd(o):s.expression&&Cl(Wn(r))?va(o):s.type&&oc[s.type]?oc[s.type](o):Zo(tr({},o,{valueSpec:s.type?c[s.type]:s}))}function ft(o){const r=o.value,s=o.key,c=bn(o);return c.length||(-1===r.indexOf("{fontstack}")&&c.push(new Ft(s,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&c.push(new Ft(s,r,'"glyphs" url must include a "{range}" token'))),c}function rr(o,r=$e){return zs(Ei({key:"",value:o,valueSpec:r.$root,styleSpec:r,style:o,objectElementValidators:{glyphs:ft,"*":()=>[]}}))}const Uf=o=>zs(ds(o)),Ti=o=>zs(eu(o));function zs(o){return o.slice().sort((r,s)=>r.line&&s.line?r.line-s.line:0)}function Sl(o,r){let s=!1;if(r&&r.length)for(const c of r)o.fire(new Xt(new Error(c.message))),s=!0;return s}var Ui=Wo;function Wo(o,r,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var f=new Int32Array(this.arrayBuffer);o=f[0],this.d=(r=f[1])+2*(s=f[2]);for(var g=0;g<this.d*this.d;g++){var y=f[3+g],x=f[3+g+1];c.push(y===x?null:f.subarray(y,x))}var E=f[3+c.length+1];this.keys=f.subarray(f[3+c.length],E),this.bboxes=f.subarray(E),this.insert=this._insertReadonly}else{this.d=r+2*s;for(var D=0;D<this.d*this.d;D++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=o,this.padding=s,this.scale=r/o,this.uid=0;var M=s/r*o;this.min=-M,this.max=o+M}Wo.prototype.insert=function(o,r,s,c,f){this._forEachCell(r,s,c,f,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(f)},Wo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Wo.prototype._insertCell=function(o,r,s,c,f,g){this.cells[f].push(g)},Wo.prototype.query=function(o,r,s,c,f){var g=this.min,y=this.max;if(o<=g&&r<=g&&y<=s&&y<=c&&!f)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(o,r,s,c,this._queryCell,x,{},f),x},Wo.prototype._queryCell=function(o,r,s,c,f,g,y,x){var E=this.cells[f];if(null!==E)for(var D=this.keys,M=this.bboxes,A=0;A<E.length;A++){var k=E[A];if(void 0===y[k]){var F=4*k;(x?x(M[F+0],M[F+1],M[F+2],M[F+3]):o<=M[F+2]&&r<=M[F+3]&&s>=M[F+0]&&c>=M[F+1])?(y[k]=!0,g.push(D[k])):y[k]=!1}}},Wo.prototype._forEachCell=function(o,r,s,c,f,g,y,x){for(var E=this._convertToCellCoord(o),D=this._convertToCellCoord(r),M=this._convertToCellCoord(s),A=this._convertToCellCoord(c),k=E;k<=M;k++)for(var F=D;F<=A;F++){var j=this.d*F+k;if((!x||x(this._convertFromCellCoord(k),this._convertFromCellCoord(F),this._convertFromCellCoord(k+1),this._convertFromCellCoord(F+1)))&&f.call(this,o,r,s,c,j,g,y,x))return}},Wo.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Wo.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Wo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,r=3+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var f=new Int32Array(r+s+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=r,y=0;y<o.length;y++){var x=o[y];f[3+y]=g,f.set(x,g),g+=x.length}return f[3+o.length]=g,f.set(this.keys,g),f[3+o.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer};const Qs={};function Vt(o,r={}){Qs[o.name]={klass:o,omit:r.omit||[]}}Vt(Object),Ui.serialize=function(o,r){const s=o.toArrayBuffer();return r&&r.push(s),{buffer:s}},Ui.deserialize=function(o){return new Ui(o.buffer)},Object.defineProperty(Ui,"name",{value:"Grid"}),Vt(Ui),Vt(qn),Vt(Error),Vt(z),Vt(Ar),Vt(Jc),Vt(Xc,{omit:["_evaluator"]}),Vt(Ku),Vt(Kc),Vt(Se,{omit:["_evaluate"]});for(const o in El)Qs[El[o].name]||Vt(El[o]);function xd(o){return o&&"undefined"!=typeof ArrayBuffer&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function qa(o){return W.ImageBitmap&&o instanceof W.ImageBitmap}function ba(o,r){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(xd(o)||qa(o))return r&&r.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return r&&r.push(s.buffer),s}if(o instanceof W.ImageData)return r&&r.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const c of o)s.push(ba(c,r));return s}if("object"==typeof o){const s=o.constructor,c=s.name;if(!Qs[c])throw new Error(`can't serialize object of unregistered class ${c}`);const f=s.serialize?s.serialize(o,r):{};if(!s.serialize){for(const g in o)o.hasOwnProperty(g)&&(Qs[c].omit.indexOf(g)>=0||(f[g]=ba(o[g],r)));o instanceof Error&&(f.message=o.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof o)}function vi(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||xd(o)||qa(o)||ArrayBuffer.isView(o)||o instanceof W.ImageData)return o;if(Array.isArray(o))return o.map(vi);if("object"==typeof o){const r=o.$name||"Object",{klass:s}=Qs[r];if(!s)throw new Error(`can't deserialize unregistered class ${r}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const f of Object.keys(o))"$name"!==f&&(c[f]=vi(o[f]));return c}throw new Error("can't deserialize object of type "+typeof o)}class fs{constructor(){this.first=!0}update(r,s){const c=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=c,!0))}}const Qu=o=>o>=1536&&o<=1791,ea=o=>o>=1872&&o<=1919,Oo=o=>o>=2208&&o<=2303,eh=o=>o>=11904&&o<=12031,th=o=>o>=12032&&o<=12255,nh=o=>o>=12272&&o<=12287,nu=o=>o>=12288&&o<=12351,Za=o=>o>=12352&&o<=12447,Il=o=>o>=12448&&o<=12543,rh=o=>o>=12544&&o<=12591,ru=o=>o>=12704&&o<=12735,bd=o=>o>=12736&&o<=12783,iu=o=>o>=12784&&o<=12799,sc=o=>o>=12800&&o<=13055,ih=o=>o>=13056&&o<=13311,oh=o=>o>=13312&&o<=19903,ou=o=>o>=19968&&o<=40959,sh=o=>o>=40960&&o<=42127,ac=o=>o>=42128&&o<=42191,wd=o=>o>=44032&&o<=55215,lc=o=>o>=63744&&o<=64255,Vi=o=>o>=64336&&o<=65023,ta=o=>o>=65040&&o<=65055,Vr=o=>o>=65072&&o<=65103,Ed=o=>o>=65104&&o<=65135,su=o=>o>=65136&&o<=65279,ah=o=>o>=65280&&o<=65519;function au(o){for(const r of o)if(Wa(r.charCodeAt(0)))return!0;return!1}function Td(o){for(const r of o)if(!Cd(r.charCodeAt(0)))return!1;return!0}function Cd(o){return!(Qu(o)||ea(o)||Oo(o)||Vi(o)||su(o))}function Wa(o){return!(746!==o&&747!==o&&(o<4352||!(ru(o)||rh(o)||Vr(o)&&!(o>=65097&&o<=65103)||lc(o)||ih(o)||eh(o)||bd(o)||!(!nu(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||oh(o)||ou(o)||sc(o)||(r=o,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(o)||(r=>r>=55216&&r<=55295)(o)||(r=>r>=4352&&r<=4607)(o)||wd(o)||Za(o)||nh(o)||(r=>r>=12688&&r<=12703)(o)||th(o)||iu(o)||Il(o)&&12540!==o||!(!ah(o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!Ed(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(r=>r>=5120&&r<=5759)(o)||(r=>r>=6320&&r<=6399)(o)||ta(o)||(r=>r>=19904&&r<=19967)(o)||sh(o)||ac(o))));var r}function Xa(o){return!(Wa(o)||(r=o,(s=r)>=128&&s<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(s=>s>=8192&&s<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(s=>s>=8448&&s<=8527)(r)||(s=>s>=8528&&s<=8591)(r)||(s=>s>=8960&&s<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(s=>s>=9216&&s<=9279)(r)&&9251!==r||(s=>s>=9280&&s<=9311)(r)||(s=>s>=9312&&s<=9471)(r)||(s=>s>=9632&&s<=9727)(r)||(s=>s>=9728&&s<=9983)(r)&&!(r>=9754&&r<=9759)||(s=>s>=11008&&s<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||nu(r)||Il(r)||(s=>s>=57344&&s<=63743)(r)||Vr(r)||Ed(r)||ah(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,s}function Ka(o){return o>=1424&&o<=2303||Vi(o)||su(o)}function lh(o,r){return!(!r&&Ka(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(s=o,s>=6016&&s<=6143));var s}function Dd(o){for(const r of o)if(Ka(r.charCodeAt(0)))return!0;return!1}const ch="deferred",Xo="loading",Ya="loaded";let uh=null,bo="unavailable",$i=null;const Ja=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(bo="error"),uh&&uh(o)};function Qa(){hh.fire(new Wt("pluginStateChange",{pluginStatus:bo,pluginURL:$i}))}const hh=new nn,dh=function(){return bo},cc=function(){if(bo!==ch||!$i)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bo=Xo,Qa(),$i&&se({url:$i},o=>{o?Ja(o):(bo=Ya,Qa())})},co={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bo===Ya||null!=co.applyArabicShaping,isLoading:()=>bo===Xo,setState(o){bo=o.pluginStatus,$i=o.pluginURL},isParsed:()=>null!=co.applyArabicShaping&&null!=co.processBidirectionalText&&null!=co.processStyledBidirectionalText,getPluginURL:()=>$i};class kr{constructor(r,s){this.zoom=r,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new fs,this.transition={},this.pitch=0)}isSupportedScript(r){return function(s,c){for(const f of s)if(!lh(f.charCodeAt(0),c))return!1;return!0}(r,co.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,s=r-Math.floor(r),c=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class el{constructor(r,s){this.property=r,this.value=s,this.expression=function(c,f){if(Ks(c))return new Jc(c,f);if(Cl(c)){const g=Yc(c,f);if("error"===g.result)throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=c;return"string"==typeof c&&"color"===f.type&&(g=qn.parse(c)),{kind:"constant",evaluate:()=>g}}}(void 0===s?r.specification.default:s,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,s,c){return this.property.possiblyEvaluate(this,r,s,c)}}class na{constructor(r){this.property=r,this.value=new el(r,void 0)}transitioned(r,s){return new i(this.property,this.value,s,rt({},r.transition,this.transition),r.now)}untransitioned(){return new i(this.property,this.value,null,{},0)}}class p{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return sn(this._values[r].value.value)}setValue(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new na(this._values[r].property)),this._values[r].value=new el(this._values[r].property,null===s?void 0:sn(s))}getTransition(r){return sn(this._values[r].transition)}setTransition(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new na(this._values[r].property)),this._values[r].transition=sn(s)||void 0}serialize(){const r={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(r[s]=c);const f=this.getTransition(s);void 0!==f&&(r[`${s}-transition`]=f)}return r}transitioned(r,s){const c=new d(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(r,s._values[f]);return c}untransitioned(){const r=new d(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].untransitioned();return r}}class i{constructor(r,s,c,f,g){const y=f.delay||0,x=f.duration||0;g=g||0,this.property=r,this.value=s,this.begin=g+y,this.end=this.begin+x,r.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(r,s,c){const f=r.now||0,g=this.value.possiblyEvaluate(r,s,c),y=this.prior;if(y){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return y.possiblyEvaluate(r,s,c);{const x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,s,c),g,Q(x))}}return g}}class d{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,s,c){const f=new w(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(r,s,c);return f}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class _{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return sn(this._values[r].value)}setValue(r,s){this._values[r]=new el(this._values[r].property,null===s?void 0:sn(s))}serialize(){const r={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(r[s]=c)}return r}possiblyEvaluate(r,s,c){const f=new w(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(r,s,c);return f}}class b{constructor(r,s,c){this.property=r,this.value=s,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,s,c,f){return this.property.evaluate(this.value,this.parameters,r,s,c,f)}}class w{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class C{constructor(r){this.specification=r}possiblyEvaluate(r,s){return r.expression.evaluate(s)}interpolate(r,s,c){const f=nr[this.specification.type];return f?f(r,s,c):r}}class S{constructor(r,s){this.specification=r,this.overrides=s}possiblyEvaluate(r,s,c,f){return new b(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(s,null,{},c,f)}:r.expression,s)}interpolate(r,s,c){if("constant"!==r.value.kind||"constant"!==s.value.kind)return r;if(void 0===r.value.value||void 0===s.value.value)return new b(this,{kind:"constant",value:void 0},r.parameters);const f=nr[this.specification.type];return f?new b(this,{kind:"constant",value:f(r.value.value,s.value.value,c)},r.parameters):r}evaluate(r,s,c,f,g,y){return"constant"===r.kind?r.value:r.evaluate(s,c,f,g,y)}}class P extends S{possiblyEvaluate(r,s,c,f){if(void 0===r.value)return new b(this,{kind:"constant",value:void 0},s);if("constant"===r.expression.kind){const g=r.expression.evaluate(s,null,{},c,f),y="resolvedImage"===r.property.specification.type&&"string"!=typeof g?g.name:g,x=this._calculate(y,y,y,s);return new b(this,{kind:"constant",value:x},s)}if("camera"===r.expression.kind){const g=this._calculate(r.expression.evaluate({zoom:s.zoom-1}),r.expression.evaluate({zoom:s.zoom}),r.expression.evaluate({zoom:s.zoom+1}),s);return new b(this,{kind:"constant",value:g},s)}return new b(this,r.expression,s)}evaluate(r,s,c,f,g,y){if("source"===r.kind){const x=r.evaluate(s,c,f,g,y);return this._calculate(x,x,x,s)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(s.zoom)-1},c,f),r.evaluate({zoom:Math.floor(s.zoom)},c,f),r.evaluate({zoom:Math.floor(s.zoom)+1},c,f),s):r.value}_calculate(r,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:r,to:s,other:c}:{from:c,to:s,other:r}}interpolate(r){return r}}class R{constructor(r){this.specification=r}possiblyEvaluate(r,s,c,f){if(void 0!==r.value){if("constant"===r.expression.kind){const g=r.expression.evaluate(s,null,{},c,f);return this._calculate(g,g,g,s)}return this._calculate(r.expression.evaluate(new kr(Math.floor(s.zoom-1),s)),r.expression.evaluate(new kr(Math.floor(s.zoom),s)),r.expression.evaluate(new kr(Math.floor(s.zoom+1),s)),s)}}_calculate(r,s,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:r,to:s}:{from:c,to:s}}interpolate(r){return r}}class L{constructor(r){this.specification=r}possiblyEvaluate(r,s,c,f){return!!r.expression.evaluate(s,null,{},c,f)}interpolate(){return!1}}class B{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in r){const c=r[s];c.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new el(c,void 0),g=this.defaultTransitionablePropertyValues[s]=new na(c);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate({})}}}function H(o,r){return 256*(o=J(Math.floor(o),0,255))+J(Math.floor(r),0,255)}Vt(S),Vt(C),Vt(P),Vt(R),Vt(L);const te={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class X{constructor(r,s){this._structArray=r,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class G{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,s){return r._trim(),s&&(r.isTransferred=!0,s.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const s=Object.create(this.prototype);return s.arrayBuffer=r.arrayBuffer,s.length=r.length,s.capacity=r.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ge(o,r=1){let s=0,c=0;return{members:o.map(f=>{const g=te[f.type].BYTES_PER_ELEMENT,y=s=ae(s,Math.max(r,g)),x=f.components||1;return c=Math.max(c,g),s+=g*x,{name:f.name,type:f.type,components:x,offset:y}}),size:ae(s,Math.max(c,r)),alignment:r}}function ae(o,r){return Math.ceil(o/r)*r}class fe extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s){const c=this.length;return this.resize(c+1),this.emplace(c,r,s)}emplace(r,s,c){const f=2*r;return this.int16[f+0]=s,this.int16[f+1]=c,r}}fe.prototype.bytesPerElement=4,Vt(fe);class _e extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,r,s,c)}emplace(r,s,c,f){const g=3*r;return this.int16[g+0]=s,this.int16[g+1]=c,this.int16[g+2]=f,r}}_e.prototype.bytesPerElement=6,Vt(_e);class ve extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,c,f)}emplace(r,s,c,f,g){const y=4*r;return this.int16[y+0]=s,this.int16[y+1]=c,this.int16[y+2]=f,this.int16[y+3]=g,r}}ve.prototype.bytesPerElement=8,Vt(ve);class he extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,c,f,g,y,x)}emplace(r,s,c,f,g,y,x,E){const D=6*r,M=12*r,A=3*r;return this.int16[D+0]=s,this.int16[D+1]=c,this.uint8[M+4]=f,this.uint8[M+5]=g,this.uint8[M+6]=y,this.uint8[M+7]=x,this.float32[A+2]=E,r}}he.prototype.bytesPerElement=12,Vt(he);class Ce extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,r,s,c)}emplace(r,s,c,f){const g=3*r;return this.float32[g+0]=s,this.float32[g+1]=c,this.float32[g+2]=f,r}}Ce.prototype.bytesPerElement=12,Vt(Ce);class Ue extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y,x,E,D,M){const A=this.length;return this.resize(A+1),this.emplace(A,r,s,c,f,g,y,x,E,D,M)}emplace(r,s,c,f,g,y,x,E,D,M,A){const k=10*r;return this.uint16[k+0]=s,this.uint16[k+1]=c,this.uint16[k+2]=f,this.uint16[k+3]=g,this.uint16[k+4]=y,this.uint16[k+5]=x,this.uint16[k+6]=E,this.uint16[k+7]=D,this.uint16[k+8]=M,this.uint16[k+9]=A,r}}Ue.prototype.bytesPerElement=20,Vt(Ue);class We extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y,x,E){const D=this.length;return this.resize(D+1),this.emplace(D,r,s,c,f,g,y,x,E)}emplace(r,s,c,f,g,y,x,E,D){const M=8*r;return this.uint16[M+0]=s,this.uint16[M+1]=c,this.uint16[M+2]=f,this.uint16[M+3]=g,this.uint16[M+4]=y,this.uint16[M+5]=x,this.uint16[M+6]=E,this.uint16[M+7]=D,r}}We.prototype.bytesPerElement=16,Vt(We);class et extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,s,c,f,g,y)}emplace(r,s,c,f,g,y,x){const E=6*r;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=f,this.int16[E+3]=g,this.int16[E+4]=y,this.int16[E+5]=x,r}}et.prototype.bytesPerElement=12,Vt(et);class Je extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y,x,E,D,M,A,k,F,j,q,ee){const le=this.length;return this.resize(le+1),this.emplace(le,r,s,c,f,g,y,x,E,D,M,A,k,F,j,q,ee)}emplace(r,s,c,f,g,y,x,E,D,M,A,k,F,j,q,ee,le){const Ee=16*r;return this.int16[Ee+0]=s,this.int16[Ee+1]=c,this.int16[Ee+2]=f,this.int16[Ee+3]=g,this.uint16[Ee+4]=y,this.uint16[Ee+5]=x,this.uint16[Ee+6]=E,this.uint16[Ee+7]=D,this.int16[Ee+8]=M,this.int16[Ee+9]=A,this.int16[Ee+10]=k,this.int16[Ee+11]=F,this.int16[Ee+12]=j,this.int16[Ee+13]=q,this.int16[Ee+14]=ee,this.int16[Ee+15]=le,r}}Je.prototype.bytesPerElement=32,Vt(Je);class Dt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint32[1*r+0]=s,r}}Dt.prototype.bytesPerElement=4,Vt(Dt);class je extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y,x,E,D,M,A,k,F){const j=this.length;return this.resize(j+1),this.emplace(j,r,s,c,f,g,y,x,E,D,M,A,k,F)}emplace(r,s,c,f,g,y,x,E,D,M,A,k,F,j){const q=20*r,ee=10*r;return this.int16[q+0]=s,this.int16[q+1]=c,this.int16[q+2]=f,this.int16[q+3]=g,this.int16[q+4]=y,this.float32[ee+3]=x,this.float32[ee+4]=E,this.float32[ee+5]=D,this.float32[ee+6]=M,this.int16[q+14]=A,this.uint32[ee+8]=k,this.uint16[q+18]=F,this.uint16[q+19]=j,r}}je.prototype.bytesPerElement=40,Vt(je);class yt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,c,f,g,y,x)}emplace(r,s,c,f,g,y,x,E){const D=8*r;return this.int16[D+0]=s,this.int16[D+1]=c,this.int16[D+2]=f,this.int16[D+4]=g,this.int16[D+5]=y,this.int16[D+6]=x,this.int16[D+7]=E,r}}yt.prototype.bytesPerElement=16,Vt(yt);class xt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,c,f,g)}emplace(r,s,c,f,g,y){const x=4*r,E=8*r;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=f,this.int16[E+6]=g,this.int16[E+7]=y,r}}xt.prototype.bytesPerElement=16,Vt(xt);class Ht extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,c,f)}emplace(r,s,c,f,g){const y=12*r,x=3*r;return this.uint8[y+0]=s,this.uint8[y+1]=c,this.float32[x+1]=f,this.float32[x+2]=g,r}}Ht.prototype.bytesPerElement=12,Vt(Ht);class Ke extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c){const f=this.length;return this.resize(f+1),this.emplace(f,r,s,c)}emplace(r,s,c,f){const g=3*r;return this.uint16[g+0]=s,this.uint16[g+1]=c,this.uint16[g+2]=f,r}}Ke.prototype.bytesPerElement=6,Vt(Ke);class Kt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y,x,E,D,M,A,k,F,j,q,ee,le,Ee,Pe,Re,Le){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,r,s,c,f,g,y,x,E,D,M,A,k,F,j,q,ee,le,Ee,Pe,Re,Le)}emplace(r,s,c,f,g,y,x,E,D,M,A,k,F,j,q,ee,le,Ee,Pe,Re,Le,Fe){const Ye=30*r,Qe=15*r,at=60*r;return this.int16[Ye+0]=s,this.int16[Ye+1]=c,this.int16[Ye+2]=f,this.float32[Qe+2]=g,this.float32[Qe+3]=y,this.uint16[Ye+8]=x,this.uint16[Ye+9]=E,this.uint32[Qe+5]=D,this.uint32[Qe+6]=M,this.uint32[Qe+7]=A,this.uint16[Ye+16]=k,this.uint16[Ye+17]=F,this.uint16[Ye+18]=j,this.float32[Qe+10]=q,this.float32[Qe+11]=ee,this.uint8[at+48]=le,this.uint8[at+49]=Ee,this.uint8[at+50]=Pe,this.uint32[Qe+13]=Re,this.int16[Ye+28]=Le,this.uint8[at+58]=Fe,r}}Kt.prototype.bytesPerElement=60,Vt(Kt);class Qt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y,x,E,D,M,A,k,F,j,q,ee,le,Ee,Pe,Re,Le,Fe,Ye,Qe,at,dt,qe,tt,pt,Ct){const wt=this.length;return this.resize(wt+1),this.emplace(wt,r,s,c,f,g,y,x,E,D,M,A,k,F,j,q,ee,le,Ee,Pe,Re,Le,Fe,Ye,Qe,at,dt,qe,tt,pt,Ct)}emplace(r,s,c,f,g,y,x,E,D,M,A,k,F,j,q,ee,le,Ee,Pe,Re,Le,Fe,Ye,Qe,at,dt,qe,tt,pt,Ct,wt){const St=38*r,_n=19*r;return this.int16[St+0]=s,this.int16[St+1]=c,this.int16[St+2]=f,this.float32[_n+2]=g,this.float32[_n+3]=y,this.int16[St+8]=x,this.int16[St+9]=E,this.int16[St+10]=D,this.int16[St+11]=M,this.int16[St+12]=A,this.int16[St+13]=k,this.uint16[St+14]=F,this.uint16[St+15]=j,this.uint16[St+16]=q,this.uint16[St+17]=ee,this.uint16[St+18]=le,this.uint16[St+19]=Ee,this.uint16[St+20]=Pe,this.uint16[St+21]=Re,this.uint16[St+22]=Le,this.uint16[St+23]=Fe,this.uint16[St+24]=Ye,this.uint16[St+25]=Qe,this.uint16[St+26]=at,this.uint16[St+27]=dt,this.uint16[St+28]=qe,this.uint32[_n+15]=tt,this.float32[_n+16]=pt,this.float32[_n+17]=Ct,this.float32[_n+18]=wt,r}}Qt.prototype.bytesPerElement=76,Vt(Qt);class jt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.float32[1*r+0]=s,r}}jt.prototype.bytesPerElement=4,Vt(jt);class qt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,c,f,g,y,x)}emplace(r,s,c,f,g,y,x,E){const D=7*r;return this.float32[D+0]=s,this.float32[D+1]=c,this.float32[D+2]=f,this.float32[D+3]=g,this.float32[D+4]=y,this.float32[D+5]=x,this.float32[D+6]=E,r}}qt.prototype.bytesPerElement=28,Vt(qt);class an extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,c,f,g)}emplace(r,s,c,f,g,y){const x=5*r;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=f,this.float32[x+3]=g,this.float32[x+4]=y,r}}an.prototype.bytesPerElement=20,Vt(an);class En extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,c,f)}emplace(r,s,c,f,g){const y=6*r;return this.uint32[3*r+0]=s,this.uint16[y+2]=c,this.uint16[y+3]=f,this.uint16[y+4]=g,r}}En.prototype.bytesPerElement=12,Vt(En);class en extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s){const c=this.length;return this.resize(c+1),this.emplace(c,r,s)}emplace(r,s,c){const f=2*r;return this.uint16[f+0]=s,this.uint16[f+1]=c,r}}en.prototype.bytesPerElement=4,Vt(en);class vn extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint16[1*r+0]=s,r}}vn.prototype.bytesPerElement=2,Vt(vn);class Yt extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s){const c=this.length;return this.resize(c+1),this.emplace(c,r,s)}emplace(r,s,c){const f=2*r;return this.float32[f+0]=s,this.float32[f+1]=c,r}}Yt.prototype.bytesPerElement=8,Vt(Yt);class ri extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,c,f)}emplace(r,s,c,f,g){const y=4*r;return this.float32[y+0]=s,this.float32[y+1]=c,this.float32[y+2]=f,this.float32[y+3]=g,r}}ri.prototype.bytesPerElement=16,Vt(ri);class uo extends G{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,f,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,c,f,g,y,x)}emplace(r,s,c,f,g,y,x,E){const D=8*r,M=4*r;return this.int16[D+0]=s,this.int16[D+1]=c,this.int16[D+2]=f,this.int16[D+3]=g,this.int16[D+4]=y,this.int16[D+5]=x,this.float32[M+3]=E,r}}uo.prototype.bytesPerElement=16,Vt(uo);class ho extends X{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ho.prototype.size=12;class Ko extends et{get(r){return new ho(this,r)}}Vt(Ko);class Ns extends X{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ns.prototype.size=40;class wa extends je{get(r){return new Ns(this,r)}}Vt(wa);class tl extends X{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}tl.prototype.size=60;class Lo extends Kt{get(r){return new tl(this,r)}}Vt(Lo);class oi extends X{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}oi.prototype.size=76;class Zn extends Qt{get(r){return new oi(this,r)}}Vt(Zn);class sr extends jt{getoffsetX(r){return this.float32[1*r+0]}}Vt(sr);class Kr extends _e{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Vt(Kr);class Yo extends X{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Yo.prototype.size=12;class Yr extends En{get(r){return new Yo(this,r)}}Vt(Yr);class si extends X{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}si.prototype.size=4;class wo extends en{get(r){return new si(this,r)}}Vt(wo);class Eo extends X{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}Eo.prototype.size=16;class Bs extends uo{get(r){return new Eo(this,r)}}Vt(Bs);const Ml=ge([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),lu=ge([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Al=As(function(o){o.exports=function(r,s){var c,f,g,y,x,E,D,M;for(f=r.length-(c=3&r.length),g=s,x=3432918353,E=461845907,M=0;M<f;)D=255&r.charCodeAt(M)|(255&r.charCodeAt(++M))<<8|(255&r.charCodeAt(++M))<<16|(255&r.charCodeAt(++M))<<24,++M,g=27492+(65535&(y=5*(65535&(g=(g^=D=(65535&(D=(D=(65535&D)*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*E+(((D>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(D=0,c){case 3:D^=(255&r.charCodeAt(M+2))<<16;case 2:D^=(255&r.charCodeAt(M+1))<<8;case 1:g^=D=(65535&(D=(D=(65535&(D^=255&r.charCodeAt(M)))*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*E+(((D>>>16)*E&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),Vf=As(function(o){o.exports=function(r,s){for(var c,f=r.length,g=s^f,y=0;f>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:g^=(255&r.charCodeAt(y+2))<<16;case 2:g^=(255&r.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),nl=Al,Sd=Vf;nl.murmur3=Al,nl.murmur2=Sd;class fh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,s,c,f){this.ids.push(Jo(r)),this.positions.push(s,c,f)}getPositions(r){const s=Jo(r);let c=0,f=this.ids.length-1;for(;c<f;){const y=c+f>>1;this.ids[y]>=s?f=y:c=y+1}const g=[];for(;this.ids[c]===s;)g.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return g}static serialize(r,s){const c=new Float64Array(r.ids),f=new Uint32Array(r.positions);return ph(c,f,0,c.length-1),s&&s.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(r){const s=new fh;return s.ids=r.ids,s.positions=r.positions,s.indexed=!0,s}}function Jo(o){const r=+o;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:nl(String(o))}function ph(o,r,s,c){for(;s<c;){const f=o[s+c>>1];let g=s-1,y=c+1;for(;;){do{g++}while(o[g]<f);do{y--}while(o[y]>f);if(g>=y)break;rl(o,g,y),rl(r,3*g,3*y),rl(r,3*g+1,3*y+1),rl(r,3*g+2,3*y+2)}y-s<c-y?(ph(o,r,s,y),s=y+1):(ph(o,r,y+1,c),c=y)}}function rl(o,r,s){const c=o[r];o[r]=o[s],o[s]=c}Vt(fh);class Pl{constructor(r,s){this.gl=r.gl,this.location=s}}class mh extends Pl{constructor(r,s){super(r,s),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Om extends Pl{constructor(r,s){super(r,s),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Lm extends Pl{constructor(r,s){super(r,s),this.current=qn.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const oy=new Float32Array(16),sy=new Float32Array(9),ay=new Float32Array(4);function Id(o){return[H(255*o.r,255*o.g),H(255*o.b,255*o.a)]}class uc{constructor(r,s,c){this.value=r,this.uniformNames=s.map(f=>`u_${f}`),this.type=c}setUniform(r,s,c){r.set(c.constantOr(this.value))}getBinding(r,s,c){return"color"===this.type?new Lm(r,s):new mh(r,s)}}class il{constructor(r,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,s){this.pixelRatioFrom=s.pixelRatio||1,this.pixelRatioTo=r.pixelRatio||1,this.patternFrom=s.tl.concat(s.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,s,c,f){const g="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;g&&r.set(g)}getBinding(r,s,c){return"u_pattern_from"===c||"u_pattern_to"===c||"u_dash_from"===c||"u_dash_to"===c?new Om(r,s):new mh(r,s)}}class kl{constructor(r,s,c,f){this.expression=r,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(r,s,c,f,g,y){const x=this.paintVertexArray.length,E=this.expression.evaluate(new kr(0),s,{},g,f,y);this.paintVertexArray.resize(r),this._setPaintValue(x,r,E)}updatePaintArray(r,s,c,f,g){const y=this.expression.evaluate({zoom:0},c,f,void 0,g);this._setPaintValue(r,s,y)}_setPaintValue(r,s,c){if("color"===this.type){const f=Id(c);for(let g=r;g<s;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=r;f<s;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fo{constructor(r,s,c,f,g,y){this.expression=r,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,s,c,f,g,y){const x=this.expression.evaluate(new kr(this.zoom),s,{},g,f,y),E=this.expression.evaluate(new kr(this.zoom+1),s,{},g,f,y),D=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(D,r,x,E)}updatePaintArray(r,s,c,f,g){const y=this.expression.evaluate({zoom:this.zoom},c,f,void 0,g),x=this.expression.evaluate({zoom:this.zoom+1},c,f,void 0,g);this._setPaintValue(r,s,y,x)}_setPaintValue(r,s,c,f){if("color"===this.type){const g=Id(c),y=Id(f);for(let x=r;x<s;x++)this.paintVertexArray.emplace(x,g[0],g[1],y[0],y[1])}else{for(let g=r;g<s;g++)this.paintVertexArray.emplace(g,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,f=J(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);r.set(f)}getBinding(r,s,c){return new mh(r,s)}}class Ea{constructor(r,s,c,f,g,y,x){this.expression=r,this.type=c,this.useIntegerZoom=f,this.zoom=g,this.layerId=x,this.paintVertexAttributes=("array"===c?lu:Ml).members;for(let E=0;E<s.length;++E);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(r,s,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(f,r,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(r,s,c,f,g,y){this._setPaintValues(r,s,c.patterns&&c.patterns[this.layerId],y)}_setPaintValues(r,s,c,f){if(!f||!c)return;const{min:g,mid:y,max:x}=c,E=f[g],D=f[y],M=f[x];if(E&&D&&M)for(let A=r;A<s;A++)this._setPaintValue(this.zoomInPaintVertexArray,A,D,E),this._setPaintValue(this.zoomOutPaintVertexArray,A,D,M)}_setPaintValue(r,s,c,f){r.emplace(s,c.tl[0],c.tl[1],c.br[0],c.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],c.pixelRatio,f.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ra{constructor(r,s,c=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const g in r.paint._values){if(!c(g))continue;const y=r.paint.get(g);if(!(y instanceof b&&tc(y.property.specification)))continue;const x=cy(g,r.type),E=y.value,D=y.property.specification.type,M=y.property.useIntegerZoom,A=y.property.specification["property-type"],k="cross-faded"===A||"cross-faded-data-driven"===A,F="line-dasharray"===String(g)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==E.kind||F)if("source"===E.kind||F||k){const j=cu(g,D,"source");this.binders[g]=k?new Ea(E,x,D,M,s,j,r.id):new kl(E,x,D,j),f.push(`/a_${g}`)}else{const j=cu(g,D,"composite");this.binders[g]=new Fo(E,x,D,M,s,j),f.push(`/z_${g}`)}else this.binders[g]=k?new il(E.value,x):new uc(E.value,x,D),f.push(`/u_${g}`)}this.cacheKey=f.sort().join("")}getMaxValue(r){const s=this.binders[r];return s instanceof kl||s instanceof Fo?s.maxValue:0}populatePaintArrays(r,s,c,f,g,y){for(const x in this.binders){const E=this.binders[x];(E instanceof kl||E instanceof Fo||E instanceof Ea)&&E.populatePaintArray(r,s,c,f,g,y)}}setConstantPatternPositions(r,s){for(const c in this.binders){const f=this.binders[c];f instanceof il&&f.setConstantPatternPositions(r,s)}}updatePaintArrays(r,s,c,f,g,y){let x=!1;for(const E in r){const D=s.getPositions(E);for(const M of D){const A=c.feature(M.index);for(const k in this.binders){const F=this.binders[k];if((F instanceof kl||F instanceof Fo||F instanceof Ea)&&!0===F.expression.isStateDependent){const j=f.paint.get(k);F.expression=j.value,F.updatePaintArray(M.start,M.end,A,r[E],g,y),x=!0}}}}return x}defines(){const r=[];for(const s in this.binders){const c=this.binders[s];(c instanceof uc||c instanceof il)&&r.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return r}getBinderAttributes(){const r=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof kl||c instanceof Fo||c instanceof Ea)for(let f=0;f<c.paintVertexAttributes.length;f++)r.push(c.paintVertexAttributes[f].name)}return r}getBinderUniforms(){const r=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof uc||c instanceof il||c instanceof Fo)for(const f of c.uniformNames)r.push(f)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,s){const c=[];for(const f in this.binders){const g=this.binders[f];if(g instanceof uc||g instanceof il||g instanceof Fo)for(const y of g.uniformNames)if(s[y]){const x=g.getBinding(r,s[y],y);c.push({name:y,property:f,binding:x})}}return c}setUniforms(r,s,c,f){for(const{name:g,property:y,binding:x}of s)this.binders[y].setUniform(x,f,c.get(y),g)}updatePaintBuffers(r){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(r&&c instanceof Ea){const f=2===r.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof kl||c instanceof Fo)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(r){for(const s in this.binders){const c=this.binders[s];(c instanceof kl||c instanceof Fo||c instanceof Ea)&&c.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const s=this.binders[r];(s instanceof kl||s instanceof Fo||s instanceof Ea)&&s.destroy()}}}class hc{constructor(r,s,c=(()=>!0)){this.programConfigurations={};for(const f of r)this.programConfigurations[f.id]=new ra(f,s,c);this.needsUpload=!1,this._featureMap=new fh,this._bufferOffset=0}populatePaintArrays(r,s,c,f,g,y,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,s,f,g,y,x);void 0!==s.id&&this._featureMap.add(s.id,c,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,s,c,f,g){for(const y of c)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,s,y,f,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const ly={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function cy(o,r){return ly[o]||[o.replace(`${r}-`,"").replace(/-/g,"_")]}const Fm={"line-pattern":{source:Ue,composite:Ue},"fill-pattern":{source:Ue,composite:Ue},"fill-extrusion-pattern":{source:Ue,composite:Ue},"line-dasharray":{source:We,composite:We}},uy={color:{source:Yt,composite:ri},number:{source:jt,composite:Yt}};function cu(o,r,s){const c=Fm[o];return c&&c[s]||uy[r][s]}Vt(uc),Vt(il),Vt(kl),Vt(Ea),Vt(Fo),Vt(ra,{omit:["_buffers"]}),Vt(hc);const gh="-transition";class ia extends nn{constructor(r,s){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),s.layout&&(this._unevaluatedLayout=new _(s.layout)),s.paint)){this._transitionablePaint=new p(s.paint);for(const c in r.paint)this.setPaintProperty(c,r.paint[c],{validate:!1});for(const c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new w(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,s,c={}){null!=s&&this._validate(Ti,`layers.${this.id}.layout.${r}`,r,s,c)||("visibility"!==r?this._unevaluatedLayout.setValue(r,s):this.visibility=s)}getPaintProperty(r){return it(r,gh)?this._transitionablePaint.getTransition(r.slice(0,-gh.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,s,c={}){if(null!=s&&this._validate(Uf,`layers.${this.id}.paint.${r}`,r,s,c))return!1;if(it(r,gh))return this._transitionablePaint.setTransition(r.slice(0,-gh.length),s||void 0),!1;{const f=this._transitionablePaint._values[r],g="cross-faded-data-driven"===f.property.specification["property-type"],y=f.value.isDataDriven(),x=f.value;this._transitionablePaint.setValue(r,s),this._handleSpecialPaintPropertyUpdate(r);const E=this._transitionablePaint._values[r].value;return E.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(r,x,E)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,s,c){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,s){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,s)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),wn(r,(s,c)=>!(void 0===s||"layout"===c&&!Object.keys(s).length||"paint"===c&&!Object.keys(s).length))}_validate(r,s,c,f,g={}){return(!g||!1!==g.validate)&&Sl(this,r.call(rr,{key:s,layerType:this.type,objectKey:c,value:f,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const s=this.paint.get(r);if(s instanceof b&&tc(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Pr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const hn=ge([{name:"a_pos",components:2,type:"Int16"}],4),zm=ge([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class ai{constructor(r=[]){this.segments=r}prepareSegment(r,s,c,f){let g=this.segments[this.segments.length-1];return r>ai.MAX_VERTEX_ARRAY_LENGTH&&un(`Max vertices per segment is ${ai.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>ai.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f)&&(g={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==f&&(g.sortKey=f),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const r of this.segments)for(const s in r.vaos)r.vaos[s].destroy()}static simpleSegment(r,s,c,f){return new ai([{vertexOffset:r,primitiveOffset:s,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}ai.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Vt(ai);var In=8192;class js{constructor(r,s){r&&(s?this.setSouthWest(r).setNorthEast(s):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Er?new Er(r.lng,r.lat):Er.convert(r),this}setSouthWest(r){return this._sw=r instanceof Er?new Er(r.lng,r.lat):Er.convert(r),this}extend(r){const s=this._sw,c=this._ne;let f,g;if(r instanceof Er)f=r,g=r;else{if(!(r instanceof js))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(js.convert(r)):this.extend(Er.convert(r)):this;if(f=r._sw,g=r._ne,!f||!g)return this}return s||c?(s.lng=Math.min(f.lng,s.lng),s.lat=Math.min(f.lat,s.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new Er(f.lng,f.lat),this._ne=new Er(g.lng,g.lat)),this}getCenter(){return new Er((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Er(this.getWest(),this.getNorth())}getSouthEast(){return new Er(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:s,lat:c}=Er.convert(r);let f=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}static convert(r){return!r||r instanceof js?r:new js(r)}}const $f=6371008.8;class Er{constructor(r,s){if(isNaN(r)||isNaN(s))throw new Error(`Invalid LngLat object: (${r}, ${s})`);if(this.lng=+r,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Er(Me(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const s=Math.PI/180,c=this.lat*s,f=r.lat*s,g=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((r.lng-this.lng)*s);return $f*Math.acos(Math.min(g,1))}toBounds(r=0){const s=360*r/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new js(new Er(this.lng-c,this.lat-s),new Er(this.lng+c,this.lat+s))}static convert(r){if(r instanceof Er)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new Er(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new Er(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Nm=2*Math.PI*$f;function uu(o){return Nm*Math.cos(o*Math.PI/180)}function Us(o){return(180+o)/360}function dc(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Ta(o,r){return o/uu(r)}function Vs(o){return 360*o-180}function Gi(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Md(o,r){return o*uu(Gi(r))}const ps=85.051129;class _h{constructor(r,s,c=0){this.x=+r,this.y=+s,this.z=+c}static fromLngLat(r,s=0){const c=Er.convert(r);return new _h(Us(c.lng),dc(c.lat),Ta(s,c.lat))}toLngLat(){return new Er(Vs(this.x),Gi(this.y))}toAltitude(){return Md(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Nm*(r=Gi(this.y),1/Math.cos(r*Math.PI/180));var r}}function Gf(o,r,s,c,f,g,y,x,E){const D=(r+c)/2,M=(s+f)/2,A=new $(D,M);x(A),function(k,F,j,q,ee,le){const Ee=j-ee,Pe=q-le;return Math.abs((q-F)*Ee-(j-k)*Pe)/Math.hypot(Ee,Pe)}(A.x,A.y,g.x,g.y,y.x,y.y)>=E?(Gf(o,r,s,D,M,g,A,x,E),Gf(o,D,M,c,f,A,y,x,E)):o.push(y)}function hy(o,r,s){let c=o[0],f=c.x,g=c.y;r(c);const y=[c];for(let x=1;x<o.length;x++){const E=o[x],{x:D,y:M}=E;r(E),Gf(y,f,g,D,M,c,E,r,s),f=D,g=M,c=E}return y}const Rl=Math.pow(2,14)-1,hu=-Rl-1;function dy(o,r){const s=Math.round(o.x*r),c=Math.round(o.y*r);return o.x=J(s,hu,Rl),o.y=J(c,hu,Rl),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&un("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Ol(o,r,s){const c=o.loadGeometry(),f=o.extent,g=In/f;if(r&&s&&s.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:x,x:E,y:D,projection:M}=s,A=k=>{const F=Vs((r.x+k.x/f)/y),j=Gi((r.y+k.y/f)/y),q=M.project(F,j);k.x=(q.x*x-E)*f,k.y=(q.y*x-D)*f};for(let k=0;k<c.length;k++)if(1!==o.type)c[k]=hy(c[k],A,1);else{const F=[];for(const j of c[k])j.x<0||j.x>=f||j.y<0||j.y>=f||(A(j),F.push(j));c[k]=F}}for(const y of c)for(const x of y)dy(x,g);return c}function Ll(o,r){return{type:o.type,id:o.id,properties:o.properties,geometry:r?Ol(o):[]}}function Ad(o,r,s,c,f){o.emplaceBack(2*r+(c+1)/2,2*s+(f+1)/2)}function Hf(o,r,s,c){o.emplaceBack(r.x,r.y,r.z,16384*s[0],16384*s[1],16384*s[2],c)}class qf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new fe,this.indexArray=new Ke,this.segments=new ai,this.programConfigurations=new hc(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,c,f){const g=this.layers[0],y=[];let x=null;"circle"===g.type&&(x=g.layout.get("circle-sort-key"));for(const{feature:D,id:M,index:A,sourceLayerIndex:k}of r){const F=this.layers[0]._featureFilter.needGeometry,j=Ll(D,F);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),j,c))continue;const q=x?x.evaluate(j,{},c):void 0,ee={id:M,properties:D.properties,type:D.type,sourceLayerIndex:k,index:A,geometry:F?j.geometry:Ol(D,c,f),patterns:{},sortKey:q};y.push(ee)}x&&y.sort((D,M)=>D.sortKey-M.sortKey);let E=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new Bs,E=f.projection);for(const D of y){const{geometry:M,index:A,sourceLayerIndex:k}=D,F=r[A].feature;this.addFeature(D,M,A,s.availableImages,c,E),s.featureIndex.insert(F,M,A,k,this.index)}}update(r,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,hn.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,zm.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,s,c,f,g,y){for(const x of s)for(const E of x){const D=E.x,M=E.y;if(D<0||D>=In||M<0||M>=In)continue;if(y){const F=y.projectTilePoint(D,M,g),j=y.upVector(g,D,M),q=Gi((M/In+g.y)/(1<<g.z)),ee=y.pixelsPerMeter(q,1)/Ta(1,q),le=this.globeExtVertexArray;Hf(le,F,j,ee),Hf(le,F,j,ee),Hf(le,F,j,ee),Hf(le,F,j,ee)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),k=A.vertexLength;Ad(this.layoutVertexArray,D,M,-1,-1),Ad(this.layoutVertexArray,D,M,1,-1),Ad(this.layoutVertexArray,D,M,1,1),Ad(this.layoutVertexArray,D,M,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,{},f,g)}}function Bm(o,r){for(let s=0;s<o.length;s++)if(zl(r,o[s]))return!0;for(let s=0;s<r.length;s++)if(zl(o,r[s]))return!0;return!!Fl(o,r)}function fy(o,r,s){return!!zl(o,r)||!!Wf(r,o,s)}function yh(o,r){if(1===o.length)return vh(r,o[0]);for(let s=0;s<r.length;s++){const c=r[s];for(let f=0;f<c.length;f++)if(zl(o,c[f]))return!0}for(let s=0;s<o.length;s++)if(vh(r,o[s]))return!0;for(let s=0;s<r.length;s++)if(Fl(o,r[s]))return!0;return!1}function Zf(o,r,s){if(o.length>1){if(Fl(o,r))return!0;for(let c=0;c<r.length;c++)if(Wf(r[c],o,s))return!0}for(let c=0;c<o.length;c++)if(Wf(o[c],r,s))return!0;return!1}function Fl(o,r){if(0===o.length||0===r.length)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],f=o[s+1];for(let g=0;g<r.length-1;g++)if(py(c,f,r[g],r[g+1]))return!0}return!1}function py(o,r,s,c){return Nn(o,s,c)!==Nn(r,s,c)&&Nn(o,r,s)!==Nn(o,r,c)}function Wf(o,r,s){const c=s*s;if(1===r.length)return o.distSqr(r[0])<c;for(let f=1;f<r.length;f++)if(my(o,r[f-1],r[f])<c)return!0;return!1}function my(o,r,s){const c=r.distSqr(s);if(0===c)return o.distSqr(r);const f=((o.x-r.x)*(s.x-r.x)+(o.y-r.y)*(s.y-r.y))/c;return o.distSqr(f<0?r:f>1?s:s.sub(r)._mult(f)._add(r))}function vh(o,r){let s,c,f,g=!1;for(let y=0;y<o.length;y++){s=o[y];for(let x=0,E=s.length-1;x<s.length;E=x++)c=s[x],f=s[E],c.y>r.y!=f.y>r.y&&r.x<(f.x-c.x)*(r.y-c.y)/(f.y-c.y)+c.x&&(g=!g)}return g}function zl(o,r){let s=!1;for(let c=0,f=o.length-1;c<o.length;f=c++){const g=o[c],y=o[f];g.y>r.y!=y.y>r.y&&r.x<(y.x-g.x)*(r.y-g.y)/(y.y-g.y)+g.x&&(s=!s)}return s}function Xf(o,r,s,c,f){for(const y of o)if(r<=y.x&&s<=y.y&&c>=y.x&&f>=y.y)return!0;const g=[new $(r,s),new $(r,f),new $(c,f),new $(c,s)];if(o.length>2)for(const y of g)if(zl(o,y))return!0;for(let y=0;y<o.length-1;y++)if(jm(o[y],o[y+1],g))return!0;return!1}function jm(o,r,s){const c=s[0],f=s[2];if(o.x<c.x&&r.x<c.x||o.x>f.x&&r.x>f.x||o.y<c.y&&r.y<c.y||o.y>f.y&&r.y>f.y)return!1;const g=Nn(o,r,s[0]);return g!==Nn(o,r,s[1])||g!==Nn(o,r,s[2])||g!==Nn(o,r,s[3])}function fc(o,r,s){const c=r.paint.get(o).value;return"constant"===c.kind?c.value:s.programConfigurations.get(r.id).getMaxValue(o)}function xh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Um(o,r,s,c,f){if(!r[0]&&!r[1])return o;const g=$.convert(r)._mult(f);"viewport"===s&&g._rotate(-c);const y=[];for(let x=0;x<o.length;x++)y.push(o[x].sub(g));return y}function Vm(o,r,s,c){const f=$.convert(o)._mult(c);return"viewport"===r&&f._rotate(-s),f}Vt(qf,{omit:["layers"]});const gy=new B({"circle-sort-key":new S($e.layout_circle["circle-sort-key"])});var _y={paint:new B({"circle-radius":new S($e.paint_circle["circle-radius"]),"circle-color":new S($e.paint_circle["circle-color"]),"circle-blur":new S($e.paint_circle["circle-blur"]),"circle-opacity":new S($e.paint_circle["circle-opacity"]),"circle-translate":new C($e.paint_circle["circle-translate"]),"circle-translate-anchor":new C($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new C($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new C($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new S($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new S($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new S($e.paint_circle["circle-stroke-opacity"])}),layout:gy},Kf=1e-6,Ci="undefined"!=typeof Float32Array?Float32Array:Array;function du(){var o=new Ci(9);return Ci!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Ca(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function $m(o,r,s){var c=r[0],f=r[1],g=r[2],y=r[3],x=r[4],E=r[5],D=r[6],M=r[7],A=r[8],k=r[9],F=r[10],j=r[11],q=r[12],ee=r[13],le=r[14],Ee=r[15],Pe=s[0],Re=s[1],Le=s[2],Fe=s[3];return o[0]=Pe*c+Re*x+Le*A+Fe*q,o[1]=Pe*f+Re*E+Le*k+Fe*ee,o[2]=Pe*g+Re*D+Le*F+Fe*le,o[3]=Pe*y+Re*M+Le*j+Fe*Ee,o[4]=(Pe=s[4])*c+(Re=s[5])*x+(Le=s[6])*A+(Fe=s[7])*q,o[5]=Pe*f+Re*E+Le*k+Fe*ee,o[6]=Pe*g+Re*D+Le*F+Fe*le,o[7]=Pe*y+Re*M+Le*j+Fe*Ee,o[8]=(Pe=s[8])*c+(Re=s[9])*x+(Le=s[10])*A+(Fe=s[11])*q,o[9]=Pe*f+Re*E+Le*k+Fe*ee,o[10]=Pe*g+Re*D+Le*F+Fe*le,o[11]=Pe*y+Re*M+Le*j+Fe*Ee,o[12]=(Pe=s[12])*c+(Re=s[13])*x+(Le=s[14])*A+(Fe=s[15])*q,o[13]=Pe*f+Re*E+Le*k+Fe*ee,o[14]=Pe*g+Re*D+Le*F+Fe*le,o[15]=Pe*y+Re*M+Le*j+Fe*Ee,o}function fu(o,r,s){var c,f,g,y,x,E,D,M,A,k,F,j,q=s[0],ee=s[1],le=s[2];return r===o?(o[12]=r[0]*q+r[4]*ee+r[8]*le+r[12],o[13]=r[1]*q+r[5]*ee+r[9]*le+r[13],o[14]=r[2]*q+r[6]*ee+r[10]*le+r[14],o[15]=r[3]*q+r[7]*ee+r[11]*le+r[15]):(f=r[1],g=r[2],y=r[3],x=r[4],E=r[5],D=r[6],M=r[7],A=r[8],k=r[9],F=r[10],j=r[11],o[0]=c=r[0],o[1]=f,o[2]=g,o[3]=y,o[4]=x,o[5]=E,o[6]=D,o[7]=M,o[8]=A,o[9]=k,o[10]=F,o[11]=j,o[12]=c*q+x*ee+A*le+r[12],o[13]=f*q+E*ee+k*le+r[13],o[14]=g*q+D*ee+F*le+r[14],o[15]=y*q+M*ee+j*le+r[15]),o}function pc(o,r,s){var c=s[0],f=s[1],g=s[2];return o[0]=r[0]*c,o[1]=r[1]*c,o[2]=r[2]*c,o[3]=r[3]*c,o[4]=r[4]*f,o[5]=r[5]*f,o[6]=r[6]*f,o[7]=r[7]*f,o[8]=r[8]*g,o[9]=r[9]*g,o[10]=r[10]*g,o[11]=r[11]*g,o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o}function Gm(o,r,s){var c=Math.sin(s),f=Math.cos(s),g=r[4],y=r[5],x=r[6],E=r[7],D=r[8],M=r[9],A=r[10],k=r[11];return r!==o&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[4]=g*f+D*c,o[5]=y*f+M*c,o[6]=x*f+A*c,o[7]=E*f+k*c,o[8]=D*f-g*c,o[9]=M*f-y*c,o[10]=A*f-x*c,o[11]=k*f-E*c,o}function Hm(o,r,s){var c=Math.sin(s),f=Math.cos(s),g=r[0],y=r[1],x=r[2],E=r[3],D=r[8],M=r[9],A=r[10],k=r[11];return r!==o&&(o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=g*f-D*c,o[1]=y*f-M*c,o[2]=x*f-A*c,o[3]=E*f-k*c,o[8]=g*c+D*f,o[9]=y*c+M*f,o[10]=x*c+A*f,o[11]=E*c+k*f,o}Math.hypot||(Math.hypot=function(){for(var o=0,r=arguments.length;r--;)o+=arguments[r]*arguments[r];return Math.sqrt(o)});var qm=$m;function Yf(){var o=new Ci(3);return Ci!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Zm(o){var r=new Ci(3);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r}function Wm(o){return Math.hypot(o[0],o[1],o[2])}function bh(o,r,s){var c=new Ci(3);return c[0]=o,c[1]=r,c[2]=s,c}function yy(o,r,s){return o[0]=r[0]+s[0],o[1]=r[1]+s[1],o[2]=r[2]+s[2],o}function Xm(o,r,s){return o[0]=r[0]-s[0],o[1]=r[1]-s[1],o[2]=r[2]-s[2],o}function wh(o,r,s){return o[0]=r[0]*s[0],o[1]=r[1]*s[1],o[2]=r[2]*s[2],o}function Pd(o,r,s){return o[0]=Math.min(r[0],s[0]),o[1]=Math.min(r[1],s[1]),o[2]=Math.min(r[2],s[2]),o}function $s(o,r,s){return o[0]=Math.max(r[0],s[0]),o[1]=Math.max(r[1],s[1]),o[2]=Math.max(r[2],s[2]),o}function ol(o,r,s){return o[0]=r[0]*s,o[1]=r[1]*s,o[2]=r[2]*s,o}function kd(o,r,s,c){return o[0]=r[0]+s[0]*c,o[1]=r[1]+s[1]*c,o[2]=r[2]+s[2]*c,o}function pu(o,r){var s=r[0],c=r[1],f=r[2],g=s*s+c*c+f*f;return g>0&&(g=1/Math.sqrt(g)),o[0]=r[0]*g,o[1]=r[1]*g,o[2]=r[2]*g,o}function mu(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]}function vy(o,r,s){var c=r[0],f=r[1],g=r[2],y=s[0],x=s[1],E=s[2];return o[0]=f*E-g*x,o[1]=g*y-c*E,o[2]=c*x-f*y,o}function gu(o,r,s){var c=r[0],f=r[1],g=r[2],y=s[3]*c+s[7]*f+s[11]*g+s[15];return o[0]=(s[0]*c+s[4]*f+s[8]*g+s[12])/(y=y||1),o[1]=(s[1]*c+s[5]*f+s[9]*g+s[13])/y,o[2]=(s[2]*c+s[6]*f+s[10]*g+s[14])/y,o}function xy(o,r,s){var c=s[0],f=s[1],g=s[2],y=r[0],x=r[1],E=r[2],D=f*E-g*x,M=g*y-c*E,A=c*x-f*y,k=f*A-g*M,F=g*D-c*A,j=c*M-f*D,q=2*s[3];return M*=q,A*=q,F*=2,j*=2,o[0]=y+(D*=q)+(k*=2),o[1]=x+M+F,o[2]=E+A+j,o}var mc,Nl=Xm,Jf=wh,C0=Wm;function Eh(o,r,s){var c=r[0],f=r[1],g=r[2],y=r[3];return o[0]=s[0]*c+s[4]*f+s[8]*g+s[12]*y,o[1]=s[1]*c+s[5]*f+s[9]*g+s[13]*y,o[2]=s[2]*c+s[6]*f+s[10]*g+s[14]*y,o[3]=s[3]*c+s[7]*f+s[11]*g+s[15]*y,o}function Qf(){var o=new Ci(4);return Ci!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Km(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Ym(o,r,s){s*=.5;var c=r[0],f=r[1],g=r[2],y=r[3],x=Math.sin(s),E=Math.cos(s);return o[0]=c*E+y*x,o[1]=f*E+g*x,o[2]=g*E-f*x,o[3]=y*E-c*x,o}Yf(),mc=new Ci(4),Ci!=Float32Array&&(mc[0]=0,mc[1]=0,mc[2]=0,mc[3]=0),Yf(),bh(1,0,0),bh(0,1,0),Qf(),Qf(),du();class ep{constructor(r,s){this.points=r,this.planes=s}static fromInvProjectionMatrix(r,s,c,f){const g=Math.pow(2,c),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const D=Eh([],E,r),M=1/D[3]/s*g;return(A=D)[0]=(k=D)[0]*(F=[M,M,f?1/D[3]:M,M])[0],A[1]=k[1]*F[1],A[2]=k[2]*F[2],A[3]=k[3]*F[3],A;var A,k,F}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const D=pu([],vy([],Nl([],y[E[0]],y[E[1]]),Nl([],y[E[2]],y[E[1]]))),M=-mu(D,y[E[1]]);return D.concat(M)});return new ep(y,x)}}class ms{constructor(r,s){this.min=r,this.max=s,this.center=ol([],yy([],this.min,this.max),.5)}quadrant(r){const s=[r%2==0,r<2],c=Zm(this.min),f=Zm(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],f[g]=s[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new ms(c,f)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,s=this.max;return[[r[0],r[1],r[2]],[s[0],r[1],r[2]],[s[0],s[1],r[2]],[r[0],s[1],r[2]],[r[0],r[1],s[2]],[s[0],r[1],s[2]],[s[0],s[1],s[2]],[r[0],s[1],s[2]]]}intersects(r){const s=this.getCorners();let c=!0;for(let f=0;f<r.planes.length;f++){const g=r.planes[f];let y=0;for(let x=0;x<s.length;x++)y+=mu(g,s[x])+g[3]>=0;if(0===y)return 0;y!==s.length&&(c=!1)}if(c)return 2;for(let f=0;f<3;f++){let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const E=r.points[x][f]-this.min[f];g=Math.min(g,E),y=Math.max(y,E)}if(y<0||g>this.max[f]-this.min[f])return 0}return 1}}function tp(o,r,s,c,f,g,y,x,E){if(g&&o.queryGeometry.isAboveHorizon)return!1;g&&(E*=o.pixelToTileUnitsFactor);for(const D of r)for(const M of D){const A=M.add(x),k=f&&s.elevation?s.elevation.exaggeration()*f.getElevationAt(A.x,A.y,!0):0,F=g?A:Rd(A,k,c),j=g?o.tilespaceRays.map(ee=>by(ee,k)):o.queryGeometry.screenGeometry,q=Eh([],[M.x,M.y,k,1],c);if(!y&&g?E*=q[3]/s.cameraToCenterDistance:y&&!g&&(E*=s.cameraToCenterDistance/q[3]),fy(j,F,E))return!0}return!1}function Rd(o,r,s){const c=Eh([],[o.x,o.y,r,1],s);return new $(c[0]/c[3],c[1]/c[3])}const Jm=bh(0,0,0),np=bh(0,0,1);function by(o,r){const s=Yf();return Jm[2]=r,o.intersectsPlane(Jm,np,s),new $(s[0],s[1])}class Di extends qf{}function Qm(o,{width:r,height:s},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==r*s*c)throw new RangeError("mismatched image size")}else f=new Uint8Array(r*s*c);return o.width=r,o.height=s,o.data=f,o}function eg(o,r,s){const{width:c,height:f}=r;c===o.width&&f===o.height||(Th(o,r,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,f)},s),o.width=c,o.height=f,o.data=r.data)}function Th(o,r,s,c,f,g){if(0===f.width||0===f.height)return r;if(f.width>o.width||f.height>o.height||s.x>o.width-f.width||s.y>o.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>r.width||f.height>r.height||c.x>r.width-f.width||c.y>r.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=o.data,x=r.data;for(let E=0;E<f.height;E++){const D=((s.y+E)*o.width+s.x)*g,M=((c.y+E)*r.width+c.x)*g;for(let A=0;A<f.width*g;A++)x[M+A]=y[D+A]}return r}Vt(Di,{omit:["layers"]});class Da{constructor(r,s){Qm(this,r,1,s)}resize(r){eg(this,new Da(r),1)}clone(){return new Da({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,c,f,g){Th(r,s,c,f,g,1)}}class Qo{constructor(r,s){Qm(this,r,4,s)}resize(r){eg(this,new Qo(r),4)}replace(r,s){s?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Qo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,c,f,g){Th(r,s,c,f,g,4)}}Vt(Da),Vt(Qo);var wy={paint:new B({"heatmap-radius":new S($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new S($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new C($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new L($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new C($e.paint_heatmap["heatmap-opacity"])})};function rp(o){const r={},s=o.resolution||256,c=o.clips?o.clips.length:1,f=o.image||new Qo({width:s,height:c}),g=(y,x,E)=>{r[o.evaluationKey]=E;const D=o.expression.evaluate(r);f.data[y+x+0]=Math.floor(255*D.r/D.a),f.data[y+x+1]=Math.floor(255*D.g/D.a),f.data[y+x+2]=Math.floor(255*D.b/D.a),f.data[y+x+3]=Math.floor(255*D.a)};if(o.clips)for(let y=0,x=0;y<c;++y,x+=4*s)for(let E=0,D=0;E<s;E++,D+=4){const M=E/(s-1),{start:A,end:k}=o.clips[y];g(x,D,A*(1-M)+k*M)}else for(let y=0,x=0;y<s;y++,x+=4)g(0,x,y/(s-1));return f}var Ey={paint:new B({"hillshade-illumination-direction":new C($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new C($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new C($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new C($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new C($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new C($e.paint_hillshade["hillshade-accent-color"])})};const Ty=ge([{name:"a_pos",components:2,type:"Int16"}],4),{members:D0}=Ty;var ip=Ji,Ch=Ji;function Ji(o,r,s){s=s||2;var c,f,g,y,x,E,D,M=r&&r.length,A=M?r[0]*s:o.length,k=Od(o,0,A,s,!0),F=[];if(!k||k.next===k.prev)return F;if(M&&(k=function(q,ee,le,Ee){var Pe,Re,Le,Fe=[];for(Pe=0,Re=ee.length;Pe<Re;Pe++)(Le=Od(q,ee[Pe]*Ee,Pe<Re-1?ee[Pe+1]*Ee:q.length,Ee,!1))===Le.next&&(Le.steiner=!0),Fe.push(Iy(Le));for(Fe.sort(Dy),Pe=0;Pe<Fe.length;Pe++)le=sl(le=tg(Fe[Pe],le),le.next);return le}(o,r,k,s)),o.length>80*s){c=g=o[0],f=y=o[1];for(var j=s;j<A;j+=s)(x=o[j])<c&&(c=x),(E=o[j+1])<f&&(f=E),x>g&&(g=x),E>y&&(y=E);D=0!==(D=Math.max(g-c,y-f))?1/D:0}return _u(k,F,s,c,f,D),F}function Od(o,r,s,c,f){var g,y;if(f===ap(o,r,s,c)>0)for(g=r;g<s;g+=c)y=xu(g,o[g],o[g+1],y);else for(g=s-c;g>=r;g-=c)y=xu(g,o[g],o[g+1],y);return y&&yu(y,y.next)&&(Ih(y),y=y.next),y}function sl(o,r){if(!o)return o;r||(r=o);var s,c=o;do{if(s=!1,c.steiner||!yu(c,c.next)&&0!==fi(c.prev,c,c.next))c=c.next;else{if(Ih(c),(c=r=c.prev)===c.next)break;s=!0}}while(s||c!==r);return r}function _u(o,r,s,c,f,g,y){if(o){!y&&g&&function(M,A,k,F){var j=M;do{null===j.z&&(j.z=Ld(j.x,j.y,A,k,F)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next}while(j!==M);j.prevZ.nextZ=null,j.prevZ=null,function(q){var ee,le,Ee,Pe,Re,Le,Fe,Ye,Qe=1;do{for(le=q,q=null,Re=null,Le=0;le;){for(Le++,Ee=le,Fe=0,ee=0;ee<Qe&&(Fe++,Ee=Ee.nextZ);ee++);for(Ye=Qe;Fe>0||Ye>0&&Ee;)0!==Fe&&(0===Ye||!Ee||le.z<=Ee.z)?(Pe=le,le=le.nextZ,Fe--):(Pe=Ee,Ee=Ee.nextZ,Ye--),Re?Re.nextZ=Pe:q=Pe,Pe.prevZ=Re,Re=Pe;le=Ee}Re.nextZ=null,Qe*=2}while(Le>1)}(j)}(o,c,f,g);for(var x,E,D=o;o.prev!==o.next;)if(x=o.prev,E=o.next,g?Dh(o,c,f,g):To(o))r.push(x.i/s),r.push(o.i/s),r.push(E.i/s),Ih(o),o=E.next,D=E.next;else if((o=E)===D){y?1===y?_u(o=op(sl(o),r,s),r,s,c,f,g,2):2===y&&Cy(o,r,s,c,f,g):_u(sl(o),r,s,c,f,g,1);break}}}function To(o){var r=o.prev,s=o,c=o.next;if(fi(r,s,c)>=0)return!1;for(var f=o.next.next;f!==o.prev;){if(gc(r.x,r.y,s.x,s.y,c.x,c.y,f.x,f.y)&&fi(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Dh(o,r,s,c){var f=o.prev,g=o,y=o.next;if(fi(f,g,y)>=0)return!1;for(var x=f.x>g.x?f.x>y.x?f.x:y.x:g.x>y.x?g.x:y.x,E=f.y>g.y?f.y>y.y?f.y:y.y:g.y>y.y?g.y:y.y,D=Ld(f.x<g.x?f.x<y.x?f.x:y.x:g.x<y.x?g.x:y.x,f.y<g.y?f.y<y.y?f.y:y.y:g.y<y.y?g.y:y.y,r,s,c),M=Ld(x,E,r,s,c),A=o.prevZ,k=o.nextZ;A&&A.z>=D&&k&&k.z<=M;){if(A!==o.prev&&A!==o.next&&gc(f.x,f.y,g.x,g.y,y.x,y.y,A.x,A.y)&&fi(A.prev,A,A.next)>=0||(A=A.prevZ,k!==o.prev&&k!==o.next&&gc(f.x,f.y,g.x,g.y,y.x,y.y,k.x,k.y)&&fi(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;A&&A.z>=D;){if(A!==o.prev&&A!==o.next&&gc(f.x,f.y,g.x,g.y,y.x,y.y,A.x,A.y)&&fi(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;k&&k.z<=M;){if(k!==o.prev&&k!==o.next&&gc(f.x,f.y,g.x,g.y,y.x,y.y,k.x,k.y)&&fi(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function op(o,r,s){var c=o;do{var f=c.prev,g=c.next.next;!yu(f,g)&&ng(f,c,c.next,g)&&Sh(f,g)&&Sh(g,f)&&(r.push(f.i/s),r.push(c.i/s),r.push(g.i/s),Ih(c),Ih(c.next),c=o=g),c=c.next}while(c!==o);return sl(c)}function Cy(o,r,s,c,f,g){var y=o;do{for(var x=y.next.next;x!==y.prev;){if(y.i!==x.i&&My(y,x)){var E=rg(y,x);return y=sl(y,y.next),E=sl(E,E.next),_u(y,r,s,c,f,g),void _u(E,r,s,c,f,g)}x=x.next}y=y.next}while(y!==o)}function Dy(o,r){return o.x-r.x}function tg(o,r){var s=function(g,y){var x,E=y,D=g.x,M=g.y,A=-1/0;do{if(M<=E.y&&M>=E.next.y&&E.next.y!==E.y){var k=E.x+(M-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(k<=D&&k>A){if(A=k,k===D){if(M===E.y)return E;if(M===E.next.y)return E.next}x=E.x<E.next.x?E:E.next}}E=E.next}while(E!==y);if(!x)return null;if(D===A)return x;var F,j=x,q=x.x,ee=x.y,le=1/0;E=x;do{D>=E.x&&E.x>=q&&D!==E.x&&gc(M<ee?D:A,M,q,ee,M<ee?A:D,M,E.x,E.y)&&(F=Math.abs(M-E.y)/(D-E.x),Sh(E,g)&&(F<le||F===le&&(E.x>x.x||E.x===x.x&&Sy(x,E)))&&(x=E,le=F)),E=E.next}while(E!==j);return x}(o,r);if(!s)return r;var c=rg(s,o),f=sl(s,s.next);return sl(c,c.next),r===s?f:r}function Sy(o,r){return fi(o.prev,o,r.prev)<0&&fi(r.next,o,o.next)<0}function Ld(o,r,s,c,f){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-s)*f)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-c)*f)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Iy(o){var r=o,s=o;do{(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next}while(r!==o);return s}function gc(o,r,s,c,f,g,y,x){return(f-y)*(r-x)-(o-y)*(g-x)>=0&&(o-y)*(c-x)-(s-y)*(r-x)>=0&&(s-y)*(g-x)-(f-y)*(c-x)>=0}function My(o,r){return o.next.i!==r.i&&o.prev.i!==r.i&&!function(s,c){var f=s;do{if(f.i!==s.i&&f.next.i!==s.i&&f.i!==c.i&&f.next.i!==c.i&&ng(f,f.next,s,c))return!0;f=f.next}while(f!==s);return!1}(o,r)&&(Sh(o,r)&&Sh(r,o)&&function(s,c){var f=s,g=!1,y=(s.x+c.x)/2,x=(s.y+c.y)/2;do{f.y>x!=f.next.y>x&&f.next.y!==f.y&&y<(f.next.x-f.x)*(x-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next}while(f!==s);return g}(o,r)&&(fi(o.prev,o,r.prev)||fi(o,r.prev,r))||yu(o,r)&&fi(o.prev,o,o.next)>0&&fi(r.prev,r,r.next)>0)}function fi(o,r,s){return(r.y-o.y)*(s.x-r.x)-(r.x-o.x)*(s.y-r.y)}function yu(o,r){return o.x===r.x&&o.y===r.y}function ng(o,r,s,c){var f=vu(fi(o,r,s)),g=vu(fi(o,r,c)),y=vu(fi(s,c,o)),x=vu(fi(s,c,r));return f!==g&&y!==x||!(0!==f||!Fd(o,s,r))||!(0!==g||!Fd(o,c,r))||!(0!==y||!Fd(s,o,c))||!(0!==x||!Fd(s,r,c))}function Fd(o,r,s){return r.x<=Math.max(o.x,s.x)&&r.x>=Math.min(o.x,s.x)&&r.y<=Math.max(o.y,s.y)&&r.y>=Math.min(o.y,s.y)}function vu(o){return o>0?1:o<0?-1:0}function Sh(o,r){return fi(o.prev,o,o.next)<0?fi(o,r,o.next)>=0&&fi(o,o.prev,r)>=0:fi(o,r,o.prev)<0||fi(o,o.next,r)<0}function rg(o,r){var s=new sp(o.i,o.x,o.y),c=new sp(r.i,r.x,r.y),f=o.next,g=r.prev;return o.next=r,r.prev=o,s.next=f,f.prev=s,c.next=s,s.prev=c,g.next=c,c.prev=g,c}function xu(o,r,s,c){var f=new sp(o,r,s);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function Ih(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function sp(o,r,s){this.i=o,this.x=r,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ap(o,r,s,c){for(var f=0,g=r,y=s-c;g<s;g+=c)f+=(o[y]-o[g])*(o[g+1]+o[y+1]),y=g;return f}function Ay(o,r,s,c,f){ig(o,r,s||0,c||o.length-1,f||Py)}function ig(o,r,s,c,f){for(;c>s;){if(c-s>600){var g=c-s+1,y=r-s+1,x=Math.log(g),E=.5*Math.exp(2*x/3),D=.5*Math.sqrt(x*E*(g-E)/g)*(y-g/2<0?-1:1);ig(o,r,Math.max(s,Math.floor(r-y*E/g+D)),Math.min(c,Math.floor(r+(g-y)*E/g+D)),f)}var M=o[r],A=s,k=c;for(bu(o,s,r),f(o[c],M)>0&&bu(o,s,c);A<k;){for(bu(o,A,k),A++,k--;f(o[A],M)<0;)A++;for(;f(o[k],M)>0;)k--}0===f(o[s],M)?bu(o,s,k):bu(o,++k,c),k<=r&&(s=k+1),r<=k&&(c=k-1)}}function bu(o,r,s){var c=o[r];o[r]=o[s],o[s]=c}function Py(o,r){return o<r?-1:o>r?1:0}function lp(o,r){const s=o.length;if(s<=1)return[o];const c=[];let f,g;for(let y=0;y<s;y++){const x=ir(o[y]);0!==x&&(o[y].area=Math.abs(x),void 0===g&&(g=x<0),g===x<0?(f&&c.push(f),f=[o[y]]):f.push(o[y]))}if(f&&c.push(f),r>1)for(let y=0;y<c.length;y++)c[y].length<=r||(Ay(c[y],r,1,c[y].length-1,ky),c[y]=c[y].slice(0,r));return c}function ky(o,r){return r.area-o.area}function cp(o,r,s){const c=s.patternDependencies;let f=!1;for(const g of r){const y=g.paint.get(`${o}-pattern`);y.isConstant()||(f=!0);const x=y.constantOr(null);x&&(f=!0,c[x.to]=!0,c[x.from]=!0)}return f}function up(o,r,s,c,f){const g=f.patternDependencies;for(const y of r){const x=y.paint.get(`${o}-pattern`).value;if("constant"!==x.kind){let E=x.evaluate({zoom:c-1},s,{},f.availableImages),D=x.evaluate({zoom:c},s,{},f.availableImages),M=x.evaluate({zoom:c+1},s,{},f.availableImages);E=E&&E.name?E.name:E,D=D&&D.name?D.name:D,M=M&&M.name?M.name:M,g[E]=!0,g[D]=!0,g[M]=!0,s.patterns[y.id]={min:E,mid:D,max:M}}}return s}Ji.deviation=function(o,r,s,c){var f=r&&r.length,g=Math.abs(ap(o,0,f?r[0]*s:o.length,s));if(f)for(var y=0,x=r.length;y<x;y++)g-=Math.abs(ap(o,r[y]*s,y<x-1?r[y+1]*s:o.length,s));var E=0;for(y=0;y<c.length;y+=3){var D=c[y]*s,M=c[y+1]*s,A=c[y+2]*s;E+=Math.abs((o[D]-o[A])*(o[M+1]-o[D+1])-(o[D]-o[M])*(o[A+1]-o[D+1]))}return 0===g&&0===E?0:Math.abs((E-g)/g)},Ji.flatten=function(o){for(var r=o[0][0].length,s={vertices:[],holes:[],dimensions:r},c=0,f=0;f<o.length;f++){for(var g=0;g<o[f].length;g++)for(var y=0;y<r;y++)s.vertices.push(o[f][g][y]);f>0&&s.holes.push(c+=o[f-1].length)}return s},ip.default=Ch;class zd{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fe,this.indexArray=new Ke,this.indexArray2=new en,this.programConfigurations=new hc(r.layers,r.zoom),this.segments=new ai,this.segments2=new ai,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=r.projection}populate(r,s,c,f){this.hasPattern=cp("fill",this.layers,s);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:x,id:E,index:D,sourceLayerIndex:M}of r){const A=this.layers[0]._featureFilter.needGeometry,k=Ll(x,A);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),k,c))continue;const F=g?g.evaluate(k,{},c,s.availableImages):void 0,j={id:E,properties:x.properties,type:x.type,sourceLayerIndex:M,index:D,geometry:A?k.geometry:Ol(x,c,f),patterns:{},sortKey:F};y.push(j)}g&&y.sort((x,E)=>x.sortKey-E.sortKey);for(const x of y){const{geometry:E,index:D,sourceLayerIndex:M}=x;if(this.hasPattern){const A=up("fill",this.layers,x,this.zoom,s);this.patternFeatures.push(A)}else this.addFeature(x,E,D,c,{},s.availableImages);s.featureIndex.insert(r[D].feature,E,D,M,this.index)}}update(r,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c,f)}addFeatures(r,s,c,f,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,s,c,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,D0),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,s,c,f,g,y=[]){for(const x of lp(s,500)){let E=0;for(const j of x)E+=j.length;const D=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),M=D.vertexLength,A=[],k=[];for(const j of x){if(0===j.length)continue;j!==x[0]&&k.push(A.length/2);const q=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),ee=q.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(ee+j.length-1,ee),A.push(j[0].x),A.push(j[0].y);for(let le=1;le<j.length;le++)this.layoutVertexArray.emplaceBack(j[le].x,j[le].y),this.indexArray2.emplaceBack(ee+le-1,ee+le),A.push(j[le].x),A.push(j[le].y);q.vertexLength+=j.length,q.primitiveLength+=j.length}const F=ip(A,k);for(let j=0;j<F.length;j+=3)this.indexArray.emplaceBack(M+F[j],M+F[j+1],M+F[j+2]);D.vertexLength+=E,D.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,g,y,f)}}Vt(zd,{omit:["layers","patternFeatures"]});const Ry=new B({"fill-sort-key":new S($e.layout_fill["fill-sort-key"])});var Oy={paint:new B({"fill-antialias":new C($e.paint_fill["fill-antialias"]),"fill-opacity":new S($e.paint_fill["fill-opacity"]),"fill-color":new S($e.paint_fill["fill-color"]),"fill-outline-color":new S($e.paint_fill["fill-outline-color"]),"fill-translate":new C($e.paint_fill["fill-translate"]),"fill-translate-anchor":new C($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new P($e.paint_fill["fill-pattern"])}),layout:Ry};const wu=ge([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Sa=ge([{name:"a_centroid_pos",components:2,type:"Uint16"}]),S0=ge([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:I0}=wu;var hp=Mh;function Mh(o,r,s,c,f){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=f,o.readFields(gs,this,r)}function gs(o,r,s){1==o?r.id=s.readVarint():2==o?function(c,f){for(var g=c.readVarint()+c.pos;c.pos<g;){var y=f._keys[c.readVarint()],x=f._values[c.readVarint()];f.properties[y]=x}}(s,r):3==o?r.type=s.readVarint():4==o&&(r._geometry=s.pos)}function dp(o){for(var r,s,c=0,f=0,g=o.length,y=g-1;f<g;y=f++)c+=((s=o[y]).x-(r=o[f]).x)*(r.y+s.y);return c}Mh.types=["Unknown","Point","LineString","Polygon"],Mh.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var r,s=o.readVarint()+o.pos,c=1,f=0,g=0,y=0,x=[];o.pos<s;){if(f<=0){var E=o.readVarint();c=7&E,f=E>>3}if(f--,1===c||2===c)g+=o.readSVarint(),y+=o.readSVarint(),1===c&&(r&&x.push(r),r=[]),r.push(new $(g,y));else{if(7!==c)throw new Error("unknown command "+c);r&&r.push(r[0].clone())}}return r&&x.push(r),x},Mh.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var r=o.readVarint()+o.pos,s=1,c=0,f=0,g=0,y=1/0,x=-1/0,E=1/0,D=-1/0;o.pos<r;){if(c<=0){var M=o.readVarint();s=7&M,c=M>>3}if(c--,1===s||2===s)(f+=o.readSVarint())<y&&(y=f),f>x&&(x=f),(g+=o.readSVarint())<E&&(E=g),g>D&&(D=g);else if(7!==s)throw new Error("unknown command "+s)}return[y,E,x,D]},Mh.prototype.toGeoJSON=function(o,r,s){var c,f,g=this.extent*Math.pow(2,s),y=this.extent*o,x=this.extent*r,E=this.loadGeometry(),D=Mh.types[this.type];function M(F){for(var j=0;j<F.length;j++){var q=F[j];F[j]=[360*(q.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+x)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(c=0;c<E.length;c++)A[c]=E[c][0];M(E=A);break;case 2:for(c=0;c<E.length;c++)M(E[c]);break;case 3:for(E=function(F){var j=F.length;if(j<=1)return[F];for(var q,ee,le=[],Ee=0;Ee<j;Ee++){var Pe=dp(F[Ee]);0!==Pe&&(void 0===ee&&(ee=Pe<0),ee===Pe<0?(q&&le.push(q),q=[F[Ee]]):q.push(F[Ee]))}return q&&le.push(q),le}(E),c=0;c<E.length;c++)for(f=0;f<E[c].length;f++)M(E[c][f])}1===E.length?E=E[0]:D="Multi"+D;var k={type:"Feature",geometry:{type:D,coordinates:E},properties:this.properties};return"id"in this&&(k.id=this.id),k};var Nd=og;function og(o,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(sg,this,r),this.length=this._features.length}function sg(o,r,s){15===o?r.version=s.readVarint():1===o?r.name=s.readString():5===o?r.extent=s.readVarint():2===o?r._features.push(s.pos):3===o?r._keys.push(s.readString()):4===o&&r._values.push(function(c){for(var f=null,g=c.readVarint()+c.pos;c.pos<g;){var y=c.readVarint()>>3;f=1===y?c.readString():2===y?c.readFloat():3===y?c.readDouble():4===y?c.readVarint64():5===y?c.readVarint():6===y?c.readSVarint():7===y?c.readBoolean():null}return f}(s))}function Ah(o,r,s){if(3===o){var c=new Nd(s,s.readVarint()+s.pos);c.length&&(r[c.name]=c)}}og.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var r=this._pbf.readVarint()+this._pbf.pos;return new hp(this._pbf,r,this.extent,this._keys,this._values)};var Bl={VectorTile:function(o,r){this.layers=o.readFields(Ah,{},r)},VectorTileFeature:hp,VectorTileLayer:Nd};function Ph(o,r,s,c){const f=[],g=0===c?(y,x,E,D,M,A)=>{y.push(new $(A,E+(A-x)/(D-x)*(M-E)))}:(y,x,E,D,M,A)=>{y.push(new $(x+(A-E)/(M-E)*(D-x),A))};for(const y of o){const x=[];for(const E of y){if(E.length<=2)continue;const D=[];for(let k=0;k<E.length-1;k++){const F=E[k].x,j=E[k].y,q=E[k+1].x,ee=E[k+1].y,le=0===c?F:j,Ee=0===c?q:ee;le<r?Ee>r&&g(D,F,j,q,ee,r):le>s?Ee<s&&g(D,F,j,q,ee,s):D.push(E[k]),Ee<r&&le>=r&&g(D,F,j,q,ee,r),Ee>s&&le<=s&&g(D,F,j,q,ee,s)}let M=E[E.length-1];const A=0===c?M.x:M.y;A>=r&&A<=s&&D.push(M),D.length&&(M=D[D.length-1],D[0].x===M.x&&D[0].y===M.y||D.push(D[0]),x.push(D))}x.length&&f.push(x)}return f}const fp=Bl.VectorTileFeature.types,pp=Math.pow(2,13);function Eu(o,r,s,c,f,g,y,x){o.emplaceBack((r<<1)+y,(s<<1)+g,(Math.floor(c*pp)<<1)+f,Math.round(x))}function Bd(o,r,s){o.emplaceBack(r.x,r.y,r.z,16384*s[0],16384*s[1],16384*s[2])}class _c{constructor(){this.acc=new $(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new $(r.x,r.y),this.max=new $(r.x,r.y))}append(r,s){this.currentPolyCount.edges++,this.acc._add(r);const c=this.min,f=this.max;r.x<c.x?c.x=r.x:r.x>f.x&&(f.x=r.x),r.y<c.y?c.y=r.y:r.y>f.y&&(f.y=r.y),((0===r.x||r.x===In)&&r.x===s.x)!=((0===r.y||r.y===In)&&r.y===s.y)&&this.processBorderOverlap(r,s),s.x<0!=r.x<0&&this.addBorderIntersection(0,At(s.y,r.y,(0-s.x)/(r.x-s.x))),s.x>In!=r.x>In&&this.addBorderIntersection(1,At(s.y,r.y,(In-s.x)/(r.x-s.x))),s.y<0!=r.y<0&&this.addBorderIntersection(2,At(s.x,r.x,(0-s.y)/(r.y-s.y))),s.y>In!=r.y>In&&this.addBorderIntersection(3,At(s.x,r.x,(In-s.y)/(r.y-s.y)))}addBorderIntersection(r,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[r];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(r,s){if(r.x===s.x){if(r.y===s.y)return;const c=0===r.x?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,r.y)}else{const c=0===r.y?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,r.x)}}centroid(){const r=this.polyCount.reduce((s,c)=>s+c.edges,0);return 0!==r?this.acc.div(r)._round():new $(0,0)}span(){return new $(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,s)=>r+ +(s[0]!==Number.MAX_VALUE),0)}}class yc{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new ve,this.centroidVertexArray=new wo,this.indexArray=new Ke,this.programConfigurations=new hc(r.layers,r.zoom),this.segments=new ai,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=r.enableTerrain}populate(r,s,c,f){this.features=[],this.hasPattern=cp("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const y=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*y/(y*y+1)/In/(1<<g.z)}(c);for(const{feature:g,id:y,index:x,sourceLayerIndex:E}of r){const D=this.layers[0]._featureFilter.needGeometry,M=Ll(g,D);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),M,c))continue;const A={id:y,sourceLayerIndex:E,index:x,geometry:D?M.geometry:Ol(g,c,f),properties:g.properties,type:g.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(up("fill-extrusion",this.layers,A,this.zoom,s)):this.addFeature(A,A.geometry,x,c,{},s.availableImages,f),s.featureIndex.insert(g,A.geometry,x,E,this.index,k)}this.sortBorders()}addFeatures(r,s,c,f,g){for(const y of this.features){const{geometry:x}=y;this.addFeature(y,x,y.index,s,c,f,g)}this.sortBorders()}update(r,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,I0),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,S0.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Sa.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,c,f,g,y,x){const E=[new $(0,0),new $(In,In)],D=x.projection,M="globe"===D.name,A=this.enableTerrain&&!M?new _c:null;M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ko);const k=lp(s,500);for(let q=k.length-1;q>=0;q--){const ee=k[q];(0===ee.length||(F=ee[0]).every(le=>le.x<=0)||F.every(le=>le.x>=In)||F.every(le=>le.y<=0)||F.every(le=>le.y>=In))&&k.splice(q,1)}var F;let j;if(M){const ee=1<<f.z,le=Vs(f.x/ee),Ee=Vs((f.x+1)/ee),Pe=Gi(f.y/ee),Re=Gi((f.y+1)/ee);j=function(Le,Fe,Ye,Qe,at=0,dt){const qe=[];if(!Le.length||!Ye||!Qe)return qe;const tt=(mn,ln)=>{for(const Zt of mn)qe.push({polygon:Zt,bounds:ln})},pt=Math.ceil(Math.log2(Ye)),Ct=Math.ceil(Math.log2(Qe)),wt=pt-Ct,St=[];for(let mn=0;mn<Math.abs(wt);mn++)St.push(wt>0?0:1);for(let mn=0;mn<Math.min(pt,Ct);mn++)St.push(0),St.push(1);let _n=Le;if(_n=Ph(_n,Fe[0].y-at,Fe[1].y+at,1),_n=Ph(_n,Fe[0].x-at,Fe[1].x+at,0),!_n.length)return qe;const Dn=[];for(St.length?Dn.push({polygons:_n,bounds:Fe,depth:0}):tt(_n,Fe);Dn.length;){const mn=Dn.pop(),ln=mn.depth,Zt=St[ln],zt=mn.bounds[0],Sn=mn.bounds[1],ar=0===Zt?zt.x:zt.y,Jr=0===Zt?Sn.x:Sn.y,yr=dt?dt(Zt,ar,Jr):.5*(ar+Jr),Qr=Ph(mn.polygons,ar-at,yr+at,Zt),Kn=Ph(mn.polygons,yr-at,Jr+at,Zt);if(Qr.length){const Un=[zt,new $(0===Zt?yr:Sn.x,1===Zt?yr:Sn.y)];St.length>ln+1?Dn.push({polygons:Qr,bounds:Un,depth:ln+1}):tt(Qr,Un)}if(Kn.length){const Un=[new $(0===Zt?yr:zt.x,1===Zt?yr:zt.y),Sn];St.length>ln+1?Dn.push({polygons:Kn,bounds:Un,depth:ln+1}):tt(Kn,Un)}}return qe}(k,E,Math.ceil((Ee-le)/11.25),Math.ceil((Pe-Re)/11.25),1,(Le,Fe,Ye)=>{if(0===Le)return.5*(Fe+Ye);{const Qe=Gi((f.y+Fe/In)/ee);return(dc(.5*(Gi((f.y+Ye/In)/ee)+Qe))*ee-f.y)*In}})}else{j=[];for(const q of k)j.push({polygon:q,bounds:E})}for(const q of j){const ee=q.polygon;let le=0,Ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Ye=0;Ye<ee.length;Ye++){const Qe=ee[Ye];if(0===Qe.length)continue;le+=Qe.length;let at=0;A&&A.startRing(Qe[0]);for(let dt=0;dt<Qe.length;dt++){const qe=Qe[dt];if(dt>=1){const tt=Qe[dt-1];if(!ag(qe,tt,q.bounds)){A&&A.append(qe,tt),Ee.vertexLength+4>ai.MAX_VERTEX_ARRAY_LENGTH&&(Ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const pt=qe.sub(tt)._perp(),Ct=pt.x/(Math.abs(pt.x)+Math.abs(pt.y)),wt=pt.y>0?1:0,St=tt.dist(qe);at+St>32768&&(at=0),Eu(this.layoutVertexArray,qe.x,qe.y,Ct,wt,0,0,at),Eu(this.layoutVertexArray,qe.x,qe.y,Ct,wt,0,1,at),at+=St,Eu(this.layoutVertexArray,tt.x,tt.y,Ct,wt,0,0,at),Eu(this.layoutVertexArray,tt.x,tt.y,Ct,wt,0,1,at);const _n=Ee.vertexLength;if(this.indexArray.emplaceBack(_n,_n+2,_n+1),this.indexArray.emplaceBack(_n+1,_n+2,_n+3),Ee.vertexLength+=4,Ee.primitiveLength+=2,M){const Dn=this.layoutVertexExtArray,mn=D.projectTilePoint(qe.x,qe.y,f),ln=D.projectTilePoint(tt.x,tt.y,f),Zt=D.upVector(f,qe.x,qe.y),zt=D.upVector(f,tt.x,tt.y);Bd(Dn,mn,Zt),Bd(Dn,mn,Zt),Bd(Dn,ln,zt),Bd(Dn,ln,zt)}}}}}if(Ee.vertexLength+le>ai.MAX_VERTEX_ARRAY_LENGTH&&(Ee=this.segments.prepareSegment(le,this.layoutVertexArray,this.indexArray)),"Polygon"!==fp[r.type])continue;const Pe=[],Re=[],Le=Ee.vertexLength;for(let Ye=0;Ye<ee.length;Ye++){const Qe=ee[Ye];if(0!==Qe.length){Qe!==ee[0]&&Re.push(Pe.length/2);for(let at=0;at<Qe.length;at++){const dt=Qe[at];Eu(this.layoutVertexArray,dt.x,dt.y,0,0,1,1,0),Pe.push(dt.x),Pe.push(dt.y),A&&A.currentPolyCount.top++,M&&Bd(this.layoutVertexExtArray,D.projectTilePoint(dt.x,dt.y,f),D.upVector(f,dt.x,dt.y))}}}const Fe=ip(Pe,Re);for(let Ye=0;Ye<Fe.length;Ye+=3)this.indexArray.emplaceBack(Le+Fe[Ye],Le+Fe[Ye+2],Le+Fe[Ye+1]);Ee.primitiveLength+=Fe.length/3,Ee.vertexLength+=le}if(A&&A.polyCount.length>0){if(A.borders){A.vertexArrayOffset=this.centroidVertexArray.length;const q=A.borders,ee=this.featuresOnBorder.push(A)-1;for(let le=0;le<4;le++)q[le][0]!==Number.MAX_VALUE&&this.borders[le].push(ee)}this.encodeCentroid(A.borders?void 0:A.centroid(),A)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,g,y,f)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((s,c)=>this.featuresOnBorder[s].borders[r][0]-this.featuresOnBorder[c].borders[r][0])}encodeCentroid(r,s,c=!0){let f,g;if(r)if(0!==r.y){const x=s.span()._mult(this.tileToMeter);f=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),g=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else f=Math.ceil(7*(r.x+450)),g=0;else f=0,g=+c;let y=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const x of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(y++,0,g),this.centroidVertexArray.emplace(y++,f,g);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(y++,f,g)}}}function ag(o,r,s){return o.x===r.x&&(o.x<s[0].x||o.x>s[1].x)||o.y===r.y&&(o.y<s[0].y||o.y>s[1].y)}Vt(yc,{omit:["layers","features"]}),Vt(_c);var Ly={paint:new B({"fill-extrusion-opacity":new C($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new S($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new C($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new C($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new P($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new S($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new S($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new C($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function vc(o,r){return o.x*r.x+o.y*r.y}function lg(o,r){if(1===o.length){let s=0;const c=r[s++];let f;for(;!f||c.equals(f);)if(f=r[s++],!f)return 1/0;for(;s<r.length;s++){const g=r[s],y=o[0],x=f.sub(c),E=g.sub(c),D=y.sub(c),M=vc(x,x),A=vc(x,E),k=vc(E,E),F=vc(D,x),j=vc(D,E),q=M*k-A*A,ee=(k*F-A*j)/q,le=(M*j-A*F)/q,Ee=c.z*(1-ee-le)+f.z*ee+g.z*le;if(isFinite(Ee))return Ee}return 1/0}{let s=1/0;for(const c of r)s=Math.min(s,c.z);return s}}function cg(o){const r=new $(o[0],o[1]);return r.z=o[2],r}function Fy(o,r,s,c,f,g,y,x){const E=y*f.getElevationAt(o,r,!0,!0),D=0!==g[0],M=D?0===g[1]?y*(g[0]/7-450):y*function(A,k,F){const j=Math.floor(k[0]/8),q=Math.floor(k[1]/8),ee=10*(k[0]-8*j),le=10*(k[1]-8*q),Ee=A.getElevationAt(j,q,!0,!0),Pe=A.getMeterToDEM(F),Re=Math.floor(.5*(ee*Pe-1)),Le=Math.floor(.5*(le*Pe-1)),Fe=A.tileCoordToPixel(j,q),Ye=2*Re+1,Qe=2*Le+1,at=(Dn=Ye,mn=Qe,[(wt=A).getElevationAtPixel(St=Fe.x-Re,_n=Fe.y-Le,!0),wt.getElevationAtPixel(St+mn,_n,!0),wt.getElevationAtPixel(St,_n+mn,!0),wt.getElevationAtPixel(St+Dn,_n+mn,!0)]),dt=Math.abs(at[0]-at[1]),qe=Math.abs(at[2]-at[3]),tt=Math.abs(at[0]-at[2])+Math.abs(at[1]-at[3]),pt=Math.min(.25,.5*Pe*(dt+qe)/Ye),Ct=Math.min(.25,.5*Pe*tt/Qe);var wt,St,_n,Dn,mn;return Ee+Math.max(pt*ee,Ct*le)}(f,g,x):E;return{base:E+(0===s)?-1:s,top:D?Math.max(M+c,E+s+2):E+c}}const zy=ge([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ny}=zy,By=ge([{name:"a_packed",components:3,type:"Float32"}]),{members:ug}=By,mp=Bl.VectorTileFeature.types,hg=Math.cos(Math.PI/180*37.5);class Tu{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new he,this.layoutVertexArray2=new Ce,this.indexArray=new Ke,this.programConfigurations=new hc(r.layers,r.zoom),this.segments=new ai,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,c,f){this.hasPattern=cp("line",this.layers,s);const g=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:M,id:A,index:k,sourceLayerIndex:F}of r){const j=this.layers[0]._featureFilter.needGeometry,q=Ll(M,j);if(!this.layers[0]._featureFilter.filter(new kr(this.zoom),q,c))continue;const ee=g?g.evaluate(q,{},c):void 0,le={id:A,properties:M.properties,type:M.type,sourceLayerIndex:F,index:k,geometry:j?q.geometry:Ol(M,c,f),patterns:{},sortKey:ee};y.push(le)}g&&y.sort((M,A)=>M.sortKey-A.sortKey);const{lineAtlas:x,featureIndex:E}=s,D=this.addConstantDashes(x);for(const M of y){const{geometry:A,index:k,sourceLayerIndex:F}=M;if(D&&this.addFeatureDashes(M,x),this.hasPattern){const j=up("line",this.layers,M,this.zoom,s);this.patternFeatures.push(j)}else this.addFeature(M,A,k,c,x.positions,s.availableImages);E.insert(r[k].feature,A,k,F,this.index)}}addConstantDashes(r){let s=!1;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==g.kind)s=!0;else{const y=g.value,x=f.value;if(!x)continue;r.addDash(x.from,y),r.addDash(x.to,y),x.other&&r.addDash(x.other,y)}}return s}addFeatureDashes(r,s){const c=this.zoom;for(const f of this.layers){const g=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===y.kind)continue;let x,E,D,M,A,k;if("constant"===g.kind){const ee=g.value;if(!ee)continue;x=ee.other||ee.to,E=ee.to,D=ee.from}else x=g.evaluate({zoom:c-1},r),E=g.evaluate({zoom:c},r),D=g.evaluate({zoom:c+1},r);"constant"===y.kind?M=A=k=y.value:(M=y.evaluate({zoom:c-1},r),A=y.evaluate({zoom:c},r),k=y.evaluate({zoom:c+1},r)),s.addDash(x,M),s.addDash(E,A),s.addDash(D,k);const F=s.getKey(x,M),j=s.getKey(E,A),q=s.getKey(D,k);r.patterns[f.id]={min:F,mid:j,max:q}}}update(r,s,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c,f)}addFeatures(r,s,c,f,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,s,c,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,ug)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ny),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,s,c,f,g,y){const x=this.layers[0].layout,E=x.get("line-join").evaluate(r,{}),D=x.get("line-cap").evaluate(r,{}),M=x.get("line-miter-limit"),A=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const k of s)this.addLine(k,r,E,D,M,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,g,y,f)}addLine(r,s,c,f,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<r.length-1;le++)this.totalDistance+=r[le].dist(r[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===mp[s.type];let E=r.length;for(;E>=2&&r[E-1].equals(r[E-2]);)E--;let D=0;for(;D<E-1&&r[D].equals(r[D+1]);)D++;if(E<(x?3:2))return;"bevel"===c&&(g=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,A=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let k,F,j,q,ee;this.e1=this.e2=-1,x&&(k=r[E-2],ee=r[D].sub(k)._unit()._perp());for(let le=D;le<E;le++){if(j=le===E-1?x?r[D+1]:void 0:r[le+1],j&&r[le].equals(j))continue;ee&&(q=ee),k&&(F=k),k=r[le],ee=j?j.sub(k)._unit()._perp():q,q=q||ee;let Ee=q.add(ee);0===Ee.x&&0===Ee.y||Ee._unit();const Pe=q.x*ee.x+q.y*ee.y,Re=Ee.x*ee.x+Ee.y*ee.y,Le=0!==Re?1/Re:1/0,Fe=2*Math.sqrt(2-2*Re),Ye=Re<hg&&F&&j,Qe=q.x*ee.y-q.y*ee.x>0;if(Ye&&le>D){const qe=k.dist(F);if(qe>2*M){const tt=k.sub(k.sub(F)._mult(M/qe)._round());this.updateDistance(F,tt),this.addCurrentVertex(tt,q,0,0,A),F=tt}}const at=F&&j;let dt=at?c:x?"butt":f;if(at&&"round"===dt&&(Le<y?dt="miter":Le<=2&&(dt="fakeround")),"miter"===dt&&Le>g&&(dt="bevel"),"bevel"===dt&&(Le>2&&(dt="flipbevel"),Le<g&&(dt="miter")),F&&this.updateDistance(F,k),"miter"===dt)Ee._mult(Le),this.addCurrentVertex(k,Ee,0,0,A);else if("flipbevel"===dt){if(Le>100)Ee=ee.mult(-1);else{const qe=Le*q.add(ee).mag()/q.sub(ee).mag();Ee._perp()._mult(qe*(Qe?-1:1))}this.addCurrentVertex(k,Ee,0,0,A),this.addCurrentVertex(k,Ee.mult(-1),0,0,A)}else if("bevel"===dt||"fakeround"===dt){const qe=-Math.sqrt(Le*Le-1),tt=Qe?qe:0,pt=Qe?0:qe;if(F&&this.addCurrentVertex(k,q,tt,pt,A),"fakeround"===dt){const Ct=Math.round(180*Fe/Math.PI/20);for(let wt=1;wt<Ct;wt++){let St=wt/Ct;if(.5!==St){const Dn=St-.5;St+=St*Dn*(St-1)*((1.0904+Pe*(Pe*(3.55645-1.43519*Pe)-3.2452))*Dn*Dn+(.848013+Pe*(.215638*Pe-1.06021)))}const _n=ee.sub(q)._mult(St)._add(q)._unit()._mult(Qe?-1:1);this.addHalfVertex(k,_n.x,_n.y,!1,Qe,0,A)}}j&&this.addCurrentVertex(k,ee,-tt,-pt,A)}else if("butt"===dt)this.addCurrentVertex(k,Ee,0,0,A);else if("square"===dt){const qe=F?1:-1;F||this.addCurrentVertex(k,Ee,qe,qe,A),this.addCurrentVertex(k,Ee,0,0,A),F&&this.addCurrentVertex(k,Ee,qe,qe,A)}else"round"===dt&&(F&&(this.addCurrentVertex(k,q,0,0,A),this.addCurrentVertex(k,q,1,1,A,!0)),j&&(this.addCurrentVertex(k,ee,-1,-1,A,!0),this.addCurrentVertex(k,ee,0,0,A)));if(Ye&&le<E-1){const qe=k.dist(j);if(qe>2*M){const tt=k.add(j.sub(k)._mult(M/qe)._round());this.updateDistance(k,tt),this.addCurrentVertex(tt,ee,0,0,A),k=tt}}}}addCurrentVertex(r,s,c,f,g,y=!1){const x=s.y*f-s.x,E=-s.y-s.x*f;this.addHalfVertex(r,s.x+s.y*c,s.y-s.x*c,y,!1,c,g),this.addHalfVertex(r,x,E,y,!0,-f,g)}addHalfVertex({x:r,y:s},c,f,g,y,x,E){this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(s<<1)+(y?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const D=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),E.primitiveLength++),y?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,s){this.distance+=r.dist(s),this.updateScaledDistance()}}Vt(Tu,{omit:["layers","patternFeatures"]});const jy=new B({"line-cap":new S($e.layout_line["line-cap"]),"line-join":new S($e.layout_line["line-join"]),"line-miter-limit":new C($e.layout_line["line-miter-limit"]),"line-round-limit":new C($e.layout_line["line-round-limit"]),"line-sort-key":new S($e.layout_line["line-sort-key"])});var dg={paint:new B({"line-opacity":new S($e.paint_line["line-opacity"]),"line-color":new S($e.paint_line["line-color"]),"line-translate":new C($e.paint_line["line-translate"]),"line-translate-anchor":new C($e.paint_line["line-translate-anchor"]),"line-width":new S($e.paint_line["line-width"]),"line-gap-width":new S($e.paint_line["line-gap-width"]),"line-offset":new S($e.paint_line["line-offset"]),"line-blur":new S($e.paint_line["line-blur"]),"line-dasharray":new P($e.paint_line["line-dasharray"]),"line-pattern":new P($e.paint_line["line-pattern"]),"line-gradient":new L($e.paint_line["line-gradient"])}),layout:jy};const gp=new class extends S{possiblyEvaluate(o,r){return r=new kr(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(o,r)}evaluate(o,r,s,c){return r=rt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(o,r,s,c)}}(dg.paint.properties["line-width"].specification);function _p(o,r){return r>0?r+2*o:o}gp.useIntegerZoom=!0;const xc=ge([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),fg=ge([{name:"a_projected_pos",components:3,type:"Float32"}],4);ge([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pg=ge([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Uy=ge([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const kh=ge([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Vy=ge([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ge([{name:"triangle",components:3,type:"Uint16"}]),ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ge([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ge([{type:"Float32",name:"offsetX"}]),ge([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const oa=128;function jd(o,r){const{expression:s}=r;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new kr(o+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:f}=s;let g=0;for(;g<c.length&&c[g]<=o;)g++;g=Math.max(0,g-1);let y=g;for(;y<c.length&&c[y]<o+1;)y++;y=Math.min(c.length-1,y);const x=c[g],E=c[y];return"composite"===s.kind?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:x,maxZoom:E,minSize:s.evaluate(new kr(x)),maxSize:s.evaluate(new kr(E)),interpolationType:f}}}function Cu(o,{uSize:r,uSizeT:s},{lowerSize:c,upperSize:f}){return"source"===o.kind?c/oa:"composite"===o.kind?At(c/oa,f/oa,s):r}function bc(o,r){let s=0,c=0;if("constant"===o.kind)c=o.layoutSize;else if("source"!==o.kind){const{interpolationType:f,minZoom:g,maxZoom:y}=o,x=f?J(Hr.interpolationFactor(f,r,g,y),0,1):0;"camera"===o.kind?c=At(o.minSize,o.maxSize,x):s=x}return{uSizeT:s,uSize:c}}var Ud=Object.freeze({__proto__:null,getSizeData:jd,evaluateSizeForFeature:Cu,evaluateSizeForZoom:bc,SIZE_PACK_FACTOR:oa});function Vd(o,r,s){return o.sections.forEach(c=>{c.text=function(f,g,y){const x=g.layout.get("text-transform").evaluate(y,{});return"uppercase"===x?f=f.toLocaleUpperCase():"lowercase"===x&&(f=f.toLocaleLowerCase()),co.applyArabicShaping&&(f=co.applyArabicShaping(f)),f}(c.text,r,s)}),o}const Du={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function yp(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function mg(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var $d=function(o,r,s,c,f){var g,y,x=8*f-c-1,E=(1<<x)-1,D=E>>1,M=-7,A=s?f-1:0,k=s?-1:1,F=o[r+A];for(A+=k,g=F&(1<<-M)-1,F>>=-M,M+=x;M>0;g=256*g+o[r+A],A+=k,M-=8);for(y=g&(1<<-M)-1,g>>=-M,M+=c;M>0;y=256*y+o[r+A],A+=k,M-=8);if(0===g)g=1-D;else{if(g===E)return y?NaN:1/0*(F?-1:1);y+=Math.pow(2,c),g-=D}return(F?-1:1)*y*Math.pow(2,g-c)},Su=function(o,r,s,c,f,g){var y,x,E,D=8*g-f-1,M=(1<<D)-1,A=M>>1,k=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,F=c?0:g-1,j=c?1:-1,q=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,y=M):(y=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-y))<1&&(y--,E*=2),(r+=y+A>=1?k/E:k*Math.pow(2,1-A))*E>=2&&(y++,E/=2),y+A>=M?(x=0,y=M):y+A>=1?(x=(r*E-1)*Math.pow(2,f),y+=A):(x=r*Math.pow(2,A-1)*Math.pow(2,f),y=0));f>=8;o[s+F]=255&x,F+=j,x/=256,f-=8);for(y=y<<f|x,D+=f;D>0;o[s+F]=255&y,F+=j,y/=256,D-=8);o[s+F-j]|=128*q},Rh=Mr;function Mr(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Mr.Varint=0,Mr.Fixed64=1,Mr.Bytes=2,Mr.Fixed32=5;var vp=4294967296,gg=1/vp,xp="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function sa(o){return o.type===Mr.Bytes?o.readVarint()+o.pos:o.pos+1}function $y(o,r,s){var c=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));s.realloc(c);for(var f=s.pos-1;f>=o;f--)s.buf[f+c]=s.buf[f]}function _g(o,r){for(var s=0;s<o.length;s++)r.writeVarint(o[s])}function Gy(o,r){for(var s=0;s<o.length;s++)r.writeSVarint(o[s])}function yg(o,r){for(var s=0;s<o.length;s++)r.writeFloat(o[s])}function Hy(o,r){for(var s=0;s<o.length;s++)r.writeDouble(o[s])}function qy(o,r){for(var s=0;s<o.length;s++)r.writeBoolean(o[s])}function aa(o,r){for(var s=0;s<o.length;s++)r.writeFixed32(o[s])}function Zy(o,r){for(var s=0;s<o.length;s++)r.writeSFixed32(o[s])}function vg(o,r){for(var s=0;s<o.length;s++)r.writeFixed64(o[s])}function Wy(o,r){for(var s=0;s<o.length;s++)r.writeSFixed64(o[s])}function Gd(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+16777216*o[r+3]}function Iu(o,r,s){o[s]=r,o[s+1]=r>>>8,o[s+2]=r>>>16,o[s+3]=r>>>24}function xg(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+(o[r+3]<<24)}function bg(o,r,s){r.glyphs=[],1===o&&s.readMessage(Xy,r)}function Xy(o,r,s){if(3===o){const{id:c,bitmap:f,width:g,height:y,left:x,top:E,advance:D}=s.readMessage(Ky,{});r.glyphs.push({id:c,bitmap:new Da({width:g+6,height:y+6},f),metrics:{width:g,height:y,left:x,top:E,advance:D}})}else 4===o?r.ascender=s.readSVarint():5===o&&(r.descender=s.readSVarint())}function Ky(o,r,s){1===o?r.id=s.readVarint():2===o?r.bitmap=s.readBytes():3===o?r.width=s.readVarint():4===o?r.height=s.readVarint():5===o?r.left=s.readSVarint():6===o?r.top=s.readSVarint():7===o&&(r.advance=s.readVarint())}function bp(o){let r=0,s=0;for(const y of o)r+=y.w*y.h,s=Math.max(s,y.w);o.sort((y,x)=>x.h-y.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),s),h:1/0}];let f=0,g=0;for(const y of o)for(let x=c.length-1;x>=0;x--){const E=c[x];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,g=Math.max(g,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===E.w&&y.h===E.h){const D=c.pop();x<c.length&&(c[x]=D)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(c.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:f,h:g,fill:r/(f*g)||0}}Mr.prototype={destroy:function(){this.buf=null},readFields:function(o,r,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),f=c>>3,g=this.pos;this.type=7&c,o(f,r,this),this.pos===g&&this.skip(c)}return r},readMessage:function(o,r){return this.readFields(o,r,this.readVarint()+this.pos)},readFixed32:function(){var o=Gd(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=xg(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Gd(this.buf,this.pos)+Gd(this.buf,this.pos+4)*vp;return this.pos+=8,o},readSFixed64:function(){var o=Gd(this.buf,this.pos)+xg(this.buf,this.pos+4)*vp;return this.pos+=8,o},readFloat:function(){var o=$d(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=$d(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var r,s,c=this.buf;return r=127&(s=c[this.pos++]),s<128?r:(r|=(127&(s=c[this.pos++]))<<7,s<128?r:(r|=(127&(s=c[this.pos++]))<<14,s<128?r:(r|=(127&(s=c[this.pos++]))<<21,s<128?r:function(f,g,y){var x,E,D=y.buf;if(x=(112&(E=D[y.pos++]))>>4,E<128||(x|=(127&(E=D[y.pos++]))<<3,E<128)||(x|=(127&(E=D[y.pos++]))<<10,E<128)||(x|=(127&(E=D[y.pos++]))<<17,E<128)||(x|=(127&(E=D[y.pos++]))<<24,E<128)||(x|=(1&(E=D[y.pos++]))<<31,E<128))return function wc(o,r,s){return s?4294967296*r+(o>>>0):4294967296*(r>>>0)+(o>>>0)}(f,x,g);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,r=this.pos;return this.pos=o,o-r>=12&&xp?xp.decode(this.buf.subarray(r,o)):function(s,c,f){for(var g="",y=c;y<f;){var x,E,D,M=s[y],A=null,k=M>239?4:M>223?3:M>191?2:1;if(y+k>f)break;1===k?M<128&&(A=M):2===k?128==(192&(x=s[y+1]))&&(A=(31&M)<<6|63&x)<=127&&(A=null):3===k?(E=s[y+2],128==(192&(x=s[y+1]))&&128==(192&E)&&((A=(15&M)<<12|(63&x)<<6|63&E)<=2047||A>=55296&&A<=57343)&&(A=null)):4===k&&(E=s[y+2],D=s[y+3],128==(192&(x=s[y+1]))&&128==(192&E)&&128==(192&D)&&((A=(15&M)<<18|(63&x)<<12|(63&E)<<6|63&D)<=65535||A>=1114112)&&(A=null)),null===A?(A=65533,k=1):A>65535&&(A-=65536,g+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),g+=String.fromCharCode(A),y+=k}return g}(this.buf,r,o)},readBytes:function(){var o=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,o);return this.pos=o,r},readPackedVarint:function(o,r){if(this.type!==Mr.Bytes)return o.push(this.readVarint(r));var s=sa(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(r));return o},readPackedSVarint:function(o){if(this.type!==Mr.Bytes)return o.push(this.readSVarint());var r=sa(this);for(o=o||[];this.pos<r;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Mr.Bytes)return o.push(this.readBoolean());var r=sa(this);for(o=o||[];this.pos<r;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Mr.Bytes)return o.push(this.readFloat());var r=sa(this);for(o=o||[];this.pos<r;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Mr.Bytes)return o.push(this.readDouble());var r=sa(this);for(o=o||[];this.pos<r;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Mr.Bytes)return o.push(this.readFixed32());var r=sa(this);for(o=o||[];this.pos<r;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Mr.Bytes)return o.push(this.readSFixed32());var r=sa(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Mr.Bytes)return o.push(this.readFixed64());var r=sa(this);for(o=o||[];this.pos<r;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Mr.Bytes)return o.push(this.readSFixed64());var r=sa(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed64());return o},skip:function(o){var r=7&o;if(r===Mr.Varint)for(;this.buf[this.pos++]>127;);else if(r===Mr.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Mr.Fixed32)this.pos+=4;else{if(r!==Mr.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(o,r){this.writeVarint(o<<3|r)},realloc:function(o){for(var r=this.length||16;r<this.pos+o;)r*=2;if(r!==this.length){var s=new Uint8Array(r);s.set(this.buf),this.buf=s,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Iu(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Iu(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Iu(this.buf,-1&o,this.pos),Iu(this.buf,Math.floor(o*gg),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Iu(this.buf,-1&o,this.pos),Iu(this.buf,Math.floor(o*gg),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(r,s){var c,f,g,x;if(r>=0?(c=r%4294967296|0,f=r/4294967296|0):(f=~(-r/4294967296),4294967295^(c=~(-r%4294967296))?c=c+1|0:(c=0,f=f+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),g=c,(x=s).buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7),function(g,y){var x=(7&g)<<4;y.buf[y.pos++]|=x|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(f,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var r=this.pos;this.pos=function(c,f,g){for(var y,x,E=0;E<f.length;E++){if((y=f.charCodeAt(E))>55295&&y<57344){if(!x){y>56319||E+1===f.length?(c[g++]=239,c[g++]=191,c[g++]=189):x=y;continue}if(y<56320){c[g++]=239,c[g++]=191,c[g++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(c[g++]=239,c[g++]=191,c[g++]=189,x=null);y<128?c[g++]=y:(y<2048?c[g++]=y>>6|192:(y<65536?c[g++]=y>>12|224:(c[g++]=y>>18|240,c[g++]=y>>12&63|128),c[g++]=y>>6&63|128),c[g++]=63&y|128)}return g}(this.buf,o,this.pos);var s=this.pos-r;s>=128&&$y(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),Su(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Su(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var r=o.length;this.writeVarint(r),this.realloc(r);for(var s=0;s<r;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,r){this.pos++;var s=this.pos;o(r,this);var c=this.pos-s;c>=128&&$y(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,r,s){this.writeTag(o,Mr.Bytes),this.writeRawMessage(r,s)},writePackedVarint:function(o,r){r.length&&this.writeMessage(o,_g,r)},writePackedSVarint:function(o,r){r.length&&this.writeMessage(o,Gy,r)},writePackedBoolean:function(o,r){r.length&&this.writeMessage(o,qy,r)},writePackedFloat:function(o,r){r.length&&this.writeMessage(o,yg,r)},writePackedDouble:function(o,r){r.length&&this.writeMessage(o,Hy,r)},writePackedFixed32:function(o,r){r.length&&this.writeMessage(o,aa,r)},writePackedSFixed32:function(o,r){r.length&&this.writeMessage(o,Zy,r)},writePackedFixed64:function(o,r){r.length&&this.writeMessage(o,vg,r)},writePackedSFixed64:function(o,r){r.length&&this.writeMessage(o,Wy,r)},writeBytesField:function(o,r){this.writeTag(o,Mr.Bytes),this.writeBytes(r)},writeFixed32Field:function(o,r){this.writeTag(o,Mr.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(o,r){this.writeTag(o,Mr.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(o,r){this.writeTag(o,Mr.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(o,r){this.writeTag(o,Mr.Fixed64),this.writeSFixed64(r)},writeVarintField:function(o,r){this.writeTag(o,Mr.Varint),this.writeVarint(r)},writeSVarintField:function(o,r){this.writeTag(o,Mr.Varint),this.writeSVarint(r)},writeStringField:function(o,r){this.writeTag(o,Mr.Bytes),this.writeString(r)},writeFloatField:function(o,r){this.writeTag(o,Mr.Fixed32),this.writeFloat(r)},writeDoubleField:function(o,r){this.writeTag(o,Mr.Fixed64),this.writeDouble(r)},writeBooleanField:function(o,r){this.writeVarintField(o,Boolean(r))}};class $n{constructor(r,{pixelRatio:s,version:c,stretchX:f,stretchY:g,content:y}){this.paddedRect=r,this.pixelRatio=s,this.stretchX=f,this.stretchY=g,this.content=y,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ec{constructor(r,s){const c={},f={};this.haveRenderCallbacks=[];const g=[];this.addImages(r,c,g),this.addImages(s,f,g);const{w:y,h:x}=bp(g),E=new Qo({width:y||1,height:x||1});for(const D in r){const M=r[D],A=c[D].paddedRect;Qo.copy(M.data,E,{x:0,y:0},{x:A.x+1,y:A.y+1},M.data)}for(const D in s){const M=s[D],A=f[D].paddedRect,k=A.x+1,F=A.y+1,j=M.data.width,q=M.data.height;Qo.copy(M.data,E,{x:0,y:0},{x:k,y:F},M.data),Qo.copy(M.data,E,{x:0,y:q-1},{x:k,y:F-1},{width:j,height:1}),Qo.copy(M.data,E,{x:0,y:0},{x:k,y:F+q},{width:j,height:1}),Qo.copy(M.data,E,{x:j-1,y:0},{x:k-1,y:F},{width:1,height:q}),Qo.copy(M.data,E,{x:0,y:0},{x:k+j,y:F},{width:1,height:q})}this.image=E,this.iconPositions=c,this.patternPositions=f}addImages(r,s,c){for(const f in r){const g=r[f],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};c.push(y),s[f]=new $n(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(r,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>r.hasImage(c)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in r.updatedImages)this.patchUpdatedImage(this.iconPositions[c],r.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],r.getImage(c),s)}patchUpdatedImage(r,s,c){if(!r||!s||r.version===s.version)return;r.version=s.version;const[f,g]=r.tl;c.update(s.data,void 0,{x:f,y:g})}}Vt($n),Vt(Ec);const es={horizontal:1,vertical:2,horizontalOnly:3};class Mu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,s){const c=new Mu;return c.scale=r||1,c.fontStack=s,c}static forImage(r){const s=new Mu;return s.imageName=r,s}}class al{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,s){const c=new al;for(let f=0;f<r.sections.length;f++){const g=r.sections[f];g.image?c.addImageSection(g):c.addTextSection(g,s)}return c}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(s,c){let f="";for(let g=0;g<s.length;g++){const y=s.charCodeAt(g+1)||null,x=s.charCodeAt(g-1)||null;f+=!c&&(y&&Xa(y)&&!Du[s[g+1]]||x&&Xa(x)&&!Du[s[g-1]])||!Du[s[g]]?s[g]:Du[s[g]]}return f}(this.text,r)}trim(){let r=0;for(let c=0;c<this.text.length&&Oh[this.text.charCodeAt(c)];c++)r++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=r&&Oh[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(r,s),this.sectionIndex=this.sectionIndex.slice(r,s)}substring(r,s){const c=new al;return c.text=this.text.substring(r,s),c.sectionIndex=this.sectionIndex.slice(r,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,s)=>Math.max(r,this.sections[s].scale),0)}addTextSection(r,s){this.text+=r.text,this.sections.push(Mu.forText(r.scale,r.fontStack||s));const c=this.sections.length-1;for(let f=0;f<r.text.length;++f)this.sectionIndex.push(c)}addImageSection(r){const s=r.image?r.image.name:"";if(0===s.length)return void un("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Mu.forImage(s)),this.sectionIndex.push(this.sections.length-1)):un("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _s(o,r,s,c,f,g,y,x,E,D,M,A,k,F,j,q){const ee=al.fromFeature(o,f);let le;A===es.vertical&&ee.verticalizePunctuation(k);const{processBidirectionalText:Ee,processStyledBidirectionalText:Pe}=co;if(Ee&&1===ee.sections.length){le=[];const Fe=Ee(ee.toString(),wg(ee,D,g,r,c,F,j));for(const Ye of Fe){const Qe=new al;Qe.text=Ye,Qe.sections=ee.sections;for(let at=0;at<Ye.length;at++)Qe.sectionIndex.push(0);le.push(Qe)}}else if(Pe){le=[];const Fe=Pe(ee.text,ee.sectionIndex,wg(ee,D,g,r,c,F,j));for(const Ye of Fe){const Qe=new al;Qe.text=Ye[0],Qe.sectionIndex=Ye[1],Qe.sections=ee.sections,le.push(Qe)}}else le=function(Fe,Ye){const Qe=[],at=Fe.text;let dt=0;for(const qe of Ye)Qe.push(Fe.substring(dt,qe)),dt=qe;return dt<at.length&&Qe.push(Fe.substring(dt,at.length)),Qe}(ee,wg(ee,D,g,r,c,F,j));const Re=[],Le={positionedLines:Re,text:ee.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Fe,Ye,Qe,at,dt,qe,tt,pt,Ct,wt,St,_n){let Dn=0,mn=0,ln=0;const Zt="right"===pt?1:"left"===pt?0:.5;let zt=!1;for(const Kn of dt){const Un=Kn.getSections();for(const cr of Un){if(cr.imageName)continue;const Rr=Ye[cr.fontStack];if(Rr&&(zt=void 0!==Rr.ascender&&void 0!==Rr.descender,!zt))break}if(!zt)break}let Sn=0;for(const Kn of dt){Kn.trim();const Un=Kn.getMaxScale(),cr=24*(Un-1),Rr={positionedGlyphs:[],lineOffset:0};Fe.positionedLines[Sn]=Rr;const Fr=Rr.positionedGlyphs;let ei=0;if(!Kn.length()){mn+=qe,++Sn;continue}let Si=0,zo=0;for(let Tr=0;Tr<Kn.length();Tr++){const fo=Kn.getSection(Tr),No=Kn.getSectionIndex(Tr),Oi=Kn.getCharCode(Tr);let Ii=fo.scale,$r=null,zr=null,Bo=null,So=24,pi=0;const po=!(Ct===es.horizontal||!St&&!Wa(Oi)||St&&(Oh[Oi]||(ar=Oi,Qu(ar)||ea(ar)||Oo(ar)||Vi(ar)||su(ar))));if(fo.imageName){const mo=at[fo.imageName];if(!mo)continue;Bo=fo.imageName,Fe.iconsInText=Fe.iconsInText||!0,zr=mo.paddedRect;const Li=mo.displaySize;Ii=24*Ii/_n,$r={width:Li[0],height:Li[1],left:1,top:-3,advance:po?Li[1]:Li[0],localGlyph:!1},pi=zt?-$r.height*Ii:24*Un-17-Li[1]*Ii,So=$r.advance;const ws=(po?Li[0]:Li[1])*Ii-24*Un;ws>0&&ws>ei&&(ei=ws)}else{const mo=Qe[fo.fontStack];if(!mo)continue;mo[Oi]&&(zr=mo[Oi]);const Li=Ye[fo.fontStack];if(!Li)continue;const ws=Li.glyphs[Oi];if(!ws)continue;if($r=ws.metrics,So=8203!==Oi?24:0,zt){const Hl=void 0!==Li.ascender?Math.abs(Li.ascender):0,Lu=void 0!==Li.descender?Math.abs(Li.descender):0,qh=(Hl+Lu)*Ii;Si<qh&&(Si=qh,zo=(Hl-Lu)/2*Ii),pi=-Hl*Ii}else pi=24*(Un-Ii)-17}po?(Fe.verticalizable=!0,Fr.push({glyph:Oi,imageName:Bo,x:Dn,y:mn+pi,vertical:po,scale:Ii,localGlyph:$r.localGlyph,fontStack:fo.fontStack,sectionIndex:No,metrics:$r,rect:zr}),Dn+=So*Ii+wt):(Fr.push({glyph:Oi,imageName:Bo,x:Dn,y:mn+pi,vertical:po,scale:Ii,localGlyph:$r.localGlyph,fontStack:fo.fontStack,sectionIndex:No,metrics:$r,rect:zr}),Dn+=$r.advance*Ii+wt)}0!==Fr.length&&(ln=Math.max(Dn-wt,ln),zt?Jy(Fr,Zt,ei,zo,qe*Un/2):Jy(Fr,Zt,ei,0,qe/2)),Dn=0;const Do=qe*Un+ei;Rr.lineOffset=Math.max(ei,cr),mn+=Do,++Sn}var ar;const Jr=mn,{horizontalAlign:yr,verticalAlign:Qr}=Zd(tt);(function(Kn,Un,cr,Rr,Fr,ei){const Si=(Un-cr)*Fr,zo=-ei*Rr;for(const Do of Kn)for(const Tr of Do.positionedGlyphs)Tr.x+=Si,Tr.y+=zo})(Fe.positionedLines,Zt,yr,Qr,ln,Jr),Fe.top+=-Qr*Jr,Fe.bottom=Fe.top+Jr,Fe.left+=-yr*ln,Fe.right=Fe.left+ln,Fe.hasBaseline=zt}(Le,r,s,c,le,y,x,E,A,D,k,q),!function(Fe){for(const Ye of Fe)if(0!==Ye.positionedGlyphs.length)return!1;return!0}(Re)&&Le}const Oh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Yy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Hd(o,r,s,c,f,g){if(r.imageName){const y=c[r.imageName];return y?y.displaySize[0]*r.scale*24/g+f:0}{const y=s[r.fontStack],x=y&&y.glyphs[o];return x?x.metrics.advance*r.scale+f:0}}function Ia(o,r,s,c){const f=Math.pow(o-r,2);return c?o<r?f/2:2*f:f+Math.abs(s)*s}function wp(o,r,s){let c=0;return 10===o&&(c-=1e4),s&&(c+=150),40!==o&&65288!==o||(c+=50),41!==r&&65289!==r||(c+=50),c}function Ep(o,r,s,c,f,g){let y=null,x=Ia(r,s,f,g);for(const E of c){const D=Ia(r-E.x,s,f,g)+E.badness;D<=x&&(y=E,x=D)}return{index:o,x:r,priorBreak:y,badness:x}}function qd(o){return o?qd(o.priorBreak).concat(o.index):[]}function wg(o,r,s,c,f,g,y){if("point"!==g)return[];if(!o)return[];const x=[],E=function(k,F,j,q,ee,le){let Ee=0;for(let Pe=0;Pe<k.length();Pe++){const Re=k.getSection(Pe);Ee+=Hd(k.getCharCode(Pe),Re,q,ee,F,le)}return Ee/Math.max(1,Math.ceil(Ee/j))}(o,r,s,c,f,y),D=o.text.indexOf("\u200b")>=0;let M=0;for(let k=0;k<o.length();k++){const F=o.getSection(k),j=o.getCharCode(k);if(Oh[j]||(M+=Hd(j,F,c,f,r,y)),k<o.length()-1){const q=!((A=j)<11904||!(ru(A)||rh(A)||Vr(A)||lc(A)||ih(A)||eh(A)||bd(A)||nu(A)||oh(A)||ou(A)||sc(A)||ah(A)||Za(A)||nh(A)||th(A)||iu(A)||Il(A)||ta(A)||ac(A)||sh(A)));(Yy[j]||q||F.imageName)&&x.push(Ep(k+1,M,E,x,wp(j,o.getCharCode(k+1),q&&D),!1))}}var A;return qd(Ep(o.length(),M,E,x,0,!0))}function Zd(o){let r=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:r,verticalAlign:s}}function Jy(o,r,s,c,f){if(!(r||s||c||f))return;const g=o.length-1,y=o[g],x=(y.x+y.metrics.advance*y.scale)*r;for(let E=0;E<=g;E++)o[E].x-=x,o[E].y+=s+c+f}function Wd(o,r,s){const{horizontalAlign:c,verticalAlign:f}=Zd(s),g=r[0]-o.displaySize[0]*c,y=r[1]-o.displaySize[1]*f;return{image:o,top:y,bottom:y+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function Lh(o,r,s,c,f,g){const y=o.image;let x;if(y.content){const ee=y.content,le=y.pixelRatio||1;x=[ee[0]/le,ee[1]/le,y.displaySize[0]-ee[2]/le,y.displaySize[1]-ee[3]/le]}const E=r.left*g,D=r.right*g;let M,A,k,F;"width"===s||"both"===s?(F=f[0]+E-c[3],A=f[0]+D+c[1]):(F=f[0]+(E+D-y.displaySize[0])/2,A=F+y.displaySize[0]);const j=r.top*g,q=r.bottom*g;return"height"===s||"both"===s?(M=f[1]+j-c[0],k=f[1]+q+c[2]):(M=f[1]+(j+q-y.displaySize[1])/2,k=M+y.displaySize[1]),{image:y,top:M,right:A,bottom:k,left:F,collisionPadding:x}}class la extends ${constructor(r,s,c,f,g){super(r,s),this.angle=f,this.z=c,void 0!==g&&(this.segment=g)}clone(){return new la(this.x,this.y,this.z,this.angle,this.segment)}}function Xd(o,r,s,c,f){if(void 0===r.segment)return!0;let g=r,y=r.segment+1,x=0;for(;x>-s/2;){if(y--,y<0)return!1;x-=o[y].dist(g),g=o[y]}x+=o[y].dist(o[y+1]),y++;const E=[];let D=0;for(;x<s/2;){const M=o[y],A=o[y+1];if(!A)return!1;let k=o[y-1].angleTo(M)-M.angleTo(A);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:k}),D+=k;x-E[0].distance>c;)D-=E.shift().angleDelta;if(D>f)return!1;y++,x+=M.dist(A)}return!0}function Kd(o){let r=0;for(let s=0;s<o.length-1;s++)r+=o[s].dist(o[s+1]);return r}function Qy(o,r,s){return o?.6*r*s:0}function Eg(o,r){return Math.max(o?o.right-o.left:0,r?r.right-r.left:0)}function ev(o,r,s,c,f,g){const y=Qy(s,f,g),x=Eg(s,c)*g;let E=0;const D=Kd(o)/2;for(let M=0;M<o.length-1;M++){const A=o[M],k=o[M+1],F=A.dist(k);if(E+F>D){const j=(D-E)/F,q=At(A.x,k.x,j),ee=At(A.y,k.y,j),le=new la(q,ee,0,k.angleTo(A),M);return!y||Xd(o,le,x,y,r)?le:void 0}E+=F}}function tv(o,r,s,c,f,g,y,x,E){const D=Qy(c,g,y),M=Eg(c,f),A=M*y,k=0===o[0].x||o[0].x===E||0===o[0].y||o[0].y===E;return r-A<r/4&&(r=A+r/4),Tg(o,k?r/2*x%r:(M/2+2*g)*y*x%r,r,D,s,A,k,!1,E)}function Tg(o,r,s,c,f,g,y,x,E){const D=g/2,M=Kd(o);let A=0,k=r-s,F=[];for(let j=0;j<o.length-1;j++){const q=o[j],ee=o[j+1],le=q.dist(ee),Ee=ee.angleTo(q);for(;k+s<A+le;){k+=s;const Pe=(k-A)/le,Re=At(q.x,ee.x,Pe),Le=At(q.y,ee.y,Pe);if(Re>=0&&Re<E&&Le>=0&&Le<E&&k-D>=0&&k+D<=M){const Fe=new la(Re,Le,0,Ee,j);Fe._round(),c&&!Xd(o,Fe,g,c,f)||F.push(Fe)}}A+=le}return x||F.length||y||(F=Tg(o,A/2,s,c,f,g,y,!0,E)),F}function Tp(o,r,s,c,f){const g=[];for(let y=0;y<o.length;y++){const x=o[y];let E;for(let D=0;D<x.length-1;D++){let M=x[D],A=x[D+1];M.x<r&&A.x<r||(M.x<r?M=new $(r,M.y+(r-M.x)/(A.x-M.x)*(A.y-M.y))._round():A.x<r&&(A=new $(r,M.y+(r-M.x)/(A.x-M.x)*(A.y-M.y))._round()),M.y<s&&A.y<s||(M.y<s?M=new $(M.x+(s-M.y)/(A.y-M.y)*(A.x-M.x),s)._round():A.y<s&&(A=new $(M.x+(s-M.y)/(A.y-M.y)*(A.x-M.x),s)._round()),M.x>=c&&A.x>=c||(M.x>=c?M=new $(c,M.y+(c-M.x)/(A.x-M.x)*(A.y-M.y))._round():A.x>=c&&(A=new $(c,M.y+(c-M.x)/(A.x-M.x)*(A.y-M.y))._round()),M.y>=f&&A.y>=f||(M.y>=f?M=new $(M.x+(f-M.y)/(A.y-M.y)*(A.x-M.x),f)._round():A.y>=f&&(A=new $(M.x+(f-M.y)/(A.y-M.y)*(A.x-M.x),f)._round()),E&&M.equals(E[E.length-1])||(E=[M],g.push(E)),E.push(A)))))}}return g}Vt(la);const Yd=1e20;function Cg(o,r,s,c,f,g,y,x,E){for(let D=r;D<r+c;D++)nv(o,s*g+D,g,f,y,x,E);for(let D=s;D<s+f;D++)nv(o,D*g+r,1,c,y,x,E)}function nv(o,r,s,c,f,g,y){g[0]=0,y[0]=-Yd,y[1]=Yd,f[0]=o[r];for(let x=1,E=0,D=0;x<c;x++){f[x]=o[r+x*s];const M=x*x;do{const A=g[E];D=(f[x]-f[A]+M-A*A)/(x-A)/2}while(D<=y[E]&&--E>-1);E++,g[E]=x,y[E]=D,y[E+1]=Yd}for(let x=0,E=0;x<c;x++){for(;y[E+1]<x;)E++;const D=g[E],M=x-D;o[r+x*s]=f[D]+M*M}}const Jd={none:0,ideographs:1,all:2};class Tc{constructor(r,s,c){this.requestManager=r,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,s){const c=[];for(const f in r)for(const g of r[f])c.push({stack:f,id:g});Be(c,({stack:f,id:g},y)=>{let x=this.entries[f];x||(x=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[g];if(void 0!==E)return void y(null,{stack:f,id:g,glyph:E});if(E=this._tinySDF(x,f,g),E)return x.glyphs[g]=E,void y(null,{stack:f,id:g,glyph:E});const D=Math.floor(g/256);if(256*D>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[D])return void y(null,{stack:f,id:g,glyph:E});let M=x.requests[D];M||(M=x.requests[D]=[],Tc.loadGlyphRange(f,D,this.url,this.requestManager,(A,k)=>{if(k){x.ascender=k.ascender,x.descender=k.descender;for(const F in k.glyphs)this._doesCharSupportLocalGlyph(+F)||(x.glyphs[+F]=k.glyphs[+F]);x.ranges[D]=!0}for(const F of M)F(A,k);delete x.requests[D]})),M.push((A,k)=>{A?y(A):k&&y(null,{stack:f,id:g,glyph:k.glyphs[g]||null})})},(f,g)=>{if(f)s(f);else if(g){const y={};for(const{stack:x,id:E,glyph:D}of g)void 0===y[x]&&(y[x]={}),void 0===y[x].glyphs&&(y[x].glyphs={}),y[x].glyphs[E]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;s(null,y)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Jd.none&&(this.localGlyphMode===Jd.all?!!this.localFontFamily:!!this.localFontFamily&&(ou(r)||wd(r)||Za(r)||Il(r)||nu(r)))}_tinySDF(r,s,c){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(c))return;let g=r.tinySDF;if(!g){let q="400";/bold/i.test(s)?q="900":/medium/i.test(s)?q="500":/light/i.test(s)&&(q="200"),g=r.tinySDF=new Tc.TinySDF({fontFamily:f,fontWeight:q,fontSize:48,buffer:6,radius:16}),g.fontWeight=q}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const y=String.fromCharCode(c),{data:x,width:E,height:D,glyphWidth:M,glyphHeight:A,glyphLeft:k,glyphTop:F,glyphAdvance:j}=g.draw(y);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new Da({width:E,height:D},x),metrics:{width:M/2,height:A/2,left:k/2,top:F/2-27,advance:j/2,localGlyph:!0}}}}function Dg(o,r,s,c){const f=[],g=o.image,y=g.pixelRatio,x=g.paddedRect.w-2,E=g.paddedRect.h-2,D=o.right-o.left,M=o.bottom-o.top,A=g.stretchX||[[0,x]],k=g.stretchY||[[0,E]],F=(qe,tt)=>qe+tt[1]-tt[0],j=A.reduce(F,0),q=k.reduce(F,0),ee=x-j,le=E-q;let Ee=0,Pe=j,Re=0,Le=q,Fe=0,Ye=ee,Qe=0,at=le;if(g.content&&c){const qe=g.content;Ee=Au(A,0,qe[0]),Re=Au(k,0,qe[1]),Pe=Au(A,qe[0],qe[2]),Le=Au(k,qe[1],qe[3]),Fe=qe[0]-Ee,Qe=qe[1]-Re,Ye=qe[2]-qe[0]-Pe,at=qe[3]-qe[1]-Le}const dt=(qe,tt,pt,Ct)=>{const wt=Cp(qe.stretch-Ee,Pe,D,o.left),St=Dp(qe.fixed-Fe,Ye,qe.stretch,j),_n=Cp(tt.stretch-Re,Le,M,o.top),Dn=Dp(tt.fixed-Qe,at,tt.stretch,q),mn=Cp(pt.stretch-Ee,Pe,D,o.left),ln=Dp(pt.fixed-Fe,Ye,pt.stretch,j),Zt=Cp(Ct.stretch-Re,Le,M,o.top),zt=Dp(Ct.fixed-Qe,at,Ct.stretch,q),Sn=new $(wt,_n),ar=new $(mn,_n),Jr=new $(mn,Zt),yr=new $(wt,Zt),Qr=new $(St/y,Dn/y),Kn=new $(ln/y,zt/y),Un=r*Math.PI/180;if(Un){const Fr=Math.sin(Un),ei=Math.cos(Un),Si=[ei,-Fr,Fr,ei];Sn._matMult(Si),ar._matMult(Si),yr._matMult(Si),Jr._matMult(Si)}const cr=qe.stretch+qe.fixed,Rr=tt.stretch+tt.fixed;return{tl:Sn,tr:ar,bl:yr,br:Jr,tex:{x:g.paddedRect.x+1+cr,y:g.paddedRect.y+1+Rr,w:pt.stretch+pt.fixed-cr,h:Ct.stretch+Ct.fixed-Rr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qr,pixelOffsetBR:Kn,minFontScaleX:Ye/y/D,minFontScaleY:at/y/M,isSDF:s}};if(c&&(g.stretchX||g.stretchY)){const qe=rv(A,ee,j),tt=rv(k,le,q);for(let pt=0;pt<qe.length-1;pt++){const Ct=qe[pt],wt=qe[pt+1];for(let St=0;St<tt.length-1;St++)f.push(dt(Ct,tt[St],wt,tt[St+1]))}}else f.push(dt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return f}function Au(o,r,s){let c=0;for(const f of o)c+=Math.max(r,Math.min(s,f[1]))-Math.max(r,Math.min(s,f[0]));return c}function rv(o,r,s){const c=[{fixed:-1,stretch:0}];for(const[f,g]of o){const y=c[c.length-1];c.push({fixed:f-y.stretch,stretch:y.stretch}),c.push({fixed:f-y.stretch,stretch:y.stretch+(g-f)})}return c.push({fixed:r+1,stretch:s}),c}function Cp(o,r,s,c){return o/r*s+c}function Dp(o,r,s,c){return o-r*s/c}function M0(o,r,s,c){const f=r+o.positionedLines[c].lineOffset;return 0===c?s+f/2:s+(f+(r+o.positionedLines[c-1].lineOffset))/2}Tc.loadGlyphRange=function(o,r,s,c,f){const g=256*r,y=g+255,x=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${g}-${y}`),oe.Glyphs);se(x,(E,D)=>{if(E)f(E);else if(D){const M={},A=new Rh(D).readFields(bg,{});for(const k of A.glyphs)M[k.id]=k;f(null,{glyphs:M,ascender:A.ascender,descender:A.descender})}})},Tc.TinySDF=class{constructor({fontSize:o=24,buffer:r=3,radius:s=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}){this.buffer=r,this.cutoff=c,this.radius=s;const x=this.size=o+4*r,E=this._createCanvas(x),D=this.ctx=E.getContext("2d",{willReadFrequently:!0});D.font=`${y} ${g} ${o}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(o){const r=document.createElement("canvas");return r.width=r.height=o,r}draw(o){const{width:r,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(o),y=Math.floor(s),x=Math.min(this.size-this.buffer,Math.ceil(g-f)),E=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(c)),D=x+2*this.buffer,M=E+2*this.buffer,A=D*M,k=new Uint8ClampedArray(A),F={data:k,width:D,height:M,glyphWidth:x,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(0===x||0===E)return F;const{ctx:j,buffer:q,gridInner:ee,gridOuter:le}=this;j.clearRect(q,q,x,E),j.fillText(o,q,q+y+1);const Ee=j.getImageData(q,q,x,E);le.fill(Yd,0,A),ee.fill(0,0,A);for(let Pe=0;Pe<E;Pe++)for(let Re=0;Re<x;Re++){const Le=Ee.data[4*(Pe*x+Re)+3]/255;if(0===Le)continue;const Fe=(Pe+q)*D+Re+q;if(1===Le)le[Fe]=0,ee[Fe]=Yd;else{const Ye=.5-Le;le[Fe]=Ye>0?Ye*Ye:0,ee[Fe]=Ye<0?Ye*Ye:0}}Cg(le,0,0,D,M,D,this.f,this.v,this.z),Cg(ee,q,q,x,E,D,this.f,this.v,this.z);for(let Pe=0;Pe<A;Pe++){const Re=Math.sqrt(le[Pe])-Math.sqrt(ee[Pe]);k[Pe]=Math.round(255-255*(Re/this.radius+this.cutoff))}return F}};class A0{constructor(r=[],s=P0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:c}=this,f=s[r];for(;r>0;){const g=r-1>>1,y=s[g];if(c(f,y)>=0)break;s[r]=y,r=g}s[r]=f}_down(r){const{data:s,compare:c}=this,f=this.length>>1,g=s[r];for(;r<f;){let y=1+(r<<1),x=s[y];const E=y+1;if(E<this.length&&c(s[E],x)<0&&(y=E,x=s[E]),c(x,g)>=0)break;s[r]=x,r=y}s[r]=g}}function P0(o,r){return o<r?-1:o>r?1:0}function k0(o,r=1,s=!1){let c=1/0,f=1/0,g=-1/0,y=-1/0;const x=o[0];for(let F=0;F<x.length;F++){const j=x[F];(!F||j.x<c)&&(c=j.x),(!F||j.y<f)&&(f=j.y),(!F||j.x>g)&&(g=j.x),(!F||j.y>y)&&(y=j.y)}const E=Math.min(g-c,y-f);let D=E/2;const M=new A0([],R0);if(0===E)return new $(c,f);for(let F=c;F<g;F+=E)for(let j=f;j<y;j+=E)M.push(new Fh(F+D,j+D,D,o));let A=function(F){let j=0,q=0,ee=0;const le=F[0];for(let Ee=0,Pe=le.length,Re=Pe-1;Ee<Pe;Re=Ee++){const Le=le[Ee],Fe=le[Re],Ye=Le.x*Fe.y-Fe.x*Le.y;q+=(Le.x+Fe.x)*Ye,ee+=(Le.y+Fe.y)*Ye,j+=3*Ye}return new Fh(q/j,ee/j,0,F)}(o),k=M.length;for(;M.length;){const F=M.pop();(F.d>A.d||!A.d)&&(A=F,s&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,k)),F.max-A.d<=r||(D=F.h/2,M.push(new Fh(F.p.x-D,F.p.y-D,D,o)),M.push(new Fh(F.p.x+D,F.p.y-D,D,o)),M.push(new Fh(F.p.x-D,F.p.y+D,D,o)),M.push(new Fh(F.p.x+D,F.p.y+D,D,o)),k+=4)}return s&&(console.log(`num probes: ${k}`),console.log(`best distance: ${A.d}`)),A.p}function R0(o,r){return r.max-o.max}function Fh(o,r,s,c){this.p=new $(o,r),this.h=s,this.d=function(f,g){let y=!1,x=1/0;for(let E=0;E<g.length;E++){const D=g[E];for(let M=0,A=D.length,k=A-1;M<A;k=M++){const F=D[M],j=D[k];F.y>f.y!=j.y>f.y&&f.x<(j.x-F.x)*(f.y-F.y)/(j.y-F.y)+F.x&&(y=!y),x=Math.min(x,my(f,F,j))}}return(y?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const Sg=Number.POSITIVE_INFINITY,jl=Math.sqrt(2);function Qd(o,r){return r[1]!==Sg?function(s,c,f){let g=0,y=0;switch(c=Math.abs(c),f=Math.abs(f),s){case"top-right":case"top-left":case"top":y=f-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-f}switch(s){case"top-right":case"bottom-right":case"right":g=-c;break;case"top-left":case"bottom-left":case"left":g=c}return[g,y]}(o,r[0],r[1]):function(s,c){let f=0,g=0;c<0&&(c=0);const y=c/jl;switch(s){case"top-right":case"top-left":g=y-7;break;case"bottom-right":case"bottom-left":g=7-y;break;case"bottom":g=7-c;break;case"top":g=c-7}switch(s){case"top-right":case"bottom-right":f=-y;break;case"top-left":case"bottom-left":f=y;break;case"left":f=c;break;case"right":f=-c}return[f,g]}(o,r[0])}function iv(o,r,s,c,f,g,y,x,E,D){o.createArrays(),o.tilePixelRatio=In/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const M=o.layers[0].layout,A=o.layers[0]._unevaluatedLayout._values,k={};if("composite"===o.textSizeData.kind){const{minZoom:q,maxZoom:ee}=o.textSizeData;k.compositeTextSizes=[A["text-size"].possiblyEvaluate(new kr(q),x),A["text-size"].possiblyEvaluate(new kr(ee),x)]}if("composite"===o.iconSizeData.kind){const{minZoom:q,maxZoom:ee}=o.iconSizeData;k.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new kr(q),x),A["icon-size"].possiblyEvaluate(new kr(ee),x)]}k.layoutTextSize=A["text-size"].possiblyEvaluate(new kr(E+1),x),k.layoutIconSize=A["icon-size"].possiblyEvaluate(new kr(E+1),x),k.textMaxSize=A["text-size"].possiblyEvaluate(new kr(18),x);const F="map"===M.get("text-rotation-alignment")&&"point"!==M.get("symbol-placement"),j=M.get("text-size");for(const q of o.features){const ee=M.get("text-font").evaluate(q,{},x).join(","),le=j.evaluate(q,{},x),Ee=k.layoutTextSize.evaluate(q,{},x),Pe=(k.layoutIconSize.evaluate(q,{},x),{horizontal:{},vertical:void 0}),Re=q.text;let Le,Fe=[0,0];if(Re){const at=Re.toString(),dt=24*M.get("text-letter-spacing").evaluate(q,{},x),qe=24*M.get("text-line-height").evaluate(q,{},x),tt=Td(at)?dt:0,pt=M.get("text-anchor").evaluate(q,{},x),Ct=M.get("text-variable-anchor");if(!Ct){const ln=M.get("text-radial-offset").evaluate(q,{},x);Fe=ln?Qd(pt,[24*ln,Sg]):M.get("text-offset").evaluate(q,{},x).map(Zt=>24*Zt)}let wt=F?"center":M.get("text-justify").evaluate(q,{},x);const St=M.get("symbol-placement"),_n="point"===St,Dn="point"===St?24*M.get("text-max-width").evaluate(q,{},x):0,mn=ln=>{o.allowVerticalPlacement&&au(at)&&(Pe.vertical=_s(Re,r,s,f,ee,Dn,qe,pt,ln,tt,Fe,es.vertical,!0,St,Ee,le))};if(!F&&Ct){const ln="auto"===wt?Ct.map(zt=>ef(zt)):[wt];let Zt=!1;for(let zt=0;zt<ln.length;zt++){const Sn=ln[zt];if(!Pe.horizontal[Sn])if(Zt)Pe.horizontal[Sn]=Pe.horizontal[0];else{const ar=_s(Re,r,s,f,ee,Dn,qe,"center",Sn,tt,Fe,es.horizontal,!1,St,Ee,le);ar&&(Pe.horizontal[Sn]=ar,Zt=1===ar.positionedLines.length)}}mn("left")}else{if("auto"===wt&&(wt=ef(pt)),_n||M.get("text-writing-mode").indexOf("horizontal")>=0||!au(at)){const ln=_s(Re,r,s,f,ee,Dn,qe,pt,wt,tt,Fe,es.horizontal,!1,St,Ee,le);ln&&(Pe.horizontal[wt]=ln)}mn("point"===St?"left":wt)}}let Ye=!1;if(q.icon&&q.icon.name){const at=c[q.icon.name];at&&(Le=Wd(f[q.icon.name],M.get("icon-offset").evaluate(q,{},x),M.get("icon-anchor").evaluate(q,{},x)),Ye=at.sdf,void 0===o.sdfIcons?o.sdfIcons=at.sdf:o.sdfIcons!==at.sdf&&un("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(at.pixelRatio!==o.pixelRatio||0!==M.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const Qe=Ig(Pe.horizontal)||Pe.vertical;o.iconsInText||(o.iconsInText=!!Qe&&Qe.iconsInText),(Qe||Le)&&Sp(o,q,Pe,Le,c,k,Ee,0,Fe,Ye,y,x,D)}g&&o.generateCollisionDebugBuffers(E,o.collisionBoxArray)}function ef(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sp(o,r,s,c,f,g,y,x,E,D,M,A,k){let F=g.textMaxSize.evaluate(r,{},A);void 0===F&&(F=y);const j=o.layers[0].layout,q=j.get("icon-offset").evaluate(r,{},A),ee=Ig(s.horizontal)||s.vertical,le=y/24,Ee=o.tilePixelRatio*F/24,Pe=(qe=o.overscaling,o.zoom>18&&qe>2&&(qe>>=1),Math.max(In/(512*qe),1)*j.get("symbol-spacing")),Re=j.get("text-padding")*o.tilePixelRatio,Le=j.get("icon-padding")*o.tilePixelRatio,Fe=ue(j.get("text-max-angle")),Ye="map"===j.get("text-rotation-alignment")&&"point"!==j.get("symbol-placement"),Qe="map"===j.get("icon-rotation-alignment")&&"point"!==j.get("symbol-placement"),at=j.get("symbol-placement"),dt=Pe/2;var qe;const tt=j.get("icon-text-fit");let pt;c&&"none"!==tt&&(o.allowVerticalPlacement&&s.vertical&&(pt=Lh(c,s.vertical,tt,j.get("icon-text-fit-padding"),q,le)),ee&&(c=Lh(c,ee,tt,j.get("icon-text-fit-padding"),q,le)));const Ct=(wt,St,_n)=>{if(St.x<0||St.x>=In||St.y<0||St.y>=In)return;const{x:Dn,y:mn,z:ln}=k.projectTilePoint(St.x,St.y,_n),Zt=new la(Dn,mn,ln,0,void 0);!function(zt,Sn,ar,Jr,yr,Qr,Kn,Un,cr,Rr,Fr,ei,Si,zo,Do,Tr,fo,No,Oi,Ii,$r,zr,Bo,So,pi){const po=zt.addToLineVertexArray(Sn,Jr);let mo,Li,ws,Hl,Lu,qh,Jg,bv=0,Qg=0,mf=0,gf=0,Kp=-1,e_=-1;const dl={};let wv=nl(""),Yp=0,_f=0;if(void 0===cr._unevaluatedLayout.getValue("text-radial-offset")?[Yp,_f]=cr.layout.get("text-offset").evaluate($r,{},pi).map(rs=>24*rs):(Yp=24*cr.layout.get("text-radial-offset").evaluate($r,{},pi),_f=Sg),zt.allowVerticalPlacement&&yr.vertical){const rs=yr.vertical;if(Do)qh=nf(rs),Un&&(Jg=nf(Un));else{const jo=cr.layout.get("text-rotate").evaluate($r,{},pi)+90;ws=ca(Rr,ar,Sn,Fr,ei,Si,rs,zo,jo,Tr),Un&&(Hl=ca(Rr,ar,Sn,Fr,ei,Si,Un,No,jo))}}if(Qr){const rs=cr.layout.get("icon-rotate").evaluate($r,{},pi),jo="none"!==cr.layout.get("icon-text-fit"),Zh=Dg(Qr,rs,Bo,jo),yf=Un?Dg(Un,rs,Bo,jo):void 0;Li=ca(Rr,ar,Sn,Fr,ei,Si,Qr,No,rs),bv=4*Zh.length;const Wh=zt.iconSizeData;let Oc=null;"source"===Wh.kind?(Oc=[oa*cr.layout.get("icon-size").evaluate($r,{},pi)],Oc[0]>ll&&un(`${zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Wh.kind&&(Oc=[oa*zr.compositeIconSizes[0].evaluate($r,{},pi),oa*zr.compositeIconSizes[1].evaluate($r,{},pi)],(Oc[0]>ll||Oc[1]>ll)&&un(`${zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),zt.addSymbols(zt.icon,Zh,Oc,Ii,Oi,$r,!1,ar,Sn,po.lineStartIndex,po.lineLength,-1,So,pi),Kp=zt.icon.placedSymbolArray.length-1,yf&&(Qg=4*yf.length,zt.addSymbols(zt.icon,yf,Oc,Ii,Oi,$r,es.vertical,ar,Sn,po.lineStartIndex,po.lineLength,-1,So,pi),e_=zt.icon.placedSymbolArray.length-1)}for(const rs in yr.horizontal){const jo=yr.horizontal[rs];mo||(wv=nl(jo.text),Do?Lu=nf(jo):mo=ca(Rr,ar,Sn,Fr,ei,Si,jo,zo,cr.layout.get("text-rotate").evaluate($r,{},pi),Tr));const Zh=1===jo.positionedLines.length;if(mf+=tf(zt,ar,Sn,jo,Kn,cr,Do,$r,Tr,po,yr.vertical?es.horizontal:es.horizontalOnly,Zh?Object.keys(yr.horizontal):[rs],dl,Kp,zr,So,pi),Zh)break}yr.vertical&&(gf+=tf(zt,ar,Sn,yr.vertical,Kn,cr,Do,$r,Tr,po,es.vertical,["vertical"],dl,e_,zr,So,pi));let Rc=-1;const Jp=(rs,jo)=>rs?Math.max(rs,jo):jo;Rc=Jp(Lu,Rc),Rc=Jp(qh,Rc),Rc=Jp(Jg,Rc);const Fu=Rc>-1?1:0;zt.glyphOffsetArray.length>=Ma.MAX_GLYPHS&&un("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==$r.sortKey&&zt.addToSortKeyRanges(zt.symbolInstances.length,$r.sortKey),zt.symbolInstances.emplaceBack(ar.x,ar.y,ar.z,Sn.x,Sn.y,dl.right>=0?dl.right:-1,dl.center>=0?dl.center:-1,dl.left>=0?dl.left:-1,dl.vertical>=0?dl.vertical:-1,Kp,e_,wv,void 0!==mo?mo:zt.collisionBoxArray.length,void 0!==mo?mo+1:zt.collisionBoxArray.length,void 0!==ws?ws:zt.collisionBoxArray.length,void 0!==ws?ws+1:zt.collisionBoxArray.length,void 0!==Li?Li:zt.collisionBoxArray.length,void 0!==Li?Li+1:zt.collisionBoxArray.length,Hl||zt.collisionBoxArray.length,Hl?Hl+1:zt.collisionBoxArray.length,Fr,mf,gf,bv,Qg,Fu,0,Yp,_f,Rc)}(o,St,Zt,wt,s,c,f,pt,o.layers[0],o.collisionBoxArray,r.index,r.sourceLayerIndex,o.index,Re,Ye,E,0,Le,Qe,q,r,g,D,M,A)};if("line"===at)for(const wt of Tp(r.geometry,0,0,In,In)){const St=tv(wt,Pe,Fe,s.vertical||ee,c,24,Ee,o.overscaling,In);for(const _n of St){const Dn=ee;Dn&&ov(o,Dn.text,dt,_n)||Ct(wt,_n,A)}}else if("line-center"===at){for(const wt of r.geometry)if(wt.length>1){const St=ev(wt,Fe,s.vertical||ee,c,24,Ee);St&&Ct(wt,St,A)}}else if("Polygon"===r.type)for(const wt of lp(r.geometry,0)){const St=k0(wt,16);Ct(wt[0],new la(St.x,St.y,0,0,void 0),A)}else if("LineString"===r.type)for(const wt of r.geometry)Ct(wt,new la(wt[0].x,wt[0].y,0,0,void 0),A);else if("Point"===r.type)for(const wt of r.geometry)for(const St of wt)Ct([St],new la(St.x,St.y,0,0,void 0),A)}const ll=32640;function tf(o,r,s,c,f,g,y,x,E,D,M,A,k,F,j,q,ee){const le=function(Re,Le,Fe,Ye,Qe,at,dt,qe){const tt=[];if(0===Le.positionedLines.length)return tt;const pt=Ye.layout.get("text-rotate").evaluate(at,{})*Math.PI/180,Ct=function(mn){const ln=mn[0],Zt=mn[1],zt=ln*Zt;return zt>0?[ln,-Zt]:zt<0?[-ln,Zt]:0===ln?[Zt,ln]:[Zt,-ln]}(Fe);let wt=Math.abs(Le.top-Le.bottom);for(const mn of Le.positionedLines)wt-=mn.lineOffset;const St=Le.positionedLines.length,_n=wt/St;let Dn=Le.top-Fe[1];for(let mn=0;mn<St;++mn){const ln=Le.positionedLines[mn];Dn=M0(Le,_n,Dn,mn);for(const Zt of ln.positionedGlyphs){if(!Zt.rect)continue;const zt=Zt.rect||{};let Sn=4,ar=!0,Jr=1,yr=0;if(Zt.imageName){const zr=dt[Zt.imageName];if(!zr)continue;if(zr.sdf){un("SDF images are not supported in formatted text and will be ignored.");continue}ar=!1,Jr=zr.pixelRatio,Sn=1/Jr}const Qr=(Qe||qe)&&Zt.vertical,Kn=Zt.metrics.advance*Zt.scale/2,Un=Zt.metrics,cr=Zt.rect;if(null===cr)continue;qe&&Le.verticalizable&&(yr=Zt.imageName?Kn-Zt.metrics.width*Zt.scale/2:0);const Rr=Qe?[Zt.x+Kn,Zt.y]:[0,0];let Fr=[0,0],ei=[0,0],Si=!1;Qe||(Qr?(ei=[Zt.x+Kn+Ct[0],Zt.y+Ct[1]-yr],Si=!0):Fr=[Zt.x+Kn+Fe[0],Zt.y+Fe[1]-yr]);const zo=cr.w*Zt.scale/(Jr*(Zt.localGlyph?2:1)),Do=cr.h*Zt.scale/(Jr*(Zt.localGlyph?2:1));let Tr,fo,No,Oi;if(Qr){const zr=Zt.y-Dn,Bo=new $(-Kn,Kn-zr),So=-Math.PI/2,pi=new $(...ei);Tr=new $(-Kn+Fr[0],Fr[1]),Tr._rotateAround(So,Bo)._add(pi),Tr.x+=-zr+Kn,Tr.y-=(Un.left-Sn)*Zt.scale;const po=Zt.imageName?Un.advance*Zt.scale:24*Zt.scale,mo=String.fromCharCode(Zt.glyph);yp(mo)?Tr.x+=(1-Sn)*Zt.scale:mg(mo)?Tr.x+=po-Un.height*Zt.scale+(-Sn-1)*Zt.scale:Tr.x+=Zt.imageName||Un.width+2*Sn===cr.w&&Un.height+2*Sn===cr.h?(po-Do)/2:(po-(Un.height+2*Sn)*Zt.scale)/2,fo=new $(Tr.x,Tr.y-zo),No=new $(Tr.x+Do,Tr.y),Oi=new $(Tr.x+Do,Tr.y-zo)}else{const zr=(Un.left-Sn)*Zt.scale-Kn+Fr[0],Bo=(-Un.top-Sn)*Zt.scale+Fr[1],So=zr+zo,pi=Bo+Do;Tr=new $(zr,Bo),fo=new $(So,Bo),No=new $(zr,pi),Oi=new $(So,pi)}if(pt){let zr;zr=Qe?new $(0,0):Si?new $(Ct[0],Ct[1]):new $(Fe[0],Fe[1]),Tr._rotateAround(pt,zr),fo._rotateAround(pt,zr),No._rotateAround(pt,zr),Oi._rotateAround(pt,zr)}const Ii=new $(0,0),$r=new $(0,0);tt.push({tl:Tr,tr:fo,bl:No,br:Oi,tex:zt,writingMode:Le.writingMode,glyphOffset:Rr,sectionIndex:Zt.sectionIndex,isSDF:ar,pixelOffsetTL:Ii,pixelOffsetBR:$r,minFontScaleX:0,minFontScaleY:0})}}return tt}(0,c,E,g,y,x,f,o.allowVerticalPlacement),Ee=o.textSizeData;let Pe=null;"source"===Ee.kind?(Pe=[oa*g.layout.get("text-size").evaluate(x,{},ee)],Pe[0]>ll&&un(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Ee.kind&&(Pe=[oa*j.compositeTextSizes[0].evaluate(x,{},ee),oa*j.compositeTextSizes[1].evaluate(x,{},ee)],(Pe[0]>ll||Pe[1]>ll)&&un(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,le,Pe,E,y,x,M,r,s,D.lineStartIndex,D.lineLength,F,q,ee);for(const Re of A)k[Re]=o.text.placedSymbolArray.length-1;return 4*le.length}function Ig(o){for(const r in o)return o[r];return null}function ca(o,r,s,c,f,g,y,x,E,D){let M=y.top,A=y.bottom,k=y.left,F=y.right;const j=y.collisionPadding;if(j&&(k-=j[0],M-=j[1],F+=j[2],A+=j[3]),E){const q=new $(k,M),ee=new $(F,M),le=new $(k,A),Ee=new $(F,A),Pe=ue(E);let Re=new $(0,0);D&&(Re=new $(D[0],D[1])),q._rotateAround(Pe,Re),ee._rotateAround(Pe,Re),le._rotateAround(Pe,Re),Ee._rotateAround(Pe,Re),k=Math.min(q.x,ee.x,le.x,Ee.x),F=Math.max(q.x,ee.x,le.x,Ee.x),M=Math.min(q.y,ee.y,le.y,Ee.y),A=Math.max(q.y,ee.y,le.y,Ee.y)}return o.emplaceBack(r.x,r.y,r.z,s.x,s.y,k,M,F,A,x,c,f,g),o.length-1}function nf(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const r=o.bottom-o.top;return r>0?Math.max(10,r):null}function ov(o,r,s,c){const f=o.compareText;if(r in f){const g=f[r];for(let y=g.length-1;y>=0;y--)if(c.dist(g[y])<s)return!0}else f[r]=[];return f[r].push(c),!1}const Ip=Bl.VectorTileFeature.types,sv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zh(o,r,s,c,f,g,y,x,E,D,M,A,k,F,j,q){const ee=M?Math.min(ll,Math.round(M[0])):0,le=M?Math.min(ll,Math.round(M[1])):0;o.emplaceBack(r,s,Math.round(32*y),Math.round(32*x),E,D,(ee<<1)+(A?1:0),le,16*k,16*F,256*j,256*q,c,f,g,0)}function Mp(o,r,s){o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s)}function av(o){for(const r of o.sections)if(Dd(r.text))return!0;return!1}class Cc{constructor(r){this.layoutVertexArray=new Je,this.indexArray=new Ke,this.programConfigurations=r,this.segments=new ai,this.dynamicLayoutVertexArray=new Ce,this.opacityVertexArray=new Dt,this.placedSymbolArray=new Lo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,s,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,xc.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,fg.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,sv,!0),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Vt(Cc);class Ul{constructor(r,s,c){this.layoutVertexArray=new r,this.layoutAttributes=s,this.indexArray=new c,this.segments=new ai,this.collisionVertexArray=new Ht,this.collisionVertexArrayExt=new Ce}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,pg.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,Uy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Vt(Ul);class Ma{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ca([]),this.placementViewportMatrix=Ca([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jd(this.zoom,s["text-size"]),this.iconSizeData=jd(this.zoom,s["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(y=>es[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new Cc(new hc(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Cc(new hc(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new sr,this.lineVertexArray=new Kr,this.symbolInstances=new Zn}calculateGlyphDependencies(r,s,c,f,g){for(let y=0;y<r.length;y++)if(s[r.charCodeAt(y)]=!0,f&&g){const x=Du[r.charAt(y)];x&&(s[x.charCodeAt(0)]=!0)}}populate(r,s,c,f){const g=this.layers[0],y=g.layout,x=y.get("text-font"),E=y.get("text-field"),D=y.get("icon-image"),M=("constant"!==E.value.kind||E.value.value instanceof Wr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),A="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,k=y.get("symbol-sort-key");if(this.features=[],!M&&!A)return;const F=s.iconDependencies,j=s.glyphDependencies,q=s.availableImages,ee=new kr(this.zoom);for(const{feature:le,id:Ee,index:Pe,sourceLayerIndex:Re}of r){const Le=g._featureFilter.needGeometry,Fe=Ll(le,Le);if(!g._featureFilter.filter(ee,Fe,c))continue;let Ye,Qe;if(Le||(Fe.geometry=Ol(le,c,f)),M){const dt=g.getValueAndResolveTokens("text-field",Fe,c,q),qe=Wr.factory(dt);av(qe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===dh()||this.hasRTLText&&co.isParsed())&&(Ye=Vd(qe,g,Fe))}if(A){const dt=g.getValueAndResolveTokens("icon-image",Fe,c,q);Qe=dt instanceof Ar?dt:Ar.fromString(dt)}if(!Ye&&!Qe)continue;const at=this.sortFeaturesByKey?k.evaluate(Fe,{},c):void 0;if(this.features.push({id:Ee,text:Ye,icon:Qe,index:Pe,sourceLayerIndex:Re,geometry:Fe.geometry,properties:le.properties,type:Ip[le.type],sortKey:at}),Qe&&(F[Qe.name]=!0),Ye){const dt=x.evaluate(Fe,{},c).join(","),qe="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(es.vertical)>=0;for(const tt of Ye.sections)if(tt.image)F[tt.image.name]=!0;else{const pt=au(Ye.toString()),Ct=tt.fontStack||dt,wt=j[Ct]=j[Ct]||{};this.calculateGlyphDependencies(tt.text,wt,qe,this.allowVerticalPlacement,pt)}}}"line"===y.get("symbol-placement")&&(this.features=function(le){const Ee={},Pe={},Re=[];let Le=0;function Fe(dt){Re.push(le[dt]),Le++}function Ye(dt,qe,tt){const pt=Pe[dt];return delete Pe[dt],Pe[qe]=pt,Re[pt].geometry[0].pop(),Re[pt].geometry[0]=Re[pt].geometry[0].concat(tt[0]),pt}function Qe(dt,qe,tt){const pt=Ee[qe];return delete Ee[qe],Ee[dt]=pt,Re[pt].geometry[0].shift(),Re[pt].geometry[0]=tt[0].concat(Re[pt].geometry[0]),pt}function at(dt,qe,tt){const pt=tt?qe[0][qe[0].length-1]:qe[0][0];return`${dt}:${pt.x}:${pt.y}`}for(let dt=0;dt<le.length;dt++){const qe=le[dt],tt=qe.geometry,pt=qe.text?qe.text.toString():null;if(!pt){Fe(dt);continue}const Ct=at(pt,tt),wt=at(pt,tt,!0);if(Ct in Pe&&wt in Ee&&Pe[Ct]!==Ee[wt]){const St=Qe(Ct,wt,tt),_n=Ye(Ct,wt,Re[St].geometry);delete Ee[Ct],delete Pe[wt],Pe[at(pt,Re[_n].geometry,!0)]=_n,Re[St].geometry=null}else Ct in Pe?Ye(Ct,wt,tt):wt in Ee?Qe(Ct,wt,tt):(Fe(dt),Ee[Ct]=Le-1,Pe[wt]=Le-1)}return Re.filter(dt=>dt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,Ee)=>le.sortKey-Ee.sortKey)}update(r,s,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,s,this.layers,c,f),this.icon.programConfigurations.updatePaintArrays(r,s,this.layers,c,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,s){const c=this.lineVertexArray.length,f=r.segment;if(void 0!==f){let g=r.dist(s[f+1]),y=r.dist(s[f]);const x={};for(let E=f+1;E<s.length;E++)x[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:g},E<s.length-1&&(g+=s[E+1].dist(s[E]));for(let E=f||0;E>=0;E--)x[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:y},E>0&&(y+=s[E-1].dist(s[E]));for(let E=0;E<s.length;E++){const D=x[E];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(r,s,c,f,g,y,x,E,D,M,A,k,F,j){const q=r.indexArray,ee=r.layoutVertexArray,le=r.segments.prepareSegment(4*s.length,ee,q,this.canOverlap?y.sortKey:void 0),Ee=this.glyphOffsetArray.length,Pe=le.vertexLength,Re=this.allowVerticalPlacement&&x===es.vertical?Math.PI/2:0,Le=y.text&&y.text.sections;for(let Fe=0;Fe<s.length;Fe++){const{tl:Ye,tr:Qe,bl:at,br:dt,tex:qe,pixelOffsetTL:tt,pixelOffsetBR:pt,minFontScaleX:Ct,minFontScaleY:wt,glyphOffset:St,isSDF:_n,sectionIndex:Dn}=s[Fe],mn=le.vertexLength,ln=St[1];zh(ee,E.x,E.y,E.z,D.x,D.y,Ye.x,ln+Ye.y,qe.x,qe.y,c,_n,tt.x,tt.y,Ct,wt),zh(ee,E.x,E.y,E.z,D.x,D.y,Qe.x,ln+Qe.y,qe.x+qe.w,qe.y,c,_n,pt.x,tt.y,Ct,wt),zh(ee,E.x,E.y,E.z,D.x,D.y,at.x,ln+at.y,qe.x,qe.y+qe.h,c,_n,tt.x,pt.y,Ct,wt),zh(ee,E.x,E.y,E.z,D.x,D.y,dt.x,ln+dt.y,qe.x+qe.w,qe.y+qe.h,c,_n,pt.x,pt.y,Ct,wt),Mp(r.dynamicLayoutVertexArray,E,Re),q.emplaceBack(mn,mn+1,mn+2),q.emplaceBack(mn+1,mn+2,mn+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Fe!==s.length-1&&Dn===s[Fe+1].sectionIndex||r.programConfigurations.populatePaintArrays(ee.length,y,y.index,{},F,j,Le&&Le[Dn])}r.placedSymbolArray.emplaceBack(E.x,E.y,E.z,D.x,D.y,Ee,this.glyphOffsetArray.length-Ee,Pe,M,A,D.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],x,0,!1,0,k,0)}_commitLayoutVertex(r,s,c,f,g,y,x){r.emplaceBack(s,c,f,g,y,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,s,c,f,g,y,x){const E=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),D=E.vertexLength,M=x.tileAnchorX,A=x.tileAnchorY;for(let F=0;F<4;F++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(s,r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(s,r.padding,r.padding),c.collisionVertexArrayExt.emplaceBack(s,-r.padding,r.padding),this._commitLayoutVertex(c.layoutVertexArray,f,g,y,M,A,new $(r.x1,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,g,y,M,A,new $(r.x2,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,g,y,M,A,new $(r.x2,r.y2)),this._commitLayoutVertex(c.layoutVertexArray,f,g,y,M,A,new $(r.x1,r.y2)),E.vertexLength+=4;const k=c.indexArray;k.emplaceBack(D,D+1),k.emplaceBack(D+1,D+2),k.emplaceBack(D+2,D+3),k.emplaceBack(D+3,D),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,s,c,f,g,y){for(let x=f;x<g;x++){const E=c.get(x),D=this.getSymbolInstanceTextSize(r,y,s,x);this._addCollisionDebugVertices(E,D,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,s,c,f,g,y){for(let x=f;x<g;x++){const E=c.get(x),D=this.getSymbolInstanceIconSize(r,s,x);this._addCollisionDebugVertices(E,D,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ul(yt,kh.members,en),this.iconCollisionBox=new Ul(yt,kh.members,en);const c=bc(this.iconSizeData,r),f=bc(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(f,r,s,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,r,s,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,r,s,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,r,s,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(r,s,c,f){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:f),y=Cu(this.textSizeData,r,g)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,s,c){const f=this.icon.placedSymbolArray.get(c),g=Cu(this.iconSizeData,r,f);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,s,c){r.emplaceBack(s,-c,-c),r.emplaceBack(s,c,-c),r.emplaceBack(s,c,c),r.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(r,s,c,f,g,y){for(let x=f;x<g;x++){const E=c.get(x),D=this.getSymbolInstanceTextSize(r,y,s,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,E.padding)}}_updateIconDebugCollisionBoxes(r,s,c,f,g){for(let y=f;y<g;y++){const x=c.get(y),E=this.getSymbolInstanceIconSize(r,s,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,x.padding)}}updateCollisionDebugBuffers(r,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=bc(this.iconSizeData,r),f=bc(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,r,s,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,r,s,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(c,r,s,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,r,s,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,s,c,f,g,y,x,E,D){const M={};for(let A=s;A<c;A++){const k=r.get(A);M.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},M.textFeatureIndex=k.featureIndex;break}for(let A=f;A<g;A++){const k=r.get(A);M.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},M.verticalTextFeatureIndex=k.featureIndex;break}for(let A=y;A<x;A++){const k=r.get(A);M.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},M.iconFeatureIndex=k.featureIndex;break}for(let A=E;A<D;A++){const k=r.get(A);M.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},M.verticalIconFeatureIndex=k.featureIndex;break}return M}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,s){const c=r.placedSymbolArray.get(s),f=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<f;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(r),c=Math.cos(r),f=[],g=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const E=this.symbolInstances.get(x);f.push(0|Math.round(s*E.tileAnchorX+c*E.tileAnchorY)),g.push(E.featureIndex)}return y.sort((x,E)=>f[x]-f[E]||g[E]-g[x]),y}addToSortKeyRanges(r,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((f,g,y)=>{f>=0&&y.indexOf(f)===g&&this.addIndicesForPlacedSymbol(this.text,f)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Vt(Ma,{omit:["layers","collisionBoxArray","features","compareText"]}),Ma.MAX_GLYPHS=65535,Ma.addDynamicAttributes=Mp;const Pu=new B({"symbol-placement":new C($e.layout_symbol["symbol-placement"]),"symbol-spacing":new C($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new C($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new S($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new C($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new C($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new C($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new C($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new C($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new S($e.layout_symbol["icon-size"]),"icon-text-fit":new C($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new C($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new S($e.layout_symbol["icon-image"]),"icon-rotate":new S($e.layout_symbol["icon-rotate"]),"icon-padding":new C($e.layout_symbol["icon-padding"]),"icon-keep-upright":new C($e.layout_symbol["icon-keep-upright"]),"icon-offset":new S($e.layout_symbol["icon-offset"]),"icon-anchor":new S($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new C($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new C($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new C($e.layout_symbol["text-rotation-alignment"]),"text-field":new S($e.layout_symbol["text-field"]),"text-font":new S($e.layout_symbol["text-font"]),"text-size":new S($e.layout_symbol["text-size"]),"text-max-width":new S($e.layout_symbol["text-max-width"]),"text-line-height":new S($e.layout_symbol["text-line-height"]),"text-letter-spacing":new S($e.layout_symbol["text-letter-spacing"]),"text-justify":new S($e.layout_symbol["text-justify"]),"text-radial-offset":new S($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new C($e.layout_symbol["text-variable-anchor"]),"text-anchor":new S($e.layout_symbol["text-anchor"]),"text-max-angle":new C($e.layout_symbol["text-max-angle"]),"text-writing-mode":new C($e.layout_symbol["text-writing-mode"]),"text-rotate":new S($e.layout_symbol["text-rotate"]),"text-padding":new C($e.layout_symbol["text-padding"]),"text-keep-upright":new C($e.layout_symbol["text-keep-upright"]),"text-transform":new S($e.layout_symbol["text-transform"]),"text-offset":new S($e.layout_symbol["text-offset"]),"text-allow-overlap":new C($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new C($e.layout_symbol["text-ignore-placement"]),"text-optional":new C($e.layout_symbol["text-optional"])});var Dc={paint:new B({"icon-opacity":new S($e.paint_symbol["icon-opacity"]),"icon-color":new S($e.paint_symbol["icon-color"]),"icon-halo-color":new S($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new S($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new S($e.paint_symbol["icon-halo-blur"]),"icon-translate":new C($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new C($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new S($e.paint_symbol["text-opacity"]),"text-color":new S($e.paint_symbol["text-color"],{runtimeType:wi,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new S($e.paint_symbol["text-halo-color"]),"text-halo-width":new S($e.paint_symbol["text-halo-width"]),"text-halo-blur":new S($e.paint_symbol["text-halo-blur"]),"text-translate":new C($e.paint_symbol["text-translate"]),"text-translate-anchor":new C($e.paint_symbol["text-translate-anchor"])}),layout:Pu};class Sc{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Ao,this.defaultValue=r}evaluate(r){if(r.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(r.formattedSection))return s.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Vt(Sc,{omit:["defaultValue"]});class rf extends ia{constructor(r){super(r,Dc)}recalculate(r,s){super.recalculate(r,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const g of c)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,s,c,f){const g=this.layout.get(r).evaluate(s,{},c,f),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||Cl(y.value)||!g?g:(x=s.properties,g.replace(/{([^{}]+)}/g,(D,M)=>M in x?String(x[M]):""));var x}createBucket(r){return new Ma(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Dc.paint.overridableProperties){if(!rf.hasPaintOverride(this.layout,r))continue;const s=this.paint.get(r),c=new Sc(s),f=new Xc(c,s.property.specification);let g=null;g="constant"===s.value.kind||"source"===s.value.kind?new Kc("source",f):new Ku("composite",f,s.value.zoomStops,s.value._interpolationType),this.paint._values[r]=new b(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(r,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&rf.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,s){const c=r.get("text-field"),f=Dc.paint.properties[s];let g=!1;const y=x=>{for(const E of x)if(f.overrides&&f.overrides.hasOverride(E))return void(g=!0)};if("constant"===c.value.kind&&c.value.value instanceof Wr)y(c.value.value.sections);else if("source"===c.value.kind){const x=D=>{g||(D instanceof Ho&&xr(D.value)===cs?y(D.value.sections):D instanceof Ps?y(D.sections):D.eachChild(x))},E=c.value;E._styleExpression&&x(E._styleExpression.expression)}return g}getProgramConfiguration(r){return new ra(this,r)}}var Mg={paint:new B({"background-color":new C($e.paint_background["background-color"]),"background-pattern":new R($e.paint_background["background-pattern"]),"background-opacity":new C($e.paint_background["background-opacity"])})},Ag={paint:new B({"raster-opacity":new C($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new C($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new C($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new C($e.paint_raster["raster-brightness-max"]),"raster-saturation":new C($e.paint_raster["raster-saturation"]),"raster-contrast":new C($e.paint_raster["raster-contrast"]),"raster-resampling":new C($e.paint_raster["raster-resampling"]),"raster-fade-duration":new C($e.paint_raster["raster-fade-duration"])})};class Ap extends ia{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var Pp={paint:new B({"sky-type":new C($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new C($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new C($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new C($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new C($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new L($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new C($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new C($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new C($e.paint_sky["sky-opacity"])})};function of(o,r,s){const c=[0,0,1],f=Km([]);return function(g,y,x){x*=.5;var E=y[0],D=y[1],M=y[2],A=y[3],k=Math.sin(x),F=Math.cos(x);g[0]=E*F-M*k,g[1]=D*F+A*k,g[2]=M*F+E*k,g[3]=A*F-D*k}(f,f,s?-ue(o)+Math.PI:ue(o)),Ym(f,f,-ue(r)),xy(c,c,f),pu(c,c)}const sf={circle:class extends ia{constructor(o){super(o,_y)}createBucket(o){return new qf(o)}queryRadius(o){const r=o;return fc("circle-radius",this,r)+fc("circle-stroke-width",this,r)+xh(this.paint.get("circle-translate"))}queryIntersectsFeature(o,r,s,c,f,g,y,x){const E=Vm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s);return tp(o,c,g,y,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,D)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new ra(this,o)}},heatmap:class extends ia{createBucket(o){return new Di(o)}constructor(o){super(o,wy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return fc("heatmap-radius",this,o)}queryIntersectsFeature(o,r,s,c,f,g,y,x){const E=this.paint.get("heatmap-radius").evaluate(r,s);return tp(o,c,g,y,x,!0,!0,new $(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new ra(this,o)}},hillshade:class extends ia{constructor(o){super(o,Ey)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ia{constructor(o){super(o,Oy)}getProgramIds(){const o=this.paint.get("fill-pattern"),r=o&&o.constantOr(1),s=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new ra(this,o)}recalculate(o,r){super.recalculate(o,r);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new zd(o)}queryRadius(){return xh(this.paint.get("fill-translate"))}queryIntersectsFeature(o,r,s,c,f,g){return!o.queryGeometry.isAboveHorizon&&yh(Um(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends ia{constructor(o){super(o,Ly)}createBucket(o){return new yc(o)}queryRadius(){return xh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new ra(this,o)}queryIntersectsFeature(o,r,s,c,f,g,y,x,E){const D=Vm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(r,s),A=this.paint.get("fill-extrusion-base").evaluate(r,s),k=[0,0],F=x&&g.elevation,j=g.elevation?g.elevation.exaggeration():1,q=o.tile.getBucket(this);if(F&&q instanceof yc){const Ee=q.centroidVertexArray,Pe=E+1;if(Pe<Ee.length){const Re=Ee.get(Pe);k[0]=Re.a_centroid_pos0,k[1]=Re.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;const ee=(Ee=c,Pe=A,Re=M,Le=D,Fe=y,(Ye=F?x:null)?function(qe,tt,pt,Ct,wt,St,_n,Dn,mn){const ln=[],Zt=[],zt=[0,0,0,1];for(const Sn of qe){const ar=[],Jr=[];for(const yr of Sn){const Qr=yr.x+Ct.x,Kn=yr.y+Ct.y,Un=Fy(Qr,Kn,tt,pt,St,_n,Dn,mn);zt[0]=Qr,zt[1]=Kn,zt[2]=Un.base,zt[3]=1,Eh(zt,zt,wt),zt[3]=Math.max(zt[3],1e-5);const cr=cg([zt[0]/zt[3],zt[1]/zt[3],zt[2]/zt[3]]);zt[0]=Qr,zt[1]=Kn,zt[2]=Un.top,zt[3]=1,Eh(zt,zt,wt),zt[3]=Math.max(zt[3],1e-5);const Rr=cg([zt[0]/zt[3],zt[1]/zt[3],zt[2]/zt[3]]);ar.push(cr),Jr.push(Rr)}ln.push(ar),Zt.push(Jr)}return[ln,Zt]}(Ee,Pe,Re,Le,Fe,Ye,k,j,g.center.lat):function(qe,tt,pt,Ct,wt){const St=[],_n=[],Dn=wt[8]*tt,mn=wt[9]*tt,ln=wt[10]*tt,Zt=wt[11]*tt,zt=wt[8]*pt,Sn=wt[9]*pt,ar=wt[10]*pt,Jr=wt[11]*pt;for(const yr of qe){const Qr=[],Kn=[];for(const Un of yr){const cr=Un.x+Ct.x,Rr=Un.y+Ct.y,Fr=wt[0]*cr+wt[4]*Rr+wt[12],ei=wt[1]*cr+wt[5]*Rr+wt[13],Si=wt[2]*cr+wt[6]*Rr+wt[14],zo=wt[3]*cr+wt[7]*Rr+wt[15],Do=Fr+Dn,Tr=ei+mn,fo=Si+ln,No=Math.max(zo+Zt,1e-5),Oi=Fr+zt,Ii=ei+Sn,$r=Si+ar,zr=Math.max(zo+Jr,1e-5),Bo=new $(Do/No,Tr/No);Bo.z=fo/No,Qr.push(Bo);const So=new $(Oi/zr,Ii/zr);So.z=$r/zr,Kn.push(So)}St.push(Qr),_n.push(Kn)}return[St,_n]}(Ee,Pe,Re,Le,Fe)),le=o.queryGeometry;var Ee,Pe,Re,Le,Fe,Ye;return function(Ee,Pe,Re){let Le=1/0;yh(Re,Pe)&&(Le=lg(Re,Pe[0]));for(let Fe=0;Fe<Pe.length;Fe++){const Ye=Pe[Fe],Qe=Ee[Fe];for(let at=0;at<Ye.length-1;at++){const dt=Ye[at],qe=[dt,Ye[at+1],Qe[at+1],Qe[at],dt];Bm(Re,qe)&&(Le=Math.min(Le,lg(Re,qe)))}}return Le!==1/0&&Le}(ee[0],ee[1],le.isPointQuery()?le.screenBounds:le.screenGeometry)}},line:class extends ia{constructor(o){super(o,dg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Mn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,r){super.recalculate(o,r),this.paint._values["line-floorwidth"]=gp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Tu(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new ra(this,o)}queryRadius(o){const r=o,s=_p(fc("line-width",this,r),fc("line-gap-width",this,r)),c=fc("line-offset",this,r);return s/2+Math.abs(c)+xh(this.paint.get("line-translate"))}queryIntersectsFeature(o,r,s,c,f,g){if(o.queryGeometry.isAboveHorizon)return!1;const y=Um(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),x=o.pixelToTileUnitsFactor/2*_p(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),E=this.paint.get("line-offset").evaluate(r,s);return E&&(c=function(D,M){const A=[],k=new $(0,0);for(let F=0;F<D.length;F++){const j=D[F],q=[];for(let ee=0;ee<j.length;ee++){const le=j[ee-1],Ee=j[ee],Pe=j[ee+1],Re=0===ee?k:Ee.sub(le)._unit()._perp(),Le=ee===j.length-1?k:Pe.sub(Ee)._unit()._perp(),Fe=Re._add(Le)._unit();Fe._mult(1/(Fe.x*Le.x+Fe.y*Le.y)),q.push(Fe._mult(M)._add(Ee))}A.push(q)}return A}(c,E*o.pixelToTileUnitsFactor)),function(D,M,A){for(let k=0;k<M.length;k++){const F=M[k];if(D.length>=3)for(let j=0;j<F.length;j++)if(zl(D,F[j]))return!0;if(Zf(D,F,A))return!0}return!1}(y,c,x)}isTileClipped(){return!0}},symbol:rf,background:class extends ia{constructor(o){super(o,Mg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ia{constructor(o){super(o,Ag)}getProgramIds(){return["raster"]}},sky:class extends ia{constructor(o){super(o,Pp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=rp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(o,r){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),f=!c,g=o.style.light,y=g.properties.get("position");return f&&"viewport"===g.properties.get("anchor")&&un("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?of(y.azimuthal,90-y.polar,r):of(c[0],90-c[1],r)}const s=this.paint.get("sky-gradient-center");return of(s[0],90-s[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class Nh{constructor(r,s,c,f){this.context=r,this.format=c,this.texture=r.gl.createTexture(),this.update(s,f)}update(r,s,c){const{width:f,height:g}=r,{context:y}=this,{gl:x}=y,{HTMLImageElement:E,HTMLCanvasElement:D,HTMLVideoElement:M,ImageData:A,ImageBitmap:k}=W;if(x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!s||!1!==s.premultiply)),c||this.size&&this.size[0]===f&&this.size[1]===g){const{x:F,y:j}=c||{x:0,y:0};r instanceof E||r instanceof D||r instanceof M||r instanceof A||k&&r instanceof k?x.texSubImage2D(x.TEXTURE_2D,0,F,j,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,F,j,f,g,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[f,g],r instanceof E||r instanceof D||r instanceof M||r instanceof A||k&&r instanceof k?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,f,g,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,s){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?r===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:r),this.filter=r),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class af{constructor(r,s){this.width=r,this.height=s,this.nextRow=0,this.image=new Da({width:r,height:s}),this.positions={},this.uploaded=!1}getDash(r,s){const c=this.getKey(r,s);return this.positions[c]}trim(){const r=this.width,s=this.height=Et(this.nextRow);this.image.resize({width:r,height:s})}getKey(r,s){return r.join(",")+s}getDashRanges(r,s,c){const f=[];let g=r.length%2==1?-r[r.length-1]*c:0,y=r[0]*c,x=!0;f.push({left:g,right:y,isDash:x,zeroLength:0===r[0]});let E=r[0];for(let D=1;D<r.length;D++){x=!x;const M=r[D];g=E*c,E+=M,y=E*c,f.push({left:g,right:y,isDash:x,zeroLength:0===M})}return f}addRoundDash(r,s,c){const f=s/2;for(let g=-c;g<=c;g++){const y=this.width*(this.nextRow+c+g);let x=0,E=r[x];for(let D=0;D<this.width;D++){D/E.right>1&&(E=r[++x]);const M=Math.abs(D-E.left),A=Math.abs(D-E.right),k=Math.min(M,A);let F;const j=g/c*(f+1);if(E.isDash){const q=f-Math.abs(j);F=Math.sqrt(k*k+q*q)}else F=f-Math.sqrt(k*k+j*j);this.image.data[y+D]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(r,s){for(let E=r.length-1;E>=0;--E){const D=r[E],M=r[E+1];D.zeroLength?r.splice(E,1):M&&M.isDash===D.isDash&&(M.left=D.left,r.splice(E,1))}const c=r[0],f=r[r.length-1];c.isDash===f.isDash&&(c.left=f.left-this.width,f.right=c.right+this.width);const g=this.width*this.nextRow;let y=0,x=r[y];for(let E=0;E<this.width;E++){E/x.right>1&&(x=r[++y]);const D=Math.abs(E-x.left),M=Math.abs(E-x.right),A=Math.min(D,M);this.image.data[g+E]=Math.max(0,Math.min(255,(x.isDash?A:-A)+s+128))}}addDash(r,s){const c=this.getKey(r,s);if(this.positions[c])return this.positions[c];const f="round"===s,g=f?7:0,y=2*g+1;if(this.nextRow+y>this.height)return un("LineAtlas out of space"),null;0===r.length&&r.push(1);let x=0;for(let M=0;M<r.length;M++)r[M]<0&&(un("Negative value is found in line dasharray, replacing values with 0"),r[M]=0),x+=r[M];if(0!==x){const M=this.width/x,A=this.getDashRanges(r,this.width,M);f?this.addRoundDash(A,M,g):this.addRegularDash(A,"square"===s?.5*M:0)}const E=this.nextRow+g;this.nextRow+=y;const D={tl:[E,g],br:[x,0]};return this.positions[c]=D,D}}Vt(af);class O0{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const Pg=W.performance;function kp(o){const r=o?o.url.toString():void 0;return Pg.getEntriesByName(r)}class lv{constructor(){this.tasks={},this.taskQueue=[],ut(["process"],this),this.invoker=new O0(this.process),this.nextId=0}add(r,s){const c=this.nextId++,f=function({type:g,isSymbolTile:y,zoom:x}){return x=x||0,"message"===g?0:"maybePrepare"!==g||y?"parseTile"!==g||y?"parseTile"===g&&y?300-x:"maybePrepare"===g&&y?400-x:500:200-x:100-x}(s);if(0===f){kt();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:r,metadata:s,priority:f,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){kt();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const s=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let r=null,s=1/0;for(let f=0;f<this.taskQueue.length;f++){const g=this.tasks[this.taskQueue[f]];g.priority<s&&(s=g.priority,r=f)}if(null===r)return null;const c=this.taskQueue[r];return this.taskQueue.splice(r,1),c}remove(){this.invoker.remove()}}const kg=ge([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),cv=ge([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Rg}=kg,ts=ge([{name:"a_pos_3",components:3,type:"Int16"}]);var Bh=ge([{name:"a_pos",type:"Int16",components:2}]);const ku=In/Math.PI/2,ys=-ku,vs=ku,Og=[new ms([ys,ys,ys],[vs,vs,vs]),new ms([ys,ys,ys],[0,0,vs]),new ms([0,ys,ys],[vs,0,vs]),new ms([ys,0,ys],[0,vs,vs]),new ms([0,0,ys],[vs,vs,vs])];class L0{constructor(r,s,c){this.a=Nl([],r,c),this.b=Nl([],s,c),this.center=c;const f=pu([],this.a),g=pu([],this.b);this.angle=Math.acos(mu(f,g))}}function Rp(o,r){if(0===o.angle)return null;let s;return s=0===o.a[r]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[r]/o.a[r]/Math.sin(o.angle)-1/Math.tan(o.angle)),s<0||s>1?null:function(c,f,g,y){const x=Math.sin(g);return c*(Math.sin((1-y)*g)/x)+f*(Math.sin(y*g)/x)}(o.a[r],o.b[r],o.angle,J(s,0,1))+o.center[r]}function Ic(o){if(o.z<=1)return Og[o.z+2*o.y+o.x];const[r,s]=Op(o),c=[cl(r[0],r[1]),cl(r[0],s[1]),cl(s[0],r[1]),cl(s[0],s[1])],f=[vs,vs,vs],g=[ys,ys,ys];for(const y of c)f[0]=Math.min(f[0],y[0]),f[1]=Math.min(f[1],y[1]),f[2]=Math.min(f[2],y[2]),g[0]=Math.max(g[0],y[0]),g[1]=Math.max(g[1],y[1]),g[2]=Math.max(g[2],y[2]);return new ms(f,g)}function Op(o){const r=1<<o.z,s=o.x/r,c=(o.x+1)/r,f=(o.y+1)/r;return[[Gi(o.y/r),Vs(s)],[Gi(f),Vs(c)]]}function Fg(o,r,s,c=ku){return s=ue(s),[o*Math.sin(s)*c,-r*c,o*Math.cos(s)*c]}function cl(o,r,s){return Fg(Math.cos(ue(o)),Math.sin(ue(o)),r,s)}function Lp(o,r,s){const c=Math.pow(2,s.z),f=(o/In+s.x)/c;return cl(Gi((r/In+s.y)/c),Vs(f))}function Fp(o){return 16383/Math.max(...Nl([],o.max,o.min))}function zp(o){const r=Ca(new Float64Array(16)),s=Fp(o);var c,f;return pc(r,r,[s,s,s]),fu(r,r,((c=[])[0]=-(f=o.min)[0],c[1]=-f[1],c[2]=-f[2],c)),r}function zg(o,r,s,c,f){const g=function(E){const D=In/(2*Math.PI);return E/(2*Math.PI)/D}(s),y=[o,r,-s/(2*Math.PI)],x=Ca(new Float64Array(16));return fu(x,x,y),pc(x,x,[g,g,g]),Gm(x,x,ue(-f)),Hm(x,x,ue(-c)),x}function Ng(o){const{x:r,y:s}=o.point,{lng:c,lat:f}=o._center;return zg(r,s,o.worldSize,c,f)}const Np=ue(85),Bg=Math.cos(Np),uv=Math.sin(Np);function ua(o,r,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,r*c-2*Math.PI*6378137/2]}class Ru{constructor(r,s,c){this.z=r,this.x=s,this.y=c,this.key=lf(0,r,r,s,c)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,s){const c=(y=this.y,x=this.z,E=ua(256*(g=this.x),256*(y=Math.pow(2,x)-y-1),x),D=ua(256*(g+1),256*(y+1),x),E[0]+","+E[1]+","+D[0]+","+D[1]),f=function(g,y,x){let E,D="";for(let M=g;M>0;M--)E=1<<M-1,D+=(y&E?1:0)+(x&E?2:0);return D}(this.z,this.x,this.y);var g,y,x,E,D;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jg{constructor(r,s){this.wrap=r,this.canonical=s,this.key=lf(r,s.z,s.z,s.x,s.y)}}class Co{constructor(r,s,c,f,g){this.overscaledZ=r,this.wrap=s,this.canonical=new Ru(c,+f,+g),this.key=0===s&&r===c?this.canonical.key:lf(s,r,c,f,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const s=this.canonical.z-r;return r>this.canonical.z?new Co(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Co(r,this.wrap,r,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(r,s=!0){if(this.overscaledZ===r&&s)return this.key;if(r>this.canonical.z)return lf(this.wrap*+s,r,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-r;return lf(this.wrap*+s,r,r,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const s=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>s&&r.canonical.y===this.canonical.y>>s}children(r){if(this.overscaledZ>=r)return[new Co(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new Co(s,this.wrap,s,c,f),new Co(s,this.wrap,s,c+1,f),new Co(s,this.wrap,s,c,f+1),new Co(s,this.wrap,s,c+1,f+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Co(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Co(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function lf(o,r,s,c,f){const g=1<<Math.min(s,22);let y=g*(f%g)+c%g;return o&&s<22&&(y+=g*g*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*y+s)+(r-s)}function Vl(o,r){if(!r.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:r};const s=Math.pow(2,-o.z),c=o.x*s,f=(o.x+1)*s,g=o.y*s,y=(o.y+1)*s,x=Vs(c),E=Vs(f),D=Gi(g),M=Gi(y),A=r.project(x,D),k=r.project(E,D),F=r.project(E,M),j=r.project(x,M);let q=Math.min(A.x,k.x,F.x,j.x),ee=Math.min(A.y,k.y,F.y,j.y),le=Math.max(A.x,k.x,F.x,j.x),Ee=Math.max(A.y,k.y,F.y,j.y);const Pe=s/16;function Re(Fe,Ye,Qe,at,dt,qe){const tt=(Qe+dt)/2,pt=(at+qe)/2,Ct=r.project(Vs(tt),Gi(pt)),wt=Math.max(0,q-Ct.x,ee-Ct.y,Ct.x-le,Ct.y-Ee);q=Math.min(q,Ct.x),le=Math.max(le,Ct.x),ee=Math.min(ee,Ct.y),Ee=Math.max(Ee,Ct.y),wt>Pe&&(Re(Fe,Ct,Qe,at,tt,pt),Re(Ct,Ye,tt,pt,dt,qe))}Re(A,k,c,g,f,g),Re(k,F,f,g,f,y),Re(F,j,f,y,c,y),Re(j,A,c,y,c,g),q-=Pe,ee-=Pe,le+=Pe,Ee+=Pe;const Le=1/Math.max(le-q,Ee-ee);return{scale:Le,x:q*Le,y:ee*Le,x2:le*Le,y2:Ee*Le,projection:r}}Vt(Ru),Vt(Co,{omit:["projMatrix"]});class Ug{constructor(r){this._stringToNumber={},this._numberToString=[];for(let s=0;s<r.length;s++){const c=r[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const hv=["tile","layer","source","sourceLayer","state"];class Vg{constructor(r,s,c,f,g){this.type="Feature",this._vectorTileFeature=r,this._z=s,this._x=c,this._y=f,this.properties=r.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(r.id=this.id);for(const s of hv)void 0!==this[s]&&(r[s]=this[s]);return r}}const $l=new Uint16Array(8184);for(let o=0;o<2046;o++){let r=o+2,s=0,c=0,f=0,g=0,y=0,x=0;for(1&r?f=g=y=32:s=c=x=32;(r>>=1)>1;){const D=s+f>>1,M=c+g>>1;1&r?(f=s,g=c,s=y,c=x):(s=f,c=g,f=y,g=x),y=D,x=M}const E=4*o;$l[E+0]=s,$l[E+1]=c,$l[E+2]=f,$l[E+3]=g}const xs=new Uint16Array(2178),Pa=new Uint8Array(1089),cf=new Uint16Array(1089);function uf(o){return 0===o?-.03125:32===o?.03125:0}var hf=ge([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Bp={type:2,extent:In,loadGeometry:()=>[[new $(0,0),new $(8193,0),new $(8193,8193),new $(0,8193),new $(0,0)]]};class jp{constructor(r,s,c,f,g){this.tileID=r,this.uid=Pt(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(r){const s=r+this.timeAdded;s<ur.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Vl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,s,c){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(f,g){const y={};if(!g)return y;for(const x of f){const E=x.layerIds.map(D=>g.getLayer(D)).filter(Boolean);if(0!==E.length){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(D=>E.filter(M=>M.id===D)[0]));for(const D of E)y[D.id]=x}}return y}(r.buckets,s.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const g=this.buckets[f];if(g instanceof Ma){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const g=this.buckets[f];if(g instanceof Ma&&g.hasRTLText){this.hasRTLText=!0,co.isLoading()||co.isLoaded()||"deferred"!==dh()||cc();break}}this.queryPadding=0;for(const f in this.buckets){const g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(f).queryRadius(g))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new wa}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(r)}const s=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nh(r,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nh(r,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Nh(r,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,s,c,f,g,y,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:x,transform:y,params:g,tileTransform:this.tileTransform},r,s,c):{}}querySourceFeatures(r,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),g=s?s.sourceLayer:"",y=f._geojsonTileLayer||f[g];if(!y)return;const x=Pr(s&&s.filter),{z:E,x:D,y:M}=this.tileID.canonical,A={z:E,x:D,y:M};for(let k=0;k<y.length;k++){const F=y.feature(k);if(x.needGeometry){const ee=Ll(F,!0);if(!x.filter(new kr(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!x.filter(new kr(this.tileID.overscaledZ),F))continue;const j=c.getId(F,g),q=new Vg(F,E,D,M,j);q.tile=A,r.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const s=this.expirationTime;if(r.cacheControl){const c=Pn(r.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(s)if(this.expirationTime<s)f=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),f=s.style.listImages();for(const g in this.buckets){if(!s.style.hasLayer(g))continue;const y=this.buckets[g],x=y.layers[0].sourceLayer||"_geojsonTileLayer",E=c[x],D=r[x];if(!E||!D||0===Object.keys(D).length)continue;if(y.update(D,E,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof Tu||y instanceof zd){const A=s.style._getSourceCache(y.layers[0].source);s._terrain&&s._terrain.enabled&&A&&y.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(A.id,this.tileID)}const M=s&&s.style&&s.style.getLayer(g);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ur.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=ur.now()+r}setTexture(r,s){const c=s.context,f=c.gl;this.texture=s.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new Nh(c,r,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),c.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax))}setDependencies(r,s){const c={};for(const f of s)c[f]=!0;this.dependencies[r]=c}hasDependency(r,s){for(const c of r){const f=this.dependencies[c];if(f)for(const g of s)if(f[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const c=Ol(Bp,this.tileID.canonical,this.tileTransform)[0],f=new fe,g=new vn;for(let y=0;y<c.length;y++){const{x,y:E}=c[y];f.emplaceBack(x,E),g.emplaceBack(y)}g.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(f,Bh.members),this._tileDebugSegments=ai.simpleSegment(0,0,f.length,g.length)}_makeTileBoundsBuffers(r,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const c=Ol(Bp,this.tileID.canonical,this.tileTransform)[0];let f,g;if(this.isRaster){const y=function(x,E){const D=Vl(x,E),M=Math.pow(2,x.z);for(let ee=0;ee<33;ee++)for(let le=0;le<33;le++){const Ee=Vs((x.x+(le+uf(le))/32)/M),Pe=Gi((x.y+(ee+uf(ee))/32)/M),Re=E.project(Ee,Pe),Le=33*ee+le;xs[2*Le+0]=Math.round((Re.x*D.scale-D.x)*In),xs[2*Le+1]=Math.round((Re.y*D.scale-D.y)*In)}Pa.fill(0),cf.fill(0);for(let ee=2045;ee>=0;ee--){const le=4*ee,Ee=$l[le+0],Pe=$l[le+1],Re=$l[le+2],Le=$l[le+3],Fe=Ee+Re>>1,Ye=Pe+Le>>1,Qe=Fe+Ye-Pe,at=Ye+Ee-Fe,dt=33*Pe+Ee,qe=33*Le+Re,tt=33*Ye+Fe,pt=Math.hypot((xs[2*dt+0]+xs[2*qe+0])/2-xs[2*tt+0],(xs[2*dt+1]+xs[2*qe+1])/2-xs[2*tt+1])>=16;if(Pa[tt]=Pa[tt]||(pt?1:0),ee<1022){const Ct=33*(Pe+at>>1)+(Ee+Qe>>1),wt=33*(Le+at>>1)+(Re+Qe>>1);Pa[tt]=Pa[tt]||Pa[Ct]||Pa[wt]}}const A=new ve,k=new Ke;let F=0;function j(ee,le){const Ee=33*le+ee;return 0===cf[Ee]&&(A.emplaceBack(xs[2*Ee+0],xs[2*Ee+1],ee*In/32,le*In/32),cf[Ee]=++F),cf[Ee]-1}function q(ee,le,Ee,Pe,Re,Le){const Fe=ee+Ee>>1,Ye=le+Pe>>1;if(Math.abs(ee-Re)+Math.abs(le-Le)>1&&Pa[33*Ye+Fe])q(Re,Le,ee,le,Fe,Ye),q(Ee,Pe,Re,Le,Fe,Ye);else{const Qe=j(ee,le),at=j(Ee,Pe),dt=j(Re,Le);k.emplaceBack(Qe,at,dt)}}return q(0,0,32,32,32,0),q(32,32,0,0,0,32),{vertices:A,indices:k}}(this.tileID.canonical,s);f=y.vertices,g=y.indices}else{f=new ve,g=new Ke;for(const{x,y:E}of c)f.emplaceBack(x,E,0,0);const y=ip(f.int16,void 0,4);for(let x=0;x<y.length;x+=3)g.emplaceBack(y[x],y[x+1],y[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(f,hf.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(g),this._tileBoundsSegments=ai.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugBuffers(r,s){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!s||"globe"!==s.name)return;const c=this.tileID.canonical,f=zp(Ic(c));this._makeGlobeTileDebugBorderBuffer(r,c,f),this._makeGlobeTileDebugTextBuffer(r,c,f)}_makeGlobeTileDebugBorderBuffer(r,s,c){const f=new fe,g=new vn,y=new _e,x=(D,M,A,k,F)=>{const j=(A-D)/(F-1),q=(k-M)/(F-1),ee=f.length;for(let le=0;le<F;le++){const Ee=D+le*j,Pe=M+le*q;f.emplaceBack(Ee,Pe);const Re=Lp(Ee,Pe,s),Le=gu(Re,Re,c);y.emplaceBack(Le[0],Le[1],Le[2]),g.emplaceBack(ee+le)}},E=In;x(0,0,E,0,16),x(E,0,E,E,16),x(E,E,0,E,16),x(0,E,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(f,Bh.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(y,ts.members),this._tileDebugSegments=ai.simpleSegment(0,0,f.length,g.length)}_makeGlobeTileDebugTextBuffer(r,s,c){const f=new fe,g=new Ke,y=new _e,x=25;g.reserve(32),f.reserve(x),y.reserve(x);const E=(D,M)=>x*D+M;for(let D=0;D<x;D++){const M=2048*D;for(let A=0;A<x;A++){const k=2048*A;f.emplaceBack(k,M);const F=Lp(k,M,s),j=gu(F,F,c);y.emplaceBack(j[0],j[1],j[2])}}for(let D=0;D<4;D++)for(let M=0;M<4;M++){const A=E(D,M),k=E(D,M+1),F=E(D+1,M),j=E(D+1,M+1);g.emplaceBack(A,k,F),g.emplaceBack(F,k,j)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(g),this._tileDebugTextBuffer=r.createVertexBuffer(f,Bh.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(y,ts.members),this._tileDebugTextSegments=ai.simpleSegment(0,0,x,32)}}class dv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,s,c){const f=String(s);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][f]=this.stateChanges[r][f]||{},rt(this.stateChanges[r][f],c),null===this.deletedStates[r]){this.deletedStates[r]={};for(const g in this.state[r])g!==f&&(this.deletedStates[r][g]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][f]){this.deletedStates[r][f]={};for(const g in this.state[r][f])c[g]||(this.deletedStates[r][f][g]=null)}else for(const g in c)this.deletedStates[r]&&this.deletedStates[r][f]&&null===this.deletedStates[r][f][g]&&delete this.deletedStates[r][f][g]}removeFeatureState(r,s,c){if(null===this.deletedStates[r])return;const f=String(s);if(this.deletedStates[r]=this.deletedStates[r]||{},c&&void 0!==s)null!==this.deletedStates[r][f]&&(this.deletedStates[r][f]=this.deletedStates[r][f]||{},this.deletedStates[r][f][c]=null);else if(void 0!==s)if(this.stateChanges[r]&&this.stateChanges[r][f])for(c in this.deletedStates[r][f]={},this.stateChanges[r][f])this.deletedStates[r][f][c]=null;else this.deletedStates[r][f]=null;else this.deletedStates[r]=null}getState(r,s){const c=String(s),f=rt({},(this.state[r]||{})[c],(this.stateChanges[r]||{})[c]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const g=this.deletedStates[r][s];if(null===g)return{};for(const y in g)delete f[y]}return f}initializeTileState(r,s){r.setFeatureState(this.state,s)}coalesceChanges(r,s){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const g={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),rt(this.state[f][y],this.stateChanges[f][y]),g[y]=this.state[f][y];c[f]=g}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const g={};if(null===this.deletedStates[f])for(const y in this.state[f])g[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(null===this.deletedStates[f][y])this.state[f][y]={};else for(const x of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][x];g[y]=this.state[f][y]}c[f]=c[f]||{},rt(c[f],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const f in r)r[f].setFeatureState(c,s)}}class df{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,s){const c=this.toIdx(r,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(r,s){return this.leaves[this.toIdx(r,s)]}toIdx(r,s){return s*this.size+r}}function fv(o,r,s,c){let f=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(c[y])<1e-15){if(s[y]<o[y]||s[y]>r[y])return null}else{const x=1/c[y];let E=(o[y]-s[y])*x,D=(r[y]-s[y])*x;if(E>D){const M=E;E=D,D=M}if(E>f&&(f=E),D<g&&(g=D),f>g)return null}return f}function $g(o,r,s,c,f,g,y,x,E,D,M){const A=c-o,k=f-r,F=g-s,j=y-o,q=x-r,ee=E-s,le=M[1]*ee-M[2]*q,Ee=M[2]*j-M[0]*ee,Pe=M[0]*q-M[1]*j,Re=A*le+k*Ee+F*Pe;if(Math.abs(Re)<1e-15)return null;const Le=1/Re,Fe=D[0]-o,Ye=D[1]-r,Qe=D[2]-s,at=(Fe*le+Ye*Ee+Qe*Pe)*Le;if(at<0||at>1)return null;const dt=Ye*F-Qe*k,qe=Qe*A-Fe*F,tt=Fe*k-Ye*A,pt=(M[0]*dt+M[1]*qe+M[2]*tt)*Le;return pt<0||at+pt>1?null:(j*dt+q*qe+ee*tt)*Le}function Up(o,r,s){return(o-r)/(s-r)}function Vp(o,r,s,c,f,g,y,x,E){const D=1<<s,M=g-c,A=y-f,k=(o+1)/D*M+c,F=(r+0)/D*A+f,j=(r+1)/D*A+f;x[0]=(o+0)/D*M+c,x[1]=F,E[0]=k,E[1]=j}class $p{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const y=Math.ceil(Math.log2(g.dim/8)),x=[];let E=Math.ceil(Math.pow(2,y));const D=1/E,M=(F,j,q,ee,le)=>{const Ee=ee?1:0,Pe=(F+1)*q-Ee,Re=j*q,Le=(j+1)*q-Ee;le[0]=F*q,le[1]=Re,le[2]=Pe,le[3]=Le};let A=new df(E);const k=[];for(let F=0;F<E*E;F++){M(F%E,Math.floor(F/E),D,!1,k);const j=ul(k[0],k[1],g),q=ul(k[2],k[1],g),ee=ul(k[2],k[3],g),le=ul(k[0],k[3],g);A.minimums.push(Math.min(j,q,ee,le)),A.maximums.push(Math.max(j,q,ee,le)),A.leaves.push(1)}for(x.push(A),E/=2;E>=1;E/=2){const F=x[x.length-1];A=new df(E);for(let j=0;j<E*E;j++){M(j%E,Math.floor(j/E),2,!0,k);const q=F.getElevation(k[0],k[1]),ee=F.getElevation(k[2],k[1]),le=F.getElevation(k[2],k[3]),Ee=F.getElevation(k[0],k[3]),Pe=F.isLeaf(k[0],k[1]),Re=F.isLeaf(k[2],k[1]),Le=F.isLeaf(k[2],k[3]),Fe=F.isLeaf(k[0],k[3]),Ye=Math.min(q.min,ee.min,le.min,Ee.min),Qe=Math.max(q.max,ee.max,le.max,Ee.max),at=Pe&&Re&&Le&&Fe;A.maximums.push(Qe),A.minimums.push(Ye),A.leaves.push(Qe-Ye<=5&&at?1:0)}x.push(A)}return x}(this.dem),c=s.length-1,f=s[c];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(r,s,c,f,g,y,x=1){return fv([r,s,-100],[c,f,this.maximums[0]*x],g,y)}raycast(r,s,c,f,g,y,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,s,c,f,g,y,x);if(null==E)return null;const D=[],M=[],A=[],k=[],F=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:j,t:q,nodex:ee,nodey:le,depth:Ee}=F.pop();if(this.leaves[j]){Vp(ee,le,Ee,r,s,c,f,A,k);const Re=1<<Ee,Le=(ee+0)/Re,Fe=(ee+1)/Re,Ye=(le+0)/Re,Qe=(le+1)/Re,at=ul(Le,Ye,this.dem)*x,dt=ul(Fe,Ye,this.dem)*x,qe=ul(Fe,Qe,this.dem)*x,tt=ul(Le,Qe,this.dem)*x,pt=$g(A[0],A[1],at,k[0],A[1],dt,k[0],k[1],qe,g,y),Ct=$g(k[0],k[1],qe,A[0],k[1],tt,A[0],A[1],at,g,y),wt=Math.min(null!==pt?pt:Number.MAX_VALUE,null!==Ct?Ct:Number.MAX_VALUE);if(wt!==Number.MAX_VALUE)return wt;{const St=kd([],g,y,q);if(Gp(at,dt,tt,qe,Up(St[0],A[0],k[0]),Up(St[1],A[1],k[1]))>=St[2])return q}continue}let Pe=0;for(let Re=0;Re<this._siblingOffset.length;Re++){Vp((ee<<1)+this._siblingOffset[Re][0],(le<<1)+this._siblingOffset[Re][1],Ee+1,r,s,c,f,A,k),A[2]=-100,k[2]=this.maximums[this.childOffsets[j]+Re]*x;const Le=fv(A,k,g,y);if(null!=Le){const Fe=Le;D[Re]=Fe;let Ye=!1;for(let Qe=0;Qe<Pe&&!Ye;Qe++)Fe>=D[M[Qe]]&&(M.splice(Qe,0,Re),Ye=!0);Ye||(M[Pe]=Re),Pe++}}for(let Re=0;Re<Pe;Re++){const Le=M[Re];F.push({idx:this.childOffsets[j]+Le,t:D[Le],nodex:(ee<<1)+this._siblingOffset[Le][0],nodey:(le<<1)+this._siblingOffset[Le][1],depth:Ee+1})}}return null}_addNode(r,s,c){return this.minimums.push(r),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(r,s,c,f,g){if(1===r[f].isLeaf(s,c))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=f-1,x=r[y];let E=0,D=0;for(let M=0;M<this._siblingOffset.length;M++){const A=2*s+this._siblingOffset[M][0],k=2*c+this._siblingOffset[M][1],F=x.getElevation(A,k),j=x.isLeaf(A,k),q=this._addNode(F.min,F.max,j);j&&(E|=1<<M),D||(D=q)}for(let M=0;M<this._siblingOffset.length;M++)E&1<<M||this._construct(r,2*s+this._siblingOffset[M][0],2*c+this._siblingOffset[M][1],y,D+M)}}function Gp(o,r,s,c,f,g){return At(At(o,s,g),At(r,c,g),f)}function ul(o,r,s){const c=s.dim,f=J(o*c-.5,0,c-1),g=J(r*c-.5,0,c-1),y=Math.floor(f),x=Math.floor(g),E=Math.min(y+1,c-1),D=Math.min(x+1,c-1);return Gp(s.get(y,x),s.get(E,x),s.get(y,D),s.get(E,D),f-y,g-x)}const ka={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Mc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,s,c,f=!1,g=!1){if(this.uid=r,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return un(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const y=this.dim=s.height-2,x=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=f,!f){for(let E=0;E<y;E++)x[this._idx(-1,E)]=x[this._idx(0,E)],x[this._idx(y,E)]=x[this._idx(y-1,E)],x[this._idx(E,-1)]=x[this._idx(E,0)],x[this._idx(E,y)]=x[this._idx(E,y-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(y,-1)]=x[this._idx(y-1,0)],x[this._idx(-1,y)]=x[this._idx(0,y-1)],x[this._idx(y,y)]=x[this._idx(y-1,y-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new $p(this)}get(r,s,c=!1){c&&(r=J(r,-1,this.dim),s=J(s,-1,this.dim));const f=4*this._idx(r,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(r){return ka[r]}get unpackVector(){return ka[this.encoding]}_idx(r,s){if(r<-1||r>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(r+1)}_unpackMapbox(r,s,c){return(256*r*256+256*s+c)/10-1e4}_unpackTerrarium(r,s,c){return 256*r+s+c/256-32768}static pack(r,s){const c=[0,0,0,0],f=Mc.getUnpackVector(s);let g=Math.floor((r+f[3])/f[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new Qo({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,s,c){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let f=s*this.dim,g=s*this.dim+this.dim,y=c*this.dim,x=c*this.dim+this.dim;switch(s){case-1:f=g-1;break;case 1:g=f+1}switch(c){case-1:y=x-1;break;case 1:x=y+1}const E=-s*this.dim,D=-c*this.dim;for(let M=y;M<x;M++)for(let A=f;A<g;A++){const k=4*this._idx(A,M),F=4*this._idx(A+E,M+D);this.pixels[k+0]=r.pixels[F+0],this.pixels[k+1]=r.pixels[F+1],this.pixels[k+2]=r.pixels[F+2],this.pixels[k+3]=r.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Vt(Mc),Vt($p,{omit:["dem"]});class pv{constructor(r,s){this.max=r,this.onRemove=s,this.reset()}reset(){for(const r in this.data)for(const s of this.data[r])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(r,s,c){const f=r.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const g={value:s,timeout:void 0};if(void 0!==c&&(g.timeout=setTimeout(()=>{this.remove(r,g)},c)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const s=this.data[r].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),s.value}getByKey(r){const s=this.data[r];return s?s[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,s){if(!this.has(r))return this;const c=r.wrapped().key,f=void 0===s?0:this.data[c].indexOf(s),g=this.data[c][f];return this.data[c].splice(f,1),g.timeout&&clearTimeout(g.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(r){const s=[];for(const c in this.data)for(const f of this.data[c])r(f.value)||s.push(f);for(const c of s)this.remove(c.value.tileID,c)}}class Ou{constructor(r,s,c){this.func=r,this.mask=s,this.range=c}}Ou.ReadOnly=!1,Ou.ReadWrite=!0,Ou.disabled=new Ou(519,Ou.ReadOnly,[0,1]);class jh{constructor(r,s,c,f,g,y){this.test=r,this.ref=s,this.mask=c,this.fail=f,this.depthFail=g,this.pass=y}}jh.disabled=new jh({func:519,mask:0},0,0,7680,7680,7680);class ha{constructor(r,s,c){this.blendFunction=r,this.blendColor=s,this.mask=c}}ha.Replace=[1,0],ha.disabled=new ha(ha.Replace,qn.transparent,[!1,!1,!1,!1]),ha.unblended=new ha(ha.Replace,qn.transparent,[!0,!0,!0,!0]),ha.alphaBlended=new ha([1,771],qn.transparent,[!0,!0,!0,!0]);class da{constructor(r,s,c){this.enable=r,this.mode=s,this.frontFace=c}}da.disabled=new da(!1,1029,2305),da.backCCW=new da(!0,1029,2305),da.backCW=new da(!0,1029,2304),da.frontCW=new da(!0,1028,2304),da.frontCCW=new da(!0,1028,2305);class hl extends nn{constructor(r,s,c){super(),this.id=r,this._onlySymbols=c,s.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new pv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new dv,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const s=this._tiles[r];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,s){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,s)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const s in this._tiles){const c=this._tiles[s];this._source.prepareTile(c)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,c.tileID),c.upload(r),c.prepare(this.map.style.imageManager)}else for(const s in this._tiles){const c=this._tiles[s];c.upload(r),c.prepare(this.map.style.imageManager)}}getIds(){return He(this._tiles).map(r=>r.tileID).sort(Hp).map(r=>r.key)}getRenderableIds(r){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,r)&&s.push(this._tiles[c]);return r?s.sort((c,f)=>{const g=c.tileID,y=f.tileID,x=new $(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),E=new $(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-y.overscaledZ||E.y-x.y||E.x-x.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Hp).map(c=>c.key)}hasRenderableParent(r){const s=this.findLoadedParent(r,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(r,s){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(s||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,s){const c=this._tiles[r];c&&("loading"!==c.state&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,r,s)))}_tileLoaded(r,s,c,f){if(f)if(r.state="errored",404!==f.status)this._source.fire(new Xt(f,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=ur.now(),"expired"===c&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(s,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Wt("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const s=this.getRenderableIds();for(let f=0;f<s.length;f++){const g=s[f];if(r.neighboringTiles&&r.neighboringTiles[g]){const y=this.getTileByID(g);c(r,y),c(y,r)}}function c(f,g){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=g.tileID.canonical.x-f.tileID.canonical.x;const x=g.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),D=g.tileID.key;0===y&&0===x||Math.abs(x)>1||(Math.abs(y)>1&&(1===Math.abs(y+E)?y+=E:1===Math.abs(y-E)&&(y-=E)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,y,x),f.neighboringTiles&&f.neighboringTiles[D]&&(f.neighboringTiles[D].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,s,c,f){for(const g in this._tiles){let y=this._tiles[g];if(f[g]||!y.hasData()||y.tileID.overscaledZ<=s||y.tileID.overscaledZ>c)continue;let x=y.tileID;for(;y&&y.tileID.overscaledZ>s+1;){const D=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[D.key],y&&y.hasData()&&(x=D)}let E=x;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),r[E.key]){f[x.key]=x;break}}}findLoadedParent(r,s){if(r.key in this._loadedParentTiles){const c=this._loadedParentTiles[r.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=r.overscaledZ-1;c>=s;c--){const f=r.scaledTo(c),g=this._getLoadedTile(f);if(g)return g}}_getLoadedTile(r){const s=this._tiles[r.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,s){s=s||this._source.tileSize;const c=Math.ceil(r.width/s)+1,f=Math.ceil(r.height/s)+1,g=Math.floor(c*f*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(r){const s=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,s){const c={};for(const f in this._tiles){const g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(r,s,c){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let f;this.updateCacheSize(r,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Co(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(f=r.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(x=>this._source.hasTile(x)))):f=[];const g=this._updateRetainedTiles(f);if(qp(this._source.type)&&0!==f.length){const x={},E={},D=Object.keys(g);for(const A of D){const k=g[A],F=this._tiles[A];if(!F||F.fadeEndTime&&F.fadeEndTime<=ur.now())continue;const j=this.findLoadedParent(k,Math.max(k.overscaledZ-hl.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),x[j.tileID.key]=j.tileID),E[A]=k}const M=f[f.length-1].overscaledZ;for(const A in this._tiles){const k=this._tiles[A];if(g[A]||!k.hasData())continue;let F=k.tileID;for(;F.overscaledZ>M;){F=F.scaledTo(F.overscaledZ-1);const j=this._tiles[F.key];if(j&&j.hasData()&&E[F.key]){g[A]=k.tileID;break}}}for(const A in x)g[A]||(this._coveredTiles[A]=!0,g[A]=x[A])}for(const x in g)this._tiles[x].clearFadeHold();const y=function(x,E){const D=[];for(const M in x)M in E||D.push(M);return D}(this._tiles,g);for(const x of y){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const s={};if(0===r.length)return s;const c={},f=r.reduce((D,M)=>Math.min(D,M.overscaledZ),1/0),g=r[0].overscaledZ,y=Math.max(g-hl.maxOverzooming,this._source.minzoom),x=Math.max(g+hl.maxUnderzooming,this._source.minzoom),E={};for(const D of r){const M=this._addTile(D);s[D.key]=D,M.hasData()||f<this._source.maxzoom&&(E[D.key]=D)}this._retainLoadedChildren(E,f,x,s);for(const D of r){let M=this._tiles[D.key];if(M.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const k=D.children(this._source.maxzoom)[0],F=this.getTile(k);if(F&&F.hasData()){s[k.key]=k;continue}}else{const k=D.children(this._source.maxzoom);if(s[k[0].key]&&s[k[1].key]&&s[k[2].key]&&s[k[3].key])continue}let A=M.wasRequested();for(let k=D.overscaledZ-1;k>=y;--k){const F=D.scaledTo(k);if(c[F.key]||(c[F.key]=!0,M=this.getTile(F),!M&&A&&(M=this._addTile(F)),M&&(s[F.key]=F,A=M.wasRequested(),M.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const s=[];let c,f=this._tiles[r].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}s.push(f.key);const g=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;f=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(r){let s=this._tiles[r.key];if(s)return this._source.prepareTile&&this._source.prepareTile(s),s;s=this._cache.getAndRemove(r),s&&(this._setTileReloadTimer(r.key,s),s.tileID=r,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,s)));const c=Boolean(s);if(!c){const f=this.map?this.map.painter:null;s=new jp(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._source.prepareTile&&this._source.prepareTile(s)||this._loadTile(s,this._tileLoaded.bind(this,s,r.key,s.state))}return s?(s.uses++,this._tiles[r.key]=s,c||this._source.fire(new Wt("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(r,s){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const c=s.getExpiryTimeout();c&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},c))}_removeTile(r){const s=this._tiles[r];s&&(s.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,s,c){const f=[],g=this.transform;if(!g)return f;for(const y in this._tiles){const x=this._tiles[y];if(c&&x.clearQueryDebugViz(),x.holdingForFade())continue;const E=r.containsTile(x,g,s);E&&f.push(E)}return f}getVisibleCoordinates(r){const s=this.getRenderableIds(r).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(qp(this._source.type))for(const r in this._tiles){const s=this._tiles[r];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=ur.now())return!0}return!1}setFeatureState(r,s,c){this._state.updateState(r=r||"_geojsonTileLayer",s,c)}removeFeatureState(r,s,c){this._state.removeFeatureState(r=r||"_geojsonTileLayer",s,c)}getFeatureState(r,s){return this._state.getState(r=r||"_geojsonTileLayer",s)}setDependencies(r,s,c){const f=this._tiles[r];f&&f.setDependencies(s,c)}reloadTilesForDependencies(r,s){for(const c in this._tiles)this._tiles[c].hasDependency(r,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(r,s))}_preloadTiles(r,s){const c=new Map,f=Array.isArray(r)?r:[r],g=this.map.painter.terrain,y=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const x of f){const E=x.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of E)c.set(D.key,D);this.usedForTerrain&&x.updateElevation(!1)}Be(Array.from(c.values()),(x,E)=>{const D=new jp(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,M=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),E(M,D)})},s)}}function Hp(o,r){const s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*r.wrap)-+(r.wrap<0);return o.overscaledZ-r.overscaledZ||c-s||r.canonical.y-o.canonical.y||r.canonical.x-o.canonical.x}function qp(o){return"raster"===o||"image"===o||"video"===o}hl.maxOverzooming=10,hl.maxUnderzooming=3;class Vh{constructor(r,s,c){this._demTile=r,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(r,s,c){const f=c||r.findDEMTileFor(s);if(!f||!f.dem)return;const g=f.dem,y=f.tileID,x=1<<s.canonical.z-y.canonical.z;return new Vh(f,f.tileSize/In/x,[(s.canonical.x/x-y.canonical.x)*g.dim,(s.canonical.y/x-y.canonical.y)*g.dim])}tileCoordToPixel(r,s){const c=s*this._scale+this._offset[1],f=Math.floor(r*this._scale+this._offset[0]),g=Math.floor(c);return new $(f,g)}getElevationAt(r,s,c,f){const g=r*this._scale+this._offset[0],y=s*this._scale+this._offset[1],x=Math.floor(g),E=Math.floor(y),D=this._dem;return f=!!f,c?At(At(D.get(x,E,f),D.get(x,E+1,f),y-E),At(D.get(x+1,E,f),D.get(x+1,E+1,f),y-E),g-x):D.get(x,E,f)}getElevationAtPixel(r,s,c){return this._dem.get(r,s,!!c)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Ta(1,r)*this._dem.stride}}class Hg{constructor(r,s){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Ui(In,16,0),this.featureIndexArray=new Yr,this.promoteId=s}insert(r,s,c,f,g,y=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,g,y);const E=this.grid;for(let D=0;D<s.length;D++){const M=s[D],A=[1/0,1/0,-1/0,-1/0];for(let k=0;k<M.length;k++){const F=M[k];A[0]=Math.min(A[0],F.x),A[1]=Math.min(A[1],F.y),A[2]=Math.max(A[2],F.x),A[3]=Math.max(A[3],F.y)}A[0]<In&&A[1]<In&&A[2]>=0&&A[3]>=0&&E.insert(x,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Bl.VectorTile(new Rh(this.rawTileData)).layers,this.sourceLayerCoder=new Ug(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,s,c,f){this.loadVTLayers();const g=r.params||{},y=Pr(g.filter),x=r.tileResult,E=r.transform,D=x.bufferedTilespaceBounds,M=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(j,q,ee,le)=>Xf(x.bufferedTilespaceGeometry,j,q,ee,le));M.sort(mv);let A=null;E.elevation&&M.length>0&&(A=Vh.create(E.elevation,this.tileID));const k={};let F;for(let j=0;j<M.length;j++){const q=M[j];if(q===F)continue;F=q;const ee=this.featureIndexArray.get(q);let le=null;this.loadMatchingFeature(k,ee,y,g.layers,g.availableImages,s,c,f,(Ee,Pe,Re,Le=0)=>(le||(le=Ol(Ee,this.tileID.canonical,r.tileTransform)),Pe.queryIntersectsFeature(x,Ee,Re,le,this.z,r.transform,r.pixelPosMatrix,A,Le)))}return k}loadMatchingFeature(r,s,c,f,g,y,x,E,D){const{featureIndex:M,bucketIndex:A,sourceLayerIndex:k,layoutVertexArrayOffset:F}=s,j=this.bucketLayerIDs[A];if(f&&!function(Ee,Pe){for(let Re=0;Re<Ee.length;Re++)if(Pe.indexOf(Ee[Re])>=0)return!0;return!1}(f,j))return;const q=this.sourceLayerCoder.decode(k),ee=this.vtLayers[q].feature(M);if(c.needGeometry){const Ee=Ll(ee,!0);if(!c.filter(new kr(this.tileID.overscaledZ),Ee,this.tileID.canonical))return}else if(!c.filter(new kr(this.tileID.overscaledZ),ee))return;const le=this.getId(ee,q);for(let Ee=0;Ee<j.length;Ee++){const Pe=j[Ee];if(f&&f.indexOf(Pe)<0)continue;const Re=y[Pe];if(!Re)continue;let Le={};void 0!==le&&E&&(Le=E.getState(Re.sourceLayer||"_geojsonTileLayer",le));const Fe=rt({},x[Pe]);Fe.paint=ff(Fe.paint,Re.paint,ee,Le,g),Fe.layout=ff(Fe.layout,Re.layout,ee,Le,g);const Ye=!D||D(ee,Re,Le,F);if(!Ye)continue;const Qe=new Vg(ee,this.z,this.x,this.y,le);Qe.layer=Fe;let at=r[Pe];void 0===at&&(at=r[Pe]=[]),at.push({featureIndex:M,feature:Qe,intersectionZ:Ye})}}lookupSymbolFeatures(r,s,c,f,g,y,x,E){const D={};this.loadVTLayers();const M=Pr(g);for(const A of r)this.loadMatchingFeature(D,{bucketIndex:c,sourceLayerIndex:f,featureIndex:A,layoutVertexArrayOffset:0},M,y,x,E,s);return D}loadFeature(r){const{featureIndex:s,sourceLayerIndex:c}=r;this.loadVTLayers();const f=this.sourceLayerCoder.decode(c),g=this.vtFeatures[f];if(g[s])return g[s];const y=this.vtLayers[f].feature(s);return g[s]=y,y}hasLayer(r){for(const s of this.bucketLayerIDs)for(const c of s)if(r===c)return!0;return!1}getId(r,s){let c=r.id;return this.promoteId&&(c=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof c&&(c=Number(c))),c}}function ff(o,r,s,c,f){return cn(o,(g,y)=>{const x=r instanceof w?r.get(y):null;return x&&x.evaluate?x.evaluate(s,c,f):x})}function mv(o,r){return r-o}Vt(Hg,{omit:["rawTileData","sourceLayerCoder"]});class qg{constructor(r){const s={},c=[];for(const x in r){const E=r[x],D=s[x]={};for(const M in E.glyphs){const A=E.glyphs[+M];if(!A||0===A.bitmap.width||0===A.bitmap.height)continue;const k=A.metrics.localGlyph?2:1,F={x:0,y:0,w:A.bitmap.width+2*k,h:A.bitmap.height+2*k};c.push(F),D[M]=F}}const{w:f,h:g}=bp(c),y=new Da({width:f||1,height:g||1});for(const x in r){const E=r[x];for(const D in E.glyphs){const M=E.glyphs[+D];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const A=s[x][D],k=M.metrics.localGlyph?2:1;Da.copy(M.bitmap,y,{x:0,y:0},{x:A.x+k,y:A.y+k},M.bitmap)}}this.image=y,this.positions=s}}Vt(qg);class Zg{constructor(r){this.tileID=new Co(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Vl(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,s,c,f,g){this.status="parsing",this.data=r,this.collisionBoxArray=new wa;const y=new Ug(Object.keys(r.layers).sort()),x=new Hg(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},D=new af(256,256),M={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:c},A=s.familiesBySource[this.source];for(const Le in A){const Fe=r.layers[Le];if(!Fe)continue;let Ye=!1,Qe=!1;for(const qe of A[Le])"symbol"===qe[0].type?Ye=!0:Qe=!0;if(!0===this.isSymbolTile&&!Ye||!1===this.isSymbolTile&&!Qe)continue;1===Fe.version&&un(`Vector tile source "${this.source}" layer "${Le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const at=y.encode(Le),dt=[];for(let qe=0;qe<Fe.length;qe++){const tt=Fe.feature(qe),pt=x.getId(tt,Le);dt.push({feature:tt,id:pt,index:qe,sourceLayerIndex:at})}for(const qe of A[Le]){const tt=qe[0];void 0!==this.isSymbolTile&&"symbol"===tt.type!==this.isSymbolTile||tt.minzoom&&this.zoom<Math.floor(tt.minzoom)||tt.maxzoom&&this.zoom>=tt.maxzoom||"none"!==tt.visibility&&(Gl(qe,this.zoom,c),(E[tt.id]=tt.createBucket({index:x.bucketLayerIDs.length,layers:qe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:at,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:c})).populate(dt,M,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(qe.map(pt=>pt.id)))}}let k,F,j,q;D.trim();const ee={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},le=cn(M.glyphDependencies,Le=>Object.keys(Le).map(Number));Object.keys(le).length?f.send("getGlyphs",{uid:this.uid,stacks:le},(Le,Fe)=>{k||(k=Le,F=Fe,Re.call(this))},void 0,!1,ee):F={};const Ee=Object.keys(M.iconDependencies);Ee.length?f.send("getImages",{icons:Ee,source:this.source,tileID:this.tileID,type:"icons"},(Le,Fe)=>{k||(k=Le,j=Fe,Re.call(this))},void 0,!1,ee):j={};const Pe=Object.keys(M.patternDependencies);function Re(){if(k)return g(k);if(F&&j&&q){const Le=new qg(F),Fe=new Ec(j,q);for(const Ye in E){const Qe=E[Ye];Qe instanceof Ma?(Gl(Qe.layers,this.zoom,c),iv(Qe,F,Le.positions,j,Fe.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):Qe.hasPattern&&(Qe instanceof Tu||Qe instanceof zd||Qe instanceof yc)&&(Gl(Qe.layers,this.zoom,c),Qe.addFeatures(M,this.tileID.canonical,Fe.patternPositions,c,this.tileTransform))}this.status="done",g(null,{buckets:He(E).filter(Ye=>!Ye.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Le.image,lineAtlas:D,imageAtlas:Fe,glyphMap:this.returnDependencies?F:null,iconMap:this.returnDependencies?j:null,glyphPositions:this.returnDependencies?Le.positions:null})}}Pe.length?f.send("getImages",{icons:Pe,source:this.source,tileID:this.tileID,type:"patterns"},(Le,Fe)=>{k||(k=Le,q=Fe,Re.call(this))},void 0,!1,ee):q={},Re.call(this)}}function Gl(o,r,s){const c=new kr(r);for(const f of o)f.recalculate(c,s)}class Zp{constructor(r){this.entries={},this.scheduler=r}request(r,s,c,f){const g=this.entries[r]=this.entries[r]||{callbacks:[]};if(g.result){const[y,x]=g.result;return this.scheduler?this.scheduler.add(()=>{f(y,x)},s):f(y,x),()=>{}}return g.callbacks.push(f),g.cancel||(g.cancel=c((y,x)=>{g.result=[y,x];for(const E of g.callbacks)this.scheduler?this.scheduler.add(()=>{E(y,x)},s):E(y,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(y=>y!==f),g.callbacks.length||(g.cancel(),delete this.entries[r]))}}}function Wg(o,r,s){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},f=>{const g=se(o.request,(y,x,E,D)=>{y?f(y):x&&f(null,{vectorTile:s?void 0:new Bl.VectorTile(new Rh(x)),rawData:x,cacheControl:E,expires:D})});return()=>{g.cancel(),f()}},r)}const gv=Ca(new Float32Array(16));class bs{constructor(r){this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,s){return{x:0,y:0,z:0}}unproject(r,s){return new Er(0,0)}projectTilePoint(r,s,c){return{x:r,y:s,z:0}}locationPoint(r,s){return r._coordinatePoint(r.locationCoordinate(s),!1)}pixelsPerMeter(r,s){return Ta(1,r)*s}farthestPixelDistance(r){return function(s,c){const f=s.fovAboveCenter,g=s.elevation?s.elevation.getMinElevationBelowMSL()*c:0,y=(s._camera.position[2]*s.worldSize-g)/Math.cos(s._pitch),x=Math.sin(f)*y/Math.sin(Math.max(Math.PI/2-s._pitch-f,.01)),E=Math.sin(s._pitch)*x+y;return Math.min(1.01*E,y*(1/s._horizonShift))}(r,r.pixelsPerMeter)}pointCoordinate(r,s,c,f){const g=r.horizonLineFromTop(!1),y=new $(s,Math.max(g,c));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,f))}createInversionMatrix(r,s){return gv}createTileMatrix(r,s,c){let f,g,y;const x=c.canonical,E=Ca(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=Vl(x,this);f=1,g=D.x+c.wrap*D.scale,y=D.y,pc(E,E,[f/D.scale,f/D.scale,r.pixelsPerMeter/s])}else f=s/r.zoomScale(x.z),g=(x.x+Math.pow(2,x.z)*c.wrap)*f,y=x.y*f;return fu(E,E,[g,y,0]),pc(E,E,[f/In,f/In,1]),E}upVector(r,s,c){return[0,0,1]}upVectorScale(r,s,c){return{metersToTile:1,metersToLabelSpace:1}}}class _v extends bs{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,s){return{x:Us(r),y:dc(s),z:0}}unproject(r,s){const c=Vs(r),f=Gi(s);return new Er(c,f)}}class yv extends bs{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[s,c]=this.parallels=r.parallels||[29.5,45.5],f=Math.sin(ue(s));this.n=(f+Math.sin(ue(c)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(r,s){const{n:c,c:f,r0:g}=this,y=ue(r-this.center[0]),x=ue(s),E=Math.sqrt(f-2*c*Math.sin(x))/c;return{x:E*Math.sin(y*c),y:E*Math.cos(y*c)-g,z:0}}unproject(r,s){const{n:c,c:f,r0:g}=this,y=g+s;let x=Math.atan2(r,Math.abs(y))*Math.sign(y);y*c<0&&(x-=Math.PI*Math.sign(r)*Math.sign(y));const E=ue(this.center[0])*c;x=Me(x,-Math.PI-E,Math.PI-E);const D=Te(x/c)+this.center[0],M=Math.asin(J((f-(r*r+y*y)*c*c)/(2*c),-1,1)),A=J(Te(M),-85.051129,ps);return new Er(D,A)}}const $h=1.340264,Gh=-.081106,qi=893e-6,Pc=.003796,Hh=Math.sqrt(3)/2;class Xg extends bs{project(r,s){s=s/180*Math.PI,r=r/180*Math.PI;const c=Math.asin(Hh*Math.sin(s)),f=c*c,g=f*f*f;return{x:.5*(r*Math.cos(c)/(Hh*($h+3*Gh*f+g*(7*qi+9*Pc*f)))/Math.PI+.5),y:1-.5*(c*($h+Gh*f+g*(qi+Pc*f))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,f=c*c,g=f*f*f;for(let M,A,k,F=0;F<12&&(A=c*($h+Gh*f+g*(qi+Pc*f))-s,k=$h+3*Gh*f+g*(7*qi+9*Pc*f),M=A/k,c=J(c-M,-Math.PI/3,Math.PI/3),f=c*c,g=f*f*f,!(Math.abs(M)<1e-12));++F);const y=Hh*r*($h+3*Gh*f+g*(7*qi+9*Pc*f))/Math.cos(c),x=Math.asin(Math.sin(c)/Hh),E=J(180*y/Math.PI,-180,180),D=J(180*x/Math.PI,-85.051129,ps);return new Er(E,D)}}class Kg extends bs{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){return{x:.5+r/360,y:.5-s/360,z:0}}unproject(r,s){const c=360*(r-.5),f=J(360*(.5-s),-85.051129,ps);return new Er(c,f)}}const kc=Math.PI/2;function pf(o){return Math.tan((kc+o)/2)}class vv extends bs{constructor(r){super(r),this.center=r.center||[0,30];const[s,c]=this.parallels=r.parallels||[30,30],f=ue(s),g=ue(c),y=Math.cos(f);this.n=f===g?Math.sin(f):Math.log(y/Math.cos(g))/Math.log(pf(g)/pf(f)),this.f=y*Math.pow(pf(f),this.n)/this.n}project(r,s){s=ue(s),r=ue(r-this.center[0]);const c=1e-6,{n:f,f:g}=this;g>0?s<-kc+c&&(s=-kc+c):s>kc-c&&(s=kc-c);const y=g/Math.pow(pf(s),f),x=y*Math.sin(f*r),E=g-y*Math.cos(f*r);return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+.5),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI,s=(2*(1-s)-.5)*Math.PI;const{n:c,f}=this,g=f-s,y=Math.sign(g),x=Math.sign(c)*Math.sqrt(r*r+g*g);let E=Math.atan2(r,Math.abs(g))*y;g*c<0&&(E-=Math.PI*Math.sign(r)*y);const D=J(Te(E/c)+this.center[0],-180,180),M=J(Te(2*Math.atan(Math.pow(f/x,1/c))-kc),-85.051129,ps);return new Er(D,M)}}const Yg=ue(ps);class xv extends bs{project(r,s){const c=(s=ue(s))*s,f=c*c;return{x:.5*((r=ue(r))*(.8707-.131979*c+f*(f*(.003971*c-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+f*(.028874*c-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,f=25,g=0,y=c*c;do{y=c*c;const D=y*y;g=(c*(1.007226+y*(.015085+D*(.028874*y-.044475-.005916*D)))-s)/(1.007226+y*(.045255+D*(.259866*y-.311325-.005916*11*D))),c=J(c-g,-Yg,Yg)}while(Math.abs(g)>1e-6&&--f>0);y=c*c;const x=J(Te(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=Te(c);return new Er(x,E)}}const Wp=ue(ps);class F0 extends bs{project(r,s){s=ue(s),r=ue(r);const c=Math.cos(s),f=2/Math.PI,g=Math.acos(c*Math.cos(r/2)),y=Math.sin(g)/g,x=.5*(r*f+2*c*Math.sin(r/2)/y)||0,E=.5*(s+Math.sin(s)/y)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,s){let c=r=(2*r-.5)*Math.PI,f=s=(2*(1-s)-1)*Math.PI,g=25;const y=1e-6;let x=0,E=0;do{const D=Math.cos(f),M=Math.sin(f),A=2*M*D,k=M*M,F=D*D,j=Math.cos(c/2),q=Math.sin(c/2),ee=2*j*q,le=q*q,Ee=1-F*j*j,Pe=Ee?1/Ee:0,Re=Ee?Math.acos(D*j)*Math.sqrt(1/Ee):0,Le=.5*(2*Re*D*q+2*c/Math.PI)-r,Fe=.5*(Re*M+f)-s,Ye=.5*Pe*(F*le+Re*D*j*k)+1/Math.PI,Qe=Pe*(ee*A/4-Re*M*q),at=.125*Pe*(A*q-Re*M*F*ee),dt=.5*Pe*(k*j+Re*le*D)+.5,qe=Qe*at-dt*Ye;x=(Fe*Qe-Le*dt)/qe,E=(Le*at-Fe*Ye)/qe,c=J(c-x,-Math.PI,Math.PI),f=J(f-E,-Wp,Wp)}while((Math.abs(x)>y||Math.abs(E)>y)&&--g>0);return new Er(Te(c),Te(f))}}class Xp extends bs{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ue(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){const{scale:c,cosPhi:f}=this;return{x:ue(r)*f*c+.5,y:-Math.sin(ue(s))/f*c+.5,z:0}}unproject(r,s){const{scale:c,cosPhi:f}=this,g=-(s-.5)/c,y=J(Te((r-.5)/c)/f,-180,180),x=Math.asin(J(g*f,-1,1)),E=J(Te(x),-85.051129,ps);return new Er(y,E)}}h.ARRAY_TYPE=Ci,h.AUTH_ERR_MSG=no,h.Aabb=ms,h.Actor=class{constructor(o,r,s){this.target=o,this.parent=r,this.mapId=s,this.callbacks={},this.cancelCallbacks={},ut(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=kt()?o:W,this.scheduler=new lv}send(o,r,s,c,f=!1,g){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=g,this.callbacks[y]=s);const x=kn(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:o,hasCallback:!!s,targetMapId:c,mustQueue:f,sourceMapId:this.mapId,data:ba(r,x)},x),{cancel:()=>{s&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const r=o.data,s=r.id;if(s&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(r.mustQueue||kt()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,r),c&&c.metadata||{type:"message"})}else this.processTask(s,r)}processTask(o,r){if("<response>"===r.type){const s=this.callbacks[o];delete this.callbacks[o],s&&(r.error?s(vi(r.error)):s(null,vi(r.data)))}else{const s=kn(this.globalScope)?void 0:[],c=r.hasCallback?(g,y)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:g?ba(g):null,data:ba(y,s)},s)}:g=>{},f=vi(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,f,c);else if(this.parent.getWorkerSource){const g=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,g[0],f.source)[g[1]](f,c)}else c(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.CanonicalTileID=Ru,h.Color=qn,h.ColorMode=ha,h.CullFaceMode=da,h.DEMData=Mc,h.DataConstantProperty=C,h.DedupedRequest=Zp,h.DepthMode=Ou,h.EXTENT=In,h.Elevation=class{isDataAvailableAtPoint(o){const r=this._source();if(!r||o.y<0||o.y>1)return!1;const s=r.getSource().maxzoom,c=1<<s,f=Math.floor(o.x),g=Math.floor((o.x-f)*c),y=Math.floor(o.y*c),x=this.findDEMTileFor(new Co(s,f,s,g,y));return!(!x||!x.dem)}getAtPointOrZero(o,r=0){return this.getAtPoint(o,r)||0}getAtPoint(o,r,s=!0){null==r&&(r=null);const c=this._source();if(!c||o.y<0||o.y>1)return r;const f=c.getSource().maxzoom,g=1<<f,y=Math.floor(o.x),x=o.x-y,E=new Co(f,y,f,Math.floor(x*g),Math.floor(o.y*g)),D=this.findDEMTileFor(E);if(!D||!D.dem)return r;const M=D.dem,A=1<<D.tileID.canonical.z,k=(x*A-D.tileID.canonical.x)*M.dim,F=(o.y*A-D.tileID.canonical.y)*M.dim,j=Math.floor(k),q=Math.floor(F);return(s?this.exaggeration():1)*At(At(M.get(j,q),M.get(j,q+1),F-q),At(M.get(j+1,q),M.get(j+1,q+1),F-q),k-j)}getAtTileOffset(o,r,s){const c=1<<o.canonical.z;return this.getAtPointOrZero(new _h(o.wrap+(o.canonical.x+r/In)/c,(o.canonical.y+s/In)/c))}getAtTileOffsetFunc(o,r,s,c){return f=>{const g=this.getAtTileOffset(o,f.x,f.y),y=c.upVector(o.canonical,f.x,f.y);return ol(y,y,g*c.upVectorScale(o.canonical,r,s).metersToTile),y}}getForTilePoints(o,r,s,c){const f=Vh.create(this,o,c);return!!f&&(r.forEach(g=>{g[2]=this.exaggeration()*f.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(o){const r=this.findDEMTileFor(o);if(!r||!r.dem)return null;const s=r.dem.tree,c=r.tileID,f=1<<o.canonical.z-c.canonical.z;let g=o.canonical.x/f-c.canonical.x,y=o.canonical.y/f-c.canonical.y,x=0;for(let E=0;E<o.canonical.z-c.canonical.z&&!s.leaves[x];E++){g*=2,y*=2;const D=2*Math.floor(y)+Math.floor(g);x=s.childOffsets[x]+D,g%=1,y%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,r,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},h.ErrorEvent=Xt,h.EvaluationParameters=kr,h.Event=Wt,h.Evented=nn,h.FillExtrusionBucket=yc,h.Frustum=ep,h.GLOBE_RADIUS=ku,h.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o),this._createAtmosphere(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(o){const r=new fe,s=new Ke,c=65;for(let f=0;f<c;f++)for(let g=0;g<c;g++)r.emplaceBack(g,f);for(let f=0;f<64;f++)for(let g=0;g<64;g++){const y=f*c+g;s.emplaceBack(y+1,y,y+c),s.emplaceBack(y+c,y+c+1,y+1)}this._gridBuffer=o.createVertexBuffer(r,Bh.members),this._gridIndexBuffer=o.createIndexBuffer(s,!0),this._gridSegments=ai.simpleSegment(0,0,4225,8192)}_createPoles(o){const r=new Ke;for(let f=0;f<=64;f++)r.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=o.createIndexBuffer(r,!0);const s=new qt,c=new qt;this._poleSegments=[];for(let f=0,g=0;f<5;f++){const y=1<<f,x=512*y/Math.PI/2,E=360/y;s.emplaceBack(0,-x,0,0,0,.5,0),c.emplaceBack(0,-x,0,0,0,.5,1);for(let D=0;D<=64;D++){const M=D/64,A=At(0,E,M),[k,F,j]=Fg(Bg,uv,A,x);s.emplaceBack(k,F,j,0,0,M,0),c.emplaceBack(k,F,j,0,0,M,1)}this._poleSegments.push(ai.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(s,Rg,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,Rg,!1)}_createAtmosphere(o){const r=new an;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const s=new Ke;s.emplaceBack(0,1,2),s.emplaceBack(2,3,0),this.atmosphereVertexBuffer=o.createVertexBuffer(r,cv.members),this.atmosphereIndexBuffer=o.createIndexBuffer(s),this.atmosphereSegments=ai.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o){if(!this._wireframeSegments){const r=new en,s=64,c=s+1;for(let f=0;f<s;f++)for(let g=0;g<s;g++){const y=f*c+g;r.emplaceBack(y,y+1),r.emplaceBack(y,y+c),r.emplaceBack(y,y+c+1)}this._wireframeIndexBuffer=o.createIndexBuffer(r),this._wireframeSegments=ai.simpleSegment(0,0,s*s,r.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},h.GlyphManager=Tc,h.ImagePosition=$n,h.LineAtlas=af,h.LngLat=Er,h.LngLatBounds=js,h.LocalGlyphMode=Jd,h.MAX_MERCATOR_LATITUDE=ps,h.MercatorCoordinate=_h,h.ONE_EM=24,h.OverscaledTileID=Co,h.Properties=B,h.RGBAImage=Qo,h.Ray=class{constructor(o,r){this.pos=o,this.dir=r}intersectsPlane(o,r,s){const c=mu(r,this.dir);if(Math.abs(c)<1e-6)return!1;const f=((o[0]-this.pos[0])*r[0]+(o[1]-this.pos[1])*r[1]+(o[2]-this.pos[2])*r[2])/c;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(o,r,s){if(j=(k=this.pos)[0],q=k[1],ee=k[2],le=(F=o)[0],Ee=F[1],Pe=F[2],Math.abs(j-le)<=Kf*Math.max(1,Math.abs(j),Math.abs(le))&&Math.abs(q-Ee)<=Kf*Math.max(1,Math.abs(q),Math.abs(Ee))&&Math.abs(ee-Pe)<=Kf*Math.max(1,Math.abs(ee),Math.abs(Pe))||0===r)return s[0]=s[1]=s[2]=0,!1;var k,F,j,q,ee,le,Ee,Pe;const[c,f,g]=this.dir,y=this.pos[0]-o[0],x=this.pos[1]-o[1],E=this.pos[2]-o[2],D=c*c+f*f+g*g,M=2*(y*c+x*f+E*g),A=M*M-4*D*(y*y+x*x+E*E-r*r);if(A<0){const k=Math.max(-M/2,0),F=y+c*k,j=x+f*k,q=E+g*k,ee=Math.hypot(F,j,q);return s[0]=F*r/ee,s[1]=j*r/ee,s[2]=q*r/ee,!1}{const k=(-M-Math.sqrt(A))/(2*D);if(k<0){const F=Math.hypot(y,x,E);return s[0]=y*r/F,s[1]=x*r/F,s[2]=E*r/F,!1}return s[0]=y+c*k,s[1]=x+f*k,s[2]=E+g*k,!0}}},h.RequestManager=class{constructor(o,r,s){this._transformRequestFn=o,this._customAccessToken=r,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let r="";for(let s=0;s<10;s++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Nr,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,r){return this._transformRequestFn&&this._transformRequestFn(o,r)||{url:o}}normalizeStyleURL(o,r){if(!Wi(o))return o;const s=Pi(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeGlyphsURL(o,r){if(!Wi(o))return o;const s=Pi(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeSourceURL(o,r){if(!Wi(o))return o;const s=Pi(o);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||r)}normalizeSpriteURL(o,r,s,c){const f=Pi(o);return Wi(o)?(f.path=`/styles/v1${f.path}/sprite${r}${s}`,this._makeAPIURL(f,this._customAccessToken||c)):(f.path+=`${r}${s}`,ro(f))}normalizeTileURL(o,r,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Wi(o))return o;const c=Pi(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||s&&"raster"!==c.authority&&512===s?"@2x":""}${hr.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${yn.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${yn.TILE_URL_VERSION}${c.path}`);const f=this._customAccessToken||function(g){for(const y of g){const x=y.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||yn.ACCESS_TOKEN;return yn.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,f)}canonicalizeTileURL(o,r){const s=Pi(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${yn.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${yn.TILE_URL_VERSION}/`,"")}`;let f=s.params;return r&&(f=f.filter(g=>!g.match(/^access_token=/))),f.length&&(c+=`?${f.join("&")}`),c}canonicalizeTileset(o,r){const s=!!r&&Wi(r),c=[];for(const f of o.tiles||[])Vo(f)?c.push(this.canonicalizeTileURL(f,s)):c.push(f);return c}_makeAPIURL(o,r){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=Pi(yn.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,"http"===o.protocol){const f=o.params.indexOf("secure");f>=0&&o.params.splice(f,1)}if("/"!==c.path&&(o.path=`${c.path}${o.path}`),!yn.REQUIRE_ACCESS_TOKEN)return ro(o);if(r=r||yn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(f=>-1===f.indexOf("access_token")),o.params.push(`access_token=${r||""}`),ro(o)}},h.ResourceType=oe,h.SegmentVector=ai,h.SourceCache=hl,h.StencilMode=jh,h.StructArrayLayout1ui2=vn,h.StructArrayLayout2f1f2i16=xt,h.StructArrayLayout2i4=fe,h.StructArrayLayout2ui4=en,h.StructArrayLayout3f12=Ce,h.StructArrayLayout3ui6=Ke,h.StructArrayLayout4i8=ve,h.Texture=Nh,h.Tile=jp,h.Transitionable=p,h.Uniform1f=mh,h.Uniform1i=class extends Pl{constructor(o,r){super(o,r),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},h.Uniform2f=class extends Pl{constructor(o,r){super(o,r),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},h.Uniform3f=class extends Pl{constructor(o,r){super(o,r),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},h.Uniform4f=Om,h.UniformColor=Lm,h.UniformMatrix2f=class extends Pl{constructor(o,r){super(o,r),this.current=ay}set(o){for(let r=0;r<4;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}},h.UniformMatrix3f=class extends Pl{constructor(o,r){super(o,r),this.current=sy}set(o){for(let r=0;r<9;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},h.UniformMatrix4f=class extends Pl{constructor(o,r){super(o,r),this.current=oy}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let r=1;r<16;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},h.UnwrappedTileID=jg,h.ValidationError=Ft,h.VectorTileWorkerSource=class extends nn{constructor(o,r,s,c,f){super(),this.actor=o,this.layerIndex=r,this.availableImages=s,this.loadVectorData=f||Wg,this.loading={},this.loaded={},this.deduped=new Zp(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,r){const s=o.uid,c=o&&o.request,f=c&&c.collectResourceTiming,g=this.loading[s]=new Zg(o);g.abort=this.loadVectorData(o,(y,x)=>{const E=!this.loading[s];if(delete this.loading[s],E||y||!x)return g.status="done",E||(this.loaded[s]=g),r(y);const D=x.rawData,M={};x.expires&&(M.expires=x.expires),x.cacheControl&&(M.cacheControl=x.cacheControl),g.vectorTile=x.vectorTile||new Bl.VectorTile(new Rh(D));const A=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,F)=>{if(k||!F)return r(k);const j={};if(f){const q=kp(c);q.length>0&&(j.resourceTiming=JSON.parse(JSON.stringify(q)))}r(null,rt({rawTileData:D.slice(0)},F,M,j))})};this.isSpriteLoaded?A():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(A,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):A()}),this.loaded=this.loaded||{},this.loaded[s]=g})}reloadTile(o,r){const s=this.loaded,c=o.uid,f=this;if(s&&s[c]){const g=s[c];g.showCollisionBoxes=o.showCollisionBoxes,g.enableTerrain=!!o.enableTerrain,g.projection=o.projection,g.tileTransform=Vl(o.tileID.canonical,o.projection);const y=(x,E)=>{const D=g.reloadCallback;D&&(delete g.reloadCallback,g.parse(g.vectorTile,f.layerIndex,this.availableImages,f.actor,D)),r(x,E)};"parsing"===g.status?g.reloadCallback=y:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(o,r){const s=o.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),r()}removeTile(o,r){const s=this.loaded,c=o.uid;s&&s[c]&&delete s[c],r()}},h.WritingMode=es,h.ZoomHistory=fs,h.add=yy,h.addDynamicAttributes=Mp,h.adjoint=function(o,r){var s=r[0],c=r[1],f=r[2],g=r[3],y=r[4],x=r[5],E=r[6],D=r[7],M=r[8];return o[0]=y*M-x*D,o[1]=f*D-c*M,o[2]=c*x-f*y,o[3]=x*E-g*M,o[4]=s*M-f*E,o[5]=f*g-s*x,o[6]=g*D-y*E,o[7]=c*E-s*D,o[8]=s*y-c*g,o},h.asyncAll=Be,h.bezier=we,h.bindAll=ut,h.boundsAttributes=hf,h.bufferConvexPolygon=function(o,r){const s=[];for(let c=0;c<o.length;c++){const f=Me(c-1,-1,o.length-1),g=Me(c+1,-1,o.length-1),y=o[c],x=o[g],E=o[f].sub(y).unit(),D=x.sub(y).unit(),M=D.angleWithSep(E.x,E.y),A=E.add(D).unit().mult(-1*r/Math.sin(M/2));s.push(y.add(A))}return s},h.cacheEntryPossiblyAdded=function(o){Go++,Go>io&&(o.getActor().send("enforceCacheSizeLimit",Yn),Go=0)},h.calculateGlobeLabelMatrix=function(o,r){const{lng:s,lat:c}=o._center,f=zg(0,0,o.worldSize/o._projectionScaler,s,c);return $m(f,f,function(g){const y=Ca(new Float64Array(16)),x=1/Fp(g);return fu(y,y,g.min),pc(y,y,[x,x,x]),y}(Ic(r)))},h.calculateGlobeMatrix=Ng,h.calculateGlobeMercatorMatrix=function(o){const r=o.worldSize,s=o.point,c=Ta(1,o.center.lat)*r,f=o.pixelsPerMeter,g=r/(c/o.pixelsPerMeter),y=Ca(new Float64Array(16));return fu(y,y,[s.x,s.y,0]),pc(y,y,[g,g,f]),Float32Array.from(y)},h.circumferenceAtLatitude=uu,h.clamp=J,h.clearTileCache=function(o){const r=W.caches.delete(Ms);o&&r.catch(o).then(()=>o())},h.clipLine=Tp,h.clone=function(o){var r=new Ci(16);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],r[9]=o[9],r[10]=o[10],r[11]=o[11],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15],r},h.clone$1=sn,h.collisionCircleLayout=Vy,h.config=yn,h.conjugate=function(o,r){return o[0]=-r[0],o[1]=-r[1],o[2]=-r[2],o[3]=r[3],o},h.create=function(){var o=new Ci(16);return Ci!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},h.create$1=du,h.createExpression=Dl,h.createLayout=ge,h.createStyleLayer=function(o){return"custom"===o.type?new Ap(o):new sf[o.type](o)},h.cross=vy,h.degToRad=ue,h.div=function(o,r,s){return o[0]=r[0]/s[0],o[1]=r[1]/s[1],o[2]=r[2]/s[2],o},h.dot=mu,h.earthRadius=$f,h.ease=Ae,h.easeCubicInOut=Q,h.emitValidationErrors=Sl,h.endsWith=it,h.enforceCacheSizeLimit=function(o){er(),bi&&bi.then(r=>{r.keys().then(s=>{for(let c=0;c<s.length-o;c++)r.delete(s[c])})})},h.evaluateSizeForFeature=Cu,h.evaluateSizeForZoom=bc,h.evaluateVariableOffset=Qd,h.evented=hh,h.exactEquals=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]&&o[3]===r[3]},h.exactEquals$1=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]},h.exported=ur,h.exported$1=hr,h.extend=rt,h.extend$1=tr,h.filterObject=wn,h.fromMat4=function(o,r){return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[4],o[4]=r[5],o[5]=r[6],o[6]=r[8],o[7]=r[9],o[8]=r[10],o},h.fromQuat=function(o,r){var s=r[0],c=r[1],f=r[2],g=r[3],y=s+s,x=c+c,E=f+f,D=s*y,M=c*y,A=c*x,k=f*y,F=f*x,j=f*E,q=g*y,ee=g*x,le=g*E;return o[0]=1-A-j,o[1]=M+le,o[2]=k-ee,o[3]=0,o[4]=M-le,o[5]=1-D-j,o[6]=F+q,o[7]=0,o[8]=k+ee,o[9]=F-q,o[10]=1-D-A,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},h.fromRotation=function(o,r){var s=Math.sin(r),c=Math.cos(r);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},h.fromScaling=function(o,r){return o[0]=r[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},h.furthestTileCorner=function(o){const r=Math.round((o+45+360)%360/90)%4;return Ne[r]},h.getAABBPointSquareDist=function(o,r,s){let c=0;for(let f=0;f<2;++f){const g=s?s[f]:0;o[f]>g&&(c+=(o[f]-g)*(o[f]-g)),r[f]<g&&(c+=(g-r[f])*(g-r[f]))}return c},h.getAnchorAlignment=Zd,h.getAnchorJustification=ef,h.getBounds=function(o){let r=1/0,s=1/0,c=-1/0,f=-1/0;for(const g of o)r=Math.min(r,g.x),s=Math.min(s,g.y),c=Math.max(c,g.x),f=Math.max(f,g.y);return{min:new $(r,s),max:new $(c,f)}},h.getColumn=function(o,r){return[o[4*r],o[4*r+1],o[4*r+2],o[4*r+3]]},h.getGridMatrix=function(o,r){const[s,c]=r,f=.015625;return[0,(c[1]-s[1])*f,1<<o.z,(c[0]-s[0])*f,0,o.y,s[0],s[1],f]},h.getImage=It,h.getJSON=function(o,r){return ie(rt(o,{type:"json"}),r)},h.getMapSessionAPI=Zs,h.getPerformanceMeasurement=kp,h.getProjection=function(o){const r=o.parallels,s=!!r&&Math.abs(r[0]+r[1])<.01;switch(o.name){case"mercator":return new _v(o);case"equirectangular":return new Kg(o);case"naturalEarth":return new xv(o);case"equalEarth":return new Xg(o);case"winkelTripel":return new F0(o);case"albers":return s?new Xp(o):new yv(o);case"lambertConformalConic":return s?new Xp(o):new vv(o)}throw new Error(`Invalid projection name: ${o.name}`)},h.getRTLTextPluginStatus=dh,h.getReferrer=V,h.getTilePoint=function(o,{x:r,y:s},c=0){return new $(((r-c)*o.scale-o.x)*In,(s*o.scale-o.y)*In)},h.getTileVec3=function(o,r,s=0){return bh(((r.x-s)*o.scale-o.x)*In,(r.y*o.scale-o.y)*In,Md(r.z,r.y))},h.getVideo=function(o,r){const s=W.document.createElement("video");s.muted=!0,s.onloadstart=function(){r(null,s)};for(let c=0;c<o.length;c++){const f=W.document.createElement("source");Oe(o[c])||(s.crossOrigin="Anonymous"),f.src=o[c],s.appendChild(f)}return{cancel:()=>{}}},h.globeECEFOrigin=function(o,r){const s=[0,0,0];return gu(s,s,zp(Ic(r.canonical))),gu(s,s,o),s},h.globePixelsToTileUnits=function(o,r){return In/(512*Math.pow(2,o))*Fp(Ic(r))},h.globePoleMatrixForTile=function(o,r,s){const c=Ca(new Float64Array(16)),f=1<<o,g=360*(r/f-.5),y=s.point,x=s.worldSize/(s.tileSize*f);return fu(c,c,[y.x,y.y,-s.worldSize/Math.PI/2]),pc(c,c,[x,x,x]),Gm(c,c,ue(-s._center.lat)),Hm(c,c,ue(-s._center.lng+g)),Float32Array.from(c)},h.globeTileLatLngCorners=Op,h.globeToMercatorTransition=function(o){return ne(5,6,o)},h.identity=Ca,h.identity$1=Km,h.invert=function(o,r){var s=r[0],c=r[1],f=r[2],g=r[3],y=r[4],x=r[5],E=r[6],D=r[7],M=r[8],A=r[9],k=r[10],F=r[11],j=r[12],q=r[13],ee=r[14],le=r[15],Ee=s*x-c*y,Pe=s*E-f*y,Re=s*D-g*y,Le=c*E-f*x,Fe=c*D-g*x,Ye=f*D-g*E,Qe=M*q-A*j,at=M*ee-k*j,dt=M*le-F*j,qe=A*ee-k*q,tt=A*le-F*q,pt=k*le-F*ee,Ct=Ee*pt-Pe*tt+Re*qe+Le*dt-Fe*at+Ye*Qe;return Ct?(o[0]=(x*pt-E*tt+D*qe)*(Ct=1/Ct),o[1]=(f*tt-c*pt-g*qe)*Ct,o[2]=(q*Ye-ee*Fe+le*Le)*Ct,o[3]=(k*Fe-A*Ye-F*Le)*Ct,o[4]=(E*dt-y*pt-D*at)*Ct,o[5]=(s*pt-f*dt+g*at)*Ct,o[6]=(ee*Re-j*Ye-le*Pe)*Ct,o[7]=(M*Ye-k*Re+F*Pe)*Ct,o[8]=(y*tt-x*dt+D*Qe)*Ct,o[9]=(c*dt-s*tt-g*Qe)*Ct,o[10]=(j*Fe-q*Re+le*Ee)*Ct,o[11]=(A*Re-M*Fe-F*Ee)*Ct,o[12]=(x*at-y*qe-E*Qe)*Ct,o[13]=(s*qe-c*at+f*Qe)*Ct,o[14]=(q*Pe-j*Le-ee*Ee)*Ct,o[15]=(M*Le-A*Pe+k*Ee)*Ct,o):null},h.isMapAuthenticated=function(o){return ki.has(o)},h.isMapboxURL=Wi,h.isSafariWithAntialiasingBug=function(o){const r=o.navigator?o.navigator.userAgent:null;return!!kn(o)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},h.latFromMercatorY=Gi,h.len=C0,h.length=Wm,h.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},h.loadVectorTile=Wg,h.makeRequest=ie,h.mercatorXfromLng=Us,h.mercatorYfromLat=dc,h.mercatorZfromAltitude=Ta,h.mul=qm,h.mul$1=Jf,h.multiply=function(o,r,s){var c=r[0],f=r[1],g=r[2],y=r[3],x=r[4],E=r[5],D=r[6],M=r[7],A=r[8],k=s[0],F=s[1],j=s[2],q=s[3],ee=s[4],le=s[5],Ee=s[6],Pe=s[7],Re=s[8];return o[0]=k*c+F*y+j*D,o[1]=k*f+F*x+j*M,o[2]=k*g+F*E+j*A,o[3]=q*c+ee*y+le*D,o[4]=q*f+ee*x+le*M,o[5]=q*g+ee*E+le*A,o[6]=Ee*c+Pe*y+Re*D,o[7]=Ee*f+Pe*x+Re*M,o[8]=Ee*g+Pe*E+Re*A,o},h.multiply$1=$m,h.multiply$2=wh,h.nextPowerOfTwo=Et,h.normalize=pu,h.normalize$1=function(o,r){var s=r[0],c=r[1],f=r[2],g=r[3],y=s*s+c*c+f*f+g*g;return y>0&&(y=1/Math.sqrt(y)),o[0]=s*y,o[1]=c*y,o[2]=f*y,o[3]=g*y,o},h.number=At,h.ortho=function(o,r,s,c,f,g,y){var x=1/(r-s),E=1/(c-f),D=1/(g-y);return o[0]=-2*x,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*E,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*D,o[11]=0,o[12]=(r+s)*x,o[13]=(f+c)*E,o[14]=(y+g)*D,o[15]=1,o},h.pbf=Rh,h.perspective=function(o,r,s,c,f){var g,y=1/Math.tan(r/2);return o[0]=y/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=y,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=f&&f!==1/0?(o[10]=(f+c)*(g=1/(c-f)),o[14]=2*f*c*g):(o[10]=-1,o[14]=-2*c),o},h.pick=function(o,r){const s={};for(let c=0;c<r.length;c++){const f=r[c];f in o&&(s[f]=o[f])}return s},h.plugin=co,h.pointGeometry=$,h.polygonIntersectsBox=Xf,h.polygonIntersectsPolygon=Bm,h.polygonizeBounds=function(o,r,s=0,c=!0){const f=new $(s,s),g=o.sub(f),y=r.add(f),x=[g,new $(y.x,g.y),y,new $(g.x,y.y)];return c&&x.push(g),x},h.posAttributes=Bh,h.postMapLoadEvent=qs,h.postTurnstileEvent=ss,h.potpack=bp,h.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},h.radToDeg=Te,h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.registerForPluginStateChange=function(o){return o({pluginStatus:bo,pluginURL:$i}),hh.on("pluginStateChange",o),o},h.removeAuthState=function(o){ki.delete(o)},h.renderColorRamp=rp,h.rotateX=Gm,h.rotateX$1=Ym,h.rotateY=Hm,h.rotateZ=function(o,r,s){var c=Math.sin(s),f=Math.cos(s),g=r[0],y=r[1],x=r[2],E=r[3],D=r[4],M=r[5],A=r[6],k=r[7];return r!==o&&(o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=g*f+D*c,o[1]=y*f+M*c,o[2]=x*f+A*c,o[3]=E*f+k*c,o[4]=D*f-g*c,o[5]=M*f-y*c,o[6]=A*f-x*c,o[7]=k*f-E*c,o},h.rotateZ$1=function(o,r,s){s*=.5;var c=r[0],f=r[1],g=r[2],y=r[3],x=Math.sin(s),E=Math.cos(s);return o[0]=c*E+f*x,o[1]=f*E-c*x,o[2]=g*E+y*x,o[3]=y*E-g*x,o},h.scale=pc,h.scale$1=function(o,r,s){return o[0]=r[0]*s,o[1]=r[1]*s,o[2]=r[2]*s,o[3]=r[3]*s,o},h.scale$2=ol,h.scaleAndAdd=kd,h.setCacheLimits=function(o,r){Yn=o,io=r},h.setColumn=function(o,r,s){o[4*r+0]=s[0],o[4*r+1]=s[1],o[4*r+2]=s[2],o[4*r+3]=s[3]},h.setRTLTextPlugin=function(o,r,s=!1){if(bo===ch||bo===Xo||bo===Ya)throw new Error("setRTLTextPlugin cannot be called multiple times.");$i=ur.resolveURL(o),bo=ch,uh=r,Qa(),s||cc()},h.smoothstep=ne,h.spec=$e,h.storeAuthState=function(o,r){r?ki.add(o):ki.delete(o)},h.sub=Nl,h.subtract=Xm,h.symbolSize=Ud,h.tileAABB=function(o,r,s,c,f,g,y,x,E){if("globe"===E.name)return function Lg(o,r,s){const c=r/o.worldSize,f=(tt,pt)=>{ol(tt,tt,c),ol(pt,pt,c)},g=Number.MAX_VALUE,y=[-g,-g,-g],x=[g,g,g],E=Ng(o);if(s.z<=1){const tt=Ic(s).getCorners();for(let pt=0;pt<tt.length;pt++)gu(tt[pt],tt[pt],E),Pd(x,x,tt[pt]),$s(y,y,tt[pt]);return f(x,y),new ms(x,y)}const[D,M]=Op(s),A=new js;A.setSouthWest([D[1],M[0]]),A.setNorthEast([M[1],D[0]]);const k=[cl(A.getSouth(),A.getWest()),cl(A.getSouth(),A.getEast()),cl(A.getNorth(),A.getEast()),cl(A.getNorth(),A.getWest())];for(let tt=0;tt<k.length;tt++)gu(k[tt],k[tt],E),Pd(x,x,k[tt]),$s(y,y,k[tt]);if(A.contains(o.center))return y[2]=0,f(x,y),new ms(x,y);const F=[E[12],E[13],E[14]],j=o.center.lng,q=J(o.center.lat,-85.051129,ps),ee=[Us(j),dc(q)],le=A.getCenter().lng,Ee=J(A.getCenter().lat,-85.051129,ps),Pe=[Us(le),dc(Ee)];let Re=new Array(3),Le=0;const Fe=ee[0]-Pe[0],Ye=ee[1]-Pe[1];if(Math.abs(Fe)>Math.abs(Ye))Le=Fe>=0?1:3,Re=F;else{Le=Ye>=0?0:2;const tt=[E[4],E[5],E[6]];let pt;pt=Ye>=0?-Math.sin(ue(A.getSouth()))*ku:-Math.sin(ue(A.getNorth()))*ku,Re=kd(Re,F,tt,pt)}const Qe=k[Le],at=k[(Le+1)%4],dt=new L0(Qe,at,Re),qe=[Rp(dt,0)||Qe[0],Rp(dt,1)||Qe[1],Rp(dt,2)||Qe[2]];return x[2]=Math.min(Qe[2],at[2]),Pd(x,x,qe),$s(y,y,qe),f(x,y),new ms(x,y)}(o,r,new Ru(s,c,f));const D=Vl({z:s,x:c,y:f},E);return new ms([(g+D.x/D.scale)*r,r*(D.y/D.scale),y],[(g+D.x2/D.scale)*r,r*(D.y2/D.scale),x])},h.tileTransform=Vl,h.transformMat3=function(o,r,s){var c=r[0],f=r[1],g=r[2];return o[0]=c*s[0]+f*s[3]+g*s[6],o[1]=c*s[1]+f*s[4]+g*s[7],o[2]=c*s[2]+f*s[5]+g*s[8],o},h.transformMat4=gu,h.transformMat4$1=Eh,h.transformQuat=xy,h.translate=fu,h.transpose=function(o,r){if(o===r){var s=r[1],c=r[2],f=r[5];o[1]=r[3],o[2]=r[6],o[3]=s,o[5]=r[7],o[6]=c,o[7]=f}else o[0]=r[0],o[1]=r[3],o[2]=r[6],o[3]=r[1],o[4]=r[4],o[5]=r[7],o[6]=r[2],o[7]=r[5],o[8]=r[8];return o},h.triggerPluginCompletionEvent=Ja,h.uniqueId=Pt,h.validateCustomStyleLayer=function(o){const r=[],s=o.id;return void 0===s&&r.push({message:`layers.${s}: missing required property "id"`}),void 0===o.render&&r.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&r.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),r},h.validateFilter=o=>zs(Js(o)),h.validateFog=o=>zs(Ju(o)),h.validateLayer=o=>zs(tu(o)),h.validateLight=o=>zs(yd(o)),h.validateSource=o=>zs(_d(o)),h.validateStyle=rr,h.validateTerrain=o=>zs(vd(o)),h.values=He,h.vectorTile=Bl,h.version=U,h.warnOnce=un,h.window=W,h.wrap=Me}),xe(0,function(h){function U(oe){if("number"==typeof oe||"boolean"==typeof oe||"string"==typeof oe||null==oe)return JSON.stringify(oe);if(Array.isArray(oe)){let V="[";for(const ie of oe)V+=`${U(ie)},`;return`${V}]`}let z="{";for(const V of Object.keys(oe).sort())z+=`${V}:${U(oe[V])},`;return`${z}}`}function Y(oe){let z="";for(const V of h.refProperties)z+=`/${U(oe[V])}`;return z}class re{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,V){for(const se of z)this._layerConfigs[se.id]=se,(this._layers[se.id]=h.createStyleLayer(se)).compileFilter(),this.keyCache[se.id]&&delete this.keyCache[se.id];for(const se of V)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const ie=function(se,De){const Ie={};for(let ke=0;ke<se.length;ke++){const Ve=De&&De[se[ke].id]||Y(se[ke]);De&&(De[se[ke].id]=Ve);let st=Ie[Ve];st||(st=Ie[Ve]=[]),st.push(se[ke])}const Oe=[];for(const ke in Ie)Oe.push(Ie[ke]);return Oe}(h.values(this._layerConfigs),this.keyCache);for(const se of ie){const De=se.map(It=>this._layers[It.id]),Ie=De[0];if("none"===Ie.visibility)continue;const Oe=Ie.source||"";let ke=this.familiesBySource[Oe];ke||(ke=this.familiesBySource[Oe]={});const Ve=Ie.sourceLayer||"_geojsonTileLayer";let st=ke[Ve];st||(st=ke[Ve]=[]),st.push(De)}}}class ${loadTile(z,V){const{uid:ie,encoding:se,rawImageData:De,padding:Ie,buildQuadTree:Oe}=z,ke=h.window.ImageBitmap&&De instanceof h.window.ImageBitmap?this.getImageData(De,Ie):De;V(null,new h.DEMData(ie,ke,se,Ie<1,Oe))}getImageData(z,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const ie=this.offscreenCanvasContext.getImageData(-V,-V,z.width+2*V,z.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ie}}var K=function oe(z,V){var ie,se=z&&z.type;if("FeatureCollection"===se)for(ie=0;ie<z.features.length;ie++)oe(z.features[ie],V);else if("GeometryCollection"===se)for(ie=0;ie<z.geometries.length;ie++)oe(z.geometries[ie],V);else if("Feature"===se)oe(z.geometry,V);else if("Polygon"===se)W(z.coordinates,V);else if("MultiPolygon"===se)for(ie=0;ie<z.coordinates.length;ie++)W(z.coordinates[ie],V);return z};function W(oe,z){if(0!==oe.length){me(oe[0],z);for(var V=1;V<oe.length;V++)me(oe[V],!z)}}function me(oe,z){for(var V=0,ie=0,se=0,De=oe.length,Ie=De-1;se<De;Ie=se++){var Oe=(oe[se][0]-oe[Ie][0])*(oe[Ie][1]+oe[se][1]),ke=V+Oe;ie+=Math.abs(V)>=Math.abs(Oe)?V-ke+Oe:Oe-ke+V,V=ke}V+ie>=0!=!!z&&oe.reverse()}const ce=h.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ue{constructor(z){this._feature=z,this.extent=h.EXTENT,this.type=z.type,this.properties=z.tags,"id"in z&&!isNaN(z.id)&&(this.id=parseInt(z.id,10))}loadGeometry(){if(1===this._feature.type){const z=[];for(const V of this._feature.geometry)z.push([new h.pointGeometry(V[0],V[1])]);return z}{const z=[];for(const V of this._feature.geometry){const ie=[];for(const se of V)ie.push(new h.pointGeometry(se[0],se[1]));z.push(ie)}return z}}toGeoJSON(z,V,ie){return ce.call(this,z,V,ie)}}class Te{constructor(z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=z.length,this._features=z}feature(z){return new ue(this._features[z])}}var Ne=h.vectorTile.VectorTileFeature,Q=we;function we(oe,z){this.options=z||{},this.features=oe,this.length=oe.length}function Ae(oe,z){this.id="number"==typeof oe.id?oe.id:void 0,this.type=oe.type,this.rawGeometry=1===oe.type?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=z||4096}we.prototype.feature=function(oe){return new Ae(this.features[oe],this.options.extent)},Ae.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var z=0;z<oe.length;z++){for(var V=oe[z],ie=[],se=0;se<V.length;se++)ie.push(new h.pointGeometry(V[se][0],V[se][1]));this.geometry.push(ie)}return this.geometry},Ae.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,z=1/0,V=-1/0,ie=1/0,se=-1/0,De=0;De<oe.length;De++)for(var Ie=oe[De],Oe=0;Oe<Ie.length;Oe++){var ke=Ie[Oe];z=Math.min(z,ke.x),V=Math.max(V,ke.x),ie=Math.min(ie,ke.y),se=Math.max(se,ke.y)}return[z,ie,V,se]},Ae.prototype.toGeoJSON=Ne.prototype.toGeoJSON;var J=Me,ne=Q;function Me(oe){var z=new h.pbf;return function(V,ie){for(var se in V.layers)ie.writeMessage(3,Be,V.layers[se])}(oe,z),z.finish()}function Be(oe,z){var V;z.writeVarintField(15,oe.version||1),z.writeStringField(1,oe.name||""),z.writeVarintField(5,oe.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<oe.length;V++)ie.feature=oe.feature(V),z.writeMessage(2,He,ie);var se=ie.keys;for(V=0;V<se.length;V++)z.writeStringField(3,se[V]);var De=ie.values;for(V=0;V<De.length;V++)z.writeMessage(4,Et,De[V])}function He(oe,z){var V=oe.feature;void 0!==V.id&&z.writeVarintField(1,V.id),z.writeMessage(2,rt,oe),z.writeVarintField(3,V.type),z.writeMessage(4,gt,V)}function rt(oe,z){var V=oe.feature,ie=oe.keys,se=oe.values,De=oe.keycache,Ie=oe.valuecache;for(var Oe in V.properties){var ke=V.properties[Oe],Ve=De[Oe];if(null!==ke){void 0===Ve&&(ie.push(Oe),De[Oe]=Ve=ie.length-1),z.writeVarint(Ve);var st=typeof ke;"string"!==st&&"boolean"!==st&&"number"!==st&&(ke=JSON.stringify(ke));var It=st+":"+ke,ot=Ie[It];void 0===ot&&(se.push(ke),Ie[It]=ot=se.length-1),z.writeVarint(ot)}}}function mt(oe,z){return(z<<3)+(7&oe)}function Pt(oe){return oe<<1^oe>>31}function gt(oe,z){for(var V=oe.loadGeometry(),ie=oe.type,se=0,De=0,Ie=V.length,Oe=0;Oe<Ie;Oe++){var ke=V[Oe],Ve=1;1===ie&&(Ve=ke.length),z.writeVarint(mt(1,Ve));for(var st=3===ie?ke.length-1:ke.length,It=0;It<st;It++){1===It&&1!==ie&&z.writeVarint(mt(2,st-1));var ot=ke[It].x-se,rn=ke[It].y-De;z.writeVarint(Pt(ot)),z.writeVarint(Pt(rn)),se+=ot,De+=rn}3===ie&&z.writeVarint(mt(7,1))}}function Et(oe,z){var V=typeof oe;"string"===V?z.writeStringField(1,oe):"boolean"===V?z.writeBooleanField(7,oe):"number"===V&&(oe%1!=0?z.writeDoubleField(3,oe):oe<0?z.writeSVarintField(6,oe):z.writeVarintField(5,oe))}function Ot(oe,z,V,ie,se,De){if(se-ie<=V)return;const Ie=ie+se>>1;ut(oe,z,Ie,ie,se,De%2),Ot(oe,z,V,ie,Ie-1,De+1),Ot(oe,z,V,Ie+1,se,De+1)}function ut(oe,z,V,ie,se,De){for(;se>ie;){if(se-ie>600){const Ve=se-ie+1,st=V-ie+1,It=Math.log(Ve),ot=.5*Math.exp(2*It/3),rn=.5*Math.sqrt(It*ot*(Ve-ot)/Ve)*(st-Ve/2<0?-1:1);ut(oe,z,V,Math.max(ie,Math.floor(V-st*ot/Ve+rn)),Math.min(se,Math.floor(V+(Ve-st)*ot/Ve+rn)),De)}const Ie=z[2*V+De];let Oe=ie,ke=se;for(it(oe,z,ie,V),z[2*se+De]>Ie&&it(oe,z,ie,se);Oe<ke;){for(it(oe,z,Oe,ke),Oe++,ke--;z[2*Oe+De]<Ie;)Oe++;for(;z[2*ke+De]>Ie;)ke--}z[2*ie+De]===Ie?it(oe,z,ie,ke):(ke++,it(oe,z,ke,se)),ke<=V&&(ie=ke+1),V<=ke&&(se=ke-1)}}function it(oe,z,V,ie){cn(oe,V,ie),cn(z,2*V,2*ie),cn(z,2*V+1,2*ie+1)}function cn(oe,z,V){const ie=oe[z];oe[z]=oe[V],oe[V]=ie}function wn(oe,z,V,ie){const se=oe-V,De=z-ie;return se*se+De*De}J.fromVectorTileJs=Me,J.fromGeojsonVt=function(oe,z){z=z||{};var V={};for(var ie in oe)V[ie]=new Q(oe[ie].features,z),V[ie].name=ie,V[ie].version=z.version,V[ie].extent=z.extent;return Me({layers:V})},J.GeoJSONWrapper=ne;const sn=oe=>oe[0],On=oe=>oe[1];class un{constructor(z,V=sn,ie=On,se=64,De=Float64Array){this.nodeSize=se,this.points=z;const Ie=z.length<65536?Uint16Array:Uint32Array,Oe=this.ids=new Ie(z.length),ke=this.coords=new De(2*z.length);for(let Ve=0;Ve<z.length;Ve++)Oe[Ve]=Ve,ke[2*Ve]=V(z[Ve]),ke[2*Ve+1]=ie(z[Ve]);Ot(Oe,ke,se,0,Oe.length-1,0)}range(z,V,ie,se){return function(De,Ie,Oe,ke,Ve,st,It){const ot=[0,De.length-1,0],rn=[];let Wt,Xt;for(;ot.length;){const nn=ot.pop(),$e=ot.pop(),tr=ot.pop();if($e-tr<=It){for(let Ln=tr;Ln<=$e;Ln++)Wt=Ie[2*Ln],Xt=Ie[2*Ln+1],Wt>=Oe&&Wt<=Ve&&Xt>=ke&&Xt<=st&&rn.push(De[Ln]);continue}const Gt=Math.floor((tr+$e)/2);Wt=Ie[2*Gt],Xt=Ie[2*Gt+1],Wt>=Oe&&Wt<=Ve&&Xt>=ke&&Xt<=st&&rn.push(De[Gt]);const Wn=(nn+1)%2;(0===nn?Oe<=Wt:ke<=Xt)&&(ot.push(tr),ot.push(Gt-1),ot.push(Wn)),(0===nn?Ve>=Wt:st>=Xt)&&(ot.push(Gt+1),ot.push($e),ot.push(Wn))}return rn}(this.ids,this.coords,z,V,ie,se,this.nodeSize)}within(z,V,ie){return function(se,De,Ie,Oe,ke,Ve){const st=[0,se.length-1,0],It=[],ot=ke*ke;for(;st.length;){const rn=st.pop(),Wt=st.pop(),Xt=st.pop();if(Wt-Xt<=Ve){for(let Wn=Xt;Wn<=Wt;Wn++)wn(De[2*Wn],De[2*Wn+1],Ie,Oe)<=ot&&It.push(se[Wn]);continue}const nn=Math.floor((Xt+Wt)/2),$e=De[2*nn],tr=De[2*nn+1];wn($e,tr,Ie,Oe)<=ot&&It.push(se[nn]);const Gt=(rn+1)%2;(0===rn?Ie-ke<=$e:Oe-ke<=tr)&&(st.push(Xt),st.push(nn-1),st.push(Gt)),(0===rn?Ie+ke>=$e:Oe+ke>=tr)&&(st.push(nn+1),st.push(Wt),st.push(Gt))}return It}(this.ids,this.coords,z,V,ie,this.nodeSize)}}const Nn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},ir=Math.fround||(kt=new Float32Array(1),oe=>(kt[0]=+oe,kt[0]));var kt;class Pn{constructor(z){this.options=ur(Object.create(Nn),z),this.trees=new Array(this.options.maxZoom+1)}load(z){const{log:V,minZoom:ie,maxZoom:se,nodeSize:De}=this.options;V&&console.time("total time");const Ie=`prepare ${z.length} points`;V&&console.time(Ie),this.points=z;let Oe=[];for(let ke=0;ke<z.length;ke++)z[ke].geometry&&Oe.push(Tt(z[ke],ke));this.trees[se+1]=new un(Oe,Qn,yn,De,Float32Array),V&&console.timeEnd(Ie);for(let ke=se;ke>=ie;ke--){const Ve=+Date.now();Oe=this._cluster(Oe,ke),this.trees[ke]=new un(Oe,Qn,yn,De,Float32Array),V&&console.log("z%d: %d clusters in %dms",ke,Oe.length,+Date.now()-Ve)}return V&&console.timeEnd("total time"),this}getClusters(z,V){let ie=((z[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,z[1]));let De=180===z[2]?180:((z[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)ie=-180,De=180;else if(ie>De){const st=this.getClusters([ie,se,180,Ie],V),It=this.getClusters([-180,se,De,Ie],V);return st.concat(It)}const Oe=this.trees[this._limitZoom(V)],ke=Oe.range(bt(ie),kn(Ie),bt(De),kn(se)),Ve=[];for(const st of ke){const It=Oe.points[st];Ve.push(It.numPoints?$t(It):this.points[It.index])}return Ve}getChildren(z){const V=this._getOriginId(z),ie=this._getOriginZoom(z),se="No cluster with the specified id.",De=this.trees[ie];if(!De)throw new Error(se);const Ie=De.points[V];if(!Ie)throw new Error(se);const Oe=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),ke=De.within(Ie.x,Ie.y,Oe),Ve=[];for(const st of ke){const It=De.points[st];It.parentId===z&&Ve.push(It.numPoints?$t(It):this.points[It.index])}if(0===Ve.length)throw new Error(se);return Ve}getLeaves(z,V,ie){const se=[];return this._appendLeaves(se,z,V=V||10,ie=ie||0,0),se}getTile(z,V,ie){const se=this.trees[this._limitZoom(z)],De=Math.pow(2,z),{extent:Ie,radius:Oe}=this.options,ke=Oe/Ie,Ve=(ie-ke)/De,st=(ie+1+ke)/De,It={features:[]};return this._addTileFeatures(se.range((V-ke)/De,Ve,(V+1+ke)/De,st),se.points,V,ie,De,It),0===V&&this._addTileFeatures(se.range(1-ke/De,Ve,1,st),se.points,De,ie,De,It),V===De-1&&this._addTileFeatures(se.range(0,Ve,ke/De,st),se.points,-1,ie,De,It),It.features.length?It:null}getClusterExpansionZoom(z){let V=this._getOriginZoom(z)-1;for(;V<=this.options.maxZoom;){const ie=this.getChildren(z);if(V++,1!==ie.length)break;z=ie[0].properties.cluster_id}return V}_appendLeaves(z,V,ie,se,De){const Ie=this.getChildren(V);for(const Oe of Ie){const ke=Oe.properties;if(ke&&ke.cluster?De+ke.point_count<=se?De+=ke.point_count:De=this._appendLeaves(z,ke.cluster_id,ie,se,De):De<se?De++:z.push(Oe),z.length===ie)break}return De}_addTileFeatures(z,V,ie,se,De,Ie){for(const Oe of z){const ke=V[Oe],Ve=ke.numPoints;let st,It,ot;if(Ve)st=fn(ke),It=ke.x,ot=ke.y;else{const Xt=this.points[ke.index];st=Xt.properties,It=bt(Xt.geometry.coordinates[0]),ot=kn(Xt.geometry.coordinates[1])}const rn={type:1,geometry:[[Math.round(this.options.extent*(It*De-ie)),Math.round(this.options.extent*(ot*De-se))]],tags:st};let Wt;Ve?Wt=ke.id:this.options.generateId?Wt=ke.index:this.points[ke.index].id&&(Wt=this.points[ke.index].id),void 0!==Wt&&(rn.id=Wt),Ie.features.push(rn)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(+z,this.options.maxZoom+1))}_cluster(z,V){const ie=[],{radius:se,extent:De,reduce:Ie,minPoints:Oe}=this.options,ke=se/(De*Math.pow(2,V));for(let Ve=0;Ve<z.length;Ve++){const st=z[Ve];if(st.zoom<=V)continue;st.zoom=V;const It=this.trees[V+1],ot=It.within(st.x,st.y,ke),rn=st.numPoints||1;let Wt=rn;for(const Xt of ot){const nn=It.points[Xt];nn.zoom>V&&(Wt+=nn.numPoints||1)}if(Wt>rn&&Wt>=Oe){let Xt=st.x*rn,nn=st.y*rn,$e=Ie&&rn>1?this._map(st,!0):null;const tr=(Ve<<5)+(V+1)+this.points.length;for(const Gt of ot){const Wn=It.points[Gt];if(Wn.zoom<=V)continue;Wn.zoom=V;const Ln=Wn.numPoints||1;Xt+=Wn.x*Ln,nn+=Wn.y*Ln,Wn.parentId=tr,Ie&&($e||($e=this._map(st,!0)),Ie($e,this._map(Wn)))}st.parentId=tr,ie.push(nt(Xt/Wt,nn/Wt,tr,Wt,$e))}else if(ie.push(st),Wt>1)for(const Xt of ot){const nn=It.points[Xt];nn.zoom<=V||(nn.zoom=V,ie.push(nn))}}return ie}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,V){if(z.numPoints)return V?ur({},z.properties):z.properties;const ie=this.points[z.index].properties,se=this.options.map(ie);return V&&se===ie?ur({},se):se}}function nt(oe,z,V,ie,se){return{x:ir(oe),y:ir(z),zoom:1/0,id:V,parentId:-1,numPoints:ie,properties:se}}function Tt(oe,z){const[V,ie]=oe.geometry.coordinates;return{x:ir(bt(V)),y:ir(kn(ie)),zoom:1/0,index:z,parentId:-1}}function $t(oe){return{type:"Feature",id:oe.id,properties:fn(oe),geometry:{type:"Point",coordinates:[(z=oe.x,360*(z-.5)),Gr(oe.y)]}};var z}function fn(oe){const z=oe.numPoints,V=z>=1e4?`${Math.round(z/1e3)}k`:z>=1e3?Math.round(z/100)/10+"k":z;return ur(ur({},oe.properties),{cluster:!0,cluster_id:oe.id,point_count:z,point_count_abbreviated:V})}function bt(oe){return oe/360+.5}function kn(oe){const z=Math.sin(oe*Math.PI/180),V=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return V<0?0:V>1?1:V}function Gr(oe){const z=(180-360*oe)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function ur(oe,z){for(const V in z)oe[V]=z[V];return oe}function Qn(oe){return oe.x}function yn(oe){return oe.y}function hr(oe,z,V,ie){for(var se,De=ie,Ie=V-z>>1,Oe=V-z,ke=oe[z],Ve=oe[z+1],st=oe[V],It=oe[V+1],ot=z+3;ot<V;ot+=3){var rn=jn(oe[ot],oe[ot+1],ke,Ve,st,It);if(rn>De)se=ot,De=rn;else if(rn===De){var Wt=Math.abs(ot-Ie);Wt<Oe&&(se=ot,Oe=Wt)}}De>ie&&(se-z>3&&hr(oe,z,se,ie),oe[se+2]=De,V-se>3&&hr(oe,se,V,ie))}function jn(oe,z,V,ie,se,De){var Ie=se-V,Oe=De-ie;if(0!==Ie||0!==Oe){var ke=((oe-V)*Ie+(z-ie)*Oe)/(Ie*Ie+Oe*Oe);ke>1?(V=se,ie=De):ke>0&&(V+=Ie*ke,ie+=Oe*ke)}return(Ie=oe-V)*Ie+(Oe=z-ie)*Oe}function Ai(oe,z,V,ie){var se={id:void 0===oe?null:oe,type:z,geometry:V,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(De){var Ie=De.geometry,Oe=De.type;if("Point"===Oe||"MultiPoint"===Oe||"LineString"===Oe)qr(De,Ie);else if("Polygon"===Oe||"MultiLineString"===Oe)for(var ke=0;ke<Ie.length;ke++)qr(De,Ie[ke]);else if("MultiPolygon"===Oe)for(ke=0;ke<Ie.length;ke++)for(var Ve=0;Ve<Ie[ke].length;Ve++)qr(De,Ie[ke][Ve])}(se),se}function qr(oe,z){for(var V=0;V<z.length;V+=3)oe.minX=Math.min(oe.minX,z[V]),oe.minY=Math.min(oe.minY,z[V+1]),oe.maxX=Math.max(oe.maxX,z[V]),oe.maxY=Math.max(oe.maxY,z[V+1])}function zi(oe,z,V,ie){if(z.geometry){var se=z.geometry.coordinates,De=z.geometry.type,Ie=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),Oe=[],ke=z.id;if(V.promoteId?ke=z.properties[V.promoteId]:V.generateId&&(ke=ie||0),"Point"===De)Mo(se,Oe);else if("MultiPoint"===De)for(var Ve=0;Ve<se.length;Ve++)Mo(se[Ve],Oe);else if("LineString"===De)Nr(se,Oe,Ie,!1);else if("MultiLineString"===De){if(V.lineMetrics){for(Ve=0;Ve<se.length;Ve++)Nr(se[Ve],Oe=[],Ie,!1),oe.push(Ai(ke,"LineString",Oe,z.properties));return}no(se,Oe,Ie,!1)}else if("Polygon"===De)no(se,Oe,Ie,!0);else{if("MultiPolygon"!==De){if("GeometryCollection"===De){for(Ve=0;Ve<z.geometry.geometries.length;Ve++)zi(oe,{id:ke,geometry:z.geometry.geometries[Ve],properties:z.properties},V,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ve=0;Ve<se.length;Ve++){var st=[];no(se[Ve],st,Ie,!0),Oe.push(st)}}oe.push(Ai(ke,De,Oe,z.properties))}}function Mo(oe,z){z.push(Wi(oe[0])),z.push(Vo(oe[1])),z.push(0)}function Nr(oe,z,V,ie){for(var se,De,Ie=0,Oe=0;Oe<oe.length;Oe++){var ke=Wi(oe[Oe][0]),Ve=Vo(oe[Oe][1]);z.push(ke),z.push(Ve),z.push(0),Oe>0&&(Ie+=ie?(se*Ve-ke*De)/2:Math.sqrt(Math.pow(ke-se,2)+Math.pow(Ve-De,2))),se=ke,De=Ve}var st=z.length-3;z[2]=1,hr(z,0,st,V),z[st+2]=1,z.size=Math.abs(Ie),z.start=0,z.end=z.size}function no(oe,z,V,ie){for(var se=0;se<oe.length;se++){var De=[];Nr(oe[se],De,V,ie),z.push(De)}}function Wi(oe){return oe/360+.5}function Vo(oe){var z=Math.sin(oe*Math.PI/180),V=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return V<0?0:V>1?1:V}function mi(oe,z,V,ie,se,De,Ie,Oe){if(ie/=z,De>=(V/=z)&&Ie<ie)return oe;if(Ie<V||De>=ie)return null;for(var ke=[],Ve=0;Ve<oe.length;Ve++){var st=oe[Ve],It=st.geometry,ot=st.type,rn=0===se?st.minX:st.minY,Wt=0===se?st.maxX:st.maxY;if(rn>=V&&Wt<ie)ke.push(st);else if(!(Wt<V||rn>=ie)){var Xt=[];if("Point"===ot||"MultiPoint"===ot)Pi(It,Xt,V,ie,se);else if("LineString"===ot)ro(It,Xt,V,ie,se,!1,Oe.lineMetrics);else if("MultiLineString"===ot)os(It,Xt,V,ie,se,!1);else if("Polygon"===ot)os(It,Xt,V,ie,se,!0);else if("MultiPolygon"===ot)for(var nn=0;nn<It.length;nn++){var $e=[];os(It[nn],$e,V,ie,se,!0),$e.length&&Xt.push($e)}if(Xt.length){if(Oe.lineMetrics&&"LineString"===ot){for(nn=0;nn<Xt.length;nn++)ke.push(Ai(st.id,ot,Xt[nn],st.tags));continue}"LineString"!==ot&&"MultiLineString"!==ot||(1===Xt.length?(ot="LineString",Xt=Xt[0]):ot="MultiLineString"),"Point"!==ot&&"MultiPoint"!==ot||(ot=3===Xt.length?"Point":"MultiPoint"),ke.push(Ai(st.id,ot,Xt,st.tags))}}}return ke.length?ke:null}function Pi(oe,z,V,ie,se){for(var De=0;De<oe.length;De+=3){var Ie=oe[De+se];Ie>=V&&Ie<=ie&&(z.push(oe[De]),z.push(oe[De+1]),z.push(oe[De+2]))}}function ro(oe,z,V,ie,se,De,Ie){for(var Oe,ke,Ve=$o(oe),st=0===se?ss:Is,It=oe.start,ot=0;ot<oe.length-3;ot+=3){var rn=oe[ot],Wt=oe[ot+1],Xt=oe[ot+2],nn=oe[ot+3],$e=oe[ot+4],tr=0===se?rn:Wt,Gt=0===se?nn:$e,Wn=!1;Ie&&(Oe=Math.sqrt(Math.pow(rn-nn,2)+Math.pow(Wt-$e,2))),tr<V?Gt>V&&(ke=st(Ve,rn,Wt,nn,$e,V),Ie&&(Ve.start=It+Oe*ke)):tr>ie?Gt<ie&&(ke=st(Ve,rn,Wt,nn,$e,ie),Ie&&(Ve.start=It+Oe*ke)):Ss(Ve,rn,Wt,Xt),Gt<V&&tr>=V&&(ke=st(Ve,rn,Wt,nn,$e,V),Wn=!0),Gt>ie&&tr<=ie&&(ke=st(Ve,rn,Wt,nn,$e,ie),Wn=!0),!De&&Wn&&(Ie&&(Ve.end=It+Oe*ke),z.push(Ve),Ve=$o(oe)),Ie&&(It+=Oe)}var Ln=oe.length-3;rn=oe[Ln],Wt=oe[Ln+1],Xt=oe[Ln+2],(tr=0===se?rn:Wt)>=V&&tr<=ie&&Ss(Ve,rn,Wt,Xt),Ln=Ve.length-3,De&&Ln>=3&&(Ve[Ln]!==Ve[0]||Ve[Ln+1]!==Ve[1])&&Ss(Ve,Ve[0],Ve[1],Ve[2]),Ve.length&&z.push(Ve)}function $o(oe){var z=[];return z.size=oe.size,z.start=oe.start,z.end=oe.end,z}function os(oe,z,V,ie,se,De){for(var Ie=0;Ie<oe.length;Ie++)ro(oe[Ie],z,V,ie,se,De,!1)}function Ss(oe,z,V,ie){oe.push(z),oe.push(V),oe.push(ie)}function ss(oe,z,V,ie,se,De){var Ie=(De-z)/(ie-z);return oe.push(De),oe.push(V+(se-V)*Ie),oe.push(1),Ie}function Is(oe,z,V,ie,se,De){var Ie=(De-V)/(se-V);return oe.push(z+(ie-z)*Ie),oe.push(De),oe.push(1),Ie}function qs(oe,z){for(var V=[],ie=0;ie<oe.length;ie++){var se,De=oe[ie],Ie=De.type;if("Point"===Ie||"MultiPoint"===Ie||"LineString"===Ie)se=xi(De.geometry,z);else if("MultiLineString"===Ie||"Polygon"===Ie){se=[];for(var Oe=0;Oe<De.geometry.length;Oe++)se.push(xi(De.geometry[Oe],z))}else if("MultiPolygon"===Ie)for(se=[],Oe=0;Oe<De.geometry.length;Oe++){for(var ke=[],Ve=0;Ve<De.geometry[Oe].length;Ve++)ke.push(xi(De.geometry[Oe][Ve],z));se.push(ke)}V.push(Ai(De.id,Ie,se,De.tags))}return V}function xi(oe,z){var V=[];V.size=oe.size,void 0!==oe.start&&(V.start=oe.start,V.end=oe.end);for(var ie=0;ie<oe.length;ie+=3)V.push(oe[ie]+z,oe[ie+1],oe[ie+2]);return V}function Zs(oe,z){if(oe.transformed)return oe;var V,ie,se,De=1<<oe.z,Ie=oe.x,Oe=oe.y;for(V=0;V<oe.features.length;V++){var ke=oe.features[V],Ve=ke.geometry,st=ke.type;if(ke.geometry=[],1===st)for(ie=0;ie<Ve.length;ie+=2)ke.geometry.push(ki(Ve[ie],Ve[ie+1],z,De,Ie,Oe));else for(ie=0;ie<Ve.length;ie++){var It=[];for(se=0;se<Ve[ie].length;se+=2)It.push(ki(Ve[ie][se],Ve[ie][se+1],z,De,Ie,Oe));ke.geometry.push(It)}}return oe.transformed=!0,oe}function ki(oe,z,V,ie,se,De){return[Math.round(V*(oe*ie-se)),Math.round(V*(z*ie-De))]}function Ms(oe,z,V,ie,se){for(var De=z===se.maxZoom?0:se.tolerance/((1<<z)*se.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:ie,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Oe=0;Oe<oe.length;Oe++){Ie.numFeatures++,bi(Ie,oe[Oe],De,se);var ke=oe[Oe].minX,Ve=oe[Oe].minY,st=oe[Oe].maxX,It=oe[Oe].maxY;ke<Ie.minX&&(Ie.minX=ke),Ve<Ie.minY&&(Ie.minY=Ve),st>Ie.maxX&&(Ie.maxX=st),It>Ie.maxY&&(Ie.maxY=It)}return Ie}function bi(oe,z,V,ie){var se=z.geometry,De=z.type,Ie=[];if("Point"===De||"MultiPoint"===De)for(var Oe=0;Oe<se.length;Oe+=3)Ie.push(se[Oe]),Ie.push(se[Oe+1]),oe.numPoints++,oe.numSimplified++;else if("LineString"===De)Zr(Ie,se,oe,V,!1,!1);else if("MultiLineString"===De||"Polygon"===De)for(Oe=0;Oe<se.length;Oe++)Zr(Ie,se[Oe],oe,V,"Polygon"===De,0===Oe);else if("MultiPolygon"===De)for(var ke=0;ke<se.length;ke++){var Ve=se[ke];for(Oe=0;Oe<Ve.length;Oe++)Zr(Ie,Ve[Oe],oe,V,!0,0===Oe)}if(Ie.length){var st=z.tags||null;if("LineString"===De&&ie.lineMetrics){for(var It in st={},z.tags)st[It]=z.tags[It];st.mapbox_clip_start=se.start/se.size,st.mapbox_clip_end=se.end/se.size}var ot={geometry:Ie,type:"Polygon"===De||"MultiPolygon"===De?3:"LineString"===De||"MultiLineString"===De?2:1,tags:st};null!==z.id&&(ot.id=z.id),oe.features.push(ot)}}function Zr(oe,z,V,ie,se,De){var Ie=ie*ie;if(ie>0&&z.size<(se?Ie:ie))V.numPoints+=z.length/3;else{for(var Oe=[],ke=0;ke<z.length;ke+=3)(0===ie||z[ke+2]>Ie)&&(V.numSimplified++,Oe.push(z[ke]),Oe.push(z[ke+1])),V.numPoints++;se&&function(Ve,st){for(var It=0,ot=0,rn=Ve.length,Wt=rn-2;ot<rn;Wt=ot,ot+=2)It+=(Ve[ot]-Ve[Wt])*(Ve[ot+1]+Ve[Wt+1]);if(It>0===st)for(ot=0,rn=Ve.length;ot<rn/2;ot+=2){var Xt=Ve[ot],nn=Ve[ot+1];Ve[ot]=Ve[rn-2-ot],Ve[ot+1]=Ve[rn-1-ot],Ve[rn-2-ot]=Xt,Ve[rn-1-ot]=nn}}(Oe,De),oe.push(Oe)}}function Yn(oe,z){var V=(z=this.options=function(se,De){for(var Ie in De)se[Ie]=De[Ie];return se}(Object.create(this.options),z)).debug;if(V&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var se,De,Ie,Oe,ke,Ve,ie=function(se,De){var Ie=[];if("FeatureCollection"===se.type)for(var Oe=0;Oe<se.features.length;Oe++)zi(Ie,se.features[Oe],De,Oe);else zi(Ie,"Feature"===se.type?se:{geometry:se},De);return Ie}(oe,z);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(se=ie,De=z,Ie=De.buffer/De.extent,Oe=se,ke=mi(se,1,-1-Ie,Ie,0,-1,2,De),Ve=mi(se,1,1-Ie,2+Ie,0,-1,2,De),(ke||Ve)&&(Oe=mi(se,1,-Ie,1+Ie,0,-1,2,De)||[],ke&&(Oe=qs(ke,1).concat(Oe)),Ve&&(Oe=Oe.concat(qs(Ve,-1)))),ie=Oe).length&&this.splitTile(ie,0,0,0),V&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function io(oe,z,V){return 32*((1<<oe)*V+z)+oe}function er(oe,z){const V=oe.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const ie=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!ie)return z(null,null);const se=new Te(ie.features);let De=J(se);0===De.byteOffset&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),z(null,{vectorTile:se,rawData:De.buffer})}Yn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Yn.prototype.splitTile=function(oe,z,V,ie,se,De,Ie){for(var Oe=[oe,z,V,ie],ke=this.options,Ve=ke.debug;Oe.length;){ie=Oe.pop(),V=Oe.pop(),z=Oe.pop(),oe=Oe.pop();var st=1<<z,It=io(z,V,ie),ot=this.tiles[It];if(!ot&&(Ve>1&&console.time("creation"),ot=this.tiles[It]=Ms(oe,z,V,ie,ke),this.tileCoords.push({z,x:V,y:ie}),Ve)){Ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,V,ie,ot.numFeatures,ot.numPoints,ot.numSimplified),console.timeEnd("creation"));var rn="z"+z;this.stats[rn]=(this.stats[rn]||0)+1,this.total++}if(ot.source=oe,se){if(z===ke.maxZoom||z===se)continue;var Wt=1<<se-z;if(V!==Math.floor(De/Wt)||ie!==Math.floor(Ie/Wt))continue}else if(z===ke.indexMaxZoom||ot.numPoints<=ke.indexMaxPoints)continue;if(ot.source=null,0!==oe.length){Ve>1&&console.time("clipping");var Xt,nn,$e,tr,Gt,Wn,Ln=.5*ke.buffer/ke.extent,as=.5-Ln,Ao=.5+Ln,Mt=1+Ln;Xt=nn=$e=tr=null,Gt=mi(oe,st,V-Ln,V+Ao,0,ot.minX,ot.maxX,ke),Wn=mi(oe,st,V+as,V+Mt,0,ot.minX,ot.maxX,ke),oe=null,Gt&&(Xt=mi(Gt,st,ie-Ln,ie+Ao,1,ot.minY,ot.maxY,ke),nn=mi(Gt,st,ie+as,ie+Mt,1,ot.minY,ot.maxY,ke),Gt=null),Wn&&($e=mi(Wn,st,ie-Ln,ie+Ao,1,ot.minY,ot.maxY,ke),tr=mi(Wn,st,ie+as,ie+Mt,1,ot.minY,ot.maxY,ke),Wn=null),Ve>1&&console.timeEnd("clipping"),Oe.push(Xt||[],z+1,2*V,2*ie),Oe.push(nn||[],z+1,2*V,2*ie+1),Oe.push($e||[],z+1,2*V+1,2*ie),Oe.push(tr||[],z+1,2*V+1,2*ie+1)}}},Yn.prototype.getTile=function(oe,z,V){var ie=this.options,se=ie.extent,De=ie.debug;if(oe<0||oe>24)return null;var Ie=1<<oe,Oe=io(oe,z=(z%Ie+Ie)%Ie,V);if(this.tiles[Oe])return Zs(this.tiles[Oe],se);De>1&&console.log("drilling down to z%d-%d-%d",oe,z,V);for(var ke,Ve=oe,st=z,It=V;!ke&&Ve>0;)Ve--,st=Math.floor(st/2),It=Math.floor(It/2),ke=this.tiles[io(Ve,st,It)];return ke&&ke.source?(De>1&&console.log("found parent tile z%d-%d-%d",Ve,st,It),De>1&&console.time("drilling down"),this.splitTile(ke.source,Ve,st,It,oe,z,V),De>1&&console.timeEnd("drilling down"),this.tiles[Oe]?Zs(this.tiles[Oe],se):null):null};class Ni extends h.VectorTileWorkerSource{constructor(z,V,ie,se,De){super(z,V,ie,se,er),De&&(this.loadGeoJSON=De)}loadData(z,V){const ie=z&&z.request,se=ie&&ie.collectResourceTiming;this.loadGeoJSON(z,(De,Ie)=>{if(De||!Ie)return V(De);if("object"!=typeof Ie)return V(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{K(Ie,!0);try{if(z.filter){const ke=h.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ke.result)throw new Error(ke.value.map(st=>`${st.key}: ${st.message}`).join(", "));const Ve=Ie.features.filter(st=>ke.value.evaluate({zoom:0},st));Ie={type:"FeatureCollection",features:Ve}}this._geoJSONIndex=z.cluster?new Pn(function({superclusterOptions:ke,clusterProperties:Ve}){if(!Ve||!ke)return ke;const st={},It={},ot={accumulated:null,zoom:0},rn={properties:null},Wt=Object.keys(Ve);for(const Xt of Wt){const[nn,$e]=Ve[Xt],tr=h.createExpression($e),Gt=h.createExpression("string"==typeof nn?[nn,["accumulated"],["get",Xt]]:nn);st[Xt]=tr.value,It[Xt]=Gt.value}return ke.map=Xt=>{rn.properties=Xt;const nn={};for(const $e of Wt)nn[$e]=st[$e].evaluate(ot,rn);return nn},ke.reduce=(Xt,nn)=>{rn.properties=nn;for(const $e of Wt)ot.accumulated=Xt[$e],Xt[$e]=It[$e].evaluate(ot,rn)},ke}(z)).load(Ie.features):new Yn(ke=Ie,z.geojsonVtOptions)}catch(ke){return V(ke)}this.loaded={};const Oe={};if(se){const ke=h.getPerformanceMeasurement(ie);ke&&(Oe.resourceTiming={},Oe.resourceTiming[z.source]=JSON.parse(JSON.stringify(ke)))}V(null,Oe)}var ke})}reloadTile(z,V){const ie=this.loaded;return ie&&ie[z.uid]?super.reloadTile(z,V):this.loadTile(z,V)}loadGeoJSON(z,V){if(z.request)h.getJSON(z.request,V);else{if("string"!=typeof z.data)return V(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(z.data))}catch(ie){return V(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(z,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(ie){V(ie)}}getClusterChildren(z,V){try{V(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(ie){V(ie)}}getClusterLeaves(z,V){try{V(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(ie){V(ie)}}}class Go{constructor(z){this.self=z,this.actor=new h.Actor(z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=h.getProjection({name:"mercator"}),this.workerSourceTypes={vector:h.VectorTileWorkerSource,geojson:Ni},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,ie)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=ie},this.self.registerRTLTextPlugin=V=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=V.applyArabicShaping,h.plugin.processBidirectionalText=V.processBidirectionalText,h.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(z,V,ie){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z],ie()}checkIfReady(z,V,ie){ie()}setReferrer(z,V){this.referrer=V}spriteLoaded(z,V){this.isSpriteLoaded[z]=V;for(const ie in this.workerSources[z]){const se=this.workerSources[z][ie];for(const De in se)se[De]instanceof h.VectorTileWorkerSource&&(se[De].isSpriteLoaded=V,se[De].fire(new h.Event("isSpriteLoaded")))}}setImages(z,V,ie){this.availableImages[z]=V;for(const se in this.workerSources[z]){const De=this.workerSources[z][se];for(const Ie in De)De[Ie].availableImages=V}ie()}enableTerrain(z,V,ie){this.terrain=V,ie()}setProjection(z,V){this.projections[z]=h.getProjection(V)}setLayers(z,V,ie){this.getLayerIndex(z).replace(V),ie()}updateLayers(z,V,ie){this.getLayerIndex(z).update(V.layers,V.removedIds),ie()}loadTile(z,V,ie){const se=this.enableTerrain?h.extend({enableTerrain:this.terrain},V):V;se.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,V.type,V.source).loadTile(se,ie)}loadDEMTile(z,V,ie){const se=this.enableTerrain?h.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(z,V.source).loadTile(se,ie)}reloadTile(z,V,ie){const se=this.enableTerrain?h.extend({enableTerrain:this.terrain},V):V;se.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,V.type,V.source).reloadTile(se,ie)}abortTile(z,V,ie){this.getWorkerSource(z,V.type,V.source).abortTile(V,ie)}removeTile(z,V,ie){this.getWorkerSource(z,V.type,V.source).removeTile(V,ie)}removeSource(z,V,ie){if(!this.workerSources[z]||!this.workerSources[z][V.type]||!this.workerSources[z][V.type][V.source])return;const se=this.workerSources[z][V.type][V.source];delete this.workerSources[z][V.type][V.source],void 0!==se.removeSource?se.removeSource(V,ie):ie()}loadWorkerSource(z,V,ie){try{this.self.importScripts(V.url),ie()}catch(se){ie(se.toString())}}syncRTLPluginState(z,V,ie){try{h.plugin.setState(V);const se=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&null!=se){this.self.importScripts(se);const De=h.plugin.isParsed();ie(De?void 0:new Error(`RTL Text Plugin failed to import scripts from ${se}`),De)}}catch(se){ie(se.toString())}}getAvailableImages(z){let V=this.availableImages[z];return V||(V=[]),V}getLayerIndex(z){let V=this.layerIndexes[z];return V||(V=this.layerIndexes[z]=new re),V}getWorkerSource(z,V,ie){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][V]||(this.workerSources[z][V]={}),this.workerSources[z][V][ie]||(this.workerSources[z][V][ie]=new this.workerSourceTypes[V]({send:(se,De,Ie,Oe,ke,Ve)=>{this.actor.send(se,De,Ie,z,ke,Ve)},scheduler:this.actor.scheduler},this.getLayerIndex(z),this.getAvailableImages(z),this.isSpriteLoaded[z])),this.workerSources[z][V][ie]}getDEMWorkerSource(z,V){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][V]||(this.demWorkerSources[z][V]=new $),this.demWorkerSources[z][V]}enforceCacheSizeLimit(z,V){h.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(z,V,ie){ie(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Go(self)),Go}),xe(0,function(h){var U=Y;function Y(p){return i=p,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,w=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(w);try{b=new Worker(C),_=!0}catch(S){_=!1}return b&&b.terminate(),URL.revokeObjectURL(C),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var w=b.getImageData(0,0,1,1);return w&&w.width===_.width}()||(void 0===re[d=i&&i.failIfMajorPerformanceCaveat]&&(re[d]=function(_){var b,C,S,P,w=(C=_,S=document.createElement("canvas"),(P=Object.create(Y.webGLContextAttributes)).failIfMajorPerformanceCaveat=C,S.getContext("webgl",P)||S.getContext("experimental-webgl",P));if(!w)return!1;try{b=w.createShader(w.VERTEX_SHADER)}catch(C){return!1}return!(!b||w.isContextLost())&&(w.shaderSource(b,"void main() {}"),w.compileShader(b),!0===w.getShaderParameter(b,w.COMPILE_STATUS))}(d)),!re[d]||document.documentMode));var i,d}var re={};function $(p,i){if(Array.isArray(p)){if(!Array.isArray(i)||p.length!==i.length)return!1;for(let d=0;d<p.length;d++)if(!$(p[d],i[d]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==i){if("object"!=typeof i||Object.keys(p).length!==Object.keys(i).length)return!1;for(const d in p)if(!$(p[d],i[d]))return!1;return!0}return p===i}function K(p,i,d){const _=h.window.document.createElement(p);return void 0!==i&&(_.className=i),d&&d.appendChild(_),_}function W(p,i,d){const _=h.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const b of Object.keys(i))_.setAttributeNS(null,b,i[b]);return d&&d.appendChild(_),_}Y.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const me=h.window.document&&h.window.document.documentElement.style,ce=me&&void 0!==me.userSelect?"userSelect":"WebkitUserSelect";let ue;function Te(){me&&ce&&(ue=me[ce],me[ce]="none")}function Ne(){me&&ce&&(me[ce]=ue)}function Q(p){p.preventDefault(),p.stopPropagation(),h.window.removeEventListener("click",Q,!0)}function we(){h.window.addEventListener("click",Q,!0),h.window.setTimeout(()=>{h.window.removeEventListener("click",Q,!0)},0)}function Ae(p,i){const d=p.getBoundingClientRect();return Me(p,d,i)}function J(p,i){const d=p.getBoundingClientRect(),_=[];for(let b=0;b<i.length;b++)_.push(Me(p,d,i[b]));return _}function ne(p){return void 0!==h.window.InstallTrigger&&2===p.button&&p.ctrlKey&&h.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Me(p,i,d){const _=p.offsetWidth===i.width?1:p.offsetWidth/i.width;return new h.pointGeometry((d.clientX-i.left)*_,(d.clientY-i.top)*_)}function Be(p,i){var d=i[0],_=i[1],b=i[2],w=i[3],C=d*w-b*_;return C?(p[0]=w*(C=1/C),p[1]=-_*C,p[2]=-b*C,p[3]=d*C,p):null}function He(p){const{userImage:i}=p;return!!(i&&i.render&&i.render())&&(p.data.replace(new Uint8Array(i.data.buffer)),!0)}class rt extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,d){this._validate(i,d)&&(this.images[i]=d)}_validate(i,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new h.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),_=!1),_}_validateStretch(i,d){if(!i)return!0;let _=0;for(const b of i){if(b[0]<_||b[1]<b[0]||d<b[1])return!1;_=b[1]}return!0}_validateContent(i,d){return!(i&&(4!==i.length||i[0]<0||d.data.width<i[0]||i[1]<0||d.data.height<i[1]||i[2]<0||d.data.width<i[2]||i[3]<0||d.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,d){d.version=this.images[i].version+1,this.images[i]=d,this.updatedImages[i]=!0}removeImage(i){const d=this.images[i];delete this.images[i],delete this.patterns[i],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,d){let _=!0;if(!this.isLoaded())for(const b of i)this.images[b]||(_=!1);this.isLoaded()||_?this._notify(i,d):this.requestors.push({ids:i,callback:d})}_notify(i,d){const _={};for(const b of i){this.images[b]||this.fire(new h.Event("styleimagemissing",{id:b}));const w=this.images[b];w?_[b]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:Boolean(w.userImage&&w.userImage.render)}:h.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){const{width:i,height:d}=this.atlasImage;return{width:i,height:d}}getPattern(i){const d=this.patterns[i],_=this.getImage(i);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new h.ImagePosition(b,_);this.patterns[i]={bin:b,position:w}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const d=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.Texture(i,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const w in this.patterns)i.push(this.patterns[w].bin);const{w:d,h:_}=h.potpack(i),b=this.atlasImage;b.resize({width:d||1,height:_||1});for(const w in this.patterns){const{bin:C}=this.patterns[w],S=C.x+1,P=C.y+1,R=this.images[w].data,L=R.width,B=R.height;h.RGBAImage.copy(R,b,{x:0,y:0},{x:S,y:P},{width:L,height:B}),h.RGBAImage.copy(R,b,{x:0,y:B-1},{x:S,y:P-1},{width:L,height:1}),h.RGBAImage.copy(R,b,{x:0,y:0},{x:S,y:P+B},{width:L,height:1}),h.RGBAImage.copy(R,b,{x:L-1,y:0},{x:S-1,y:P},{width:1,height:B}),h.RGBAImage.copy(R,b,{x:0,y:0},{x:S+L,y:P},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const d of i){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.images[d];He(_)&&this.updateImage(d,_)}}}const mt=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate(p,i){return function([d,_,b]){const w=h.degToRad(_+90),C=h.degToRad(b);return{x:d*Math.cos(w)*Math.sin(C),y:d*Math.sin(w)*Math.sin(C),z:d*Math.cos(C),azimuthal:_,polar:b}}(p.expression.evaluate(i))}interpolate(p,i,d){return{x:h.number(p.x,i.x,d),y:h.number(p.y,i.y,d),z:h.number(p.z,i.z,d),azimuthal:h.number(p.azimuthal,i.azimuthal,d),polar:h.number(p.polar,i.polar,d)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),Pt="-transition";class gt extends h.Evented{constructor(i){super(),this._transitionable=new h.Transitionable(mt),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,d={}){if(!this._validate(h.validateLight,i,d))for(const _ in i){const b=i[_];h.endsWith(_,Pt)?this._transitionable.setTransition(_.slice(0,-Pt.length),b):this._transitionable.setValue(_,b)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,d,_){return(!_||!1!==_.validate)&&h.emitValidationErrors(this,i.call(h.validateStyle,h.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}const Et=new h.Properties({source:new h.DataConstantProperty(h.spec.terrain.source),exaggeration:new h.DataConstantProperty(h.spec.terrain.exaggeration)}),Ot="-transition";class ut extends h.Evented{constructor(i,d){super(),this._transitionable=new h.Transitionable(Et),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d}get(){return this._transitionable.serialize()}set(i){for(const d in i){const _=i[d];h.endsWith(d,Ot)?this._transitionable.setTransition(d.slice(0,-Ot.length),_):this._transitionable.setValue(d,_)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function it(p,i,d,_){const b=h.smoothstep(45,65,d),[w,C]=cn(p,_),S=h.length(i);let P=1-Math.min(1,Math.exp((S-w)/(C-w)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*b*p.alpha}function cn(p,i){const d=.5/Math.tan(.5*i);return[p.range[0]+d,p.range[1]+d]}const wn=new h.Properties({range:new h.DataConstantProperty(h.spec.fog.range),color:new h.DataConstantProperty(h.spec.fog.color),"horizon-blend":new h.DataConstantProperty(h.spec.fog["horizon-blend"])}),sn="-transition";class On extends h.Evented{constructor(i,d){super(),this._transitionable=new h.Transitionable(wn),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,d={}){if(!this._validate(h.validateFog,i,d))for(const _ in i){const b=i[_];h.endsWith(_,sn)?this._transitionable.setTransition(_.slice(0,-sn.length),b):this._transitionable.setValue(_,b)}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return h.smoothstep(45,65,i)*d.a}getOpacityAtLatLng(i,d){return this._transform.projection.supportsFog?function(_,b,w){const C=h.MercatorCoordinate.fromLngLat(b),S=w.elevation?w.elevation.getAtPointOrZero(C):0,P=[C.x,C.y,S];return h.transformMat4(P,P,w.mercatorFogMatrix),it(_,P,w.pitch,w._fov)}(this.state,i,d):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?cn(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,d,_){return(!_||!1!==_.validate)&&h.emitValidationErrors(this,i.call(h.validateStyle,h.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class un{constructor(i,d){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const _=this.workerPool.acquire(this.id);for(let b=0;b<_.length;b++){const w=new un.Actor(_[b],d,this.id);w.name=`Worker ${b}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,d,_){h.asyncAll(this.actors,(b,w)=>{b.send(i,d,w)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Nn(p,i,d){return i*(h.EXTENT/(p.tileSize*Math.pow(2,d-p.tileID.overscaledZ)))}un.Actor=h.Actor;class ir{constructor(i,d,_,b){this.screenBounds=i,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(w=>b.pointCoordinate3D(w)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(i,d){let _,b;if(i instanceof h.pointGeometry||"number"==typeof i[0]){const w=h.pointGeometry.convert(i);_=[h.pointGeometry.convert(i)],b=d.isPointAboveHorizon(w)}else{const w=h.pointGeometry.convert(i[0]),C=h.pointGeometry.convert(i[1]);_=[w,C],b=h.polygonizeBounds(w,C).every(S=>d.isPointAboveHorizon(S))}return new ir(_,d.getCameraPoint(),b,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return h.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const d=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new h.pointGeometry(1,1)):this.screenBounds[1],b=h.polygonizeBounds(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),h.bufferConvexPolygon(b,i)}containsTile(i,d,_){const b=i.queryPadding+1,w=i.tileID.wrap,C=_?this._bufferedCameraMercator(b,d).map(X=>h.getTilePoint(i.tileTransform,X,w)):this._bufferedScreenMercator(b,d).map(X=>h.getTilePoint(i.tileTransform,X,w)),S=this.screenGeometryMercator.map(X=>h.getTileVec3(i.tileTransform,X,w)),P=S.map(X=>new h.pointGeometry(X[0],X[1])),R=d.getFreeCameraOptions().position||new h.MercatorCoordinate(0,0,0),L=h.getTileVec3(i.tileTransform,R,w),B=S.map(X=>{const G=h.sub(X,X,L);return h.normalize(G,G),new h.Ray(L,G)}),H=Nn(i,1,d.zoom);if(h.polygonIntersectsBox(C,0,0,h.EXTENT,h.EXTENT))return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:B,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(te=h.getBounds(C),te.min.x=h.clamp(te.min.x,0,h.EXTENT),te.min.y=h.clamp(te.min.y,0,h.EXTENT),te.max.x=h.clamp(te.max.x,0,h.EXTENT),te.max.y=h.clamp(te.max.y,0,h.EXTENT),te),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:H};var te}_bufferedScreenMercator(i,d){const _=kt(i);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{const b=this.bufferedScreenGeometry(i).map(w=>d.pointCoordinate3D(w));return this._screenRaycastCache[_]=b,b}}_bufferedCameraMercator(i,d){const _=kt(i);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{const b=this.bufferedCameraGeometry(i).map(w=>d.pointCoordinate3D(w));return this._cameraRaycastCache[_]=b,b}}}function kt(p){return 100*p|0}function Pn(p,i,d){const _=function(b,w){if(b)return d(b);if(w){const C=h.pick(h.extend(w,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(C.vectorLayers=w.vector_layers,C.vectorLayerIds=C.vectorLayers.map(S=>S.id)),C.tiles=i.canonicalizeTileset(C,p.url),d(null,C)}};return p.url?h.getJSON(i.transformRequest(i.normalizeSourceURL(p.url),h.ResourceType.Source),_):h.exported.frame(()=>_(null,p))}class nt{constructor(i,d,_){this.bounds=h.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const d=Math.pow(2,i.z),_=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*d),b=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*d),C=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*d);return i.x>=_&&i.x<w&&i.y>=b&&i.y<C}}class Tt{constructor(i,d,_){this.context=i;const b=i.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $t={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fn{constructor(i,d,_,b){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.context=i;const w=i.gl;this.buffer=w.createBuffer(),i.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,d){for(let _=0;_<this.attributes.length;_++){const b=d.attributes[this.attributes[_].name];void 0!==b&&i.enableVertexAttribArray(b)}}setVertexAttribPointers(i,d,_){for(let b=0;b<this.attributes.length;b++){const w=this.attributes[b],C=d.attributes[w.name];void 0!==C&&i.vertexAttribPointer(C,w.components,i[$t[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class bt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class kn extends bt{getDefault(){return h.Color.transparent}set(i){const d=this.current;(i.r!==d.r||i.g!==d.g||i.b!==d.b||i.a!==d.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Gr extends bt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class ur extends bt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Qn extends bt{getDefault(){return[!0,!0,!0,!0]}set(i){const d=this.current;(i[0]!==d[0]||i[1]!==d[1]||i[2]!==d[2]||i[3]!==d[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class yn extends bt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class hr extends bt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class jn extends bt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const d=this.current;(i.func!==d.func||i.ref!==d.ref||i.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Ai extends bt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const d=this.current;(i[0]!==d[0]||i[1]!==d[1]||i[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class qr extends bt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;i?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=i,this.dirty=!1}}class zi extends bt{getDefault(){return[0,1]}set(i){const d=this.current;(i[0]!==d[0]||i[1]!==d[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Mo extends bt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;i?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=i,this.dirty=!1}}class Nr extends bt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class no extends bt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;i?d.enable(d.BLEND):d.disable(d.BLEND),this.current=i,this.dirty=!1}}class Wi extends bt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const d=this.current;(i[0]!==d[0]||i[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Vo extends bt{getDefault(){return h.Color.transparent}set(i){const d=this.current;(i.r!==d.r||i.g!==d.g||i.b!==d.b||i.a!==d.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class mi extends bt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Pi extends bt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;i?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=i,this.dirty=!1}}class ro extends bt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class $o extends bt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class os extends bt{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Ss extends bt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class ss extends bt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const d=this.current;(i[0]!==d[0]||i[1]!==d[1]||i[2]!==d[2]||i[3]!==d[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Is extends bt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class qs extends bt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class xi extends bt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Zs extends bt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ki extends bt{getDefault(){return null}set(i){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ms extends bt{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class bi extends bt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Zr extends bt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Yn extends bt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class io extends bt{constructor(i,d){super(i),this.context=i,this.parent=d}getDefault(){return null}}class er extends io{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ni extends io{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Go extends Ni{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class oe{constructor(i,d,_,b){this.context=i,this.width=d,this.height=_;const w=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new er(i,w),b&&(this.depthAttachment=new Ni(i,w))}destroy(){const i=this.context.gl,d=this.colorAttachment.get();if(d&&i.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&i.deleteRenderbuffer(_)}i.deleteFramebuffer(this.framebuffer)}}class z{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new kn(this),this.clearDepth=new Gr(this),this.clearStencil=new ur(this),this.colorMask=new Qn(this),this.depthMask=new yn(this),this.stencilMask=new hr(this),this.stencilFunc=new jn(this),this.stencilOp=new Ai(this),this.stencilTest=new qr(this),this.depthRange=new zi(this),this.depthTest=new Mo(this),this.depthFunc=new Nr(this),this.blend=new no(this),this.blendFunc=new Wi(this),this.blendColor=new Vo(this),this.blendEquation=new mi(this),this.cullFace=new Pi(this),this.cullFaceSide=new ro(this),this.frontFace=new $o(this),this.program=new os(this),this.activeTexture=new Ss(this),this.viewport=new ss(this),this.bindFramebuffer=new Is(this),this.bindRenderbuffer=new qs(this),this.bindTexture=new xi(this),this.bindVertexBuffer=new Zs(this),this.bindElementBuffer=new ki(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ms(this),this.pixelStoreUnpack=new bi(this),this.pixelStoreUnpackPremultiplyAlpha=new Zr(this),this.pixelStoreUnpackFlipY=new Yn(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,d){return new Tt(this,i,d)}createVertexBuffer(i,d,_){return new fn(this,i,d,_)}createRenderbuffer(i,d,_){const b=this.gl,w=b.createRenderbuffer();return this.bindRenderbuffer.set(w),b.renderbufferStorage(b.RENDERBUFFER,i,d,_),this.bindRenderbuffer.set(null),w}createFramebuffer(i,d,_){return new oe(this,i,d,_)}clear({color:i,depth:d,stencil:_}){const b=this.gl;let w=0;i&&(w|=b.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(w|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==_&&(w|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(w)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){$(i.blendFunction,h.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class V extends h.Evented{constructor(i,d,_,b){super(),this.id=i,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},d),h.extend(this,h.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Pn(this._options,this.map._requestManager,(i,d)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new h.ErrorEvent(i)):d&&(h.extend(this,d),d.bounds&&(this.tileBounds=new nt(d.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(d.tiles),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,d){const _=h.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);i.request=h.getImage(this.map._requestManager.transformRequest(b,h.ResourceType.Tile),(w,C,S,P)=>(delete i.request,i.aborted?(i.state="unloaded",d(null)):w?(i.state="errored",d(w)):C?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:P}),i.setTexture(C,this.map.painter),i.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(i,d,_){i.setTexture(d,_)}static unloadTileData(i,d){i.texture&&d.saveTileTexture(i.texture)}abortTile(i,d){i.request&&(i.request.cancel(),delete i.request),d()}unloadTile(i,d){i.texture&&this.map.painter.saveTileTexture(i.texture),d()}hasTransition(){return!1}}let ie;function se(p,i,d,_,b,w,C,S){const P=[p,d,b,i,_,w,1,1,1],R=[C,S,1],L=h.adjoint([],P),[B,H,te]=h.transformMat3(R,R,h.transpose(L,L));return h.multiply(P,[B,0,0,0,H,0,0,0,te],P)}class De extends h.Evented{constructor(i,d,_,b){super(),this.id=i,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=d}load(i){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(d,_)=>{if(this._loaded=!0,d)this.fire(new h.ErrorEvent(d));else if(_){const{HTMLImageElement:b}=h.window;this.image=_ instanceof b?h.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const d=i.map(h.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let b=1/0,w=1/0,C=-1/0,S=-1/0;for(const B of _)b=Math.min(b,B.x),w=Math.min(w,B.y),C=Math.max(C,B.x),S=Math.max(S,B.y);const P=Math.max(C-b,S-w),R=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),L=Math.pow(2,R);return new h.CanonicalTileID(R,Math.floor((b+C)/2*L),Math.floor((w+S)/2*L))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const P in this.tiles){const R=this.tiles[P];"loaded"!==R.state&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;const d=h.tileTransform(this.tileID,this.map.transform.projection),[_,b,w,C]=this.coordinates.map(P=>{const R=d.projection.project(P[0],P[1]);return h.getTilePoint(d,R)._round()});this.perspectiveTransform=function(P,R,L,B,H,te,X,G,ge,ae){const fe=se(0,0,P,0,0,R,P,R),_e=se(L,B,H,te,X,G,ge,ae);return h.multiply(_e,h.adjoint(fe,fe),_e),[_e[6]/_e[8]*P/h.EXTENT,_e[7]/_e[8]*R/h.EXTENT]}(this.width,this.height,_.x,_.y,b.x,b.y,C.x,C.y,w.x,w.y);const S=this._boundsArray=new h.StructArrayLayout4i8;S.emplaceBack(_.x,_.y,0,0),S.emplaceBack(b.x,b.y,h.EXTENT,0),S.emplaceBack(C.x,C.y,0,h.EXTENT),S.emplaceBack(w.x,w.y,h.EXTENT,h.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(S,h.boundsAttributes.members),this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,d=i.gl;this.texture?this.texture.update(this.image):(this.texture=new h.Texture(i,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._prepareData(i)}loadTile(i,d){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},d(null)):(i.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ie={vector:class extends h.Evented{constructor(p,i,d,_){if(super(),this.id=p,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(i,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new h.DedupedRequest}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Pn(this._options,this.map._requestManager,(p,i)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new h.ErrorEvent(p)):i&&(h.extend(this,i),i.bounds&&(this.tileBounds=new nt(i.bounds,this.minzoom,this.maxzoom)),h.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p();const i=this.map.style._getSourceCaches(this.id);for(const d of i)d.clearTiles();this.load()}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}loadTile(p,i){const d=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(d,h.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=i:p.request=p.actor.send("reloadTile",_,b.bind(this));else if(p.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",_,b.bind(this),void 0,!0);else{const w=h.loadVectorTile.call({deduped:this._deduped},_,(C,S)=>{C||!S?b.call(this,C):(_.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},p.actor&&p.actor.send("loadTile",_,b.bind(this),void 0,!0))},!0);p.request={cancel:w}}function b(w,C){return delete p.request,p.aborted?i(null):w&&404!==w.status?i(w):(C&&C.resourceTiming&&(p.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&p.setExpiryData(C),p.loadVectorData(C,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:V,"raster-dem":class extends V{constructor(p,i,d,_){super(p,i,d,_),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(p,i){const d=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(b,w){b&&(p.state="errored",i(b)),w&&(p.dem=w,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",i(null))}p.request=h.getImage(this.map._requestManager.transformRequest(d,h.ResourceType.Tile),function(b,w,C,S){if(delete p.request,p.aborted)p.state="unloaded",i(null);else if(b)p.state="errored",i(b);else if(w){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:C,expires:S});const P=h.window.ImageBitmap&&w instanceof h.window.ImageBitmap&&(null==ie&&(ie=h.window.OffscreenCanvas&&new h.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof h.window.createImageBitmap),ie),R=1-(w.width-h.prevPowerOfTwo(w.width))/2;R<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const L=P?w:h.exported.getImageData(w,R),B={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:R};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",B,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const i=p.canonical,d=Math.pow(2,i.z),_=(i.x-1+d)%d,b=0===i.x?p.wrap-1:p.wrap,w=(i.x+1+d)%d,C=i.x+1===d?p.wrap+1:p.wrap,S={};return S[new h.OverscaledTileID(p.overscaledZ,b,i.z,_,i.y).key]={backfilled:!1},S[new h.OverscaledTileID(p.overscaledZ,C,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(S[new h.OverscaledTileID(p.overscaledZ,b,i.z,_,i.y-1).key]={backfilled:!1},S[new h.OverscaledTileID(p.overscaledZ,p.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},S[new h.OverscaledTileID(p.overscaledZ,C,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<d&&(S[new h.OverscaledTileID(p.overscaledZ,b,i.z,_,i.y+1).key]={backfilled:!1},S[new h.OverscaledTileID(p.overscaledZ,p.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},S[new h.OverscaledTileID(p.overscaledZ,C,i.z,w,i.y+1).key]={backfilled:!1}),S}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends h.Evented{constructor(p,i,d,_){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=i.data,this._options=h.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const b=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*b,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*b,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:h.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*b,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},i),this}getClusterChildren(p,i){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},i),this}getClusterLeaves(p,i,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:i,offset:d},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new h.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=h.extend({},this.workerOptions),i=this._data;"string"==typeof i?(p.request=this.map._requestManager.transformRequest(h.exported.resolveURL(i),h.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new h.ErrorEvent(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),this.fire(new h.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,i){const d=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(d,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:h.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,b)=>(delete p.request,p.unloadVectorData(),p.aborted?i(null):_?i(_):(p.loadVectorData(b,this.map.painter,"reloadTile"===d),i(null))),void 0,"loadTile"===d)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends De{constructor(p,i,d,_){super(p,i,d,_),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const i of p.urls)this.urls.push(this.map._requestManager.transformRequest(i,h.ResourceType.Source).url);h.getVideo(this.urls,(i,d)=>{this._loaded=!0,i?this.fire(new h.ErrorEvent(i)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const i=this.video.seekable;p<i.start(0)||p>i.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,i=p.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new h.Texture(p,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:De,canvas:class extends De{constructor(p,i,d,_){super(p,i,d,_),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(w=>"number"!=typeof w))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof h.window.HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof h.window.HTMLCanvasElement?this.options.canvas:h.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends h.Evented{constructor(p,i,d,_){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=i,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new h.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new h.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new nt(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.coveringTiles=this._coveringTiles.bind(this),h.extend(this,h.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return h.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:i,y:d,z:_}=p.canonical;return this._implementation.hasTile({x:i,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,i){const{x:d,y:_,z:b}=p.tileID.canonical,w=new h.window.AbortController,C=this._implementation.loadTile({x:d,y:_,z:b},{signal:w.signal});if(!C)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",i(null);C.cancel=()=>w.abort(),p.request=C.then(function(S){return delete p.request,p.aborted?(p.state="unloaded",i(null)):S?(P=S)instanceof h.window.ImageData||P instanceof h.window.ImageBitmap||P instanceof h.window.HTMLCanvasElement?(this.loadTileData(p,S),p.state="loaded",void i(null)):(p.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",i(null));var P}.bind(this)).catch(S=>{20!==S.code&&(p.state="errored",i(S))})}loadTileData(p,i){V.loadTileData(p,i,this._map.painter)}unloadTileData(p){V.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:i,y:d,z:_}=p.tileID.canonical,b=this._implementation.prepareTile({x:i,y:d,z:_});return b?(this.loadTileData(p,b),p.state="loaded",b):null}unloadTile(p,i){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:d,y:_,z:b}=p.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:b})}i()}abortTile(p,i){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Oe=function(p,i,d,_){const b=new Ie[i.type](p,i,d,_);if(b.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${b.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],b),b};function ke(p,i){const d=h.identity([]);return h.scale(d,d,[.5*p.width,.5*-p.height,1]),h.translate(d,d,[1,-1,0]),h.multiply$1(d,d,p.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(d)}function Ve(p,i,d,_,b,w,C,S=!1){const P=p.tilesIn(_,C,S);P.sort(It);const R=[];for(const B of P)R.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(i,d,p._state,B,b,w,ke(p.transform,B.tile.tileID),S)});const L=function(B){const H={},te={};for(const X of B){const G=X.queryResults,ge=X.wrappedTileID,ae=te[ge]=te[ge]||{};for(const fe in G){const _e=G[fe],ve=ae[fe]=ae[fe]||{},he=H[fe]=H[fe]||[];for(const Ce of _e)ve[Ce.featureIndex]||(ve[Ce.featureIndex]=!0,he.push(Ce))}}return H}(R);for(const B in L)L[B].forEach(H=>{const te=H.feature,X=te.layer;X&&"background"!==X.type&&"sky"!==X.type&&(te.source=X.source,X["source-layer"]&&(te.sourceLayer=X["source-layer"]),te.state=void 0!==te.id?p.getFeatureState(X["source-layer"],te.id):{})});return L}function st(p,i){const d=p.getRenderableIds().map(w=>p.getTileByID(w)),_=[],b={};for(let w=0;w<d.length;w++){const C=d[w],S=C.tileID.canonical.key;b[S]||(b[S]=!0,C.querySourceFeatures(_,i))}return _}function It(p,i){const d=p.tileID,_=i.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function ot(){return null!=na.workerClass?new na.workerClass:new h.window.Worker(na.workerUrl)}const rn="mapboxgl_preloaded_worker_pool";class Wt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Wt.workerCount;)this.workers.push(new ot);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[rn]}numActive(){return Object.keys(this.active).length}}let Xt;function nn(){return Xt||(Xt=new Wt),Xt}function $e(p,i){const d={};for(const _ in p)"ref"!==_&&(d[_]=p[_]);return h.refProperties.forEach(_=>{_ in i&&(d[_]=i[_])}),d}function tr(p){p=p.slice();const i=Object.create(null);for(let d=0;d<p.length;d++)i[p[d].id]=p[d];for(let d=0;d<p.length;d++)"ref"in p[d]&&(p[d]=$e(p[d],i[p[d].ref]));return p}Wt.workerCount=2;const Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Wn(p,i,d){d.push({command:Gt.addSource,args:[p,i[p]]})}function Ln(p,i,d){i.push({command:Gt.removeSource,args:[p]}),d[p]=!0}function as(p,i,d,_){Ln(p,d,_),Wn(p,i,d)}function Ao(p,i,d){let _;for(_ in p[d])if(p[d].hasOwnProperty(_)&&"data"!==_&&!$(p[d][_],i[d][_]))return!1;for(_ in i[d])if(i[d].hasOwnProperty(_)&&"data"!==_&&!$(p[d][_],i[d][_]))return!1;return!0}function Mt(p,i,d,_,b,w){let C;for(C in i=i||{},p=p||{})p.hasOwnProperty(C)&&($(p[C],i[C])||d.push({command:w,args:[_,C,i[C],b]}));for(C in i)i.hasOwnProperty(C)&&!p.hasOwnProperty(C)&&($(p[C],i[C])||d.push({command:w,args:[_,C,i[C],b]}))}function pn(p){return p.id}function tn(p,i){return p[i.id]=i,p}class wi{constructor(i,d){this.reset(i,d)}reset(i,d){this.points=i||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=h.clamp(i,0,1);let d=1,_=this._distances[d];const b=i*this.paddedLength+this.padding;for(;_<b&&d<this._distances.length;)_=this._distances[++d];const w=d-1,C=this._distances[w],S=_-C,P=S>0?(b-C)/S:0;return this.points[w].mult(1-P).add(this.points[d].mult(P))}}class ls{constructor(i,d,_){const b=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/_),this.yCellCount=Math.ceil(d/_);for(let C=0;C<this.xCellCount*this.yCellCount;C++)b.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=d,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,d,_,b,w){this._forEachCell(d,_,b,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(w)}insertCircle(i,d,_,b){this._forEachCell(d-b,_-b,d+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(d),this.circles.push(_),this.circles.push(b)}_insertBoxCell(i,d,_,b,w,C){this.boxCells[w].push(C)}_insertCircleCell(i,d,_,b,w,C){this.circleCells[w].push(C)}_query(i,d,_,b,w,C){if(_<0||i>this.width||b<0||d>this.height)return!w&&[];const S=[];if(i<=0&&d<=0&&this.width<=_&&this.height<=b){if(w)return!0;for(let P=0;P<this.boxKeys.length;P++)S.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const R=this.circles[3*P],L=this.circles[3*P+1],B=this.circles[3*P+2];S.push({key:this.circleKeys[P],x1:R-B,y1:L-B,x2:R+B,y2:L+B})}return C?S.filter(C):S}return this._forEachCell(i,d,_,b,this._queryCell,S,{hitTest:w,seenUids:{box:{},circle:{}}},C),w?S.length>0:S}_queryCircle(i,d,_,b,w){const C=i-_,S=i+_,P=d-_,R=d+_;if(S<0||C>this.width||R<0||P>this.height)return!b&&[];const L=[];return this._forEachCell(C,P,S,R,this._queryCellCircle,L,{hitTest:b,circle:{x:i,y:d,radius:_},seenUids:{box:{},circle:{}}},w),b?L.length>0:L}query(i,d,_,b,w){return this._query(i,d,_,b,!1,w)}hitTest(i,d,_,b,w){return this._query(i,d,_,b,!0,w)}hitTestCircle(i,d,_,b){return this._queryCircle(i,d,_,!0,b)}_queryCell(i,d,_,b,w,C,S,P){const R=S.seenUids,L=this.boxCells[w];if(null!==L){const H=this.bboxes;for(const te of L)if(!R.box[te]){R.box[te]=!0;const X=4*te;if(i<=H[X+2]&&d<=H[X+3]&&_>=H[X+0]&&b>=H[X+1]&&(!P||P(this.boxKeys[te]))){if(S.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[te],x1:H[X],y1:H[X+1],x2:H[X+2],y2:H[X+3]})}}}const B=this.circleCells[w];if(null!==B){const H=this.circles;for(const te of B)if(!R.circle[te]){R.circle[te]=!0;const X=3*te;if(this._circleAndRectCollide(H[X],H[X+1],H[X+2],i,d,_,b)&&(!P||P(this.circleKeys[te]))){if(S.hitTest)return C.push(!0),!0;{const G=H[X],ge=H[X+1],ae=H[X+2];C.push({key:this.circleKeys[te],x1:G-ae,y1:ge-ae,x2:G+ae,y2:ge+ae})}}}}}_queryCellCircle(i,d,_,b,w,C,S,P){const R=S.circle,L=S.seenUids,B=this.boxCells[w];if(null!==B){const te=this.bboxes;for(const X of B)if(!L.box[X]){L.box[X]=!0;const G=4*X;if(this._circleAndRectCollide(R.x,R.y,R.radius,te[G+0],te[G+1],te[G+2],te[G+3])&&(!P||P(this.boxKeys[X])))return C.push(!0),!0}}const H=this.circleCells[w];if(null!==H){const te=this.circles;for(const X of H)if(!L.circle[X]){L.circle[X]=!0;const G=3*X;if(this._circlesCollide(te[G],te[G+1],te[G+2],R.x,R.y,R.radius)&&(!P||P(this.circleKeys[X])))return C.push(!0),!0}}}_forEachCell(i,d,_,b,w,C,S,P){const R=this._convertToXCellCoord(i),L=this._convertToYCellCoord(d),B=this._convertToXCellCoord(_),H=this._convertToYCellCoord(b);for(let te=R;te<=B;te++)for(let X=L;X<=H;X++)if(w.call(this,i,d,_,b,this.xCellCount*X+te,C,S,P))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,d,_,b,w,C){const S=b-i,P=w-d,R=_+C;return R*R>S*S+P*P}_circleAndRectCollide(i,d,_,b,w,C,S){const P=(C-b)/2,R=Math.abs(i-(b+P));if(R>P+_)return!1;const L=(S-w)/2,B=Math.abs(d-(w+L));if(B>L+_)return!1;if(R<=P||B<=L)return!0;const H=R-P,te=B-L;return H*H+te*te<=_*_}}const Bn=Math.tan(85*Math.PI/180);function gn(p,i,d,_,b,w){const C=h.create();if(d){if("globe"===b.projection.name)h.multiply$1(C,C,h.calculateGlobeLabelMatrix(b,i));else{const S=Be([],w);C[0]=S[0],C[1]=S[1],C[4]=S[2],C[5]=S[3]}_||h.rotateZ(C,C,b.angle)}else h.multiply$1(C,b.labelPlaneMatrix,p);return C}function cs(p,i,d,_,b,w){if(d){if("globe"===b.projection.name){const C=gn(p,i,d,_,b,w);return h.invert(C,C),h.multiply$1(C,p,C),C}{const C=h.clone(p),S=h.identity([]);return S[0]=w[0],S[1]=w[1],S[4]=w[2],S[5]=w[3],h.multiply$1(C,C,S),_||h.rotateZ(C,C,-b.angle),C}}return b.glCoordMatrix}function Cr(p,i,d=0){const _=[p.x,p.y,d,1];d?h.transformMat4$1(_,_,i):Ar(_,_,i);const b=_[3];return{point:new h.pointGeometry(_[0]/b,_[1]/b),signedDistanceFromCamera:b}}function hi(p,i){const d=[p[0],p[1],p[2],1];h.transformMat4$1(d,d,i);const _=d[3];return{point:new h.pointGeometry(d[0]/_,d[1]/_),signedDistanceFromCamera:_}}function Dr(p,i){return Math.min(.5+p/i*.5,1.5)}function Kl(p,i){const d=p[0]/p[3],_=p[1]/p[3];return d>=-i[0]&&d<=i[0]&&_>=-i[1]&&_<=i[1]}function Xi(p,i,d,_,b,w,C,S,P,R){const L=d.transform,B=_?p.textSizeData:p.iconSizeData,H=h.evaluateSizeForZoom(B,d.transform.zoom),te=[256/d.width*2+1,256/d.height*2+1],X=_?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;X.clear();const G=p.lineVertexArray,ge=_?p.text.placedSymbolArray:p.icon.placedSymbolArray,ae=d.transform.width/d.transform.height;let fe=!1;for(let _e=0;_e<ge.length;_e++){const ve=ge.get(_e);if(ve.writingMode!==h.WritingMode.vertical||fe||0!==_e&&ge.get(_e-1).writingMode===h.WritingMode.horizontal||(fe=!0),(ve.hidden||ve.writingMode===h.WritingMode.vertical)&&!fe){Wr(ve.numGlyphs,X);continue}fe=!1;const he=new h.pointGeometry(ve.tileAnchorX,ve.tileAnchorY),Ce=P?P(he):[0,0,0],Ue=L.projection.projectTilePoint(he.x,he.y,R.canonical),We=[Ue.x+Ce[0],Ue.y+Ce[1],Ue.z+Ce[2]],et=[...We,1];if(h.transformMat4$1(et,et,i),!Kl(et,te)){Wr(ve.numGlyphs,X);continue}const Je=Dr(d.transform.cameraToCenterDistance,et[3]),Dt=h.evaluateSizeForFeature(B,H,ve),je=C?Dt/Je:Dt*Je,yt=Cr(new h.pointGeometry(We[0],We[1]),b,We[2]);if(yt.signedDistanceFromCamera<=0){Wr(ve.numGlyphs,X);continue}let xt={};const Ht=C?null:P,Ke=As(ve,je,!1,S,i,b,w,p.glyphOffsetArray,G,X,yt.point,he,xt,ae,Ht,L.projection,R);fe=Ke.useVertical,Ht&&Ke.needsFlipping&&(xt={}),(Ke.notEnoughRoom||fe||Ke.needsFlipping&&As(ve,je,!0,S,i,b,w,p.glyphOffsetArray,G,X,yt.point,he,xt,ae,Ht,L.projection,R).notEnoughRoom)&&Wr(ve.numGlyphs,X)}_?p.text.dynamicLayoutVertexBuffer.updateData(X):p.icon.dynamicLayoutVertexBuffer.updateData(X)}function Ws(p,i,d,_,b,w,C,S,P,R,L,B,H,te,X){const G=S.glyphStartIndex+S.numGlyphs,ge=S.lineStartIndex,ae=S.lineStartIndex+S.lineLength,fe=i.getoffsetX(S.glyphStartIndex),_e=i.getoffsetX(G-1),ve=xn(p*fe,d,_,b,w,C,S.segment,ge,ae,P,R,L,B,H,!0,te,X);if(!ve)return null;const he=xn(p*_e,d,_,b,w,C,S.segment,ge,ae,P,R,L,B,H,!0,te,X);return he?{first:ve,last:he}:null}function oo(p,i,d,_){return p.writingMode===h.WritingMode.horizontal&&Math.abs(d.y-i.y)>Math.abs(d.x-i.x)*_?{useVertical:!0}:p.writingMode===h.WritingMode.vertical?i.y<d.y?{needsFlipping:!0}:null:0!==p.flipState&&function(b,w,C){const S=(w.x-b.x)*C;return 0===S||Math.abs((w.y-b.y)/S)>Bn}(i,d,_)?1===p.flipState?{needsFlipping:!0}:null:i.x>d.x?{needsFlipping:!0}:null}function As(p,i,d,_,b,w,C,S,P,R,L,B,H,te,X,G,ge){const ae=i/24,fe=p.lineOffsetX*ae,_e=p.lineOffsetY*ae;let ve;if(p.numGlyphs>1){const he=p.glyphStartIndex+p.numGlyphs,Ce=p.lineStartIndex,Ue=p.lineStartIndex+p.lineLength,We=Ws(ae,S,fe,_e,d,L,B,p,P,w,H,X,!1,G,ge);if(!We)return{notEnoughRoom:!0};const et=Cr(We.first.point,C).point,Je=Cr(We.last.point,C).point;if(_&&!d){const Dt=oo(p,et,Je,te);if(p.flipState=Dt&&Dt.needsFlipping?1:2,Dt)return Dt}ve=[We.first];for(let Dt=p.glyphStartIndex+1;Dt<he-1;Dt++)ve.push(xn(ae*S.getoffsetX(Dt),fe,_e,d,L,B,p.segment,Ce,Ue,P,w,H,X,!1,!1,G,ge));ve.push(We.last)}else{if(_&&!d){const Ce=Cr(B,b).point,Ue=p.lineStartIndex+p.segment+1,We=new h.pointGeometry(P.getx(Ue),P.gety(Ue)),et=Cr(We,b),Je=oo(p,Ce,et.signedDistanceFromCamera>0?et.point:qn(B,We,Ce,1,b,void 0,G,ge.canonical),te);if(p.flipState=Je&&Je.needsFlipping?1:2,Je)return Je}const he=xn(ae*S.getoffsetX(p.glyphStartIndex),fe,_e,d,L,B,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,P,w,H,X,!1,!1,G,ge);if(!he)return{notEnoughRoom:!0};ve=[he]}for(const he of ve)h.addDynamicAttributes(R,he.point,he.angle);return{}}function Xs(p,i,d,_,b){const w=_.projectTilePoint(p.x,p.y,i);if(!b)return Cr(w,d,w.z);const C=b(p);return Cr(new h.pointGeometry(w.x+C[0],w.y+C[1]),d,w.z+C[2])}function qn(p,i,d,_,b,w,C,S){const P=Xs(p.add(p.sub(i)._unit()),S,b,C,w).point,R=d.sub(P);return d.add(R._mult(_/R.mag()))}function xn(p,i,d,_,b,w,C,S,P,R,L,B,H,te,X,G,ge){const ae=_?p-i:p+i;let fe=ae>0?1:-1,_e=0;_&&(fe*=-1,_e=Math.PI),fe<0&&(_e+=Math.PI);let ve=fe>0?S+C:S+C+1,he=b,Ce=b,Ue=0,We=0;const et=Math.abs(ae),Je=[],Dt=[];let je=w;const yt=()=>{const jt=ve-fe;return 0===Ue?w:new h.pointGeometry(R.getx(jt),R.gety(jt))},xt=()=>qn(yt(),je,Ce,et-Ue+1,L,H,G,ge.canonical);for(;Ue+We<=et;){if(ve+=fe,ve<S||ve>=P)return null;if(Ce=he,Je.push(he),te&&Dt.push(je||yt()),he=B[ve],void 0===he){je=new h.pointGeometry(R.getx(ve),R.gety(ve));const jt=Xs(je,ge.canonical,L,G,H);he=jt.signedDistanceFromCamera>0?B[ve]=jt.point:xt()}else je=null;Ue+=We,We=Ce.dist(he)}X&&H&&(je=je||new h.pointGeometry(R.getx(ve),R.gety(ve)),B[ve]=he=void 0===B[ve]?he:xt(),We=Ce.dist(he));const Ht=(et-Ue)/We,Ke=he.sub(Ce),Kt=Ke.mult(Ht)._add(Ce);d&&Kt._add(Ke._unit()._perp()._mult(d*fe));const Qt=_e+Math.atan2(he.y-Ce.y,he.x-Ce.x);return Je.push(Kt),te&&(je=je||new h.pointGeometry(R.getx(ve),R.gety(ve)),Dt.push(function(jt,qt,an){const En=1-an;return new h.pointGeometry(jt.x*En+qt.x*an,jt.y*En+qt.y*an)}(Dt.length>0?Dt[Dt.length-1]:je,je,Ht))),{point:Kt,angle:Qt,path:Je,tilePath:Dt}}const Po=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wr(p,i){for(let d=0;d<p;d++){const _=i.length;i.resize(_+4),i.float32.set(Po,3*_)}}function Ar(p,i,d){const _=i[0],b=i[1];return p[0]=d[0]*_+d[4]*b+d[12],p[1]=d[1]*_+d[5]*b+d[13],p[3]=d[3]*_+d[7]*b+d[15],p}const gi=100;class ko{constructor(i,d,_=new ls(i.width+200,i.height+200,25),b=new ls(i.width+200,i.height+200,25)){this.transform=i,this.grid=_,this.ignoredGrid=b,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+gi,this.screenBottomBoundary=i.height+gi,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=d}placeCollisionBox(i,d,_,b,w,C,S){let P=d.projectedAnchorX,R=d.projectedAnchorY,L=d.projectedAnchorZ;const B=d.elevation,H=d.tileID;if(B&&H){const ve=this.transform.projection.upVector(H.canonical,d.tileAnchorX,d.tileAnchorY),he=this.transform.projection.upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ve[0]*B*he,R+=ve[1]*B*he,L+=ve[2]*B*he}const te=this.projectAndGetPerspectiveRatio(C,[P,R,L],d.tileID,"globe"===this.transform.projection.name||!!B||this.transform.pitch>0),X=w*te.perspectiveRatio,G=(d.x1*i+_.x-d.padding)*X+te.point.x,ge=(d.y1*i+_.y-d.padding)*X+te.point.y,ae=(d.x2*i+_.x+d.padding)*X+te.point.x,fe=(d.y2*i+_.y+d.padding)*X+te.point.y,_e=te.perspectiveRatio<=.55||te.occluded;return!this.isInsideGrid(G,ge,ae,fe)||!b&&this.grid.hitTest(G,ge,ae,fe,S)||_e?{box:[],offscreen:!1,occluded:te.occluded}:{box:[G,ge,ae,fe],offscreen:this.isOffscreen(G,ge,ae,fe),occluded:!1}}placeCollisionCircles(i,d,_,b,w,C,S,P,R,L,B,H,te,X){const G=[],ge=this.transform.elevation,ae=ge?ge.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,this.transform.projection):xt=>[0,0,0],fe=new h.pointGeometry(d.tileAnchorX,d.tileAnchorY),_e=this.transform.projection.projectTilePoint(d.tileAnchorX,d.tileAnchorY,X.canonical),ve=ae(fe),he=[_e.x+ve[0],_e.y+ve[1],_e.z+ve[2]],Ce=this.projectAndGetPerspectiveRatio(C,[he[0],he[1],he[2]],X,"globe"===this.transform.projection.name||!!ge||this.transform.pitch>0),{perspectiveRatio:Ue}=Ce,We=(L?w/Ue:w*Ue)/h.ONE_EM,et=Cr(new h.pointGeometry(he[0],he[1]),S,he[2]).point,Je=Ce.signedDistanceFromCamera>0?Ws(We,b,d.lineOffsetX*We,d.lineOffsetY*We,!1,et,fe,d,_,S,{},ge&&!L?ae:null,L&&!!ge,this.transform.projection,X):null;let Dt=!1,je=!1,yt=!0;if(Je&&!Ce.occluded){const xt=.5*H*Ue+te,Ht=new h.pointGeometry(-100,-100),Ke=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Kt=new wi,Qt=Je.first,jt=Je.last;let qt=[];for(let en=Qt.path.length-1;en>=1;en--)qt.push(Qt.path[en]);for(let en=1;en<jt.path.length;en++)qt.push(jt.path[en]);const an=2.5*xt;if(P){const en=qt.map(ge?(vn,Yt)=>{const ri=ae(Yt<Qt.path.length-1?Qt.tilePath[Qt.path.length-1-Yt]:jt.tilePath[Yt-Qt.path.length+2]);return Cr(vn,P,ri[2])}:vn=>Cr(vn,P));qt=en.some(vn=>vn.signedDistanceFromCamera<=0)?[]:en.map(vn=>vn.point)}let En=[];if(qt.length>0){const en=qt[0].clone(),vn=qt[0].clone();for(let Yt=1;Yt<qt.length;Yt++)en.x=Math.min(en.x,qt[Yt].x),en.y=Math.min(en.y,qt[Yt].y),vn.x=Math.max(vn.x,qt[Yt].x),vn.y=Math.max(vn.y,qt[Yt].y);En=en.x>=Ht.x&&vn.x<=Ke.x&&en.y>=Ht.y&&vn.y<=Ke.y?[qt]:vn.x<Ht.x||en.x>Ke.x||vn.y<Ht.y||en.y>Ke.y?[]:h.clipLine([qt],Ht.x,Ht.y,Ke.x,Ke.y)}for(const en of En){Kt.reset(en,.25*xt);let vn=0;vn=Kt.length<=.5*xt?1:Math.ceil(Kt.paddedLength/an)+1;for(let Yt=0;Yt<vn;Yt++){const ri=Yt/Math.max(vn-1,1),uo=Kt.lerp(ri),ho=uo.x+gi,Ko=uo.y+gi;G.push(ho,Ko,xt,0);const Ns=ho-xt,wa=Ko-xt,tl=ho+xt,Lo=Ko+xt;if(yt=yt&&this.isOffscreen(Ns,wa,tl,Lo),je=je||this.isInsideGrid(Ns,wa,tl,Lo),!i&&this.grid.hitTestCircle(ho,Ko,xt,B)&&(Dt=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Dt,occluded:!1}}}}return{circles:!R&&Dt||!je?[]:G,offscreen:yt,collisionDetected:Dt,occluded:Ce.occluded}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let _=1/0,b=1/0,w=-1/0,C=-1/0;for(const L of i){const B=new h.pointGeometry(L.x+gi,L.y+gi);_=Math.min(_,B.x),b=Math.min(b,B.y),w=Math.max(w,B.x),C=Math.max(C,B.y),d.push(B)}const S=this.grid.query(_,b,w,C).concat(this.ignoredGrid.query(_,b,w,C)),P={},R={};for(const L of S){const B=L.key;if(void 0===P[B.bucketInstanceId]&&(P[B.bucketInstanceId]={}),P[B.bucketInstanceId][B.featureIndex])continue;const H=[new h.pointGeometry(L.x1,L.y1),new h.pointGeometry(L.x2,L.y1),new h.pointGeometry(L.x2,L.y2),new h.pointGeometry(L.x1,L.y2)];h.polygonIntersectsPolygon(d,H)&&(P[B.bucketInstanceId][B.featureIndex]=!0,void 0===R[B.bucketInstanceId]&&(R[B.bucketInstanceId]=[]),R[B.bucketInstanceId].push(B.featureIndex))}return R}insertCollisionBox(i,d,_,b,w){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:w},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,d,_,b,w){const C=d?this.ignoredGrid:this.grid,S={bucketInstanceId:_,featureIndex:b,collisionGroupID:w};for(let P=0;P<i.length;P+=4)C.insertCircle(S,i[P],i[P+1],i[P+2])}projectAndGetPerspectiveRatio(i,d,_,b){const w=[d[0],d[1],d[2],1];let C=!1;return d[2]||this.transform.pitch>0?(h.transformMat4$1(w,w,i),this.fogState&&_&&(C=function(S,P,R,L,B,H){const te=H.calculateFogTileMatrix(B),X=[P,R,L];return h.transformMat4(X,X,te),it(S,X,H.pitch,H._fov)}(this.fogState,d[0],d[1],d[2],_.toUnwrapped(),this.transform)>.9)):Ar(w,w,i),{point:new h.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+gi,(-w[1]/w[3]+1)/2*this.transform.height+gi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/w[3]*.5,1.5),signedDistanceFromCamera:w[3],occluded:b&&w[2]>w[3]||C}}isOffscreen(i,d,_,b){return _<gi||i>=this.screenRightBoundary||b<gi||d>this.screenBottomBoundary}isInsideGrid(i,d,_,b){return _>=0&&i<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const i=h.identity([]);return h.translate(i,i,[-100,-100,0]),i}}class xr{constructor(i,d,_,b){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?d:-d))):b&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class ii{constructor(i,d,_,b,w,C=!1){this.text=new xr(i?i.text:null,d,_,w),this.icon=new xr(i?i.icon:null,d,b,w),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ho{constructor(i,d,_,b=!1){this.text=i,this.icon=d,this.skipFade=_,this.clipped=b}}class _i{constructor(){this.invProjMatrix=h.create(),this.viewportMatrix=h.create(),this.circles=[]}}class Ri{constructor(i,d,_,b,w){this.bucketInstanceId=i,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=w}}class so{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const d=++this.maxGroupID;this.collisionGroups[i]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[i]}}function Ps(p,i,d,_,b){const{horizontalAlign:w,verticalAlign:C}=h.getAnchorAlignment(p),S=-(w-.5)*i,P=-(C-.5)*d,R=h.evaluateVariableOffset(p,_);return new h.pointGeometry(S+R[0]*b,P+R[1]*b)}function us(p,i,d,_,b){const w=new h.pointGeometry(p,i);return d&&w._rotate(_?b:-b),w}class Na{constructor(i,d,_,b,w){this.transform=i.clone(),this.collisionIndex=new ko(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new so(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,d,_,b){const w=_.getBucket(d),C=_.latestFeatureIndex;if(!w||!C||d.id!==w.layerIds[0])return;const S=w.layers[0].layout,P=_.collisionBoxArray,R=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),L=_.tileSize/h.EXTENT,B=_.tileID.toUnwrapped(),H=this.transform.calculateProjMatrix(B),te="map"===S.get("text-pitch-alignment"),X="map"===S.get("text-rotation-alignment");d.compileFilter();const G=d.dynamicFilter(),ge=d.dynamicFilterNeedsFeature(),ae=this.transform.calculatePixelsToTileUnitsMatrix(_),fe=gn(H,_.tileID.canonical,te,X,this.transform,ae);let _e=null;if(te){const Ce=cs(H,_.tileID.canonical,te,X,this.transform,ae);_e=h.multiply$1([],this.transform.labelPlaneMatrix,Ce)}let ve=null;G&&_.latestFeatureIndex&&(ve={unwrappedTileID:B,dynamicFilter:G,dynamicFilterNeedsFeature:ge,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new Ri(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,_.tileID);const he={bucket:w,layout:S,posMatrix:H,textLabelPlaneMatrix:fe,labelToScreenMatrix:_e,clippingData:ve,scale:R,textPixelRatio:L,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:h.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(b)for(const Ce of w.sortKeyRanges){const{sortKey:Ue,symbolInstanceStart:We,symbolInstanceEnd:et}=Ce;i.push({sortKey:Ue,symbolInstanceStart:We,symbolInstanceEnd:et,parameters:he})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:he})}attemptAnchorPlacement(i,d,_,b,w,C,S,P,R,L,B,H,te,X,G,ge,ae,fe){const _e=[H.textOffset0,H.textOffset1],ve=Ps(i,_,b,_e,w),he=this.collisionIndex.placeCollisionBox(w,d,us(ve.x,ve.y,C,S,this.transform.angle),B,P,R,L.predicate);if((!ge||0!==this.collisionIndex.placeCollisionBox(X.getSymbolInstanceIconSize(fe,this.transform.zoom,te),ge,us(ve.x,ve.y,C,S,this.transform.angle),B,P,R,L.predicate).box.length)&&he.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[H.crossTileID].anchor),this.variableOffsets[H.crossTileID]={textOffset:_e,width:_,height:b,anchor:i,textScale:w,prevAnchor:Ce},this.markUsedJustification(X,i,H,G),X.allowVerticalPlacement&&(this.markUsedOrientation(X,G,H),this.placedOrientations[H.crossTileID]=G),{shift:ve,placedGlyphBoxes:he}}}placeLayerBucketPart(i,d,_,b){const{bucket:w,layout:C,posMatrix:S,textLabelPlaneMatrix:P,labelToScreenMatrix:R,clippingData:L,textPixelRatio:B,holdingForFade:H,collisionBoxArray:te,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:G,collisionGroup:ge}=i.parameters,ae=C.get("text-optional"),fe=C.get("icon-optional"),_e=C.get("text-allow-overlap"),ve=C.get("icon-allow-overlap"),he="map"===C.get("text-rotation-alignment"),Ce="map"===C.get("text-pitch-alignment"),Ue="none"!==C.get("icon-text-fit"),We="viewport-y"===C.get("symbol-z-order");let et=_e&&(ve||!w.hasIconData()||fe),Je=ve&&(_e||!w.hasTextData()||ae);!w.collisionArrays&&te&&w.deserializeCollisionBoxes(te),_&&b&&w.updateCollisionDebugBuffers(this.transform.zoom,te);const Dt=(je,yt,xt)=>{if(L){const oi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Zn=null;if(L.dynamicFilterNeedsFeature){const sr=this.retainedQueryData[w.bucketInstanceId];Zn=L.featureIndex.loadFeature({featureIndex:je.featureIndex,bucketIndex:sr.bucketIndex,sourceLayerIndex:sr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(oi,Zn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new h.pointGeometry(je.tileAnchorX,je.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[je.crossTileID]=new Ho(!1,!1,!1,!0),void(d[je.crossTileID]=!0)}if(d[je.crossTileID])return;if(H)return void(this.placements[je.crossTileID]=new Ho(!1,!1,!1));let Ht=!1,Ke=!1,Kt=!0,Qt=!1,jt=!1,qt=null,an={box:null,offscreen:null,occluded:null},En={box:null,offscreen:null,occluded:null},en=null,vn=null,Yt=null,ri=0,uo=0,ho=0;xt.textFeatureIndex?ri=xt.textFeatureIndex:je.useRuntimeCollisionCircles&&(ri=je.featureIndex),xt.verticalTextFeatureIndex&&(uo=xt.verticalTextFeatureIndex);const Ko=oi=>{oi.tileID=this.retainedQueryData[w.bucketInstanceId].tileID,(this.transform.elevation||oi.elevation)&&(oi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[w.bucketInstanceId].tileID,oi.tileAnchorX,oi.tileAnchorY):0)},Ns=xt.textBox;if(Ns){Ko(Ns);const oi=sr=>{let Kr=h.WritingMode.horizontal;if(w.allowVerticalPlacement&&!sr&&this.prevPlacement){const Yo=this.prevPlacement.placedOrientations[je.crossTileID];Yo&&(this.placedOrientations[je.crossTileID]=Yo,Kr=Yo,this.markUsedOrientation(w,Kr,je))}return Kr},Zn=(sr,Kr)=>{if(w.allowVerticalPlacement&&je.numVerticalGlyphVertices>0&&xt.verticalTextBox){for(const Yo of w.writingModes)if(Yo===h.WritingMode.vertical?(an=Kr(),En=an):an=sr(),an&&an.box&&an.box.length)break}else an=sr()};if(C.get("text-variable-anchor")){let sr=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[je.crossTileID]){const Yr=this.prevPlacement.variableOffsets[je.crossTileID];sr.indexOf(Yr.anchor)>0&&(sr=sr.filter(si=>si!==Yr.anchor),sr.unshift(Yr.anchor))}const Kr=(Yr,si,wo)=>{const Eo=w.getSymbolInstanceTextSize(X,je,this.transform.zoom,yt),Bs=(Yr.x2-Yr.x1)*Eo+2*Yr.padding,Ml=(Yr.y2-Yr.y1)*Eo+2*Yr.padding,lu=Ue&&!ve?si:null;lu&&Ko(lu);let Al={box:[],offscreen:!1,occluded:!1};const Vf=_e?2*sr.length:sr.length;for(let nl=0;nl<Vf;++nl){const Sd=this.attemptAnchorPlacement(sr[nl%sr.length],Yr,Bs,Ml,Eo,he,Ce,B,S,ge,nl>=sr.length,je,yt,w,wo,lu,X,G);if(Sd&&(Al=Sd.placedGlyphBoxes,Al&&Al.box&&Al.box.length)){Ht=!0,qt=Sd.shift;break}}return Al};Zn(()=>Kr(Ns,xt.iconBox,h.WritingMode.horizontal),()=>{const Yr=xt.verticalTextBox;return Yr&&Ko(Yr),w.allowVerticalPlacement&&!(an&&an.box&&an.box.length)&&je.numVerticalGlyphVertices>0&&Yr?Kr(Yr,xt.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),an&&(Ht=an.box,Kt=an.offscreen,Qt=an.occluded);const Yo=oi(an&&an.box);if(!Ht&&this.prevPlacement){const Yr=this.prevPlacement.variableOffsets[je.crossTileID];Yr&&(this.variableOffsets[je.crossTileID]=Yr,this.markUsedJustification(w,Yr.anchor,je,Yo))}}else{const sr=(Kr,Yo)=>{const Yr=w.getSymbolInstanceTextSize(X,je,this.transform.zoom,yt),si=this.collisionIndex.placeCollisionBox(Yr,Kr,new h.pointGeometry(0,0),_e,B,S,ge.predicate);return si&&si.box&&si.box.length&&(this.markUsedOrientation(w,Yo,je),this.placedOrientations[je.crossTileID]=Yo),si};Zn(()=>sr(Ns,h.WritingMode.horizontal),()=>{const Kr=xt.verticalTextBox;return w.allowVerticalPlacement&&je.numVerticalGlyphVertices>0&&Kr?(Ko(Kr),sr(Kr,h.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),oi(an&&an.box&&an.box.length)}}if(en=an,Ht=en&&en.box&&en.box.length>0,Kt=en&&en.offscreen,Qt=en&&en.occluded,je.useRuntimeCollisionCircles){const oi=w.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex>=0?je.centerJustifiedTextSymbolIndex:je.verticalPlacedTextSymbolIndex),Zn=h.evaluateSizeForFeature(w.textSizeData,X,oi),sr=C.get("text-padding");vn=this.collisionIndex.placeCollisionCircles(_e,oi,w.lineVertexArray,w.glyphOffsetArray,Zn,S,P,R,_,Ce,ge.predicate,je.collisionCircleDiameter*Zn/h.ONE_EM,sr,this.retainedQueryData[w.bucketInstanceId].tileID),Ht=_e||vn.circles.length>0&&!vn.collisionDetected,Kt=Kt&&vn.offscreen,Qt=vn.occluded}if(xt.iconFeatureIndex&&(ho=xt.iconFeatureIndex),xt.iconBox){const oi=Zn=>{Ko(Zn);const sr=Ue&&qt?us(qt.x,qt.y,he,Ce,this.transform.angle):new h.pointGeometry(0,0),Kr=w.getSymbolInstanceIconSize(G,this.transform.zoom,yt);return this.collisionIndex.placeCollisionBox(Kr,Zn,sr,ve,B,S,ge.predicate)};En&&En.box&&En.box.length&&xt.verticalIconBox?(Yt=oi(xt.verticalIconBox),Ke=Yt.box.length>0):(Yt=oi(xt.iconBox),Ke=Yt.box.length>0),Kt=Kt&&Yt.offscreen,jt=Yt.occluded}const wa=ae||0===je.numHorizontalGlyphVertices&&0===je.numVerticalGlyphVertices,tl=fe||0===je.numIconVertices;if(wa||tl?tl?wa||(Ke=Ke&&Ht):Ht=Ke&&Ht:Ke=Ht=Ke&&Ht,Ht&&en&&en.box&&this.collisionIndex.insertCollisionBox(en.box,C.get("text-ignore-placement"),w.bucketInstanceId,En&&En.box&&uo?uo:ri,ge.ID),Ke&&Yt&&this.collisionIndex.insertCollisionBox(Yt.box,C.get("icon-ignore-placement"),w.bucketInstanceId,ho,ge.ID),vn&&(Ht&&this.collisionIndex.insertCollisionCircles(vn.circles,C.get("text-ignore-placement"),w.bucketInstanceId,ri,ge.ID),_)){const oi=w.bucketInstanceId;let Zn=this.collisionCircleArrays[oi];void 0===Zn&&(Zn=this.collisionCircleArrays[oi]=new _i);for(let sr=0;sr<vn.circles.length;sr+=4)Zn.circles.push(vn.circles[sr+0]),Zn.circles.push(vn.circles[sr+1]),Zn.circles.push(vn.circles[sr+2]),Zn.circles.push(vn.collisionDetected?1:0)}const Lo="globe"!==this.transform.projection.name;et=et&&(Lo||!Qt),Je=Je&&(Lo||!jt),this.placements[je.crossTileID]=new Ho(Ht||et,Ke||Je,Kt||w.justReloaded),d[je.crossTileID]=!0};if(We){const je=w.getSortedSymbolIndexes(this.transform.angle);for(let yt=je.length-1;yt>=0;--yt){const xt=je[yt];Dt(w.symbolInstances.get(xt),xt,w.collisionArrays[xt])}}else for(let je=i.symbolInstanceStart;je<i.symbolInstanceEnd;je++)Dt(w.symbolInstances.get(je),je,w.collisionArrays[je]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[w.bucketInstanceId];h.invert(je.invProjMatrix,S),je.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(i,d,_,b){let w;w=b===h.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[h.getAnchorJustification(d)];const C=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const S of C)S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=w>=0&&S!==w?0:_.crossTileID)}markUsedOrientation(i,d,_){const b=d===h.WritingMode.horizontal||d===h.WritingMode.horizontalOnly?d:0,w=d===h.WritingMode.vertical?d:0,C=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const S of C)i.text.placedSymbolArray.get(S).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(i):1,w=d?d.opacities:{},C=d?d.variableOffsets:{},S=d?d.placedOrientations:{};for(const P in this.placements){const R=this.placements[P],L=w[P];L?(this.opacities[P]=new ii(L,b,R.text,R.icon,null,R.clipped),_=_||R.text!==L.text.placed||R.icon!==L.icon.placed):(this.opacities[P]=new ii(null,b,R.text,R.icon,R.skipFade,R.clipped),_=_||R.text||R.icon)}for(const P in w){const R=w[P];if(!this.opacities[P]){const L=new ii(R,b,!1,!1);L.isHidden()||(this.opacities[P]=L,_=_||R.text.placed||R.icon.placed)}}for(const P in C)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=C[P]);for(const P in S)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=S[P]);_?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:i)}updateLayerOpacities(i,d){const _={};for(const b of d){const w=b.getBucket(i);w&&b.latestFeatureIndex&&i.id===w.layerIds[0]&&this.updateBucketOpacities(w,_,b.collisionBoxArray)}}updateBucketOpacities(i,d,_){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const b=i.layers[0].layout,w=!!i.layers[0].dynamicFilter(),C=new ii(null,0,!1,!1,!0),S=b.get("text-allow-overlap"),P=b.get("icon-allow-overlap"),R=b.get("text-variable-anchor"),L="map"===b.get("text-rotation-alignment"),B="map"===b.get("text-pitch-alignment"),H="none"!==b.get("icon-text-fit"),te=new ii(null,0,S&&(P||!i.hasIconData()||b.get("icon-optional")),P&&(S||!i.hasTextData()||b.get("text-optional")),!0);!i.collisionArrays&&_&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(_);const X=(ge,ae,fe)=>{for(let _e=0;_e<ae/4;_e++)ge.opacityVertexArray.emplaceBack(fe)};let G=0;for(let ge=0;ge<i.symbolInstances.length;ge++){const ae=i.symbolInstances.get(ge),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:_e,crossTileID:ve}=ae;let he=this.opacities[ve];d[ve]?he=C:he||(he=te,this.opacities[ve]=he),d[ve]=!0;const Ce=fe>0||_e>0,Ue=ae.numIconVertices>0,We=this.placedOrientations[ae.crossTileID],et=We===h.WritingMode.vertical,Je=We===h.WritingMode.horizontal||We===h.WritingMode.horizontalOnly;if(!Ce&&!Ue||he.isHidden()||G++,Ce){const Dt=Xr(he.text);X(i.text,fe,et?gr:Dt),X(i.text,_e,Je?gr:Dt);const je=he.text.isHidden();[ae.rightJustifiedTextSymbolIndex,ae.centerJustifiedTextSymbolIndex,ae.leftJustifiedTextSymbolIndex].forEach(Ht=>{Ht>=0&&(i.text.placedSymbolArray.get(Ht).hidden=je||et?1:0)}),ae.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(ae.verticalPlacedTextSymbolIndex).hidden=je||Je?1:0);const yt=this.variableOffsets[ae.crossTileID];yt&&this.markUsedJustification(i,yt.anchor,ae,We);const xt=this.placedOrientations[ae.crossTileID];xt&&(this.markUsedJustification(i,"left",ae,xt),this.markUsedOrientation(i,xt,ae))}if(Ue){const Dt=Xr(he.icon);ae.placedIconSymbolIndex>=0&&(X(i.icon,ae.numIconVertices,et?gr:Dt),i.icon.placedSymbolArray.get(ae.placedIconSymbolIndex).hidden=he.icon.isHidden()),ae.verticalPlacedIconSymbolIndex>=0&&(X(i.icon,ae.numVerticalIconVertices,Je?gr:Dt),i.icon.placedSymbolArray.get(ae.verticalPlacedIconSymbolIndex).hidden=he.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Dt=i.collisionArrays[ge];if(Dt){let je=new h.pointGeometry(0,0),yt=!0;if(Dt.textBox||Dt.verticalTextBox){if(R){const Ht=this.variableOffsets[ve];Ht?(je=Ps(Ht.anchor,Ht.width,Ht.height,Ht.textOffset,Ht.textScale),L&&je._rotate(B?this.transform.angle:-this.transform.angle)):yt=!1}w&&(yt=!he.clipped),Dt.textBox&&Fn(i.textCollisionBox.collisionVertexArray,he.text.placed,!yt||et,je.x,je.y),Dt.verticalTextBox&&Fn(i.textCollisionBox.collisionVertexArray,he.text.placed,!yt||Je,je.x,je.y)}const xt=yt&&Boolean(!Je&&Dt.verticalIconBox);Dt.iconBox&&Fn(i.iconCollisionBox.collisionVertexArray,he.icon.placed,xt,H?je.x:0,H?je.y:0),Dt.verticalIconBox&&Fn(i.iconCollisionBox.collisionVertexArray,he.icon.placed,!xt,H?je.x:0,H?je.y:0)}}}if(i.fullyClipped=0===G,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ge.invProjMatrix,i.placementViewportMatrix=ge.viewportMatrix,i.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>i}setStale(){this.stale=!0}}function Fn(p,i,d,_,b){p.emplaceBack(i?1:0,d?1:0,_||0,b||0),p.emplaceBack(i?1:0,d?1:0,_||0,b||0),p.emplaceBack(i?1:0,d?1:0,_||0,b||0),p.emplaceBack(i?1:0,d?1:0,_||0,b||0)}const Yl=Math.pow(2,25),Jl=Math.pow(2,24),Se=Math.pow(2,17),Ze=Math.pow(2,16),_t=Math.pow(2,9),An=Math.pow(2,8),Xn=Math.pow(2,1);function Xr(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const i=p.placed?1:0,d=Math.floor(127*p.opacity);return d*Yl+i*Jl+d*Se+i*Ze+d*_t+i*An+d*Xn+i}const gr=0;class wr{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,d,_,b,w){const C=this._bucketParts;for(;this._currentTileIndex<i.length;)if(d.getBucketParts(C,b,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((S,P)=>S.sortKey-P.sortKey));this._currentPartIndex<C.length;){const S=C[this._currentPartIndex];if(d.placeLayerBucketPart(S,this._seenCrossTileIDs,_,0===S.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class yo{constructor(i,d,_,b,w,C,S,P){this.placement=new Na(i,w,C,S,P),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(i,d,_){const b=h.exported.now(),w=()=>{const C=h.exported.now()-b;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=d[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===C.type&&(!C.minzoom||C.minzoom<=S)&&(!C.maxzoom||C.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new wr(C)),this._inProgressLayer.continuePlacement(_[C.source],this.placement,this._showCollisionBoxes,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Sr=512/h.EXTENT/2;class xl{constructor(i,d,_){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let b=0;b<d.length;b++){const w=d.get(b),C=w.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,i)})}}getScaledCoordinates(i,d){const _=Sr/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*h.EXTENT+i.tileAnchorX)*_),y:Math.floor((d.canonical.y*h.EXTENT+i.tileAnchorY)*_)}}findMatches(i,d,_){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let w=0;w<i.length;w++){const C=i.get(w);if(C.crossTileID)continue;const S=this.indexedSymbolInstances[C.key];if(!S)continue;const P=this.getScaledCoordinates(C,d);for(const R of S)if(Math.abs(R.coord.x-P.x)<=b&&Math.abs(R.coord.y-P.y)<=b&&!_[R.crossTileID]){_[R.crossTileID]=!0,C.crossTileID=R.crossTileID;break}}}}class li{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const d=Math.round((i-this.lng)/360);if(0!==d)for(const _ in this.indexes){const b=this.indexes[_],w={};for(const C in b){const S=b[C];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+d),w[S.tileID.key]=S}this.indexes[_]=w}this.lng=i}addBucket(i,d,_){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<d.symbolInstances.length;w++)d.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const b=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const C=this.indexes[w];if(Number(w)>i.overscaledZ)for(const S in C){const P=C[S];P.tileID.isChildOf(i)&&P.findMatches(d.symbolInstances,i,b)}else{const S=C[i.scaledTo(Number(w)).key];S&&S.findMatches(d.symbolInstances,i,b)}}for(let w=0;w<d.symbolInstances.length;w++){const C=d.symbolInstances.get(w);C.crossTileID||(C.crossTileID=_.generate(),b[C.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new xl(i,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(i,d){for(const _ in d.indexedSymbolInstances)for(const b of d.indexedSymbolInstances[_])delete this.usedCrossTileIDs[i][b.crossTileID]}removeStaleBuckets(i){let d=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const w in b)i[b[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[w]),delete b[w],d=!0)}return d}}class ks{constructor(){this.layerIndexes={},this.crossTileIDs=new li,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,d,_,b){let w=this.layerIndexes[i.id];void 0===w&&(w=this.layerIndexes[i.id]=new bl);let C=!1;const S={};"globe"!==b.name&&w.handleWrapJump(_);for(const P of d){const R=P.getBucket(i);R&&i.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(P.tileID,R,this.crossTileIDs)&&(C=!0),S[R.bucketInstanceId]=!0)}return w.removeStaleBuckets(S)&&(C=!0),C}pruneUnusedLayers(i){const d={};i.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const ci=(p,i)=>h.emitValidationErrors(p,i&&i.filter(d=>"source.canvas"!==d.identifier)),Rs=h.pick(Gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),qo=h.pick(Gt,["setCenter","setZoom","setBearing","setPitch"]),ti={version:8,layers:[],sources:{}},Br={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class _r extends h.Evented{constructor(i,d={}){super(),this.map=i,this.dispatcher=new un(nn(),this),this.imageManager=new rt,this.imageManager.setEventedParent(this),this.glyphManager=new h.GlyphManager(i._requestManager,d.localFontFamily?h.LocalGlyphMode.all:d.localIdeographFontFamily?h.LocalGlyphMode.ideographs:h.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.lineAtlas=new h.LineAtlas(256,512),this.crossTileSymbolIndex=new ks,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new h.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const _=this;this._rtlTextPluginCallback=_r.registerForPluginStateChange(b=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(w,C)=>{if(h.triggerPluginCompletionEvent(w),C&&C.every(S=>S))for(const S in _._sourceCaches){const P=_._sourceCaches[S],R=P.getSource().type;"vector"!==R&&"geojson"!==R||P.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const w=this.getSource(b.sourceId);if(w&&w.vectorLayerIds)for(const C in this._layers){const S=this._layers[C];S.source===w.id&&this._validateLayer(S)}})}loadURL(i,d={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof d.validate?d.validate:!h.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,d.accessToken);const b=this.map._requestManager.transformRequest(i,h.ResourceType.Style);this._request=h.getJSON(b,(w,C)=>{this._request=null,w?this.fire(new h.ErrorEvent(w)):C&&this._load(C,_)})}loadJSON(i,d={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(i,!1!==d.validate)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(ti,!1)}_updateLayerCount(i,d){const _=d?1:-1;i.is3D()&&(this._num3DLayers+=_),"circle"===i.type&&(this._numCircleLayers+=_),"symbol"===i.type&&(this._numSymbolLayers+=_)}_load(i,d){if(d&&ci(this,h.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i,this._updateMapProjection();for(const b in i.sources)this.addSource(b,i.sources[b],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const _=tr(this.stylesheet.layers);this._order=_.map(b=>b.id),this._layers={},this._serializedLayers={};for(let b of _)b=h.createStyleLayer(b),b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new gt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(i){this._spriteRequest=function(d,_,b){let w,C,S;const P=h.exported.devicePixelRatio>1?"@2x":"";let R=h.getJSON(_.transformRequest(_.normalizeSpriteURL(d,P,".json"),h.ResourceType.SpriteJSON),(H,te)=>{R=null,S||(S=H,w=te,B())}),L=h.getImage(_.transformRequest(_.normalizeSpriteURL(d,P,".png"),h.ResourceType.SpriteImage),(H,te)=>{L=null,S||(S=H,C=te,B())});function B(){if(S)b(S);else if(w&&C){const H=h.exported.getImageData(C),te={};for(const X in w){const{width:G,height:ge,x:ae,y:fe,sdf:_e,pixelRatio:ve,stretchX:he,stretchY:Ce,content:Ue}=w[X],We=new h.RGBAImage({width:G,height:ge});h.RGBAImage.copy(H,We,{x:ae,y:fe},{x:0,y:0},{width:G,height:ge}),te[X]={data:We,pixelRatio:ve,sdf:_e,stretchX:he,stretchY:Ce,content:Ue}}b(null,te)}}return{cancel(){R&&(R.cancel(),R=null),L&&(L.cancel(),L=null)}}}(i,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new h.ErrorEvent(d));else if(_)for(const b in _)this.imageManager.addImage(b,_[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(i){const d=this.getSource(i.source);if(!d)return;const _=i.sourceLayer;_&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(_))&&this.fire(new h.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const d=[];for(const _ of i){const b=this._layers[_];"custom"!==b.type&&d.push(b.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&Br[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const d=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(b.length||w.length)&&this._updateWorkerLayers(b,w);for(const C in this._updatedSources){const S=this._updatedSources[C];"reload"===S?this._reloadSource(C):"clear"===S&&this._clearSource(C)}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const _={};for(const b in this._sourceCaches){const w=this._sourceCaches[b];_[b]=w.used,w.used=!1}for(const b of this._order){const w=this._layers[b];if(w.recalculate(i,this._availableImages),!w.isHidden(i.zoom)){const S=this._getLayerSourceCache(w);S&&(S.used=!0)}const C=this.map.painter;if(C){const S=w.getProgramIds();if(!S)continue;const P=w.getProgramConfiguration(i.zoom);for(const R of S)C.useProgram(R,P)}}for(const b in _){const w=this._sourceCaches[b];_[b]!==w.used&&w.getSource().fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),ci(this,h.validateStyle(i)))return!1;(i=h.clone$1(i)).layers=tr(i.layers);const d=function(b,w){if(!b)return[{command:Gt.setStyle,args:[w]}];let C=[];try{if(!$(b.version,w.version))return[{command:Gt.setStyle,args:[w]}];$(b.center,w.center)||C.push({command:Gt.setCenter,args:[w.center]}),$(b.zoom,w.zoom)||C.push({command:Gt.setZoom,args:[w.zoom]}),$(b.bearing,w.bearing)||C.push({command:Gt.setBearing,args:[w.bearing]}),$(b.pitch,w.pitch)||C.push({command:Gt.setPitch,args:[w.pitch]}),$(b.sprite,w.sprite)||C.push({command:Gt.setSprite,args:[w.sprite]}),$(b.glyphs,w.glyphs)||C.push({command:Gt.setGlyphs,args:[w.glyphs]}),$(b.transition,w.transition)||C.push({command:Gt.setTransition,args:[w.transition]}),$(b.light,w.light)||C.push({command:Gt.setLight,args:[w.light]}),$(b.fog,w.fog)||C.push({command:Gt.setFog,args:[w.fog]}),$(b.projection,w.projection)||C.push({command:Gt.setProjection,args:[w.projection]});const S={},P=[];!function(B,H,te,X){let G;for(G in H=H||{},B=B||{})B.hasOwnProperty(G)&&(H.hasOwnProperty(G)||Ln(G,te,X));for(G in H)H.hasOwnProperty(G)&&(B.hasOwnProperty(G)?$(B[G],H[G])||("geojson"===B[G].type&&"geojson"===H[G].type&&Ao(B,H,G)?te.push({command:Gt.setGeoJSONSourceData,args:[G,H[G].data]}):as(G,H,te,X)):Wn(G,H,te))}(b.sources,w.sources,P,S);const R=[];b.layers&&b.layers.forEach(B=>{B.source&&S[B.source]?C.push({command:Gt.removeLayer,args:[B.id]}):R.push(B)});let L=b.terrain;L&&S[L.source]&&(C.push({command:Gt.setTerrain,args:[void 0]}),L=void 0),C=C.concat(P),$(L,w.terrain)||C.push({command:Gt.setTerrain,args:[w.terrain]}),function(B,H,te){H=H||[];const X=(B=B||[]).map(pn),G=H.map(pn),ge=B.reduce(tn,{}),ae=H.reduce(tn,{}),fe=X.slice(),_e=Object.create(null);let ve,he,Ce,Ue,We,et,Je;for(ve=0,he=0;ve<X.length;ve++)Ce=X[ve],ae.hasOwnProperty(Ce)?he++:(te.push({command:Gt.removeLayer,args:[Ce]}),fe.splice(fe.indexOf(Ce,he),1));for(ve=0,he=0;ve<G.length;ve++)Ce=G[G.length-1-ve],fe[fe.length-1-ve]!==Ce&&(ge.hasOwnProperty(Ce)?(te.push({command:Gt.removeLayer,args:[Ce]}),fe.splice(fe.lastIndexOf(Ce,fe.length-he),1)):he++,et=fe[fe.length-ve],te.push({command:Gt.addLayer,args:[ae[Ce],et]}),fe.splice(fe.length-ve,0,Ce),_e[Ce]=!0);for(ve=0;ve<G.length;ve++)if(Ce=G[ve],Ue=ge[Ce],We=ae[Ce],!_e[Ce]&&!$(Ue,We))if($(Ue.source,We.source)&&$(Ue["source-layer"],We["source-layer"])&&$(Ue.type,We.type)){for(Je in Mt(Ue.layout,We.layout,te,Ce,null,Gt.setLayoutProperty),Mt(Ue.paint,We.paint,te,Ce,null,Gt.setPaintProperty),$(Ue.filter,We.filter)||te.push({command:Gt.setFilter,args:[Ce,We.filter]}),$(Ue.minzoom,We.minzoom)&&$(Ue.maxzoom,We.maxzoom)||te.push({command:Gt.setLayerZoomRange,args:[Ce,We.minzoom,We.maxzoom]}),Ue)Ue.hasOwnProperty(Je)&&"layout"!==Je&&"paint"!==Je&&"filter"!==Je&&"metadata"!==Je&&"minzoom"!==Je&&"maxzoom"!==Je&&(0===Je.indexOf("paint.")?Mt(Ue[Je],We[Je],te,Ce,Je.slice(6),Gt.setPaintProperty):$(Ue[Je],We[Je])||te.push({command:Gt.setLayerProperty,args:[Ce,Je,We[Je]]}));for(Je in We)We.hasOwnProperty(Je)&&!Ue.hasOwnProperty(Je)&&"layout"!==Je&&"paint"!==Je&&"filter"!==Je&&"metadata"!==Je&&"minzoom"!==Je&&"maxzoom"!==Je&&(0===Je.indexOf("paint.")?Mt(Ue[Je],We[Je],te,Ce,Je.slice(6),Gt.setPaintProperty):$(Ue[Je],We[Je])||te.push({command:Gt.setLayerProperty,args:[Ce,Je,We[Je]]}))}else te.push({command:Gt.removeLayer,args:[Ce]}),et=fe[fe.lastIndexOf(Ce)+1],te.push({command:Gt.addLayer,args:[We,et]})}(R,w.layers,C)}catch(S){console.warn("Unable to compute style diff:",S),C=[{command:Gt.setStyle,args:[w]}]}return C}(this.serialize(),i).filter(b=>!(b.command in qo));if(0===d.length)return!1;const _=d.filter(b=>!(b.command in Rs));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{"setTransition"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,d){return this.getImage(i)?this.fire(new h.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,d),this._afterImageUpdated(i),this)}updateImage(i,d){this.imageManager.updateImage(i,d)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new h.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,d,_={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(h.validateSource,`sources.${i}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=Oe(i,d,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:b.serialize(),sourceId:i}));const w=C=>{const S=(C?"symbol:":"other:")+i,P=this._sourceCaches[S]=new h.SourceCache(S,b,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[i]=P,P.style=this,P.onAdd(this.map)};w(!1),"vector"!==d.type&&"geojson"!==d.type||w(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const d=this.getSource(i);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===i)return this.fire(new h.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new h.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(i);for(const b of _)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,d){this._checkLoaded(),this.getSource(i).setData(d),this._changed=!0}getSource(i){const d=this._getSourceCache(i);return d&&d.getSource()}addLayer(i,d,_={}){this._checkLoaded();const b=i.id;if(this.getLayer(b))return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let w;if("custom"===i.type){if(ci(this,h.validateCustomStyleLayer(i)))return;w=h.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(b,i.source),i=h.clone$1(i),i=h.extend(i,{source:b})),this._validate(h.validateLayer,`layers.${b}`,i,{arrayIndex:-1},_))return;w=h.createStyleLayer(i),this._validateLayer(w),w.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const C=d?this._order.indexOf(d):this._order.length;if(d&&-1===C)return void this.fire(new h.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(C,0,b),this._layerOrderChanged=!0,this._layers[b]=w;const S=this._getLayerSourceCache(w);if(this._removedLayers[b]&&w.source&&S&&"custom"!==w.type){const P=this._removedLayers[b];delete this._removedLayers[b],P.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",S.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,d){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===d)return;const _=this._order.indexOf(i);this._order.splice(_,1);const b=d?this._order.indexOf(d):this._order.length;d&&-1===b?this.fire(new h.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(b,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const d=this._layers[i];if(!d)return void this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const _=this._order.indexOf(i);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=d,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const d in this._layers)if(this._layers[d].type===i)return!0;return!1}setLayerZoomRange(i,d,_){this._checkLoaded();const b=this.getLayer(i);b?b.minzoom===d&&b.maxzoom===_||(null!=d&&(b.minzoom=d),null!=_&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,d,_={}){this._checkLoaded();const b=this.getLayer(i);if(b){if(!$(b.filter,d))return null==d?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(h.validateFilter,`layers.${b.id}.filter`,d,{layerType:b.type},_)||(b.filter=h.clone$1(d),this._updateLayer(b)))}else this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const d=this.getLayer(i);return d&&h.clone$1(d.filter)}setLayoutProperty(i,d,_,b={}){this._checkLoaded();const w=this.getLayer(i);w?$(w.getLayoutProperty(d),_)||(w.setLayoutProperty(d,_,b),this._updateLayer(w)):this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,d){const _=this.getLayer(i);if(_)return _.getLayoutProperty(d);this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,d,_,b={}){this._checkLoaded();const w=this.getLayer(i);w?$(w.getPaintProperty(d),_)||(w.setPaintProperty(d,_,b)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new h.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,d){const _=this.getLayer(i);return _&&_.getPaintProperty(d)}setFeatureState(i,d){this._checkLoaded();const _=i.source,b=i.sourceLayer,w=this.getSource(_);if(!w)return void this.fire(new h.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=w.type;if("geojson"===C&&b)return void this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===C&&!b)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(_);for(const P of S)P.setFeatureState(b,i.id,d)}removeFeatureState(i,d){this._checkLoaded();const _=i.source,b=this.getSource(_);if(!b)return void this.fire(new h.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const w=b.type,C="vector"===w?i.sourceLayer:void 0;if("vector"===w&&!C)return void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(_);for(const P of S)P.removeFeatureState(C,i.id,d)}getFeatureState(i){this._checkLoaded();const d=i.source,_=i.sourceLayer,b=this.getSource(d);if(b){if("vector"!==b.type||_)return void 0===i.id&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(_,i.id);this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new h.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const d in this._sourceCaches){const _=this._sourceCaches[d].getSource();i[_.id]||(i[_.id]=_.serialize())}return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(i){this._updatedLayers[i.id]=!0;const d=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[i.source]="reload",d.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const d=C=>"fill-extrusion"===this._layers[C].type,_={},b=[];for(let C=this._order.length-1;C>=0;C--){const S=this._order[C];if(d(S)){_[S]=C;for(const P of i){const R=P[S];if(R)for(const L of R)b.push(L)}}}b.sort((C,S)=>S.intersectionZ-C.intersectionZ);const w=[];for(let C=this._order.length-1;C>=0;C--){const S=this._order[C];if(d(S))for(let P=b.length-1;P>=0;P--){const R=b[P].feature;if(_[R.layer.id]<C)break;w.push(R),b.pop()}else for(const P of i){const R=P[S];if(R)for(const L of R)w.push(L.feature)}}return w}queryRenderedFeatures(i,d,_){d&&d.filter&&this._validate(h.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of d.layers){const R=this._layers[P];if(!R)return this.fire(new h.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];b[R.source]=!0}}const w=[];d.availableImages=this._availableImages;const C=d&&d.layers?d.layers.some(P=>{const R=this.getLayer(P);return R&&R.is3D()}):this.has3DLayers(),S=ir.createFromScreenPoints(i,_);for(const P in this._sourceCaches){const R=this._sourceCaches[P].getSource().id;d.layers&&!b[R]||w.push(Ve(this._sourceCaches[P],this._layers,this._serializedLayers,S,d,_,C,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(P,R,L,B,H,te,X){const G={},ge=te.queryRenderedSymbols(B),ae=[];for(const fe of Object.keys(ge).map(Number))ae.push(X[fe]);ae.sort(It);for(const fe of ae){const _e=fe.featureIndex.lookupSymbolFeatures(ge[fe.bucketInstanceId],R,fe.bucketIndex,fe.sourceLayerIndex,H.filter,H.layers,H.availableImages,P);for(const ve in _e){const he=G[ve]=G[ve]||[],Ce=_e[ve];Ce.sort((Ue,We)=>{const et=fe.featureSortOrder;if(et){const Je=et.indexOf(Ue.featureIndex);return et.indexOf(We.featureIndex)-Je}return We.featureIndex-Ue.featureIndex});for(const Ue of Ce)he.push(Ue)}}for(const fe in G)G[fe].forEach(_e=>{const ve=_e.feature,he=L(P[fe]).getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=he});return G}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(i,d){d&&d.filter&&this._validate(h.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const _=this._getSourceCaches(i);let b=[];for(const w of _)b=b.concat(st(w,d));return b}addSourceType(i,d,_){return _r.getSourceType(i)?_(new Error(`A source type called "${i}" already exists.`)):(_r.setSourceType(i,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(i,d={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const C in i)if(!$(i[C],_[C])){b=!0;break}if(!b)return;const w={now:h.exported.now(),transition:h.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,d),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,d=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===d){if("object"==typeof i.source){const _="terrain-dem-src";this.addSource(_,i.source),i=h.clone$1(i),i=h.extend(i,{source:_})}if(this._validate(h.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode)this._createTerrain(i,d);else{const _=this.terrain,b=_.get();for(const w in i)if(!$(i[w],b[w])){_.set(i),this.stylesheet.terrain=i;const C={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(C);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const d=this.fog=new On(i,this.map.transform);this.stylesheet.fog=i;const _={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,_=d.get();for(const b in i)if(!$(i[b],_[b])){d.set(i),this.stylesheet.fog=i;const w={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(w);break}}else this._createFog(i);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(_=>this.isLayerDraped(this._layers[_])),d=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...d)}_createTerrain(i,d){const _=this.terrain=new ut(i,d);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b={now:h.exported.now(),transition:h.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(b)}_force3DLayerUpdate(){for(const i in this._layers){const d=this._layers[i];"fill-extrusion"===d.type&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const d=this._layers[i];"symbol"===d.type&&this._updateLayer(d)}}_validate(i,d,_,b,w={}){return(!w||!1!==w.validate)&&ci(this,i.call(h.validateStyle,h.extend({key:d,style:this.serialize(),value:_,styleSpec:h.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const d=this._getSourceCaches(i);for(const _ of d)_.clearTiles()}_reloadSource(i){const d=this._getSourceCaches(i);for(const _ of d)_.resume(),_.reload()}_updateSources(i){for(const d in this._sourceCaches)this._sourceCaches[d].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const d=this._sourceCaches[i];d.resume(),d.reload()}}_updatePlacement(i,d,_,b,w=!1){let C=!1,S=!1;const P={};for(const R of this._order){const L=this._layers[R];if("symbol"!==L.type)continue;if(!P[L.source]){const H=this._getLayerSourceCache(L);if(!H)continue;P[L.source]=H.getRenderableIds(!0).map(te=>H.getTileByID(te)).sort((te,X)=>X.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(X.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(L,P[L.source],i.center.lng,i.projection);C=C||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new h.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),i.zoom))&&(this.pauseablePlacement=new yo(i,this._order,w,d,_,b,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),S=!0),C&&this.pauseablePlacement.placement.setStale()),S||C)for(const R of this._order){const L=this._layers[R];"symbol"===L.type&&this.placement.updateLayerOpacities(L,P[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();const b=w=>{w&&w.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(i,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(i,d,_){return h.makeRequest(d,_)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const d=[];return this._otherSourceCaches[i]&&d.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&d.push(this._symbolSourceCaches[i]),d}_isSourceCacheLoaded(i){const d=this._getSourceCaches(i);return 0===d.length?(this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}_r.getSourceType=function(p){return Ie[p]},_r.setSourceType=function(p,i){Ie[p]=i},_r.registerForPluginStateChange=h.registerForPluginStateChange;var Bi="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",pe="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ze={},ht={};ze=At("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),ht=At("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Jt=At("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),dr=Bi;var Mn={background:At("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:At("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:At("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:At("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:At("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:At("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:At("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:At("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:At("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:At("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:At("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:At("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:At("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:At("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:At("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:At("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:At("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:At("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:At("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:At("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:At("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:At("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:At("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:At("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:At("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:At("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",pe),skyboxGradient:At("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",pe),skyboxCapture:At("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:At("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:At("uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)\ndiscard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function At(p,i,d){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,w=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),C=p.match(b),S=i.match(b),P=Bi.match(b);let R=S?S.concat(C):C;d||(ze.staticUniforms&&(R=ze.staticUniforms.concat(R)),ht.staticUniforms&&(R=ht.staticUniforms.concat(R))),R&&(R=R.concat(P));const L={};return{fragmentSource:p=p.replace(_,(B,H,te,X,G)=>(L[G]=!0,"define"===H?`\n#ifndef HAS_UNIFORM_u_${G}\nvarying ${te} ${X} ${G};\n#else\nuniform ${te} ${X} u_${G};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${G}\n    ${te} ${X} ${G} = u_${G};\n#endif\n`)),vertexSource:i=i.replace(_,(B,H,te,X,G)=>{const ge="float"===X?"vec2":"vec4",ae=G.match(/color/)?"color":ge;return L[G]?"define"===H?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nattribute ${te} ${ge} a_${G};\nvarying ${te} ${X} ${G};\n#else\nuniform ${te} ${X} u_${G};\n#endif\n`:"vec4"===ae?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = a_${G};\n#else\n    ${te} ${X} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = unpack_mix_${ae}(a_${G}, u_${G}_t);\n#else\n    ${te} ${X} ${G} = u_${G};\n#endif\n`:"define"===H?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nattribute ${te} ${ge} a_${G};\n#else\nuniform ${te} ${X} u_${G};\n#endif\n`:"vec4"===ae?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${te} ${X} ${G} = a_${G};\n#else\n    ${te} ${X} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${te} ${X} ${G} = unpack_mix_${ae}(a_${G}, u_${G}_t);\n#else\n    ${te} ${X} ${G} = u_${G};\n#endif\n`}),staticAttributes:w,staticUniforms:R}}class nr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,d,_,b,w,C,S,P){this.context=i;let R=this.boundPaintVertexBuffers.length!==b.length;for(let L=0;!R&&L<b.length;L++)this.boundPaintVertexBuffers[L]!==b[L]&&(R=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===_&&!R&&this.boundIndexBuffer===w&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===P?(i.bindVertexArrayOES.set(this.vao),S&&S.bind(),w&&w.dynamicDraw&&w.bind(),P&&P.bind()):this.freshBind(d,_,b,w,C,S,P)}freshBind(i,d,_,b,w,C,S){let P;const R=i.numAttributes,L=this.context,B=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=i,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=S;else{P=L.currentNumAttributes||0;for(let H=R;H<P;H++)B.disableVertexAttribArray(H)}d.enableAttributes(B,i);for(const H of _)H.enableAttributes(B,i);C&&C.enableAttributes(B,i),S&&S.enableAttributes(B,i),d.bind(),d.setVertexAttribPointers(B,i,w);for(const H of _)H.bind(),H.setVertexAttribPointers(B,i,w);C&&(C.bind(),C.setVertexAttribPointers(B,i,w)),b&&b.bind(),S&&(S.bind(),S.setVertexAttribPointers(B,i,w)),L.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function yi(p,i){const d=Math.pow(2,i.canonical.z),_=i.canonical.y;return[new h.MercatorCoordinate(0,_/d).toLngLat().lat,new h.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}function or(p,i,d,_,b,w,C){const S=p.context,P=S.gl,R=d.fbo;if(!R)return;p.prepareDrawTile();const L=p.useProgram("hillshade");S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,R.colorAttachment.get());const B=((G,ge,ae,fe)=>{const _e=ae.paint.get("hillshade-shadow-color"),ve=ae.paint.get("hillshade-highlight-color"),he=ae.paint.get("hillshade-accent-color");let Ce=ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ae.paint.get("hillshade-illumination-anchor")&&(Ce-=G.transform.angle);const Ue=!G.options.moving;return{u_matrix:fe||G.transform.calculateProjMatrix(ge.tileID.toUnwrapped(),Ue),u_image:0,u_latrange:yi(0,ge.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),Ce],u_shadow:_e,u_highlight:ve,u_accent:he}})(p,d,_,p.terrain?i.projMatrix:null);p.prepareDrawProgram(S,L,i.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:te,tileBoundsSegments:X}=p.getTileBoundsBuffers(d);L.draw(S,P.TRIANGLES,b,w,C,h.CullFaceMode.disabled,B,_.id,H,te,X)}function Lt(p,i,d){if(!i.needsDEMTextureUpload)return;const _=p.context,b=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||p.getTileTexture(d.stride);const w=d.getPixels();i.demTexture?i.demTexture.update(w,{premultiply:!1}):i.demTexture=new h.Texture(_,w,b.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Cn(p,i,d,_,b,w){const C=p.context,S=C.gl;if(!i.dem)return;const P=i.dem;if(C.activeTexture.set(S.TEXTURE1),Lt(p,i,P),!i.demTexture)return;i.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const R=P.dim;C.activeTexture.set(S.TEXTURE0);let L=i.fbo;if(!L){const X=new h.Texture(C,{width:R,height:R,data:null},S.RGBA);X.bind(S.LINEAR,S.CLAMP_TO_EDGE),L=i.fbo=C.createFramebuffer(R,R,!0),L.colorAttachment.set(X.texture)}C.bindFramebuffer.set(L.framebuffer),C.viewport.set([0,0,R,R]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:H,tileBoundsSegments:te}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(C,S.TRIANGLES,_,b,w,h.CullFaceMode.disabled,((X,G)=>{const ge=G.stride,ae=h.create();return h.ortho(ae,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(ae,ae,[0,-h.EXTENT,0]),{u_matrix:ae,u_image:1,u_dimension:[ge,ge],u_zoom:X.overscaledZ,u_unpack:G.unpackVector}})(i.tileID,P),d.id,B,H,te),i.needsHillshadePrepare=!1}const Gn=(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_image0:new h.Uniform1i(p,i.u_image0),u_skirt_height:new h.Uniform1f(p,i.u_skirt_height)}),jr=(p,i)=>({u_matrix:p,u_image0:0,u_skirt_height:i}),di=(p,i,d,_,b,w)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:i,u_merc_matrix:d,u_zoom_transition:_,u_merc_center:b,u_image0:0,u_grid_matrix:w?Float32Array.from(w):new Float32Array(9)});function Ir(p,i){return null!=p&&null!=i&&!(!p.hasData()||!i.hasData())&&null!=p.demTexture&&null!=i.demTexture&&p.tileID.key!==i.tileID.key}const ni=new class{constructor(){this.operations={}}newMorphing(p,i,d,_,b){if(p in this.operations){const w=this.operations[p];w.to.tileID.key!==d.tileID.key&&(w.queued=d)}else this.operations[p]={startTime:_,phase:0,duration:b,from:i,to:d,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const i=this.operations[p];return{from:i.from,to:i.to,phase:i.phase}}update(p){for(const i in this.operations){const d=this.operations[i];for(d.phase=(p-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,p)){delete this.operations[i];break}}}_nextOp(p,i){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=i,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},pr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Os(p,i){const d=1<<p.z;return!i&&(0===p.x||p.x===d-1)||0===p.y||p.y===d-1}const vo=p=>({u_matrix:p});function Rn(p,i,d,_,b){if(b>0){const w=h.exported.now(),C=(w-p.timeAdded)/b,S=i?(w-i.timeAdded)/b:-1,P=d.getSource(),R=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),L=!i||Math.abs(i.tileID.overscaledZ-R)>Math.abs(p.tileID.overscaledZ-R),B=L&&p.refreshedUponExpiration?1:h.clamp(L?C:1-S,0,1);return p.refreshedUponExpiration&&C>=1&&(p.refreshedUponExpiration=!1),i?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}const Hc=2*h.mercatorZfromAltitude(1,0)*h.GLOBE_RADIUS*Math.PI;class Ls extends h.SourceCache{constructor(i){const d={type:"raster-dem",maxzoom:i.transform.maxZoom},_=new un(nn(),null),b=Oe("mock-dem",d,_,i.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,d){i.state="loaded",d(null)}}class Ba extends h.SourceCache{constructor(i){const d=Oe("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new un(nn(),null),i.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,d,_){if(i.freezeTileCoverage)return;this.transform=i;const b=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,C)=>{if(w[C.key]="",!this._tiles[C.key]){const S=new h.Tile(C,this._source.tileSize*C.overscaleFactor(),i.tileZoom);S.state="loaded",this._tiles[C.key]=S}return w},{});for(const w in this._tiles)w in b||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(i){const d=this.proxyCachedFBO[i];if(void 0!==d){const _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class _a extends h.OverscaledTileID{constructor(i,d,_){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class Hr extends h.Elevation{constructor(i,d){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,b,w]=function(P){const R=new h.StructArrayLayout4i8,L=new h.StructArrayLayout3ui6,B=131;R.reserve(17161),L.reserve(33800);const H=h.EXTENT/128,te=h.EXTENT+H/2,X=te+H;for(let ge=-H;ge<X;ge+=H)for(let ae=-H;ae<X;ae+=H){const fe=ae<0||ae>te||ge<0||ge>te?24575:0,_e=h.clamp(Math.round(ae),0,h.EXTENT),ve=h.clamp(Math.round(ge),0,h.EXTENT);R.emplaceBack(_e+fe,ve,_e,ve)}const G=(ge,ae)=>{const fe=ae*B+ge;L.emplaceBack(fe+1,fe,fe+B),L.emplaceBack(fe+B,fe+B+1,fe+1)};for(let ge=1;ge<129;ge++)for(let ae=1;ae<129;ae++)G(ae,ge);return[0,129].forEach(ge=>{for(let ae=0;ae<130;ae++)G(ae,ge),G(ge,ae)}),[R,L,32768]}(),C=i.context;this.gridBuffer=C.createVertexBuffer(_,h.boundsAttributes.members),this.gridIndexBuffer=C.createIndexBuffer(b),this.gridSegments=h.SegmentVector.simpleSegment(0,0,_.length,b.length),this.gridNoSkirtSegments=h.SegmentVector.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ba(d.map),this.orthoMatrix=h.create(),h.ortho(this.orthoMatrix,0,h.EXTENT,0,h.EXTENT,0,1);const S=C.gl;this._overlapStencilMode=new h.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ls(d.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,d,_){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const b=i.terrain.properties;this.sourceCache=0===i.terrain.drapeRenderMode?this._mockSourceCache:i._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const w=()=>{this.sourceCache.used&&h.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(d,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),d.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&h.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(P=>{const R=d.getTileByID(P).tileID;return R.projMatrix=_.calculateProjMatrix(R.toUnwrapped()),R});(function(P,R){const L=R.transform.pointCoordinate(R.transform.getCameraPoint()),B=new h.pointGeometry(L.x,L.y);P.sort((H,te)=>{if(te.overscaledZ-H.overscaledZ)return te.overscaledZ-H.overscaledZ;const X=new h.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),G=new h.pointGeometry(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),ge=B.mult(1<<H.canonical.z);return ge.x-=.5,ge.y-=.5,ge.distSqr(X)-ge.distSqr(G)})})(b,this.painter),this._previousZoom=_.zoom;const w=this.proxyToSource||{};this.proxyToSource={},b.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const C=this._style._sourceCaches;for(const P in C){const R=C[P];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,i[P],w),R.usedForTerrain))continue;const L=i[P];R.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[d.id]=b.map(P=>new _a(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=h.exported.now();const S={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const R=this.terrainTileForTile[P.key];if(!R)continue;const L=R.tileID.key;L in S||(this._visibleDemTiles.push(R),S[L]=L)}}_assignTerrainTiles(i){this._initializing||i.forEach(d=>{if(this.terrainTileForTile[d.key])return;const _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){const i=this.painter.context,d=i.gl;for(const _ in this.terrainTileForTile){const b=this.terrainTileForTile[_],w=b.dem;!w||b.demTexture&&!b.needsDEMTextureUpload||(i.activeTexture.set(d.TEXTURE1),Lt(this.painter,b,w))}}_prepareDemTileUniforms(i,d,_,b){if(!d||null==d.demTexture)return!1;const w=i.tileID.canonical,C=Math.pow(2,d.tileID.canonical.z-w.z),S=b||"";return _[`u_dem_tl${S}`]=[w.x*C%1,w.y*C%1],_[`u_dem_scale${S}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,d=i.gl;if(!this._emptyDepthBufferTexture){const _=new h.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new h.Texture(i,_,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const d=this._visibleDemTiles.reduce((_,b)=>{if(!b.dem)return _;const w=b.dem.tree.minimums[0];return w>0&&i++,_+w},0);return i?d/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,d=i.gl;i.activeTexture.set(d.TEXTURE2);const _=this._getLoadedAreaMinimum(),b=new h.RGBAImage({width:1,height:1},new Uint8Array(h.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(b,{premultiply:!1}):w=this._emptyDEMTexture=new h.Texture(i,b,d.RGBA,{premultiply:!1}),w}setupElevationDraw(i,d,_){const b=this.painter.context,w=b.gl,C=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:h.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;C.u_dem_size=this.sourceCache.getSource().tileSize,C.u_exaggeration=this.exaggeration();const P=this.painter.transform,R=P.projection,L=i.tileID.canonical;C.u_tile_tl_up=R.upVector(L,0,0),C.u_tile_tr_up=R.upVector(L,h.EXTENT,0),C.u_tile_br_up=R.upVector(L,h.EXTENT,h.EXTENT),C.u_tile_bl_up=R.upVector(L,0,h.EXTENT),C.u_tile_up_scale=_&&_.useDenormalizedUpVectorScale?Hc:R.upVectorScale(L,P.center.lat,P.worldSize).metersToTile;let B=null,H=null,te=1;if(_&&_.morphing&&this._useVertexMorphing){const X=_.morphing.srcDemTile,G=_.morphing.dstDemTile;te=_.morphing.phase,X&&G&&(this._prepareDemTileUniforms(i,X,C,"_prev")&&(H=X),this._prepareDemTileUniforms(i,G,C)&&(B=G))}if(H&&B?(b.activeTexture.set(w.TEXTURE2),B.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),b.activeTexture.set(w.TEXTURE4),H.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),C.u_dem_lerp=te):(B=this.terrainTileForTile[i.tileID.key],b.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(i,B,C)?B.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),b.activeTexture.set(w.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&B){const X=(1<<B.tileID.canonical.z)*h.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=X}_&&_.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(b,C)}renderToBackBuffer(i){const d=this.painter,_=this.painter.context;0!==i.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),this.renderingToTexture=!1,function(b,w,C,S,P){if("globe"===b.transform.projection.name)!function(R,L,B,H,te){const X=R.context,G=X.gl;let ge,ae;const fe=R.options.showTerrainWireframe?2:0,_e=(Je,Dt)=>{if(ae===Je)return;const je=[pr[Je],"PROJECTION_GLOBE_VIEW"];Dt&&je.push(pr[fe]),ge=R.useProgram("globeRaster",null,je),ae=Je},ve=R.colorModeForRenderPass(),he=new h.DepthMode(G.LEQUAL,h.DepthMode.ReadWrite,R.depthRangeFor3D);ni.update(te);const Ce=R.transform,Ue=h.calculateGlobeMercatorMatrix(Ce),We=[h.mercatorXfromLng(Ce.center.lng),h.mercatorYfromLat(Ce.center.lat)],et=R.globeSharedBuffers;if((fe?[!1,!0]:[!1]).forEach(Je=>{ae=-1;const Dt=Je?G.LINES:G.TRIANGLES;for(const je of H){const yt=B.getTile(je),xt=h.StencilMode.disabled,Ht=L.prevTerrainTileForTile[je.key],Ke=L.terrainTileForTile[je.key];Ir(Ht,Ke)&&ni.newMorphing(je.key,Ht,Ke,te,250),X.activeTexture.set(G.TEXTURE0),yt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const Kt=ni.getMorphValuesForProxy(je.key),Qt=Kt?1:0,jt={useDenormalizedUpVectorScale:!0};Kt&&h.extend$1(jt,{morphing:{srcDemTile:Kt.from,dstDemTile:Kt.to,phase:h.easeCubicInOut(Kt.phase)}});const qt=Float32Array.from(Ce.globeMatrix),an=h.globeTileLatLngCorners(je.canonical),En=h.getGridMatrix(je.canonical,an),en=di(Ce.projMatrix,qt,Ue,h.globeToMercatorTransition(Ce.zoom),We,En);if(_e(Qt,Je),L.setupElevationDraw(yt,ge,jt),R.prepareDrawProgram(X,ge,je.toUnwrapped()),et){const[vn,Yt,ri]=Je?et.getWirefameBuffers(R.context):et.getGridBuffers();ge.draw(X,Dt,he,xt,ve,h.CullFaceMode.backCCW,en,"globe_raster",vn,Yt,ri)}}}),et){ge=R.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const Je of H){const{x:Dt,y:je,z:yt}=Je.canonical,xt=0===je,Ht=je===(1<<yt)-1,[Ke,Kt,Qt,jt]=et.getPoleBuffers(yt);if(jt&&(xt||Ht)){const qt=B.getTile(Je);X.activeTexture.set(G.TEXTURE0),qt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let an=h.globePoleMatrixForTile(yt,Dt,Ce);const En=(en,vn)=>en.draw(X,G.TRIANGLES,he,h.StencilMode.disabled,ve,h.CullFaceMode.disabled,di(Ce.projMatrix,an,an,0,We),"globe_pole_raster",vn,Qt,jt);L.setupElevationDraw(qt,ge,{}),R.prepareDrawProgram(X,ge,Je.toUnwrapped()),xt&&En(ge,Ke),Ht&&(an=h.scale(h.create(),an,[1,-1,1]),En(ge,Kt))}}}}(b,w,C,S,P);else{const R=b.context,L=R.gl;let B,H;const te=b.options.showTerrainWireframe?2:0,X=(_e,ve)=>{if(H===_e)return;const he=[pr[_e]];ve&&he.push(pr[te]),B=b.useProgram("terrainRaster",null,he),H=_e},G=b.colorModeForRenderPass(),ge=new h.DepthMode(L.LEQUAL,h.DepthMode.ReadWrite,b.depthRangeFor3D);ni.update(P);const ae=b.transform,fe=6*Math.pow(1.5,22-ae.zoom)*w.exaggeration();(te?[!1,!0]:[!1]).forEach(_e=>{H=-1;const ve=_e?L.LINES:L.TRIANGLES,[he,Ce]=_e?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const Ue of S){const We=C.getTile(Ue),et=h.StencilMode.disabled,Je=w.prevTerrainTileForTile[Ue.key],Dt=w.terrainTileForTile[Ue.key];Ir(Je,Dt)&&ni.newMorphing(Ue.key,Je,Dt,P,250),R.activeTexture.set(L.TEXTURE0),We.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const je=ni.getMorphValuesForProxy(Ue.key),yt=je?1:0;let xt;je&&(xt={morphing:{srcDemTile:je.from,dstDemTile:je.to,phase:h.easeCubicInOut(je.phase)}});const Ht=jr(Ue.projMatrix,Os(Ue.canonical,ae.renderWorldCopies)?fe/10:fe);X(yt,_e),w.setupElevationDraw(We,B,xt),b.prepareDrawProgram(R,B,Ue.toUnwrapped()),B.draw(R,ve,ge,et,G,h.CullFaceMode.backCCW,Ht,"terrain_raster",w.gridBuffer,he,Ce)}})}}(d,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const d=this.painter,_=this.painter.context,b=this.proxySourceCache,w=this.proxiedCoords[b.id],C=this._drapedRenderBatches.shift(),S=[],P=d.style.order;let R=0;for(const L of w){const B=b.getTileByID(L.proxyTileKey),H=b.proxyCachedFBO[L.key]?b.proxyCachedFBO[L.key][i]:void 0,te=void 0!==H?b.renderCache[H]:this.pool[R++],X=void 0!==H;if(B.texture=te.tex,X&&!te.dirty){S.push(B.tileID);continue}let G;_.bindFramebuffer.set(te.fb.framebuffer),this.renderedToTile=!1,te.dirty&&(_.clear({color:h.Color.transparent,stencil:0}),te.dirty=!1);for(let ge=C.start;ge<=C.end;++ge){const ae=d.style._layers[P[ge]];if(ae.isHidden(d.transform.zoom))continue;const fe=d.style._getLayerSourceCache(ae),_e=fe?this.proxyToSource[L.key][fe.id]:[L];if(!_e)continue;const ve=_e;_.viewport.set([0,0,te.fb.width,te.fb.height]),G!==(fe?fe.id:null)&&(this._setupStencil(te,_e,ae,fe),G=fe?fe.id:null),d.renderLayer(d,fe,ae,ve)}this.renderedToTile?(te.dirty=!0,S.push(B.tileID)):X||--R,5===R&&(R=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),C.end+1}postRender(){}renderCacheEfficiency(i){const d=i.order.length;if(0===d)return{efficiency:100};let _,b=0,w=0,C=!1;for(let S=0;S<d;++S){const P=i._layers[i.order[S]];this._style.isLayerDraped(P)?(C&&++b,++w):C||(C=!0,_=P.id)}return 0===w?{efficiency:100}:{efficiency:100*(1-b/w),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{i=Math.min(i,d.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,d,_){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const C=w.tileID,S=Math.pow(2,C.overscaledZ),{x:P,y:R}=C.canonical,L=P/S,B=(P+1)/S,H=R/S,te=(R+1)/S;return{minx:L,miny:H,maxx:B,maxy:te,t:w.dem.tree.raycastRoot(L,H,B,te,i,d,_),tile:w}});b.sort((w,C)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==C.t?C.t:Number.MAX_VALUE));for(const w of b){if(null==w.t)return null;const C=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,i,d,_);if(null!=C)return C}return null}_createFBO(){const i=this.painter.context,d=i.gl,_=this.drapeBufferSize;i.activeTexture.set(d.TEXTURE0);const b=new h.Texture(i,{width:_[0],height:_[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const w=i.createFramebuffer(_[0],_[1],!1);return w.colorAttachment.set(b.texture),w.depthAttachment=new Go(i,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:w,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const d=this._style._layers[i],_=d.isHidden(this.painter.transform.zoom),b=d.getCrossfadeParameters(),w=!!b&&1!==b.t,C=d.hasTransition();return"custom"!==d.type&&!_&&(w||C)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const d in this._style._sourceCaches)if(this._style._sourceCaches[d]._source instanceof V){i=!0;break}if(i)for(let d=0;d<this._style.order.length;++d){const _=this._style._layers[this._style.order[d]],b=_.isHidden(this.painter.transform.zoom),w=this._style._getLayerSourceCache(_);if("raster"!==_.type||b||!w)continue;const C=_.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const P=this.proxyToSource[S.key][w.id];if(P)for(const R of P){const L=Rn(w.getTile(R),w.findLoadedParent(R,0),w,this.painter.transform,C);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(w.id,R)}}}}_setupDrapedRenderBatches(){const i=this._style.order,d=i.length;if(0===d)return;const _=[];let b,w=0,C=this._style._layers[i[w]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++w<d;)C=this._style._layers[i[w]];for(;w<d;++w){const S=this._style._layers[i[w]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===b&&(b=w):void 0!==b&&(_.push({start:b,end:w-1}),b=void 0))}void 0!==b&&_.push({start:b,end:w-1}),this._drapedRenderBatches=_}_setupRenderCache(i){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const C=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let S=0;S<C.length;++S){const P=Object.values(C[S]);d.renderCachePool.push(...P)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,b=this._tilesDirty;for(let C=_.length-1;C>=0;C--){const S=_[C];if(d.getTileByID(S.key),void 0!==d.proxyCachedFBO[S.key]){const P=i[S.key],R=this.proxyToSource[S.key];let L=0;for(const B in R){const H=R[B],te=P[B];if(!te||te.length!==H.length||H.some((X,G)=>X!==te[G]||b[B]&&b[B].hasOwnProperty(X.key))){L=-1;break}++L}for(const B in d.proxyCachedFBO[S.key])d.renderCache[d.proxyCachedFBO[S.key][B]].dirty=L<0||L!==Object.values(P).length}}const w=[...this._drapedRenderBatches];w.sort((C,S)=>S.end-S.start-(C.end-C.start));for(const C of w)for(const S of _){if(d.proxyCachedFBO[S.key])continue;let P=d.renderCachePool.pop();void 0===P&&d.renderCache.length<50&&(P=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==P&&(d.proxyCachedFBO[S.key]={},d.proxyCachedFBO[S.key][C.start]=P,d.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(i,d,_,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,C=w.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let S;if(_.isTileClipped())S=d.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(i.key)||0),this._overlapStencilMode):h.StencilMode.disabled}_renderTileClippingMasks(i,d){const _=this.painter,b=this.painter.context,w=b.gl;_._tileClippingMaskIDs.clear(),b.setColorMode(h.ColorMode.disabled),b.setDepthMode(h.DepthMode.disabled);const C=_.useProgram("clippingMask");for(const S of i){const P=--d;_._tileClippingMaskIDs.set(S.key,P),C.draw(b,w.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:w.ALWAYS,mask:0},P,255,w.KEEP,w.KEEP,w.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,vo(S.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(i){const d=this.painter.transform;if(i.x<0||i.x>d.width||i.y<0||i.y>d.height)return null;const _=[i.x,i.y,1,1];h.transformMat4$1(_,_,d.pixelMatrixInverse),h.scale$1(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;const b=d._camera.position,w=h.mercatorZfromAltitude(1,d.center.lat),C=[b[0],b[1],b[2]/w,0],S=h.subtract([],_.slice(0,3),C);h.normalize(S,S);const P=this.raycast(C,S,this._exaggeration);return null!==P&&P?(h.scaleAndAdd(C,C,S,P),C[3]=C[2],C[2]*=w,C):null}drawDepth(){const i=this.painter,d=i.context,_=this.proxySourceCache,b=Math.ceil(i.width),w=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const C=d.gl,S=d.createFramebuffer(b,w,!0);d.activeTexture.set(C.TEXTURE0);const P=new h.Texture(d,{width:b,height:w,data:null},C.RGBA);P.bind(C.NEAREST,C.CLAMP_TO_EDGE),S.colorAttachment.set(P.texture);const R=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,w);S.depthAttachment.set(R),this._depthFBO=S,this._depthTexture=P}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,w]),function(C,S,P,R){if("globe"===C.transform.projection.name)return;const L=C.context,B=L.gl;L.clear({depth:1});const H=C.useProgram("terrainDepth"),te=new h.DepthMode(B.LESS,h.DepthMode.ReadWrite,C.depthRangeFor3D);for(const X of R){const G=P.getTile(X),ge=jr(X.projMatrix,0);S.setupElevationDraw(G,H),H.draw(L,B.TRIANGLES,te,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.backCCW,ge,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(i,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,d,_){if(i.getSource()instanceof De)return this._setupProxiedCoordsForImageSource(i,d,_);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const b=this.proxiedCoords[i.id]=[],w=this.proxyCoords;for(let S=0;S<w.length;S++){const P=w[S],R=this._findTileCoveringTileID(P,i);if(R){const L=this._createProxiedId(P,R,_[P.key]&&_[P.key][i.id]);b.push(L),this.proxyToSource[P.key][i.id]=[L]}}let C=!1;for(let S=0;S<d.length;S++){const P=i.getTile(d[S]);if(!P||!P.hasData())continue;const R=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==P.tileID.canonical.z){const L=this.proxyToSource[R.tileID.key][i.id],B=this._createProxiedId(R.tileID,P,_[R.tileID.key]&&_[R.tileID.key][i.id]);L?L.splice(L.length-1,0,B):this.proxyToSource[R.tileID.key][i.id]=[B],b.push(B),C=!0}}this._sourceTilesOverlap[i.id]=C}_setupProxiedCoordsForImageSource(i,d,_){if(!i.getSource().loaded())return;const b=this.proxiedCoords[i.id]=[],w=this.proxyCoords,C=i.getSource(),S=new h.pointGeometry(C.tileID.x,C.tileID.y)._div(1<<C.tileID.z),P=C.coordinates.map(h.MercatorCoordinate.fromLngLat).reduce((L,B)=>(L.min.x=Math.min(L.min.x,B.x-S.x),L.min.y=Math.min(L.min.y,B.y-S.y),L.max.x=Math.max(L.max.x,B.x-S.x),L.max.y=Math.max(L.max.y,B.y-S.y),L),{min:new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new h.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(L,B)=>{const H=L.wrap+L.canonical.x/(1<<L.canonical.z),te=L.canonical.y/(1<<L.canonical.z),X=h.EXTENT/(1<<L.canonical.z),G=B.wrap+B.canonical.x/(1<<B.canonical.z),ge=B.canonical.y/(1<<B.canonical.z);return H+X<G+P.min.x||H>G+P.max.x||te+X<ge+P.min.y||te>ge+P.max.y};for(let L=0;L<w.length;L++){const B=w[L];for(let H=0;H<d.length;H++){const te=i.getTile(d[H]);if(!te||!te.hasData()||R(B,te.tileID))continue;const X=this._createProxiedId(B,te,_[B.key]&&_[B.key][i.id]),G=this.proxyToSource[B.key][i.id];G?G.push(X):this.proxyToSource[B.key][i.id]=[X],b.push(X)}}}_createProxiedId(i,d,_){let b=this.orthoMatrix;if(_){const w=_.find(C=>C.key===d.tileID.key);if(w)return w}if(d.tileID.key!==i.key){const w=i.canonical.z-d.tileID.canonical.z;let C,S,P;b=h.create();const R=d.tileID.wrap-i.wrap<<i.overscaledZ;w>0?(C=h.EXTENT>>w,S=C*((d.tileID.canonical.x<<w)-i.canonical.x+R),P=C*((d.tileID.canonical.y<<w)-i.canonical.y)):(C=h.EXTENT<<-w,S=h.EXTENT*(d.tileID.canonical.x-(i.canonical.x+R<<-w)),P=h.EXTENT*(d.tileID.canonical.y-(i.canonical.y<<-w))),h.ortho(b,0,C,0,C,0,1),h.translate(b,b,[S,P,0])}return new _a(d.tileID,i.key,b)}_findTileCoveringTileID(i,d){let _=d.getTile(i);if(_&&_.hasData())return _;const b=this._findCoveringTileCache[d.id],w=b[i.key];if(_=w?d.getTileByID(w):null,_&&_.hasData()||null===w)return _;let C=_?_.tileID:i,S=C.overscaledZ;const P=d.getSource().minzoom,R=[];if(!w){const B=d.getSource().maxzoom;if(i.canonical.z>=B){const H=i.canonical.z-B;d.getSource().reparseOverscaled?(S=Math.max(i.canonical.z+2,d.transform.tileZoom),C=new h.OverscaledTileID(S,i.wrap,B,i.canonical.x>>H,i.canonical.y>>H)):0!==H&&(S=B,C=new h.OverscaledTileID(S,i.wrap,B,i.canonical.x>>H,i.canonical.y>>H))}C.key!==i.key&&(R.push(C.key),_=d.getTile(C))}const L=B=>{R.forEach(H=>{b[H]=B}),R.length=0};for(S-=1;S>=P&&(!_||!_.hasData());S--){_&&L(_.tileID.key);const B=C.calculateScaledKey(S);if(_=d.getTileByID(B),_&&_.hasData())break;const H=b[B];if(null===H)break;void 0===H?R.push(B):_=d.getTileByID(H)}return L(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,d){let _=this._tilesDirty[i];_||(_=this._tilesDirty[i]={}),_[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(d){let _=0;const b=new h.StructArrayLayout2ui4,w=131;for(let C=1;C<129;C++){for(let S=1;S<129;S++)_=C*w+S,b.emplaceBack(_,_+1),b.emplaceBack(_,_+w),b.emplaceBack(_+1,_+w),128===C&&b.emplaceBack(_+w,_+w+1);b.emplaceBack(_+1,_+1+w)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=h.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function ya(p){const i=[];for(let d=0;d<p.length;d++){if(null===p[d])continue;const _=p[d].split(" ");i.push(_.pop())}return i}class Fs{static cacheKey(i,d,_){let b=`${i}${_?_.cacheKey:""}`;for(const w of d)b+=`/${w}`;return b}constructor(i,d,_,b,w,C){const S=i.gl;this.program=S.createProgram();const P=ya(_.staticAttributes),R=b?b.getBinderAttributes():[],L=P.concat(R),B=_.staticUniforms?ya(_.staticUniforms):[],H=b?b.getBinderUniforms():[],te=B.concat(H),X=[];for(const he of te)X.indexOf(he)<0&&X.push(he);let G=b?b.defines():[];G=G.concat(C.map(he=>`#define ${he}`));const ge=G.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",dr,Jt.fragmentSource,ht.fragmentSource,_.fragmentSource).join("\n"),ae=G.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",dr,Jt.vertexSource,ht.vertexSource,ze.vertexSource,_.vertexSource).join("\n"),fe=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(fe,ge),S.compileShader(fe),S.attachShader(this.program,fe);const _e=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(_e,ae),S.compileShader(_e),S.attachShader(this.program,_e),this.attributes={};const ve={};this.numAttributes=L.length;for(let he=0;he<this.numAttributes;he++)L[he]&&(S.bindAttribLocation(this.program,he,L[he]),this.attributes[L[he]]=he);S.linkProgram(this.program),S.deleteShader(_e),S.deleteShader(fe);for(let he=0;he<X.length;he++){const Ce=X[he];if(Ce&&!ve[Ce]){const Ue=S.getUniformLocation(this.program,Ce);Ue&&(ve[Ce]=Ue)}}var he,Ce;this.fixedUniforms=w(i,ve),this.binderUniforms=b?b.getUniforms(i,ve):[],-1!==C.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new h.Uniform1i(he=i,(Ce=ve).u_dem),u_dem_prev:new h.Uniform1i(he,Ce.u_dem_prev),u_dem_unpack:new h.Uniform4f(he,Ce.u_dem_unpack),u_dem_tl:new h.Uniform2f(he,Ce.u_dem_tl),u_dem_scale:new h.Uniform1f(he,Ce.u_dem_scale),u_dem_tl_prev:new h.Uniform2f(he,Ce.u_dem_tl_prev),u_dem_scale_prev:new h.Uniform1f(he,Ce.u_dem_scale_prev),u_dem_size:new h.Uniform1f(he,Ce.u_dem_size),u_dem_lerp:new h.Uniform1f(he,Ce.u_dem_lerp),u_exaggeration:new h.Uniform1f(he,Ce.u_exaggeration),u_depth:new h.Uniform1i(he,Ce.u_depth),u_depth_size_inv:new h.Uniform2f(he,Ce.u_depth_size_inv),u_meter_to_dem:new h.Uniform1f(he,Ce.u_meter_to_dem),u_label_plane_matrix_inv:new h.UniformMatrix4f(he,Ce.u_label_plane_matrix_inv),u_tile_tl_up:new h.Uniform3f(he,Ce.u_tile_tl_up),u_tile_tr_up:new h.Uniform3f(he,Ce.u_tile_tr_up),u_tile_br_up:new h.Uniform3f(he,Ce.u_tile_br_up),u_tile_bl_up:new h.Uniform3f(he,Ce.u_tile_bl_up),u_tile_up_scale:new h.Uniform1f(he,Ce.u_tile_up_scale)}),-1!==C.indexOf("FOG")&&(this.fogUniforms=((he,Ce)=>({u_fog_matrix:new h.UniformMatrix4f(he,Ce.u_fog_matrix),u_fog_range:new h.Uniform2f(he,Ce.u_fog_range),u_fog_color:new h.Uniform4f(he,Ce.u_fog_color),u_fog_horizon_blend:new h.Uniform1f(he,Ce.u_fog_horizon_blend),u_fog_temporal_offset:new h.Uniform1f(he,Ce.u_fog_temporal_offset)}))(i,ve))}setTerrainUniformValues(i,d){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const b in d)_[b].set(d[b])}}setFogUniformValues(i,d){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const b in d)_[b].location&&_[b].set(d[b])}}draw(i,d,_,b,w,C,S,P,R,L,B,H,te,X,G,ge){const ae=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(_),i.setStencilMode(b),i.setColorMode(w),i.setCullFace(C);for(const _e of Object.keys(this.fixedUniforms))this.fixedUniforms[_e].set(S[_e]);X&&X.setUniforms(i,this.binderUniforms,H,{zoom:te});const fe={[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[d];for(const _e of B.get()){const ve=_e.vaos||(_e.vaos={});(ve[P]||(ve[P]=new nr)).bind(i,this,R,X?X.getPaintVertexBuffers():[],L,_e.vertexOffset,G,ge),ae.drawElements(d,_e.primitiveLength*fe,ae.UNSIGNED_SHORT,_e.primitiveOffset*fe*2)}}}function ao(p,i,d){const _=1/Nn(d,1,i.transform.tileZoom),b=Math.pow(2,d.tileID.overscaledZ),w=d.tileSize*Math.pow(2,i.transform.tileZoom)/b,C=w*(d.tileID.canonical.x+d.tileID.wrap*b),S=w*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[C>>16,S>>16],u_pixel_coord_lower:[65535&C,65535&S]}}const Lr=h.create(),qc=(p,i,d,_,b,w,C,S,P)=>{const R=i.style.light,L=R.properties.get("position"),B=[L.x,L.y,L.z],H=h.create$1();"viewport"===R.properties.get("anchor")&&(h.fromRotation(H,-i.transform.angle),h.transformMat3(B,B,H));const te=R.properties.get("color"),X=i.transform,G={u_matrix:p,u_lightpos:B,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===X.projection.name&&(G.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],G.u_zoom_transition=C,G.u_inv_rot_matrix=P,G.u_merc_center=S,G.u_up_dir=X.projection.upVector(new h.CanonicalTileID(0,0,0),S[0]*h.EXTENT,S[1]*h.EXTENT),G.u_height_lift=w),G},Zc=(p,i,d,_,b,w,C,S,P,R,L)=>{const B=qc(p,i,d,_,b,S,P,R,L),H={u_height_factor:-Math.pow(2,b.overscaledZ)/C.tileSize/8};return h.extend(B,ao(w,i,C),H)},Ro=p=>({u_matrix:p}),xo=(p,i,d,_)=>h.extend(Ro(p),ao(d,i,_)),wl=(p,i)=>({u_matrix:p,u_world:i}),Ql=(p,i,d,_,b)=>h.extend(xo(p,i,d,_),{u_world:b}),ec=h.create(),Ki=(p,i,d,_,b,w)=>{const C=p.transform,S="globe"===C.projection.name;let P;if("map"===w.paint.get("circle-pitch-alignment"))if(S){const L=h.globePixelsToTileUnits(C.zoom,i.canonical);P=Float32Array.from([L,0,0,L])}else P=C.calculatePixelsToTileUnitsMatrix(d);else P=new Float32Array([C.pixelsToGLUnits[0],0,0,C.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:C.cameraToCenterDistance,u_matrix:p.translatePosMatrix(i.projMatrix,d,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:h.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:ec,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return S&&(R.u_inv_rot_matrix=_,R.u_merc_center=b,R.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],R.u_zoom_transition=h.globeToMercatorTransition(C.zoom),R.u_up_dir=C.projection.upVector(i.canonical,b[0],b[1])),R},Of=p=>{const i=[];return"map"===p.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},Pm=(p,i,d)=>{const _=h.EXTENT/d.tileSize;return{u_matrix:p,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/_,i.pixelsToGLUnits[1]/_]}},od=(p,i,d=1)=>({u_matrix:p,u_color:i,u_overlay:0,u_overlay_scale:d}),Lf=h.create(),km=(p,i,d,_,b,w,C)=>{const S=p.transform,P="globe"===S.projection.name,R=P?h.globePixelsToTileUnits(S.zoom,i.canonical):Nn(d,1,w),L={u_matrix:i.projMatrix,u_extrude_scale:R,u_intensity:C,u_inv_rot_matrix:Lf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return P&&(L.u_inv_rot_matrix=_,L.u_merc_center=b,L.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],L.u_zoom_transition=h.globeToMercatorTransition(S.zoom),L.u_up_dir=S.projection.upVector(i.canonical,b[0],b[1])),L},Rm=(p,i,d,_,b,w,C)=>{const S=p.transform,P=S.calculatePixelsToTileUnitsMatrix(i),R={u_matrix:El(p,i,d,b),u_pixels_to_tile_units:P,u_device_pixel_ratio:C,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(ad(d)){const L=Wu(i,p.transform);R.u_texsize=i.lineAtlasTexture.size,R.u_scale=[L,_.fromScale,_.toScale],R.u_mix=_.t}return R},sd=(p,i,d,_,b,w)=>{const C=p.transform,S=Wu(i,C);return{u_matrix:El(p,i,d,b),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:w,u_image:0,u_scale:[S,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Wu(p,i){return 1/Nn(p,1,i.tileZoom)}function El(p,i,d,_){return p.translatePosMatrix(_||i.tileID.projMatrix,i,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function ad(p){const i=p.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const Ff=(p,i,d,_,b,w)=>{return{u_matrix:p,u_tl_parent:i,u_scale_parent:d,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(S=b.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(C=b.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:ld(b.paint.get("raster-hue-rotate")),u_perspective_transform:w};var C,S};function ld(p){p*=Math.PI/180;const i=Math.sin(p),d=Math.cos(p);return[(2*d+1)/3,(-Math.sqrt(3)*i-d+1)/3,(Math.sqrt(3)*i-d+1)/3]}const ja=h.create(),cd=(p,i,d,_,b,w,C,S,P,R,L,B,H,te)=>{const X=b.transform,G={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:X.width/X.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:C,u_coord_matrix:S,u_is_text:+P,u_pitch_with_map:+_,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ja,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ja};return"globe"===X.projection.name&&(G.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],G.u_zoom_transition=B,G.u_inv_rot_matrix=te,G.u_merc_center=H,G.u_camera_forward=X._camera.forward(),G.u_ecef_origin=h.globeECEFOrigin(X.globeMatrix,L.toUnwrapped()),G.u_tile_matrix=Float32Array.from(X.globeMatrix)),G},Tl=(p,i,d,_,b,w,C,S,P,R,L,B,H,te,X)=>{const{cameraToCenterDistance:G,_pitch:ge}=b.transform;return h.extend(cd(p,i,d,_,b,w,C,S,P,R,B,H,te,X),{u_gamma_scale:_?G*Math.cos(b.terrain?0:ge):1,u_device_pixel_ratio:h.exported.devicePixelRatio,u_is_halo:+L})},tc=(p,i,d,_,b,w,C,S,P,R,L,B,H,te)=>h.extend(Tl(p,i,d,_,b,w,C,S,!0,P,!0,L,B,H,te),{u_texsize_icon:R,u_texture_icon:1}),zf=(p,i,d)=>({u_matrix:p,u_opacity:i,u_color:d}),ud=(p,i,d,_,b,w)=>h.extend(function(C,S,P,R){const L=P.imageManager.getPattern(C.from.toString()),B=P.imageManager.getPattern(C.to.toString()),{width:H,height:te}=P.imageManager.getPixelSize(),X=Math.pow(2,R.tileID.overscaledZ),G=R.tileSize*Math.pow(2,P.transform.tileZoom)/X,ge=G*(R.tileID.canonical.x+R.tileID.wrap*X),ae=G*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[H,te],u_mix:S.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Nn(R,1,P.transform.tileZoom),u_pixel_coord_upper:[ge>>16,ae>>16],u_pixel_coord_lower:[65535&ge,65535&ae]}}(_,w,d,b),{u_matrix:p,u_opacity:i}),fr={fillExtrusion:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_lightpos:new h.Uniform3f(p,i.u_lightpos),u_lightintensity:new h.Uniform1f(p,i.u_lightintensity),u_lightcolor:new h.Uniform3f(p,i.u_lightcolor),u_vertical_gradient:new h.Uniform1f(p,i.u_vertical_gradient),u_opacity:new h.Uniform1f(p,i.u_opacity),u_tile_id:new h.Uniform3f(p,i.u_tile_id),u_zoom_transition:new h.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(p,i.u_merc_center),u_up_dir:new h.Uniform3f(p,i.u_up_dir),u_height_lift:new h.Uniform1f(p,i.u_height_lift)}),fillExtrusionPattern:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_lightpos:new h.Uniform3f(p,i.u_lightpos),u_lightintensity:new h.Uniform1f(p,i.u_lightintensity),u_lightcolor:new h.Uniform3f(p,i.u_lightcolor),u_vertical_gradient:new h.Uniform1f(p,i.u_vertical_gradient),u_height_factor:new h.Uniform1f(p,i.u_height_factor),u_tile_id:new h.Uniform3f(p,i.u_tile_id),u_zoom_transition:new h.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(p,i.u_merc_center),u_up_dir:new h.Uniform3f(p,i.u_up_dir),u_height_lift:new h.Uniform1f(p,i.u_height_lift),u_image:new h.Uniform1i(p,i.u_image),u_texsize:new h.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new h.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new h.Uniform3f(p,i.u_scale),u_fade:new h.Uniform1f(p,i.u_fade),u_opacity:new h.Uniform1f(p,i.u_opacity)}),fill:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix)}),fillPattern:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_image:new h.Uniform1i(p,i.u_image),u_texsize:new h.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new h.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new h.Uniform3f(p,i.u_scale),u_fade:new h.Uniform1f(p,i.u_fade)}),fillOutline:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_world:new h.Uniform2f(p,i.u_world)}),fillOutlinePattern:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_world:new h.Uniform2f(p,i.u_world),u_image:new h.Uniform1i(p,i.u_image),u_texsize:new h.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new h.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new h.Uniform3f(p,i.u_scale),u_fade:new h.Uniform1f(p,i.u_fade)}),circle:(p,i)=>({u_camera_to_center_distance:new h.Uniform1f(p,i.u_camera_to_center_distance),u_extrude_scale:new h.UniformMatrix2f(p,i.u_extrude_scale),u_device_pixel_ratio:new h.Uniform1f(p,i.u_device_pixel_ratio),u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_inv_rot_matrix:new h.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(p,i.u_merc_center),u_tile_id:new h.Uniform3f(p,i.u_tile_id),u_zoom_transition:new h.Uniform1f(p,i.u_zoom_transition),u_up_dir:new h.Uniform3f(p,i.u_up_dir)}),collisionBox:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_camera_to_center_distance:new h.Uniform1f(p,i.u_camera_to_center_distance),u_extrude_scale:new h.Uniform2f(p,i.u_extrude_scale)}),collisionCircle:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_inv_matrix:new h.UniformMatrix4f(p,i.u_inv_matrix),u_camera_to_center_distance:new h.Uniform1f(p,i.u_camera_to_center_distance),u_viewport_size:new h.Uniform2f(p,i.u_viewport_size)}),debug:(p,i)=>({u_color:new h.UniformColor(p,i.u_color),u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_overlay:new h.Uniform1i(p,i.u_overlay),u_overlay_scale:new h.Uniform1f(p,i.u_overlay_scale)}),clippingMask:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix)}),heatmap:(p,i)=>({u_extrude_scale:new h.Uniform1f(p,i.u_extrude_scale),u_intensity:new h.Uniform1f(p,i.u_intensity),u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_inv_rot_matrix:new h.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(p,i.u_merc_center),u_tile_id:new h.Uniform3f(p,i.u_tile_id),u_zoom_transition:new h.Uniform1f(p,i.u_zoom_transition),u_up_dir:new h.Uniform3f(p,i.u_up_dir)}),heatmapTexture:(p,i)=>({u_image:new h.Uniform1i(p,i.u_image),u_color_ramp:new h.Uniform1i(p,i.u_color_ramp),u_opacity:new h.Uniform1f(p,i.u_opacity)}),hillshade:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_image:new h.Uniform1i(p,i.u_image),u_latrange:new h.Uniform2f(p,i.u_latrange),u_light:new h.Uniform2f(p,i.u_light),u_shadow:new h.UniformColor(p,i.u_shadow),u_highlight:new h.UniformColor(p,i.u_highlight),u_accent:new h.UniformColor(p,i.u_accent)}),hillshadePrepare:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_image:new h.Uniform1i(p,i.u_image),u_dimension:new h.Uniform2f(p,i.u_dimension),u_zoom:new h.Uniform1f(p,i.u_zoom),u_unpack:new h.Uniform4f(p,i.u_unpack)}),line:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_pixels_to_tile_units:new h.UniformMatrix2f(p,i.u_pixels_to_tile_units),u_device_pixel_ratio:new h.Uniform1f(p,i.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(p,i.u_units_to_pixels),u_dash_image:new h.Uniform1i(p,i.u_dash_image),u_gradient_image:new h.Uniform1i(p,i.u_gradient_image),u_image_height:new h.Uniform1f(p,i.u_image_height),u_texsize:new h.Uniform2f(p,i.u_texsize),u_scale:new h.Uniform3f(p,i.u_scale),u_mix:new h.Uniform1f(p,i.u_mix),u_alpha_discard_threshold:new h.Uniform1f(p,i.u_alpha_discard_threshold)}),linePattern:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_texsize:new h.Uniform2f(p,i.u_texsize),u_pixels_to_tile_units:new h.UniformMatrix2f(p,i.u_pixels_to_tile_units),u_device_pixel_ratio:new h.Uniform1f(p,i.u_device_pixel_ratio),u_image:new h.Uniform1i(p,i.u_image),u_units_to_pixels:new h.Uniform2f(p,i.u_units_to_pixels),u_scale:new h.Uniform3f(p,i.u_scale),u_fade:new h.Uniform1f(p,i.u_fade),u_alpha_discard_threshold:new h.Uniform1f(p,i.u_alpha_discard_threshold)}),raster:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_tl_parent:new h.Uniform2f(p,i.u_tl_parent),u_scale_parent:new h.Uniform1f(p,i.u_scale_parent),u_fade_t:new h.Uniform1f(p,i.u_fade_t),u_opacity:new h.Uniform1f(p,i.u_opacity),u_image0:new h.Uniform1i(p,i.u_image0),u_image1:new h.Uniform1i(p,i.u_image1),u_brightness_low:new h.Uniform1f(p,i.u_brightness_low),u_brightness_high:new h.Uniform1f(p,i.u_brightness_high),u_saturation_factor:new h.Uniform1f(p,i.u_saturation_factor),u_contrast_factor:new h.Uniform1f(p,i.u_contrast_factor),u_spin_weights:new h.Uniform3f(p,i.u_spin_weights),u_perspective_transform:new h.Uniform2f(p,i.u_perspective_transform)}),symbolIcon:(p,i)=>({u_is_size_zoom_constant:new h.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new h.Uniform1f(p,i.u_size_t),u_size:new h.Uniform1f(p,i.u_size),u_camera_to_center_distance:new h.Uniform1f(p,i.u_camera_to_center_distance),u_rotate_symbol:new h.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new h.Uniform1f(p,i.u_fade_change),u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new h.Uniform1i(p,i.u_is_text),u_pitch_with_map:new h.Uniform1i(p,i.u_pitch_with_map),u_texsize:new h.Uniform2f(p,i.u_texsize),u_tile_id:new h.Uniform3f(p,i.u_tile_id),u_zoom_transition:new h.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(p,i.u_merc_center),u_camera_forward:new h.Uniform3f(p,i.u_camera_forward),u_tile_matrix:new h.UniformMatrix4f(p,i.u_tile_matrix),u_ecef_origin:new h.Uniform3f(p,i.u_ecef_origin),u_texture:new h.Uniform1i(p,i.u_texture)}),symbolSDF:(p,i)=>({u_is_size_zoom_constant:new h.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new h.Uniform1f(p,i.u_size_t),u_size:new h.Uniform1f(p,i.u_size),u_camera_to_center_distance:new h.Uniform1f(p,i.u_camera_to_center_distance),u_rotate_symbol:new h.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new h.Uniform1f(p,i.u_fade_change),u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new h.Uniform1i(p,i.u_is_text),u_pitch_with_map:new h.Uniform1i(p,i.u_pitch_with_map),u_texsize:new h.Uniform2f(p,i.u_texsize),u_texture:new h.Uniform1i(p,i.u_texture),u_gamma_scale:new h.Uniform1f(p,i.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(p,i.u_device_pixel_ratio),u_tile_id:new h.Uniform3f(p,i.u_tile_id),u_zoom_transition:new h.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new h.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new h.Uniform2f(p,i.u_merc_center),u_camera_forward:new h.Uniform3f(p,i.u_camera_forward),u_tile_matrix:new h.UniformMatrix4f(p,i.u_tile_matrix),u_ecef_origin:new h.Uniform3f(p,i.u_ecef_origin),u_is_halo:new h.Uniform1i(p,i.u_is_halo)}),symbolTextAndIcon:(p,i)=>({u_is_size_zoom_constant:new h.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new h.Uniform1f(p,i.u_size_t),u_size:new h.Uniform1f(p,i.u_size),u_camera_to_center_distance:new h.Uniform1f(p,i.u_camera_to_center_distance),u_rotate_symbol:new h.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new h.Uniform1f(p,i.u_fade_change),u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new h.Uniform1i(p,i.u_is_text),u_pitch_with_map:new h.Uniform1i(p,i.u_pitch_with_map),u_texsize:new h.Uniform2f(p,i.u_texsize),u_texsize_icon:new h.Uniform2f(p,i.u_texsize_icon),u_texture:new h.Uniform1i(p,i.u_texture),u_texture_icon:new h.Uniform1i(p,i.u_texture_icon),u_gamma_scale:new h.Uniform1f(p,i.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(p,i.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(p,i.u_is_halo)}),background:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_opacity:new h.Uniform1f(p,i.u_opacity),u_color:new h.UniformColor(p,i.u_color)}),backgroundPattern:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_opacity:new h.Uniform1f(p,i.u_opacity),u_image:new h.Uniform1i(p,i.u_image),u_pattern_tl_a:new h.Uniform2f(p,i.u_pattern_tl_a),u_pattern_br_a:new h.Uniform2f(p,i.u_pattern_br_a),u_pattern_tl_b:new h.Uniform2f(p,i.u_pattern_tl_b),u_pattern_br_b:new h.Uniform2f(p,i.u_pattern_br_b),u_texsize:new h.Uniform2f(p,i.u_texsize),u_mix:new h.Uniform1f(p,i.u_mix),u_pattern_size_a:new h.Uniform2f(p,i.u_pattern_size_a),u_pattern_size_b:new h.Uniform2f(p,i.u_pattern_size_b),u_scale_a:new h.Uniform1f(p,i.u_scale_a),u_scale_b:new h.Uniform1f(p,i.u_scale_b),u_pixel_coord_upper:new h.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(p,i.u_pixel_coord_lower),u_tile_units_to_pixels:new h.Uniform1f(p,i.u_tile_units_to_pixels)}),terrainRaster:Gn,terrainDepth:Gn,skybox:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_sun_direction:new h.Uniform3f(p,i.u_sun_direction),u_cubemap:new h.Uniform1i(p,i.u_cubemap),u_opacity:new h.Uniform1f(p,i.u_opacity),u_temporal_offset:new h.Uniform1f(p,i.u_temporal_offset)}),skyboxGradient:(p,i)=>({u_matrix:new h.UniformMatrix4f(p,i.u_matrix),u_color_ramp:new h.Uniform1i(p,i.u_color_ramp),u_center_direction:new h.Uniform3f(p,i.u_center_direction),u_radius:new h.Uniform1f(p,i.u_radius),u_opacity:new h.Uniform1f(p,i.u_opacity),u_temporal_offset:new h.Uniform1f(p,i.u_temporal_offset)}),skyboxCapture:(p,i)=>({u_matrix_3f:new h.UniformMatrix3f(p,i.u_matrix_3f),u_sun_direction:new h.Uniform3f(p,i.u_sun_direction),u_sun_intensity:new h.Uniform1f(p,i.u_sun_intensity),u_color_tint_r:new h.Uniform4f(p,i.u_color_tint_r),u_color_tint_m:new h.Uniform4f(p,i.u_color_tint_m),u_luminance:new h.Uniform1f(p,i.u_luminance)}),globeRaster:(p,i)=>({u_proj_matrix:new h.UniformMatrix4f(p,i.u_proj_matrix),u_globe_matrix:new h.UniformMatrix4f(p,i.u_globe_matrix),u_merc_matrix:new h.UniformMatrix4f(p,i.u_merc_matrix),u_zoom_transition:new h.Uniform1f(p,i.u_zoom_transition),u_merc_center:new h.Uniform2f(p,i.u_merc_center),u_image0:new h.Uniform1i(p,i.u_image0),u_grid_matrix:new h.UniformMatrix3f(p,i.u_grid_matrix)}),globeAtmosphere:(p,i)=>({u_frustum_tl:new h.Uniform3f(p,i.u_frustum_tl),u_frustum_tr:new h.Uniform3f(p,i.u_frustum_tr),u_frustum_br:new h.Uniform3f(p,i.u_frustum_br),u_frustum_bl:new h.Uniform3f(p,i.u_frustum_bl),u_globe_pos:new h.Uniform3f(p,i.u_globe_pos),u_globe_radius:new h.Uniform1f(p,i.u_globe_radius),u_opacity:new h.Uniform1f(p,i.u_opacity),u_fadeout_range:new h.Uniform1f(p,i.u_fadeout_range),u_start_color:new h.Uniform3f(p,i.u_start_color),u_end_color:new h.Uniform3f(p,i.u_end_color)})};let Ks;function Nf(p,i,d,_,b,w,C){const S=p.context,P=S.gl,R=p.useProgram("collisionBox"),L=[];let B=0,H=0;for(let _e=0;_e<_.length;_e++){const ve=_[_e],he=i.getTile(ve),Ce=he.getBucket(d);if(!Ce)continue;let Ue=ve.projMatrix;0===b[0]&&0===b[1]||(Ue=p.translatePosMatrix(ve.projMatrix,he,b,w));const We=C?Ce.textCollisionBox:Ce.iconCollisionBox,et=Ce.collisionCircleArray;if(et.length>0){const Je=h.create(),Dt=Ue;h.mul(Je,Ce.placementInvProjMatrix,p.transform.glCoordMatrix),h.mul(Je,Je,Ce.placementViewportMatrix),L.push({circleArray:et,circleOffset:H,transform:Dt,invTransform:Je}),B+=et.length/4,H=B}We&&(p.terrain&&p.terrain.setupElevationDraw(he,R),R.draw(S,P.LINES,h.DepthMode.disabled,h.StencilMode.disabled,p.colorModeForRenderPass(),h.CullFaceMode.disabled,Pm(Ue,p.transform,he),d.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,p.transform.zoom,null,We.collisionVertexBuffer,We.collisionVertexBufferExt))}if(!C||!L.length)return;const te=p.useProgram("collisionCircle"),X=new h.StructArrayLayout2f1f2i16;X.resize(4*B),X._trim();let G=0;for(const _e of L)for(let ve=0;ve<_e.circleArray.length/4;ve++){const he=4*ve,Ce=_e.circleArray[he+0],Ue=_e.circleArray[he+1],We=_e.circleArray[he+2],et=_e.circleArray[he+3];X.emplace(G++,Ce,Ue,We,et,0),X.emplace(G++,Ce,Ue,We,et,1),X.emplace(G++,Ce,Ue,We,et,2),X.emplace(G++,Ce,Ue,We,et,3)}(!Ks||Ks.length<2*B)&&(Ks=function(_e){const ve=2*_e,he=new h.StructArrayLayout3ui6;he.resize(ve),he._trim();for(let Ce=0;Ce<ve;Ce++){const Ue=6*Ce;he.uint16[Ue+0]=4*Ce+0,he.uint16[Ue+1]=4*Ce+1,he.uint16[Ue+2]=4*Ce+2,he.uint16[Ue+3]=4*Ce+2,he.uint16[Ue+4]=4*Ce+3,he.uint16[Ue+5]=4*Ce+0}return he}(B));const ge=S.createIndexBuffer(Ks,!0),ae=S.createVertexBuffer(X,h.collisionCircleLayout.members,!0);for(const _e of L){const ve={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(fe=p.transform).cameraToCenterDistance,u_viewport_size:[fe.width,fe.height]};te.draw(S,P.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,p.colorModeForRenderPass(),h.CullFaceMode.disabled,ve,d.id,ae,ge,h.SegmentVector.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,p.transform.zoom,null,null,null)}var fe;ae.destroy(),ge.destroy()}const hd=h.create();function Wc(p,i,d,_,b,w){const{horizontalAlign:C,verticalAlign:S}=h.getAnchorAlignment(p),P=-(C-.5)*i,R=-(S-.5)*d,L=h.evaluateVariableOffset(p,_);return new h.pointGeometry((P/b+L[0])*w,(R/b+L[1])*w)}function Ua(p,i,d,_,b,w,C,S,P,R,L,B){const H=p.text.placedSymbolArray,te=p.text.dynamicLayoutVertexArray,X=p.icon.dynamicLayoutVertexArray,G={},ge=S.projMatrix,ae=w.elevation,fe=B.upVectorScale(S.canonical,w.center.lat,w.worldSize);te.clear();for(let _e=0;_e<H.length;_e++){const ve=H.get(_e),he=p.allowVerticalPlacement&&!ve.placedOrientation,Ce=ve.hidden||!ve.crossTileID||he?null:_[ve.crossTileID];if(Ce){const Ue=new h.pointGeometry(ve.tileAnchorX,ve.tileAnchorY),We=B.upVector(S.canonical,Ue.x,Ue.y),et=ae?ae.getAtTileOffset(S,Ue.x,Ue.y):0,Je=hi([ve.projectedAnchorX+et*We[0]*fe.metersToTile,ve.projectedAnchorY+et*We[1]*fe.metersToTile,ve.projectedAnchorZ+et*We[2]*fe.metersToTile],d?ge:C),Dt=Dr(w.cameraToCenterDistance,Je.signedDistanceFromCamera);let je=b.evaluateSizeForFeature(p.textSizeData,R,ve)*Dt/h.ONE_EM;d&&(je*=p.tilePixelRatio/P);const{width:yt,height:xt,anchor:Ht,textOffset:Ke,textScale:Kt}=Ce,Qt=Wc(Ht,yt,xt,Ke,Kt,je),jt=d?Cr(Ue.add(Qt),C,et*fe.metersToLabelSpace).point:Je.point.add(i?Qt.rotate(-w.angle):Qt),qt=p.allowVerticalPlacement&&ve.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let an=0;an<ve.numGlyphs;an++)h.addDynamicAttributes(te,jt,qt);L&&ve.associatedIconIndex>=0&&(G[ve.associatedIconIndex]={shiftedAnchor:jt,angle:qt})}else Wr(ve.numGlyphs,te)}if(L){X.clear();const _e=p.icon.placedSymbolArray;for(let ve=0;ve<_e.length;ve++){const he=_e.get(ve);if(he.hidden)Wr(he.numGlyphs,X);else{const Ce=G[ve];if(Ce)for(let Ue=0;Ue<he.numGlyphs;Ue++)h.addDynamicAttributes(X,Ce.shiftedAnchor,Ce.angle);else Wr(he.numGlyphs,X)}}p.icon.dynamicLayoutVertexBuffer.updateData(X)}p.text.dynamicLayoutVertexBuffer.updateData(te)}function Bf(p,i,d){return d.iconsInText&&i?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function hs(p,i,d,_,b,w,C,S,P,R,L,B){const H=p.context,te=H.gl,X=p.transform,G="map"===S,ge="map"===P,ae=G&&"point"!==d.layout.get("symbol-placement"),fe=G&&!ge&&!ae,_e=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let ve=!1;const he=p.depthModeForSublayer(0,h.DepthMode.ReadOnly),Ce=[h.mercatorXfromLng(X.center.lng),h.mercatorYfromLat(X.center.lat)],Ue=d.layout.get("text-variable-anchor"),We="globe"===X.projection.name,et=We?h.globeToMercatorTransition(X.zoom):0,Je=[],Dt=[];p.terrain&&ge&&Dt.push("PITCH_WITH_MAP_TERRAIN"),We&&Dt.push("PROJECTION_GLOBE_VIEW");for(const je of _){const yt=i.getTile(je),xt=yt.getBucket(d);if(!xt||xt.projection!==X.projection.name)continue;const Ht=b?xt.text:xt.icon;if(!Ht||xt.fullyClipped||!Ht.segments.get().length)continue;const Ke=Ht.programConfigurations.get(d.id),Kt=b||xt.sdfIcons,Qt=b?xt.textSizeData:xt.iconSizeData,jt=ge||0!==X.pitch,qt=h.evaluateSizeForZoom(Qt,X.zoom);let an,En,en,vn,Yt=[0,0],ri=null;if(b){if(En=yt.glyphAtlasTexture,en=te.LINEAR,an=yt.glyphAtlasTexture.size,xt.iconsInText){Yt=yt.imageAtlasTexture.size,ri=yt.imageAtlasTexture;const Eo="composite"===Qt.kind||"camera"===Qt.kind;vn=jt||p.options.rotating||p.options.zooming||Eo?te.LINEAR:te.NEAREST}}else{const Eo=1!==d.layout.get("icon-size").constantOr(0)||xt.iconsNeedLinear;En=yt.imageAtlasTexture,en=Kt||p.options.rotating||p.options.zooming||Eo||jt?te.LINEAR:te.NEAREST,an=yt.imageAtlasTexture.size}const uo=p.transform.calculatePixelsToTileUnitsMatrix(yt),ho=gn(je.projMatrix,yt.tileID.canonical,ge,G,p.transform,uo),Ko=p.terrain&&ge&&ae?h.invert(h.create(),ho):hd,Ns=cs(je.projMatrix,yt.tileID.canonical,ge,G,p.transform,uo),wa=Ue&&xt.hasTextData(),tl="none"!==d.layout.get("icon-text-fit")&&wa&&xt.hasIconData();if(ae){const Eo=X.elevation,Bs=Eo?Eo.getAtTileOffsetFunc(je,X.center.lat,X.worldSize,X.projection):Ml=>[0,0,0];Xi(xt,je.projMatrix,p,b,ho,Ns,ge,R,Bs,je)}const Lo=ae||b&&Ue||tl,oi=p.translatePosMatrix(je.projMatrix,yt,w,C),Zn=Lo?hd:ho,sr=p.translatePosMatrix(Ns,yt,w,C,!0),Kr=X.projection.createInversionMatrix(X,je.canonical),Yo=Lo?Dt.concat(["PROJECTED_POS_ON_VIEWPORT"]):Dt,Yr=Kt&&0!==d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let si;si=Kt?xt.iconsInText?tc(Qt.kind,qt,fe,ge,p,oi,Zn,sr,an,Yt,je,et,Ce,Kr):Tl(Qt.kind,qt,fe,ge,p,oi,Zn,sr,b,an,!0,je,et,Ce,Kr):cd(Qt.kind,qt,fe,ge,p,oi,Zn,sr,b,an,je,et,Ce,Kr);const wo={program:p.useProgram(Bf(Kt,b,xt),Ke,Yo),buffers:Ht,uniformValues:si,atlasTexture:En,atlasTextureIcon:ri,atlasInterpolation:en,atlasInterpolationIcon:vn,isSDF:Kt,hasHalo:Yr,tile:yt,labelPlaneMatrixInv:Ko};if(_e&&xt.canOverlap){ve=!0;const Eo=Ht.segments.get();for(const Bs of Eo)Je.push({segments:new h.SegmentVector([Bs]),sortKey:Bs.sortKey,state:wo})}else Je.push({segments:Ht.segments,sortKey:0,state:wo})}ve&&Je.sort((je,yt)=>je.sortKey-yt.sortKey);for(const je of Je){const yt=je.state;if(p.terrain&&p.terrain.setupElevationDraw(yt.tile,yt.program,{useDepthForOcclusion:!We,labelPlaneMatrixInv:yt.labelPlaneMatrixInv}),H.activeTexture.set(te.TEXTURE0),yt.atlasTexture.bind(yt.atlasInterpolation,te.CLAMP_TO_EDGE),yt.atlasTextureIcon&&(H.activeTexture.set(te.TEXTURE1),yt.atlasTextureIcon&&yt.atlasTextureIcon.bind(yt.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),yt.isSDF){const xt=yt.uniformValues;yt.hasHalo&&(xt.u_is_halo=1,Xu(yt.buffers,je.segments,d,p,yt.program,he,L,B,xt)),xt.u_is_halo=0}Xu(yt.buffers,je.segments,d,p,yt.program,he,L,B,yt.uniformValues)}}function Xu(p,i,d,_,b,w,C,S,P){const R=_.context;b.draw(R,R.gl.TRIANGLES,w,C,S,h.CullFaceMode.disabled,P,d.id,p.layoutVertexBuffer,p.indexBuffer,i,d.paint,_.transform.zoom,p.programConfigurations.get(d.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Xc(p,i,d,_,b,w,C){const S=p.context.gl,P=d.paint.get("fill-pattern"),R=P&&P.constantOr(1),L=d.getCrossfadeParameters();let B,H,te,X,G;C?(H=R&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=S.LINES):(H=R?"fillPattern":"fill",B=S.TRIANGLES);for(const ge of _){const ae=i.getTile(ge);if(R&&!ae.patternsLoaded())continue;const fe=ae.getBucket(d);if(!fe)continue;p.prepareDrawTile();const _e=fe.programConfigurations.get(d.id),ve=p.useProgram(H,_e);R&&(p.context.activeTexture.set(S.TEXTURE0),ae.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),_e.updatePaintBuffers(L));const he=P.constantOr(null);if(he&&ae.imageAtlas){const Ue=ae.imageAtlas,We=Ue.patternPositions[he.to.toString()],et=Ue.patternPositions[he.from.toString()];We&&et&&_e.setConstantPatternPositions(We,et)}const Ce=p.translatePosMatrix(ge.projMatrix,ae,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(C){X=fe.indexBuffer2,G=fe.segments2;const Ue=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];te="fillOutlinePattern"===H&&R?Ql(Ce,p,L,ae,Ue):wl(Ce,Ue)}else X=fe.indexBuffer,G=fe.segments,te=R?xo(Ce,p,L,ae):Ro(Ce);p.prepareDrawProgram(p.context,ve,ge.toUnwrapped()),ve.draw(p.context,B,b,p.stencilModeForClipping(ge),w,h.CullFaceMode.disabled,te,d.id,fe.layoutVertexBuffer,X,G,d.paint,p.transform.zoom,_e)}}function Cl(p,i,d,_,b,w,C){const S=p.context,P=S.gl,R=p.transform,L=d.paint.get("fill-extrusion-pattern"),B=L.constantOr(1),H=d.getCrossfadeParameters(),te=d.paint.get("fill-extrusion-opacity"),X=function(_e){if("globe"!==_e.projection.name)return 0;const ve=Math.PI/32,he=Math.tan(ve),Ce=h.earthRadius;return Ce*Math.sqrt(1+2*he*he)-Ce}(R),G="globe"===R.projection.name,ge=G?h.globeToMercatorTransition(R.zoom):0,ae=[h.mercatorXfromLng(R.center.lng),h.mercatorYfromLat(R.center.lat)],fe=[];G&&fe.push("PROJECTION_GLOBE_VIEW");for(const _e of _){const ve=i.getTile(_e),he=ve.getBucket(d);if(!he||he.projection!==R.projection.name)continue;const Ce=he.programConfigurations.get(d.id),Ue=p.useProgram(B?"fillExtrusionPattern":"fillExtrusion",Ce,fe);if(p.terrain){const yt=p.terrain;if(p.style.terrainSetForDrapingOnly())yt.setupElevationDraw(ve,Ue,{useMeterToDem:!0});else{if(!he.enableTerrain)continue;if(yt.setupElevationDraw(ve,Ue,{useMeterToDem:!0}),Dl(S,i,_e,he,d,yt),!he.centroidVertexBuffer){const xt=Ue.attributes.a_centroid_pos;void 0!==xt&&P.vertexAttrib2f(xt,0,0)}}}B&&(p.context.activeTexture.set(P.TEXTURE0),ve.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ce.updatePaintBuffers(H));const We=L.constantOr(null);if(We&&ve.imageAtlas){const yt=ve.imageAtlas,xt=yt.patternPositions[We.to.toString()],Ht=yt.patternPositions[We.from.toString()];xt&&Ht&&Ce.setConstantPatternPositions(xt,Ht)}const et=p.translatePosMatrix(_e.projMatrix,ve,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Je=R.projection.createInversionMatrix(R,_e.canonical),Dt=d.paint.get("fill-extrusion-vertical-gradient"),je=B?Zc(et,p,Dt,te,_e,H,ve,X,ge,ae,Je):qc(et,p,Dt,te,_e,X,ge,ae,Je);p.prepareDrawProgram(S,Ue,_e.toUnwrapped()),Ue.draw(S,S.gl.TRIANGLES,b,w,C,h.CullFaceMode.backCCW,je,d.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,d.paint,p.transform.zoom,Ce,p.terrain?he.centroidVertexBuffer:null,G?he.layoutVertexExtBuffer:null)}}function Dl(p,i,d,_,b,w){const C=[ae=>{let fe=ae.canonical.x-1,_e=ae.wrap;return fe<0&&(fe=(1<<ae.canonical.z)-1,_e--),new h.OverscaledTileID(ae.overscaledZ,_e,ae.canonical.z,fe,ae.canonical.y)},ae=>{let fe=ae.canonical.x+1,_e=ae.wrap;return fe===1<<ae.canonical.z&&(fe=0,_e++),new h.OverscaledTileID(ae.overscaledZ,_e,ae.canonical.z,fe,ae.canonical.y)},ae=>new h.OverscaledTileID(ae.overscaledZ,ae.wrap,ae.canonical.z,ae.canonical.x,(0===ae.canonical.y?1<<ae.canonical.z:ae.canonical.y)-1),ae=>new h.OverscaledTileID(ae.overscaledZ,ae.wrap,ae.canonical.z,ae.canonical.x,ae.canonical.y===(1<<ae.canonical.z)-1?0:ae.canonical.y+1)],S=ae=>{const fe=i.getSource().minzoom,_e=he=>{const Ce=i.getTileByID(he);if(Ce&&Ce.hasData())return Ce.getBucket(b)},ve=[0,-1,1];for(const he of ve){if(ae.overscaledZ+he<fe)continue;const Ce=_e(ae.calculateScaledKey(ae.overscaledZ+he));if(Ce)return Ce}},P=[0,0,0],R=(ae,fe)=>(P[0]=Math.min(ae.min.y,fe.min.y),P[1]=Math.max(ae.max.y,fe.max.y),P[2]=h.EXTENT-fe.min.x>ae.max.x?fe.min.x-h.EXTENT:ae.max.x,P),L=(ae,fe)=>(P[0]=Math.min(ae.min.x,fe.min.x),P[1]=Math.max(ae.max.x,fe.max.x),P[2]=h.EXTENT-fe.min.y>ae.max.y?fe.min.y-h.EXTENT:ae.max.y,P),B=[(ae,fe)=>R(ae,fe),(ae,fe)=>R(fe,ae),(ae,fe)=>L(ae,fe),(ae,fe)=>L(fe,ae)],H=new h.pointGeometry(0,0);let te,X,G;const ge=(ae,fe,_e,ve,he)=>{const Ce=[[ve?_e:ae,ve?ae:_e,0],[ve?_e:fe,ve?fe:_e,0]],Ue=he<0?h.EXTENT+he:he,We=[ve?Ue:(ae+fe)/2,ve?(ae+fe)/2:Ue,0];return 0===_e&&he<0||0!==_e&&he>0?w.getForTilePoints(G,[We],!0,X):Ce.push(We),w.getForTilePoints(d,Ce,!0,te),Math.max(Ce[0][2],Ce[1][2],We[2])/w.exaggeration()};for(let ae=0;ae<4;ae++){const fe=(ae<2?1:5)-ae,_e=_.borders[ae];if(0===_e.length)continue;const ve=G=C[ae](d),he=S(ve);if(!(he&&he instanceof h.FillExtrusionBucket&&he.enableTerrain)||_.borderDoneWithNeighborZ[ae]===he.canonical.z&&he.borderDoneWithNeighborZ[fe]===_.canonical.z||(X=w.findDEMTileFor(ve),!X||!X.dem))continue;if(!te){const et=w.findDEMTileFor(d);if(!et||!et.dem)return;te=et}const Ce=he.borders[fe];let Ue=0;const We=he.borderDoneWithNeighborZ[fe]!==_.canonical.z;if(_.canonical.z===he.canonical.z){for(let et=0;et<_e.length;et++){const Je=_.featuresOnBorder[_e[et]],Dt=Je.borders[ae];let je;for(;Ue<Ce.length&&(je=he.featuresOnBorder[Ce[Ue]],!(je.borders[fe][1]>Dt[0]+3));)We&&he.encodeCentroid(void 0,je,!1),Ue++;if(je&&Ue<Ce.length){const yt=Ue;let xt=0;for(;!(je.borders[fe][0]>Dt[1]-3)&&(xt++,++Ue!==Ce.length);)je=he.featuresOnBorder[Ce[Ue]];if(je=he.featuresOnBorder[Ce[yt]],Je.intersectsCount()>1||je.intersectsCount()>1||1!==xt){1!==xt&&(Ue=yt),_.encodeCentroid(void 0,Je,!1),We&&he.encodeCentroid(void 0,je,!1);continue}const Ht=B[ae](Je,je),Ke=ae%2?h.EXTENT-1:0;H.x=ge(Ht[0],Math.min(h.EXTENT-1,Ht[1]),Ke,ae<2,Ht[2]),H.y=0,_.encodeCentroid(H,Je,!1),We&&he.encodeCentroid(H,je,!1)}else _.encodeCentroid(void 0,Je,!1)}_.borderDoneWithNeighborZ[ae]=he.canonical.z,_.needsCentroidUpdate=!0,We&&(he.borderDoneWithNeighborZ[fe]=_.canonical.z,he.needsCentroidUpdate=!0)}else{for(const et of _e)_.encodeCentroid(void 0,_.featuresOnBorder[et],!1);if(We){for(const et of Ce)he.encodeCentroid(void 0,he.featuresOnBorder[et],!1);he.borderDoneWithNeighborZ[fe]=_.canonical.z,he.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[ae]=he.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(p)}const Kc=new h.Color(1,0,0,1),Ku=new h.Color(0,1,0,1),Yc=new h.Color(0,0,1,1),Jc=new h.Color(1,0,1,1),lo=new h.Color(0,1,1,1);function Ft(p,i,d,_){Va(p,0,i+d/2,p.transform.width,d,_)}function Zo(p,i,d,_){Va(p,i-d/2,0,d,p.transform.height,_)}function Va(p,i,d,_,b,w){const C=p.context,S=C.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*h.exported.devicePixelRatio,d*h.exported.devicePixelRatio,_*h.exported.devicePixelRatio,b*h.exported.devicePixelRatio),C.clear({color:w}),S.disable(S.SCISSOR_TEST)}function dd(p,i,d){const _=p.context,b=_.gl,w="globe"===p.transform.projection.name,C=d.projMatrix,S=p.useProgram("debug",null,w?["PROJECTION_GLOBE_VIEW"]:null),P=i.getTileByID(d.key);p.terrain&&p.terrain.setupElevationDraw(P,S);const R=h.DepthMode.disabled,L=h.StencilMode.disabled,B=p.colorModeForRenderPass(),H="$debug";_.activeTexture.set(b.TEXTURE0),p.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),w?P._makeGlobeTileDebugBuffers(p.context,p.transform.projection):P._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const te=P._tileDebugBuffer||p.debugBuffer,X=P._tileDebugIndexBuffer||p.debugIndexBuffer,G=P._tileDebugSegments||p.debugSegments;S.draw(_,b.LINE_STRIP,R,L,B,h.CullFaceMode.disabled,od(C,h.Color.red),H,te,X,G,null,null,null,P._globeTileDebugBorderBuffer);const ge=P.latestRawTileData,ae=Math.floor((ge&&ge.byteLength||0)/1024),fe=i.getTile(d).tileSize,_e=512/Math.min(fe,512)*(d.overscaledZ/p.transform.zoom)*.5;let ve=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ve+=` => ${d.overscaledZ}`),function(We,et){We.initDebugOverlayCanvas();const Je=We.debugOverlayCanvas,Dt=We.context.gl,je=We.debugOverlayCanvas.getContext("2d");je.clearRect(0,0,Je.width,Je.height),je.shadowColor="white",je.shadowBlur=2,je.lineWidth=1.5,je.strokeStyle="white",je.textBaseline="top",je.font="bold 36px Open Sans, sans-serif",je.fillText(et,5,5),je.strokeText(et,5,5),We.debugOverlayTexture.update(Je),We.debugOverlayTexture.bind(Dt.LINEAR,Dt.CLAMP_TO_EDGE)}(p,`${ve} ${ae}kb`);const he=P._tileDebugTextBuffer||p.debugBuffer,Ce=P._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ue=P._tileDebugTextSegments||p.debugSegments;S.draw(_,b.TRIANGLES,R,L,h.ColorMode.alphaBlended,h.CullFaceMode.disabled,od(C,h.Color.transparent,_e),H,he,Ce,Ue,null,null,null,P._globeTileDebugTextBuffer)}const fd=h.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:va}=fd;function Ys(p,i,d,_){p.emplaceBack(i,d,_)}class $a{constructor(i){this.vertexArray=new h.StructArrayLayout3f12,this.indices=new h.StructArrayLayout3ui6,Ys(this.vertexArray,-1,-1,1),Ys(this.vertexArray,1,-1,1),Ys(this.vertexArray,-1,1,1),Ys(this.vertexArray,1,1,1),Ys(this.vertexArray,-1,-1,-1),Ys(this.vertexArray,1,-1,-1),Ys(this.vertexArray,-1,1,-1),Ys(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,va),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=h.SegmentVector.simpleSegment(0,0,36,12)}}function Ga(p,i,d,_,b,w){const C=p.gl,S=i.paint.get("sky-atmosphere-color"),P=i.paint.get("sky-atmosphere-halo-color"),R=i.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:h.fromMat4(h.create$1(),_),u_sun_direction:b,u_sun_intensity:R,u_color_tint_r:[(X=S).r,X.g,X.b,X.a],u_color_tint_m:[(G=P).r,G.g,G.b,G.a],u_luminance:5e-5};var X,G;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+w,i.skyboxTexture,0),d.draw(p,C.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,h.ColorMode.unblended,h.CullFaceMode.frontCW,L,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}function Pr(p,i){return h.transformMat4(p,p,i)}const Qc={symbol:function(p,i,d,_,b){if("translucent"!==p.renderPass)return;const w=h.StencilMode.disabled,C=p.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(S,P,R,L,B,H,te){const X=P.transform,G="map"===B,ge="map"===H;for(const ae of S){const fe=L.getTile(ae),_e=fe.getBucket(R);if(!_e||_e.projection!==X.projection.name||!_e.text||!_e.text.segments.get().length)continue;const ve=h.evaluateSizeForZoom(_e.textSizeData,X.zoom),he=P.transform.calculatePixelsToTileUnitsMatrix(fe),Ce=gn(ae.projMatrix,fe.tileID.canonical,ge,G,P.transform,he),Ue="none"!==R.layout.get("icon-text-fit")&&_e.hasIconData();if(ve){const We=Math.pow(2,X.zoom-fe.tileID.overscaledZ);Ua(_e,G,ge,te,h.symbolSize,X,Ce,ae,We,ve,Ue,X.projection)}}}(_,p,d,i,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),0!==d.paint.get("icon-opacity").constantOr(1)&&hs(p,i,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),w,C),0!==d.paint.get("text-opacity").constantOr(1)&&hs(p,i,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),w,C),i.map.showCollisionBoxes&&(Nf(p,i,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Nf(p,i,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(p,i,d,_){if("translucent"!==p.renderPass)return;const b=d.paint.get("circle-opacity"),w=d.paint.get("circle-stroke-width"),C=d.paint.get("circle-stroke-opacity"),S=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===w.constantOr(1)||0===C.constantOr(1)))return;const P=p.context,R=P.gl,L=p.transform,B=p.depthModeForSublayer(0,h.DepthMode.ReadOnly),H=h.StencilMode.disabled,te=p.colorModeForRenderPass(),X="globe"===L.projection.name,G=[h.mercatorXfromLng(L.center.lng),h.mercatorYfromLat(L.center.lat)],ge=[];for(let fe=0;fe<_.length;fe++){const _e=_[fe],ve=i.getTile(_e),he=ve.getBucket(d);if(!he)continue;const Ce=he.programConfigurations.get(d.id),Ue=Of(d);X&&Ue.push("PROJECTION_GLOBE_VIEW");const We=p.useProgram("circle",Ce,Ue),et=he.layoutVertexBuffer,Je=he.globeExtVertexBuffer,Dt=he.indexBuffer,je=L.projection.createInversionMatrix(L,_e.canonical),yt={programConfiguration:Ce,program:We,layoutVertexBuffer:et,globeExtVertexBuffer:Je,indexBuffer:Dt,uniformValues:Ki(p,_e,ve,je,G,d),tile:ve};if(S){const xt=he.segments.get();for(const Ht of xt)ge.push({segments:new h.SegmentVector([Ht]),sortKey:Ht.sortKey,state:yt})}else ge.push({segments:he.segments,sortKey:0,state:yt})}S&&ge.sort((fe,_e)=>fe.sortKey-_e.sortKey);const ae={useDepthForOcclusion:!X};for(const fe of ge){const{programConfiguration:_e,program:ve,layoutVertexBuffer:he,globeExtVertexBuffer:Ce,indexBuffer:Ue,uniformValues:We,tile:et}=fe.state,Je=fe.segments;p.terrain&&p.terrain.setupElevationDraw(et,ve,ae),p.prepareDrawProgram(P,ve,et.tileID.toUnwrapped()),ve.draw(P,R.TRIANGLES,B,H,te,h.CullFaceMode.disabled,We,d.id,he,Ue,Je,d.paint,L.zoom,_e,X?Ce:null)}},heatmap:function(p,i,d,_){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const b=p.context,w=b.gl,C=h.StencilMode.disabled,S=new h.ColorMode([w.ONE,w.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function(H,te,X){const G=H.gl;H.activeTexture.set(G.TEXTURE1),H.viewport.set([0,0,te.width/4,te.height/4]);let ge=X.heatmapFbo;if(ge)G.bindTexture(G.TEXTURE_2D,ge.colorAttachment.get()),H.bindFramebuffer.set(ge.framebuffer);else{const ae=G.createTexture();G.bindTexture(G.TEXTURE_2D,ae),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ge=X.heatmapFbo=H.createFramebuffer(te.width/4,te.height/4,!1),function(fe,_e,ve,he){const Ce=fe.gl;Ce.texImage2D(Ce.TEXTURE_2D,0,Ce.RGBA,_e.width/4,_e.height/4,0,Ce.RGBA,fe.extRenderToTextureHalfFloat?fe.extTextureHalfFloat.HALF_FLOAT_OES:Ce.UNSIGNED_BYTE,null),he.colorAttachment.set(ve)}(H,te,ae,ge)}})(b,p,d),b.clear({color:h.Color.transparent});const P=p.transform,R="globe"===P.projection.name,L=R?["PROJECTION_GLOBE_VIEW"]:null,B=[h.mercatorXfromLng(P.center.lng),h.mercatorYfromLat(P.center.lat)];for(let H=0;H<_.length;H++){const te=_[H];if(i.hasRenderableParent(te))continue;const X=i.getTile(te),G=X.getBucket(d);if(!G)continue;const ge=G.programConfigurations.get(d.id),ae=p.useProgram("heatmap",ge,L),{zoom:fe}=p.transform;p.terrain&&p.terrain.setupElevationDraw(X,ae),p.prepareDrawProgram(b,ae,te.toUnwrapped());const _e=P.projection.createInversionMatrix(P,te.canonical);ae.draw(b,w.TRIANGLES,h.DepthMode.disabled,C,S,h.CullFaceMode.disabled,km(p,te,X,_e,B,fe,d.paint.get("heatmap-intensity")),d.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,d.paint,p.transform.zoom,ge,R?G.globeExtVertexBuffer:null)}b.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(b,w){const C=b.context,S=C.gl,P=w.heatmapFbo;if(!P)return;C.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,P.colorAttachment.get()),C.activeTexture.set(S.TEXTURE1);let R=w.colorRampTexture;R||(R=w.colorRampTexture=new h.Texture(C,w.colorRamp,S.RGBA)),R.bind(S.LINEAR,S.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(C,S.TRIANGLES,h.DepthMode.disabled,h.StencilMode.disabled,b.colorModeForRenderPass(),h.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,w.paint,b.transform.zoom)}(p,d))},line:function(p,i,d,_){if("translucent"!==p.renderPass)return;const b=d.paint.get("line-opacity"),w=d.paint.get("line-width");if(0===b.constantOr(1)||0===w.constantOr(1))return;const C=p.depthModeForSublayer(0,h.DepthMode.ReadOnly),S=p.colorModeForRenderPass(),P=p.terrain&&p.terrain.renderingToTexture?1:h.exported.devicePixelRatio,R=d.paint.get("line-dasharray"),L=R.constantOr(1),B=d.layout.get("line-cap"),H=d.paint.get("line-pattern"),te=H.constantOr(1),X=d.paint.get("line-gradient"),G=d.getCrossfadeParameters(),ge=te?"linePattern":"line",ae=p.context,fe=ae.gl,_e=(he=>{const Ce=[];ad(he)&&Ce.push("RENDER_LINE_DASH"),he.paint.get("line-gradient")&&Ce.push("RENDER_LINE_GRADIENT");const Ue=he.paint.get("line-pattern").constantOr(1),We=1!==he.paint.get("line-opacity").constantOr(1);return!Ue&&We&&Ce.push("RENDER_LINE_ALPHA_DISCARD"),Ce})(d);let ve=_e.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ve=!1);for(const he of _){const Ce=i.getTile(he);if(te&&!Ce.patternsLoaded())continue;const Ue=Ce.getBucket(d);if(!Ue)continue;p.prepareDrawTile();const We=Ue.programConfigurations.get(d.id),et=p.useProgram(ge,We,_e),Je=H.constantOr(null);if(Je&&Ce.imageAtlas){const Ke=Ce.imageAtlas,Kt=Ke.patternPositions[Je.to.toString()],Qt=Ke.patternPositions[Je.from.toString()];Kt&&Qt&&We.setConstantPatternPositions(Kt,Qt)}const Dt=R.constantOr(null),je=B.constantOr(null);if(!te&&Dt&&je&&Ce.lineAtlas){const Ke=Ce.lineAtlas,Kt=Ke.getDash(Dt.to,je),Qt=Ke.getDash(Dt.from,je);Kt&&Qt&&We.setConstantPatternPositions(Kt,Qt)}const yt=p.terrain?he.projMatrix:null,xt=te?sd(p,Ce,d,G,yt,P):Rm(p,Ce,d,G,yt,Ue.lineClipsArray.length,P);if(X){const Ke=Ue.gradients[d.id];let Kt=Ke.texture;if(d.gradientVersion!==Ke.version){let Qt=256;if(d.stepInterpolant){const jt=i.getSource().maxzoom,qt=he.canonical.z===jt?Math.ceil(1<<p.transform.maxZoom-he.canonical.z):1;Qt=h.clamp(h.nextPowerOfTwo(Ue.maxLineLength/h.EXTENT*1024*qt),256,ae.maxTextureSize)}Ke.gradient=h.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Qt,image:Ke.gradient||void 0,clips:Ue.lineClipsArray}),Ke.texture?Ke.texture.update(Ke.gradient):Ke.texture=new h.Texture(ae,Ke.gradient,fe.RGBA),Ke.version=d.gradientVersion,Kt=Ke.texture}ae.activeTexture.set(fe.TEXTURE1),Kt.bind(d.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}L&&(ae.activeTexture.set(fe.TEXTURE0),Ce.lineAtlasTexture.bind(fe.LINEAR,fe.REPEAT),We.updatePaintBuffers(G)),te&&(ae.activeTexture.set(fe.TEXTURE0),Ce.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),We.updatePaintBuffers(G)),p.prepareDrawProgram(ae,et,he.toUnwrapped());const Ht=Ke=>{et.draw(ae,fe.TRIANGLES,C,Ke,S,h.CullFaceMode.disabled,xt,d.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,d.paint,p.transform.zoom,We,Ue.layoutVertexBuffer2)};if(ve){const Ke=p.stencilModeForClipping(he).ref;0===Ke&&p.terrain&&ae.clear({stencil:0});const Kt={func:fe.EQUAL,mask:255};xt.u_alpha_discard_threshold=.8,Ht(new h.StencilMode(Kt,Ke,255,fe.KEEP,fe.KEEP,fe.INVERT)),xt.u_alpha_discard_threshold=0,Ht(new h.StencilMode(Kt,Ke,255,fe.KEEP,fe.KEEP,fe.KEEP))}else Ht(p.stencilModeForClipping(he))}ve&&(p.resetStencilClippingMasks(),p.terrain&&ae.clear({stencil:0}))},fill:function(p,i,d,_){const b=d.paint.get("fill-color"),w=d.paint.get("fill-opacity");if(0===w.constantOr(1))return;const C=p.colorModeForRenderPass(),S=d.paint.get("fill-pattern"),P=p.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===b.constantOr(h.Color.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(p.renderPass===P){const R=p.depthModeForSublayer(1,"opaque"===p.renderPass?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly);Xc(p,i,d,_,R,C,!1)}if("translucent"===p.renderPass&&d.paint.get("fill-antialias")){const R=p.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,h.DepthMode.ReadOnly);Xc(p,i,d,_,R,C,!0)}},"fill-extrusion":function(p,i,d,_){const b=d.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===p.renderPass){const w=new h.DepthMode(p.context.gl.LEQUAL,h.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==b||d.paint.get("fill-extrusion-pattern").constantOr(1))Cl(p,i,d,_,w,h.StencilMode.disabled,h.ColorMode.disabled),Cl(p,i,d,_,w,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const C=p.colorModeForRenderPass();Cl(p,i,d,_,w,h.StencilMode.disabled,C)}}},hillshade:function(p,i,d,_){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const b=p.context,w=p.depthModeForSublayer(0,h.DepthMode.ReadOnly),C=p.colorModeForRenderPass(),S=p.terrain&&p.terrain.renderingToTexture,[P,R]="translucent"!==p.renderPass||S?[{},_]:p.stencilConfigForOverlap(_);for(const L of R){const B=i.getTile(L);if(B.needsHillshadePrepare&&"offscreen"===p.renderPass)Cn(p,B,d,w,h.StencilMode.disabled,C);else if("translucent"===p.renderPass){const H=S&&p.terrain?p.terrain.stencilModeForRTTOverlap(L):P[L.overscaledZ];or(p,L,B,d,w,H,C)}}b.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,i,d,_,b,w){if("translucent"!==p.renderPass||0===d.paint.get("raster-opacity")||!_.length)return;const C=p.context,S=C.gl,P=i.getSource(),R=p.useProgram("raster"),L=p.colorModeForRenderPass(),B=p.terrain&&p.terrain.renderingToTexture,[H,te]=P instanceof De||B?[{},_]:p.stencilConfigForOverlap(_),X=te[te.length-1].overscaledZ,G=!p.options.moving;for(const ge of te){const ae=B?h.DepthMode.disabled:p.depthModeForSublayer(ge.overscaledZ-X,1===d.paint.get("raster-opacity")?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly,S.LESS),fe=ge.toUnwrapped(),_e=i.getTile(ge);if(B&&(!_e||!_e.hasData()))continue;const ve=B?ge.projMatrix:p.transform.calculateProjMatrix(fe,G),he=p.terrain&&B?p.terrain.stencilModeForRTTOverlap(ge):H[ge.overscaledZ],Ce=w?0:d.paint.get("raster-fade-duration");_e.registerFadeDuration(Ce);const Ue=i.findLoadedParent(ge,0),We=Rn(_e,Ue,i,p.transform,Ce);let et,Je;p.terrain&&p.terrain.prepareDrawTile();const Dt="nearest"===d.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;C.activeTexture.set(S.TEXTURE0),_e.texture.bind(Dt,S.CLAMP_TO_EDGE),C.activeTexture.set(S.TEXTURE1),Ue?(Ue.texture.bind(Dt,S.CLAMP_TO_EDGE),et=Math.pow(2,Ue.tileID.overscaledZ-_e.tileID.overscaledZ),Je=[_e.tileID.canonical.x*et%1,_e.tileID.canonical.y*et%1]):_e.texture.bind(Dt,S.CLAMP_TO_EDGE);const je=Ff(ve,Je||[0,0],et||1,We,d,P instanceof De?P.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(C,R,fe),P instanceof De)P.boundsBuffer&&P.boundsSegments&&R.draw(C,S.TRIANGLES,ae,h.StencilMode.disabled,L,h.CullFaceMode.disabled,je,d.id,P.boundsBuffer,p.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:yt,tileBoundsIndexBuffer:xt,tileBoundsSegments:Ht}=p.getTileBoundsBuffers(_e);R.draw(C,S.TRIANGLES,ae,he,L,h.CullFaceMode.disabled,je,d.id,yt,xt,Ht)}}p.resetStencilClippingMasks()},background:function(p,i,d,_){const b=d.paint.get("background-color"),w=d.paint.get("background-opacity");if(0===w)return;const C=p.context,S=C.gl,P=p.transform,R=P.tileSize,L=d.paint.get("background-pattern");if(p.isPatternMissing(L))return;const B=!L&&1===b.a&&1===w&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==B)return;const H=h.StencilMode.disabled,te=p.depthModeForSublayer(0,"opaque"===B?h.DepthMode.ReadWrite:h.DepthMode.ReadOnly),X=p.colorModeForRenderPass(),G=p.useProgram(L?"backgroundPattern":"background");let ge,ae=_;ae||(ge=p.getBackgroundTiles(),ae=Object.values(ge).map(_e=>_e.tileID)),L&&(C.activeTexture.set(S.TEXTURE0),p.imageManager.bind(p.context));const fe=d.getCrossfadeParameters();for(const _e of ae){const ve=_e.toUnwrapped(),he=_?_e.projMatrix:p.transform.calculateProjMatrix(ve);p.prepareDrawTile();const Ce=i?i.getTile(_e):ge?ge[_e.key]:new h.Tile(_e,R,P.zoom,p),Ue=L?ud(he,w,p,L,{tileID:_e,tileSize:R},fe):zf(he,w,b);p.prepareDrawProgram(C,G,ve);const{tileBoundsBuffer:We,tileBoundsIndexBuffer:et,tileBoundsSegments:Je}=p.getTileBoundsBuffers(Ce);G.draw(C,S.TRIANGLES,te,H,X,h.CullFaceMode.disabled,Ue,d.id,We,et,Je)}},sky:function(p,i,d){const _=p.transform,b="mercator"===_.projection.name||"globe"===_.projection.name?1:h.smoothstep(7,8,_.zoom),w=d.paint.get("sky-opacity")*b;if(0===w)return;const C=p.context,S=d.paint.get("sky-type"),P=new h.DepthMode(C.gl.LEQUAL,h.DepthMode.ReadOnly,[0,1]),R=p.frameCounter/1e3%1;"atmosphere"===S?"offscreen"===p.renderPass?d.needsSkyboxCapture(p)&&(function(L,B,H,te){const X=L.context,G=X.gl;let ge=B.skyboxFbo;if(!ge){ge=B.skyboxFbo=X.createFramebuffer(32,32,!1),B.skyboxGeometry=new $a(X),B.skyboxTexture=X.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,B.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let ve=0;ve<6;++ve)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+ve,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(ge.framebuffer),X.viewport.set([0,0,32,32]);const ae=B.getCenter(L,!0),fe=L.useProgram("skyboxCapture"),_e=new Float64Array(16);h.identity(_e),h.rotateY(_e,_e,.5*-Math.PI),Ga(X,B,fe,_e,ae,0),h.identity(_e),h.rotateY(_e,_e,.5*Math.PI),Ga(X,B,fe,_e,ae,1),h.identity(_e),h.rotateX(_e,_e,.5*-Math.PI),Ga(X,B,fe,_e,ae,2),h.identity(_e),h.rotateX(_e,_e,.5*Math.PI),Ga(X,B,fe,_e,ae,3),h.identity(_e),Ga(X,B,fe,_e,ae,4),h.identity(_e),h.rotateY(_e,_e,Math.PI),Ga(X,B,fe,_e,ae,5),X.viewport.set([0,0,L.width,L.height])}(p,d),d.markSkyboxValid(p)):"sky"===p.renderPass&&function(L,B,H,te,X){const G=L.context,ge=G.gl,ae=L.transform,fe=L.useProgram("skybox");G.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_CUBE_MAP,B.skyboxTexture);const _e={u_matrix:ae.skyboxMatrix,u_sun_direction:B.getCenter(L,!1),u_cubemap:0,u_opacity:te,u_temporal_offset:X};L.prepareDrawProgram(G,fe),fe.draw(G,ge.TRIANGLES,H,h.StencilMode.disabled,L.colorModeForRenderPass(),h.CullFaceMode.backCW,_e,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(p,d,P,w,R):"gradient"===S&&"sky"===p.renderPass&&function(L,B,H,te,X){const G=L.context,ge=G.gl,ae=L.transform,fe=L.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new $a(G)),G.activeTexture.set(ge.TEXTURE0);let _e=B.colorRampTexture;_e||(_e=B.colorRampTexture=new h.Texture(G,B.colorRamp,ge.RGBA)),_e.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);const ve=(he=ae.skyboxMatrix,Ce=B.getCenter(L,!1),Ue=B.paint.get("sky-gradient-radius"),We=te,et=X,{u_matrix:he,u_color_ramp:0,u_center_direction:Ce,u_radius:h.degToRad(Ue),u_opacity:We,u_temporal_offset:et});var he,Ce,Ue,We,et;L.prepareDrawProgram(G,fe),fe.draw(G,ge.TRIANGLES,H,h.StencilMode.disabled,L.colorModeForRenderPass(),h.CullFaceMode.backCW,ve,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(p,d,P,w,R)},debug:function(p,i,d){for(let _=0;_<d.length;_++)dd(p,i,d[_])},custom:function(p,i,d){const _=p.context,b=d.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))h.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===p.renderPass){const w=b.prerender;w&&(p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),w.call(b,_.gl,p.transform.customLayerMatrix()),_.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),_.setStencilMode(h.StencilMode.disabled);const w="3d"===b.renderingMode?new h.DepthMode(p.context.gl.LEQUAL,h.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,h.DepthMode.ReadOnly);_.setDepthMode(w),b.render(_.gl,p.transform.customLayerMatrix()),_.setDirty(),p.setBaseState(),_.bindFramebuffer.set(null)}}};class pd{constructor(i,d){this.context=new z(i),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=h.SourceCache.maxUnderzooming+h.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ks,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(i,d){const _=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Hr(this,i));const b=this._terrain;this.transform.elevation=_?b:null,b.update(i,this.transform,d)}_updateFog(i){const d=i.fog;if(!d||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,b]=d.getFovAdjustedRange(this.transform._fov);if(_>b)return void(this.transform.fogCullDistSq=null);const w=_+.78*(b-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,d){if(this.width=i*h.exported.devicePixelRatio,this.height=d*h.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const i=this.context,d=new h.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(h.EXTENT,0),d.emplaceBack(0,h.EXTENT),d.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(d,h.posAttributes.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const _=new h.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(h.EXTENT,0),_.emplaceBack(0,h.EXTENT),_.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=i.createVertexBuffer(_,h.posAttributes.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const b=new h.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(b,h.posAttributes.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const w=new h.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(h.EXTENT,0,h.EXTENT,0),w.emplaceBack(0,h.EXTENT,0,h.EXTENT),w.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(w,h.boundsAttributes.members),this.mercatorBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const C=new h.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(C);const S=new h.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])S.emplaceBack(R);this.debugIndexBuffer=i.createIndexBuffer(S),this.emptyTexture=new h.Texture(i,new h.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=h.create();const P=this.context.gl;this.stencilClearMode=new h.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(h.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,d=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(i,d.TRIANGLES,h.DepthMode.disabled,this.stencilClearMode,h.ColorMode.disabled,h.CullFaceMode.disabled,vo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(i,d,_){if(!d||this.currentStencilSource===d.id||!i.isTileClipped()||!_||0===_.length)return;const b=[];let w=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const L of _)if(this._tileClippingMaskIDs.has(L.key)||(w=!0),this._skippedStencilTileIDs.has(L.key)){if(!d.getTile(L).getBucket(i))continue;this._skippedStencilTileIDs.delete(L.key),b.push(L)}if(!w&&0===b.length)return}const C=this.context,S=C.gl;C.setColorMode(h.ColorMode.disabled),C.setDepthMode(h.DepthMode.disabled);const P=this.useProgram("clippingMask"),R=L=>{const B=d.getTile(L),{tileBoundsBuffer:H,tileBoundsIndexBuffer:te,tileBoundsSegments:X}=this.getTileBoundsBuffers(B);P.draw(C,S.TRIANGLES,h.DepthMode.disabled,new h.StencilMode({func:S.GREATER,mask:255},this._tileClippingMaskIDs.get(L.key)||0,255,S.KEEP,S.KEEP,S.REPLACE),h.ColorMode.disabled,h.CullFaceMode.disabled,vo(L.projMatrix),"$clipping",H,te,X)};if(!w&&b.length>0)for(const L of b)R(L);else{(0===this._tileClippingMaskIDs.size||this.nextStencilID+_.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const L of _)this._tileClippingMaskIDs.set(L.key,this.nextStencilID++),d.getTile(L).getBucket(i)?R(L):this._skippedStencilTileIDs.add(L.key)}0===this._skippedStencilTileIDs.size&&(this.currentStencilSource=d.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,d=this.context.gl;return new h.StencilMode({func:d.NOTEQUAL,mask:255},i,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const d=this.context.gl;return new h.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs.get(i.key)||0,0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(i){const d=this.context.gl,_=i.sort((C,S)=>S.overscaledZ-C.overscaledZ),b=_[_.length-1].overscaledZ,w=_[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const C={};for(let S=0;S<w;S++)C[S+b]=new h.StencilMode({func:d.GEQUAL,mask:255},S+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=w,[C,_]}return[{[b]:h.StencilMode.disabled},_]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new h.ColorMode([i.CONSTANT_COLOR,i.ONE],new h.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?h.ColorMode.unblended:h.ColorMode.alphaBlended}depthModeForSublayer(i,d,_){if(!this.opaquePassEnabledForLayer())return h.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new h.DepthMode(_||this.context.gl.LEQUAL,d,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,d){this.style=i,this.options=d,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const _=this.style.order,b=this.style._sourceCaches;for(const R in b){const L=b[R];L.used&&L.prepare(this.context)}const w={},C={},S={};for(const R in b){const L=b[R];w[R]=L.getVisibleCoordinates(),C[R]=w[R].slice().reverse(),S[R]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<_.length;R++)if(this.style._layers[_[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new h.GlobeSharedBuffers(this.context)),!h.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const R of _){const L=this.style._layers[R],B=i._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const H=B?C[B.id]:void 0;("custom"===L.type||L.isSky()||H&&H.length)&&this.renderLayer(this,B,L,H)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let P=h.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(P=this.style.fog.properties.get("color")),this.context.clear({color:d.showOverdrawInspector?h.Color.black:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[_[this.currentLayer]],L=i._getLayerSourceCache(R);if(R.isSky())continue;const B=L?C[L.id]:void 0;this._renderTileClippingMasks(R,L,B),this.renderLayer(this,L,R,B)}if(this.renderPass="sky",(h.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const R=this.style._layers[_[this.currentLayer]],L=i._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,L,R,L?C[L.id]:void 0)}for("globe"===this.transform.projection.name&&function(R){const L=R.context,B=L.gl,H=R.transform,te=new h.DepthMode(B.LEQUAL,h.DepthMode.ReadOnly,[0,1]),X=R.useProgram("globeAtmosphere"),G=H.centerOffset,ge=H._camera.getCameraToClipPerspective(H._fov,H.width/H.height,H._nearZ,H._farZ);ge[8]=2*-G.x/H.width,ge[9]=2*G.y/H.height;const ae=h.invert([],ge),fe=h.mul([],ae,H.projMatrix),_e={u_frustum_tl:Pr([-1,1,1],ae),u_frustum_tr:Pr([1,1,1],ae),u_frustum_br:Pr([1,-1,1],ae),u_frustum_bl:Pr([-1,-1,1],ae),u_globe_pos:Pr([H.globeMatrix[12],H.globeMatrix[13],H.globeMatrix[14]],fe),u_globe_radius:H.worldSize/2/Math.PI-1,u_opacity:1-h.globeToMercatorTransition(H.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};R.prepareDrawProgram(L,X);const ve=R.globeSharedBuffers;ve&&X.draw(L,B.TRIANGLES,te,h.StencilMode.disabled,h.ColorMode.alphaBlended,h.CullFaceMode.backCW,_e,"skybox",ve.atmosphereVertexBuffer,ve.atmosphereIndexBuffer,ve.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const R=this.style._layers[_[this.currentLayer]],L=i._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=L?("symbol"===R.type?S:C)[L.id]:void 0;this._renderTileClippingMasks(R,L,L?w[L.id]:void 0),this.renderLayer(this,L,R,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;h.values(this.style._layers).forEach(L=>{const B=i._getLayerSourceCache(L);B&&!L.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<B.getSource().maxzoom)&&(R=B)}),R&&this.options.showTileBoundaries&&Qc.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const L=R.transform.padding;Ft(R,R.transform.height-(L.top||0),3,Kc),Ft(R,L.bottom||0,3,Ku),Zo(R,L.left||0,3,Yc),Zo(R,R.transform.width-(L.right||0),3,Jc);const B=R.transform.centerPoint;var H,te,X,G;Va(H=R,(te=B.x)-1,(X=R.transform.height-B.y)-10,2,20,G=lo),Va(H,te-10,X-1,20,2,G)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(h.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,d,_,b){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||b&&b.length)&&(this.id=_.id,this.gpuTimingStart(_),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(_.type)||Qc[_.type](i,d,_,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let _=this.gpuTimers[i.id];_||(_=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const d={};for(const _ in i){const b=i[_],w=this.context.extTimerQuery,C=w.getQueryObjectEXT(b.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(b.query),d[_]=C}return d}translatePosMatrix(i,d,_,b,w){if(!_[0]&&!_[1])return i;const C=w?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(C){const R=Math.sin(C),L=Math.cos(C);_=[_[0]*L-_[1]*R,_[0]*R+_[1]*L]}const S=[w?_[0]:Nn(d,_[0],this.transform.zoom),w?_[1]:Nn(d,_[1],this.transform.zoom),0],P=new Float32Array(16);return h.translate(P,i,S),P}saveTileTexture(i){const d=this._tileTextures[i.size[0]];d?d.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const d=this._tileTextures[i];return d&&d.length>0?d.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const d=this.imageManager.getPattern(i.from.toString()),_=this.imageManager.getPattern(i.to.toString());return!d||!_}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,d=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),d&&!i&&0!==d.getOpacity(this.transform.pitch)&&_.push("FOG"),i&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(i,d,_){this.cache=this.cache||{};const b=_||[],w=this.currentGlobalDefines().concat(b),C=Fs.cacheKey(i,w,d);return this.cache[C]||(this.cache[C]=new Fs(this.context,i,Mn[i],d,fr[i],w)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=h.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,d,_){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const w=b.getOpacity(this.transform.pitch);0!==w&&d.setFogUniformValues(i,((C,S,P,R)=>{const L=S.properties.get("color"),B=C.frameCounter/1e3%1,H=[L.r/L.a,L.g/L.a,L.b/L.a,R];return{u_fog_matrix:P?C.transform.calculateFogTileMatrix(P):C.identityMat,u_fog_range:S.getFovAdjustedRange(C.transform._fov),u_fog_color:H,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:B}})(this,b,_,w))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,d=i.createTexture();return i.bindTexture(i.TEXTURE_2D,d),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const b of _)d[b.key]=i[b.key]||new h.Tile(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class Ur{constructor(i=0,d=0,_=0,b=0){if(isNaN(i)||i<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=d,this.left=_,this.right=b}interpolate(i,d,_){return null!=d.top&&null!=i.top&&(this.top=h.number(i.top,d.top,_)),null!=d.bottom&&null!=i.bottom&&(this.bottom=h.number(i.bottom,d.bottom,_)),null!=d.left&&null!=i.left&&(this.left=h.number(i.left,d.left,_)),null!=d.right&&null!=i.right&&(this.right=h.number(i.right,d.right,_)),this}getCenter(i,d){const _=h.clamp((this.left+i-this.right)/2,0,i),b=h.clamp((this.top+d-this.bottom)/2,0,d);return new h.pointGeometry(_,b)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Ur(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function md(p,i){const d=h.getColumn(p,3);h.fromQuat(p,i),h.setColumn(p,3,d)}function gd(p,i){const d=h.identity$1([]);return h.rotateZ$1(d,d,-i),h.rotateX$1(d,d,-p),d}function Ha(p,i){const d=[p[0],p[1],0],_=[i[0],i[1],0];if(h.length(d)>=1e-15){const C=h.normalize([],d);h.scale$2(_,C,h.dot(_,C)),i[0]=_[0],i[1]=_[1]}const b=h.cross([],i,p);if(h.len(b)<1e-15)return null;const w=Math.atan2(-b[1],b[0]);return gd(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),w)}class Yi{constructor(i,d){this.position=i,this.orientation=d}get position(){return this._position}set position(i){if(i){const d=i instanceof h.MercatorCoordinate?i:new h.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(d.x=h.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(i,d){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(h.MercatorCoordinate.fromLngLat(i)):0,b=this.position,w=h.MercatorCoordinate.fromLngLat(i,_),C=[w.x-b.x,w.y-b.y,w.z-b.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Ha(C,d)}setPitchBearing(i,d){this.orientation=gd(h.degToRad(i),h.degToRad(-d))}}class nc{constructor(i,d){this._transform=h.identity([]),this.orientation=d,this.position=i}get mercatorPosition(){const i=this.position;return new h.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=h.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var d;i&&h.setColumn(this._transform,3,[(d=i)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||h.identity$1([]),i&&md(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,d){this._orientation=gd(i,d),md(this._transform,this._orientation)}forward(){const i=h.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=h.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=h.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,d){const _=new Float64Array(16);return h.invert(_,this.getWorldToCamera(i,d)),_}getWorldToCameraPosition(i,d,_){const b=this.position;h.scale$2(b,b,-i);const w=new Float64Array(16);return h.fromScaling(w,[_,_,_]),h.translate(w,w,b),w[10]*=d,w}getWorldToCamera(i,d){const _=new Float64Array(16),b=new Float64Array(4),w=this.position;return h.conjugate(b,this._orientation),h.scale$2(w,w,-i),h.fromQuat(_,b),h.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(i,d,_,b){const w=new Float64Array(16);return h.perspective(w,i,d,_,b),w}getDistanceToElevation(i){const d=0===i?0:h.mercatorZfromAltitude(i,this.position[1]),_=this.forward();return(d-this.position[2])/_[2]}clone(){return new nc([...this.position],[...this.orientation])}}function rc(p,i){const d=ji(p),_=function(w,C,S,P,R){const L=new h.LngLat(S.lng-180*Js,S.lat),B=new h.LngLat(S.lng+180*Js,S.lat),H=w.project(L.lng,L.lat),te=w.project(B.lng,B.lat),X=-Math.atan2(te.y-H.y,te.x-H.x),G=h.MercatorCoordinate.fromLngLat(S);G.y=h.clamp(G.y,-.999975,.999975);const ge=G.toLngLat(),ae=w.project(ge.lng,ge.lat),fe=h.MercatorCoordinate.fromLngLat(ge);fe.x+=Js;const _e=fe.toLngLat(),ve=w.project(_e.lng,_e.lat),he=Yu(ve.x-ae.x,ve.y-ae.y,X),Ce=h.MercatorCoordinate.fromLngLat(ge);Ce.y+=Js;const Ue=Ce.toLngLat(),We=w.project(Ue.lng,Ue.lat),et=Yu(We.x-ae.x,We.y-ae.y,X),Je=Math.abs(he.x)/Math.abs(et.y),Dt=h.identity([]);h.rotateZ(Dt,Dt,-X*(1-(R?0:P)));const je=h.identity([]);return h.scale(je,je,[1,1-(1-Je)*P,1]),je[4]=-et.x/et.y*P,h.rotateZ(je,je,X),h.multiply$1(je,Dt,je),je}(p.projection,0,p.center,d,i),b=xa(p);return h.scale(_,_,[b,b,1]),_}function xa(p){const i=p.projection,d=ji(p),_=ic(i,p.center),b=ic(i,h.LngLat.convert(i.center));return Math.pow(2,_*d+(1-d)*b)}function ji(p){const i=p.projection.range;if(!i)return 0;const d=Math.max(p.width,p.height),_=Math.log(d/1024)/Math.LN2;return h.smoothstep(i[0]+_,i[1]+_,p.zoom)}const Js=1/4e4;function ic(p,i){const d=h.clamp(i.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),_=new h.LngLat(i.lng-180*Js,d),b=new h.LngLat(i.lng+180*Js,d),w=p.project(_.lng,d),C=p.project(b.lng,d),S=h.MercatorCoordinate.fromLngLat(_),P=h.MercatorCoordinate.fromLngLat(b),R=C.x-w.x,L=C.y-w.y,B=P.x-S.x,H=P.y-S.y,te=Math.sqrt((B*B+H*H)/(R*R+L*L));return Math.log(te)/Math.LN2}function Yu(p,i,d){const _=Math.cos(d),b=Math.sin(d);return{x:p*_-i*b,y:p*b+i*_}}class ds{constructor(i,d,_,b,w,C,S){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=i||0,this._maxZoom=d||22,this._minPitch=null==_?0:_,this._maxPitch=null==b?60:b,this.setProjection(C),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ur,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new nc,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const i=new ds(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||d)&&this._updateCameraOnTerrain(),(i||d)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return h.pick(this.projection,["name","center","parallels"])}setProjection(i){null==i&&(i={name:"mercator"}),this.projectionOptions=i;const d=this.projection?this.getProjection():void 0;this.projection=h.getProjection(i);const _=this.getProjection();return $(d,_)?null:(this._calcMatrices(),_)}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return h.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const d=-i*Math.PI/180;var _,b,w,C,S,P,R,L,B,H;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new h.ARRAY_TYPE(4),h.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),b=this.rotationMatrix,C=this.angle,S=(w=this.rotationMatrix)[0],P=w[1],R=w[2],L=w[3],B=Math.sin(C),H=Math.cos(C),b[0]=S*H+R*B,b[1]=P*H+L*B,b[2]=S*-B+R*H,b[3]=P*-B+L*H)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const d=h.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const d=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let b=0,w=0;for(let C=0;C<d.length;C++){const S=new h.pointGeometry(d[C][0]*this.width,_+d[C][1]*(this.height-_)),P=i.pointCoordinate(S);if(!P)continue;const R=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);b+=P[3]*R,w+=R}return 0===w?NaN:b/w}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const i=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(i),w=this._mercatorZfromZoom(this._maxZoom),C=Math.max(b-_,w);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let _;_=i.z<this._camera.position[2]?[d.x,d.y,d.z]:[i.x,i.y,i.z];const b=h.length(h.sub([],this._camera.position,_));return h.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let d=!1;if(i.orientation&&!h.exactEquals(i.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(i.orientation)),i.position){const _=[i.position.x,i.position.y,i.position.z];h.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,d=new Yi;return d.position=new h.MercatorCoordinate(i[0],i[1],i[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(i){if(!h.length$1(i))return!1;h.normalize$1(i,i);const d=h.transformQuat([],[0,0,-1],i),_=h.transformQuat([],[0,-1,0],i);if(_[2]<0)return!1;const b=Ha(d,_);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(i){const d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;i[2]=h.clamp(i[2],b/_,b/d),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,d,_){this._unmodified=!1,this._edgeInsets.interpolate(i,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const d=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(i){const d=[new h.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const _=this.pointCoordinate(new h.pointGeometry(0,0)),b=this.pointCoordinate(new h.pointGeometry(this.width,0)),w=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),C=this.pointCoordinate(new h.pointGeometry(0,this.height)),S=Math.floor(Math.min(_.x,b.x,w.x,C.x)),P=Math.floor(Math.max(_.x,b.x,w.x,C.x)),R=1;for(let L=S-R;L<=P+R;L++)0!==L&&d.push(new h.UnwrappedTileID(L,i))}return d}coveringTiles(i){let d=this.coveringZoomLevel(i);const _=d,b=this.elevation&&!i.isTerrainDEM,w="mercator"===this.projection.name;if(void 0!==i.minzoom&&d<i.minzoom)return[];void 0!==i.maxzoom&&d>i.maxzoom&&(d=i.maxzoom);const C=this.locationCoordinate(this.center),S=this.center.lat,P=1<<d,R=[P*C.x,P*C.y,0],L="globe"===this.projection.name,B=!L,H=h.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,B),te=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=P*h.mercatorZfromAltitude(1,this.center.lat),G=this._camera.position[2]/h.mercatorZfromAltitude(1,this.center.lat),ge=[P*te.x,P*te.y,G*(B?1:X)],ae=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),fe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,_e=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ve=i.isTerrainDEM?-_e:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?xa(this):1,Ce=Ke=>{const Qt=new h.MercatorCoordinate(Ke.x+25e-6,Ke.y,Ke.z),jt=new h.MercatorCoordinate(Ke.x,Ke.y+25e-6,Ke.z),qt=Ke.toLngLat(),an=Qt.toLngLat(),En=jt.toLngLat(),en=this.locationCoordinate(qt),vn=this.locationCoordinate(an),Yt=this.locationCoordinate(En),ri=Math.hypot(vn.x-en.x,vn.y-en.y),uo=Math.hypot(Yt.x-en.x,Yt.y-en.y);return Math.sqrt(ri*uo)*he/25e-6},Ue=Ke=>{const Kt=_e,Qt=ve;return{aabb:h.tileAABB(this,P,0,0,0,Ke,Qt,Kt,this.projection),zoom:0,x:0,y:0,minZ:Qt,maxZ:Kt,wrap:Ke,fullyVisible:!1}},We=[];let et=[];const Je=d,Dt=i.reparseOverscaled?_:d,je=Ke=>Ke*Ke,yt=je((G-this._centerAltitude)*X),xt=Ke=>{if(!this._elevation||!Ke.tileID||!w)return;const Kt=this._elevation.getMinMaxForTile(Ke.tileID),Qt=Ke.aabb;Kt?(Qt.min[2]=Kt.min,Qt.max[2]=Kt.max,Qt.center[2]=(Qt.min[2]+Qt.max[2])/2):(Ke.shouldSplit=Ht(Ke),Ke.shouldSplit||(Qt.min[2]=Qt.max[2]=Qt.center[2]=this._centerAltitude))},Ht=Ke=>{if(Ke.zoom<fe)return!0;if(Ke.zoom===Je)return!1;if(null!=Ke.shouldSplit)return Ke.shouldSplit;const Kt=Ke.aabb.distanceX(ge),Qt=Ke.aabb.distanceY(ge);let jt=yt,qt=1;if(L){jt=je(Ke.aabb.distanceZ(ge));const En=Math.pow(2,Ke.zoom),en=h.latFromMercatorY((Ke.y+1)/En),vn=h.latFromMercatorY(Ke.y/En),Yt=Math.min(Math.max(S,en),vn),ri=h.circumferenceAtLatitude(Yt)/h.circumferenceAtLatitude(S);qt=Math.min(ri,1)}else if(b&&(jt=je(Ke.aabb.distanceZ(ge)*X)),this.projection.isReprojectedInTileSpace&&_<=5){const En=Math.pow(2,Ke.zoom),en=Ce(new h.MercatorCoordinate((Ke.x+.5)/En,(Ke.y+.5)/En));qt=en>.85?1:en}const an=Kt*Kt+Qt*Qt+jt;return an<je((1<<Je-Ke.zoom)*ae*qt*((En,en)=>{if(en*je(.707)<En)return 1;const vn=Math.sqrt(en/En);return vn/(1.4144271570014144+(Math.pow(1.1,vn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(jt,yt),an))};if(this.renderWorldCopies)for(let Ke=1;Ke<=3;Ke++)We.push(Ue(-Ke)),We.push(Ue(Ke));for(We.push(Ue(0));We.length>0;){const Ke=We.pop(),Kt=Ke.x,Qt=Ke.y;let jt=Ke.fullyVisible;if(!jt){const qt=Ke.aabb.intersects(H);if(0===qt)continue;jt=2===qt}if(Ke.zoom!==Je&&Ht(Ke))for(let qt=0;qt<4;qt++){const an=(Kt<<1)+qt%2,En=(Qt<<1)+(qt>>1),en={aabb:w?Ke.aabb.quadrant(qt):h.tileAABB(this,P,Ke.zoom+1,an,En,Ke.wrap,Ke.minZ,Ke.maxZ,this.projection),zoom:Ke.zoom+1,x:an,y:En,wrap:Ke.wrap,fullyVisible:jt,tileID:void 0,shouldSplit:void 0,minZ:Ke.minZ,maxZ:Ke.maxZ};b&&!L&&(en.tileID=new h.OverscaledTileID(Ke.zoom+1===Je?Dt:Ke.zoom+1,Ke.wrap,Ke.zoom+1,an,En),xt(en)),We.push(en)}else{const qt=Ke.zoom===Je?Dt:Ke.zoom;if(i.minzoom&&i.minzoom>qt)continue;const an=R[0]-(.5+Kt+(Ke.wrap<<Ke.zoom))*(1<<d-Ke.zoom),En=R[1]-.5-Qt,en=Ke.tileID?Ke.tileID:new h.OverscaledTileID(qt,Ke.wrap,Ke.zoom,Kt,Qt);et.push({tileID:en,distanceSq:an*an+En*En})}}if(this.fogCullDistSq){const Ke=this.fogCullDistSq,Kt=this.horizonLineFromTop();et=et.filter(Qt=>{const jt=[0,0,0,1],qt=[h.EXTENT,h.EXTENT,0,1],an=this.calculateFogTileMatrix(Qt.tileID.toUnwrapped());h.transformMat4$1(jt,jt,an),h.transformMat4$1(qt,qt,an);const En=h.getAABBPointSquareDist(jt,qt);if(0===En)return!0;let en=!1;const vn=this._elevation;if(vn&&En>Ke&&0!==Kt){const Yt=this.calculateProjMatrix(Qt.tileID.toUnwrapped());let ri;i.isTerrainDEM||(ri=vn.getMinMaxForTile(Qt.tileID)),ri||(ri={min:ve,max:_e});const uo=h.furthestTileCorner(this.rotation),ho=[uo[0]*h.EXTENT,uo[1]*h.EXTENT,ri.max];h.transformMat4(ho,ho,Yt),en=(1-ho[1])*this.height*.5<Kt}return En<Ke||en})}return et.sort((Ke,Kt)=>Ke.distanceSq-Kt.distanceSq).map(Ke=>Ke.tileID)}resize(i,d){this.width=i,this.height=d,this.pixelsToGLUnits=[2/i,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const d=h.clamp(i.lat,-h.MAX_MERCATOR_LATITUDE,h.MAX_MERCATOR_LATITUDE),_=this.projection.project(i.lng,d);return new h.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,d){let _,b;const w=this.centerPoint;if("globe"===this.projection.name){const S=this.worldSize;_=(d.x-w.x)/S,b=(d.y-w.y)/S}else{const S=this.pointCoordinate(d),P=this.pointCoordinate(w);_=S.x-P.x,b=S.y-P.y}const C=this.locationCoordinate(i);this.setLocation(new h.MercatorCoordinate(C.x-_,C.y-b))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,d){const _=d?h.mercatorZfromAltitude(d,i.lat):void 0,b=this.projection.project(i.lng,i.lat);return new h.MercatorCoordinate(b.x,b.y,_)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,d){const _=null!=d?d:this._centerAltitude,b=[i.x,i.y,0,1],w=[i.x,i.y,1,1];h.transformMat4$1(b,b,this.pixelMatrixInverse),h.transformMat4$1(w,w,this.pixelMatrixInverse);const C=w[3];h.scale$1(b,b,1/b[3]),h.scale$1(w,w,1/C);const S=b[2],P=w[2];return{p0:b,p1:w,t:S===P?0:(_-S)/(P-S)}}screenPointToMercatorRay(i){const d=[i.x,i.y,0,1],_=[i.x,i.y,1,1];return h.transformMat4$1(d,d,this.pixelMatrixInverse),h.transformMat4$1(_,_,this.pixelMatrixInverse),h.scale$1(d,d,1/d[3]),h.scale$1(_,_,1/_[3]),d[2]=h.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,_[2]=h.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,h.scale$1(d,d,1/this.worldSize),h.scale$1(_,_,1/this.worldSize),new h.Ray([d[0],d[1],d[2]],h.normalize([],h.sub([],_,d)))}rayIntersectionCoordinate(i){const{p0:d,p1:_,t:b}=i,w=h.mercatorZfromAltitude(d[2],this._center.lat),C=h.mercatorZfromAltitude(_[2],this._center.lat);return new h.MercatorCoordinate(h.number(d[0],_[0],b)/this.worldSize,h.number(d[1],_[1],b)/this.worldSize,h.number(w,C,b))}pointCoordinate(i,d=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,d)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);const d=this.elevation;let _=this.elevation.pointCoordinate(i);if(_)return new h.MercatorCoordinate(_[0],_[1],_[2]);let b=0,w=this.horizonLineFromTop();if(i.y>w)return this.pointCoordinate(i);const C=.02*w,S=i.clone();for(let P=0;P<10&&w-b>C;P++){S.y=h.number(b,w,.66);const R=d.pointCoordinate(S);R?(w=S.y,_=R):b=S.y}return _?new h.MercatorCoordinate(_[0],_[1],_[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{const d=this.horizonLineFromTop();return i.y<d}}_coordinatePoint(i,d){const _=d&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,b=[i.x*this.worldSize,i.y*this.worldSize,_+i.toAltitude(),1];return h.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new h.pointGeometry(b[0]/b[3],b[1]/b[3]):new h.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,d){const _=new h.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),b=new h.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),w=new h.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),C=new h.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(_,i),P=this.pointCoordinate(b,i);const R=this.pointCoordinate(w,d),L=this.pointCoordinate(C,d),B=(H,te)=>(te.y-H.y)/(te.x-H.x);return S.y>1&&P.y>=0?S=new h.MercatorCoordinate((1-L.y)/B(L,S)+L.x,1):S.y<0&&P.y<=1&&(S=new h.MercatorCoordinate(-L.y/B(L,S)+L.x,0)),P.y>1&&S.y>=0?P=new h.MercatorCoordinate((1-R.y)/B(R,P)+R.x,1):P.y<0&&S.y<=1&&(P=new h.MercatorCoordinate(-R.y/B(R,P)+R.x,0)),(new h.LngLatBounds).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(R))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length)return this._getBounds(0,0);const d=i.visibleDemTiles.reduce((_,b)=>{if(b.dem){const w=b.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(d.min*i.exaggeration(),d.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return i?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-h.MAX_MERCATOR_LATITUDE,this.maxLat=h.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=h.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=h.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=h.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=h.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,d){return this.projection.createTileMatrix(this,d,i)}calculateDistanceTileData(i){const d=i.key,_=this._distanceTileDataCache;if(_[d])return _[d];const b=i.canonical,w=1/this.height,C=this.cameraWorldSize/this.zoomScale(b.z),S=(b.x+Math.pow(2,b.z)*i.wrap)*C,P=b.y*C,R=this.point,L=this.angle,B=Math.sin(-L),H=-Math.cos(-L);return _[d]={bearing:[B,H],center:[(R.x-S)*w,(R.y-P)*w],scale:C/h.EXTENT*w},_[d]}calculateFogTileMatrix(i){const d=i.key,_=this._fogTileMatrixCache;if(_[d])return _[d];const b=this.calculatePosMatrix(i,this.cameraWorldSize);return h.multiply$1(b,this.worldToFogMatrix,b),_[d]=new Float32Array(b),_[d]}calculateProjMatrix(i,d=!1){const _=i.key,b=d?this._alignedProjMatrixCache:this._projMatrixCache;if(b[_])return b[_];const w=this.calculatePosMatrix(i,this.worldSize);return h.multiply$1(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,w),b[_]=new Float32Array(w),b[_]}calculatePixelsToTileUnitsMatrix(i){const d=i.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];const b=function(w,C){const{scale:S}=w.tileTransform,P=S*h.EXTENT/(w.tileSize*Math.pow(2,C.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return R=new Float32Array(4),H=(L=C.inverseAdjustmentMatrix)[1],te=L[2],X=L[3],ge=(B=[P,P])[1],R[0]=L[0]*(G=B[0]),R[1]=H*G,R[2]=te*ge,R[3]=X*ge,R;var R,L,B,H,te,X,G,ge}(i,this);return _[d]=b,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const d=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=this._camera.forward(),w=h.mercatorZfromAltitude(1,this._center.lat);_[2]/=w,b[2]/=w,h.normalize(b,b);const C=i.raycast(_,b,i.exaggeration());if(C){const S=h.scaleAndAdd([],_,b,C),P=new h.MercatorCoordinate(S[0],S[1],h.mercatorZfromAltitude(S[2],h.latFromMercatorY(S[1]))),R=(P.z+h.length([P.x-_[0],P.y-_[1],P.z-_[2]*w]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const d=h.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),b=i.getAtPointOrZero(new h.MercatorCoordinate(..._)),w=this._minimumHeightOverTerrain()*Math.cos(h.degToRad(this._maxPitch)),C=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*b;if(C<w){const S=this.locationCoordinate(this._center,this._centerAltitude),P=[S.x-_[0],S.y-_[1],S.z-_[2]],R=h.length(P);P[2]-=(w-C)/this._projectionScaler;const L=h.length(P);if(0===L)return;h.scale$2(P,P,R/L*this._projectionScaler),this._camera.position=[S.x-P[0],S.y-P[1],S.z*this._projectionScaler-P[2]],this._camera.orientation=Ha(P,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const B=this.center;return B.lat=h.clamp(B.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(B.lng=h.clamp(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const i=this._unmodified,{x:d,y:_}=this.point;let b=0,w=d,C=_;const S=this.width/2,P=this.height/2,R=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(_-P<R&&(C=R+P),_+P>L&&(C=L-P),L-R<this.height&&(b=Math.max(b,this.height/(L-R)),C=(L+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,te=this.worldSize/2-(B+H)/2;w=(d+te+this.worldSize)%this.worldSize-te,w-S<B&&(w=B+S),w+S>H&&(w=H-S),H-B<this.width&&(b=Math.max(b,this.width/(H-B)),w=(H+B)/2)}w===d&&C===_||(this.center=this.unproject(new h.pointGeometry(w,C))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this._fov/2,d=this.centerOffset,_=this.pixelsPerMeter;this._projectionScaler=_/(h.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(i)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?_:1),w=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);w[8]=2*-d.x/this.width,w[9]=2*d.y/this.height;let C=h.mul([],w,b);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),he=h.identity([]);h.translate(he,he,[ve.x*this.worldSize,ve.y*this.worldSize,0]),h.multiply$1(he,he,rc(this)),h.translate(he,he,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),h.multiply$1(C,C,he),this.inverseAdjustmentMatrix=function(Ce){const Ue=rc(Ce,!0);return Be([],[Ue[0],Ue[1],Ue[4],Ue[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=h.scale([],C,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=C,this.invProjMatrix=h.invert(new Float64Array(16),this.projMatrix);const S=new Float32Array(16);h.identity(S),h.scale(S,S,[1,-1,1]),h.rotateX(S,S,this._pitch),h.rotateZ(S,S,this.angle);const P=h.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-d.x/this.width,P[9]=2*(d.y+R)/this.height,this.skyboxMatrix=h.multiply$1(S,P,S);const L=this.point,B=L.x,H=L.y,te=this.width%2/2,X=this.height%2/2,G=Math.cos(this.angle),ge=Math.sin(this.angle),ae=B-Math.round(B)+G*te+ge*X,fe=H-Math.round(H)+G*X+ge*te,_e=new Float64Array(C);if(h.translate(_e,_e,[ae>.5?ae-1:ae,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=_e,C=h.create(),h.scale(C,C,[this.width/2,-this.height/2,1]),h.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=h.create(),h.scale(C,C,[1,-1,1]),h.translate(C,C,[-1,-1,0]),h.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=h.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},C=h.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");this.pixelMatrixInverse=C,this.globeMatrix="globe"===this.projection.name?h.calculateGlobeMatrix(this):C,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,d=this.cameraPixelsPerMeter,_=this._camera.position,b=1/this.height,w=[i,i,d];h.scale$2(w,w,b),h.scale$2(_,_,-1),h.multiply$2(_,_,w);const C=h.create();h.translate(C,C,_),h.scale(C,C,w),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,d,b)}_computeCameraPosition(i){const d=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),b=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-i/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-_[0]*w,b.y/this.worldSize-_[1]*w,i/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=i[2];let b=1;_>0&&(b=Math.min((d-this._camera.position[2])/_,1)),this._camera.position=h.scaleAndAdd([],this._camera.position,i,b),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const i=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:b}=this._camera.getPitchBearing(),w=h.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(h.degToRad(this._maxPitch)),S=Math.max((i[2]-w)/Math.cos(_),C),P=this._zoomFromMercatorZ(S);h.scaleAndAdd(i,i,d,S),this._pitch=h.clamp(_,h.degToRad(this.minPitch),h.degToRad(this.maxPitch)),this.angle=h.wrap(b,-Math.PI,Math.PI),this._setZoom(h.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new h.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(h.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(i,d){const _=Math.min(i.x,d.x),b=Math.max(i.x,d.x),w=Math.min(i.y,d.y),C=Math.max(i.y,d.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new h.pointGeometry(_,w),new h.pointGeometry(b,C),new h.pointGeometry(_,C),new h.pointGeometry(b,w)],P=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const L of S){const B=this.pointRayIntersection(L);if(B.t<0)return!0;const H=this.rayIntersectionCoordinate(B);if(H.x<P||H.y<0||H.x>R||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+h.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new h.pointGeometry(0,0),new h.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,d){const _=h.length(h.sub([],this._camera.position,i)),b=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(b)}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,i))}}function eu(p,i){let d=!1,_=null;const b=()=>{_=null,d&&(p(),_=setTimeout(b,i),d=!1)};return()=>(d=!0,_||b(),_)}class tu{constructor(i){this._hashName=i&&encodeURIComponent(i),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=eu(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,h.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),h.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(i){const d=this._map;if(!d)return"";const _=d.getCenter(),b=Math.round(100*d.getZoom())/100,w=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,w),S=Math.round(_.lng*C)/C,P=Math.round(_.lat*C)/C,R=d.getBearing(),L=d.getPitch();let B="";if(B+=i?`/${S}/${P}/${b}`:`${b}/${P}/${S}`,(R||L)&&(B+="/"+Math.round(10*R)/10),L&&(B+=`/${Math.round(L)}`),this._hashName){const H=this._hashName;let te=!1;const X=h.window.location.hash.slice(1).split("&").map(G=>{const ge=G.split("=")[0];return ge===H?(te=!0,`${ge}=${B}`):G}).filter(G=>G);return te||X.push(`${H}=${B}`),`#${X.join("&")}`}return`#${B}`}_getCurrentHash(){const i=h.window.location.hash.replace("#","");if(this._hashName){let d;return i.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(d[3]||0):i.getBearing();return i.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=h.window.location.href.replace(/(#.+)?$/,this.getHashString());h.window.history.replaceState(h.window.history.state,null,i)}}const bn={linearity:.3,easing:h.bezier(0,0,.3,1)},jf=h.extend({deceleration:2500,maxSpeed:1400},bn),_d=h.extend({deceleration:20,maxSpeed:1400},bn),yd=h.extend({deceleration:1e3,maxSpeed:360},bn),vd=h.extend({deceleration:1e3,maxSpeed:90},bn);class Ju{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,d=h.exported.now();for(;i.length>0&&d-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const w=Ei(d.pan.mag(),_,h.extend({},jf,i||{}));b.offset=d.pan.mult(w.amount/d.pan.mag()),b.center=this._map.transform.center,oc(b,w)}if(d.zoom){const w=Ei(d.zoom,_,_d);b.zoom=this._map.transform.zoom+w.amount,oc(b,w)}if(d.bearing){const w=Ei(d.bearing,_,yd);b.bearing=this._map.transform.bearing+h.clamp(w.amount,-179,179),oc(b,w)}if(d.pitch){const w=Ei(d.pitch,_,vd);b.pitch=this._map.transform.pitch+w.amount,oc(b,w)}if(b.zoom||b.bearing){const w=void 0===d.pinchAround?d.around:d.pinchAround;b.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function oc(p,i){(!p.duration||p.duration<i.duration)&&(p.duration=i.duration,p.easing=i.easing)}function Ei(p,i,d){const{maxSpeed:_,linearity:b,deceleration:w}=d,C=h.clamp(p*b/(i/1e3),-_,_),S=Math.abs(C)/(w*b);return{easing:d.easing,duration:1e3*S,amount:C*(S/2)}}class ft extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,d,_,b={}){const w=Ae(d.getCanvasContainer(),_),C=d.unproject(w);super(i,h.extend({point:w,lngLat:C,originalEvent:_},b)),this._defaultPrevented=!1,this.target=d}}class rr extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,d,_){const b="touchend"===i?_.changedTouches:_.touches,w=J(d.getCanvasContainer(),b),C=w.map(P=>d.unproject(P)),S=w.reduce((P,R,L,B)=>P.add(R.div(B.length)),new h.pointGeometry(0,0));super(i,{points:w,point:S,lngLats:C,lngLat:d.unproject(S),originalEvent:_}),this._defaultPrevented=!1}}class Uf extends h.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,d,_){super(i,{originalEvent:_}),this._defaultPrevented=!1}}class Ti{constructor(i,d){this._map=i,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Uf(i.type,this._map,i))}mousedown(i,d){return this._mousedownPos=d,this._firePreventable(new ft(i.type,this._map,i))}mouseup(i){this._map.fire(new ft(i.type,this._map,i))}preclick(i){const d=h.extend({},i);d.type="preclick",this._map.fire(new ft(d.type,this._map,d))}click(i,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(i),this._map.fire(new ft(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new ft(i.type,this._map,i))}mouseover(i){this._map.fire(new ft(i.type,this._map,i))}mouseout(i){this._map.fire(new ft(i.type,this._map,i))}touchstart(i){return this._firePreventable(new rr(i.type,this._map,i))}touchmove(i){this._map.fire(new rr(i.type,this._map,i))}touchend(i){this._map.fire(new rr(i.type,this._map,i))}touchcancel(i){this._map.fire(new rr(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zs{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new ft(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ft("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new ft(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Sl{constructor(i,d){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,d){this.isEnabled()&&i.shiftKey&&0===i.button&&(Te(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(i,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=K("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const w=Math.min(b.x,_.x),C=Math.max(b.x,_.x),S=Math.min(b.y,_.y),P=Math.max(b.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${S}px)`,this._box.style.width=C-w+"px",this._box.style.height=P-S+"px")})}mouseupWindow(i,d){if(!this._active||0!==i.button)return;const _=this._startPos,b=d;if(this.reset(),we(),_.x!==b.x||_.y!==b.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(_,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ne(),delete this._startPos,delete this._lastPos}_fireEvent(i,d){return this._map.fire(new h.Event(i,{originalEvent:d}))}}function Ui(p,i){const d={};for(let _=0;_<p.length;_++)d[p[_].identifier]=i[_];return d}class Wo{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=i.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const w=new h.pointGeometry(0,0);for(const C of b)w._add(C);return w.div(b.length)}(d),this.touches=Ui(_,d)))}touchmove(i,d,_){if(this.aborted||!this.centroid)return;const b=Ui(_,d);for(const w in this.touches){const C=this.touches[w],S=b[w];(!S||S.dist(C)>30)&&(this.aborted=!0)}}touchend(i,d,_){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Qs{constructor(i){this.singleTap=new Wo(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,d,_){this.singleTap.touchstart(i,d,_)}touchmove(i,d,_){this.singleTap.touchmove(i,d,_)}touchend(i,d,_){const b=this.singleTap.touchend(i,d,_);if(b){const w=i.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(b)<30;if(w&&C||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Vt{constructor(){this._zoomIn=new Qs({numTouches:1,numTaps:2}),this._zoomOut=new Qs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,d,_){this._zoomIn.touchstart(i,d,_),this._zoomOut.touchstart(i,d,_)}touchmove(i,d,_){this._zoomIn.touchmove(i,d,_),this._zoomOut.touchmove(i,d,_)}touchend(i,d,_){const b=this._zoomIn.touchend(i,d,_),w=this._zoomOut.touchend(i,d,_);return b?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(b)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xd={0:1,2:2};class qa{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,d){return!1}_move(i,d){return{}}mousedown(i,d){if(this._lastPoint)return;const _=ne(i);this._correctButton(i,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(i,d){const _=this._lastPoint;if(_)if(i.preventDefault(),null!=this._eventButton&&function(b,w){const C=xd[w];return void 0===b.buttons||(b.buttons&C)!==C}(i,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}mouseupWindow(i){this._lastPoint&&ne(i)===this._eventButton&&(this._moved&&we(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ba extends qa{mousedown(i,d){super.mousedown(i,d),this._lastPoint&&(this._active=!0)}_correctButton(i,d){return 0===d&&!i.ctrlKey}_move(i,d){return{around:d,panDelta:d.sub(i)}}}class vi extends qa{_correctButton(i,d){return 0===d&&i.ctrlKey||2===d}_move(i,d){const _=.8*(d.x-i.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(i){i.preventDefault()}}class fs extends qa{_correctButton(i,d){return 0===d&&i.ctrlKey||2===d}_move(i,d){const _=-.5*(d.y-i.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(i){i.preventDefault()}}class Qu{constructor(i,d){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),h.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0)}touchstart(i,d,_){return this._calculateTransform(i,d,_)}touchmove(i,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,d,_)}}touchend(i,d,_){this._calculateTransform(i,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,d,_){_.length>0&&(this._active=!0);const b=Ui(_,d),w=new h.pointGeometry(0,0),C=new h.pointGeometry(0,0);let S=0;for(const R in b){const L=b[R],B=this._touches[R];B&&(w._add(L),C._add(L.sub(B)),S++,b[R]=L)}if(this._touches=b,S<this._minTouches||!C.mag())return;const P=C.div(S);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(S),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=K("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class ea{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,d,_){return{}}touchstart(i,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(i,d,_){const b=this._firstTwoTouches;if(!b)return;i.preventDefault();const[w,C]=b,S=Oo(_,d,w),P=Oo(_,d,C);if(!S||!P)return;const R=this._aroundCenter?null:S.add(P).div(2);return this._move([S,P],R,i)}touchend(i,d,_){if(!this._firstTwoTouches)return;const[b,w]=this._firstTwoTouches,C=Oo(_,d,b),S=Oo(_,d,w);C&&S||(this._active&&we(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Oo(p,i,d){for(let _=0;_<p.length;_++)if(p[_].identifier===d)return i[_]}function eh(p,i){return Math.log(p/i)/Math.LN2}class th extends ea{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,d){const _=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(eh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:eh(this._distance,_),pinchAround:d}}}function nh(p,i){return 180*p.angleWith(i)/Math.PI}class nu extends ea{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,d){const _=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:nh(this._vector,_),pinchAround:d}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const d=25/(Math.PI*this._minDiameter)*360,_=nh(i,this._startVector);return Math.abs(_)<d}}function Za(p){return Math.abs(p.y)>Math.abs(p.x)}class Il extends ea{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Za(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,d,_){const b=this._lastPoints;if(!b)return;const w=i[0].sub(b[0]),C=i[1].sub(b[1]);return this._map._cooperativeGestures&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,C,_.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(w.y+C.y)/2*-.5})}gestureBeginsVertically(i,d,_){if(void 0!==this._valid)return this._valid;const b=i.mag()>=2,w=d.mag()>=2;if(!b&&!w)return;if(!b||!w)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const C=i.y>0==d.y>0;return Za(i)&&Za(d)&&C}}const rh={panStep:100,bearingStep:15,pitchStep:10};class ru{constructor(){const i=rh;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let d=0,_=0,b=0,w=0,C=0;switch(i.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:i.shiftKey?_=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?_=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?b=1:(i.preventDefault(),C=-1);break;case 40:i.shiftKey?b=-1:(i.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:S=>{const P=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:bd,zoom:d?Math.round(P)+d*(i.shiftKey?2:1):P,bearing:S.getBearing()+_*this._bearingStep,pitch:S.getPitch()+b*this._pitchStep,offset:[-w*this._panStep,-C*this._panStep],center:S.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bd(p){return p*(2-p)}const iu=4.000244140625;class sc{constructor(i,d){this._map=i,this._el=i.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=i.deltaMode===h.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const _=h.exported.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==d&&d%iu==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),i.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=i,this._delta-=d,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Ae(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,d=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>iu?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==R&&(R=1/R);const L=d(),B=Math.pow(2,L),H="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(H*R))),"wheel"===this._type&&(this._startZoom=d(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:d(),b=this._startZoom,w=this._easing;let C,S=!1;if("wheel"===this._type&&b&&w){const P=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),R=w(P);C=h.number(b,_,R),P<1?this._frameId||(this._frameId=!0):S=!0}else C=_,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:C-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let d=h.ease;if(this._prevEase){const _=this._prevEase,b=(h.exported.now()-_.start)/_.duration,w=_.easing(b+.01)-_.easing(b),C=.27/Math.sqrt(w*w+1e-4)*.01,S=Math.sqrt(.0729-C*C);d=h.bezier(C,S,.25,1)}return this._prevEase={start:h.exported.now(),duration:i,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=K("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(h.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!h.window.document.fullscreenElement||!!h.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class ih{constructor(i,d){this._clickZoom=i,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class oh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,d){return i.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(i.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ou{constructor(){this._tap=new Qs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,d,_){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(i,d,_))}touchmove(i,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=d[0],w=b.y-this._swipePoint.y;return this._swipePoint=b,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,d,_)}touchend(i,d,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(i,d,_)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sh{constructor(i,d,_){this._el=i,this._mousePan=d,this._touchPan=_}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ac{constructor(i,d,_){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class wd{constructor(i,d,_,b){this._el=i,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const lc=p=>p.zoom||p.drag||p.pitch||p.rotate;class Vi extends h.Event{}class ta{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,d){const _=h.sub([],d,i);this.radius=h.length(_[2]<0?h.div([],_,this.constants):[_[0],_[1],0])}projectRay(i){h.div(i,i,this.constants),h.normalize(i,i),h.mul$1(i,i,this.constants);const d=h.scale$2([],i,this.radius);if(d[2]>0){const _=h.scale$2([],[0,0,1],h.dot(d,[0,0,1])),b=h.scale$2([],h.normalize([],[d[0],d[1],0]),this.radius),w=h.add([],d,h.scale$2([],h.sub([],h.add([],b,_),d),2));d[0]=w[0],d[1]=w[1]}return d}}function Vr(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Ed{constructor(i,d){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ju(i),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ta,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),h.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[h.window.document,"mousemove",{capture:!0}],[h.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[h.window,"blur",void 0]];for(const[b,w,C]of this._listeners)b.addEventListener(w,b===h.window.document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[i,d,_]of this._listeners)i.removeEventListener(d,i===h.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(i){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new Ti(d,i));const b=d.boxZoom=new Sl(d,i);this._add("boxZoom",b);const w=new Vt,C=new oh;d.doubleClickZoom=new ih(C,w),this._add("tapZoom",w),this._add("clickZoom",C);const S=new ou;this._add("tapDragZoom",S);const P=d.touchPitch=new Il(d);this._add("touchPitch",P);const R=new vi(i),L=new fs(i);d.dragRotate=new ac(i,R,L),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const B=new ba(i),H=new Qu(d,i);d.dragPan=new sh(_,B,H),this._add("mousePan",B),this._add("touchPan",H,["touchZoom","touchRotate"]);const te=new nu,X=new th;d.touchZoomRotate=new wd(_,X,te,S),this._add("touchRotate",te,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new zs(d));const G=d.scrollZoom=new sc(d,this);this._add("scrollZoom",G,["mousePan"]);const ge=d.keyboard=new ru;this._add("keyboard",ge);for(const ae of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[ae]&&d[ae].enable(i[ae])}_add(i,d,_){this._handlers.push({handlerName:i,handler:d,allowed:_}),this._handlersById[i]=d}stop(i){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!lc(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,d,_){for(const b in i)if(b!==_&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const d=[];for(const _ of i)this._el.contains(_.target)&&d.push(_);return d}handleEvent(i,d){this._updatingCamera=!0;const _="renderFrame"===i.type,b=_?void 0:i,w={needsRenderFrame:!1},C={},S={},P=i.touches?this._getMapTouches(i.touches):void 0,R=P?J(this._el,P):_?void 0:Ae(this._el,i);for(const{handlerName:H,handler:te,allowed:X}of this._handlers){if(!te.isEnabled())continue;let G;this._blockedByActive(S,X,H)?te.reset():te[d||i.type]&&(G=te[d||i.type](i,R,P),this.mergeHandlerResult(w,C,G,H,b),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||te.isActive())&&(S[H]=te)}const L={};for(const H in this._previousActiveHandlers)S[H]||(L[H]=b);this._previousActiveHandlers=S,(Object.keys(L).length||Vr(w))&&(this._changes.push([w,C,L]),this._triggerRenderFrame()),(Object.keys(S).length||Vr(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=w;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(i,d,_,b,w){if(!_)return;h.extend(i,_);const C={handlerName:b,originalEvent:_.originalEvent||w};void 0!==_.zoomDelta&&(d.zoom=C),void 0!==_.panDelta&&(d.drag=C),void 0!==_.pitchDelta&&(d.pitch=C),void 0!==_.bearingDelta&&(d.rotate=C)}_applyChanges(){const i={},d={},_={};for(const[b,w,C]of this._changes)b.panDelta&&(i.panDelta=(i.panDelta||new h.pointGeometry(0,0))._add(b.panDelta)),b.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(i.around=b.around),void 0!==b.aroundCoord&&(i.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(i.pinchAround=b.pinchAround),b.noInertia&&(i.noInertia=b.noInertia),h.extend(d,w),h.extend(_,C);this._updateMapTransform(i,d,_),this._changes=[]}_updateMapTransform(i,d,_){const b=this._map,w=b.transform,C=fe=>[fe.x,fe.y,fe.z];if((fe=>{const _e=this._eventsInProgress.drag;return _e&&!this._handlersById[_e.handlerName].isActive()})()&&!Vr(i)){const fe=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",fe!==w.zoom&&this._map._update(!0)}if(!Vr(i))return void this._fireEvents(d,_,!0);let{panDelta:S,zoomDelta:P,bearingDelta:R,pitchDelta:L,around:B,aroundCoord:H,pinchAround:te}=i;void 0!==te&&(B=te),(fe=>d.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=C(w.pointCoordinate3D(B)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",b._stop(!0),B=B||b.transform.centerPoint,R&&(w.bearing+=R),L&&(w.pitch+=L),w._updateCameraState();const X=[0,0,0];if(S){const fe=w.pointCoordinate(B);if("globe"===w.projection.name){const _e=h.latFromMercatorY(fe.y),ve=w.center.lat,he=Math.min(h.mercatorZfromAltitude(1,_e)/h.mercatorZfromAltitude(1,ve),2);S=S.rotate(-w.angle),X[0]=-S.x/w.worldSize*he,X[1]=-S.y/w.worldSize*he}else{const _e=w.pointCoordinate(B.sub(S));fe&&_e&&(X[0]=_e.x-fe.x,X[1]=_e.y-fe.y)}}const G=w.zoom,ge=[0,0,0];if(P){const fe=C(H||w.pointCoordinate3D(B)),_e={dir:h.normalize([],h.sub([],fe,w._camera.position))};if(_e.dir[2]<0){const ve=w.zoomDeltaToMovement(fe,P);h.scale$2(ge,_e.dir,ve)}}const ae=h.add(X,X,ge);w._translateCameraConstrained(ae),P&&Math.abs(w.zoom-G)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(d,_,!0)}_fireEvents(i,d,_){const b=lc(this._eventsInProgress),w=lc(i),C={};for(const L in i){const{originalEvent:B}=i[L];this._eventsInProgress[L]||(C[`${L}start`]=B),this._eventsInProgress[L]=i[L]}!b&&w&&this._fireEvent("movestart",w.originalEvent);for(const L in C)this._fireEvent(L,C[L]);w&&this._fireEvent("move",w.originalEvent);for(const L in i){const{originalEvent:B}=i[L];this._fireEvent(L,B)}const S={};let P;for(const L in this._eventsInProgress){const{handlerName:B,originalEvent:H}=this._eventsInProgress[L];this._handlersById[B].isActive()||(delete this._eventsInProgress[L],P=d[B]||H,S[`${L}end`]=P)}for(const L in S)this._fireEvent(L,S[L]);const R=lc(this._eventsInProgress);if(_&&(b||w)&&!R){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=H=>0!==H&&-this._bearingSnap<H&&H<this._bearingSnap;L?(B(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:P})):(this._map.fire(new h.Event("moveend",{originalEvent:P})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,d){this._map.fire(new h.Event(i,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Vi("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const su="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ah extends h.Evented{constructor(i,d){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=d.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,d){return this.jumpTo({center:i},d)}panBy(i,d,_){return i=h.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,h.extend({offset:i},d),_)}panTo(i,d,_){return this.easeTo(h.extend({center:i},d),_)}getZoom(){return this.transform.zoom}setZoom(i,d){return this.jumpTo({zoom:i},d),this}zoomTo(i,d,_){return this.easeTo(h.extend({zoom:i},d),_)}zoomIn(i,d){return this.zoomTo(this.getZoom()+1,i,d),this}zoomOut(i,d){return this.zoomTo(this.getZoom()-1,i,d),this}getBearing(){return this.transform.bearing}setBearing(i,d){return this.jumpTo({bearing:i},d),this}getPadding(){return this.transform.padding}setPadding(i,d){return this.jumpTo({padding:i},d),this}rotateTo(i,d,_){return this.easeTo(h.extend({bearing:i},d),_)}resetNorth(i,d){return this.rotateTo(0,h.extend({duration:1e3},i),d),this}resetNorthPitch(i,d){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},i),d),this}snapToNorth(i,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,d):this}getPitch(){return this.transform.pitch}setPitch(i,d){return this.jumpTo({pitch:i},d),this}cameraForBounds(i,d){i=h.LngLatBounds.convert(i);const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),_,d)}_extendCameraOptions(i){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=h.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const _=i.padding;i.padding={top:_,bottom:_,right:_,left:_}}return i.padding=h.extend(d,i.padding),i}_cameraForBoxAndBearing(i,d,_,b){const w=this._extendCameraOptions(b),C=this.transform,S=C.padding,P=C.project(h.LngLat.convert(i)),R=C.project(h.LngLat.convert(d)),L=new h.pointGeometry(P.x,R.y),B=new h.pointGeometry(R.x,P.y),H=-h.degToRad(_),te=P.rotate(H),X=R.rotate(H),G=L.rotate(H),ge=B.rotate(H),ae=new h.pointGeometry(Math.max(te.x,X.x,G.x,ge.x),Math.max(te.y,X.y,G.y,ge.y)),fe=new h.pointGeometry(Math.min(te.x,X.x,G.x,ge.x),Math.min(te.y,X.y,G.y,ge.y)),_e=ae.sub(fe),ve=(C.width-((S.left||0)+(S.right||0)+w.padding.left+w.padding.right))/_e.x,he=(C.height-((S.top||0)+(S.bottom||0)+w.padding.top+w.padding.bottom))/_e.y;if(he<0||ve<0)return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ce=Math.min(C.scaleZoom(C.scale*Math.min(ve,he)),w.maxZoom),Ue="number"==typeof w.offset.x&&"number"==typeof w.offset.y?new h.pointGeometry(w.offset.x,w.offset.y):h.pointGeometry.convert(w.offset),We=new h.pointGeometry((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(_*Math.PI/180),et=Ue.add(We).mult(C.scale/C.zoomScale(Ce));return{center:C.unproject(P.add(R).div(2).sub(et)),zoom:Ce,bearing:_}}_cameraForBox(i,d,_,b,w){const C=this._extendCameraOptions(w);_=_||0,b=b||0,i=h.LngLat.convert(i),d=h.LngLat.convert(d);const S=this.transform.clone();S.padding=C.padding;const P=this.getFreeCameraOptions(),R=new h.LngLat(.5*(i.lng+d.lng),.5*(i.lat+d.lat)),L=.5*(_+b);if(S._camera.position[2]<h.mercatorZfromAltitude(L,R.lat))return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");P.lookAtPoint(R),S.setFreeCameraOptions(P);const B=h.MercatorCoordinate.fromLngLat(i),H=h.MercatorCoordinate.fromLngLat(d),te=S.pointRayIntersection(S.centerPoint,L),X=[(G=S.rayIntersectionCoordinate(te)).x,G.y,G.z];var G;const ge=S.screenPointToMercatorRay(S.centerPoint),ae="globe"!==S.projection.name;let fe,_e=0;do{const ve=Math.floor(S.zoom),he=1<<ve,Ce=Math.min(he*B.x,he*H.x),Ue=Math.min(he*B.y,he*H.y),We=Math.max(he*B.x,he*H.x),et=Math.max(he*B.y,he*H.y),Je=new h.Aabb([Ce,Ue,_],[We,et,b]),Dt=h.Frustum.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,ve,ae);if(2!==Je.intersects(Dt)){fe&&(S._camera.position=h.scaleAndAdd([],S._camera.position,ge.dir,-fe),S._updateStateFromCamera());break}const je=h.sub([],S._camera.position,X);fe=.5*h.length(je),S._camera.position=h.scaleAndAdd([],S._camera.position,ge.dir,fe);try{S._updateStateFromCamera()}catch(yt){return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++_e<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(i,d,_){return this._fitInternal(this.cameraForBounds(i,d),d,_)}_raycastElevationBox(i,d){const _=this.transform.elevation;if(!_)return;const b=new h.pointGeometry(i.x,d.y),w=new h.pointGeometry(d.x,i.y),C=_.pointCoordinate(i);if(!C)return;const S=_.pointCoordinate(d);if(!S)return;const P=_.pointCoordinate(b);if(!P)return;const R=_.pointCoordinate(w);if(!R)return;const L=new h.MercatorCoordinate(C[0],C[1]).toLngLat(),B=new h.MercatorCoordinate(S[0],S[1]).toLngLat(),H=new h.MercatorCoordinate(P[0],P[1]).toLngLat(),te=new h.MercatorCoordinate(R[0],R[1]).toLngLat(),X=Math.min(L.lng,Math.min(B.lng,Math.min(H.lng,te.lng))),G=Math.min(L.lat,Math.min(B.lat,Math.min(H.lat,te.lat))),ge=Math.max(L.lng,Math.max(B.lng,Math.max(H.lng,te.lng))),ae=Math.max(L.lat,Math.max(B.lat,Math.max(H.lat,te.lat))),fe=Math.min(C[3],Math.min(S[3],Math.min(P[3],R[3]))),_e=Math.max(C[3],Math.max(S[3],Math.max(P[3],R[3])));return{minLngLat:new h.LngLat(X,G),maxLngLat:new h.LngLat(ge,ae),minAltitude:fe,maxAltitude:_e}}fitScreenCoordinates(i,d,_,b,w){let C,S,P,R;const L=h.pointGeometry.convert(i),B=h.pointGeometry.convert(d),H=this._raycastElevationBox(L,B);if(H)C=H.minLngLat,S=H.maxLngLat,P=H.minAltitude,R=H.maxAltitude;else{if(this.transform.anyCornerOffEdge(L,B))return this;C=this.transform.pointLocation(L),S=this.transform.pointLocation(B)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(h.pointGeometry.convert(i)),this.transform.pointLocation(h.pointGeometry.convert(d)),_,b):this._cameraForBox(C,S,P,R,b),b,w)}_fitInternal(i,d,_){return i?(delete(d=h.extend(i,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(i,d){this.stop();const _=i.preloadOnly?this.transform.clone():this.transform;let b=!1,w=!1,C=!1;return"zoom"in i&&_.zoom!==+i.zoom&&(b=!0,_.zoom=+i.zoom),void 0!==i.center&&(_.center=h.LngLat.convert(i.center)),"bearing"in i&&_.bearing!==+i.bearing&&(w=!0,_.bearing=+i.bearing),"pitch"in i&&_.pitch!==+i.pitch&&(C=!0,_.pitch=+i.pitch),null==i.padding||_.isPaddingEqual(i.padding)||(_.padding=i.padding),i.preloadOnly?(this._preloadTiles(_),this):(this.fire(new h.Event("movestart",d)).fire(new h.Event("move",d)),b&&this.fire(new h.Event("zoomstart",d)).fire(new h.Event("zoom",d)).fire(new h.Event("zoomend",d)),w&&this.fire(new h.Event("rotatestart",d)).fire(new h.Event("rotate",d)).fire(new h.Event("rotateend",d)),C&&this.fire(new h.Event("pitchstart",d)).fire(new h.Event("pitch",d)).fire(new h.Event("pitchend",d)),this.fire(new h.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||h.warnOnce(su),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,d){const _=this.transform;if(!_.projection.supportsFreeCamera)return h.warnOnce(su),this;this.stop();const b=_.zoom,w=_.pitch,C=_.bearing;_.setFreeCameraOptions(i);const S=b!==_.zoom,P=w!==_.pitch,R=C!==_.bearing;return this.fire(new h.Event("movestart",d)).fire(new h.Event("move",d)),S&&this.fire(new h.Event("zoomstart",d)).fire(new h.Event("zoom",d)).fire(new h.Event("zoomend",d)),R&&this.fire(new h.Event("rotatestart",d)).fire(new h.Event("rotate",d)).fire(new h.Event("rotateend",d)),P&&this.fire(new h.Event("pitchstart",d)).fire(new h.Event("pitch",d)).fire(new h.Event("pitchend",d)),this.fire(new h.Event("moveend",d)),this}easeTo(i,d){this._stop(!1,i.easeId),(!1===(i=h.extend({offset:[0,0],duration:500,easing:h.ease},i)).animate||!i.essential&&h.exported.prefersReducedMotion)&&(i.duration=0);const _=this.transform,b=this.getZoom(),w=this.getBearing(),C=this.getPitch(),S=this.getPadding(),P="zoom"in i?+i.zoom:b,R="bearing"in i?this._normalizeBearing(i.bearing,w):w,L="pitch"in i?+i.pitch:C,B="padding"in i?i.padding:_.padding,H=h.pointGeometry.convert(i.offset);let te,X,G;if("globe"===_.projection.name){const et=h.MercatorCoordinate.fromLngLat(_.center),Je=H.rotate(-_.angle);et.x+=Je.x/_.worldSize,et.y+=Je.y/_.worldSize;const Dt=et.toLngLat(),je=h.LngLat.convert(i.center||Dt);this._normalizeCenter(je),te=_.centerPoint.add(Je),X=new h.pointGeometry(et.x,et.y).mult(_.worldSize),G=new h.pointGeometry(h.mercatorXfromLng(je.lng),h.mercatorYfromLat(je.lat)).mult(_.worldSize).sub(X)}else{te=_.centerPoint.add(H);const et=_.pointLocation(te),Je=h.LngLat.convert(i.center||et);this._normalizeCenter(Je),X=_.project(et),G=_.project(Je).sub(X)}const ge=_.zoomScale(P-b);let ae,fe;i.around&&(ae=h.LngLat.convert(i.around),fe=_.locationPoint(ae));const _e=this._zooming||P!==b,ve=this._rotating||w!==R,he=this._pitching||L!==C,Ce=!_.isPaddingEqual(B),Ue=et=>Je=>{if(_e&&(et.zoom=h.number(b,P,Je)),ve&&(et.bearing=h.number(w,R,Je)),he&&(et.pitch=h.number(C,L,Je)),Ce&&(et.interpolatePadding(S,B,Je),te=et.centerPoint.add(H)),ae)et.setLocationAtPoint(ae,fe);else{const Dt=et.zoomScale(et.zoom-b),je=P>b?Math.min(2,ge):Math.max(.5,ge),yt=Math.pow(je,1-Je),xt=et.unproject(X.add(G.mult(Je*yt)).mult(Dt));et.setLocationAtPoint(et.renderWorldCopies?xt.wrap():xt,te)}return i.preloadOnly||this._fireMoveEvents(d),et};if(i.preloadOnly){const et=this._emulate(Ue,i.duration,_);return this._preloadTiles(et),this}const We={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_e,this._rotating=ve,this._pitching=he,this._padding=Ce,this._easeId=i.easeId,this._prepareEase(d,i.noMoveStart,We),this._ease(Ue(_),et=>{_.recenterOnTerrain(),this._afterEase(d,et)},i),this}_prepareEase(i,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||_.moving||this.fire(new h.Event("movestart",i)),this._zooming&&!_.zooming&&this.fire(new h.Event("zoomstart",i)),this._rotating&&!_.rotating&&this.fire(new h.Event("rotatestart",i)),this._pitching&&!_.pitching&&this.fire(new h.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new h.Event("move",i)),this._zooming&&this.fire(new h.Event("zoom",i)),this._rotating&&this.fire(new h.Event("rotate",i)),this._pitching&&this.fire(new h.Event("pitch",i))}_afterEase(i,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,b=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new h.Event("zoomend",i)),b&&this.fire(new h.Event("rotateend",i)),w&&this.fire(new h.Event("pitchend",i)),this.fire(new h.Event("moveend",i))}flyTo(i,d){if(!i.essential&&h.exported.prefersReducedMotion){const jt=h.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(jt,d)}this.stop(),i=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},i);const _=this.transform,b=this.getZoom(),w=this.getBearing(),C=this.getPitch(),S=this.getPadding(),P="zoom"in i?h.clamp(+i.zoom,_.minZoom,_.maxZoom):b,R="bearing"in i?this._normalizeBearing(i.bearing,w):w,L="pitch"in i?+i.pitch:C,B="padding"in i?i.padding:_.padding,H=_.zoomScale(P-b),te=h.pointGeometry.convert(i.offset);let X=_.centerPoint.add(te);const G=_.pointLocation(X),ge=h.LngLat.convert(i.center||G);this._normalizeCenter(ge);const ae=_.project(G),fe=_.project(ge).sub(ae);let _e=i.curve;const ve=Math.max(_.width,_.height),he=ve/H,Ce=fe.mag();if("minZoom"in i){const jt=h.clamp(Math.min(i.minZoom,b,P),_.minZoom,_.maxZoom),qt=ve/_.zoomScale(jt-b);_e=Math.sqrt(qt/Ce*2)}const Ue=_e*_e;function We(jt){const qt=(he*he-ve*ve+(jt?-1:1)*Ue*Ue*Ce*Ce)/(2*(jt?he:ve)*Ue*Ce);return Math.log(Math.sqrt(qt*qt+1)-qt)}function et(jt){return(Math.exp(jt)-Math.exp(-jt))/2}function Je(jt){return(Math.exp(jt)+Math.exp(-jt))/2}const Dt=We(0);let je=function(jt){return Je(Dt)/Je(Dt+_e*jt)},yt=function(jt){return ve*((Je(Dt)*(et(qt=Dt+_e*jt)/Je(qt))-et(Dt))/Ue)/Ce;var qt},xt=(We(1)-Dt)/_e;if(Math.abs(Ce)<1e-6||!isFinite(xt)){if(Math.abs(ve-he)<1e-6)return this.easeTo(i,d);const jt=he<ve?-1:1;xt=Math.abs(Math.log(he/ve))/_e,yt=function(){return 0},je=function(qt){return Math.exp(jt*_e*qt)}}i.duration="duration"in i?+i.duration:1e3*xt/("screenSpeed"in i?+i.screenSpeed/_e:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Ht=w!==R,Ke=L!==C,Kt=!_.isPaddingEqual(B),Qt=jt=>qt=>{const an=qt*xt,En=1/je(an);jt.zoom=1===qt?P:b+jt.scaleZoom(En),Ht&&(jt.bearing=h.number(w,R,qt)),Ke&&(jt.pitch=h.number(C,L,qt)),Kt&&(jt.interpolatePadding(S,B,qt),X=jt.centerPoint.add(te));const en=1===qt?ge:jt.unproject(ae.add(fe.mult(yt(an))).mult(En));return jt.setLocationAtPoint(jt.renderWorldCopies?en.wrap():en,X),jt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(d),jt};if(i.preloadOnly){const jt=this._emulate(Qt,i.duration,_);return this._preloadTiles(jt),this}return this._zooming=!0,this._rotating=Ht,this._pitching=Ke,this._padding=Kt,this._prepareEase(d,!1),this._ease(Qt(_),()=>this._afterEase(d),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!i){const _=this.handlers;_&&_.stop(!1)}return this}_ease(i,d,_){!1===_.animate||0===_.duration?(i(1),d()):(this._easeStart=h.exported.now(),this._easeOptions=_,this._onEaseFrame=i,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,d){i=h.wrap(i,-180,180);const _=Math.abs(i-d);return Math.abs(i-360-d)<_&&(i-=360),Math.abs(i+360-d)<_&&(i+=360),i}_normalizeCenter(i){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const _=i.lng-d.center.lng;i.lng+=_>180?-360:_<-180?360:0}_emulate(i,d,_){const b=Math.ceil(15*d/1e3),w=[],C=i(_.clone());for(let S=0;S<=b;S++){const P=C(S/b);w.push(P.clone())}return w}}class au{constructor(i={}){this.options=i,h.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const d=this.options&&this.options.compact;return this._map=i,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=K("button","mapboxgl-ctrl-attrib-button",this._container),K("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,d){const _=this._map._getUIString(`AttributionControl.${d}`);i.setAttribute("aria-label",_),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||h.config.ACCESS_TOKEN}];if(i){const _=d.reduce((b,w,C)=>(w.value&&(b+=`${w.key}=${w.value}${C<d.length-1?"&":""}`),b),"?");i.href=`${h.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._sourceCaches;for(const b in d){const w=d[b];if(w.used){const C=w.getSource();C.attribution&&i.indexOf(C.attribution)<0&&i.push(C.attribution)}}i.sort((b,w)=>b.length-w.length),i=i.filter((b,w)=>{for(let C=w+1;C<i.length;C++)if(i[C].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const _=i.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,i.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Td{constructor(){h.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=K("div","mapboxgl-ctrl");const d=K("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const d in i){const _=i[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const d=i[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class Cd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const d=++this._id;return this._queue.push({callback:i,id:d,cancelled:!1}),d}remove(i){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const b of _)if(b.id===i)return void(b.cancelled=!0)}run(i=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Wa(p,i,d){if(p=new h.LngLat(p.lng,p.lat),i){const _=new h.LngLat(p.lng-360,p.lat),b=new h.LngLat(p.lng+360,p.lat),w=360*Math.ceil(Math.abs(p.lng-d.center.lng)/360),C=d.locationPoint(p).distSqr(i),S=i.x<0||i.y<0||i.x>d.width||i.y>d.height;d.locationPoint(_).distSqr(i)<C&&(S||Math.abs(_.lng-d.center.lng)<w)?p=_:d.locationPoint(b).distSqr(i)<C&&(S||Math.abs(b.lng-d.center.lng)<w)&&(p=b)}for(;Math.abs(p.lng-d.center.lng)>180;){const _=d.locationPoint(p);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;p.lng>d.center.lng?p.lng-=360:p.lng+=360}return p}const Xa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ka extends h.Evented{constructor(i,d){if(super(),(i instanceof h.window.HTMLElement||d)&&(i=h.extend({element:i},d)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&"auto"!==i.pitchAlignment?i.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),i&&i.element)this._element=i.element,this._offset=h.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=K("div");const b=41,w=27,C=W("svg",{display:"block",height:b*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${b}`},this._element),S=W("radialGradient",{id:"shadowGradient"},W("defs",{},C));W("stop",{offset:"10%","stop-opacity":.4},S),W("stop",{offset:"100%","stop-opacity":.05},S),W("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),W("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),W("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),W("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=h.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const _=this._element.classList;for(const b in Xa)_.remove(`mapboxgl-marker-anchor-${b}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=h.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const d=i.code,_=i.charCode||i.keyCode;"Space"!==d&&"Enter"!==d&&32!==_&&13!==_||this.togglePopup()}_onMapClick(i){const d=i.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const i=this._map;if(!i)return;const d=this._pos;if(!d||d.x<0||d.x>i.transform.width||d.y<0||d.y>i.transform.height)return void this._clearFadeTimer();const _=i.unproject(d);let b=!1;if(i.transform._terrainEnabled()&&i.getTerrain()){const C=i.getFreeCameraOptions();if(C.position){const S=C.position.toLngLat();b=S.distanceTo(_)<.9*S.distanceTo(this._lngLat)}}const w=(1-i._queryFogOpacity(_))*(b?.2:1);this._element.style.opacity=`${w}`,this._popup&&this._popup._setOpacity(`${w}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i)return;const d=this._offset.mult(this._scale),_=this._calculatePitch(),b=this._calculateRotation();this._element.style.transform=`\n            translate(${i.x}px, ${i.y}px) ${Xa[this._anchor]}\n            rotateX(${_}deg) rotateZ(${b}deg)\n            translate(${d.x}px, ${d.y}px)\n        `}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:this._map&&"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:this._map&&"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(i){h.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Wa(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),!0===i?this._updateFrameId=h.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!d.getTerrain()&&!d.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=h.pointGeometry.convert(i),this._update(),this}_onMove(i){const d=this._map;if(d){if(!this._isDragging){const _=this._clickTolerance||d._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(i){const d=this._map;d&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos),this._pointerdownPos=i.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const d=this._map;return d&&(i?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&"auto"!==i?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class lh{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const d=h.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,d,_){this._start=this.getValue(d),this._end=i,this._startTime=d,this._endTime=d+_}}const Dd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ch={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Xo(p){p.parentNode&&p.parentNode.removeChild(p)}const Ya={showCompass:!0,showZoom:!0,visualizePitch:!1};class uh{constructor(i,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new vi({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,_&&(this.mousePitch=new fs({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(i,d){this.mouseRotate.mousedown(i,d),this.mousePitch&&this.mousePitch.mousedown(i,d),Te()}move(i,d){const _=this.map,b=this.mouseRotate.mousemoveWindow(i,d),w=b&&b.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const C=this.mousePitch.mousemoveWindow(i,d),S=C&&C.pitchDelta;S&&_.setPitch(_.getPitch()+S)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ne(),h.window.removeEventListener("mousemove",this.mousemove),h.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(h.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Ae(this.element,i)),h.window.addEventListener("mousemove",this.mousemove),h.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Ae(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=J(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=J(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const bo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let $i,Ja=0,Qa=!1;const hh={maxWidth:100,unit:"metric"};function dh(p,i,d){const _=d&&d.maxWidth||100,b=p._containerHeight/2,w=p._containerWidth/2-_/2,C=p.unproject([w,b]),S=p.unproject([w+_,b]),P=C.distanceTo(S);if(d&&"imperial"===d.unit){const R=3.2808*P;R>5280?cc(i,_,R/5280,p._getUIString("ScaleControl.Miles"),p):cc(i,_,R,p._getUIString("ScaleControl.Feet"),p)}else d&&"nautical"===d.unit?cc(i,_,P/1852,p._getUIString("ScaleControl.NauticalMiles"),p):P>=1e3?cc(i,_,P/1e3,p._getUIString("ScaleControl.Kilometers"),p):cc(i,_,P,p._getUIString("ScaleControl.Meters"),p)}function cc(p,i,d,_,b){const w=function(S){const P=Math.pow(10,`${Math.floor(S)}`.length-1);let R=S/P;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(L){const B=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*B)/B}(R),P*R}(d),C=w/d;b._requestDomTask(()=>{p.style.width=i*C+"px",p.innerHTML=`${w}&nbsp;${_}`})}const co={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},kr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function el(p=new h.pointGeometry(0,0),i="bottom"){if("number"==typeof p){const d=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(i){case"top":return new h.pointGeometry(0,p);case"top-left":return new h.pointGeometry(d,d);case"top-right":return new h.pointGeometry(-d,d);case"bottom":return new h.pointGeometry(0,-p);case"bottom-left":return new h.pointGeometry(d,-d);case"bottom-right":return new h.pointGeometry(-d,-d);case"left":return new h.pointGeometry(p,0);case"right":return new h.pointGeometry(-p,0)}return new h.pointGeometry(0,0)}return p instanceof h.pointGeometry||Array.isArray(p)?h.pointGeometry.convert(p):h.pointGeometry.convert(p[i]||[0,0])}const na={version:h.version,supported:U,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends ah{constructor(p){if(null!=(p=h.extend({},ch,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&h.isSafariWithAntialiasingBug(h.window)&&(p.antialias=!1,h.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ds(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._renderTaskQueue=new Cd,this._domRenderTaskQueue=new Cd,this._controls=[],this._markers=[],this._mapId=h.uniqueId(),this._locale=h.extend({},Dd,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new lh(0),this._explicitProjection=null,this._requestManager=new h.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=h.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof h.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&h.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==h.window&&(h.window.addEventListener("online",this._onWindowOnline,!1),h.window.addEventListener("resize",this._onWindowResize,!1),h.window.addEventListener("orientationchange",this._onWindowResize,!1),h.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ed(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new tu("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,h.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new au({customAttribution:p.customAttribution})),this._logoControl=new Td,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new h.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new h.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(p,i){if(void 0===i&&(i=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=p.onAdd(this);this._controls.push(p);const _=this._controlPositions[i];return-1!==i.indexOf("bottom")?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(p);return i>-1&&this._controls.splice(i,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new h.Event("movestart",p)).fire(new h.Event("move",p)),this.fire(new h.Event("resize",p)),i&&this.fire(new h.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(h.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=null==p?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=null==p?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new h.Event("zoomstart")).fire(new h.Event("zoom")).fire(new h.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=null==p?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=null==p?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new h.Event("pitchstart")).fire(new h.Event("pitch")).fire(new h.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._updateProjection(p)}_updateProjection(p){null===p&&(this._explicitProjection=null);const i=p||this.getProjection(),d=this.transform.setProjection(i);if(p&&(this._explicitProjection=this.transform.getProjection()),d){this.painter.clearBackgroundTiles();for(const _ in this.style._sourceCaches)this.style._sourceCaches[_].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(p){return this.transform.locationPoint3D(h.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(h.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,i,d){if("mouseenter"===p||"mouseover"===p){let _=!1;const b=C=>{const S=i.filter(R=>this.getLayer(R)),P=S.length?this.queryRenderedFeatures(C.point,{layers:S}):[];P.length?_||(_=!0,d.call(this,new ft(p,this,C.originalEvent,{features:P}))):_=!1},w=()=>{_=!1};return{layers:new Set(i),listener:d,delegates:{mousemove:b,mouseout:w}}}if("mouseleave"===p||"mouseout"===p){let _=!1;const b=C=>{const S=i.filter(P=>this.getLayer(P));(S.length?this.queryRenderedFeatures(C.point,{layers:S}):[]).length?_=!0:_&&(_=!1,d.call(this,new ft(p,this,C.originalEvent)))},w=C=>{_&&(_=!1,d.call(this,new ft(p,this,C.originalEvent)))};return{layers:new Set(i),listener:d,delegates:{mousemove:b,mouseout:w}}}{const _=b=>{const w=i.filter(S=>this.getLayer(S)),C=w.length?this.queryRenderedFeatures(b.point,{layers:w}):[];C.length&&(b.features=C,d.call(this,b),delete b.features)};return{layers:new Set(i),listener:d,delegates:{[p]:_}}}}on(p,i,d){if(void 0===d)return super.on(p,i);Array.isArray(i)||(i=[i]);const _=this._createDelegatedListener(p,i,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(_);for(const b in _.delegates)this.on(b,_.delegates[b]);return this}once(p,i,d){if(void 0===d)return super.once(p,i);Array.isArray(i)||(i=[i]);const _=this._createDelegatedListener(p,i,d);for(const b in _.delegates)this.once(b,_.delegates[b]);return this}off(p,i,d){if(void 0===d)return super.off(p,i);i=new Set(Array.isArray(i)?i:[i]);const _=(w,C)=>{if(w.size!==C.size)return!1;for(const S of w)if(!C.has(S))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[p]:void 0;return b&&(w=>{for(let C=0;C<w.length;C++){const S=w[C];if(S.listener===d&&_(S.layers,i)){for(const P in S.delegates)this.off(P,S.delegates[P]);return w.splice(C,1),this}}})(b),this}queryRenderedFeatures(p,i){return this.style?(void 0!==i||void 0===p||p instanceof h.pointGeometry||Array.isArray(p)||(i=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(p,i){return this.style.querySourceFeatures(p,i)}queryTerrainElevation(p,i){const d=this.transform.elevation;return d?(i=h.extend({},{exaggerated:!0},i),d.getAtPoint(h.MercatorCoordinate.fromLngLat(p),null,i.exaggerated)):null}setStyle(p,i){return!1!==(i=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(p,i))}_getUIString(p){const i=this._locale[p];if(null==i)throw new Error(`Missing UI string '${p}'`);return i}_updateStyle(p,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new _r(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new _r(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,i){if("string"==typeof p){const d=this._requestManager.normalizeStyleURL(p),_=this._requestManager.transformRequest(d,h.ResourceType.Style);h.getJSON(_,(b,w)=>{b?this.fire(new h.ErrorEvent(b)):w&&this._updateDiff(w,i)})}else"object"==typeof p&&this._updateDiff(p,i)}_updateDiff(p,i){try{this.style.setState(p)&&this._update(!0)}catch(d){h.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(p,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(h.warnOnce("There is no style added to the map."),!1)}addSource(p,i){return this._lazyInitEmptyStyle(),this.style.addSource(p,i),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const i in p){const d=p[i]._tiles;for(const _ in d){const b=d[_];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(p,i,d){this._lazyInitEmptyStyle(),this.style.addSourceType(p,i,d)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,i,{pixelRatio:d=1,sdf:_=!1,stretchX:b,stretchY:w,content:C}={}){if(this._lazyInitEmptyStyle(),i instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&i instanceof h.window.ImageBitmap){const{width:S,height:P,data:R}=h.exported.getImageData(i);this.style.addImage(p,{data:new h.RGBAImage({width:S,height:P},R),pixelRatio:d,stretchX:b,stretchY:w,content:C,sdf:_,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:P}=i,R=i;this.style.addImage(p,{data:new h.RGBAImage({width:S,height:P},new Uint8Array(R.data)),pixelRatio:d,stretchX:b,stretchY:w,content:C,sdf:_,version:0,userImage:R}),R.onAdd&&R.onAdd(this,p)}}updateImage(p,i){const d=this.style.getImage(p);if(!d)return void this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=i instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&i instanceof h.window.ImageBitmap?h.exported.getImageData(i):i,{width:b,height:w}=_;void 0!==b&&void 0!==w?b===d.data.width&&w===d.data.height?(d.data.replace(_.data,!(i instanceof h.window.HTMLImageElement||h.window.ImageBitmap&&i instanceof h.window.ImageBitmap)),this.style.updateImage(p,d)):this.fire(new h.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,i){h.getImage(this._requestManager.transformRequest(p,h.ResourceType.Image),(d,_)=>{i(d,_ instanceof h.window.HTMLImageElement?h.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(p,i){return this._lazyInitEmptyStyle(),this.style.addLayer(p,i),this._update(!0)}moveLayer(p,i){return this.style.moveLayer(p,i),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,i,d){return this.style.setLayerZoomRange(p,i,d),this._update(!0)}setFilter(p,i,d={}){return this.style.setFilter(p,i,d),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,i,d,_={}){return this.style.setPaintProperty(p,i,d,_),this._update(!0)}getPaintProperty(p,i){return this.style.getPaintProperty(p,i)}setLayoutProperty(p,i,d,_={}){return this.style.setLayoutProperty(p,i,d,_),this._update(!0)}getLayoutProperty(p,i){return this.style.getLayoutProperty(p,i)}setLight(p,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(h.LngLat.convert(p),this.transform):0}setFeatureState(p,i){return this.style.setFeatureState(p,i),this._update()}removeFeatureState(p,i){return this.style.removeFeatureState(p,i),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let d,_,b,w=this._container;for(;w&&(!_||!b);){const C=h.window.getComputedStyle(w).transform;C&&"none"!==C&&(d=C.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&"0"!==d[0]&&"1"!==d[0]&&(_=d[0]),d[3]&&"0"!==d[3]&&"1"!==d[3]&&(b=d[3])),w=w.parentElement}this._containerWidth=_?Math.abs(p/_):p,this._containerHeight=b?Math.abs(i/b):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==h.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&h.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=K("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=K("div","mapboxgl-canvas-container",p);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=K("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=K("div","mapboxgl-control-container",p),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=K("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,i){const d=h.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(p),this._canvas.height=d*Math.ceil(i),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${i}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const i=this._markers.indexOf(p);-1!==i&&this._markers.splice(i,1)}_setupPainter(){const p=h.extend({},U.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);i?(h.storeAuthState(i,!0),this.painter=new pd(i,this.transform),this.on("data",d=>{"source"===d.dataType&&this.painter.setTileLoadedFlag(!0)}),h.exported$1.testSupport(i)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let i;const d=this.painter.context.extTimerQuery,_=h.exported.now();if(this.listens("gpu-timing-frame")&&(i=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;let b=!1;const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,R=this.transform.pitch,L=h.exported.now();this.style.zoomHistory.update(P,L);const B=new h.EvaluationParameters(P,{now:L,fadeDuration:w,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=B.crossFadingFactor();1===H&&H===this._crossFadingFactor||(b=!0,this._crossFadingFactor=H),this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerUpdate()):C=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new h.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=h.exported.now()-_;d.endQueryEXT(d.TIME_ELAPSED_EXT,i),setTimeout(()=>{const R=d.getQueryObjectEXT(i,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(i),this.fire(new h.Event("gpu-timing-frame",{cpuTime:P,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(P);this.fire(new h.Event("gpu-timing-layer",{layerTimes:R}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(S||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(C=this._updateAverageElevation(_,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new h.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new h.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,i=!1){const d=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((i||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const _=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=p;const C=Math.abs(_-b);if(C>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(b),d(b);this._averageElevation.easeTo(b,p,300)}else if(C>1e-4)return this._averageElevation.jumpTo(b),d(b)}return!!this._averageElevation.isEasing(p)&&d(this._averageElevation.getValue(p))}_authenticate(){h.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===h.AUTH_ERR_MSG||401===p.status)){const i=this.painter.context.gl;h.storeAuthState(i,!1),this._logoControl instanceof Td&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new h.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),h.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const d=this.painter.context.gl,_=d.createFramebuffer();function b(w){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,w,0);const C=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,C),C}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(b(p),i.canvasCopies.map(b),i.timeStamps)}_canvasPixelComparison(p,i,d){let _=d[1]-d[0];const b=p.length/4;for(let w=0;w<i.length;w++){const C=i[w];let S=0;for(let P=0;P<C.length;P+=4)C[P]===p[P]&&C[P+1]===p[P+1]&&C[P+2]===p[P+2]&&C[P+3]===p[P+3]&&(S+=1);_+=(d[w+2]-d[w+1])*(1-S/b)}return _}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==h.window&&(h.window.removeEventListener("resize",this._onWindowResize,!1),h.window.removeEventListener("orientationchange",this._onWindowResize,!1),h.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),h.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),Xo(this._canvasContainer),Xo(this._controlContainer),Xo(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),h.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=h.exported.frame(i=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(i)}))}_preloadTiles(p){const i=this.style?Object.values(this.style._sourceCaches):[];return h.asyncAll(i,(d,_)=>d._preloadTiles(p,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,i){h.setCacheLimits(p,i)}get version(){return h.version}},NavigationControl:class{constructor(p){this.options=h.extend({},Ya,p),this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),K("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),K("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:i}):d.resetNorth({},{originalEvent:i}))}),this._compassIcon=K("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const i=p.getZoom(),d=i===p.getMaxZoom(),_=i===p.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new uh(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,i){const d=K("button",p,this._container);return d.type="button",d.addEventListener("click",i),d}_setButtonTitle(p,i){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${i}`);p.setAttribute("aria-label",d),p.firstElementChild&&p.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends h.Evented{constructor(p){super(),this.options=h.extend({},bo,p),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=eu(this._updateMarkerRotation,20)}onAdd(p){var i;return this._map=p,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==$i?i($i):void 0!==h.window.navigator.permissions?h.window.navigator.permissions.query({name:"geolocation"}).then(d=>{$i="denied"!==d.state,i($i)}):($i=!!h.window.navigator.geolocation,i($i)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(h.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Ja=0,Qa=!1}_isOutOfMapMaxBounds(p){const i=this._map.getMaxBounds(),d=p.coords;return!!i&&(d.longitude<i.getWest()||d.longitude>i.getEast()||d.latitude<i.getSouth()||d.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",p)),this._finish()}}_updateCamera(p){const i=new h.LngLat(p.coords.longitude,p.coords.latitude),d=p.coords.accuracy,_=this._map.getBearing(),b=h.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(d),b,{geolocateSource:!0})}_updateMarker(p){if(p){const i=new h.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._containerHeight/2,i=this._map.unproject([0,p]),d=this._map.unproject([100,p]),_=i.distanceTo(d)/100,b=Math.ceil(2*this._accuracy/_);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&Qa)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=K("button","mapboxgl-ctrl-geolocate",this._container),K("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K("div","mapboxgl-user-location"),this._dotElement.appendChild(K("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(K("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ka({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=K("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ka({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ja--,Qa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ja++,Ja>1?(p={maximumAge:6e5,timeout:0},Qa=!0):(p=this.options.positionOptions,Qa=!1),this._geolocationWatchID=h.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else h.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{h.window.addEventListener("ondeviceorientationabsolute"in h.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==h.window.DeviceMotionEvent&&"function"==typeof h.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&p()}).catch(console.error):p()}_clearWatch(){h.window.navigator.geolocation.clearWatch(this._geolocationWatchID),h.window.removeEventListener("deviceorientation",this._onDeviceOrientation),h.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:au,ScaleControl:class{constructor(p){this.options=h.extend({},hh,p),h.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){dh(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=K("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,dh(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof h.window.HTMLElement?this._container=p.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in h.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in h.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=K("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,h.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!h.window.document.fullscreenEnabled&&!h.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=K("button","mapboxgl-ctrl-fullscreen",this._controlContainer);K("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),h.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(h.window.document.fullscreenElement||h.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?h.window.document.exitFullscreen?h.window.document.exitFullscreen():h.window.document.webkitCancelFullScreen&&h.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.Evented{constructor(p){super(),this.options=h.extend(Object.create(co),p),h.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=h.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(h.window.document.createTextNode(p))}setHTML(p){const i=h.window.document.createDocumentFragment(),d=h.window.document.createElement("body");let _;for(d.innerHTML=p;_=d.firstChild,_;)i.appendChild(_);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=K("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(p),this.options.closeButton){const d=this._closeButton=K("button","mapboxgl-popup-close-button",i);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let i;return this._classList.delete(p)?i=!1:(this._classList.add(p),i=!0),this._updateClassList(),i}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const i=this._map,d=this._container,_=this._pos;if(!i||!d||!_)return"bottom";const b=d.offsetWidth,w=d.offsetHeight,C=_.x<b/2,S=_.x>i.transform.width-b/2;if(_.y+p<w)return C?"top-left":S?"top-right":"top";if(_.y>i.transform.height-w){if(C)return"bottom-left";if(S)return"bottom-right"}return C?"left":S?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),p.className=i.join(" ")}_update(p){const i=this._map,d=this._content;if(!i||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=K("div","mapboxgl-popup",i.getContainer()),this._tip=K("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wa(this._lngLat,this._pos,i.transform)),!this._trackPointer||p){const b=this._pos=this._trackPointer&&p?p:i.project(this._lngLat),w=el(this.options.offset),C=this._anchor=this._getAnchor(w.y),S=el(this.options.offset,C),P=b.add(S).round();i._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${Xa[C]} translate(${P.x}px,${P.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(kr);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._content&&(this._content.style.opacity=p),this._tip&&(this._tip.style.opacity=p)}},Marker:Ka,Style:_r,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,FreeCameraOptions:Yi,Evented:h.Evented,config:h.config,prewarm:function(){nn().acquire(rn)},clearPrewarmedResources:function(){const p=Xt;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(rn),Xt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return h.config.ACCESS_TOKEN},set accessToken(p){h.config.ACCESS_TOKEN=p},get baseApiUrl(){return h.config.API_URL},set baseApiUrl(p){h.config.API_URL=p},get workerCount(){return Wt.workerCount},set workerCount(p){Wt.workerCount=p},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){h.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){h.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:h.exported.setNow,restoreNow:h.exported.restoreNow};return na}),lt}()},775:function(Nt){var lt;lt=function(){var Xe=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function lt(Y){return Y.match(Xe)||[]}function de(Y){return{language:(Y=lt(Y))[1]||"",extlang:Y[2]||"",script:Y[3]||"",region:Y[4]||""}}function h(Y,re,$){Object.defineProperty(Y,re,{value:$,enumerable:!0})}function U(Y,re,$){function K(W){return lt(W)[Y]||""}h(K,"pattern",re),h(de,$,K)}return U(1,/^[a-zA-Z]{2,3}$/,"language"),U(2,/^[a-zA-Z]{3}$/,"extlang"),U(3,/^[a-zA-Z]{4}$/,"script"),U(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),h(de,"split",function xe(Y){return lt(Y).filter(function(re,$){return re&&$})}),de},Nt.exports?Nt.exports=lt():this.subtag=lt()},703:Nt=>{Nt.exports=function Xe(){for(var lt={},xe=0;xe<arguments.length;xe++){var de=arguments[xe];for(var h in de)Bt.call(de,h)&&(lt[h]=de[h])}return lt};var Bt=Object.prototype.hasOwnProperty},652:(Nt,Bt,Xe)=>{"use strict";Xe.d(Bt,{x0:()=>h});let h=(U=21)=>crypto.getRandomValues(new Uint8Array(U)).reduce((Y,re)=>Y+((re&=63)<36?re.toString(36):re<62?(re-26).toString(36).toUpperCase():re>62?"-":"_"),"")},147:Nt=>{"use strict";Nt.exports={i8:"0.0.19"}}},Nt=>{Nt(Nt.s=37)}]);