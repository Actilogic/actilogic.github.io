(self.webpackChunkActilogic=self.webpackChunkActilogic||[]).push([[179],{518:Xl=>{Xl.exports=function it(dt,f,Se){function Ie(me,ae){if(!f[me]){if(!dt[me]){if(Ue)return Ue(me,!0);var _e=new Error("Cannot find module '"+me+"'");throw _e.code="MODULE_NOT_FOUND",_e}var ve=f[me]={exports:{}};dt[me][0].call(ve.exports,function(Le){return Ie(dt[me][1][Le]||Le)},ve,ve.exports,it,dt,f,Se)}return f[me].exports}for(var Ue=void 0,se=0;se<Se.length;se++)Ie(Se[se]);return Ie}({1:[function(it,dt,f){"use strict";var Se={};function Ie(me){return Math.floor(Math.abs(me)+.5)*(me>=0?1:-1)}function Ue(me,ae,ge){var _e=(me=Ie(me*ge))-(ae=Ie(ae*ge));_e<<=1,me-ae<0&&(_e=~_e);for(var ve="";_e>=32;)ve+=String.fromCharCode(63+(32|31&_e)),_e>>=5;return ve+String.fromCharCode(_e+63)}function se(me){for(var ae=[],ge=0;ge<me.length;ge++){var _e=me[ge].slice();ae.push([_e[1],_e[0]])}return ae}Se.decode=function(me,ae){for(var Ze,ge=0,_e=0,ve=0,Le=[],yt=0,wt=0,rt=null,Ge=Math.pow(10,Number.isInteger(ae)?ae:5);ge<me.length;){rt=null,yt=0,wt=0;do{wt|=(31&(rt=me.charCodeAt(ge++)-63))<<yt,yt+=5}while(rt>=32);Ze=1&wt?~(wt>>1):wt>>1,yt=wt=0;do{wt|=(31&(rt=me.charCodeAt(ge++)-63))<<yt,yt+=5}while(rt>=32);Le.push([(_e+=Ze)/Ge,(ve+=1&wt?~(wt>>1):wt>>1)/Ge])}return Le},Se.encode=function(me,ae){if(!me.length)return"";for(var ge=Math.pow(10,Number.isInteger(ae)?ae:5),_e=Ue(me[0][0],0,ge)+Ue(me[0][1],0,ge),ve=1;ve<me.length;ve++){var Le=me[ve],yt=me[ve-1];_e+=Ue(Le[0],yt[0],ge),_e+=Ue(Le[1],yt[1],ge)}return _e},Se.fromGeoJSON=function(me,ae){if(me&&"Feature"===me.type&&(me=me.geometry),!me||"LineString"!==me.type)throw new Error("Input must be a GeoJSON LineString");return Se.encode(se(me.coordinates),ae)},Se.toGeoJSON=function(me,ae){return{type:"LineString",coordinates:se(Se.decode(me,ae))}},"object"==typeof dt&&dt.exports&&(dt.exports=Se)},{}],2:[function(it,dt,f){"use strict";var Se=it("is-obj"),Ie=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;function se(ge){if(null==ge)throw new TypeError("Sources cannot be null or undefined");return Object(ge)}function me(ge,_e,ve){var Le=_e[ve];if(null!=Le){if(Ie.call(ge,ve)&&null==ge[ve])throw new TypeError("Cannot convert undefined or null to object ("+ve+")");ge[ve]=Ie.call(ge,ve)&&Se(Le)?ae(Object(ge[ve]),_e[ve]):Le}}function ae(ge,_e){if(ge===_e)return ge;for(var ve in _e=Object(_e))Ie.call(_e,ve)&&me(ge,_e,ve);if(Object.getOwnPropertySymbols)for(var Le=Object.getOwnPropertySymbols(_e),yt=0;yt<Le.length;yt++)Ue.call(_e,Le[yt])&&me(ge,_e,Le[yt]);return ge}dt.exports=function(_e){_e=se(_e);for(var ve=1;ve<arguments.length;ve++)ae(_e,arguments[ve]);return _e}},{"is-obj":5}],3:[function(it,dt,f){function Se(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function Ie(ae){return"function"==typeof ae}function se(ae){return"object"==typeof ae&&null!==ae}function me(ae){return void 0===ae}dt.exports=Se,Se.EventEmitter=Se,Se.prototype._events=void 0,Se.prototype._maxListeners=void 0,Se.defaultMaxListeners=10,Se.prototype.setMaxListeners=function(ae){if(!function Ue(ae){return"number"==typeof ae}(ae)||ae<0||isNaN(ae))throw TypeError("n must be a positive number");return this._maxListeners=ae,this},Se.prototype.emit=function(ae){var ge,_e,ve,Le,yt,wt;if(this._events||(this._events={}),"error"===ae&&(!this._events.error||se(this._events.error)&&!this._events.error.length)){if((ge=arguments[1])instanceof Error)throw ge;var rt=new Error('Uncaught, unspecified "error" event. ('+ge+")");throw rt.context=ge,rt}if(me(_e=this._events[ae]))return!1;if(Ie(_e))switch(arguments.length){case 1:_e.call(this);break;case 2:_e.call(this,arguments[1]);break;case 3:_e.call(this,arguments[1],arguments[2]);break;default:Le=Array.prototype.slice.call(arguments,1),_e.apply(this,Le)}else if(se(_e))for(Le=Array.prototype.slice.call(arguments,1),ve=(wt=_e.slice()).length,yt=0;yt<ve;yt++)wt[yt].apply(this,Le);return!0},Se.prototype.on=Se.prototype.addListener=function(ae,ge){var _e;if(!Ie(ge))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",ae,Ie(ge.listener)?ge.listener:ge),this._events[ae]?se(this._events[ae])?this._events[ae].push(ge):this._events[ae]=[this._events[ae],ge]:this._events[ae]=ge,se(this._events[ae])&&!this._events[ae].warned&&(_e=me(this._maxListeners)?Se.defaultMaxListeners:this._maxListeners)&&_e>0&&this._events[ae].length>_e&&(this._events[ae].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[ae].length),"function"==typeof console.trace&&console.trace()),this},Se.prototype.once=function(ae,ge){if(!Ie(ge))throw TypeError("listener must be a function");var _e=!1;function ve(){this.removeListener(ae,ve),_e||(_e=!0,ge.apply(this,arguments))}return ve.listener=ge,this.on(ae,ve),this},Se.prototype.removeListener=function(ae,ge){var _e,ve,Le,yt;if(!Ie(ge))throw TypeError("listener must be a function");if(!this._events||!this._events[ae])return this;if(Le=(_e=this._events[ae]).length,ve=-1,_e===ge||Ie(_e.listener)&&_e.listener===ge)delete this._events[ae],this._events.removeListener&&this.emit("removeListener",ae,ge);else if(se(_e)){for(yt=Le;yt-- >0;)if(_e[yt]===ge||_e[yt].listener&&_e[yt].listener===ge){ve=yt;break}if(ve<0)return this;1===_e.length?(_e.length=0,delete this._events[ae]):_e.splice(ve,1),this._events.removeListener&&this.emit("removeListener",ae,ge)}return this},Se.prototype.removeAllListeners=function(ae){var ge,_e;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[ae]&&delete this._events[ae],this;if(0===arguments.length){for(ge in this._events)"removeListener"!==ge&&this.removeAllListeners(ge);return this.removeAllListeners("removeListener"),this._events={},this}if(Ie(_e=this._events[ae]))this.removeListener(ae,_e);else if(_e)for(;_e.length;)this.removeListener(ae,_e[_e.length-1]);return delete this._events[ae],this},Se.prototype.listeners=function(ae){return this._events&&this._events[ae]?Ie(this._events[ae])?[this._events[ae]]:this._events[ae].slice():[]},Se.prototype.listenerCount=function(ae){if(this._events){var ge=this._events[ae];if(Ie(ge))return 1;if(ge)return ge.length}return 0},Se.listenerCount=function(ae,ge){return ae.listenerCount(ge)}},{}],4:[function(it,dt,f){!function(){var Ie={};void 0!==f?dt.exports=Ie:this.fuzzy=Ie,Ie.simpleFilter=function(Ue,se){return se.filter(function(me){return Ie.test(Ue,me)})},Ie.test=function(Ue,se){return null!==Ie.match(Ue,se)},Ie.match=function(Ue,se,me){var Ze,ae=0,ge=[],_e=se.length,ve=0,Le=0,yt=(me=me||{}).pre||"",wt=me.post||"",rt=me.caseSensitive&&se||se.toLowerCase();Ue=me.caseSensitive&&Ue||Ue.toLowerCase();for(var De=0;De<_e;De++)Ze=se[De],rt[De]===Ue[ae]?(Ze=yt+Ze+wt,ae+=1,Le+=1+Le):Le=0,ve+=Le,ge[ge.length]=Ze;return ae===Ue.length?(ve=rt===Ue?1/0:ve,{rendered:ge.join(""),score:ve}):null},Ie.filter=function(Ue,se,me){return se&&0!==se.length?"string"!=typeof Ue?se:(me=me||{},se.reduce(function(ae,ge,_e,ve){var Le=ge;me.extract&&(Le=me.extract(ge));var yt=Ie.match(Ue,Le,me);return null!=yt&&(ae[ae.length]={string:yt.rendered,score:yt.score,index:_e,original:ge}),ae},[]).sort(function(ae,ge){return ge.score-ae.score||ae.index-ge.index})):[]}}()},{}],5:[function(it,dt,f){"use strict";dt.exports=function(Se){var Ie=typeof Se;return null!==Se&&("object"===Ie||"function"===Ie)}},{}],6:[function(it,dt,f){dt.exports=/<%=([\s\S]+?)%>/g},{}],7:[function(it,dt,f){(function(Se){var me=/^\s+|\s+$/g,ae=/^[-+]0x[0-9a-f]+$/i,ge=/^0b[01]+$/i,_e=/^0o[0-7]+$/i,ve=parseInt,yt="object"==typeof self&&self&&self.Object===Object&&self,wt="object"==typeof Se&&Se&&Se.Object===Object&&Se||yt||Function("return this")(),Ze=Object.prototype.toString,De=Math.max,Ge=Math.min,ct=function(){return wt.Date.now()};function Kt(St){var Tt=typeof St;return!!St&&("object"==Tt||"function"==Tt)}function Wt(St){if("number"==typeof St)return St;if(function rn(St){return"symbol"==typeof St||function en(St){return!!St&&"object"==typeof St}(St)&&"[object Symbol]"==Ze.call(St)}(St))return NaN;if(Kt(St)){var Tt="function"==typeof St.valueOf?St.valueOf():St;St=Kt(Tt)?Tt+"":Tt}if("string"!=typeof St)return 0===St?St:+St;St=St.replace(me,"");var Nt=ge.test(St);return Nt||_e.test(St)?ve(St.slice(2),Nt?2:8):ae.test(St)?NaN:+St}dt.exports=function gt(St,Tt,Nt){var tt,We,cn,Cn,Qt,On,un=0,Vn=!1,cr=!1,Ct=!0;if("function"!=typeof St)throw new TypeError("Expected a function");function kn(Xn){var fn=tt,sr=We;return tt=We=void 0,un=Xn,Cn=St.apply(sr,fn)}function qe(Xn){return un=Xn,Qt=setTimeout(wn,Tt),Vn?kn(Xn):Cn}function Gt(Xn){var fn=Xn-On;return void 0===On||fn>=Tt||fn<0||cr&&Xn-un>=cn}function wn(){var Xn=ct();if(Gt(Xn))return ft(Xn);Qt=setTimeout(wn,function kt(Xn){var Ln=Tt-(Xn-On);return cr?Ge(Ln,cn-(Xn-un)):Ln}(Xn))}function ft(Xn){return Qt=void 0,Ct&&tt?kn(Xn):(tt=We=void 0,Cn)}function or(){var Xn=ct(),fn=Gt(Xn);if(tt=arguments,We=this,On=Xn,fn){if(void 0===Qt)return qe(On);if(cr)return Qt=setTimeout(wn,Tt),kn(On)}return void 0===Qt&&(Qt=setTimeout(wn,Tt)),Cn}return Tt=Wt(Tt)||0,Kt(Nt)&&(Vn=!!Nt.leading,cn=(cr="maxWait"in Nt)?De(Wt(Nt.maxWait)||0,Tt):cn,Ct="trailing"in Nt?!!Nt.trailing:Ct),or.cancel=function Sn(){void 0!==Qt&&clearTimeout(Qt),un=0,tt=On=We=Qt=void 0},or.flush=function Ur(){return void 0===Qt?Cn:ft(ct())},or}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(it,dt,f){(function(Se){var Ue="__lodash_hash_undefined__",ae=9007199254740991,ge="[object Arguments]",_e="[object Array]",Le="[object Boolean]",yt="[object Date]",wt="[object Error]",rt="[object Function]",De="[object Map]",Ge="[object Number]",gt="[object Object]",Kt="[object Promise]",rn="[object RegExp]",Wt="[object Set]",St="[object String]",Tt="[object Symbol]",tt="[object WeakMap]",We="[object ArrayBuffer]",cn="[object DataView]",Gt=/^\[object .+?Constructor\]$/,wn=/^(?:0|[1-9]\d*)$/,ft={};ft["[object Float32Array]"]=ft["[object Float64Array]"]=ft["[object Int8Array]"]=ft["[object Int16Array]"]=ft["[object Int32Array]"]=ft["[object Uint8Array]"]=ft["[object Uint8ClampedArray]"]=ft["[object Uint16Array]"]=ft["[object Uint32Array]"]=!0,ft[ge]=ft[_e]=ft[We]=ft[Le]=ft[cn]=ft[yt]=ft[wt]=ft[rt]=ft[De]=ft[Ge]=ft[gt]=ft[rn]=ft[Wt]=ft[St]=ft[tt]=!1;var Sn="object"==typeof Se&&Se&&Se.Object===Object&&Se,Ur="object"==typeof self&&self&&self.Object===Object&&self,or=Sn||Ur||Function("return this")(),Xn="object"==typeof f&&f&&!f.nodeType&&f,fn=Xn&&"object"==typeof dt&&dt&&!dt.nodeType&&dt,sr=fn&&fn.exports===Xn,Ln=sr&&Sn.process,Di=function(){try{return Ln&&Ln.binding&&Ln.binding("util")}catch(ne){}}(),Vr=Di&&Di.isTypedArray;function Or(ne,Ce){for(var Qe=-1,$t=null==ne?0:ne.length;++Qe<$t;)if(Ce(ne[Qe],Qe,ne))return!0;return!1}function No(ne,Ce){return ne.has(Ce)}function Si(ne){var Ce=-1,Qe=Array(ne.size);return ne.forEach(function($t,ar){Qe[++Ce]=[ar,$t]}),Qe}function Bo(ne){var Ce=-1,Qe=Array(ne.size);return ne.forEach(function($t){Qe[++Ce]=$t}),Qe}var ne,es=Array.prototype,ts=Object.prototype,ws=or["__core-js_shared__"],Vs=Function.prototype.toString,gi=ts.hasOwnProperty,$s=(ne=/[^.]+$/.exec(ws&&ws.keys&&ws.keys.IE_PROTO||""))?"Symbol(src)_1."+ne:"",Ii=ts.toString,Es=RegExp("^"+Vs.call(gi).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_i=sr?or.Buffer:void 0,$r=or.Symbol,Zn=or.Uint8Array,eo=ts.propertyIsEnumerable,Kn=es.splice,Oi=$r?$r.toStringTag:void 0,Uo=Object.getOwnPropertySymbols,K=_i?_i.isBuffer:void 0,z=function Qi(ne,Ce){return function(Qe){return ne(Ce(Qe))}}(Object.keys,Object),j=An(or,"DataView"),X=An(or,"Map"),Y=An(or,"Promise"),de=An(or,"Set"),pe=An(or,"WeakMap"),we=An(Object,"create"),xe=dr(j),Pe=dr(X),Ke=dr(Y),vt=dr(de),Xe=dr(pe),Yt=$r?$r.prototype:void 0,Bt=Yt?Yt.valueOf:void 0;function Ut(ne){var Ce=-1,Qe=null==ne?0:ne.length;for(this.clear();++Ce<Qe;){var $t=ne[Ce];this.set($t[0],$t[1])}}function Mn(ne){var Ce=-1,Qe=null==ne?0:ne.length;for(this.clear();++Ce<Qe;){var $t=ne[Ce];this.set($t[0],$t[1])}}function yi(ne){var Ce=-1,Qe=null==ne?0:ne.length;for(this.clear();++Ce<Qe;){var $t=ne[Ce];this.set($t[0],$t[1])}}function ai(ne){var Ce=-1,Qe=null==ne?0:ne.length;for(this.__data__=new yi;++Ce<Qe;)this.add(ne[Ce])}function Hi(ne){var Ce=this.__data__=new Mn(ne);this.size=Ce.size}function mn(ne,Ce){var Qe=Dr(ne),$t=!Qe&&po(ne),ar=!Qe&&!$t&&ii(ne),Tn=!Qe&&!$t&&!ar&&Yr(ne),bt=Qe||$t||ar||Tn,Jn=bt?function Ji(ne,Ce){for(var Qe=-1,$t=Array(ne);++Qe<ne;)$t[Qe]=Ce(Qe);return $t}(ne.length,String):[],pi=Jn.length;for(var er in ne)(Ce||gi.call(ne,er))&&(!bt||!("length"==er||ar&&("offset"==er||"parent"==er)||Tn&&("buffer"==er||"byteLength"==er||"byteOffset"==er)||Fe(er,pi)))&&Jn.push(er);return Jn}function So(ne,Ce){for(var Qe=ne.length;Qe--;)if(yr(ne[Qe][0],Ce))return Qe;return-1}function Cr(ne){return null==ne?void 0===ne?"[object Undefined]":"[object Null]":Oi&&Oi in Object(ne)?function Yl(ne){var Ce=gi.call(ne,Oi),Qe=ne[Oi];try{ne[Oi]=void 0;var $t=!0}catch(Tn){}var ar=Ii.call(ne);return $t&&(Ce?ne[Oi]=Qe:delete ne[Oi]),ar}(ne):function Hr(ne){return Ii.call(ne)}(ne)}function di(ne){return Vo(ne)&&Cr(ne)==ge}function Io(ne,Ce,Qe,$t,ar){return ne===Ce||(null==ne||null==Ce||!Vo(ne)&&!Vo(Ce)?ne!=ne&&Ce!=Ce:function gr(ne,Ce,Qe,$t,ar,Tn){var bt=Dr(ne),Jn=Dr(Ce),pi=bt?_e:fe(ne),er=Jn?_e:fe(Ce),Dt=(pi=pi==ge?gt:pi)==gt,vn=(er=er==ge?gt:er)==gt,Bn=pi==er;if(Bn&&ii(ne)){if(!ii(Ce))return!1;bt=!0,Dt=!1}if(Bn&&!Dt)return Tn||(Tn=new Hi),bt||Yr(ne)?Mi(ne,Ce,Qe,$t,ar,Tn):function no(ne,Ce,Qe,$t,ar,Tn,bt){switch(Qe){case cn:if(ne.byteLength!=Ce.byteLength||ne.byteOffset!=Ce.byteOffset)return!1;ne=ne.buffer,Ce=Ce.buffer;case We:return!(ne.byteLength!=Ce.byteLength||!Tn(new Zn(ne),new Zn(Ce)));case Le:case yt:case Ge:return yr(+ne,+Ce);case wt:return ne.name==Ce.name&&ne.message==Ce.message;case rn:case St:return ne==Ce+"";case De:var Jn=Si;case Wt:if(Jn||(Jn=Bo),ne.size!=Ce.size&&!(1&$t))return!1;var er=bt.get(ne);if(er)return er==Ce;$t|=2,bt.set(ne,Ce);var Dt=Mi(Jn(ne),Jn(Ce),$t,ar,Tn,bt);return bt.delete(ne),Dt;case Tt:if(Bt)return Bt.call(ne)==Bt.call(Ce)}return!1}(ne,Ce,pi,Qe,$t,ar,Tn);if(!(1&Qe)){var Fr=Dt&&gi.call(ne,"__wrapped__"),li=vn&&gi.call(Ce,"__wrapped__");if(Fr||li){var Er=Fr?ne.value():ne,Jr=li?Ce.value():Ce;return Tn||(Tn=new Hi),ar(Er,Jr,Qe,$t,Tn)}}return!!Bn&&(Tn||(Tn=new Hi),function Cs(ne,Ce,Qe,$t,ar,Tn){var bt=1&Qe,Jn=os(ne),pi=Jn.length;if(pi!=os(Ce).length&&!bt)return!1;for(var vn=pi;vn--;){var Bn=Jn[vn];if(!(bt?Bn in Ce:gi.call(Ce,Bn)))return!1}var Fr=Tn.get(ne);if(Fr&&Tn.get(Ce))return Fr==Ce;var li=!0;Tn.set(ne,Ce),Tn.set(Ce,ne);for(var Er=bt;++vn<pi;){var Jr=ne[Bn=Jn[vn]],ur=Ce[Bn];if($t)var Is=bt?$t(ur,Jr,Bn,Ce,ne,Tn):$t(Jr,ur,Bn,ne,Ce,Tn);if(!(void 0===Is?Jr===ur||ar(Jr,ur,Qe,$t,Tn):Is)){li=!1;break}Er||(Er="constructor"==Bn)}if(li&&!Er){var mo=ne.constructor,In=Ce.constructor;mo!=In&&"constructor"in ne&&"constructor"in Ce&&!("function"==typeof mo&&mo instanceof mo&&"function"==typeof In&&In instanceof In)&&(li=!1)}return Tn.delete(ne),Tn.delete(Ce),li}(ne,Ce,Qe,$t,ar,Tn))}(ne,Ce,Qe,$t,Io,ar))}function ei(ne){return!(!Ss(ne)||function Dn(ne){return!!$s&&$s in ne}(ne))&&(Ds(ne)?Es:Gt).test(dr(ne))}function fi(ne){if(!function Hn(ne){var Ce=ne&&ne.constructor;return ne===("function"==typeof Ce&&Ce.prototype||ts)}(ne))return z(ne);var Ce=[];for(var Qe in Object(ne))gi.call(ne,Qe)&&"constructor"!=Qe&&Ce.push(Qe);return Ce}function Mi(ne,Ce,Qe,$t,ar,Tn){var bt=1&Qe,Jn=ne.length,pi=Ce.length;if(Jn!=pi&&!(bt&&pi>Jn))return!1;var er=Tn.get(ne);if(er&&Tn.get(Ce))return er==Ce;var Dt=-1,vn=!0,Bn=2&Qe?new ai:void 0;for(Tn.set(ne,Ce),Tn.set(Ce,ne);++Dt<Jn;){var Fr=ne[Dt],li=Ce[Dt];if($t)var Er=bt?$t(li,Fr,Dt,Ce,ne,Tn):$t(Fr,li,Dt,ne,Ce,Tn);if(void 0!==Er){if(Er)continue;vn=!1;break}if(Bn){if(!Or(Ce,function(Jr,ur){if(!No(Bn,ur)&&(Fr===Jr||ar(Fr,Jr,Qe,$t,Tn)))return Bn.push(ur)})){vn=!1;break}}else if(Fr!==li&&!ar(Fr,li,Qe,$t,Tn)){vn=!1;break}}return Tn.delete(ne),Tn.delete(Ce),vn}function os(ne){return function Gr(ne,Ce,Qe){var $t=Ce(ne);return Dr(ne)?$t:function Co(ne,Ce){for(var Qe=-1,$t=Ce.length,ar=ne.length;++Qe<$t;)ne[ar+Qe]=Ce[Qe];return ne}($t,Qe(ne))}(ne,Lr,Jl)}function za(ne,Ce){var Qe=ne.__data__;return function st(ne){var Ce=typeof ne;return"string"==Ce||"number"==Ce||"symbol"==Ce||"boolean"==Ce?"__proto__"!==ne:null===ne}(Ce)?Qe["string"==typeof Ce?"string":"hash"]:Qe.map}function An(ne,Ce){var Qe=function hi(ne,Ce){return null==ne?void 0:ne[Ce]}(ne,Ce);return ei(Qe)?Qe:void 0}Ut.prototype.clear=function Xt(){this.__data__=we?we(null):{},this.size=0},Ut.prototype.delete=function ke(ne){var Ce=this.has(ne)&&delete this.__data__[ne];return this.size-=Ce?1:0,Ce},Ut.prototype.get=function Yn(ne){var Ce=this.__data__;if(we){var Qe=Ce[ne];return Qe===Ue?void 0:Qe}return gi.call(Ce,ne)?Ce[ne]:void 0},Ut.prototype.has=function Ot(ne){var Ce=this.__data__;return we?void 0!==Ce[ne]:gi.call(Ce,ne)},Ut.prototype.set=function Gn(ne,Ce){var Qe=this.__data__;return this.size+=this.has(ne)?0:1,Qe[ne]=we&&void 0===Ce?Ue:Ce,this},Mn.prototype.clear=function ns(){this.__data__=[],this.size=0},Mn.prototype.delete=function Do(ne){var Ce=this.__data__,Qe=So(Ce,ne);return!(Qe<0||(Qe==Ce.length-1?Ce.pop():Kn.call(Ce,Qe,1),--this.size,0))},Mn.prototype.get=function xt(ne){var Ce=this.__data__,Qe=So(Ce,ne);return Qe<0?void 0:Ce[Qe][1]},Mn.prototype.has=function an(ne){return So(this.__data__,ne)>-1},Mn.prototype.set=function Zt(ne,Ce){var Qe=this.__data__,$t=So(Qe,ne);return $t<0?(++this.size,Qe.push([ne,Ce])):Qe[$t][1]=Ce,this},yi.prototype.clear=function rs(){this.size=0,this.__data__={hash:new Ut,map:new(X||Mn),string:new Ut}},yi.prototype.delete=function Rn(ne){var Ce=za(this,ne).delete(ne);return this.size-=Ce?1:0,Ce},yi.prototype.get=function hn(ne){return za(this,ne).get(ne)},yi.prototype.has=function is(ne){return za(this,ne).has(ne)},yi.prototype.set=function br(ne,Ce){var Qe=za(this,ne),$t=Qe.size;return Qe.set(ne,Ce),this.size+=Qe.size==$t?0:1,this},ai.prototype.add=ai.prototype.push=function wr(ne){return this.__data__.set(ne,Ue),this},ai.prototype.has=function Kl(ne){return this.__data__.has(ne)},Hi.prototype.clear=function Gs(){this.__data__=new Mn,this.size=0},Hi.prototype.delete=function to(ne){var Ce=this.__data__,Qe=Ce.delete(ne);return this.size=Ce.size,Qe},Hi.prototype.get=function Ts(ne){return this.__data__.get(ne)},Hi.prototype.has=function Hs(ne){return this.__data__.has(ne)},Hi.prototype.set=function jn(ne,Ce){var Qe=this.__data__;if(Qe instanceof Mn){var $t=Qe.__data__;if(!X||$t.length<199)return $t.push([ne,Ce]),this.size=++Qe.size,this;Qe=this.__data__=new yi($t)}return Qe.set(ne,Ce),this.size=Qe.size,this};var Jl=Uo?function(ne){return null==ne?[]:(ne=Object(ne),function Ri(ne,Ce){for(var Qe=-1,$t=null==ne?0:ne.length,ar=0,Tn=[];++Qe<$t;){var bt=ne[Qe];Ce(bt,Qe,ne)&&(Tn[ar++]=bt)}return Tn}(Uo(ne),function(Ce){return eo.call(ne,Ce)}))}:function fr(){return[]},fe=Cr;function Fe(ne,Ce){return!!(Ce=null==Ce?ae:Ce)&&("number"==typeof ne||wn.test(ne))&&ne>-1&&ne%1==0&&ne<Ce}function dr(ne){if(null!=ne){try{return Vs.call(ne)}catch(Ce){}try{return ne+""}catch(Ce){}}return""}function yr(ne,Ce){return ne===Ce||ne!=ne&&Ce!=Ce}(j&&fe(new j(new ArrayBuffer(1)))!=cn||X&&fe(new X)!=De||Y&&fe(Y.resolve())!=Kt||de&&fe(new de)!=Wt||pe&&fe(new pe)!=tt)&&(fe=function(ne){var Ce=Cr(ne),Qe=Ce==gt?ne.constructor:void 0,$t=Qe?dr(Qe):"";if($t)switch($t){case xe:return cn;case Pe:return De;case Ke:return Kt;case vt:return Wt;case Xe:return tt}return Ce});var po=di(function(){return arguments}())?di:function(ne){return Vo(ne)&&gi.call(ne,"callee")&&!eo.call(ne,"callee")},Dr=Array.isArray;var ii=K||function Li(){return!1};function Ds(ne){if(!Ss(ne))return!1;var Ce=Cr(ne);return Ce==rt||"[object GeneratorFunction]"==Ce||"[object AsyncFunction]"==Ce||"[object Proxy]"==Ce}function oi(ne){return"number"==typeof ne&&ne>-1&&ne%1==0&&ne<=ae}function Ss(ne){var Ce=typeof ne;return null!=ne&&("object"==Ce||"function"==Ce)}function Vo(ne){return null!=ne&&"object"==typeof ne}var Yr=Vr?function Gi(ne){return function(Ce){return ne(Ce)}}(Vr):function jo(ne){return Vo(ne)&&oi(ne.length)&&!!ft[Cr(ne)]};function Lr(ne){return function vl(ne){return null!=ne&&oi(ne.length)&&!Ds(ne)}(ne)?mn(ne):fi(ne)}dt.exports=function xl(ne,Ce){return Io(ne,Ce)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(it,dt,f){(function(Se){var Ie=it("lodash._reinterpolate"),Ue=it("lodash.templatesettings"),ge=9007199254740991,_e="[object Arguments]",Ze="[object Error]",De="[object Function]",en="[object Object]",Nt="[object Symbol]",Gt=/\b__p \+= '';/g,wn=/\b(__p \+=) '' \+/g,ft=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ur=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,or=/^\[object .+?Constructor\]$/,Xn=/^(?:0|[1-9]\d*)$/,fn=/($^)/,sr=/['\n\r\u2028\u2029\\]/g,Ln={};Ln["[object Float32Array]"]=Ln["[object Float64Array]"]=Ln["[object Int8Array]"]=Ln["[object Int16Array]"]=Ln["[object Int32Array]"]=Ln["[object Uint8Array]"]=Ln["[object Uint8ClampedArray]"]=Ln["[object Uint16Array]"]=Ln["[object Uint32Array]"]=!0,Ln[_e]=Ln["[object Array]"]=Ln["[object ArrayBuffer]"]=Ln["[object Boolean]"]=Ln["[object DataView]"]=Ln["[object Date]"]=Ln[Ze]=Ln[De]=Ln["[object Map]"]=Ln["[object Number]"]=Ln[en]=Ln["[object RegExp]"]=Ln["[object Set]"]=Ln["[object String]"]=Ln["[object WeakMap]"]=!1;var Di={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Vr="object"==typeof Se&&Se&&Se.Object===Object&&Se,Ri="object"==typeof self&&self&&self.Object===Object&&self,Co=Vr||Ri||Function("return this")(),Or="object"==typeof f&&f&&!f.nodeType&&f,Ji=Or&&"object"==typeof dt&&dt&&!dt.nodeType&&dt,Gi=Ji&&Ji.exports===Or,No=Gi&&Vr.process,hi=function(){try{return Ji&&Ji.require&&Ji.require("util").types||No&&No.binding&&No.binding("util")}catch(Fe){}}(),Si=hi&&hi.isTypedArray;function Qi(fe,Fe,st){switch(st.length){case 0:return fe.call(Fe);case 1:return fe.call(Fe,st[0]);case 2:return fe.call(Fe,st[0],st[1]);case 3:return fe.call(Fe,st[0],st[1],st[2])}return fe.apply(Fe,st)}function Bo(fe,Fe){for(var st=-1,Dn=null==fe?0:fe.length,Hn=Array(Dn);++st<Dn;)Hn[st]=Fe(fe[st],st,fe);return Hn}function ws(fe){return"\\"+Di[fe]}function gi(fe,Fe){return function(st){return fe(Fe(st))}}var fe,Ii=Object.prototype,Es=Co["__core-js_shared__"],_i=Function.prototype.toString,$r=Ii.hasOwnProperty,Zn=(fe=/[^.]+$/.exec(Es&&Es.keys&&Es.keys.IE_PROTO||""))?"Symbol(src)_1."+fe:"",eo=Ii.toString,Kn=_i.call(Object),Oi=RegExp("^"+_i.call($r).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Uo=Gi?Co.Buffer:void 0,K=Co.Symbol,z=gi(Object.getPrototypeOf,Object),j=Ii.propertyIsEnumerable,X=K?K.toStringTag:void 0,Y=function(){try{var fe=function Zt(fe,Fe){var st=function Vs(fe,Fe){return null==fe?void 0:fe[Fe]}(fe,Fe);return function Xt(fe){return!(!di(fe)||function hn(fe){return!!Zn&&Zn in fe}(fe))&&(Gr(fe)?Oi:or).test(function Gs(fe){if(null!=fe){try{return _i.call(fe)}catch(Fe){}try{return fe+""}catch(Fe){}}return""}(fe))}(st)?st:void 0}(Object,"defineProperty");return fe({},"",{}),fe}catch(Fe){}}(),de=Uo?Uo.isBuffer:void 0,pe=gi(Object.keys,Object),we=Math.max,xe=Date.now,Pe=K?K.prototype:void 0,Ke=Pe?Pe.toString:void 0;function vt(fe,Fe){var st=Hs(fe),Dn=!st&&Ts(fe),Hn=!st&&!Dn&&mn(fe),Hr=!st&&!Dn&&!Hn&&jo(fe),dr=st||Dn||Hn||Hr,yr=dr?function es(fe,Fe){for(var st=-1,Dn=Array(fe);++st<fe;)Dn[st]=Fe(st);return Dn}(fe.length,String):[],po=yr.length;for(var Dr in fe)(Fe||$r.call(fe,Dr))&&(!dr||!("length"==Dr||Hn&&("offset"==Dr||"parent"==Dr)||Hr&&("buffer"==Dr||"byteLength"==Dr||"byteOffset"==Dr)||rs(Dr,po)))&&yr.push(Dr);return yr}function Xe(fe,Fe,st){var Dn=fe[Fe];(!$r.call(fe,Fe)||!to(Dn,st)||void 0===st&&!(Fe in fe))&&Yt(fe,Fe,st)}function Yt(fe,Fe,st){"__proto__"==Fe&&Y?Y(fe,Fe,{configurable:!0,enumerable:!0,value:st,writable:!0}):fe[Fe]=st}function Bt(fe){return null==fe?void 0===fe?"[object Undefined]":"[object Null]":X&&X in Object(fe)?function yi(fe){var Fe=$r.call(fe,X),st=fe[X];try{fe[X]=void 0;var Dn=!0}catch(Hr){}var Hn=eo.call(fe);return Dn&&(Fe?fe[X]=st:delete fe[X]),Hn}(fe):function ai(fe){return eo.call(fe)}(fe)}function Ut(fe){return Io(fe)&&Bt(fe)==_e}function Ot(fe){if(!di(fe))return function br(fe){var Fe=[];if(null!=fe)for(var st in Object(fe))Fe.push(st);return Fe}(fe);var Fe=is(fe),st=[];for(var Dn in fe)"constructor"==Dn&&(Fe||!$r.call(fe,Dn))||st.push(Dn);return st}function Gn(fe,Fe){return Kl(function wr(fe,Fe,st){return Fe=we(void 0===Fe?fe.length-1:Fe,0),function(){for(var Dn=arguments,Hn=-1,Hr=we(Dn.length-Fe,0),dr=Array(Hr);++Hn<Hr;)dr[Hn]=Dn[Fe+Hn];Hn=-1;for(var yr=Array(Fe+1);++Hn<Fe;)yr[Hn]=Dn[Hn];return yr[Fe]=st(dr),Qi(fe,this,yr)}}(fe,Fe,Yl),fe+"")}var Mn=Y?function(fe,Fe){return Y(fe,"toString",{configurable:!0,enumerable:!1,value:An(Fe),writable:!0})}:Yl;function ns(fe){if("string"==typeof fe)return fe;if(Hs(fe))return Bo(fe,ns)+"";if(function ei(fe){return"symbol"==typeof fe||Io(fe)&&Bt(fe)==Nt}(fe))return Ke?Ke.call(fe):"";var Fe=fe+"";return"0"==Fe&&1/fe==-Infinity?"-0":Fe}function an(fe,Fe,st,Dn){return void 0===fe||to(fe,Ii[st])&&!$r.call(Dn,st)?Fe:fe}function rs(fe,Fe){var st=typeof fe;return!!(Fe=null==Fe?ge:Fe)&&("number"==st||"symbol"!=st&&Xn.test(fe))&&fe>-1&&fe%1==0&&fe<Fe}function Rn(fe,Fe,st){if(!di(st))return!1;var Dn=typeof Fe;return!!("number"==Dn?jn(st)&&rs(Fe,st.length):"string"==Dn&&Fe in st)&&to(st[Fe],fe)}function is(fe){var Fe=fe&&fe.constructor;return fe===("function"==typeof Fe&&Fe.prototype||Ii)}var Kl=function Hi(fe){var Fe=0,st=0;return function(){var Dn=xe(),Hn=16-(Dn-st);if(st=Dn,Hn>0){if(++Fe>=800)return arguments[0]}else Fe=0;return fe.apply(void 0,arguments)}}(Mn);function to(fe,Fe){return fe===Fe||fe!=fe&&Fe!=Fe}var Ts=Ut(function(){return arguments}())?Ut:function(fe){return Io(fe)&&$r.call(fe,"callee")&&!j.call(fe,"callee")},Hs=Array.isArray;function jn(fe){return null!=fe&&Cr(fe.length)&&!Gr(fe)}var mn=de||function Jl(){return!1};function So(fe){if(!Io(fe))return!1;var Fe=Bt(fe);return Fe==Ze||"[object DOMException]"==Fe||"string"==typeof fe.message&&"string"==typeof fe.name&&!function gr(fe){if(!Io(fe)||Bt(fe)!=en)return!1;var Fe=z(fe);if(null===Fe)return!0;var st=$r.call(Fe,"constructor")&&Fe.constructor;return"function"==typeof st&&st instanceof st&&_i.call(st)==Kn}(fe)}function Gr(fe){if(!di(fe))return!1;var Fe=Bt(fe);return Fe==De||"[object GeneratorFunction]"==Fe||"[object AsyncFunction]"==Fe||"[object Proxy]"==Fe}function Cr(fe){return"number"==typeof fe&&fe>-1&&fe%1==0&&fe<=ge}function di(fe){var Fe=typeof fe;return null!=fe&&("object"==Fe||"function"==Fe)}function Io(fe){return null!=fe&&"object"==typeof fe}var jo=Si?function bs(fe){return function(Fe){return fe(Fe)}}(Si):function ke(fe){return Io(fe)&&Cr(fe.length)&&!!Ln[Bt(fe)]};var Mi=function xt(fe){return Gn(function(Fe,st){var Dn=-1,Hn=st.length,Hr=Hn>1?st[Hn-1]:void 0,dr=Hn>2?st[2]:void 0;for(Hr=fe.length>3&&"function"==typeof Hr?(Hn--,Hr):void 0,dr&&Rn(st[0],st[1],dr)&&(Hr=Hn<3?void 0:Hr,Hn=1),Fe=Object(Fe);++Dn<Hn;){var yr=st[Dn];yr&&fe(Fe,yr,Dn,Hr)}return Fe})}(function(fe,Fe,st,Dn){!function Do(fe,Fe,st,Dn){var Hn=!st;st||(st={});for(var Hr=-1,dr=Fe.length;++Hr<dr;){var yr=Fe[Hr],po=Dn?Dn(st[yr],fe[yr],yr,st,fe):void 0;void 0===po&&(po=fe[yr]),Hn?Yt(st,yr,po):Xe(st,yr,po)}return st}(Fe,function Cs(fe){return jn(fe)?vt(fe,!0):Ot(fe)}(Fe),fe,Dn)});function no(fe){return jn(fe)?vt(fe):function Yn(fe){if(!is(fe))return pe(fe);var Fe=[];for(var st in Object(fe))$r.call(fe,st)&&"constructor"!=st&&Fe.push(st);return Fe}(fe)}var za=Gn(function(fe,Fe){try{return Qi(fe,void 0,Fe)}catch(st){return So(st)?st:new Error(st)}});function An(fe){return function(){return fe}}function Yl(fe){return fe}dt.exports=function os(fe,Fe,st){var Dn=Ue.imports._.templateSettings||Ue;st&&Rn(fe,Fe,st)&&(Fe=void 0),fe=function fi(fe){return null==fe?"":ns(fe)}(fe),Fe=Mi({},Fe,Dn,an);var yr,po,Hn=Mi({},Fe.imports,Dn.imports,an),Hr=no(Hn),dr=function ts(fe,Fe){return Bo(Fe,function(st){return fe[st]})}(Hn,Hr),Dr=0,vl=Fe.interpolate||fn,ii="__p += '",xl=RegExp((Fe.escape||fn).source+"|"+vl.source+"|"+(vl===Ie?Ur:fn).source+"|"+(Fe.evaluate||fn).source+"|$","g"),Ds=$r.call(Fe,"sourceURL")?"//# sourceURL="+(Fe.sourceURL+"").replace(/[\r\n]/g," ")+"\n":"";fe.replace(xl,function(Vo,Yr,Lr,fr,Li,ne){return Lr||(Lr=fr),ii+=fe.slice(Dr,ne).replace(sr,ws),Yr&&(yr=!0,ii+="' +\n__e("+Yr+") +\n'"),Li&&(po=!0,ii+="';\n"+Li+";\n__p += '"),Lr&&(ii+="' +\n((__t = ("+Lr+")) == null ? '' : __t) +\n'"),Dr=ne+Vo.length,Vo}),ii+="';\n";var oi=$r.call(Fe,"variable")&&Fe.variable;oi||(ii="with (obj) {\n"+ii+"\n}\n"),ii=(po?ii.replace(Gt,""):ii).replace(wn,"$1").replace(ft,"$1;"),ii="function("+(oi||"obj")+") {\n"+(oi?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(yr?", __e = _.escape":"")+(po?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+ii+"return __p\n}";var Ss=za(function(){return Function(Hr,Ds+"return "+ii).apply(void 0,dr)});if(Ss.source=ii,So(Ss))throw Ss;return Ss}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._reinterpolate":6,"lodash.templatesettings":10}],10:[function(it,dt,f){(function(Se){var Ie=it("lodash._reinterpolate"),me="[object Symbol]",ge=/[&<>"']/g,_e=RegExp(ge.source),rt="object"==typeof self&&self&&self.Object===Object&&self,Ze="object"==typeof Se&&Se&&Se.Object===Object&&Se||rt||Function("return this")();var ct=function Ge(Ct){return function(kn){return null==Ct?void 0:Ct[kn]}}({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),gt=Object.prototype,Kt=gt.hasOwnProperty,en=gt.toString,rn=Ze.Symbol,Wt=rn?rn.toStringTag:void 0,St=rn?rn.prototype:void 0,Tt=St?St.toString:void 0;function tt(Ct){return null==Ct?void 0===Ct?"[object Undefined]":"[object Null]":Wt&&Wt in Object(Ct)?function cn(Ct){var kn=Kt.call(Ct,Wt),qe=Ct[Wt];try{Ct[Wt]=void 0;var kt=!0}catch(wn){}var Gt=en.call(Ct);return kt&&(kn?Ct[Wt]=qe:delete Ct[Wt]),Gt}(Ct):function Cn(Ct){return en.call(Ct)}(Ct)}function We(Ct){if("string"==typeof Ct)return Ct;if(Qt(Ct))return function De(Ct,kn){for(var qe=-1,kt=null==Ct?0:Ct.length,Gt=Array(kt);++qe<kt;)Gt[qe]=kn(Ct[qe],qe,Ct);return Gt}(Ct,We)+"";if(function un(Ct){return"symbol"==typeof Ct||function On(Ct){return null!=Ct&&"object"==typeof Ct}(Ct)&&tt(Ct)==me}(Ct))return Tt?Tt.call(Ct):"";var kn=Ct+"";return"0"==kn&&1/Ct==-Infinity?"-0":kn}var Qt=Array.isArray;dt.exports={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:Ie,variable:"",imports:{_:{escape:function cr(Ct){return(Ct=function Vn(Ct){return null==Ct?"":We(Ct)}(Ct))&&_e.test(Ct)?Ct.replace(ge,ct):Ct}}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"lodash._reinterpolate":6}],11:[function(it,dt,f){var Se=it("./_root");dt.exports=Se.Symbol},{"./_root":18}],12:[function(it,dt,f){var Se=it("./_Symbol"),Ie=it("./_getRawTag"),Ue=it("./_objectToString"),ae=Se?Se.toStringTag:void 0;dt.exports=function ge(_e){return null==_e?void 0===_e?"[object Undefined]":"[object Null]":ae&&ae in Object(_e)?Ie(_e):Ue(_e)}},{"./_Symbol":11,"./_getRawTag":15,"./_objectToString":16}],13:[function(it,dt,f){(function(Se){dt.exports="object"==typeof Se&&Se&&Se.Object===Object&&Se}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(it,dt,f){var Ie=it("./_overArg")(Object.getPrototypeOf,Object);dt.exports=Ie},{"./_overArg":17}],15:[function(it,dt,f){var Se=it("./_Symbol"),Ie=Object.prototype,Ue=Ie.hasOwnProperty,se=Ie.toString,me=Se?Se.toStringTag:void 0;dt.exports=function ae(ge){var _e=Ue.call(ge,me),ve=ge[me];try{ge[me]=void 0;var Le=!0}catch(wt){}var yt=se.call(ge);return Le&&(_e?ge[me]=ve:delete ge[me]),yt}},{"./_Symbol":11}],16:[function(it,dt,f){var Ie=Object.prototype.toString;dt.exports=function Ue(se){return Ie.call(se)}},{}],17:[function(it,dt,f){dt.exports=function Se(Ie,Ue){return function(se){return Ie(Ue(se))}}},{}],18:[function(it,dt,f){var Se=it("./_freeGlobal"),Ie="object"==typeof self&&self&&self.Object===Object&&self,Ue=Se||Ie||Function("return this")();dt.exports=Ue},{"./_freeGlobal":13}],19:[function(it,dt,f){dt.exports=function Se(Ie){return null!=Ie&&"object"==typeof Ie}},{}],20:[function(it,dt,f){var Se=it("./_baseGetTag"),Ie=it("./_getPrototype"),Ue=it("./isObjectLike"),ge=Function.prototype.toString,_e=Object.prototype.hasOwnProperty,ve=ge.call(Object);dt.exports=function Le(yt){if(!Ue(yt)||"[object Object]"!=Se(yt))return!1;var wt=Ie(yt);if(null===wt)return!0;var rt=_e.call(wt,"constructor")&&wt.constructor;return"function"==typeof rt&&rt instanceof rt&&ge.call(rt)==ve}},{"./_baseGetTag":12,"./_getPrototype":14,"./isObjectLike":19}],21:[function(it,dt,f){var Ie,Ue,Se=dt.exports={};function se(){throw new Error("setTimeout has not been defined")}function me(){throw new Error("clearTimeout has not been defined")}function ae(Ge){if(Ie===setTimeout)return setTimeout(Ge,0);if((Ie===se||!Ie)&&setTimeout)return Ie=setTimeout,setTimeout(Ge,0);try{return Ie(Ge,0)}catch(ct){try{return Ie.call(null,Ge,0)}catch(gt){return Ie.call(this,Ge,0)}}}!function(){try{Ie="function"==typeof setTimeout?setTimeout:se}catch(Ge){Ie=se}try{Ue="function"==typeof clearTimeout?clearTimeout:me}catch(Ge){Ue=me}}();var Le,_e=[],ve=!1,yt=-1;function wt(){!ve||!Le||(ve=!1,Le.length?_e=Le.concat(_e):yt=-1,_e.length&&rt())}function rt(){if(!ve){var Ge=ae(wt);ve=!0;for(var ct=_e.length;ct;){for(Le=_e,_e=[];++yt<ct;)Le&&Le[yt].run();yt=-1,ct=_e.length}Le=null,ve=!1,function ge(Ge){if(Ue===clearTimeout)return clearTimeout(Ge);if((Ue===me||!Ue)&&clearTimeout)return Ue=clearTimeout,clearTimeout(Ge);try{return Ue(Ge)}catch(ct){try{return Ue.call(null,Ge)}catch(gt){return Ue.call(this,Ge)}}}(Ge)}}function Ze(Ge,ct){this.fun=Ge,this.array=ct}function De(){}Se.nextTick=function(Ge){var ct=new Array(arguments.length-1);if(arguments.length>1)for(var gt=1;gt<arguments.length;gt++)ct[gt-1]=arguments[gt];_e.push(new Ze(Ge,ct)),1===_e.length&&!ve&&ae(rt)},Ze.prototype.run=function(){this.fun.apply(null,this.array)},Se.title="browser",Se.browser=!0,Se.env={},Se.argv=[],Se.version="",Se.versions={},Se.on=De,Se.addListener=De,Se.once=De,Se.off=De,Se.removeListener=De,Se.removeAllListeners=De,Se.emit=De,Se.prependListener=De,Se.prependOnceListener=De,Se.listeners=function(Ge){return[]},Se.binding=function(Ge){throw new Error("process.binding is not supported")},Se.cwd=function(){return"/"},Se.chdir=function(Ge){throw new Error("process.chdir is not supported")},Se.umask=function(){return 0}},{}],22:[function(it,dt,f){"use strict";function Se(Ue){return function(se){var me=se.dispatch,ae=se.getState;return function(ge){return function(_e){return"function"==typeof _e?_e(me,ae,Ue):ge(_e)}}}}f.__esModule=!0;var Ie=Se();Ie.withExtraArgument=Se,f.default=Ie},{}],23:[function(it,dt,f){"use strict";f.__esModule=!0;var Se=Object.assign||function(ae){for(var ge=1;ge<arguments.length;ge++){var _e=arguments[ge];for(var ve in _e)Object.prototype.hasOwnProperty.call(_e,ve)&&(ae[ve]=_e[ve])}return ae};f.default=function me(){for(var ae=arguments.length,ge=Array(ae),_e=0;_e<ae;_e++)ge[_e]=arguments[_e];return function(ve){return function(Le,yt,wt){var De,rt=ve(Le,yt,wt),Ze=rt.dispatch,Ge={getState:rt.getState,dispatch:function(gt){return Ze(gt)}};return De=ge.map(function(ct){return ct(Ge)}),Ze=Ue.default.apply(void 0,De)(rt.dispatch),Se({},rt,{dispatch:Ze})}}};var Ue=function se(ae){return ae&&ae.__esModule?ae:{default:ae}}(it("./compose"))},{"./compose":26}],24:[function(it,dt,f){"use strict";function Se(Ue,se){return function(){return se(Ue.apply(void 0,arguments))}}f.__esModule=!0,f.default=function Ie(Ue,se){if("function"==typeof Ue)return Se(Ue,se);if("object"!=typeof Ue||null===Ue)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===Ue?"null":typeof Ue)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var me=Object.keys(Ue),ae={},ge=0;ge<me.length;ge++){var _e=me[ge],ve=Ue[_e];"function"==typeof ve&&(ae[_e]=Se(ve,se))}return ae}},{}],25:[function(it,dt,f){(function(Se){"use strict";f.__esModule=!0,f.default=function yt(wt){for(var rt=Object.keys(wt),Ze={},De=0;De<rt.length;De++){var Ge=rt[De];"production"!==Se.env.NODE_ENV&&void 0===wt[Ge]&&(0,ae.default)('No reducer provided for key "'+Ge+'"'),"function"==typeof wt[Ge]&&(Ze[Ge]=wt[Ge])}var ct=Object.keys(Ze),gt=void 0;"production"!==Se.env.NODE_ENV&&(gt={});var Kt=void 0;try{!function Le(wt){Object.keys(wt).forEach(function(rt){var Ze=wt[rt];if(void 0===Ze(void 0,{type:Ie.ActionTypes.INIT}))throw new Error('Reducer "'+rt+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===Ze(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+rt+"\" returned undefined when probed with a random type. Don't try to handle "+Ie.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(Ze)}catch(en){Kt=en}return function(){var rn=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Wt=arguments[1];if(Kt)throw Kt;if("production"!==Se.env.NODE_ENV){var St=ve(rn,Ze,Wt,gt);St&&(0,ae.default)(St)}for(var Tt=!1,Nt={},tt=0;tt<ct.length;tt++){var We=ct[tt],Cn=rn[We],Qt=(0,Ze[We])(Cn,Wt);if(void 0===Qt){var On=_e(We,Wt);throw new Error(On)}Nt[We]=Qt,Tt=Tt||Qt!==Cn}return Tt?Nt:rn}};var Ie=it("./createStore"),se=ge(it("lodash/isPlainObject")),ae=ge(it("./utils/warning"));function ge(wt){return wt&&wt.__esModule?wt:{default:wt}}function _e(wt,rt){var Ze=rt&&rt.type;return"Given action "+(Ze&&'"'+Ze.toString()+'"'||"an action")+', reducer "'+wt+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function ve(wt,rt,Ze,De){var Ge=Object.keys(rt),ct=Ze&&Ze.type===Ie.ActionTypes.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(0===Ge.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!(0,se.default)(wt))return"The "+ct+' has unexpected type of "'+{}.toString.call(wt).match(/\s([a-z|A-Z]+)/)[1]+'". Expected argument to be an object with the following keys: "'+Ge.join('", "')+'"';var gt=Object.keys(wt).filter(function(Kt){return!rt.hasOwnProperty(Kt)&&!De[Kt]});return gt.forEach(function(Kt){De[Kt]=!0}),gt.length>0?"Unexpected "+(gt.length>1?"keys":"key")+' "'+gt.join('", "')+'" found in '+ct+'. Expected to find one of the known reducer keys instead: "'+Ge.join('", "')+'". Unexpected keys will be ignored.':void 0}}).call(this,it("_process"))},{"./createStore":27,"./utils/warning":29,_process:21,"lodash/isPlainObject":20}],26:[function(it,dt,f){"use strict";f.__esModule=!0,f.default=function Se(){for(var Ie=arguments.length,Ue=Array(Ie),se=0;se<Ie;se++)Ue[se]=arguments[se];return 0===Ue.length?function(me){return me}:1===Ue.length?Ue[0]:Ue.reduce(function(me,ae){return function(){return me(ae.apply(void 0,arguments))}})}},{}],27:[function(it,dt,f){"use strict";f.__esModule=!0,f.ActionTypes=void 0,f.default=function ge(_e,ve,Le){var yt;if("function"==typeof ve&&void 0===Le&&(Le=ve,ve=void 0),void 0!==Le){if("function"!=typeof Le)throw new Error("Expected the enhancer to be a function.");return Le(ge)(_e,ve)}if("function"!=typeof _e)throw new Error("Expected the reducer to be a function.");var wt=_e,rt=ve,Ze=[],De=Ze,Ge=!1;function ct(){De===Ze&&(De=Ze.slice())}function gt(){return rt}function Kt(St){if("function"!=typeof St)throw new Error("Expected listener to be a function.");var Tt=!0;return ct(),De.push(St),function(){if(Tt){Tt=!1,ct();var tt=De.indexOf(St);De.splice(tt,1)}}}function en(St){if(!(0,Ie.default)(St))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===St.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(Ge)throw new Error("Reducers may not dispatch actions.");try{Ge=!0,rt=wt(rt,St)}finally{Ge=!1}for(var Tt=Ze=De,Nt=0;Nt<Tt.length;Nt++)(0,Tt[Nt])();return St}return en({type:ae.INIT}),(yt={dispatch:en,subscribe:Kt,getState:gt,replaceReducer:function rn(St){if("function"!=typeof St)throw new Error("Expected the nextReducer to be a function.");wt=St,en({type:ae.INIT})}})[se.default]=function Wt(){var St,Tt=Kt;return(St={subscribe:function(tt){if("object"!=typeof tt)throw new TypeError("Expected the observer to be an object.");function We(){tt.next&&tt.next(gt())}return We(),{unsubscribe:Tt(We)}}})[se.default]=function(){return this},St},yt};var Ie=me(it("lodash/isPlainObject")),se=me(it("symbol-observable"));function me(_e){return _e&&_e.__esModule?_e:{default:_e}}var ae=f.ActionTypes={INIT:"@@redux/INIT"}},{"lodash/isPlainObject":20,"symbol-observable":33}],28:[function(it,dt,f){(function(Se){"use strict";f.__esModule=!0,f.compose=f.applyMiddleware=f.bindActionCreators=f.combineReducers=f.createStore=void 0;var Ue=Ze(it("./createStore")),me=Ze(it("./combineReducers")),ge=Ze(it("./bindActionCreators")),ve=Ze(it("./applyMiddleware")),yt=Ze(it("./compose")),rt=Ze(it("./utils/warning"));function Ze(Ge){return Ge&&Ge.__esModule?Ge:{default:Ge}}function De(){}"production"!==Se.env.NODE_ENV&&"string"==typeof De.name&&"isCrushed"!==De.name&&(0,rt.default)("You are currently using minified code outside of NODE_ENV === 'production'. This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) to ensure you have the correct code for your production build."),f.createStore=Ue.default,f.combineReducers=me.default,f.bindActionCreators=ge.default,f.applyMiddleware=ve.default,f.compose=yt.default}).call(this,it("_process"))},{"./applyMiddleware":23,"./bindActionCreators":24,"./combineReducers":25,"./compose":26,"./createStore":27,"./utils/warning":29,_process:21}],29:[function(it,dt,f){"use strict";f.__esModule=!0,f.default=function Se(Ie){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(Ie);try{throw new Error(Ie)}catch(Ue){}}},{}],30:[function(it,dt,f){"use strict";var Se=it("./src/suggestions");window.Suggestions=dt.exports=Se},{"./src/suggestions":32}],31:[function(it,dt,f){var Se=function(Ie){return this.component=Ie,this.items=[],this.active=0,this.element=document.createElement("ul"),this.element.className="suggestions",this.selectingListItem=!1,Ie.el.parentNode.insertBefore(this.element,Ie.el.nextSibling),this};Se.prototype.show=function(){this.element.style.display="block"},Se.prototype.hide=function(){this.element.style.display="none"},Se.prototype.add=function(Ie){this.items.push(Ie)},Se.prototype.clear=function(){this.items=[],this.active=0},Se.prototype.isEmpty=function(){return!this.items.length},Se.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var Ie=0;Ie<this.items.length;Ie++)this.drawItem(this.items[Ie],this.active===Ie);this.show()}else this.hide()},Se.prototype.drawItem=function(Ie,Ue){var se=document.createElement("li"),me=document.createElement("a");Ue&&(se.className+=" active"),me.innerHTML=Ie.string,se.appendChild(me),this.element.appendChild(se),se.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),se.addEventListener("mouseup",function(){this.handleMouseUp.call(this,Ie)}.bind(this))},Se.prototype.handleMouseUp=function(Ie){this.selectingListItem=!1,this.component.value(Ie.original),this.clear(),this.draw()},Se.prototype.move=function(Ie){this.active=Ie,this.draw()},Se.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},Se.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},dt.exports=Se},{}],32:[function(it,dt,f){"use strict";var Se=it("xtend"),Ie=it("fuzzy"),Ue=it("./list"),se=function(me,ae,ge){return this.options=Se({minLength:2,limit:5,filter:!0},ge=ge||{}),this.el=me,this.data=ae||[],this.list=new Ue(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(_e){this.handleKeyUp(_e.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(_e){this.handleKeyDown(_e)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(_e){this.handlePaste(_e)}.bind(this)),this};se.prototype.handleKeyUp=function(me){40===me||38===me||27===me||13===me||9===me||this.handleInputChange(this.el.value)},se.prototype.handleKeyDown=function(me){switch(me.keyCode){case 13:case 9:me.preventDefault(),this.list.isEmpty()||(this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},se.prototype.handleBlur=function(){this.list.selectingListItem||this.list.hide()},se.prototype.handlePaste=function(me){if(me.clipboardData)this.handleInputChange(me.clipboardData.getData("Text"));else{var ae=this;setTimeout(function(){ae.handleInputChange(me.target.value)},100)}},se.prototype.handleInputChange=function(me){this.query=this.normalize(me),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(ae){for(var ge=0;ge<ae.length&&(this.list.add(ae[ge]),ge!==this.options.limit-1);ge++);this.list.draw()}.bind(this))},se.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},se.prototype.update=function(me){this.data=me,this.handleKeyUp()},se.prototype.clear=function(){this.data=[],this.list.clear()},se.prototype.normalize=function(me){return me.toLowerCase()},se.prototype.match=function(me,ae){return me.indexOf(ae)>-1},se.prototype.value=function(me){if(this.selected=me,this.el.value=this.getItemValue(me),document.createEvent){var ae=document.createEvent("HTMLEvents");ae.initEvent("change",!0,!1),this.el.dispatchEvent(ae)}else this.el.fireEvent("onchange")},se.prototype.getCandidates=function(me){var ae={pre:"<strong>",post:"</strong>",extract:function(_e){return this.getItemValue(_e)}.bind(this)};me(this.options.filter?Ie.filter(this.query,this.data,ae):this.data.map(function(_e){for(var ve=this.getItemValue(_e),Le=this.normalize(ve),yt=Le.lastIndexOf(this.query);yt>-1;){var wt=yt+this.query.length;ve=ve.slice(0,yt)+"<strong>"+ve.slice(yt,wt)+"</strong>"+ve.slice(wt),yt=Le.slice(0,yt).lastIndexOf(this.query)}return{original:_e,string:ve}}.bind(this)))},se.prototype.getItemValue=function(me){return me},dt.exports=se},{"./list":31,fuzzy:4,xtend:37}],33:[function(it,dt,f){(function(Se){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var me,Ue=function se(ge){return ge&&ge.__esModule?ge:{default:ge}}(it("./ponyfill.js"));me="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==Se?Se:void 0!==dt?dt:Function("return this")();var ae=(0,Ue.default)(me);f.default=ae}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ponyfill.js":34}],34:[function(it,dt,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.default=function Se(Ie){var Ue,se=Ie.Symbol;return"function"==typeof se?se.observable?Ue=se.observable:(Ue=se("observable"),se.observable=Ue):Ue="@@observable",Ue}},{}],35:[function(it,dt,f){var Se=it("turf-meta").coordEach;dt.exports=function(Ie){var Ue=[1/0,1/0,-1/0,-1/0];return Se(Ie,function(se){Ue[0]>se[0]&&(Ue[0]=se[0]),Ue[1]>se[1]&&(Ue[1]=se[1]),Ue[2]<se[0]&&(Ue[2]=se[0]),Ue[3]<se[1]&&(Ue[3]=se[1])}),Ue}},{"turf-meta":36}],36:[function(it,dt,f){function Se(me,ae,ge){var _e,ve,Le,yt,wt,rt,Ze,De,ct,Ge=0,gt="FeatureCollection"===me.type,Kt="Feature"===me.type,en=gt?me.features.length:1;for(_e=0;_e<en;_e++)for(rt=(ct="GeometryCollection"===(De=gt?me.features[_e].geometry:Kt?me.geometry:me).type)?De.geometries.length:1,yt=0;yt<rt;yt++)if(Ze=(wt=ct?De.geometries[yt]:De).coordinates,Ge=!ge||"Polygon"!==wt.type&&"MultiPolygon"!==wt.type?0:1,"Point"===wt.type)ae(Ze);else if("LineString"===wt.type||"MultiPoint"===wt.type)for(ve=0;ve<Ze.length;ve++)ae(Ze[ve]);else if("Polygon"===wt.type||"MultiLineString"===wt.type)for(ve=0;ve<Ze.length;ve++)for(Le=0;Le<Ze[ve].length-Ge;Le++)ae(Ze[ve][Le]);else{if("MultiPolygon"!==wt.type)throw new Error("Unknown Geometry Type");for(ve=0;ve<Ze.length;ve++)for(Le=0;Le<Ze[ve].length;Le++)for(l=0;l<Ze[ve][Le].length-Ge;l++)ae(Ze[ve][Le][l])}}function Ue(me,ae){var ge;switch(me.type){case"FeatureCollection":for(features=me.features,ge=0;ge<me.features.length;ge++)ae(me.features[ge].properties);break;case"Feature":ae(me.properties)}}dt.exports.coordEach=Se,dt.exports.coordReduce=function Ie(me,ae,ge,_e){return Se(me,function(ve){ge=ae(ge,ve)},_e),ge},dt.exports.propEach=Ue,dt.exports.propReduce=function se(me,ae,ge){return Ue(me,function(_e){ge=ae(ge,_e)}),ge}},{}],37:[function(it,dt,f){dt.exports=function Ie(){for(var Ue={},se=0;se<arguments.length;se++){var me=arguments[se];for(var ae in me)Se.call(me,ae)&&(Ue[ae]=me[ae])}return Ue};var Se=Object.prototype.hasOwnProperty},{}],38:[function(it,dt,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.queryOrigin=function ct(qe){return{type:Ie.ORIGIN_QUERY,query:qe}},f.queryDestination=function gt(qe){return{type:Ie.DESTINATION_QUERY,query:qe}},f.queryOriginCoordinates=Kt,f.queryDestinationCoordinates=en,f.clearOrigin=function rn(){return function(qe){qe({type:Ie.ORIGIN_CLEAR}),qe(kn("clear",{type:"origin"})),qe(Ge(null))}},f.clearDestination=function Wt(){return function(qe){qe({type:Ie.DESTINATION_CLEAR}),qe(kn("clear",{type:"destination"})),qe(Ge(null))}},f.setOptions=function St(qe){return{type:Ie.SET_OPTIONS,options:qe}},f.hoverMarker=function Tt(qe){return function(kt){kt(function wt(qe){return{type:Ie.HOVER_MARKER,hoverMarker:qe}}(qe?se.default.createPoint(qe,{id:"hover"}):{}))}},f.setRouteIndex=Nt,f.createOrigin=tt,f.createDestination=We,f.setProfile=function cn(qe){return function(kt,Gt){var wn=Gt(),ft=wn.origin,Sn=wn.destination;kt({type:Ie.DIRECTIONS_PROFILE,profile:qe}),kt(kn("profile",{profile:qe})),ft.geometry&&Sn.geometry&&kt(rt())}},f.reverse=function Cn(){return function(qe,kt){var Gt=kt();Gt.destination.geometry&&qe(_e(Gt.destination.geometry.coordinates)),Gt.origin.geometry&&qe(ve(Gt.origin.geometry.coordinates)),Gt.origin.geometry&&Gt.destination.geometry&&qe(rt());for(var wn=document.getElementsByClassName("suggestions"),ft=0;ft<wn.length;ft++)wn[ft].style.visibility="hidden"}},f.setOriginFromCoordinates=function Qt(qe){return function(kt){if(se.default.validCoords(qe)||(qe=[se.default.wrap(qe[0]),se.default.wrap(qe[1])]),isNaN(qe[0])&&isNaN(qe[1]))return kt(Ge(new Error("Coordinates are not valid")));kt(Kt(qe)),kt(tt(qe))}},f.setDestinationFromCoordinates=function On(qe){return function(kt){if(se.default.validCoords(qe)||(qe=[se.default.wrap(qe[0]),se.default.wrap(qe[1])]),isNaN(qe[0])&&isNaN(qe[1]))return kt(Ge(new Error("Coordinates are not valid")));kt(We(qe)),kt(en(qe))}},f.addWaypoint=function un(qe,kt){return function(Gt,wn){var ft=wn(),Sn=ft.destination,Ur=ft.waypoints;Ur.splice(qe,0,De(kt)),Gt(yt(Ur)),Sn.geometry&&Gt(rt())}},f.setWaypoint=function Vn(qe,kt){return function(Gt,wn){var ft=wn(),Sn=ft.destination,Ur=ft.waypoints;Ur[qe]=De(kt),Gt(yt(Ur)),Sn.geometry&&Gt(rt())}},f.removeWaypoint=function cr(qe){return function(kt,Gt){var wn=Gt(),ft=wn.destination,Sn=wn.waypoints;kt(yt(Sn=Sn.filter(function(Ur){return!se.default.coordinateMatch(Ur,qe)}))),ft.geometry&&kt(rt())}},f.eventSubscribe=function Ct(qe,kt){return function(Gt,wn){var Sn=wn().events;return Sn[qe]=Sn[qe]||[],Sn[qe].push(kt),{type:Ie.EVENTS,events:Sn}}},f.eventEmit=kn;var Ie=function ae(qe){if(qe&&qe.__esModule)return qe;var kt={};if(null!=qe)for(var Gt in qe)Object.prototype.hasOwnProperty.call(qe,Gt)&&(kt[Gt]=qe[Gt]);return kt.default=qe,kt}(it("../constants/action_types")),se=function me(qe){return qe&&qe.__esModule?qe:{default:qe}}(it("../utils"));var ge=new XMLHttpRequest;function _e(qe){return function(kt){var Gt=se.default.createPoint(qe,{id:"origin","marker-symbol":"A"});kt({type:Ie.ORIGIN,origin:Gt}),kt(kn("origin",{feature:Gt}))}}function ve(qe){return function(kt){var Gt=se.default.createPoint(qe,{id:"destination","marker-symbol":"B"});kt({type:Ie.DESTINATION,destination:Gt}),kt(kn("destination",{feature:Gt}))}}function Le(qe){return function(kt){kt({type:Ie.DIRECTIONS,directions:qe}),kt(kn("route",{route:qe}))}}function yt(qe){return{type:Ie.WAYPOINTS,waypoints:qe}}function rt(){return function(qe,kt){var Gt=kt(),wn=Gt.api,ft=Gt.accessToken,Sn=Gt.routeIndex,Ur=Gt.profile,or=Gt.alternatives,Xn=Gt.congestion,fn=Gt.destination,sr=Gt.language,Ln=Gt.exclude;if(fn&&fn.geometry){var Di=function Ze(qe){var kt=qe(),wn=kt.destination,ft=kt.waypoints,Sn=[];return Sn.push(kt.origin.geometry.coordinates.join(",")),Sn.push(";"),ft.length&&ft.forEach(function(Ur){Sn.push(Ur.geometry.coordinates.join(",")),Sn.push(";")}),Sn.push(wn.geometry.coordinates.join(",")),encodeURIComponent(Sn.join(""))}(kt),Vr=[];Vr.push("geometries=polyline"),or&&Vr.push("alternatives=true"),Xn&&Vr.push("annotations=congestion"),Vr.push("steps=true"),Vr.push("overview=full"),sr&&Vr.push("language="+sr),Ln&&Vr.push("exclude="+Ln),ft&&Vr.push("access_token="+ft),ge.abort(),ge.open("GET",""+wn+Ur+"/"+Di+".json?"+Vr.join("&"),!0),ge.onload=function(){if(!(ge.status>=200&&ge.status<400))return qe(Le([])),qe(Ge(JSON.parse(ge.responseText).message));var Ri=JSON.parse(ge.responseText);if(Ri.error)return qe(Le([])),qe(Ge(Ri.error));qe(Ge(null)),Ri.routes[Sn]||qe(Nt(0)),qe(Le(Ri.routes)),qe(_e(Ri.waypoints[0].location)),qe(ve(Ri.waypoints[Ri.waypoints.length-1].location))},ge.onerror=function(){return qe(Le([])),qe(Ge(JSON.parse(ge.responseText).message))},ge.send()}}}function De(qe){var kt={id:"waypoint"};return Object.assign(qe,{properties:qe.properties?Object.assign(qe.properties,kt):kt})}function Ge(qe){return function(kt){kt({type:"ERROR",error:qe}),qe&&kt(kn("error",{error:qe}))}}function Kt(qe){return{type:Ie.ORIGIN_FROM_COORDINATES,coordinates:qe}}function en(qe){return{type:Ie.DESTINATION_FROM_COORDINATES,coordinates:qe}}function Nt(qe){return{type:Ie.ROUTE_INDEX,routeIndex:qe}}function tt(qe){return function(kt,Gt){var ft=Gt().destination;kt(_e(qe)),ft.geometry&&kt(rt())}}function We(qe){return function(kt,Gt){var ft=Gt().origin;kt(ve(qe)),ft.geometry&&kt(rt())}}function kn(qe,kt){var Gt=this;return function(wn,ft){var Ur=ft().events;if(!Ur[qe])return{type:Ie.EVENTS,events:Ur};for(var or=Ur[qe].slice(),Xn=0;Xn<or.length;Xn++)or[Xn].call(Gt,kt)}}},{"../constants/action_types":39,"../utils":47}],39:[function(it,dt,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.DESTINATION="DESTINATION",f.DESTINATION_CLEAR="DESTINATION_CLEAR",f.DESTINATION_QUERY="DESTINATION_QUERY",f.DESTINATION_FROM_COORDINATES="DESTINATION_FROM_COORDINATES",f.DIRECTIONS="DIRECTIONS",f.DIRECTIONS_PROFILE="DIRECTIONS_PROFILE",f.EVENTS="EVENTS",f.ERROR="ERROR",f.HOVER_MARKER="HOVER_MARKER",f.ORIGIN="ORIGIN",f.ORIGIN_CLEAR="ORIGIN_CLEAR",f.ORIGIN_QUERY="ORIGIN_QUERY",f.ORIGIN_FROM_COORDINATES="ORIGIN_FROM_COORDINATES",f.ROUTE_INDEX="ROUTE_INDEX",f.SET_OPTIONS="SET_OPTIONS",f.WAYPOINTS="WAYPOINTS"},{}],40:[function(it,dt,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(rt){return typeof rt}:function(rt){return rt&&"function"==typeof Symbol&&rt.constructor===Symbol&&rt!==Symbol.prototype?"symbol":typeof rt},Ie=function(){function rt(Ze,De){for(var Ge=0;Ge<De.length;Ge++){var ct=De[Ge];ct.enumerable=ct.enumerable||!1,ct.configurable=!0,"value"in ct&&(ct.writable=!0),Object.defineProperty(Ze,ct.key,ct)}}return function(Ze,De,Ge){return De&&rt(Ze.prototype,De),Ge&&rt(Ze,Ge),Ze}}(),se=Le(it("suggestions")),ae=Le(it("lodash.debounce")),ge=it("events"),ve=Le(it("../utils"));function Le(rt){return rt&&rt.__esModule?rt:{default:rt}}var wt=function(){function rt(Ze){(function yt(rt,Ze){if(!(rt instanceof Ze))throw new TypeError("Cannot call a class as a function")})(this,rt),this._ev=new ge.EventEmitter,this.options=Ze,this.api=Ze&&Ze.api||"https://api.mapbox.com/geocoding/v5/mapbox.places/"}return Ie(rt,[{key:"onAdd",value:function(De){this._map=De,this.request=new XMLHttpRequest;var Ge=document.createElement("div");Ge.className="mapboxgl-ctrl-geocoder";var ct=document.createElement("span");ct.className="geocoder-icon geocoder-icon-search";var gt=this._inputEl=document.createElement("input");gt.type="text",gt.placeholder=this.options.placeholder,gt.addEventListener("keydown",(0,ae.default)(function(Wt){if(!Wt.target.value)return this._clearEl.classList.remove("active");Wt.metaKey||-1!==[9,27,37,39,13,38,40].indexOf(Wt.keyCode)||this._queryFromInput(Wt.target.value)}.bind(this)),200),gt.addEventListener("change",function(Wt){Wt.target.value&&this._clearEl.classList.add("active");var St=this._typeahead.selected;if(St){if(this.options.flyTo)if(St.bbox&&St.context&&St.context.length<=3||St.bbox&&!St.context){var Tt=St.bbox;De.fitBounds([[Tt[0],Tt[1]],[Tt[2],Tt[3]]])}else De.flyTo({center:St.center,zoom:this.options.zoom});this._input=St,this.fire("result",{result:St})}}.bind(this));var Kt=document.createElement("div");Kt.classList.add("geocoder-pin-right");var en=this._clearEl=document.createElement("button");en.className="geocoder-icon geocoder-icon-close",en.addEventListener("click",this._clear.bind(this));var rn=this._loadingEl=document.createElement("span");return rn.className="geocoder-icon geocoder-icon-loading",Kt.appendChild(en),Kt.appendChild(rn),Ge.appendChild(ct),Ge.appendChild(gt),Ge.appendChild(Kt),this.options.container&&(this.options.position=!1),this._typeahead=new se.default(gt,[],{filter:!1}),this._typeahead.getItemValue=function(Wt){return Wt.place_name},Ge}},{key:"_geocode",value:function(De,Ge){this._loadingEl.classList.add("active"),this.fire("loading");var ct=this.options,gt=["placeholder","zoom","flyTo","accessToken"],Kt=Object.keys(this.options).filter(function(rn){return-1===gt.indexOf(rn)}).map(function(rn){return rn+"="+ct[rn]}),en=this.options.accessToken?this.options.accessToken:mapboxgl.accessToken;Kt.push("access_token="+en),this.request.abort(),this.request.open("GET",this.api+encodeURIComponent(De.trim())+".json?"+Kt.join("&"),!0),this.request.onload=function(){if(this._loadingEl.classList.remove("active"),this.request.status>=200&&this.request.status<400){var rn=JSON.parse(this.request.responseText);return rn.features.length?this._clearEl.classList.add("active"):(this._clearEl.classList.remove("active"),this._typeahead.selected=null),this.fire("results",{results:rn.features}),this._typeahead.update(rn.features),Ge(rn.features)}this.fire("error",{error:JSON.parse(this.request.responseText).message})}.bind(this),this.request.onerror=function(){this._loadingEl.classList.remove("active"),this.fire("error",{error:JSON.parse(this.request.responseText).message})}.bind(this),this.request.send()}},{key:"_queryFromInput",value:function(De){(De=De.trim())||this._clear(),De.length>2&&this._geocode(De,function(Ge){this._results=Ge}.bind(this))}},{key:"_change",value:function(){var De=document.createEvent("HTMLEvents");De.initEvent("change",!0,!1),this._inputEl.dispatchEvent(De)}},{key:"_query",value:function(De){!De||("object"===(void 0===De?"undefined":Se(De))&&De.length&&(De=[ve.default.wrap(De[0]),ve.default.wrap(De[1])].join()),this._geocode(De,function(Ge){if(Ge.length){var ct=Ge[0];this._results=Ge,this._typeahead.selected=ct,this._inputEl.value=ct.place_name,this._change()}}.bind(this)))}},{key:"_setInput",value:function(De){!De||("object"===(void 0===De?"undefined":Se(De))&&De.length&&(De=[ve.default.roundWithOriginalPrecision(ve.default.wrap(De[0]),De[0]),ve.default.roundWithOriginalPrecision(ve.default.wrap(De[1]),De[1])].join()),this._inputEl.value=De,this._input=null,this._typeahead.selected=null,this._typeahead.clear(),this._change())}},{key:"_clear",value:function(){this._input=null,this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._change(),this._inputEl.focus(),this._clearEl.classList.remove("active"),this.fire("clear")}},{key:"getResult",value:function(){return this._input}},{key:"query",value:function(De){return this._query(De),this}},{key:"setInput",value:function(De){return this._setInput(De),this}},{key:"on",value:function(De,Ge){return this._ev.on(De,Ge),this._ev.on("error",function(ct){console.log(ct)}),this}},{key:"fire",value:function(De,Ge){return this._ev.emit(De,Ge),this}},{key:"off",value:function(De,Ge){return this._ev.removeListener(De,Ge),this}}]),rt}();f.default=wt},{"../utils":47,events:3,"lodash.debounce":7,suggestions:30}],41:[function(it,dt,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var Se=function(){function Ze(De,Ge){for(var ct=0;ct<Ge.length;ct++){var gt=Ge[ct];gt.enumerable=gt.enumerable||!1,gt.configurable=!0,"value"in gt&&(gt.writable=!0),Object.defineProperty(De,gt.key,gt)}}return function(De,Ge,ct){return Ge&&Ze(De.prototype,Ge),ct&&Ze(De,ct),De}}(),Ue=Le(it("./geocoder")),me=Le(it("lodash.template")),ge=Le(it("lodash.isequal")),ve=Le(it("turf-extent"));function Le(Ze){return Ze&&Ze.__esModule?Ze:{default:Ze}}var wt=(0,me.default)("<div class='mapbox-directions-component mapbox-directions-inputs'>\n  <div class='mapbox-directions-component-keyline'>\n    <div class='mapbox-directions-origin'>\n      <label class='mapbox-form-label'>\n        <span class='directions-icon directions-icon-depart'></span>\n      </label>\n      <div id='mapbox-directions-origin-input'></div>\n    </div>\n\n    <button\n      class='directions-icon directions-icon-reverse directions-reverse js-reverse-inputs'\n      title='Reverse origin &amp; destination'>\n    </button>\n\n    <div class='mapbox-directions-destination'>\n      <label class='mapbox-form-label'>\n        <span class='directions-icon directions-icon-arrive'></span>\n      </label>\n      <div id='mapbox-directions-destination-input'></div>\n    </div>\n  </div>\n\n  <% if (controls.profileSwitcher) { %>\n  <div class='mapbox-directions-profile mapbox-directions-component-keyline mapbox-directions-clearfix'><input\n      id='mapbox-directions-profile-driving-traffic'\n      type='radio'\n      name='profile'\n      value='mapbox/driving-traffic'\n      <% if (profile === 'mapbox/driving-traffic') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-driving-traffic'>Traffic</label>\n    <input\n      id='mapbox-directions-profile-driving'\n      type='radio'\n      name='profile'\n      value='mapbox/driving'\n      <% if (profile === 'mapbox/driving') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-driving'>Driving</label>\n    <input\n      id='mapbox-directions-profile-walking'\n      type='radio'\n      name='profile'\n      value='mapbox/walking'\n      <% if (profile === 'mapbox/walking') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-walking'>Walking</label>\n    <input\n      id='mapbox-directions-profile-cycling'\n      type='radio'\n      name='profile'\n      value='mapbox/cycling'\n      <% if (profile === 'mapbox/cycling') { %>checked<% } %>\n    />\n    <label for='mapbox-directions-profile-cycling'>Cycling</label>\n  </div>\n  <% } %>\n</div>\n"),rt=function(){function Ze(De,Ge,ct,gt){!function yt(Ze,De){if(!(Ze instanceof De))throw new TypeError("Cannot call a class as a function")}(this,Ze);var Kt=Ge.getState();De.innerHTML=wt({originQuery:Kt.originQuery,destinationQuery:Kt.destinationQuery,profile:Kt.profile,controls:Kt.controls}),this.container=De,this.actions=ct,this.store=Ge,this._map=gt,this.onAdd(),this.render()}return Se(Ze,[{key:"animateToCoordinates",value:function(Ge,ct){var gt=this.store.getState(),Kt=gt.origin,en=gt.destination,rn=gt.routePadding;if(Kt.geometry&&en.geometry&&!(0,ge.default)(Kt.geometry,en.geometry)){var Wt=(0,ve.default)({type:"FeatureCollection",features:[Kt,en]});this._map.fitBounds([[Wt[0],Wt[1]],[Wt[2],Wt[3]]],{padding:rn})}else this._map.flyTo({center:ct})}},{key:"onAdd",value:function(){var Ge=this,ct=this.actions,gt=ct.clearOrigin,Kt=ct.clearDestination,en=ct.createOrigin,rn=ct.createDestination,Wt=ct.setProfile,St=ct.reverse,Tt=this.store.getState(),Nt=Tt.geocoder,tt=Tt.accessToken,We=Tt.flyTo,Cn=Tt.placeholderDestination,Qt=Tt.zoom;this.originInput=new Ue.default(Object.assign({},{accessToken:tt},Nt,{flyTo:We,placeholder:Tt.placeholderOrigin,zoom:Qt}));var On=this.originInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-origin-input").appendChild(On),this.destinationInput=new Ue.default(Object.assign({},{accessToken:tt},Nt,{flyTo:We,placeholder:Cn,zoom:Qt}));var Vn=this.destinationInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-destination-input").appendChild(Vn),this.originInput.on("result",function(Ct){var kn=Ct.result.center;en(kn),Ge.animateToCoordinates("origin",kn)}),this.originInput.on("clear",gt),this.destinationInput.on("result",function(Ct){var kn=Ct.result.center;rn(kn),Ge.animateToCoordinates("destination",kn)}),this.destinationInput.on("clear",Kt);var cr=this.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(cr,function(Ct){Ct.addEventListener("change",function(){Wt(Ct.value)})}),this.container.querySelector(".js-reverse-inputs").addEventListener("click",function(){var Ct=Ge.store.getState(),kn=Ct.origin,qe=Ct.destination;kn&&Ge.actions.queryDestination(kn.geometry.coordinates),qe&&Ge.actions.queryOrigin(qe.geometry.coordinates),St()})}},{key:"render",value:function(){var Ge=this;this.store.subscribe(function(){var ct=Ge.store.getState(),gt=ct.originQuery,Kt=ct.destinationQuery,en=ct.originQueryCoordinates,rn=ct.destinationQueryCoordinates;gt&&(Ge.originInput.query(gt),Ge.actions.queryOrigin(null)),Kt&&(Ge.destinationInput.query(Kt),Ge.actions.queryDestination(null)),en&&(Ge.originInput.setInput(en),Ge.animateToCoordinates("origin",en),Ge.actions.queryOriginCoordinates(null)),rn&&(Ge.destinationInput.setInput(rn),Ge.animateToCoordinates("destination",rn),Ge.actions.queryDestinationCoordinates(null))})}}]),Ze}();f.default=rt},{"./geocoder":40,"lodash.isequal":8,"lodash.template":9,"turf-extent":35}],42:[function(it,dt,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var Se=function(){function rt(Ze,De){for(var Ge=0;Ge<De.length;Ge++){var ct=De[Ge];ct.enumerable=ct.enumerable||!1,ct.configurable=!0,"value"in ct&&(ct.writable=!0),Object.defineProperty(Ze,ct.key,ct)}}return function(Ze,De,Ge){return De&&rt(Ze.prototype,De),Ge&&rt(Ze,Ge),Ze}}(),Ue=_e(it("../utils")),me=_e(it("lodash.template")),ge=_e(it("lodash.isequal"));function _e(rt){return rt&&rt.__esModule?rt:{default:rt}}var Le=(0,me.default)("<div class='directions-control directions-control-directions'>\n  <div class='mapbox-directions-component mapbox-directions-route-summary<% if (routes > 1) { %> mapbox-directions-multiple<% } %>'>\n    <% if (routes > 1) { %>\n    <div class='mapbox-directions-routes mapbox-directions-clearfix'>\n      <% for (var i = 0; i < routes; i++) { %>\n        <input type='radio' name='routes' id='<%= i %>' <% if (i === routeIndex) { %>checked<% } %>>\n        <label for='<%= i %>' class='mapbox-directions-route'><%= i + 1 %></label>\n      <% } %>\n    </div>\n    <% } %>\n    <h1><%- duration %></h1>\n    <span><%- distance %></span>\n  </div>\n\n  <div class='mapbox-directions-instructions'>\n    <div class='mapbox-directions-instructions-wrapper'>\n      <ol class='mapbox-directions-steps'>\n        <% steps.forEach(function(step) { %>\n          <%\n            var distance = step.distance ? format(step.distance) : false;\n            var icon = step.maneuver.modifier ? step.maneuver.modifier.replace(/\\s+/g, '-').toLowerCase() : step.maneuver.type.replace(/\\s+/g, '-').toLowerCase();\n\n            if (step.maneuver.type === 'arrive' || step.maneuver.type === 'depart') {\n              icon = step.maneuver.type;\n            }\n\n            if (step.maneuver.type === 'roundabout' || step.maneuver.type === 'rotary') {\n              icon= 'roundabout';\n            }\n\n            var lng = step.maneuver.location[0];\n            var lat = step.maneuver.location[1];\n          %>\n          <li\n            data-lat='<%= lat %>'\n            data-lng='<%= lng %>'\n            class='mapbox-directions-step'>\n            <span class='directions-icon directions-icon-<%= icon %>'></span>\n            <div class='mapbox-directions-step-maneuver'>\n              <%= step.maneuver.instruction %>\n            </div>\n            <% if (distance) { %>\n              <div class='mapbox-directions-step-distance'>\n                <%= distance %>\n              </div>\n            <% } %>\n          </li>\n        <% }); %>\n      </ol>\n    </div>\n  </div>\n</div>\n"),yt=(0,me.default)("<div class='directions-control directions-control-directions'>\n  <div class='mapbox-directions-error'>\n    <%= error %>\n  </div>\n</div>\n"),wt=function(){function rt(Ze,De,Ge,ct){(function ve(rt,Ze){if(!(rt instanceof Ze))throw new TypeError("Cannot call a class as a function")})(this,rt),this.container=Ze,this.actions=Ge,this.store=De,this._map=ct,this.directions={},this.render()}return Se(rt,[{key:"render",value:function(){var De=this;this.store.subscribe(function(){var Ge=De.actions,ct=Ge.hoverMarker,gt=Ge.setRouteIndex,Kt=De.store.getState(),en=Kt.routeIndex,rn=Kt.unit,Wt=Kt.directions,St=Kt.error,Tt=Kt.compile,Nt=!(0,ge.default)(Wt[en],De.directions);if(St)De.container.innerHTML=yt({error:St});else if(Wt.length&&Nt){var tt=De.directions=Wt[en];Tt&&tt.legs.forEach(function(Cn){Cn.steps.forEach(function(Qt){Qt.maneuver.instruction=Tt("en",Qt)})}),De.container.innerHTML=Le({routeIndex:en,routes:Wt.length,steps:tt.legs[0].steps,format:Ue.default.format[rn],duration:Ue.default.format[rn](tt.distance),distance:Ue.default.format.duration(tt.duration)});var We=De.container.querySelectorAll(".mapbox-directions-step");Array.prototype.forEach.call(We,function(Cn){var Qt=Cn.getAttribute("data-lng"),On=Cn.getAttribute("data-lat");Cn.addEventListener("mouseover",function(){ct([Qt,On])}),Cn.addEventListener("mouseout",function(){ct(null)}),Cn.addEventListener("click",function(){De._map.flyTo({center:[Qt,On],zoom:16})})});var cn=De.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(cn,function(Cn){Cn.addEventListener("change",function(Qt){gt(parseInt(Qt.target.id,10))})})}else De.container.innerHTML&&Nt&&(De.container.innerHTML="")})}}]),rt}();f.default=wt},{"../utils":47,"lodash.isequal":8,"lodash.template":9}],43:[function(it,dt,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var Se=function(){function Tt(Nt,tt){for(var We=0;We<tt.length;We++){var cn=tt[We];cn.enumerable=cn.enumerable||!1,cn.configurable=!0,"value"in cn&&(cn.writable=!0),Object.defineProperty(Nt,cn.key,cn)}}return function(Nt,tt,We){return tt&&Tt(Nt.prototype,tt),We&&Tt(Nt,We),Nt}}(),Ie=it("redux"),se=Kt(it("redux-thunk")),me=it("@mapbox/polyline"),ge=Kt(it("./utils")),ve=Kt(it("./reducers")),yt=function gt(Tt){if(Tt&&Tt.__esModule)return Tt;var Nt={};if(null!=Tt)for(var tt in Tt)Object.prototype.hasOwnProperty.call(Tt,tt)&&(Nt[tt]=Tt[tt]);return Nt.default=Tt,Nt}(it("./actions")),rt=Kt(it("./directions_style")),De=Kt(it("./controls/inputs")),ct=Kt(it("./controls/instructions"));function Kt(Tt){return Tt&&Tt.__esModule?Tt:{default:Tt}}var Wt=(0,Ie.applyMiddleware)(se.default)(Ie.createStore)(ve.default),St=function(){function Tt(Nt){(function en(Tt,Nt){if(!(Tt instanceof Nt))throw new TypeError("Cannot call a class as a function")})(this,Tt),this.actions=(0,Ie.bindActionCreators)(yt,Wt.dispatch),this.actions.setOptions(Nt||{}),this.options=Nt||{},this.onDragDown=this._onDragDown.bind(this),this.onDragMove=this._onDragMove.bind(this),this.onDragUp=this._onDragUp.bind(this),this.move=this._move.bind(this),this.onClick=this._clickHandler().bind(this)}return Se(Tt,[{key:"onAdd",value:function(tt){var We=this;this._map=tt;var Cn=Wt.getState().controls,Qt=this.container=document.createElement("div");Qt.className="mapboxgl-ctrl-directions mapboxgl-ctrl";var On=document.createElement("div");On.className="directions-control directions-control-inputs",new De.default(On,Wt,this.actions,this._map);var un=document.createElement("div");return un.className="directions-control directions-control-instructions",new ct.default(un,Wt,{hoverMarker:this.actions.hoverMarker,setRouteIndex:this.actions.setRouteIndex},this._map),Cn.inputs&&Qt.appendChild(On),Cn.instructions&&Qt.appendChild(un),this.subscribedActions(),this._map.loaded()?this.mapState():this._map.on("load",function(){return We.mapState()}),Qt}},{key:"onRemove",value:function(tt){return this.container.parentNode.removeChild(this.container),this.removeRoutes(),tt.off("mousedown",this.onDragDown),tt.off("mousemove",this.move),tt.off("touchstart",this.onDragDown),tt.off("touchstart",this.move),tt.off("click",this.onClick),this.storeUnsubscribe&&(this.storeUnsubscribe(),delete this.storeUnsubscribe),rt.default.forEach(function(We){tt.getLayer(We.id)&&tt.removeLayer(We.id)}),tt.getSource("directions")&&tt.removeSource("directions"),this._map=null,this}},{key:"mapState",value:function(){var tt=this,We=Wt.getState(),On=We.styles,un=We.interactive;this.actions.eventEmit("profile",{profile:We.profile}),this._map.addSource("directions",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),On&&On.length&&On.forEach(function(Ct){return tt._map.addLayer(Ct)}),rt.default.forEach(function(Ct){tt._map.getLayer(Ct.id)||tt._map.addLayer(Ct)}),un&&(this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick),this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown))}},{key:"subscribedActions",value:function(){var tt=this;this.storeUnsubscribe=Wt.subscribe(function(){var We=Wt.getState(),On=We.directions,un=We.routeIndex,Vn={type:"FeatureCollection",features:[We.origin,We.destination,We.hoverMarker].filter(function(cr){return cr.geometry})};On.length&&On.forEach(function(cr,Ct){var kn=[];(0,me.decode)(cr.geometry,5).map(function(kt){return kt.reverse()}).forEach(function(kt,Gt){var wn=kn[kn.length-1],ft=cr.legs[0].annotation&&cr.legs[0].annotation.congestion&&cr.legs[0].annotation.congestion[Gt-1];if(!wn||ft&&wn.properties.congestion!==ft){var Sn={geometry:{type:"LineString",coordinates:[]},properties:{"route-index":Ct,route:Ct===un?"selected":"alternate"}};wn&&Sn.geometry.coordinates.push(wn.geometry.coordinates[wn.geometry.coordinates.length-1]),Sn.geometry.coordinates.push(kt),ft&&(Sn.properties.congestion=cr.legs[0].annotation.congestion[Gt-1]),kn.push(Sn)}else wn.geometry.coordinates.push(kt)}),Vn.features=Vn.features.concat(kn),Ct===un&&cr.legs[0].steps.forEach(function(kt){"waypoint"===kt.maneuver.type&&Vn.features.push({type:"Feature",geometry:kt.maneuver.location,properties:{id:"waypoint"}})})}),tt._map.style&&tt._map.getSource("directions")&&tt._map.getSource("directions").setData(Vn)})}},{key:"_clickHandler",value:function(){var tt=null;return function(cn){if(tt)clearTimeout(tt),tt=null,this._map.zoomIn();else{var Cn=this._onSingleClick.bind(this);tt=setTimeout(function(){Cn(cn),tt=null},250)}}}},{key:"_onSingleClick",value:function(tt){var We=this,cn=Wt.getState(),Qt=[tt.lngLat.lng,tt.lngLat.lat];if(cn.origin.geometry){var On=this._map.queryRenderedFeatures(tt.point,{layers:["directions-origin-point","directions-destination-point","directions-waypoint-point","directions-route-line-alt"]});On.length?(On.forEach(function(Vn){"directions-waypoint-point"===Vn.layer.id&&We.actions.removeWaypoint(Vn)}),"alternate"===On[0].properties.route&&this.actions.setRouteIndex(On[0].properties["route-index"])):(this.actions.setDestinationFromCoordinates(Qt),this._map.flyTo({center:Qt}))}else this.actions.setOriginFromCoordinates(Qt)}},{key:"_move",value:function(tt){var We=this,Cn=Wt.getState().hoverMarker,Qt=this._map.queryRenderedFeatures(tt.point,{layers:["directions-route-line-alt","directions-route-line","directions-origin-point","directions-destination-point","directions-hover-point"]});this._map.getCanvas().style.cursor=Qt.length?"pointer":"",Qt.length?(this.isCursorOverPoint=Qt[0],this._map.dragPan.disable(),Qt.forEach(function(On){"directions-route-line"===On.layer.id?We.actions.hoverMarker([tt.lngLat.lng,tt.lngLat.lat]):Cn.geometry&&We.actions.hoverMarker(null)})):this.isCursorOverPoint&&(this.isCursorOverPoint=!1,this._map.dragPan.enable())}},{key:"_onDragDown",value:function(){!this.isCursorOverPoint||(this.isDragging=this.isCursorOverPoint,this._map.getCanvas().style.cursor="grab",this._map.on("mousemove",this.onDragMove),this._map.on("mouseup",this.onDragUp),this._map.on("touchmove",this.onDragMove),this._map.on("touchend",this.onDragUp))}},{key:"_onDragMove",value:function(tt){if(this.isDragging){var We=[tt.lngLat.lng,tt.lngLat.lat];switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.createOrigin(We);break;case"directions-destination-point":this.actions.createDestination(We);break;case"directions-hover-point":this.actions.hoverMarker(We)}}}},{key:"_onDragUp",value:function(){if(this.isDragging){var tt=Wt.getState(),We=tt.hoverMarker,cn=tt.origin,Cn=tt.destination;switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.setOriginFromCoordinates(cn.geometry.coordinates);break;case"directions-destination-point":this.actions.setDestinationFromCoordinates(Cn.geometry.coordinates);break;case"directions-hover-point":We.geometry&&!ge.default.coordinateMatch(this.isDragging,We)&&this.actions.addWaypoint(0,We)}this.isDragging=!1,this._map.getCanvas().style.cursor="",this._map.off("touchmove",this.onDragMove),this._map.off("touchend",this.onDragUp),this._map.off("mousemove",this.onDragMove),this._map.off("mouseup",this.onDragUp)}}},{key:"interactive",value:function(tt){return tt?(this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown),this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick)):(this._map.off("touchstart",this.move),this._map.off("touchstart",this.onDragDown),this._map.off("mousedown",this.onDragDown),this._map.off("mousemove",this.move),this._map.off("click",this.onClick)),this}},{key:"getOrigin",value:function(){return Wt.getState().origin}},{key:"setOrigin",value:function(tt){return"string"==typeof tt?this.actions.queryOrigin(tt):this.actions.setOriginFromCoordinates(tt),this}},{key:"getDestination",value:function(){return Wt.getState().destination}},{key:"setDestination",value:function(tt){return"string"==typeof tt?this.actions.queryDestination(tt):this.actions.setDestinationFromCoordinates(tt),this}},{key:"reverse",value:function(){return this.actions.reverse(),this}},{key:"addWaypoint",value:function(tt,We){return We.type||(We=ge.default.createPoint(We,{id:"waypoint"})),this.actions.addWaypoint(tt,We),this}},{key:"setWaypoint",value:function(tt,We){return We.type||(We=ge.default.createPoint(We,{id:"waypoint"})),this.actions.setWaypoint(tt,We),this}},{key:"removeWaypoint",value:function(tt){var We=Wt.getState();return this.actions.removeWaypoint(We.waypoints[tt]),this}},{key:"getWaypoints",value:function(){return Wt.getState().waypoints}},{key:"removeRoutes",value:function(){return this.actions.clearOrigin(),this.actions.clearDestination(),this}},{key:"on",value:function(tt,We){return this.actions.eventSubscribe(tt,We),this}}]),Tt}();f.default=St},{"./actions":38,"./controls/inputs":41,"./controls/instructions":42,"./directions_style":44,"./reducers":46,"./utils":47,"@mapbox/polyline":1,redux:28,"redux-thunk":22}],44:[function(it,dt,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.default=[{id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#bbb","line-width":4},filter:["all",["in","$type","LineString"],["in","route","alternate"]]},{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":12},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":{property:"congestion",type:"categorical",default:"#4882c5",stops:[["unknown","#4882c5"],["low","#4882c5"],["moderate","#f09a46"],["heavy","#e34341"],["severe","#8b2342"]]},"line-width":7},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-hover-point-casing",type:"circle",source:"directions",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-hover-point",type:"circle",source:"directions",paint:{"circle-radius":6,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-waypoint-point-casing",type:"circle",source:"directions",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-waypoint-point",type:"circle",source:"directions",paint:{"circle-radius":6,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-origin-point",type:"circle",source:"directions",paint:{"circle-radius":18,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-origin-label",type:"symbol",source:"directions",layout:{"text-field":"A","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions",paint:{"circle-radius":18,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]},{id:"directions-destination-label",type:"symbol",source:"directions",layout:{"text-field":"B","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}]},{}],45:[function(it,dt,f){"use strict";var Ie=function Ue(se){return se&&se.__esModule?se:{default:se}}(it("./directions"));dt.exports=Ie.default},{"./directions":43}],46:[function(it,dt,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var Ie=function ae(ve){if(ve&&ve.__esModule)return ve;var Le={};if(null!=ve)for(var yt in ve)Object.prototype.hasOwnProperty.call(ve,yt)&&(Le[yt]=ve[yt]);return Le.default=ve,Le}(it("../constants/action_types.js")),se=function me(ve){return ve&&ve.__esModule?ve:{default:ve}}(it("deep-assign"));var ge={api:"https://api.mapbox.com/directions/v5/",profile:"mapbox/driving-traffic",alternatives:!1,congestion:!1,unit:"imperial",flyTo:!0,placeholderOrigin:"Choose a starting place",placeholderDestination:"Choose destination",zoom:16,language:"en",compile:null,proximity:!1,styles:[],controls:{profileSwitcher:!0,inputs:!0,instructions:!0},geocoder:{},interactive:!0,events:{},origin:{},destination:{},hoverMarker:{},waypoints:[],originQuery:null,destinationQuery:null,originQueryCoordinates:null,destinationQueryCoordinates:null,directions:[],routeIndex:0,routePadding:80};f.default=function _e(){var ve=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge,Le=arguments[1];switch(Le.type){case Ie.SET_OPTIONS:return(0,se.default)({},ve,Le.options);case Ie.DIRECTIONS_PROFILE:return Object.assign({},ve,{profile:Le.profile});case Ie.ORIGIN:return Object.assign({},ve,{origin:Le.origin,hoverMarker:{}});case Ie.DESTINATION:return Object.assign({},ve,{destination:Le.destination,hoverMarker:{}});case Ie.HOVER_MARKER:return Object.assign({},ve,{hoverMarker:Le.hoverMarker});case Ie.WAYPOINTS:return Object.assign({},ve,{waypoints:Le.waypoints});case Ie.ORIGIN_QUERY:return Object.assign({},ve,{originQuery:Le.query});case Ie.DESTINATION_QUERY:return Object.assign({},ve,{destinationQuery:Le.query});case Ie.ORIGIN_FROM_COORDINATES:return Object.assign({},ve,{originQueryCoordinates:Le.coordinates});case Ie.DESTINATION_FROM_COORDINATES:return Object.assign({},ve,{destinationQueryCoordinates:Le.coordinates});case Ie.ORIGIN_CLEAR:return Object.assign({},ve,{origin:{},originQuery:"",waypoints:[],directions:[]});case Ie.DESTINATION_CLEAR:return Object.assign({},ve,{destination:{},destinationQuery:"",waypoints:[],directions:[]});case Ie.DIRECTIONS:return Object.assign({},ve,{directions:Le.directions});case Ie.ROUTE_INDEX:return Object.assign({},ve,{routeIndex:Le.routeIndex});case Ie.ERROR:return Object.assign({},ve,{error:Le.error});default:return ve}}},{"../constants/action_types.js":39,"deep-assign":2}],47:[function(it,dt,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.default={format:{duration:function(_e){var ve=Math.floor(_e/60),Le=Math.floor(ve/60);return _e%=60,ve%=60,0===Le&&0===ve?_e+"s":0===Le?ve+"min":Le+"h "+ve+"min"},imperial:function(_e){var ve=_e/1609.344;return ve>=100?ve.toFixed(0)+"mi":ve>=10?ve.toFixed(1)+"mi":ve>=.1?ve.toFixed(2)+"mi":(5280*ve).toFixed(0)+"ft"},metric:function(_e){return _e>=1e5?(_e/1e3).toFixed(0)+"km":_e>=1e4?(_e/1e3).toFixed(1)+"km":_e>=100?(_e/1e3).toFixed(2)+"km":_e.toFixed(0)+"m"}},coordinateMatch:function Ie(ge,_e){return _e=_e.geometry.coordinates,(ge=ge.geometry.coordinates).join()===_e.join()||ge[0].toFixed(3)===_e[0].toFixed(3)&&ge[1].toFixed(3)===_e[1].toFixed(3)},createPoint:function me(ge,_e){return{type:"Feature",geometry:{type:"Point",coordinates:ge},properties:_e||{}}},validCoords:function Se(ge){return ge[0]>=-180&&ge[0]<=180&&ge[1]>=-90&&ge[1]<=90},wrap:function Ue(ge){var ve=((ge- -180)%360+360)%360-180;return-180===ve?180:ve},roundWithOriginalPrecision:function se(ge,_e){var ve=0;return Math.floor(_e)!==_e&&(ve=_e.toString().split(".")[1].length),ge.toFixed(Math.min(ve,5))}}},{}]},{},[45])(45)},167:(Xl,Fa,fa)=>{"use strict";function pa(t){return"function"==typeof t}let it=!1;const dt={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else it&&console.log("RxJS: Back to a better error behavior. Thank you. <3");it=t},get useDeprecatedSynchronousErrorHandling(){return it}};function f(t){setTimeout(()=>{throw t},0)}const Se={closed:!0,next(t){},error(t){if(dt.useDeprecatedSynchronousErrorHandling)throw t;f(t)},complete(){}},Ie=Array.isArray||(t=>t&&"number"==typeof t.length);function Ue(t){return null!==t&&"object"==typeof t}const me=(()=>{function t(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((n,a)=>`${a+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return t.prototype=Object.create(Error.prototype),t})();class ae{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:a,_unsubscribe:u,_subscriptions:m}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof ae)n.remove(this);else if(null!==n)for(let v=0;v<n.length;++v)n[v].remove(this);if(pa(u)){a&&(this._unsubscribe=void 0);try{u.call(this)}catch(v){e=v instanceof me?ge(v.errors):[v]}}if(Ie(m)){let v=-1,T=m.length;for(;++v<T;){const I=m[v];if(Ue(I))try{I.unsubscribe()}catch(O){e=e||[],O instanceof me?e=e.concat(ge(O.errors)):e.push(O)}}}if(e)throw new me(e)}add(e){let n=e;if(!e)return ae.EMPTY;switch(typeof e){case"function":n=new ae(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof ae)){const m=n;n=new ae,n._subscriptions=[m]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:a}=n;if(null===a)n._parentOrParents=this;else if(a instanceof ae){if(a===this)return n;n._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return n;a.push(this)}const u=this._subscriptions;return null===u?this._subscriptions=[n]:u.push(n),n}remove(e){const n=this._subscriptions;if(n){const a=n.indexOf(e);-1!==a&&n.splice(a,1)}}}var t;function ge(t){return t.reduce((e,n)=>e.concat(n instanceof me?n.errors:n),[])}ae.EMPTY=((t=new ae).closed=!0,t);const _e="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class Le extends ae{constructor(e,n,a){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=Se;break;case 1:if(!e){this.destination=Se;break}if("object"==typeof e){e instanceof Le?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new yt(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new yt(this,e,n,a)}}[_e](){return this}static create(e,n,a){const u=new Le(e,n,a);return u.syncErrorThrowable=!1,u}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class yt extends Le{constructor(e,n,a,u){super(),this._parentSubscriber=e;let m,v=this;pa(n)?m=n:n&&(m=n.next,a=n.error,u=n.complete,n!==Se&&(v=Object.create(n),pa(v.unsubscribe)&&this.add(v.unsubscribe.bind(v)),v.unsubscribe=this.unsubscribe.bind(this))),this._context=v,this._next=m,this._error=a,this._complete=u}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:n}=this;dt.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?this.__tryOrSetError(n,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:n}=this,{useDeprecatedSynchronousErrorHandling:a}=dt;if(this._error)a&&n.syncErrorThrowable?(this.__tryOrSetError(n,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(n.syncErrorThrowable)a?(n.syncErrorValue=e,n.syncErrorThrown=!0):f(e),this.unsubscribe();else{if(this.unsubscribe(),a)throw e;f(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const n=()=>this._complete.call(this._context);dt.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,n){try{e.call(this._context,n)}catch(a){if(this.unsubscribe(),dt.useDeprecatedSynchronousErrorHandling)throw a;f(a)}}__tryOrSetError(e,n,a){if(!dt.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,a)}catch(u){return dt.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=u,e.syncErrorThrown=!0,!0):(f(u),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const Ze="function"==typeof Symbol&&Symbol.observable||"@@observable";function De(t){return t}let gt=(()=>{class t{constructor(n){this._isScalar=!1,n&&(this._subscribe=n)}lift(n){const a=new t;return a.source=this,a.operator=n,a}subscribe(n,a,u){const{operator:m}=this,v=function rt(t,e,n){if(t){if(t instanceof Le)return t;if(t[_e])return t[_e]()}return t||e||n?new Le(t,e,n):new Le(Se)}(n,a,u);if(v.add(m?m.call(v,this.source):this.source||dt.useDeprecatedSynchronousErrorHandling&&!v.syncErrorThrowable?this._subscribe(v):this._trySubscribe(v)),dt.useDeprecatedSynchronousErrorHandling&&v.syncErrorThrowable&&(v.syncErrorThrowable=!1,v.syncErrorThrown))throw v.syncErrorValue;return v}_trySubscribe(n){try{return this._subscribe(n)}catch(a){dt.useDeprecatedSynchronousErrorHandling&&(n.syncErrorThrown=!0,n.syncErrorValue=a),function wt(t){for(;t;){const{closed:e,destination:n,isStopped:a}=t;if(e||a)return!1;t=n&&n instanceof Le?n:null}return!0}(n)?n.error(a):console.warn(a)}}forEach(n,a){return new(a=Kt(a))((u,m)=>{let v;v=this.subscribe(T=>{try{n(T)}catch(I){m(I),v&&v.unsubscribe()}},m,u)})}_subscribe(n){const{source:a}=this;return a&&a.subscribe(n)}[Ze](){return this}pipe(...n){return 0===n.length?this:function ct(t){return 0===t.length?De:1===t.length?t[0]:function(n){return t.reduce((a,u)=>u(a),n)}}(n)(this)}toPromise(n){return new(n=Kt(n))((a,u)=>{let m;this.subscribe(v=>m=v,v=>u(v),()=>a(m))})}}return t.create=e=>new t(e),t})();function Kt(t){if(t||(t=dt.Promise||Promise),!t)throw new Error("no Promise impl found");return t}const rn=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})();class Wt extends ae{constructor(e,n){super(),this.subject=e,this.subscriber=n,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,n=e.observers;if(this.subject=null,!n||0===n.length||e.isStopped||e.closed)return;const a=n.indexOf(this.subscriber);-1!==a&&n.splice(a,1)}}class St extends Le{constructor(e){super(e),this.destination=e}}let Tt=(()=>{class t extends gt{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[_e](){return new St(this)}lift(n){const a=new Nt(this,this);return a.operator=n,a}next(n){if(this.closed)throw new rn;if(!this.isStopped){const{observers:a}=this,u=a.length,m=a.slice();for(let v=0;v<u;v++)m[v].next(n)}}error(n){if(this.closed)throw new rn;this.hasError=!0,this.thrownError=n,this.isStopped=!0;const{observers:a}=this,u=a.length,m=a.slice();for(let v=0;v<u;v++)m[v].error(n);this.observers.length=0}complete(){if(this.closed)throw new rn;this.isStopped=!0;const{observers:n}=this,a=n.length,u=n.slice();for(let m=0;m<a;m++)u[m].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(n){if(this.closed)throw new rn;return super._trySubscribe(n)}_subscribe(n){if(this.closed)throw new rn;return this.hasError?(n.error(this.thrownError),ae.EMPTY):this.isStopped?(n.complete(),ae.EMPTY):(this.observers.push(n),new Wt(this,n))}asObservable(){const n=new gt;return n.source=this,n}}return t.create=(e,n)=>new Nt(e,n),t})();class Nt extends Tt{constructor(e,n){super(),this.destination=e,this.source=n}next(e){const{destination:n}=this;n&&n.next&&n.next(e)}error(e){const{destination:n}=this;n&&n.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:n}=this;return n?this.source.subscribe(e):ae.EMPTY}}function tt(t){return t&&"function"==typeof t.schedule}function We(t,e){return function(a){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return a.lift(new cn(t,e))}}class cn{constructor(e,n){this.project=e,this.thisArg=n}call(e,n){return n.subscribe(new Cn(e,this.project,this.thisArg))}}class Cn extends Le{constructor(e,n,a){super(e),this.project=n,this.count=0,this.thisArg=a||this}_next(e){let n;try{n=this.project.call(this.thisArg,e,this.count++)}catch(a){return void this.destination.error(a)}this.destination.next(n)}}const Qt=t=>e=>{for(let n=0,a=t.length;n<a&&!e.closed;n++)e.next(t[n]);e.complete()},Vn=function un(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}(),qe=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function kt(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const Gt=t=>{if(t&&"function"==typeof t[Ze])return(t=>e=>{const n=t[Ze]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)})(t);if(qe(t))return Qt(t);if(kt(t))return(t=>e=>(t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,f),e))(t);if(t&&"function"==typeof t[Vn])return(t=>e=>{const n=t[Vn]();for(;;){let a;try{a=n.next()}catch(u){return e.error(u),e}if(a.done){e.complete();break}if(e.next(a.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e})(t);{const n=`You provided ${Ue(t)?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(n)}};function Sn(t,e){return new gt(n=>{const a=new ae;let u=0;return a.add(e.schedule(function(){u!==t.length?(n.next(t[u++]),n.closed||a.add(this.schedule())):n.complete()})),a})}function sr(t,e){return e?function fn(t,e){if(null!=t){if(function or(t){return t&&"function"==typeof t[Ze]}(t))return function wn(t,e){return new gt(n=>{const a=new ae;return a.add(e.schedule(()=>{const u=t[Ze]();a.add(u.subscribe({next(m){a.add(e.schedule(()=>n.next(m)))},error(m){a.add(e.schedule(()=>n.error(m)))},complete(){a.add(e.schedule(()=>n.complete()))}}))})),a})}(t,e);if(kt(t))return function ft(t,e){return new gt(n=>{const a=new ae;return a.add(e.schedule(()=>t.then(u=>{a.add(e.schedule(()=>{n.next(u),a.add(e.schedule(()=>n.complete()))}))},u=>{a.add(e.schedule(()=>n.error(u)))}))),a})}(t,e);if(qe(t))return Sn(t,e);if(function Xn(t){return t&&"function"==typeof t[Vn]}(t)||"string"==typeof t)return function Ur(t,e){if(!t)throw new Error("Iterable cannot be null");return new gt(n=>{const a=new ae;let u;return a.add(()=>{u&&"function"==typeof u.return&&u.return()}),a.add(e.schedule(()=>{u=t[Vn](),a.add(e.schedule(function(){if(n.closed)return;let m,v;try{const T=u.next();m=T.value,v=T.done}catch(T){return void n.error(T)}v?n.complete():(n.next(m),this.schedule())}))})),a})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof gt?t:new gt(Gt(t))}class Ln extends Le{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Vr extends Le{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function Co(t,e){if(e.closed)return;if(t instanceof gt)return t.subscribe(e);let n;try{n=Gt(t)(e)}catch(a){e.error(a)}return n}function Or(t,e,n=Number.POSITIVE_INFINITY){return"function"==typeof e?a=>a.pipe(Or((u,m)=>sr(t(u,m)).pipe(We((v,T)=>e(u,v,m,T))),n)):("number"==typeof e&&(n=e),a=>a.lift(new Ji(t,n)))}class Ji{constructor(e,n=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=n}call(e,n){return n.subscribe(new Gi(e,this.project,this.concurrent))}}class Gi extends Vr{constructor(e,n,a=Number.POSITIVE_INFINITY){super(e),this.project=n,this.concurrent=a,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let n;const a=this.index++;try{n=this.project(e,a)}catch(u){return void this.destination.error(u)}this.active++,this._innerSub(n)}_innerSub(e){const n=new Ln(this),a=this.destination;a.add(n);const u=Co(e,n);u!==n&&a.add(u)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function hi(t=Number.POSITIVE_INFINITY){return Or(De,t)}function Si(t,e){return e?Sn(t,e):new gt(Qt(t))}function Qi(...t){let e=Number.POSITIVE_INFINITY,n=null,a=t[t.length-1];return tt(a)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof a&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof gt?t[0]:hi(e)(Si(t,n))}function Bo(){return function(e){return e.lift(new es(e))}}class es{constructor(e){this.connectable=e}call(e,n){const{connectable:a}=this;a._refCount++;const u=new bs(e,a),m=n.subscribe(u);return u.closed||(u.connection=a.connect()),m}}class bs extends Le{constructor(e,n){super(e),this.connectable=n}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const n=e._refCount;if(n<=0)return void(this.connection=null);if(e._refCount=n-1,n>1)return void(this.connection=null);const{connection:a}=this,u=e._connection;this.connection=null,u&&(!a||u===a)&&u.unsubscribe()}}class ts extends gt{constructor(e,n){super(),this.source=e,this.subjectFactory=n,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new ae,e.add(this.source.subscribe(new Vs(this.getSubject(),this))),e.closed&&(this._connection=null,e=ae.EMPTY)),e}refCount(){return Bo()(this)}}const ws=(()=>{const t=ts.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}})();class Vs extends St{constructor(e,n){super(e),this.connectable=n}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const n=e._connection;e._refCount=0,e._subject=null,e._connection=null,n&&n.unsubscribe()}}}function Ii(t,e){return function(a){let u;if(u="function"==typeof t?t:function(){return t},"function"==typeof e)return a.lift(new Es(u,e));const m=Object.create(a,ws);return m.source=a,m.subjectFactory=u,m}}class Es{constructor(e,n){this.subjectFactory=e,this.selector=n}call(e,n){const{selector:a}=this,u=this.subjectFactory(),m=a(u).subscribe(e);return m.add(n.subscribe(u)),m}}function _i(){return new Tt}function Zn(t){for(let e in t)if(t[e]===Zn)return e;throw Error("Could not find renamed property on target object.")}function Kn(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(Kn).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function Oi(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const Uo=Zn({__forward_ref__:Zn});function K(t){return t.__forward_ref__=K,t.toString=function(){return Kn(this())},t}function z(t){return function j(t){return"function"==typeof t&&t.hasOwnProperty(Uo)&&t.__forward_ref__===K}(t)?t():t}class Y extends Error{constructor(e,n){super(function de(t,e){return`NG0${Math.abs(t)}${e?": "+e:""}`}(e,n)),this.code=e}}function pe(t){return"string"==typeof t?t:null==t?"":String(t)}function we(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():pe(t)}function vt(t,e){const n=e?` in ${e}`:"";throw new Y(-201,`No provider for ${we(t)} found${n}`)}function an(t,e){null==t&&function Zt(t,e,n,a){throw new Error(`ASSERTION ERROR: ${t}`+(null==a?"":` [Expected=> ${n} ${a} ${e} <=Actual]`))}(e,t,null,"!=")}function hn(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}const is=hn;function br(t){return{providers:t.providers||[],imports:t.imports||[]}}function ai(t){return wr(t,to)||wr(t,Hs)}function wr(t,e){return t.hasOwnProperty(e)?t[e]:null}function Gs(t){return t&&(t.hasOwnProperty(Ts)||t.hasOwnProperty(jn))?t[Ts]:null}const to=Zn({\u0275prov:Zn}),Ts=Zn({\u0275inj:Zn}),Hs=Zn({ngInjectableDef:Zn}),jn=Zn({ngInjectorDef:Zn});var mn=(()=>((mn=mn||{})[mn.Default=0]="Default",mn[mn.Host=1]="Host",mn[mn.Self=2]="Self",mn[mn.SkipSelf=4]="SkipSelf",mn[mn.Optional=8]="Optional",mn))();let So;function Cr(t){const e=So;return So=t,e}function di(t,e,n){const a=ai(t);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:n&mn.Optional?null:void 0!==e?e:void vt(Kn(t),"Injector")}function gr(t){return{toString:t}.toString()}var ei=(()=>((ei=ei||{})[ei.OnPush=0]="OnPush",ei[ei.Default=1]="Default",ei))(),Mi=(()=>(function(t){t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom"}(Mi||(Mi={})),Mi))();const no="undefined"!=typeof globalThis&&globalThis,Cs="undefined"!=typeof window&&window,os="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,An=no||"undefined"!=typeof global&&global||Cs||os,fe={},Fe=[],st=Zn({\u0275cmp:Zn}),Dn=Zn({\u0275dir:Zn}),Hn=Zn({\u0275pipe:Zn}),Hr=Zn({\u0275mod:Zn}),dr=Zn({\u0275fac:Zn}),yr=Zn({__NG_ELEMENT_ID__:Zn});let po=0;function Dr(t){return gr(()=>{const n={},a={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===ei.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||Fe,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||Mi.Emulated,id:"c",styles:t.styles||Fe,_:null,setInput:null,schemas:t.schemas||null,tView:null},u=t.directives,m=t.features,v=t.pipes;return a.id+=po++,a.inputs=Vo(t.inputs,n),a.outputs=Vo(t.outputs),m&&m.forEach(T=>T(a)),a.directiveDefs=u?()=>("function"==typeof u?u():u).map(ii):null,a.pipeDefs=v?()=>("function"==typeof v?v():v).map(xl):null,a})}function ii(t){return fr(t)||function Li(t){return t[Dn]||null}(t)}function xl(t){return function ne(t){return t[Hn]||null}(t)}const Ds={};function oi(t){return gr(()=>{const e={type:t.type,bootstrap:t.bootstrap||Fe,declarations:t.declarations||Fe,imports:t.imports||Fe,exports:t.exports||Fe,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(Ds[t.id]=t.type),e})}function Vo(t,e){if(null==t)return fe;const n={};for(const a in t)if(t.hasOwnProperty(a)){let u=t[a],m=u;Array.isArray(u)&&(m=u[1],u=u[0]),n[u]=a,e&&(e[u]=m)}return n}const Yr=Dr;function fr(t){return t[st]||null}function Ce(t,e){const n=t[Hr]||null;if(!n&&!0===e)throw new Error(`Type ${Kn(t)} does not have '\u0275mod' property.`);return n}function Mo(t){return Array.isArray(t)&&"object"==typeof t[1]}function go(t){return Array.isArray(t)&&!0===t[1]}function bl(t){return 0!=(8&t.flags)}function Ql(t){return 2==(2&t.flags)}function ec(t){return 1==(1&t.flags)}function qi(t){return null!==t.template}function Rf(t){return 0!=(512&t[2])}function Ua(t,e){return t.hasOwnProperty(dr)?t[dr]:null}class Nf{constructor(e,n,a){this.previousValue=e,this.currentValue=n,this.firstChange=a}isFirstChange(){return this.firstChange}}function Ps(){return Zu}function Zu(t){return t.type.prototype.ngOnChanges&&(t.setInput=Tl),Kc}function Kc(){const t=Yc(this),e=null==t?void 0:t.current;if(e){const n=t.previous;if(n===fe)t.previous=e;else for(let a in e)n[a]=e[a];t.current=null,this.ngOnChanges(e)}}function Tl(t,e,n,a){const u=Yc(t)||function Wu(t,e){return t[Cl]=e}(t,{previous:fe,current:null}),m=u.current||(u.current={}),v=u.previous,T=this.declaredInputs[n],I=v[T];m[T]=new Nf(I&&I.currentValue,e,v===fe),t[a]=e}Ps.ngInherit=!0;const Cl="__ngSimpleChanges__";function Yc(t){return t[Cl]||null}let _a;function Sr(t){return!!t.listen}const eu={createRenderer:(t,e)=>function Va(){return void 0!==_a?_a:"undefined"!=typeof document?document:void 0}()};function zr(t){for(;Array.isArray(t);)t=t[0];return t}function Zi(t,e){return zr(e[t.index])}function rc(t,e){return t.data[e]}function Fi(t,e){const n=e[t];return Mo(n)?n:n[0]}function Ws(t){return 4==(4&t[2])}function ic(t){return 128==(128&t[2])}function ss(t,e){return null==e?null:t[e]}function tu(t){t[18]=0}function nu(t,e){t[5]+=e;let n=t,a=t[3];for(;null!==a&&(1===e&&1===n[5]||-1===e&&0===n[5]);)a[5]+=e,n=a,a=a[3]}const gn={lFrame:rh(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Ku(){return gn.bindingsEnabled}function nt(){return gn.lFrame.lView}function Qn(){return gn.lFrame.tView}function xi(){let t=ks();for(;null!==t&&64===t.type;)t=t.parent;return t}function ks(){return gn.lFrame.currentTNode}function zi(t,e){const n=gn.lFrame;n.currentTNode=t,n.isParent=e}function Go(){return gn.lFrame.isParent}function Ha(){return gn.isInCheckNoChangesMode}function va(t){gn.isInCheckNoChangesMode=t}function Ks(){return gn.lFrame.bindingIndex++}function eh(t,e){const n=gn.lFrame;n.bindingIndex=n.bindingRootIndex=t,qa(e)}function qa(t){gn.lFrame.currentDirectiveIndex=t}function th(){return gn.lFrame.currentQueryIndex}function iu(t){gn.lFrame.currentQueryIndex=t}function xd(t){const e=t[1];return 2===e.type?e.declTNode:1===e.type?t[6]:null}function ou(t,e,n){if(n&mn.SkipSelf){let u=e,m=t;for(;!(u=u.parent,null!==u||n&mn.Host||(u=xd(m),null===u||(m=m[15],10&u.type))););if(null===u)return!1;e=u,t=m}const a=gn.lFrame=nh();return a.currentTNode=e,a.lView=t,!0}function sc(t){const e=nh(),n=t[1];gn.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function nh(){const t=gn.lFrame,e=null===t?null:t.child;return null===e?rh(t):e}function rh(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function su(){const t=gn.lFrame;return gn.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const ih=su;function ac(){const t=su();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Ni(){return gn.lFrame.selectedIndex}function Ys(t){gn.lFrame.selectedIndex=t}function Nr(){const t=gn.lFrame;return rc(t.tView,t.selectedIndex)}function Za(t,e){for(let n=e.directiveStart,a=e.directiveEnd;n<a;n++){const m=t.data[n].type.prototype,{ngAfterContentInit:v,ngAfterContentChecked:T,ngAfterViewInit:I,ngAfterViewChecked:O,ngOnDestroy:N}=m;v&&(t.contentHooks||(t.contentHooks=[])).push(-n,v),T&&((t.contentHooks||(t.contentHooks=[])).push(n,T),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(n,T)),I&&(t.viewHooks||(t.viewHooks=[])).push(-n,I),O&&((t.viewHooks||(t.viewHooks=[])).push(n,O),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(n,O)),null!=N&&(t.destroyHooks||(t.destroyHooks=[])).push(n,N)}}function Wa(t,e,n){Cd(t,e,3,n)}function Xa(t,e,n,a){(3&t[2])===n&&Cd(t,e,n,a)}function sh(t,e){let n=t[2];(3&n)===e&&(n&=2047,n+=1,t[2]=n)}function Cd(t,e,n,a){const m=null!=a?a:-1,v=e.length-1;let T=0;for(let I=void 0!==a?65535&t[18]:0;I<v;I++)if("number"==typeof e[I+1]){if(T=e[I],null!=a&&T>=a)break}else e[I]<0&&(t[18]+=65536),(T<m||-1==m)&&(ah(t,n,e,I),t[18]=(4294901760&t[18])+I+2),I++}function ah(t,e,n,a){const u=n[a]<0,m=n[a+1],T=t[u?-n[a]:n[a]];if(u){if(t[2]>>11<t[18]>>16&&(3&t[2])===e){t[2]+=2048;try{m.call(T)}finally{}}}else try{m.call(T)}finally{}}class Ka{constructor(e,n,a){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=a}}function oo(t,e,n){const a=Sr(t);let u=0;for(;u<n.length;){const m=n[u];if("number"==typeof m){if(0!==m)break;u++;const v=n[u++],T=n[u++],I=n[u++];a?t.setAttribute(e,T,I,v):e.setAttributeNS(v,T,I)}else{const v=m,T=n[++u];Qa(v)?a&&t.setProperty(e,v,T):a?t.setAttribute(e,v,T):e.setAttribute(v,T),u++}}return u}function Ir(t){return 3===t||4===t||6===t}function Qa(t){return 64===t.charCodeAt(0)}function Js(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let a=0;a<e.length;a++){const u=e[a];"number"==typeof u?n=u:0===n||p(t,n,u,null,-1===n||2===n?e[++a]:null)}}return t}function p(t,e,n,a,u){let m=0,v=t.length;if(-1===e)v=-1;else for(;m<t.length;){const T=t[m++];if("number"==typeof T){if(T===e){v=-1;break}if(T>e){v=m-1;break}}}for(;m<t.length;){const T=t[m];if("number"==typeof T)break;if(T===n){if(null===a)return void(null!==u&&(t[m+1]=u));if(a===t[m+1])return void(t[m+2]=u)}m++,null!==a&&m++,null!==u&&m++}-1!==v&&(t.splice(v,0,e),m=v+1),t.splice(m++,0,n),null!==a&&t.splice(m++,0,a),null!==u&&t.splice(m++,0,u)}function i(t){return-1!==t}function h(t){return 32767&t}function b(t,e){let n=function _(t){return t>>16}(t),a=e;for(;n>0;)a=a[15],n--;return a}let w=!0;function C(t){const e=w;return w=t,e}let L=0;function $(t,e){const n=q(t,e);if(-1!==n)return n;const a=e[1];a.firstCreatePass&&(t.injectorIndex=e.length,W(a.data,t),W(e,null),W(a.blueprint,null));const u=V(t,e),m=t.injectorIndex;if(i(u)){const v=h(u),T=b(u,e),I=T[1].data;for(let O=0;O<8;O++)e[m+O]=T[v+O]|I[v+O]}return e[m+8]=u,m}function W(t,e){t.push(0,0,0,0,0,0,0,0,e)}function q(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function V(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,a=null,u=e;for(;null!==u;){const m=u[1],v=m.type;if(a=2===v?m.declTNode:1===v?u[6]:null,null===a)return-1;if(n++,u=u[15],-1!==a.injectorIndex)return a.injectorIndex|n<<16}return-1}function re(t,e,n){!function B(t,e,n){let a;"string"==typeof n?a=n.charCodeAt(0)||0:n.hasOwnProperty(yr)&&(a=n[yr]),null==a&&(a=n[yr]=L++);const u=255&a;e.data[t+(u>>5)]|=1<<u}(t,e,n)}function te(t,e,n){if(n&mn.Optional)return t;vt(e,"NodeInjector")}function ie(t,e,n,a){if(n&mn.Optional&&void 0===a&&(a=null),0==(n&(mn.Self|mn.Host))){const u=t[9],m=Cr(void 0);try{return u?u.get(e,a,n&mn.Optional):di(e,a,n&mn.Optional)}finally{Cr(m)}}return te(a,e,n)}function le(t,e,n,a=mn.Default,u){if(null!==t){const m=function je(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(yr)?t[yr]:void 0;return"number"==typeof e?e>=0?255&e:he:e}(n);if("function"==typeof m){if(!ou(e,t,a))return a&mn.Host?te(u,n,a):ie(e,n,a,u);try{const v=m(a);if(null!=v||a&mn.Optional)return v;vt(n)}finally{ih()}}else if("number"==typeof m){let v=null,T=q(t,e),I=-1,O=a&mn.Host?e[16][6]:null;for((-1===T||a&mn.SkipSelf)&&(I=-1===T?V(t,e):e[T+8],-1!==I&&Me(a,!1)?(v=e[1],T=h(I),e=b(I,e)):T=-1);-1!==T;){const N=e[1];if(mt(m,T,N.data)){const H=Ae(T,e,n,v,a,O);if(H!==ee)return H}I=e[T+8],-1!==I&&Me(a,e[1].data[T+8]===O)&&mt(m,T,e)?(v=N,T=h(I),e=b(I,e)):T=-1}}}return ie(e,n,a,u)}const ee={};function he(){return new at(xi(),nt())}function Ae(t,e,n,a,u,m){const v=e[1],T=v.data[t+8],N=ze(T,v,n,null==a?Ql(T)&&w:a!=v&&0!=(3&T.type),u&mn.Host&&m===T);return null!==N?$e(e,v,N,T):ee}function ze(t,e,n,a,u){const m=t.providerIndexes,v=e.data,T=1048575&m,I=t.directiveStart,N=m>>20,oe=u?T+N:t.directiveEnd;for(let ce=a?T:T+N;ce<oe;ce++){const Re=v[ce];if(ce<I&&n===Re||ce>=I&&Re.type===n)return ce}if(u){const ce=v[I];if(ce&&qi(ce)&&ce.type===n)return I}return null}function $e(t,e,n,a){let u=t[n];const m=e.data;if(function lh(t){return t instanceof Ka}(u)){const v=u;v.resolving&&function xe(t,e){const n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new Y(-200,`Circular dependency in DI detected for ${t}${n}`)}(we(m[n]));const T=C(v.canSeeViewProviders);v.resolving=!0;const I=v.injectImpl?Cr(v.injectImpl):null;ou(t,a,mn.Default);try{u=t[n]=v.factory(void 0,m,t,a),e.firstCreatePass&&n>=a.directiveStart&&function Td(t,e,n){const{ngOnChanges:a,ngOnInit:u,ngDoCheck:m}=e.type.prototype;if(a){const v=Zu(e);(n.preOrderHooks||(n.preOrderHooks=[])).push(t,v),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,v)}u&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-t,u),m&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t,m),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,m))}(n,m[n],e)}finally{null!==I&&Cr(I),C(T),v.resolving=!1,ih()}}return u}function mt(t,e,n){return!!(n[e+(t>>5)]&1<<t)}function Me(t,e){return!(t&mn.Self||t&mn.Host&&e)}class at{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,a){return le(this._tNode,this._lView,e,a,n)}}function Ne(t){return function J(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const n=t.attrs;if(n){const a=n.length;let u=0;for(;u<a;){const m=n[u];if(Ir(m))break;if(0===m)u+=2;else if("number"==typeof m)for(u++;u<a&&"string"==typeof n[u];)u++;else{if(m===e)return n[u+1];u+=2}}}return null}(xi(),t)}const Ht="__parameters__";function _n(t,e,n){return gr(()=>{const a=function tn(t){return function(...n){if(t){const a=t(...n);for(const u in a)this[u]=a[u]}}}(e);function u(...m){if(this instanceof u)return a.apply(this,m),this;const v=new u(...m);return T.annotation=v,T;function T(I,O,N){const H=I.hasOwnProperty(Ht)?I[Ht]:Object.defineProperty(I,Ht,{value:[]})[Ht];for(;H.length<=N;)H.push(null);return(H[N]=H[N]||[]).push(v),I}}return n&&(u.prototype=Object.create(n.prototype)),u.prototype.ngMetadataName=t,u.annotationCls=u,u})}class Vt{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=hn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Qr=new Vt("AnalyzeForEntryComponents");function ni(t,e){void 0===e&&(e=t);for(let n=0;n<t.length;n++){let a=t[n];Array.isArray(a)?(e===t&&(e=t.slice(0,n)),ni(a,e)):e!==t&&e.push(a)}return e}function yo(t,e){t.forEach(n=>Array.isArray(n)?yo(n,e):e(n))}function vo(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Os(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}const ko={},ba="__NG_DI_FLAG__",Qs="ngTempTokenPath",ly=/\n/gm,Fm="__source",uy=Zn({provide:String,useValue:Zn});let uu;function ph(t){const e=uu;return uu=t,e}function ea(t,e=mn.Default){if(void 0===uu)throw new Y(203,"");return null===uu?di(t,void 0,e):uu.get(t,e&mn.Optional?null:void 0,e)}function on(t,e=mn.Default){return(function Gr(){return So}()||ea)(z(t),e)}const ri=on;function En(t){const e=[];for(let n=0;n<t.length;n++){const a=z(t[n]);if(Array.isArray(a)){if(0===a.length)throw new Y(900,"");let u,m=mn.Default;for(let v=0;v<a.length;v++){const T=a[v],I=Vf(T);"number"==typeof I?-1===I?u=T.token:m|=I:u=T}e.push(on(u,m))}else e.push(on(a))}return e}function Ls(t,e){return t[ba]=e,t.prototype[ba]=e,t}function Vf(t){return t[ba]}const hu=Ls(_n("Inject",t=>({token:t})),-1),Fs=Ls(_n("Optional"),8),wa=Ls(_n("SkipSelf"),4);class yh{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const vh=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Xm=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var wi=(()=>((wi=wi||{})[wi.NONE=0]="NONE",wi[wi.HTML=1]="HTML",wi[wi.STYLE=2]="STYLE",wi[wi.SCRIPT=3]="SCRIPT",wi[wi.URL=4]="URL",wi[wi.RESOURCE_URL=5]="RESOURCE_URL",wi))();function wh(t){const e=function Eh(){const t=nt();return t&&t[12]}();return e?e.sanitize(wi.URL,t)||"":function fu(t,e){const n=function Ea(t){return t instanceof yh&&t.getTypeName()||null}(t);if(null!=n&&n!==e){if("ResourceURL"===n&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===e}(t,"URL")?function bi(t){return t instanceof yh?t.changingThisBreaksApplicationSecurity:t}(t):function xh(t){return(t=String(t)).match(vh)||t.match(Xm)?t:"unsafe:"+t}(pe(t))}const yu="__ngContext__";function xo(t,e){t[yu]=e}function ip(t){const e=function Th(t){return t[yu]||null}(t);return e?Array.isArray(e)?e:e.lView:null}function xu(t){return t.ngOriginalError}function rg(t,...e){t.error(...e)}class bu{constructor(){this._console=console}handleError(e){const n=this._findOriginalError(e),a=function Ch(t){return t&&t.ngErrorLogger||rg}(e);a(this._console,"ERROR",e),n&&a(this._console,"ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&xu(e);for(;n&&xu(n);)n=xu(n);return n||null}}const cp=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(An))();function Ca(t){return t instanceof Function?t():t}var us=(()=>((us=us||{})[us.Important=1]="Important",us[us.DashCase=2]="DashCase",us))();function zd(t,e){return undefined(t,e)}function Ih(t){const e=t[3];return go(e)?e[3]:e}function dp(t){return Tu(t[13])}function fp(t){return Tu(t[4])}function Tu(t){for(;null!==t&&!go(t);)t=t[4];return t}function _c(t,e,n,a,u){if(null!=a){let m,v=!1;go(a)?m=a:Mo(a)&&(v=!0,a=a[0]);const T=zr(a);0===t&&null!==n?null==u?fg(e,n,T):xc(e,n,T,u||null,!0):1===t&&null!==n?xc(e,n,T,u||null,!0):2===t?function mg(t,e,n){const a=Ah(t,e);a&&function jy(t,e,n,a){Sr(t)?t.removeChild(e,n,a):e.removeChild(n)}(t,a,e,n)}(e,T,v):3===t&&e.destroyNode(T),null!=m&&function yp(t,e,n,a,u){const m=n[7];m!==zr(n)&&_c(e,t,a,m,u);for(let T=10;T<n.length;T++){const I=n[T];Iu(I[1],I,t,e,a,m)}}(e,t,m,n,u)}}function vc(t,e,n){if(Sr(t))return t.createElement(e,n);{const a=null!==n?function dd(t){const e=t.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(n):null;return null===a?t.createElement(e):t.createElementNS(a,e)}}function ug(t,e){const n=t[9],a=n.indexOf(e),u=e[3];1024&e[2]&&(e[2]&=-1025,nu(u,-1)),n.splice(a,1)}function pp(t,e){if(t.length<=10)return;const n=10+e,a=t[n];if(a){const u=a[17];null!==u&&u!==t&&ug(u,a),e>0&&(t[n-1][4]=a[4]);const m=Os(t,10+e);!function lg(t,e){Iu(t,e,e[11],2,null,null),e[0]=null,e[6]=null}(a[1],a);const v=m[19];null!==v&&v.detachView(m[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function hg(t,e){if(!(256&e[2])){const n=e[11];Sr(n)&&n.destroyNode&&Iu(t,e,n,3,null,null),function zy(t){let e=t[13];if(!e)return Cu(t[1],t);for(;e;){let n=null;if(Mo(e))n=e[13];else{const a=e[10];a&&(n=a)}if(!n){for(;e&&!e[4]&&e!==t;)Mo(e)&&Cu(e[1],e),e=e[3];null===e&&(e=t),Mo(e)&&Cu(e[1],e),n=e&&e[4]}e=n}}(e)}}function Cu(t,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function dg(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let a=0;a<n.length;a+=2){const u=e[n[a]];if(!(u instanceof Ka)){const m=n[a+1];if(Array.isArray(m))for(let v=0;v<m.length;v+=2){const T=u[m[v]],I=m[v+1];try{I.call(T)}finally{}}else try{m.call(u)}finally{}}}}(t,e),function Uy(t,e){const n=t.cleanup,a=e[7];let u=-1;if(null!==n)for(let m=0;m<n.length-1;m+=2)if("string"==typeof n[m]){const v=n[m+1],T="function"==typeof v?v(e):zr(e[v]),I=a[u=n[m+2]],O=n[m+3];"boolean"==typeof O?T.removeEventListener(n[m],I,O):O>=0?a[u=O]():a[u=-O].unsubscribe(),m+=2}else{const v=a[u=n[m+1]];n[m].call(v)}if(null!==a){for(let m=u+1;m<a.length;m++)a[m]();e[7]=null}}(t,e),1===e[1].type&&Sr(e[11])&&e[11].destroy();const n=e[17];if(null!==n&&go(e[3])){n!==e[3]&&ug(n,e);const a=e[19];null!==a&&a.detachView(t)}}}function mp(t,e,n){return function gp(t,e,n){let a=e;for(;null!==a&&40&a.type;)a=(e=a).parent;if(null===a)return n[0];if(2&a.flags){const u=t.data[a.directiveStart].encapsulation;if(u===Mi.None||u===Mi.Emulated)return null}return Zi(a,n)}(t,e.parent,n)}function xc(t,e,n,a,u){Sr(t)?t.insertBefore(e,n,a,u):e.insertBefore(n,a,u)}function fg(t,e,n){Sr(t)?t.appendChild(e,n):e.appendChild(n)}function pg(t,e,n,a,u){null!==a?xc(t,e,n,a,u):fg(t,e,n)}function Ah(t,e){return Sr(t)?t.parentNode(e):e.parentNode}let Bd=function ta(t,e,n){return 40&t.type?Zi(t,n):null};function Ud(t,e,n,a){const u=mp(t,a,e),m=e[11],T=function ji(t,e,n){return Bd(t,e,n)}(a.parent||e[6],a,e);if(null!=u)if(Array.isArray(n))for(let I=0;I<n.length;I++)pg(m,u,n[I],T,!1);else pg(m,u,n,T,!1)}function jd(t,e){if(null!==e){const n=e.type;if(3&n)return Zi(e,t);if(4&n)return _p(-1,t[e.index]);if(8&n){const a=e.child;if(null!==a)return jd(t,a);{const u=t[e.index];return go(u)?_p(-1,u):zr(u)}}if(32&n)return zd(e,t)()||zr(t[e.index]);{const a=Su(t,e);return null!==a?Array.isArray(a)?a[0]:jd(Ih(t[16]),a):jd(t,e.next)}}return null}function Su(t,e){return null!==e?t[16][6].projection[e.projection]:null}function _p(t,e){const n=10+t+1;if(n<e.length){const a=e[n],u=a[1].firstChild;if(null!==u)return jd(a,u)}return e[7]}function Vd(t,e,n,a,u,m,v){for(;null!=n;){const T=a[n.index],I=n.type;if(v&&0===e&&(T&&xo(zr(T),a),n.flags|=4),64!=(64&n.flags))if(8&I)Vd(t,e,n.child,a,u,m,!1),_c(e,t,u,T,m);else if(32&I){const O=zd(n,a);let N;for(;N=O();)_c(e,t,u,N,m);_c(e,t,u,T,m)}else 16&I?Tr(t,e,a,n,u,m):_c(e,t,u,T,m);n=v?n.projectionNext:n.next}}function Iu(t,e,n,a,u,m){Vd(n,a,t.firstChild,e,u,m,!1)}function Tr(t,e,n,a,u,m){const v=n[16],I=v[6].projection[a.projection];if(Array.isArray(I))for(let O=0;O<I.length;O++)_c(e,t,u,I[O],m);else Vd(t,e,I,v[3],u,m,!0)}function vp(t,e,n){Sr(t)?t.setAttribute(e,"style",n):e.style.cssText=n}function na(t,e,n){Sr(t)?""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n):e.className=n}function wc(t,e,n){let a=t.length;for(;;){const u=t.indexOf(e,n);if(-1===u)return u;if(0===u||t.charCodeAt(u-1)<=32){const m=e.length;if(u+m===a||t.charCodeAt(u+m)<=32)return u}n=u+1}}const _g="ng-template";function Gy(t,e,n){let a=0;for(;a<t.length;){let u=t[a++];if(n&&"class"===u){if(u=t[a],-1!==wc(u.toLowerCase(),e,0))return!0}else if(1===u){for(;a<t.length&&"string"==typeof(u=t[a++]);)if(u.toLowerCase()===e)return!0;return!1}}return!1}function yg(t){return 4===t.type&&t.value!==_g}function Hy(t,e,n){return e===(4!==t.type||n?t.value:_g)}function qy(t,e,n){let a=4;const u=t.attrs||[],m=function $d(t){for(let e=0;e<t.length;e++)if(Ir(t[e]))return e;return t.length}(u);let v=!1;for(let T=0;T<e.length;T++){const I=e[T];if("number"!=typeof I){if(!v)if(4&a){if(a=2|1&a,""!==I&&!Hy(t,I,n)||""===I&&1===e.length){if(ra(a))return!1;v=!0}}else{const O=8&a?I:e[++T];if(8&a&&null!==t.attrs){if(!Gy(t.attrs,O,n)){if(ra(a))return!1;v=!0}continue}const H=Zy(8&a?"class":I,u,yg(t),n);if(-1===H){if(ra(a))return!1;v=!0;continue}if(""!==O){let oe;oe=H>m?"":u[H+1].toLowerCase();const ce=8&a?oe:null;if(ce&&-1!==wc(ce,O,0)||2&a&&O!==oe){if(ra(a))return!1;v=!0}}}}else{if(!v&&!ra(a)&&!ra(I))return!1;if(v&&ra(I))continue;v=!1,a=I|1&a}}return ra(a)||v}function ra(t){return 0==(1&t)}function Zy(t,e,n,a){if(null===e)return-1;let u=0;if(a||!n){let m=!1;for(;u<e.length;){const v=e[u];if(v===t)return u;if(3===v||6===v)m=!0;else{if(1===v||2===v){let T=e[++u];for(;"string"==typeof T;)T=e[++u];continue}if(4===v)break;if(0===v){u+=4;continue}}u+=m?1:2}return-1}return function Mu(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){const a=t[n];if("number"==typeof a)return-1;if(a===e)return n;n++}return-1}(e,t)}function vg(t,e,n=!1){for(let a=0;a<e.length;a++)if(qy(t,e[a],n))return!0;return!1}function bg(t,e){return t?":not("+e.trim()+")":e}function Xy(t){let e=t[0],n=1,a=2,u="",m=!1;for(;n<t.length;){let v=t[n];if("string"==typeof v)if(2&a){const T=t[++n];u+="["+v+(T.length>0?'="'+T+'"':"")+"]"}else 8&a?u+="."+v:4&a&&(u+=" "+v);else""!==u&&!ra(v)&&(e+=bg(m,u),u=""),a=v,m=m||!ra(a);n++}return""!==u&&(e+=bg(m,u)),e}const Nn={};function Ec(t){Ko(Qn(),nt(),Ni()+t,Ha())}function Ko(t,e,n,a){if(!a)if(3==(3&e[2])){const m=t.preOrderCheckHooks;null!==m&&Wa(e,m,n)}else{const m=t.preOrderHooks;null!==m&&Xa(e,m,0,n)}Ys(n)}function Lh(t,e){const n=t.contentQueries;if(null!==n)for(let a=0;a<n.length;a+=2){const u=n[a],m=n[a+1];if(-1!==m){const v=t.data[m];iu(u),v.contentQueries(2,e[m],m)}}}function Cc(t,e,n,a,u,m,v,T,I,O){const N=e.blueprint.slice();return N[0]=u,N[2]=140|a,tu(N),N[3]=N[15]=t,N[8]=n,N[10]=v||t&&t[10],N[11]=T||t&&t[11],N[12]=I||t&&t[12]||null,N[9]=O||t&&t[9]||null,N[6]=m,N[16]=2==e.type?t[16]:N,N}function Ul(t,e,n,a,u){let m=t.data[e];if(null===m)m=function Sa(t,e,n,a,u){const m=ks(),v=Go(),I=t.data[e]=function lv(t,e,n,a,u,m){return{type:n,index:a,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:u,attrs:m,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,v?m:m&&m.parent,n,e,a,u);return null===t.firstChild&&(t.firstChild=I),null!==m&&(v?null==m.child&&null!==I.parent&&(m.child=I):null===m.next&&(m.next=I)),I}(t,e,n,a,u),function Ju(){return gn.lFrame.inI18n}()&&(m.flags|=64);else if(64&m.type){m.type=n,m.value=a,m.attrs=u;const v=function Dl(){const t=gn.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();m.injectorIndex=null===v?-1:v.injectorIndex}return zi(m,!0),m}function ku(t,e,n,a){if(0===n)return-1;const u=e.length;for(let m=0;m<n;m++)e.push(a),t.blueprint.push(a),t.data.push(null);return u}function Dc(t,e,n){sc(e);try{const a=t.viewQuery;null!==a&&hf(1,a,n);const u=t.template;null!==u&&Mg(t,e,u,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&Lh(t,e),t.staticViewQueries&&hf(2,t.viewQuery,n);const m=t.components;null!==m&&function av(t,e){for(let n=0;n<e.length;n++)Ia(t,e[n])}(e,m)}catch(a){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),a}finally{e[2]&=-5,ac()}}function Sc(t,e,n,a){const u=e[2];if(256==(256&u))return;sc(e);const m=Ha();try{tu(e),function Yu(t){return gn.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==n&&Mg(t,e,n,2,a);const v=3==(3&u);if(!m)if(v){const O=t.preOrderCheckHooks;null!==O&&Wa(e,O,null)}else{const O=t.preOrderHooks;null!==O&&Xa(e,O,0,null),sh(e,0)}if(function hv(t){for(let e=dp(t);null!==e;e=fp(e)){if(!e[2])continue;const n=e[9];for(let a=0;a<n.length;a++){const u=n[a],m=u[3];0==(1024&u[2])&&nu(m,1),u[2]|=1024}}}(e),function jg(t){for(let e=dp(t);null!==e;e=fp(e))for(let n=10;n<e.length;n++){const a=e[n],u=a[1];ic(a)&&Sc(u,a,u.template,a[8])}}(e),null!==t.contentQueries&&Lh(t,e),!m)if(v){const O=t.contentCheckHooks;null!==O&&Wa(e,O)}else{const O=t.contentHooks;null!==O&&Xa(e,O,1),sh(e,1)}!function sv(t,e){const n=t.hostBindingOpCodes;if(null!==n)try{for(let a=0;a<n.length;a++){const u=n[a];if(u<0)Ys(~u);else{const m=u,v=n[++a],T=n[++a];eh(v,m),T(2,e[m])}}}finally{Ys(-1)}}(t,e);const T=t.components;null!==T&&function Ip(t,e){for(let n=0;n<e.length;n++)Vg(t,e[n])}(e,T);const I=t.viewQuery;if(null!==I&&hf(2,I,a),!m)if(v){const O=t.viewCheckHooks;null!==O&&Wa(e,O)}else{const O=t.viewHooks;null!==O&&Xa(e,O,2),sh(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),m||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,nu(e[3],-1))}finally{ac()}}function nf(t,e,n,a){const u=e[10],m=!Ha(),v=Ws(e);try{m&&!v&&u.begin&&u.begin(),v&&Dc(t,e,a),Sc(t,e,n,a)}finally{m&&!v&&u.end&&u.end()}}function Mg(t,e,n,a,u){const m=Ni(),v=2&a;try{Ys(-1),v&&e.length>20&&Ko(t,e,20,Ha()),n(a,u)}finally{Ys(m)}}function rf(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=of(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function of(t,e,n,a,u,m,v,T,I,O){const N=20+a,H=N+u,oe=function Fh(t,e){const n=[];for(let a=0;a<e;a++)n.push(a<t?null:Nn);return n}(N,H),ce="function"==typeof O?O():O;return oe[1]={type:t,blueprint:oe,template:n,queries:null,viewQuery:T,declTNode:e,data:oe.slice().fill(null,N),bindingStartIndex:N,expandoStartIndex:H,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof m?m():m,pipeRegistry:"function"==typeof v?v():v,firstChild:null,schemas:I,consts:ce,incompleteFirstPass:!1}}function Pp(t,e,n,a){const u=Up(e);null===n?u.push(a):(u.push(n),t.firstCreatePass&&jp(t).push(a,u.length-1))}function kg(t,e,n){for(let a in t)if(t.hasOwnProperty(a)){const u=t[a];(n=null===n?{}:n).hasOwnProperty(a)?n[a].push(e,u):n[a]=[e,u]}return n}function Lg(t,e,n,a,u,m){const v=m.hostBindings;if(v){let T=t.hostBindingOpCodes;null===T&&(T=t.hostBindingOpCodes=[]);const I=~e.index;(function Rp(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(T)!=I&&T.push(I),T.push(a,u,v)}}function Op(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function Fp(t,e){e.flags|=2,(t.components||(t.components=[])).push(e.index)}function Ng(t,e,n){if(n){if(e.exportAs)for(let a=0;a<e.exportAs.length;a++)n[e.exportAs[a]]=t;qi(e)&&(n[""]=t)}}function zp(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function Bg(t,e,n,a,u){t.data[a]=u;const m=u.factory||(u.factory=Ua(u.type)),v=new Ka(m,qi(u),null);t.blueprint[a]=v,n[a]=v,Lg(t,e,0,a,ku(t,n,u.hostVars,Nn),u)}function uv(t,e,n){const a=Zi(e,t),u=rf(n),m=t[10],v=ps(t,Cc(t,u,null,n.onPush?64:16,a,e,m,m.createRenderer(a,n),null,null));t[e.index]=v}function sa(t,e,n,a,u,m){const v=Zi(t,e);!function Ou(t,e,n,a,u,m,v){if(null==m)Sr(t)?t.removeAttribute(e,u,n):e.removeAttribute(u);else{const T=null==v?pe(m):v(m,a||"",u);Sr(t)?t.setAttribute(e,u,T,n):n?e.setAttributeNS(n,u,T):e.setAttribute(u,T)}}(e[11],v,m,t.value,n,a,u)}function Ug(t,e,n,a,u,m){const v=m[e];if(null!==v){const T=a.setInput;for(let I=0;I<v.length;){const O=v[I++],N=v[I++],H=v[I++];null!==T?a.setInput(n,H,O,N):n[N]=H}}}function bo(t,e){let n=null,a=0;for(;a<e.length;){const u=e[a];if(0!==u)if(5!==u){if("number"==typeof u)break;t.hasOwnProperty(u)&&(null===n&&(n=[]),n.push(u,t[u],e[a+1])),a+=2}else a+=2;else a+=4}return n}function Vg(t,e){const n=Fi(e,t);if(ic(n)){const a=n[1];80&n[2]?Sc(a,n,a.template,n[8]):n[5]>0&&Jo(n)}}function Jo(t){for(let a=dp(t);null!==a;a=fp(a))for(let u=10;u<a.length;u++){const m=a[u];if(1024&m[2]){const v=m[1];Sc(v,m,v.template,m[8])}else m[5]>0&&Jo(m)}const n=t[1].components;if(null!==n)for(let a=0;a<n.length;a++){const u=Fi(n[a],t);ic(u)&&u[5]>0&&Jo(u)}}function Ia(t,e){const n=Fi(e,t),a=n[1];(function Vl(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])})(a,n),Dc(a,n,n[8])}function ps(t,e){return t[13]?t[14][4]=e:t[13]=e,t[14]=e,e}function Ma(t){for(;t;){t[2]|=64;const e=Ih(t);if(Rf(t)&&!e)return t;t=e}return null}function uf(t,e,n){const a=e[10];a.begin&&a.begin();try{Sc(t,e,t.template,n)}catch(u){throw $p(e,u),u}finally{a.end&&a.end()}}function Np(t){!function cf(t){for(let e=0;e<t.components.length;e++){const n=t.components[e],a=ip(n),u=a[1];nf(u,a,u.template,n)}}(t[8])}function hf(t,e,n){iu(0),e(t,n)}const $g=(()=>Promise.resolve(null))();function Up(t){return t[7]||(t[7]=[])}function jp(t){return t.cleanup||(t.cleanup=[])}function $p(t,e){const n=t[9],a=n?n.get(bu,null):null;a&&a.handleError(e)}function cl(t,e,n,a,u){for(let m=0;m<n.length;){const v=n[m++],T=n[m++],I=e[v],O=t.data[v];null!==O.setInput?O.setInput(I,u,a,T):I[T]=u}}function Aa(t,e,n){const a=function Ga(t,e){return zr(e[t])}(e,t);!function ag(t,e,n){Sr(t)?t.setValue(e,n):e.textContent=n}(t[11],a,n)}function Mc(t,e,n){let a=n?t.styles:null,u=n?t.classes:null,m=0;if(null!==e)for(let v=0;v<e.length;v++){const T=e[v];"number"==typeof T?m=T:1==m?u=Oi(u,T):2==m&&(a=Oi(a,T+": "+e[++v]+";"))}n?t.styles=a:t.stylesWithoutHost=a,n?t.classes=u:t.classesWithoutHost=u}const Nh=new Vt("INJECTOR",-1);class aa{get(e,n=ko){if(n===ko){const a=new Error(`NullInjectorError: No provider for ${Kn(e)}!`);throw a.name="NullInjectorError",a}return n}}const Bh=new Vt("Set Injector scope."),Ac={},la={};let ul;function Gp(){return void 0===ul&&(ul=new aa),ul}function Hp(t,e=null,n=null,a){const u=Uh(t,e,n,a);return u._resolveInjectorDefTypes(),u}function Uh(t,e=null,n=null,a){return new Hg(t,n,e||Gp(),a)}class Hg{constructor(e,n,a,u=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const m=[];n&&yo(n,T=>this.processProvider(T,e,n)),yo([e],T=>this.processInjectorType(T,[],m)),this.records.set(Nh,$l(void 0,this));const v=this.records.get(Bh);this.scope=null!=v?v.value:null,this.source=u||("object"==typeof e?null:Kn(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,n=ko,a=mn.Default){this.assertNotDestroyed();const u=ph(this),m=Cr(void 0);try{if(!(a&mn.SkipSelf)){let T=this.records.get(e);if(void 0===T){const I=function Vh(t){return"function"==typeof t||"object"==typeof t&&t instanceof Vt}(e)&&ai(e);T=I&&this.injectableDefInScope(I)?$l(df(e),Ac):null,this.records.set(e,T)}if(null!=T)return this.hydrate(e,T)}return(a&mn.Self?Gp():this.parent).get(e,n=a&mn.Optional&&n===ko?null:n)}catch(v){if("NullInjectorError"===v.name){if((v[Qs]=v[Qs]||[]).unshift(Kn(e)),u)throw v;return function vr(t,e,n,a){const u=t[Qs];throw e[Fm]&&u.unshift(e[Fm]),t.message=function Nm(t,e,n,a=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let u=Kn(e);if(Array.isArray(e))u=e.map(Kn).join(" -> ");else if("object"==typeof e){let m=[];for(let v in e)if(e.hasOwnProperty(v)){let T=e[v];m.push(v+":"+("string"==typeof T?JSON.stringify(T):Kn(T)))}u=`{${m.join(", ")}}`}return`${n}${a?"("+a+")":""}[${u}]: ${t.replace(ly,"\n  ")}`}("\n"+t.message,u,n,a),t.ngTokenPath=u,t[Qs]=null,t}(v,e,"R3InjectorError",this.source)}throw v}finally{Cr(m),ph(u)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((a,u)=>e.push(Kn(u))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Y(205,!1)}processInjectorType(e,n,a){if(!(e=z(e)))return!1;let u=Gs(e);const m=null==u&&e.ngModule||void 0,v=void 0===m?e:m,T=-1!==a.indexOf(v);if(void 0!==m&&(u=Gs(m)),null==u)return!1;if(null!=u.imports&&!T){let N;a.push(v);try{yo(u.imports,H=>{this.processInjectorType(H,n,a)&&(void 0===N&&(N=[]),N.push(H))})}finally{}if(void 0!==N)for(let H=0;H<N.length;H++){const{ngModule:oe,providers:ce}=N[H];yo(ce,Re=>this.processProvider(Re,oe,ce||Fe))}}this.injectorDefTypes.add(v);const I=Ua(v)||(()=>new v);this.records.set(v,$l(I,Ac));const O=u.providers;if(null!=O&&!T){const N=e;yo(O,H=>this.processProvider(H,N,O))}return void 0!==m&&void 0!==e.providers}processProvider(e,n,a){let u=ms(e=z(e))?e:z(e&&e.provide);const m=function qg(t,e,n){return qp(t)?$l(void 0,t.useValue):$l(function Zg(t,e,n){let a;if(ms(t)){const u=z(t);return Ua(u)||df(u)}if(qp(t))a=()=>z(t.useValue);else if(function gv(t){return!(!t||!t.useFactory)}(t))a=()=>t.useFactory(...En(t.deps||[]));else if(function Wg(t){return!(!t||!t.useExisting)}(t))a=()=>on(z(t.useExisting));else{const u=z(t&&(t.useClass||t.provide));if(!function yv(t){return!!t.deps}(t))return Ua(u)||df(u);a=()=>new u(...En(t.deps))}return a}(t),Ac)}(e);if(ms(e)||!0!==e.multi)this.records.get(u);else{let v=this.records.get(u);v||(v=$l(void 0,Ac,!0),v.factory=()=>En(v.multi),this.records.set(u,v)),u=e,v.multi.push(e)}this.records.set(u,m)}hydrate(e,n){return n.value===Ac&&(n.value=la,n.value=n.factory()),"object"==typeof n.value&&n.value&&function jh(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(e){if(!e.providedIn)return!1;const n=z(e.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function df(t){const e=ai(t),n=null!==e?e.factory:Ua(t);if(null!==n)return n;if(t instanceof Vt)throw new Y(204,!1);if(t instanceof Function)return function mv(t){const e=t.length;if(e>0)throw function Il(t,e){const n=[];for(let a=0;a<t;a++)n.push(e);return n}(e,"?"),new Y(204,!1);const n=function Kl(t){const e=t&&(t[to]||t[Hs]);if(e){const n=function Hi(t){if(t.hasOwnProperty("name"))return t.name;const e=(""+t).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),e}return null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new Y(204,!1)}function $l(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function qp(t){return null!==t&&"object"==typeof t&&uy in t}function ms(t){return"function"==typeof t}let Vi=(()=>{class t{static create(n,a){var u;if(Array.isArray(n))return Hp({name:""},a,n,"");{const m=null!==(u=n.name)&&void 0!==u?u:"";return Hp({name:m},n.parent,n.providers,m)}}}return t.THROW_IF_NOT_FOUND=ko,t.NULL=new aa,t.\u0275prov=hn({token:t,providedIn:"any",factory:()=>on(Nh)}),t.__NG_ELEMENT_ID__=-1,t})();function G(t,e){Za(ip(t)[1],xi())}let Oe=null;function He(){if(!Oe){const t=An.Symbol;if(t&&t.iterator)Oe=t.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<e.length;++n){const a=e[n];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(Oe=a)}}}return Oe}function nn(t,e,n){return!Object.is(t[e],n)&&(t[e]=n,!0)}function zt(t,e,n,a){const u=nn(t,e,n);return nn(t,e+1,a)||u}function nr(t,e,n,a){const u=nt();return nn(u,Ks(),e)&&(Qn(),sa(Nr(),u,t,e,n,a)),nr}function Fn(t,e,n,a,u,m,v,T,I,O){const H=function bn(t,e,n,a,u,m){const v=zt(t,e,n,a);return zt(t,e+2,u,m)||v}(t,function as(){return gn.lFrame.bindingIndex}(),n,u,v,I);return function Ao(t){const e=gn.lFrame,n=e.bindingIndex;return e.bindingIndex=e.bindingIndex+t,n}(4),H?e+pe(n)+a+pe(u)+m+pe(v)+T+pe(I)+O:Nn}function yn(t,e=mn.Default){const n=nt();return null===n?on(t,e):le(xi(),n,z(t),e)}function Cv(){throw new Error("invalid")}function Jp(t,e,n){const a=nt();return nn(a,Ks(),e)&&function Yo(t,e,n,a,u,m,v,T){const I=Zi(e,n);let N,O=e.inputs;!T&&null!=O&&(N=O[a])?(cl(t,n,N,a,u),Ql(e)&&function zh(t,e){const n=Fi(e,t);16&n[2]||(n[2]|=64)}(n,e.index)):3&e.type&&(a=function Rg(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(a),u=null!=v?v(u,e.value||"",a):u,Sr(m)?m.setProperty(I,a,u):Qa(a)||(I.setProperty?I.setProperty(a,u):I[a]=u))}(Qn(),Nr(),a,t,e,a[11],n,!1),Jp}function Dv(t,e,n,a,u){const v=u?"class":"style";cl(t,n,e.inputs[v],v,a)}function _s(t,e,n,a){const u=nt(),m=Qn(),v=20+t,T=u[11],I=u[v]=vc(T,e,function Ed(){return gn.lFrame.currentNamespace}()),O=m.firstCreatePass?function OT(t,e,n,a,u,m,v){const T=e.consts,O=Ul(e,t,2,u,ss(T,m));return function Ic(t,e,n,a){let u=!1;if(Ku()){const m=function Lp(t,e,n){const a=t.directiveRegistry;let u=null;if(a)for(let m=0;m<a.length;m++){const v=a[m];vg(n,v.selectors,!1)&&(u||(u=[]),re($(n,e),t,v.type),qi(v)?(Fp(t,n),u.unshift(v)):u.push(v))}return u}(t,e,n),v=null===a?null:{"":-1};if(null!==m){u=!0,zp(n,t.data.length,m.length);for(let N=0;N<m.length;N++){const H=m[N];H.providersResolver&&H.providersResolver(H)}let T=!1,I=!1,O=ku(t,e,m.length,null);for(let N=0;N<m.length;N++){const H=m[N];n.mergedAttrs=Js(n.mergedAttrs,H.hostAttrs),Bg(t,n,e,O,H),Ng(O,H,v),null!==H.contentQueries&&(n.flags|=8),(null!==H.hostBindings||null!==H.hostAttrs||0!==H.hostVars)&&(n.flags|=128);const oe=H.type.prototype;!T&&(oe.ngOnChanges||oe.ngOnInit||oe.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n.index),T=!0),!I&&(oe.ngOnChanges||oe.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n.index),I=!0),O++}!function cv(t,e){const a=e.directiveEnd,u=t.data,m=e.attrs,v=[];let T=null,I=null;for(let O=e.directiveStart;O<a;O++){const N=u[O],H=N.inputs,oe=null===m||yg(e)?null:bo(H,m);v.push(oe),T=kg(H,O,T),I=kg(N.outputs,O,I)}null!==T&&(T.hasOwnProperty("class")&&(e.flags|=16),T.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=v,e.inputs=T,e.outputs=I}(t,n)}v&&function zg(t,e,n){if(e){const a=t.localNames=[];for(let u=0;u<e.length;u+=2){const m=n[e[u+1]];if(null==m)throw new Y(-301,!1);a.push(e[u],m)}}}(n,a,v)}return n.mergedAttrs=Js(n.mergedAttrs,n.attrs),u}(e,n,O,ss(T,v)),null!==O.attrs&&Mc(O,O.attrs,!1),null!==O.mergedAttrs&&Mc(O,O.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,O),O}(v,m,u,0,e,n,a):m.data[v];zi(O,!0);const N=O.mergedAttrs;null!==N&&oo(T,I,N);const H=O.classes;null!==H&&na(T,I,H);const oe=O.styles;return null!==oe&&vp(T,I,oe),64!=(64&O.flags)&&Ud(m,u,I,O),0===function gd(){return gn.lFrame.elementDepthCount}()&&xo(I,u),function _d(){gn.lFrame.elementDepthCount++}(),ec(O)&&(function Mp(t,e,n){!Ku()||(function Fg(t,e,n,a){const u=n.directiveStart,m=n.directiveEnd;t.firstCreatePass||$(n,e),xo(a,e);const v=n.initialInputs;for(let T=u;T<m;T++){const I=t.data[T],O=qi(I);O&&uv(e,n,I);const N=$e(e,t,T,n);xo(N,e),null!==v&&Ug(0,T-u,N,I,0,v),O&&(Fi(n.index,e)[8]=N)}}(t,e,n,Zi(n,e)),128==(128&n.flags)&&function ll(t,e,n){const a=n.directiveStart,u=n.directiveEnd,v=n.index,T=function ru(){return gn.lFrame.currentDirectiveIndex}();try{Ys(v);for(let I=a;I<u;I++){const O=t.data[I],N=e[I];qa(I),(null!==O.hostBindings||0!==O.hostVars||null!==O.hostAttrs)&&Op(O,N)}}finally{Ys(-1),qa(T)}}(t,e,n))}(m,u,O),function Ag(t,e,n){if(bl(e)){const u=e.directiveEnd;for(let m=e.directiveStart;m<u;m++){const v=t.data[m];v.contentQueries&&v.contentQueries(1,n[m],m)}}}(m,O,u)),null!==a&&function Ap(t,e,n=Zi){const a=e.localNames;if(null!==a){let u=e.index+1;for(let m=0;m<a.length;m+=2){const v=a[m+1],T=-1===v?n(e,t):t[v];t[u++]=T}}}(u,O),_s}function Bs(){let t=xi();Go()?function Xs(){gn.lFrame.isParent=!1}():(t=t.parent,zi(t,!1));const e=t;!function yd(){gn.lFrame.elementDepthCount--}();const n=Qn();return n.firstCreatePass&&(Za(n,t),bl(t)&&n.queries.elementEnd(t)),null!=e.classesWithoutHost&&function Ja(t){return 0!=(16&t.flags)}(e)&&Dv(n,e,nt(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function ch(t){return 0!=(32&t.flags)}(e)&&Dv(n,e,nt(),e.stylesWithoutHost,!1),Bs}function Lc(t,e,n,a){return _s(t,e,n,a),Bs(),Lc}function t_(t){return!!t&&"function"==typeof t.then}const $0=function V0(t){return!!t&&"function"==typeof t.subscribe};function Qp(t,e,n,a){const u=nt(),m=Qn(),v=xi();return function H0(t,e,n,a,u,m,v,T){const I=ec(a),N=t.firstCreatePass&&jp(t),H=e[8],oe=Up(e);let ce=!0;if(3&a.type||T){const Et=Zi(a,e),Pt=T?T(Et):Et,Je=oe.length,sn=T?Wn=>T(zr(Wn[a.index])):a.index;if(Sr(n)){let Wn=null;if(!T&&I&&(Wn=function zT(t,e,n,a){const u=t.cleanup;if(null!=u)for(let m=0;m<u.length-1;m+=2){const v=u[m];if(v===n&&u[m+1]===a){const T=e[7],I=u[m+2];return T.length>I?T[I]:null}"string"==typeof v&&(m+=2)}return null}(t,e,u,a.index)),null!==Wn)(Wn.__ngLastListenerFn__||Wn).__ngNextListenerFn__=m,Wn.__ngLastListenerFn__=m,ce=!1;else{m=Mv(a,e,H,m,!1);const Ar=n.listen(Pt,u,m);oe.push(m,Ar),N&&N.push(u,sn,Je,Je+1)}}else m=Mv(a,e,H,m,!0),Pt.addEventListener(u,m,v),oe.push(m),N&&N.push(u,sn,Je,v)}else m=Mv(a,e,H,m,!1);const Re=a.outputs;let lt;if(ce&&null!==Re&&(lt=Re[u])){const Et=lt.length;if(Et)for(let Pt=0;Pt<Et;Pt+=2){const da=e[lt[Pt]][lt[Pt+1]].subscribe(m),rd=oe.length;oe.push(m,da),N&&N.push(u,a.index,rd,-(rd+1))}}}(m,u,u[11],v,t,e,!!n,a),Qp}function q0(t,e,n,a){try{return!1!==n(a)}catch(u){return $p(t,u),!1}}function Mv(t,e,n,a,u){return function m(v){if(v===Function)return a;const T=2&t.flags?Fi(t.index,e):e;0==(32&e[2])&&Ma(T);let I=q0(e,0,a,v),O=m.__ngNextListenerFn__;for(;O;)I=q0(e,0,O,v)&&I,O=O.__ngNextListenerFn__;return u&&!1===I&&(v.preventDefault(),v.returnValue=!1),I}}function pl(t,e=""){const n=nt(),a=Qn(),u=t+20,m=a.firstCreatePass?Ul(a,u,1,e,null):a.data[u],v=n[u]=function yc(t,e){return Sr(t)?t.createText(e):t.createTextNode(e)}(n[11],e);Ud(a,n,v,m),zi(m,!1)}function r_(t,e,n){const a=nt(),u=function pr(t,e,n,a){return nn(t,Ks(),n)?e+pe(n)+a:Nn}(a,t,e,n);return u!==Nn&&Aa(a,Ni(),u),r_}function kv(t,e,n,a,u,m,v,T,I){const O=nt(),N=Fn(O,t,e,n,a,u,m,v,T,I);return N!==Nn&&Aa(O,Ni(),N),kv}const i_="en-US";let Nb=i_;class c1{}class ID{resolveComponentFactory(e){throw function SD(t){const e=Error(`No component factory found for ${Kn(t)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=t,e}(e)}}let om=(()=>{class t{}return t.NULL=new ID,t})();function MD(){return bf(xi(),nt())}function bf(t,e){return new Nu(Zi(t,e))}let Nu=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=MD,t})();function AD(t){return t instanceof Nu?t.nativeElement:t}class h1{}let c_=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>function kD(){const t=nt(),n=Fi(xi().index,t);return function PD(t){return t[11]}(Mo(n)?n:t)}(),t})(),RD=(()=>{class t{}return t.\u0275prov=hn({token:t,providedIn:"root",factory:()=>null}),t})();class u_{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const OD=new u_("13.3.4"),Bv={};function h_(t,e,n,a,u=!1){for(;null!==n;){const m=e[n.index];if(null!==m&&a.push(zr(m)),go(m))for(let T=10;T<m.length;T++){const I=m[T],O=I[1].firstChild;null!==O&&h_(I[1],I,O,a)}const v=n.type;if(8&v)h_(t,e,n.child,a);else if(32&v){const T=zd(n,e);let I;for(;I=T();)a.push(I)}else if(16&v){const T=Su(e,n);if(Array.isArray(T))a.push(...T);else{const I=Ih(e[16]);h_(I[1],I,T,a,!0)}}n=u?n.projectionNext:n.next}return a}class sm{constructor(e,n){this._lView=e,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,n=e[1];return h_(n,e,n.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(go(e)){const n=e[8],a=n?n.indexOf(this):-1;a>-1&&(pp(e,a),Os(n,a))}this._attachedToViewContainer=!1}hg(this._lView[1],this._lView)}onDestroy(e){Pp(this._lView[1],this._lView,null,e)}markForCheck(){Ma(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){uf(this._lView[1],this._lView,this.context)}checkNoChanges(){!function Bp(t,e,n){va(!0);try{uf(t,e,n)}finally{va(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Y(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Fy(t,e){Iu(t,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Y(902,"");this._appRef=e}}class LD extends sm{constructor(e){super(e),this._view=e}detectChanges(){Np(this._view)}checkNoChanges(){!function dv(t){va(!0);try{Np(t)}finally{va(!1)}}(this._view)}get context(){return null}}class d1 extends om{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const n=fr(e);return new Uv(n,this.ngModule)}}function f1(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}class Uv extends c1{constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=function Ky(t){return t.map(Xy).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return f1(this.componentDef.inputs)}get outputs(){return f1(this.componentDef.outputs)}create(e,n,a,u){const m=(u=u||this.ngModule)?function zD(t,e){return{get:(n,a,u)=>{const m=t.get(n,Bv,u);return m!==Bv||a===Bv?m:e.get(n,a,u)}}}(e,u.injector):e,v=m.get(h1,eu),T=m.get(RD,null),I=v.createRenderer(null,this.componentDef),O=this.componentDef.selectors[0][0]||"div",N=a?function Pg(t,e,n){if(Sr(t))return t.selectRootElement(e,n===Mi.ShadowDom);let a="string"==typeof e?t.querySelector(e):e;return a.textContent="",a}(I,a,this.componentDef.encapsulation):vc(v.createRenderer(null,this.componentDef),O,function FD(t){const e=t.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(O)),H=this.componentDef.onPush?576:528,oe=function U(t,e){return{components:[],scheduler:t||cp,clean:$g,playerHandler:e||null,flags:0}}(),ce=of(0,null,null,1,0,null,null,null,null,null),Re=Cc(null,ce,oe,H,null,null,v,I,T,m);let lt,Et;sc(Re);try{const Pt=function k(t,e,n,a,u,m){const v=n[1];n[20]=t;const I=Ul(v,20,2,"#host",null),O=I.mergedAttrs=e.hostAttrs;null!==O&&(Mc(I,O,!0),null!==t&&(oo(u,t,O),null!==I.classes&&na(u,t,I.classes),null!==I.styles&&vp(u,t,I.styles)));const N=a.createRenderer(t,e),H=Cc(n,rf(e),null,e.onPush?64:16,n[20],I,a,N,m||null,null);return v.firstCreatePass&&(re($(I,n),v,e.type),Fp(v,I),zp(I,n.length,1)),ps(n,H),n[20]=H}(N,this.componentDef,Re,v,I);if(N)if(a)oo(I,N,["ng-version",OD.full]);else{const{attrs:Je,classes:sn}=function xp(t){const e=[],n=[];let a=1,u=2;for(;a<t.length;){let m=t[a];if("string"==typeof m)2===u?""!==m&&e.push(m,t[++a]):8===u&&n.push(m);else{if(!ra(u))break;u=m}a++}return{attrs:e,classes:n}}(this.componentDef.selectors[0]);Je&&oo(I,N,Je),sn&&sn.length>0&&na(I,N,sn.join(" "))}if(Et=rc(ce,20),void 0!==n){const Je=Et.projection=[];for(let sn=0;sn<this.ngContentSelectors.length;sn++){const Wn=n[sn];Je.push(null!=Wn?Array.from(Wn):null)}}lt=function F(t,e,n,a,u){const m=n[1],v=function kp(t,e,n){const a=xi();t.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),Bg(t,a,e,ku(t,e,1,null),n));const u=$e(e,t,a.directiveStart,a);xo(u,e);const m=Zi(a,e);return m&&xo(m,e),u}(m,n,e);if(a.components.push(v),t[8]=v,u&&u.forEach(I=>I(v,e)),e.contentQueries){const I=xi();e.contentQueries(1,v,I.directiveStart)}const T=xi();return!m.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(Ys(T.index),Lg(n[1],T,0,T.directiveStart,T.directiveEnd,e),Op(e,v)),v}(Pt,this.componentDef,Re,oe,[G]),Dc(ce,Re,null)}finally{ac()}return new BD(this.componentType,lt,bf(Et,Re),Re,Et)}}class BD extends class DD{}{constructor(e,n,a,u,m){super(),this.location=a,this._rootLView=u,this._tNode=m,this.instance=n,this.hostView=this.changeDetectorRef=new LD(u),this.componentType=e}get injector(){return new at(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}class Fc{}class p1{}const wf=new Map;class _1 extends Fc{constructor(e,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new d1(this);const a=Ce(e);this._bootstrapComponents=Ca(a.bootstrap),this._r3Injector=Uh(e,n,[{provide:Fc,useValue:this},{provide:om,useValue:this.componentFactoryResolver}],Kn(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,n=Vi.THROW_IF_NOT_FOUND,a=mn.Default){return e===Vi||e===Fc||e===Nh?this:this._r3Injector.get(e,n,a)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class jv extends p1{constructor(e){super(),this.moduleType=e,null!==Ce(e)&&function jD(t){const e=new Set;!function n(a){const u=Ce(a,!0),m=u.id;null!==m&&(function m1(t,e,n){if(e&&e!==n)throw new Error(`Duplicate module registered for ${t} - ${Kn(e)} vs ${Kn(e.name)}`)}(m,wf.get(m),a),wf.set(m,a));const v=Ca(u.imports);for(const T of v)e.has(T)||(e.add(T),n(T))}(t)}(e)}create(e){return new _1(this.moduleType,e)}}function Vv(t,e,n){const a=function mi(){const t=gn.lFrame;let e=t.bindingRootIndex;return-1===e&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}()+t,u=nt();return u[a]===Nn?function xn(t,e,n){return t[e]=n}(u,a,n?e.call(n):e()):function ln(t,e){return t[e]}(u,a)}function $v(t){return e=>{setTimeout(t,void 0,e)}}const vs=class iS extends Tt{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,n,a){var u,m,v;let T=e,I=n||(()=>null),O=a;if(e&&"object"==typeof e){const H=e;T=null===(u=H.next)||void 0===u?void 0:u.bind(H),I=null===(m=H.error)||void 0===m?void 0:m.bind(H),O=null===(v=H.complete)||void 0===v?void 0:v.bind(H)}this.__isAsync&&(I=$v(I),T&&(T=$v(T)),O&&(O=$v(O)));const N=super.subscribe({next:T,error:I,complete:O});return e instanceof ae&&e.add(N),N}};function oS(){return this._results[He()]()}class Gv{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=He(),a=Gv.prototype;a[n]||(a[n]=oS)}get changes(){return this._changes||(this._changes=new vs)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,n){return this._results.reduce(e,n)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,n){const a=this;a.dirty=!1;const u=ni(e);(this._changesDetected=!function Zr(t,e,n){if(t.length!==e.length)return!1;for(let a=0;a<t.length;a++){let u=t[a],m=e[a];if(n&&(u=n(u),m=n(m)),m!==u)return!1}return!0}(a._results,u,n))&&(a._results=u,a.length=u.length,a.last=u[this.length-1],a.first=u[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let zc=(()=>{class t{}return t.__NG_ELEMENT_ID__=lS,t})();const sS=zc,aS=class extends sS{constructor(e,n,a){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=a}createEmbeddedView(e){const n=this._declarationTContainer.tViews,a=Cc(this._declarationLView,n,e,16,null,n.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const m=this._declarationLView[19];return null!==m&&(a[19]=m.createEmbeddedView(n)),Dc(n,a,e),new sm(a)}};function lS(){return d_(xi(),nt())}function d_(t,e){return 4&t.type?new aS(e,t,bf(t,e)):null}let Pa=(()=>{class t{}return t.__NG_ELEMENT_ID__=cS,t})();function cS(){return C1(xi(),nt())}const uS=Pa,E1=class extends uS{constructor(e,n,a){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=a}get element(){return bf(this._hostTNode,this._hostLView)}get injector(){return new at(this._hostTNode,this._hostLView)}get parentInjector(){const e=V(this._hostTNode,this._hostLView);if(i(e)){const n=b(e,this._hostLView),a=h(e);return new at(n[1].data[a+8],n)}return new at(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const n=T1(this._lContainer);return null!==n&&n[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,n,a){const u=e.createEmbeddedView(n||{});return this.insert(u,a),u}createComponent(e,n,a,u,m){const v=e&&!function qr(t){return"function"==typeof t}(e);let T;if(v)T=n;else{const H=n||{};T=H.index,a=H.injector,u=H.projectableNodes,m=H.ngModuleRef}const I=v?e:new Uv(fr(e)),O=a||this.parentInjector;if(!m&&null==I.ngModule){const oe=(v?O:this.parentInjector).get(Fc,null);oe&&(m=oe)}const N=I.create(O,u,void 0,m);return this.insert(N.hostView,T),N}insert(e,n){const a=e._lView,u=a[1];if(function Xu(t){return go(t[3])}(a)){const N=this.indexOf(e);if(-1!==N)this.detach(N);else{const H=a[3],oe=new E1(H,H[6],H[3]);oe.detach(oe.indexOf(e))}}const m=this._adjustIndex(n),v=this._lContainer;!function Ny(t,e,n,a){const u=10+a,m=n.length;a>0&&(n[u-1][4]=e),a<m-10?(e[4]=n[u],vo(n,10+a,e)):(n.push(e),e[4]=null),e[3]=n;const v=e[17];null!==v&&n!==v&&function By(t,e){const n=t[9];e[16]!==e[3][3][16]&&(t[2]=!0),null===n?t[9]=[e]:n.push(e)}(v,e);const T=e[19];null!==T&&T.insertView(t),e[2]|=128}(u,a,v,m);const T=_p(m,v),I=a[11],O=Ah(I,v[7]);return null!==O&&function cg(t,e,n,a,u,m){a[0]=u,a[6]=e,Iu(t,a,n,1,u,m)}(u,v[6],I,a,O,T),e.attachToViewContainerRef(),vo(Hv(v),m,e),e}move(e,n){return this.insert(e,n)}indexOf(e){const n=T1(this._lContainer);return null!==n?n.indexOf(e):-1}remove(e){const n=this._adjustIndex(e,-1),a=pp(this._lContainer,n);a&&(Os(Hv(this._lContainer),n),hg(a[1],a))}detach(e){const n=this._adjustIndex(e,-1),a=pp(this._lContainer,n);return a&&null!=Os(Hv(this._lContainer),n)?new sm(a):null}_adjustIndex(e,n=0){return null==e?this.length+n:e}};function T1(t){return t[8]}function Hv(t){return t[8]||(t[8]=[])}function C1(t,e){let n;const a=e[t.index];if(go(a))n=a;else{let u;if(8&t.type)u=zr(a);else{const m=e[11];u=m.createComment("");const v=Zi(t,e);xc(m,Ah(m,v),u,function Vy(t,e){return Sr(t)?t.nextSibling(e):e.nextSibling}(m,v),!1)}e[t.index]=n=function jl(t,e,n,a){return new Array(t,!0,!1,e,null,0,a,n,null,null)}(a,e,u,t),ps(e,n)}return new E1(n,t,e)}class qv{constructor(e){this.queryList=e,this.matches=null}clone(){return new qv(this.queryList)}setDirty(){this.queryList.setDirty()}}class Zv{constructor(e=[]){this.queries=e}createEmbeddedView(e){const n=e.queries;if(null!==n){const a=null!==e.contentQueries?e.contentQueries[0]:n.length,u=[];for(let m=0;m<a;m++){const v=n.getByIndex(m);u.push(this.queries[v.indexInDeclarationView].clone())}return new Zv(u)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let n=0;n<this.queries.length;n++)null!==P1(e,n).matches&&this.queries[n].setDirty()}}class D1{constructor(e,n,a=null){this.predicate=e,this.flags=n,this.read=a}}class Wv{constructor(e=[]){this.queries=e}elementStart(e,n){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(e,n)}elementEnd(e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(e)}embeddedTView(e){let n=null;for(let a=0;a<this.length;a++){const u=null!==n?n.length:0,m=this.getByIndex(a).embeddedTView(e,u);m&&(m.indexInDeclarationView=a,null!==n?n.push(m):n=[m])}return null!==n?new Wv(n):null}template(e,n){for(let a=0;a<this.queries.length;a++)this.queries[a].template(e,n)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Xv{constructor(e,n=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(e,n){this.isApplyingToNode(n)&&this.matchTNode(e,n)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,n){this.elementStart(e,n)}embeddedTView(e,n){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,n),new Xv(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let a=e.parent;for(;null!==a&&8&a.type&&a.index!==n;)a=a.parent;return n===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(e,n){const a=this.metadata.predicate;if(Array.isArray(a))for(let u=0;u<a.length;u++){const m=a[u];this.matchTNodeWithReadOption(e,n,fS(n,m)),this.matchTNodeWithReadOption(e,n,ze(n,e,m,!1,!1))}else a===zc?4&n.type&&this.matchTNodeWithReadOption(e,n,-1):this.matchTNodeWithReadOption(e,n,ze(n,e,a,!1,!1))}matchTNodeWithReadOption(e,n,a){if(null!==a){const u=this.metadata.read;if(null!==u)if(u===Nu||u===Pa||u===zc&&4&n.type)this.addMatch(n.index,-2);else{const m=ze(n,e,u,!1,!1);null!==m&&this.addMatch(n.index,m)}else this.addMatch(n.index,a)}}addMatch(e,n){null===this.matches?this.matches=[e,n]:this.matches.push(e,n)}}function fS(t,e){const n=t.localNames;if(null!==n)for(let a=0;a<n.length;a+=2)if(n[a]===e)return n[a+1];return null}function mS(t,e,n,a){return-1===n?function pS(t,e){return 11&t.type?bf(t,e):4&t.type?d_(t,e):null}(e,t):-2===n?function gS(t,e,n){return n===Nu?bf(e,t):n===zc?d_(e,t):n===Pa?C1(e,t):void 0}(t,e,a):$e(t,t[1],n,e)}function S1(t,e,n,a){const u=e[19].queries[a];if(null===u.matches){const m=t.data,v=n.matches,T=[];for(let I=0;I<v.length;I+=2){const O=v[I];T.push(O<0?null:mS(e,m[O],v[I+1],n.metadata.read))}u.matches=T}return u.matches}function Kv(t,e,n,a){const u=t.queries.getByIndex(n),m=u.matches;if(null!==m){const v=S1(t,e,u,n);for(let T=0;T<m.length;T+=2){const I=m[T];if(I>0)a.push(v[T/2]);else{const O=m[T+1],N=e[-I];for(let H=10;H<N.length;H++){const oe=N[H];oe[17]===oe[3]&&Kv(oe[1],oe,O,a)}if(null!==N[9]){const H=N[9];for(let oe=0;oe<H.length;oe++){const ce=H[oe];Kv(ce[1],ce,O,a)}}}}}return a}function f_(t){const e=nt(),n=Qn(),a=th();iu(a+1);const u=P1(n,a);if(t.dirty&&Ws(e)===(2==(2&u.metadata.flags))){if(null===u.matches)t.reset([]);else{const m=u.crossesNgTemplate?Kv(n,e,a,[]):S1(n,e,u,a);t.reset(m,AD),t.notifyOnChanges()}return!0}return!1}function Yv(t,e,n,a){const u=Qn();if(u.firstCreatePass){const m=xi();A1(u,new D1(e,n,a),m.index),function yS(t,e){const n=t.contentQueries||(t.contentQueries=[]);e!==(n.length?n[n.length-1]:-1)&&n.push(t.queries.length-1,e)}(u,t),2==(2&n)&&(u.staticContentQueries=!0)}M1(u,nt(),n)}function p_(){return function _S(t,e){return t[19].queries[e].queryList}(nt(),th())}function M1(t,e,n){const a=new Gv(4==(4&n));Pp(t,e,a,a.destroy),null===e[19]&&(e[19]=new Zv),e[19].queries.push(new qv(a))}function A1(t,e,n){null===t.queries&&(t.queries=new Wv),t.queries.track(new Xv(e,n))}function P1(t,e){return t.queries.getByIndex(e)}function __(...t){}const y_=new Vt("Application Initializer");let rx=(()=>{class t{constructor(n){this.appInits=n,this.resolve=__,this.reject=__,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,u)=>{this.resolve=a,this.reject=u})}runInitializers(){if(this.initialized)return;const n=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let u=0;u<this.appInits.length;u++){const m=this.appInits[u]();if(t_(m))n.push(m);else if($0(m)){const v=new Promise((T,I)=>{m.subscribe({complete:T,error:I})});n.push(v)}}Promise.all(n).then(()=>{a()}).catch(u=>{this.reject(u)}),0===n.length&&a(),this.initialized=!0}}return t.\u0275fac=function(n){return new(n||t)(on(y_,8))},t.\u0275prov=hn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const um=new Vt("AppId",{providedIn:"root",factory:function W1(){return`${ix()}${ix()}${ix()}`}});function ix(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const X1=new Vt("Platform Initializer"),hm=new Vt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),K1=new Vt("appBootstrapListener");let FS=(()=>{class t{log(n){console.log(n)}warn(n){console.warn(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=hn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const Bu=new Vt("LocaleId",{providedIn:"root",factory:()=>ri(Bu,mn.Optional|mn.SkipSelf)||function zS(){return"undefined"!=typeof $localize&&$localize.locale||i_}()});class BS{constructor(e,n){this.ngModuleFactory=e,this.componentFactories=n}}let Y1=(()=>{class t{compileModuleSync(n){return new jv(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const a=this.compileModuleSync(n),m=Ca(Ce(n).declarations).reduce((v,T)=>{const I=fr(T);return I&&v.push(new Uv(I)),v},[]);return new BS(a,m)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=hn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const jS=(()=>Promise.resolve(0))();function ox(t){"undefined"==typeof Zone?jS.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class To{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new vs(!1),this.onMicrotaskEmpty=new vs(!1),this.onStable=new vs(!1),this.onError=new vs(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!a&&n,u.shouldCoalesceRunChangeDetection=a,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function VS(){let t=An.requestAnimationFrame,e=An.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&e){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const a=e[Zone.__symbol__("OriginalDelegate")];a&&(e=a)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function HS(t){const e=()=>{!function GS(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(An,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,ax(t),t.isCheckStableRunning=!0,sx(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),ax(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,a,u,m,v,T)=>{try{return J1(t),n.invokeTask(u,m,v,T)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===m.type||t.shouldCoalesceRunChangeDetection)&&e(),Q1(t)}},onInvoke:(n,a,u,m,v,T,I)=>{try{return J1(t),n.invoke(u,m,v,T,I)}finally{t.shouldCoalesceRunChangeDetection&&e(),Q1(t)}},onHasTask:(n,a,u,m)=>{n.hasTask(u,m),a===u&&("microTask"==m.change?(t._hasPendingMicrotasks=m.microTask,ax(t),sx(t)):"macroTask"==m.change&&(t.hasPendingMacrotasks=m.macroTask))},onHandleError:(n,a,u,m)=>(n.handleError(u,m),t.runOutsideAngular(()=>t.onError.emit(m)),!1)})}(u)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!To.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(To.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,n,a){return this._inner.run(e,n,a)}runTask(e,n,a,u){const m=this._inner,v=m.scheduleEventTask("NgZoneEvent: "+u,e,$S,__,__);try{return m.runTask(v,n,a)}finally{m.cancelTask(v)}}runGuarded(e,n,a){return this._inner.runGuarded(e,n,a)}runOutsideAngular(e){return this._outer.run(e)}}const $S={};function sx(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function ax(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function J1(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Q1(t){t._nesting--,sx(t)}class qS{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new vs,this.onMicrotaskEmpty=new vs,this.onStable=new vs,this.onError=new vs}run(e,n,a){return e.apply(n,a)}runGuarded(e,n,a){return e.apply(n,a)}runOutsideAngular(e){return e()}runTask(e,n,a,u){return e.apply(n,a)}}let lx=(()=>{class t{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{To.assertNotInAngularZone(),ox(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())ox(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(n)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,a,u){let m=-1;a&&a>0&&(m=setTimeout(()=>{this._callbacks=this._callbacks.filter(v=>v.timeoutId!==m),n(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:n,timeoutId:m,updateCb:u})}whenStable(n,a,u){if(u&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,a,u),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,a,u){return[]}}return t.\u0275fac=function(n){return new(n||t)(on(To))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})(),ZS=(()=>{class t{constructor(){this._applications=new Map,cx.addToWindow(this)}registerApplication(n,a){this._applications.set(n,a)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,a=!0){return cx.findTestabilityInTree(this,n,a)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=hn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();class WS{addToWindow(e){}findTestabilityInTree(e,n,a){return null}}let cx=new WS,Wh=null;const ew=new Vt("AllowMultipleToken"),tw=new Vt("PlatformOnDestroy");class nw{constructor(e,n){this.name=e,this.token=n}}function rw(t,e,n=[]){const a=`Platform: ${e}`,u=new Vt(a);return(m=[])=>{let v=ux();if(!v||v.injector.get(ew,!1)){const T=[...n,...m,{provide:u,useValue:!0}];t?t(T):function JS(t){if(Wh&&!Wh.get(ew,!1))throw new Y(400,"");Wh=t;const e=t.get(iw),n=t.get(X1,null);n&&n.forEach(a=>a())}(function eI(t=[],e){return Vi.create({name:e,providers:[{provide:Bh,useValue:"platform"},{provide:tw,useValue:()=>Wh=null},...t]})}(T,a))}return function QS(t){const e=ux();if(!e)throw new Y(401,"");return e}()}}function ux(){var t;return null!==(t=null==Wh?void 0:Wh.get(iw))&&void 0!==t?t:null}let iw=(()=>{class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,a){const T=function tI(t,e){let n;return n="noop"===t?new qS:("zone.js"===t?void 0:t)||new To({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),n}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),I=[{provide:To,useValue:T}];return T.run(()=>{const O=Vi.create({providers:I,parent:this.injector,name:n.moduleType.name}),N=n.create(O),H=N.injector.get(bu,null);if(!H)throw new Y(402,"");return T.runOutsideAngular(()=>{const oe=T.onError.subscribe({next:ce=>{H.handleError(ce)}});N.onDestroy(()=>{hx(this._modules,N),oe.unsubscribe()})}),function nI(t,e,n){try{const a=n();return t_(a)?a.catch(u=>{throw e.runOutsideAngular(()=>t.handleError(u)),u}):a}catch(a){throw e.runOutsideAngular(()=>t.handleError(a)),a}}(H,T,()=>{const oe=N.injector.get(rx);return oe.runInitializers(),oe.donePromise.then(()=>(function AC(t){an(t,"Expected localeId to be defined"),"string"==typeof t&&(Nb=t.toLowerCase().replace(/_/g,"-"))}(N.injector.get(Bu,i_)||i_),this._moduleDoBootstrap(N),N))})})}bootstrapModule(n,a=[]){const u=ow({},a);return function KS(t,e,n){const a=new jv(n);return Promise.resolve(a)}(0,0,n).then(m=>this.bootstrapModuleFactory(m,u))}_moduleDoBootstrap(n){const a=n.injector.get(v_);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(u=>a.bootstrap(u));else{if(!n.instance.ngDoBootstrap)throw new Y(403,"");n.instance.ngDoBootstrap(a)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Y(404,"");this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a());const n=this._injector.get(tw,null);null==n||n(),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(n){return new(n||t)(on(Vi))},t.\u0275prov=hn({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();function ow(t,e){return Array.isArray(e)?e.reduce(ow,t):Object.assign(Object.assign({},t),e)}let v_=(()=>{class t{constructor(n,a,u,m){this._zone=n,this._injector=a,this._exceptionHandler=u,this._initStatus=m,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const v=new gt(I=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{I.next(this._stable),I.complete()})}),T=new gt(I=>{let O;this._zone.runOutsideAngular(()=>{O=this._zone.onStable.subscribe(()=>{To.assertNotInAngularZone(),ox(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,I.next(!0))})})});const N=this._zone.onUnstable.subscribe(()=>{To.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{I.next(!1)}))});return()=>{O.unsubscribe(),N.unsubscribe()}});this.isStable=Qi(v,T.pipe(function $r(){return t=>Bo()(Ii(_i)(t))}()))}bootstrap(n,a){if(!this._initStatus.done)throw new Y(405,"");let u;u=n instanceof c1?n:this._injector.get(om).resolveComponentFactory(n),this.componentTypes.push(u.componentType);const m=function YS(t){return t.isBoundToModule}(u)?void 0:this._injector.get(Fc),T=u.create(Vi.NULL,[],a||u.selector,m),I=T.location.nativeElement,O=T.injector.get(lx,null),N=O&&T.injector.get(ZS);return O&&N&&N.registerApplication(I,O),T.onDestroy(()=>{this.detachView(T.hostView),hx(this.components,T),N&&N.unregisterApplication(I)}),this._loadComponent(T),T}tick(){if(this._runningTick)throw new Y(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const a=n;this._views.push(a),a.attachToAppRef(this)}detachView(n){const a=n;hx(this._views,a),a.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(K1,[]).concat(this._bootstrapListeners).forEach(u=>u(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(n){return new(n||t)(on(To),on(Vi),on(bu),on(rx))},t.\u0275prov=hn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function hx(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}let aw=!0,dx=(()=>{class t{}return t.__NG_ELEMENT_ID__=oI,t})();function oI(t){return function sI(t,e,n){if(Ql(t)&&!n){const a=Fi(t.index,e);return new sm(a,a)}return 47&t.type?new sm(e[16],e):null}(xi(),nt(),16==(16&t))}const vI=rw(null,"core",[]);let xI=(()=>{class t{constructor(n){}}return t.\u0275fac=function(n){return new(n||t)(on(v_))},t.\u0275mod=oi({type:t}),t.\u0275inj=br({}),t})(),E_=null;function Uu(){return E_}const ca=new Vt("DocumentToken");let Kh=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=hn({token:t,factory:function(){return function TI(){return on(yw)}()},providedIn:"platform"}),t})();const CI=new Vt("Location Initialized");let yw=(()=>{class t extends Kh{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Uu().getBaseHref(this._doc)}onPopState(n){const a=Uu().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",n,!1),()=>a.removeEventListener("popstate",n)}onHashChange(n){const a=Uu().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",n,!1),()=>a.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,a,u){vw()?this._history.pushState(n,a,u):this.location.hash=u}replaceState(n,a,u){vw()?this._history.replaceState(n,a,u):this.location.hash=u}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return t.\u0275fac=function(n){return new(n||t)(on(ca))},t.\u0275prov=hn({token:t,factory:function(){return function DI(){return new yw(on(ca))}()},providedIn:"platform"}),t})();function vw(){return!!window.history.pushState}function _x(t,e){if(0==t.length)return e;if(0==e.length)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e}function xw(t){const e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)}function Nc(t){return t&&"?"!==t[0]?"?"+t:t}let Tf=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=hn({token:t,factory:function(){return function SI(t){const e=on(ca).location;return new bw(on(Kh),e&&e.origin||"")}()},providedIn:"root"}),t})();const yx=new Vt("appBaseHref");let bw=(()=>{class t extends Tf{constructor(n,a){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==a&&(a=this._platformLocation.getBaseHrefFromDOM()),null==a)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=a}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return _x(this._baseHref,n)}path(n=!1){const a=this._platformLocation.pathname+Nc(this._platformLocation.search),u=this._platformLocation.hash;return u&&n?`${a}${u}`:a}pushState(n,a,u,m){const v=this.prepareExternalUrl(u+Nc(m));this._platformLocation.pushState(n,a,v)}replaceState(n,a,u,m){const v=this.prepareExternalUrl(u+Nc(m));this._platformLocation.replaceState(n,a,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var a,u;null===(u=(a=this._platformLocation).historyGo)||void 0===u||u.call(a,n)}}return t.\u0275fac=function(n){return new(n||t)(on(Kh),on(yx,8))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})(),II=(()=>{class t extends Tf{constructor(n,a){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=a&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let a=this._platformLocation.hash;return null==a&&(a="#"),a.length>0?a.substring(1):a}prepareExternalUrl(n){const a=_x(this._baseHref,n);return a.length>0?"#"+a:a}pushState(n,a,u,m){let v=this.prepareExternalUrl(u+Nc(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.pushState(n,a,v)}replaceState(n,a,u,m){let v=this.prepareExternalUrl(u+Nc(m));0==v.length&&(v=this._platformLocation.pathname),this._platformLocation.replaceState(n,a,v)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var a,u;null===(u=(a=this._platformLocation).historyGo)||void 0===u||u.call(a,n)}}return t.\u0275fac=function(n){return new(n||t)(on(Kh),on(yx,8))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})(),vx=(()=>{class t{constructor(n,a){this._subject=new vs,this._urlChangeListeners=[],this._platformStrategy=n;const u=this._platformStrategy.getBaseHref();this._platformLocation=a,this._baseHref=xw(ww(u)),this._platformStrategy.onPopState(m=>{this._subject.emit({url:this.path(!0),pop:!0,state:m.state,type:m.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,a=""){return this.path()==this.normalize(n+Nc(a))}normalize(n){return t.stripTrailingSlash(function AI(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,ww(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,a="",u=null){this._platformStrategy.pushState(u,"",n,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Nc(a)),u)}replaceState(n,a="",u=null){this._platformStrategy.replaceState(u,"",n,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Nc(a)),u)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){var a,u;null===(u=(a=this._platformStrategy).historyGo)||void 0===u||u.call(a,n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)}))}_notifyUrlChangeListeners(n="",a){this._urlChangeListeners.forEach(u=>u(n,a))}subscribe(n,a,u){return this._subject.subscribe({next:n,error:a,complete:u})}}return t.normalizeQueryParams=Nc,t.joinWithSlash=_x,t.stripTrailingSlash=xw,t.\u0275fac=function(n){return new(n||t)(on(Tf),on(Kh))},t.\u0275prov=hn({token:t,factory:function(){return function MI(){return new vx(on(Tf),on(Kh))}()},providedIn:"root"}),t})();function ww(t){return t.replace(/\/index.html$/,"")}function Pw(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const a=n.indexOf("="),[u,m]=-1==a?[n,""]:[n.slice(0,a),n.slice(a+1)];if(u.trim()===e)return decodeURIComponent(m)}return null}let HM=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=oi({type:t}),t.\u0275inj=br({}),t})();const Fw="browser";function zw(t){return t===Fw}let XM=(()=>{class t{}return t.\u0275prov=hn({token:t,providedIn:"root",factory:()=>new KM(on(ca),window)}),t})();class KM{constructor(e,n){this.document=e,this.window=n,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const n=function YM(t,e){const n=t.getElementById(e)||t.getElementsByName(e)[0];if(n)return n;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const a=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let u=a.currentNode;for(;u;){const m=u.shadowRoot;if(m){const v=m.getElementById(e)||m.querySelector(`[name="${e}"]`);if(v)return v}u=a.nextNode()}}return null}(this.document,e);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=e)}}scrollToElement(e){const n=e.getBoundingClientRect(),a=n.left+this.window.pageXOffset,u=n.top+this.window.pageYOffset,m=this.offset();this.window.scrollTo(a-m[0],u-m[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=Nw(this.window.history)||Nw(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function Nw(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class Bw{}class Rx extends class JM extends class EI{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function wI(t){E_||(E_=t)}(new Rx)}onAndCancel(e,n,a){return e.addEventListener(n,a,!1),()=>{e.removeEventListener(n,a,!1)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return(n=n||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return"window"===n?window:"document"===n?e:"body"===n?e.body:null}getBaseHref(e){const n=function QM(){return mm=mm||document.querySelector("base"),mm?mm.getAttribute("href"):null}();return null==n?null:function eA(t){R_=R_||document.createElement("a"),R_.setAttribute("href",t);const e=R_.pathname;return"/"===e.charAt(0)?e:`/${e}`}(n)}resetBaseElement(){mm=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Pw(document.cookie,e)}}let R_,mm=null;const Uw=new Vt("TRANSITION_ID"),nA=[{provide:y_,useFactory:function tA(t,e,n){return()=>{n.get(rx).donePromise.then(()=>{const a=Uu(),u=e.querySelectorAll(`style[ng-transition="${t}"]`);for(let m=0;m<u.length;m++)a.remove(u[m])})}},deps:[Uw,ca,Vi],multi:!0}];class Ox{static init(){!function XS(t){cx=t}(new Ox)}addToWindow(e){An.getAngularTestability=(a,u=!0)=>{const m=e.findTestabilityInTree(a,u);if(null==m)throw new Error("Could not find testability for element.");return m},An.getAllAngularTestabilities=()=>e.getAllTestabilities(),An.getAllAngularRootElements=()=>e.getAllRootElements(),An.frameworkStabilizers||(An.frameworkStabilizers=[]),An.frameworkStabilizers.push(a=>{const u=An.getAllAngularTestabilities();let m=u.length,v=!1;const T=function(I){v=v||I,m--,0==m&&a(v)};u.forEach(function(I){I.whenStable(T)})})}findTestabilityInTree(e,n,a){if(null==n)return null;const u=e.getTestability(n);return null!=u?u:a?Uu().isShadowRoot(n)?this.findTestabilityInTree(e,n.host,!0):this.findTestabilityInTree(e,n.parentElement,!0):null}}let rA=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();const O_=new Vt("EventManagerPlugins");let L_=(()=>{class t{constructor(n,a){this._zone=a,this._eventNameToPlugin=new Map,n.forEach(u=>u.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,a,u){return this._findPluginFor(a).addEventListener(n,a,u)}addGlobalEventListener(n,a,u){return this._findPluginFor(a).addGlobalEventListener(n,a,u)}getZone(){return this._zone}_findPluginFor(n){const a=this._eventNameToPlugin.get(n);if(a)return a;const u=this._plugins;for(let m=0;m<u.length;m++){const v=u[m];if(v.supports(n))return this._eventNameToPlugin.set(n,v),v}throw new Error(`No event manager plugin found for event ${n}`)}}return t.\u0275fac=function(n){return new(n||t)(on(O_),on(To))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();class jw{constructor(e){this._doc=e}addGlobalEventListener(e,n,a){const u=Uu().getGlobalEventTarget(this._doc,e);if(!u)throw new Error(`Unsupported event target ${u} for event ${n}`);return this.addEventListener(u,n,a)}}let Vw=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(n){const a=new Set;n.forEach(u=>{this._stylesSet.has(u)||(this._stylesSet.add(u),a.add(u))}),this.onStylesAdded(a)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})(),gm=(()=>{class t extends Vw{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,a,u){n.forEach(m=>{const v=this._doc.createElement("style");v.textContent=m,u.push(a.appendChild(v))})}addHost(n){const a=[];this._addStylesToHost(this._stylesSet,n,a),this._hostNodes.set(n,a)}removeHost(n){const a=this._hostNodes.get(n);a&&a.forEach($w),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((a,u)=>{this._addStylesToHost(n,u,a)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach($w))}}return t.\u0275fac=function(n){return new(n||t)(on(ca))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();function $w(t){Uu().remove(t)}const Lx={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Fx=/%COMP%/g;function F_(t,e,n){for(let a=0;a<e.length;a++){let u=e[a];Array.isArray(u)?F_(t,u,n):(u=u.replace(Fx,t),n.push(u))}return n}function qw(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let zx=(()=>{class t{constructor(n,a,u){this.eventManager=n,this.sharedStylesHost=a,this.appId=u,this.rendererByCompId=new Map,this.defaultRenderer=new Nx(n)}createRenderer(n,a){if(!n||!a)return this.defaultRenderer;switch(a.encapsulation){case Mi.Emulated:{let u=this.rendererByCompId.get(a.id);return u||(u=new cA(this.eventManager,this.sharedStylesHost,a,this.appId),this.rendererByCompId.set(a.id,u)),u.applyToHost(n),u}case 1:case Mi.ShadowDom:return new uA(this.eventManager,this.sharedStylesHost,n,a);default:if(!this.rendererByCompId.has(a.id)){const u=F_(a.id,a.styles,[]);this.sharedStylesHost.addStyles(u),this.rendererByCompId.set(a.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(n){return new(n||t)(on(L_),on(gm),on(um))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();class Nx{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,n){return n?document.createElementNS(Lx[n]||n,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,n){e.appendChild(n)}insertBefore(e,n,a){e&&e.insertBefore(n,a)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let a="string"==typeof e?document.querySelector(e):e;if(!a)throw new Error(`The selector "${e}" did not match any elements`);return n||(a.textContent=""),a}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,a,u){if(u){n=u+":"+n;const m=Lx[u];m?e.setAttributeNS(m,n,a):e.setAttribute(n,a)}else e.setAttribute(n,a)}removeAttribute(e,n,a){if(a){const u=Lx[a];u?e.removeAttributeNS(u,n):e.removeAttribute(`${a}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,a,u){u&(us.DashCase|us.Important)?e.style.setProperty(n,a,u&us.Important?"important":""):e.style[n]=a}removeStyle(e,n,a){a&us.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,a){e[n]=a}setValue(e,n){e.nodeValue=n}listen(e,n,a){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,n,qw(a)):this.eventManager.addEventListener(e,n,qw(a))}}class cA extends Nx{constructor(e,n,a,u){super(e),this.component=a;const m=F_(u+"-"+a.id,a.styles,[]);n.addStyles(m),this.contentAttr=function sA(t){return"_ngcontent-%COMP%".replace(Fx,t)}(u+"-"+a.id),this.hostAttr=function aA(t){return"_nghost-%COMP%".replace(Fx,t)}(u+"-"+a.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,n){const a=super.createElement(e,n);return super.setAttribute(a,this.contentAttr,""),a}}class uA extends Nx{constructor(e,n,a,u){super(e),this.sharedStylesHost=n,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const m=F_(u.id,u.styles,[]);for(let v=0;v<m.length;v++){const T=document.createElement("style");T.textContent=m[v],this.shadowRoot.appendChild(T)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,a){return super.insertBefore(this.nodeOrShadowRoot(e),n,a)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let hA=(()=>{class t extends jw{constructor(n){super(n)}supports(n){return!0}addEventListener(n,a,u){return n.addEventListener(a,u,!1),()=>this.removeEventListener(n,a,u)}removeEventListener(n,a,u){return n.removeEventListener(a,u)}}return t.\u0275fac=function(n){return new(n||t)(on(ca))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();const Ww=["alt","control","meta","shift"],fA={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Xw={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},pA={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let mA=(()=>{class t extends jw{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,a,u){const m=t.parseEventName(a),v=t.eventCallback(m.fullKey,u,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Uu().onAndCancel(n,m.domEventName,v))}static parseEventName(n){const a=n.toLowerCase().split("."),u=a.shift();if(0===a.length||"keydown"!==u&&"keyup"!==u)return null;const m=t._normalizeKey(a.pop());let v="";if(Ww.forEach(I=>{const O=a.indexOf(I);O>-1&&(a.splice(O,1),v+=I+".")}),v+=m,0!=a.length||0===m.length)return null;const T={};return T.domEventName=u,T.fullKey=v,T}static getEventFullKey(n){let a="",u=function gA(t){let e=t.key;if(null==e){if(e=t.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&Xw.hasOwnProperty(e)&&(e=Xw[e]))}return fA[e]||e}(n);return u=u.toLowerCase()," "===u?u="space":"."===u&&(u="dot"),Ww.forEach(m=>{m!=u&&pA[m](n)&&(a+=m+".")}),a+=u,a}static eventCallback(n,a,u){return m=>{t.getEventFullKey(m)===n&&u.runGuarded(()=>a(m))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return t.\u0275fac=function(n){return new(n||t)(on(ca))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();const xA=rw(vI,"browser",[{provide:hm,useValue:Fw},{provide:X1,useValue:function _A(){Rx.makeCurrent(),Ox.init()},multi:!0},{provide:ca,useFactory:function vA(){return function Zs(t){_a=t}(document),document},deps:[]}]),bA=[{provide:Bh,useValue:"root"},{provide:bu,useFactory:function yA(){return new bu},deps:[]},{provide:O_,useClass:hA,multi:!0,deps:[ca,To,hm]},{provide:O_,useClass:mA,multi:!0,deps:[ca]},{provide:zx,useClass:zx,deps:[L_,gm,um]},{provide:h1,useExisting:zx},{provide:Vw,useExisting:gm},{provide:gm,useClass:gm,deps:[ca]},{provide:lx,useClass:lx,deps:[To]},{provide:L_,useClass:L_,deps:[O_,To]},{provide:Bw,useClass:rA,deps:[]}];let wA=(()=>{class t{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:t,providers:[{provide:um,useValue:n.appId},{provide:Uw,useExisting:um},nA]}}}return t.\u0275fac=function(n){return new(n||t)(on(t,12))},t.\u0275mod=oi({type:t}),t.\u0275inj=br({providers:bA,imports:[HM,xI]}),t})();function Un(...t){let e=t[t.length-1];return tt(e)?(t.pop(),Sn(t,e)):Si(t)}"undefined"!=typeof window&&window;class _l extends Tt{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const n=super._subscribe(e);return n&&!n.closed&&e.next(this._value),n}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new rn;return this._value}next(e){super.next(this._value=e)}}class RA extends Le{notifyNext(e,n,a,u,m){this.destination.next(n)}notifyError(e,n){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class OA extends Le{constructor(e,n,a){super(),this.parent=e,this.outerValue=n,this.outerIndex=a,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function LA(t,e,n,a,u=new OA(t,n,a)){if(!u.closed)return e instanceof gt?e.subscribe(u):Gt(e)(u)}const Jw={};class zA{constructor(e){this.resultSelector=e}call(e,n){return n.subscribe(new NA(e,this.resultSelector))}}class NA extends RA{constructor(e,n){super(e),this.resultSelector=n,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(Jw),this.observables.push(e)}_complete(){const e=this.observables,n=e.length;if(0===n)this.destination.complete();else{this.active=n,this.toRespond=n;for(let a=0;a<n;a++)this.add(LA(this,e[a],void 0,a))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,n,a){const u=this.values,v=this.toRespond?u[a]===Jw?--this.toRespond:this.toRespond:0;u[a]=n,0===v&&(this.resultSelector?this._tryResultSelector(u):this.destination.next(u.slice()))}_tryResultSelector(e){let n;try{n=this.resultSelector.apply(this,e)}catch(a){return void this.destination.error(a)}this.destination.next(n)}}function Cf(t,e){return new gt(e?n=>e.schedule(BA,0,{error:t,subscriber:n}):n=>n.error(t))}function BA({error:t,subscriber:e}){e.error(t)}const z_=(()=>{function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t})();function N_(...t){return function UA(){return hi(1)}()(Un(...t))}const Df=new gt(t=>t.complete());function B_(t){return t?function jA(t){return new gt(e=>t.schedule(()=>e.complete()))}(t):Df}function U_(t){return new gt(e=>{let n;try{n=t()}catch(u){return void e.error(u)}return(n?sr(n):B_()).subscribe(e)})}function Oa(t,e){return"function"==typeof e?n=>n.pipe(Oa((a,u)=>sr(t(a,u)).pipe(We((m,v)=>e(a,m,u,v))))):n=>n.lift(new VA(t))}class VA{constructor(e){this.project=e}call(e,n){return n.subscribe(new $A(e,this.project))}}class $A extends Vr{constructor(e,n){super(e),this.project=n,this.index=0}_next(e){let n;const a=this.index++;try{n=this.project(e,a)}catch(u){return void this.destination.error(u)}this._innerSub(n)}_innerSub(e){const n=this.innerSubscription;n&&n.unsubscribe();const a=new Ln(this),u=this.destination;u.add(a),this.innerSubscription=Co(e,a),this.innerSubscription!==a&&u.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const Qw=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})();function Uc(t){return e=>0===t?B_():e.lift(new GA(t))}class GA{constructor(e){if(this.total=e,this.total<0)throw new Qw}call(e,n){return n.subscribe(new HA(e,this.total))}}class HA extends Le{constructor(e,n){super(e),this.total=n,this.count=0}_next(e){const n=this.total,a=++this.count;a<=n&&(this.destination.next(e),a===n&&(this.destination.complete(),this.unsubscribe()))}}function eE(t,e){let n=!1;return arguments.length>=2&&(n=!0),function(u){return u.lift(new ZA(t,e,n))}}class ZA{constructor(e,n,a=!1){this.accumulator=e,this.seed=n,this.hasSeed=a}call(e,n){return n.subscribe(new WA(e,this.accumulator,this.seed,this.hasSeed))}}class WA extends Le{constructor(e,n,a,u){super(e),this.accumulator=n,this._seed=a,this.hasSeed=u,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const n=this.index++;let a;try{a=this.accumulator(this.seed,e,n)}catch(u){this.destination.error(u)}this.seed=a,this.destination.next(a)}}function ua(t,e){return function(a){return a.lift(new XA(t,e))}}class XA{constructor(e,n){this.predicate=e,this.thisArg=n}call(e,n){return n.subscribe(new KA(e,this.predicate,this.thisArg))}}class KA extends Le{constructor(e,n,a){super(e),this.predicate=n,this.thisArg=a,this.count=0}_next(e){let n;try{n=this.predicate.call(this.thisArg,e,this.count++)}catch(a){return void this.destination.error(a)}n&&this.destination.next(e)}}function Yh(t){return function(n){const a=new YA(t),u=n.lift(a);return a.caught=u}}class YA{constructor(e){this.selector=e}call(e,n){return n.subscribe(new JA(e,this.selector,this.caught))}}class JA extends Vr{constructor(e,n,a){super(e),this.selector=n,this.caught=a}error(e){if(!this.isStopped){let n;try{n=this.selector(e,this.caught)}catch(m){return void super.error(m)}this._unsubscribeAndRecycle();const a=new Ln(this);this.add(a);const u=Co(n,a);u!==a&&this.add(u)}}}function Sf(t,e){return Or(t,e,1)}function Ux(t){return function(n){return 0===t?B_():n.lift(new QA(t))}}class QA{constructor(e){if(this.total=e,this.total<0)throw new Qw}call(e,n){return n.subscribe(new e2(e,this.total))}}class e2 extends Le{constructor(e,n){super(e),this.total=n,this.ring=new Array,this.count=0}_next(e){const n=this.ring,a=this.total,u=this.count++;n.length<a?n.push(e):n[u%a]=e}_complete(){const e=this.destination;let n=this.count;if(n>0){const a=this.count>=this.total?this.total:this.count,u=this.ring;for(let m=0;m<a;m++){const v=n++%a;e.next(u[v])}}e.complete()}}function tE(t=r2){return e=>e.lift(new t2(t))}class t2{constructor(e){this.errorFactory=e}call(e,n){return n.subscribe(new n2(e,this.errorFactory))}}class n2 extends Le{constructor(e,n){super(e),this.errorFactory=n,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(n){e=n}this.destination.error(e)}}}function r2(){return new z_}function nE(t=null){return e=>e.lift(new i2(t))}class i2{constructor(e){this.defaultValue=e}call(e,n){return n.subscribe(new o2(e,this.defaultValue))}}class o2 extends Le{constructor(e,n){super(e),this.defaultValue=n,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function If(t,e){const n=arguments.length>=2;return a=>a.pipe(t?ua((u,m)=>t(u,m,a)):De,Uc(1),n?nE(e):tE(()=>new z_))}function jc(){}function js(t,e,n){return function(u){return u.lift(new a2(t,e,n))}}class a2{constructor(e,n,a){this.nextOrObserver=e,this.error=n,this.complete=a}call(e,n){return n.subscribe(new l2(e,this.nextOrObserver,this.error,this.complete))}}class l2 extends Le{constructor(e,n,a,u){super(e),this._tapNext=jc,this._tapError=jc,this._tapComplete=jc,this._tapError=a||jc,this._tapComplete=u||jc,pa(n)?(this._context=this,this._tapNext=n):n&&(this._context=n,this._tapNext=n.next||jc,this._tapError=n.error||jc,this._tapComplete=n.complete||jc)}_next(e){try{this._tapNext.call(this._context,e)}catch(n){return void this.destination.error(n)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(n){return void this.destination.error(n)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class u2{constructor(e){this.callback=e}call(e,n){return n.subscribe(new h2(e,this.callback))}}class h2 extends Le{constructor(e,n){super(e),this.add(new ae(n))}}class Vc{constructor(e,n){this.id=e,this.url=n}}class jx extends Vc{constructor(e,n,a="imperative",u=null){super(e,n),this.navigationTrigger=a,this.restoredState=u}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class _m extends Vc{constructor(e,n,a){super(e,n),this.urlAfterRedirects=a}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class rE extends Vc{constructor(e,n,a){super(e,n),this.reason=a}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class d2 extends Vc{constructor(e,n,a){super(e,n),this.error=a}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class f2 extends Vc{constructor(e,n,a,u){super(e,n),this.urlAfterRedirects=a,this.state=u}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class p2 extends Vc{constructor(e,n,a,u){super(e,n),this.urlAfterRedirects=a,this.state=u}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class m2 extends Vc{constructor(e,n,a,u,m){super(e,n),this.urlAfterRedirects=a,this.state=u,this.shouldActivate=m}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class g2 extends Vc{constructor(e,n,a,u){super(e,n),this.urlAfterRedirects=a,this.state=u}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _2 extends Vc{constructor(e,n,a,u){super(e,n),this.urlAfterRedirects=a,this.state=u}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class iE{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class oE{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class y2{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class v2{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class x2{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class b2{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class sE{constructor(e,n,a){this.routerEvent=e,this.position=n,this.anchor=a}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const hr="primary";class w2{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n[0]:n}return null}getAll(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Mf(t){return new w2(t)}const aE="ngNavigationCancelingError";function Vx(t){const e=Error("NavigationCancelingError: "+t);return e[aE]=!0,e}function T2(t,e,n){const a=n.path.split("/");if(a.length>t.length||"full"===n.pathMatch&&(e.hasChildren()||a.length<t.length))return null;const u={};for(let m=0;m<a.length;m++){const v=a[m],T=t[m];if(v.startsWith(":"))u[v.substring(1)]=T;else if(v!==T.path)return null}return{consumed:t.slice(0,a.length),posParams:u}}function Zl(t,e){const n=t?Object.keys(t):void 0,a=e?Object.keys(e):void 0;if(!n||!a||n.length!=a.length)return!1;let u;for(let m=0;m<n.length;m++)if(u=n[m],!lE(t[u],e[u]))return!1;return!0}function lE(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;const n=[...t].sort(),a=[...e].sort();return n.every((u,m)=>a[m]===u)}return t===e}function cE(t){return Array.prototype.concat.apply([],t)}function uE(t){return t.length>0?t[t.length-1]:null}function zo(t,e){for(const n in t)t.hasOwnProperty(n)&&e(t[n],n)}function Wl(t){return $0(t)?t:t_(t)?sr(Promise.resolve(t)):Un(t)}const S2={exact:function fE(t,e,n){if(!Qh(t.segments,e.segments)||!j_(t.segments,e.segments,n)||t.numberOfChildren!==e.numberOfChildren)return!1;for(const a in e.children)if(!t.children[a]||!fE(t.children[a],e.children[a],n))return!1;return!0},subset:pE},hE={exact:function I2(t,e){return Zl(t,e)},subset:function M2(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>lE(t[n],e[n]))},ignored:()=>!0};function dE(t,e,n){return S2[n.paths](t.root,e.root,n.matrixParams)&&hE[n.queryParams](t.queryParams,e.queryParams)&&!("exact"===n.fragment&&t.fragment!==e.fragment)}function pE(t,e,n){return mE(t,e,e.segments,n)}function mE(t,e,n,a){if(t.segments.length>n.length){const u=t.segments.slice(0,n.length);return!(!Qh(u,n)||e.hasChildren()||!j_(u,n,a))}if(t.segments.length===n.length){if(!Qh(t.segments,n)||!j_(t.segments,n,a))return!1;for(const u in e.children)if(!t.children[u]||!pE(t.children[u],e.children[u],a))return!1;return!0}{const u=n.slice(0,t.segments.length),m=n.slice(t.segments.length);return!!(Qh(t.segments,u)&&j_(t.segments,u,a)&&t.children[hr])&&mE(t.children[hr],e,m,a)}}function j_(t,e,n){return e.every((a,u)=>hE[n](t[u].parameters,a.parameters))}class Jh{constructor(e,n,a){this.root=e,this.queryParams=n,this.fragment=a}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Mf(this.queryParams)),this._queryParamMap}toString(){return k2.serialize(this)}}class _r{constructor(e,n){this.segments=e,this.children=n,this.parent=null,zo(n,(a,u)=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return V_(this)}}class ym{constructor(e,n){this.path=e,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Mf(this.parameters)),this._parameterMap}toString(){return xE(this)}}function Qh(t,e){return t.length===e.length&&t.every((n,a)=>n.path===e[a].path)}class gE{}class _E{parse(e){const n=new j2(e);return new Jh(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(e){const n=`/${vm(e.root,!0)}`,a=function L2(t){const e=Object.keys(t).map(n=>{const a=t[n];return Array.isArray(a)?a.map(u=>`${$_(n)}=${$_(u)}`).join("&"):`${$_(n)}=${$_(a)}`}).filter(n=>!!n);return e.length?`?${e.join("&")}`:""}(e.queryParams),u="string"==typeof e.fragment?`#${function R2(t){return encodeURI(t)}(e.fragment)}`:"";return`${n}${a}${u}`}}const k2=new _E;function V_(t){return t.segments.map(e=>xE(e)).join("/")}function vm(t,e){if(!t.hasChildren())return V_(t);if(e){const n=t.children[hr]?vm(t.children[hr],!1):"",a=[];return zo(t.children,(u,m)=>{m!==hr&&a.push(`${m}:${vm(u,!1)}`)}),a.length>0?`${n}(${a.join("//")})`:n}{const n=function P2(t,e){let n=[];return zo(t.children,(a,u)=>{u===hr&&(n=n.concat(e(a,u)))}),zo(t.children,(a,u)=>{u!==hr&&(n=n.concat(e(a,u)))}),n}(t,(a,u)=>u===hr?[vm(t.children[hr],!1)]:[`${u}:${vm(a,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[hr]?`${V_(t)}/${n[0]}`:`${V_(t)}/(${n.join("//")})`}}function yE(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function $_(t){return yE(t).replace(/%3B/gi,";")}function $x(t){return yE(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function G_(t){return decodeURIComponent(t)}function vE(t){return G_(t.replace(/\+/g,"%20"))}function xE(t){return`${$x(t.path)}${function O2(t){return Object.keys(t).map(e=>`;${$x(e)}=${$x(t[e])}`).join("")}(t.parameters)}`}const F2=/^[^\/()?;=#]+/;function H_(t){const e=t.match(F2);return e?e[0]:""}const z2=/^[^=?&#]+/,B2=/^[^&#]+/;class j2{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new _r([],{}):new _r([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(e.length>0||Object.keys(n).length>0)&&(a[hr]=new _r(e,n)),a}parseSegment(){const e=H_(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new ym(G_(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const n=H_(this.remaining);if(!n)return;this.capture(n);let a="";if(this.consumeOptional("=")){const u=H_(this.remaining);u&&(a=u,this.capture(a))}e[G_(n)]=G_(a)}parseQueryParam(e){const n=function N2(t){const e=t.match(z2);return e?e[0]:""}(this.remaining);if(!n)return;this.capture(n);let a="";if(this.consumeOptional("=")){const v=function U2(t){const e=t.match(B2);return e?e[0]:""}(this.remaining);v&&(a=v,this.capture(a))}const u=vE(n),m=vE(a);if(e.hasOwnProperty(u)){let v=e[u];Array.isArray(v)||(v=[v],e[u]=v),v.push(m)}else e[u]=m}parseParens(e){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const a=H_(this.remaining),u=this.remaining[a.length];if("/"!==u&&")"!==u&&";"!==u)throw new Error(`Cannot parse url '${this.url}'`);let m;a.indexOf(":")>-1?(m=a.substr(0,a.indexOf(":")),this.capture(m),this.capture(":")):e&&(m=hr);const v=this.parseChildren();n[m]=1===Object.keys(v).length?v[hr]:new _r([],v),this.consumeOptional("//")}return n}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class bE{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const n=this.pathFromRoot(e);return n.length>1?n[n.length-2]:null}children(e){const n=Gx(e,this._root);return n?n.children.map(a=>a.value):[]}firstChild(e){const n=Gx(e,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(e){const n=Hx(e,this._root);return n.length<2?[]:n[n.length-2].children.map(u=>u.value).filter(u=>u!==e)}pathFromRoot(e){return Hx(e,this._root).map(n=>n.value)}}function Gx(t,e){if(t===e.value)return e;for(const n of e.children){const a=Gx(t,n);if(a)return a}return null}function Hx(t,e){if(t===e.value)return[e];for(const n of e.children){const a=Hx(t,n);if(a.length)return a.unshift(e),a}return[]}class $c{constructor(e,n){this.value=e,this.children=n}toString(){return`TreeNode(${this.value})`}}function Af(t){const e={};return t&&t.children.forEach(n=>e[n.value.outlet]=n),e}class wE extends bE{constructor(e,n){super(e),this.snapshot=n,qx(this,e)}toString(){return this.snapshot.toString()}}function EE(t,e){const n=function V2(t,e){const v=new q_([],{},{},"",{},hr,e,null,t.root,-1,{});return new CE("",new $c(v,[]))}(t,e),a=new _l([new ym("",{})]),u=new _l({}),m=new _l({}),v=new _l({}),T=new _l(""),I=new Pf(a,u,v,T,m,hr,e,n.root);return I.snapshot=n.root,new wE(new $c(I,[]),n)}class Pf{constructor(e,n,a,u,m,v,T,I){this.url=e,this.params=n,this.queryParams=a,this.fragment=u,this.data=m,this.outlet=v,this.component=T,this._futureSnapshot=I}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(We(e=>Mf(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(We(e=>Mf(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function TE(t,e="emptyOnly"){const n=t.pathFromRoot;let a=0;if("always"!==e)for(a=n.length-1;a>=1;){const u=n[a],m=n[a-1];if(u.routeConfig&&""===u.routeConfig.path)a--;else{if(m.component)break;a--}}return function $2(t){return t.reduce((e,n)=>({params:Object.assign(Object.assign({},e.params),n.params),data:Object.assign(Object.assign({},e.data),n.data),resolve:Object.assign(Object.assign({},e.resolve),n._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(a))}class q_{constructor(e,n,a,u,m,v,T,I,O,N,H){this.url=e,this.params=n,this.queryParams=a,this.fragment=u,this.data=m,this.outlet=v,this.component=T,this.routeConfig=I,this._urlSegment=O,this._lastPathIndex=N,this._resolve=H}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Mf(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Mf(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(a=>a.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class CE extends bE{constructor(e,n){super(n),this.url=e,qx(this,n)}toString(){return DE(this._root)}}function qx(t,e){e.value._routerState=t,e.children.forEach(n=>qx(t,n))}function DE(t){const e=t.children.length>0?` { ${t.children.map(DE).join(", ")} } `:"";return`${t.value}${e}`}function Zx(t){if(t.snapshot){const e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,Zl(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),Zl(e.params,n.params)||t.params.next(n.params),function C2(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Zl(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),Zl(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Wx(t,e){const n=Zl(t.params,e.params)&&function A2(t,e){return Qh(t,e)&&t.every((n,a)=>Zl(n.parameters,e[a].parameters))}(t.url,e.url);return n&&!(!t.parent!=!e.parent)&&(!t.parent||Wx(t.parent,e.parent))}function xm(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){const a=n.value;a._futureSnapshot=e.value;const u=function H2(t,e,n){return e.children.map(a=>{for(const u of n.children)if(t.shouldReuseRoute(a.value,u.value.snapshot))return xm(t,a,u);return xm(t,a)})}(t,e,n);return new $c(a,u)}{if(t.shouldAttach(e.value)){const m=t.retrieve(e.value);if(null!==m){const v=m.route;return v.value._futureSnapshot=e.value,v.children=e.children.map(T=>xm(t,T)),v}}const a=function q2(t){return new Pf(new _l(t.url),new _l(t.params),new _l(t.queryParams),new _l(t.fragment),new _l(t.data),t.outlet,t.component,t)}(e.value),u=e.children.map(m=>xm(t,m));return new $c(a,u)}}function Z_(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function bm(t){return"object"==typeof t&&null!=t&&t.outlets}function Xx(t,e,n,a,u){let m={};if(a&&zo(a,(T,I)=>{m[I]=Array.isArray(T)?T.map(O=>`${O}`):`${T}`}),t===e)return new Jh(n,m,u);const v=SE(t,e,n);return new Jh(v,m,u)}function SE(t,e,n){const a={};return zo(t.children,(u,m)=>{a[m]=u===e?n:SE(u,e,n)}),new _r(t.segments,a)}class IE{constructor(e,n,a){if(this.isAbsolute=e,this.numberOfDoubleDots=n,this.commands=a,e&&a.length>0&&Z_(a[0]))throw new Error("Root segment cannot have matrix parameters");const u=a.find(bm);if(u&&u!==uE(a))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Kx{constructor(e,n,a){this.segmentGroup=e,this.processChildren=n,this.index=a}}function ME(t,e,n){if(t||(t=new _r([],{})),0===t.segments.length&&t.hasChildren())return W_(t,e,n);const a=function J2(t,e,n){let a=0,u=e;const m={match:!1,pathIndex:0,commandIndex:0};for(;u<t.segments.length;){if(a>=n.length)return m;const v=t.segments[u],T=n[a];if(bm(T))break;const I=`${T}`,O=a<n.length-1?n[a+1]:null;if(u>0&&void 0===I)break;if(I&&O&&"object"==typeof O&&void 0===O.outlets){if(!PE(I,O,v))return m;a+=2}else{if(!PE(I,{},v))return m;a++}u++}return{match:!0,pathIndex:u,commandIndex:a}}(t,e,n),u=n.slice(a.commandIndex);if(a.match&&a.pathIndex<t.segments.length){const m=new _r(t.segments.slice(0,a.pathIndex),{});return m.children[hr]=new _r(t.segments.slice(a.pathIndex),t.children),W_(m,0,u)}return a.match&&0===u.length?new _r(t.segments,{}):a.match&&!t.hasChildren()?Yx(t,e,n):a.match?W_(t,0,u):Yx(t,e,n)}function W_(t,e,n){if(0===n.length)return new _r(t.segments,{});{const a=function Y2(t){return bm(t[0])?t[0].outlets:{[hr]:t}}(n),u={};return zo(a,(m,v)=>{"string"==typeof m&&(m=[m]),null!==m&&(u[v]=ME(t.children[v],e,m))}),zo(t.children,(m,v)=>{void 0===a[v]&&(u[v]=m)}),new _r(t.segments,u)}}function Yx(t,e,n){const a=t.segments.slice(0,e);let u=0;for(;u<n.length;){const m=n[u];if(bm(m)){const I=Q2(m.outlets);return new _r(a,I)}if(0===u&&Z_(n[0])){a.push(new ym(t.segments[e].path,AE(n[0]))),u++;continue}const v=bm(m)?m.outlets[hr]:`${m}`,T=u<n.length-1?n[u+1]:null;v&&T&&Z_(T)?(a.push(new ym(v,AE(T))),u+=2):(a.push(new ym(v,{})),u++)}return new _r(a,{})}function Q2(t){const e={};return zo(t,(n,a)=>{"string"==typeof n&&(n=[n]),null!==n&&(e[a]=Yx(new _r([],{}),0,n))}),e}function AE(t){const e={};return zo(t,(n,a)=>e[a]=`${n}`),e}function PE(t,e,n){return t==n.path&&Zl(e,n.parameters)}class tP{constructor(e,n,a,u){this.routeReuseStrategy=e,this.futureState=n,this.currState=a,this.forwardEvent=u}activate(e){const n=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,a,e),Zx(this.futureState.root),this.activateChildRoutes(n,a,e)}deactivateChildRoutes(e,n,a){const u=Af(n);e.children.forEach(m=>{const v=m.value.outlet;this.deactivateRoutes(m,u[v],a),delete u[v]}),zo(u,(m,v)=>{this.deactivateRouteAndItsChildren(m,a)})}deactivateRoutes(e,n,a){const u=e.value,m=n?n.value:null;if(u===m)if(u.component){const v=a.getContext(u.outlet);v&&this.deactivateChildRoutes(e,n,v.children)}else this.deactivateChildRoutes(e,n,a);else m&&this.deactivateRouteAndItsChildren(n,a)}deactivateRouteAndItsChildren(e,n){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,n):this.deactivateRouteAndOutlet(e,n)}detachAndStoreRouteSubtree(e,n){const a=n.getContext(e.value.outlet),u=a&&e.value.component?a.children:n,m=Af(e);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],u);if(a&&a.outlet){const v=a.outlet.detach(),T=a.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:v,route:e,contexts:T})}}deactivateRouteAndOutlet(e,n){const a=n.getContext(e.value.outlet),u=a&&e.value.component?a.children:n,m=Af(e);for(const v of Object.keys(m))this.deactivateRouteAndItsChildren(m[v],u);a&&a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated(),a.attachRef=null,a.resolver=null,a.route=null)}activateChildRoutes(e,n,a){const u=Af(n);e.children.forEach(m=>{this.activateRoutes(m,u[m.value.outlet],a),this.forwardEvent(new b2(m.value.snapshot))}),e.children.length&&this.forwardEvent(new v2(e.value.snapshot))}activateRoutes(e,n,a){const u=e.value,m=n?n.value:null;if(Zx(u),u===m)if(u.component){const v=a.getOrCreateContext(u.outlet);this.activateChildRoutes(e,n,v.children)}else this.activateChildRoutes(e,n,a);else if(u.component){const v=a.getOrCreateContext(u.outlet);if(this.routeReuseStrategy.shouldAttach(u.snapshot)){const T=this.routeReuseStrategy.retrieve(u.snapshot);this.routeReuseStrategy.store(u.snapshot,null),v.children.onOutletReAttached(T.contexts),v.attachRef=T.componentRef,v.route=T.route.value,v.outlet&&v.outlet.attach(T.componentRef,T.route.value),Zx(T.route.value),this.activateChildRoutes(e,null,v.children)}else{const T=function nP(t){for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(u.snapshot),I=T?T.module.componentFactoryResolver:null;v.attachRef=null,v.route=u,v.resolver=I,v.outlet&&v.outlet.activateWith(u,I),this.activateChildRoutes(e,null,v.children)}}else this.activateChildRoutes(e,null,a)}}class Jx{constructor(e,n){this.routes=e,this.module=n}}function Vu(t){return"function"==typeof t}function ed(t){return t instanceof Jh}const wm=Symbol("INITIAL_VALUE");function Em(){return Oa(t=>function FA(...t){let e,n;return tt(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Ie(t[0])&&(t=t[0]),Si(t,n).lift(new zA(e))}(t.map(e=>e.pipe(Uc(1),function qA(...t){const e=t[t.length-1];return tt(e)?(t.pop(),n=>N_(t,n,e)):n=>N_(t,n)}(wm)))).pipe(eE((e,n)=>{let a=!1;return n.reduce((u,m,v)=>u!==wm?u:(m===wm&&(a=!0),a||!1!==m&&v!==n.length-1&&!ed(m)?u:m),e)},wm),ua(e=>e!==wm),We(e=>ed(e)?e:!0===e),Uc(1)))}class lP{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Tm,this.attachRef=null}}class Tm{constructor(){this.contexts=new Map}onChildOutletCreated(e,n){const a=this.getOrCreateContext(e);a.outlet=n,this.contexts.set(e,a)}onChildOutletDestroyed(e){const n=this.getContext(e);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let n=this.getContext(e);return n||(n=new lP,this.contexts.set(e,n)),n}getContext(e){return this.contexts.get(e)||null}}let X_=(()=>{class t{constructor(n,a,u,m,v){this.parentContexts=n,this.location=a,this.resolver=u,this.changeDetector=v,this.activated=null,this._activatedRoute=null,this.activateEvents=new vs,this.deactivateEvents=new vs,this.attachEvents=new vs,this.detachEvents=new vs,this.name=m||hr,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,a){this.activated=n,this._activatedRoute=a,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,a){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const v=(a=a||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),T=this.parentContexts.getOrCreateContext(this.name).children,I=new cP(n,T,this.location.injector);this.activated=this.location.createComponent(v,this.location.length,I),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(n){return new(n||t)(yn(Tm),yn(Pa),yn(om),Ne("name"),yn(dx))},t.\u0275dir=Yr({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),t})();class cP{constructor(e,n,a){this.route=e,this.childContexts=n,this.parent=a}get(e,n){return e===Pf?this.route:e===Tm?this.childContexts:this.parent.get(e,n)}}let kE=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Dr({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,a){1&n&&Lc(0,"router-outlet")},directives:[X_],encapsulation:2}),t})();function RE(t,e=""){for(let n=0;n<t.length;n++){const a=t[n];uP(a,hP(e,a))}}function uP(t,e){t.children&&RE(t.children,e)}function hP(t,e){return e?t||e.path?t&&!e.path?`${t}/`:!t&&e.path?e.path:`${t}/${e.path}`:"":t}function Qx(t){const e=t.children&&t.children.map(Qx),n=e?Object.assign(Object.assign({},t),{children:e}):Object.assign({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==hr&&(n.component=kE),n}function La(t){return t.outlet||hr}function OE(t,e){const n=t.filter(a=>La(a)===e);return n.push(...t.filter(a=>La(a)!==e)),n}const LE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function K_(t,e,n){var a;if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?Object.assign({},LE):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const m=(e.matcher||T2)(n,t,e);if(!m)return Object.assign({},LE);const v={};zo(m.posParams,(I,O)=>{v[O]=I.path});const T=m.consumed.length>0?Object.assign(Object.assign({},v),m.consumed[m.consumed.length-1].parameters):v;return{matched:!0,consumedSegments:m.consumed,remainingSegments:n.slice(m.consumed.length),parameters:T,positionalParamSegments:null!==(a=m.posParams)&&void 0!==a?a:{}}}function Y_(t,e,n,a,u="corrected"){if(n.length>0&&function pP(t,e,n){return n.some(a=>J_(t,e,a)&&La(a)!==hr)}(t,n,a)){const v=new _r(e,function fP(t,e,n,a){const u={};u[hr]=a,a._sourceSegment=t,a._segmentIndexShift=e.length;for(const m of n)if(""===m.path&&La(m)!==hr){const v=new _r([],{});v._sourceSegment=t,v._segmentIndexShift=e.length,u[La(m)]=v}return u}(t,e,a,new _r(n,t.children)));return v._sourceSegment=t,v._segmentIndexShift=e.length,{segmentGroup:v,slicedSegments:[]}}if(0===n.length&&function mP(t,e,n){return n.some(a=>J_(t,e,a))}(t,n,a)){const v=new _r(t.segments,function dP(t,e,n,a,u,m){const v={};for(const T of a)if(J_(t,n,T)&&!u[La(T)]){const I=new _r([],{});I._sourceSegment=t,I._segmentIndexShift="legacy"===m?t.segments.length:e.length,v[La(T)]=I}return Object.assign(Object.assign({},u),v)}(t,e,n,a,t.children,u));return v._sourceSegment=t,v._segmentIndexShift=e.length,{segmentGroup:v,slicedSegments:n}}const m=new _r(t.segments,t.children);return m._sourceSegment=t,m._segmentIndexShift=e.length,{segmentGroup:m,slicedSegments:n}}function J_(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path}function FE(t,e,n,a){return!!(La(t)===a||a!==hr&&J_(e,n,t))&&("**"===t.path||K_(e,t,n).matched)}function zE(t,e,n){return 0===e.length&&!t.children[n]}class Q_{constructor(e){this.segmentGroup=e||null}}class NE{constructor(e){this.urlTree=e}}function Cm(t){return Cf(new Q_(t))}function BE(t){return Cf(new NE(t))}function gP(t){return Cf(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`))}class vP{constructor(e,n,a,u,m){this.configLoader=n,this.urlSerializer=a,this.urlTree=u,this.config=m,this.allowRedirects=!0,this.ngModule=e.get(Fc)}apply(){const e=Y_(this.urlTree.root,[],[],this.config).segmentGroup,n=new _r(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,n,hr).pipe(We(m=>this.createUrlTree(e0(m),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Yh(m=>{if(m instanceof NE)return this.allowRedirects=!1,this.match(m.urlTree);throw m instanceof Q_?this.noMatchError(m):m}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,hr).pipe(We(u=>this.createUrlTree(e0(u),e.queryParams,e.fragment))).pipe(Yh(u=>{throw u instanceof Q_?this.noMatchError(u):u}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,n,a){const u=e.segments.length>0?new _r([],{[hr]:e}):e;return new Jh(u,n,a)}expandSegmentGroup(e,n,a,u){return 0===a.segments.length&&a.hasChildren()?this.expandChildren(e,n,a).pipe(We(m=>new _r([],m))):this.expandSegment(e,a,n,a.segments,u,!0)}expandChildren(e,n,a){const u=[];for(const m of Object.keys(a.children))"primary"===m?u.unshift(m):u.push(m);return sr(u).pipe(Sf(m=>{const v=a.children[m],T=OE(n,m);return this.expandSegmentGroup(e,T,v,m).pipe(We(I=>({segment:I,outlet:m})))}),eE((m,v)=>(m[v.outlet]=v.segment,m),{}),function s2(t,e){const n=arguments.length>=2;return a=>a.pipe(t?ua((u,m)=>t(u,m,a)):De,Ux(1),n?nE(e):tE(()=>new z_))}())}expandSegment(e,n,a,u,m,v){return sr(a).pipe(Sf(T=>this.expandSegmentAgainstRoute(e,n,a,T,u,m,v).pipe(Yh(O=>{if(O instanceof Q_)return Un(null);throw O}))),If(T=>!!T),Yh((T,I)=>{if(T instanceof z_||"EmptyError"===T.name)return zE(n,u,m)?Un(new _r([],{})):Cm(n);throw T}))}expandSegmentAgainstRoute(e,n,a,u,m,v,T){return FE(u,n,m,v)?void 0===u.redirectTo?this.matchSegmentAgainstRoute(e,n,u,m,v):T&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,n,a,u,m,v):Cm(n):Cm(n)}expandSegmentAgainstRouteUsingRedirect(e,n,a,u,m,v){return"**"===u.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,a,u,v):this.expandRegularSegmentAgainstRouteUsingRedirect(e,n,a,u,m,v)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,a,u){const m=this.applyRedirectCommands([],a.redirectTo,{});return a.redirectTo.startsWith("/")?BE(m):this.lineralizeSegments(a,m).pipe(Or(v=>{const T=new _r(v,{});return this.expandSegment(e,T,n,v,u,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,n,a,u,m,v){const{matched:T,consumedSegments:I,remainingSegments:O,positionalParamSegments:N}=K_(n,u,m);if(!T)return Cm(n);const H=this.applyRedirectCommands(I,u.redirectTo,N);return u.redirectTo.startsWith("/")?BE(H):this.lineralizeSegments(u,H).pipe(Or(oe=>this.expandSegment(e,n,a,oe.concat(O),v,!1)))}matchSegmentAgainstRoute(e,n,a,u,m){if("**"===a.path)return a.loadChildren?(a._loadedConfig?Un(a._loadedConfig):this.configLoader.load(e.injector,a)).pipe(We(H=>(a._loadedConfig=H,new _r(u,{})))):Un(new _r(u,{}));const{matched:v,consumedSegments:T,remainingSegments:I}=K_(n,a,u);return v?this.getChildConfig(e,a,u).pipe(Or(N=>{const H=N.module,oe=N.routes,{segmentGroup:ce,slicedSegments:Re}=Y_(n,T,I,oe),lt=new _r(ce.segments,ce.children);if(0===Re.length&&lt.hasChildren())return this.expandChildren(H,oe,lt).pipe(We(sn=>new _r(T,sn)));if(0===oe.length&&0===Re.length)return Un(new _r(T,{}));const Et=La(a)===m;return this.expandSegment(H,lt,oe,Re,Et?hr:m,!0).pipe(We(Je=>new _r(T.concat(Je.segments),Je.children)))})):Cm(n)}getChildConfig(e,n,a){return n.children?Un(new Jx(n.children,e)):n.loadChildren?void 0!==n._loadedConfig?Un(n._loadedConfig):this.runCanLoadGuards(e.injector,n,a).pipe(Or(u=>u?this.configLoader.load(e.injector,n).pipe(We(m=>(n._loadedConfig=m,m))):function _P(t){return Cf(Vx(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`))}(n))):Un(new Jx([],e))}runCanLoadGuards(e,n,a){const u=n.canLoad;if(!u||0===u.length)return Un(!0);const m=u.map(v=>{const T=e.get(v);let I;if(function iP(t){return t&&Vu(t.canLoad)}(T))I=T.canLoad(n,a);else{if(!Vu(T))throw new Error("Invalid CanLoad guard");I=T(n,a)}return Wl(I)});return Un(m).pipe(Em(),js(v=>{if(!ed(v))return;const T=Vx(`Redirecting to "${this.urlSerializer.serialize(v)}"`);throw T.url=v,T}),We(v=>!0===v))}lineralizeSegments(e,n){let a=[],u=n.root;for(;;){if(a=a.concat(u.segments),0===u.numberOfChildren)return Un(a);if(u.numberOfChildren>1||!u.children[hr])return gP(e.redirectTo);u=u.children[hr]}}applyRedirectCommands(e,n,a){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),e,a)}applyRedirectCreatreUrlTree(e,n,a,u){const m=this.createSegmentGroup(e,n.root,a,u);return new Jh(m,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(e,n){const a={};return zo(e,(u,m)=>{if("string"==typeof u&&u.startsWith(":")){const T=u.substring(1);a[m]=n[T]}else a[m]=u}),a}createSegmentGroup(e,n,a,u){const m=this.createSegments(e,n.segments,a,u);let v={};return zo(n.children,(T,I)=>{v[I]=this.createSegmentGroup(e,T,a,u)}),new _r(m,v)}createSegments(e,n,a,u){return n.map(m=>m.path.startsWith(":")?this.findPosParam(e,m,u):this.findOrReturn(m,a))}findPosParam(e,n,a){const u=a[n.path.substring(1)];if(!u)throw new Error(`Cannot redirect to '${e}'. Cannot find '${n.path}'.`);return u}findOrReturn(e,n){let a=0;for(const u of n){if(u.path===e.path)return n.splice(a),u;a++}return e}}function e0(t){const e={};for(const a of Object.keys(t.children)){const m=e0(t.children[a]);(m.segments.length>0||m.hasChildren())&&(e[a]=m)}return function xP(t){if(1===t.numberOfChildren&&t.children[hr]){const e=t.children[hr];return new _r(t.segments.concat(e.segments),e.children)}return t}(new _r(t.segments,e))}class UE{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class ey{constructor(e,n){this.component=e,this.route=n}}function wP(t,e,n){const a=t._root;return Dm(a,e?e._root:null,n,[a.value])}function ty(t,e,n){const a=function TP(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(e);return(a?a.module.injector:n).get(t)}function Dm(t,e,n,a,u={canDeactivateChecks:[],canActivateChecks:[]}){const m=Af(e);return t.children.forEach(v=>{(function CP(t,e,n,a,u={canDeactivateChecks:[],canActivateChecks:[]}){const m=t.value,v=e?e.value:null,T=n?n.getContext(t.value.outlet):null;if(v&&m.routeConfig===v.routeConfig){const I=function DP(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!Qh(t.url,e.url);case"pathParamsOrQueryParamsChange":return!Qh(t.url,e.url)||!Zl(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Wx(t,e)||!Zl(t.queryParams,e.queryParams);default:return!Wx(t,e)}}(v,m,m.routeConfig.runGuardsAndResolvers);I?u.canActivateChecks.push(new UE(a)):(m.data=v.data,m._resolvedData=v._resolvedData),Dm(t,e,m.component?T?T.children:null:n,a,u),I&&T&&T.outlet&&T.outlet.isActivated&&u.canDeactivateChecks.push(new ey(T.outlet.component,v))}else v&&Sm(e,T,u),u.canActivateChecks.push(new UE(a)),Dm(t,null,m.component?T?T.children:null:n,a,u)})(v,m[v.value.outlet],n,a.concat([v.value]),u),delete m[v.value.outlet]}),zo(m,(v,T)=>Sm(v,n.getContext(T),u)),u}function Sm(t,e,n){const a=Af(t),u=t.value;zo(a,(m,v)=>{Sm(m,u.component?e?e.children.getContext(v):null:e,n)}),n.canDeactivateChecks.push(new ey(u.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,u))}class LP{}function jE(t){return new gt(e=>e.error(t))}class zP{constructor(e,n,a,u,m,v){this.rootComponentType=e,this.config=n,this.urlTree=a,this.url=u,this.paramsInheritanceStrategy=m,this.relativeLinkResolution=v}recognize(){const e=Y_(this.urlTree.root,[],[],this.config.filter(v=>void 0===v.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,e,hr);if(null===n)return null;const a=new q_([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},hr,this.rootComponentType,null,this.urlTree.root,-1,{}),u=new $c(a,n),m=new CE(this.url,u);return this.inheritParamsAndData(m._root),m}inheritParamsAndData(e){const n=e.value,a=TE(n,this.paramsInheritanceStrategy);n.params=Object.freeze(a.params),n.data=Object.freeze(a.data),e.children.forEach(u=>this.inheritParamsAndData(u))}processSegmentGroup(e,n,a){return 0===n.segments.length&&n.hasChildren()?this.processChildren(e,n):this.processSegment(e,n,n.segments,a)}processChildren(e,n){const a=[];for(const m of Object.keys(n.children)){const v=n.children[m],T=OE(e,m),I=this.processSegmentGroup(T,v,m);if(null===I)return null;a.push(...I)}const u=VE(a);return function NP(t){t.sort((e,n)=>e.value.outlet===hr?-1:n.value.outlet===hr?1:e.value.outlet.localeCompare(n.value.outlet))}(u),u}processSegment(e,n,a,u){for(const m of e){const v=this.processSegmentAgainstRoute(m,n,a,u);if(null!==v)return v}return zE(n,a,u)?[]:null}processSegmentAgainstRoute(e,n,a,u){if(e.redirectTo||!FE(e,n,a,u))return null;let m,v=[],T=[];if("**"===e.path){const ce=a.length>0?uE(a).parameters:{};m=new q_(a,ce,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,HE(e),La(e),e.component,e,$E(n),GE(n)+a.length,qE(e))}else{const ce=K_(n,e,a);if(!ce.matched)return null;v=ce.consumedSegments,T=ce.remainingSegments,m=new q_(v,ce.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,HE(e),La(e),e.component,e,$E(n),GE(n)+v.length,qE(e))}const I=function BP(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(e),{segmentGroup:O,slicedSegments:N}=Y_(n,v,T,I.filter(ce=>void 0===ce.redirectTo),this.relativeLinkResolution);if(0===N.length&&O.hasChildren()){const ce=this.processChildren(I,O);return null===ce?null:[new $c(m,ce)]}if(0===I.length&&0===N.length)return[new $c(m,[])];const H=La(e)===u,oe=this.processSegment(I,O,N,H?hr:u);return null===oe?null:[new $c(m,oe)]}}function UP(t){const e=t.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function VE(t){const e=[],n=new Set;for(const a of t){if(!UP(a)){e.push(a);continue}const u=e.find(m=>a.value.routeConfig===m.value.routeConfig);void 0!==u?(u.children.push(...a.children),n.add(u)):e.push(a)}for(const a of n){const u=VE(a.children);e.push(new $c(a.value,u))}return e.filter(a=>!n.has(a))}function $E(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function GE(t){let e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,n+=e._segmentIndexShift?e._segmentIndexShift:0;return n-1}function HE(t){return t.data||{}}function qE(t){return t.resolve||{}}function ZE(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function t0(t){return Oa(e=>{const n=t(e);return n?sr(n).pipe(We(()=>e)):Un(e)})}class WP extends class ZP{shouldDetach(e){return!1}store(e,n){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,n){return e.routeConfig===n.routeConfig}}{}const n0=new Vt("ROUTES");class WE{constructor(e,n,a,u){this.injector=e,this.compiler=n,this.onLoadStartListener=a,this.onLoadEndListener=u}load(e,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const u=this.loadModuleFactory(n.loadChildren).pipe(We(m=>{this.onLoadEndListener&&this.onLoadEndListener(n);const v=m.create(e);return new Jx(cE(v.injector.get(n0,void 0,mn.Self|mn.Optional)).map(Qx),v)}),Yh(m=>{throw n._loader$=void 0,m}));return n._loader$=new ts(u,()=>new Tt).pipe(Bo()),n._loader$}loadModuleFactory(e){return Wl(e()).pipe(Or(n=>n instanceof p1?Un(n):sr(this.compiler.compileModuleAsync(n))))}}class KP{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,n){return e}}function YP(t){throw t}function JP(t,e,n){return e.parse("/")}function XE(t,e){return Un(null)}const QP={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ek={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ha=(()=>{class t{constructor(n,a,u,m,v,T,I){this.rootComponentType=n,this.urlSerializer=a,this.rootContexts=u,this.location=m,this.config=I,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Tt,this.errorHandler=YP,this.malformedUriErrorHandler=JP,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:XE,afterPreactivation:XE},this.urlHandlingStrategy=new KP,this.routeReuseStrategy=new WP,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=v.get(Fc),this.console=v.get(FS);const H=v.get(To);this.isNgZoneEnabled=H instanceof To&&To.isInAngularZone(),this.resetConfig(I),this.currentUrlTree=function D2(){return new Jh(new _r([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new WE(v,T,oe=>this.triggerEvent(new iE(oe)),oe=>this.triggerEvent(new oE(oe))),this.routerState=EE(this.currentUrlTree,this.rootComponentType),this.transitions=new _l({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var n;return null===(n=this.location.getState())||void 0===n?void 0:n.\u0275routerPageId}setupNavigations(n){const a=this.events;return n.pipe(ua(u=>0!==u.id),We(u=>Object.assign(Object.assign({},u),{extractedUrl:this.urlHandlingStrategy.extract(u.rawUrl)})),Oa(u=>{let m=!1,v=!1;return Un(u).pipe(js(T=>{this.currentNavigation={id:T.id,initialUrl:T.currentRawUrl,extractedUrl:T.extractedUrl,trigger:T.source,extras:T.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Oa(T=>{const I=this.browserUrlTree.toString(),O=!this.navigated||T.extractedUrl.toString()!==I||I!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||O)&&this.urlHandlingStrategy.shouldProcessUrl(T.rawUrl))return KE(T.source)&&(this.browserUrlTree=T.extractedUrl),Un(T).pipe(Oa(H=>{const oe=this.transitions.getValue();return a.next(new jx(H.id,this.serializeUrl(H.extractedUrl),H.source,H.restoredState)),oe!==this.transitions.getValue()?Df:Promise.resolve(H)}),function bP(t,e,n,a){return Oa(u=>function yP(t,e,n,a,u){return new vP(t,e,n,a,u).apply()}(t,e,n,u.extractedUrl,a).pipe(We(m=>Object.assign(Object.assign({},u),{urlAfterRedirects:m}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),js(H=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:H.urlAfterRedirects})}),function jP(t,e,n,a,u){return Or(m=>function FP(t,e,n,a,u="emptyOnly",m="legacy"){try{const v=new zP(t,e,n,a,u,m).recognize();return null===v?jE(new LP):Un(v)}catch(v){return jE(v)}}(t,e,m.urlAfterRedirects,n(m.urlAfterRedirects),a,u).pipe(We(v=>Object.assign(Object.assign({},m),{targetSnapshot:v}))))}(this.rootComponentType,this.config,H=>this.serializeUrl(H),this.paramsInheritanceStrategy,this.relativeLinkResolution),js(H=>{if("eager"===this.urlUpdateStrategy){if(!H.extras.skipLocationChange){const ce=this.urlHandlingStrategy.merge(H.urlAfterRedirects,H.rawUrl);this.setBrowserUrl(ce,H)}this.browserUrlTree=H.urlAfterRedirects}const oe=new f2(H.id,this.serializeUrl(H.extractedUrl),this.serializeUrl(H.urlAfterRedirects),H.targetSnapshot);a.next(oe)}));if(O&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:oe,extractedUrl:ce,source:Re,restoredState:lt,extras:Et}=T,Pt=new jx(oe,this.serializeUrl(ce),Re,lt);a.next(Pt);const Je=EE(ce,this.rootComponentType).snapshot;return Un(Object.assign(Object.assign({},T),{targetSnapshot:Je,urlAfterRedirects:ce,extras:Object.assign(Object.assign({},Et),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=T.rawUrl,T.resolve(null),Df}),t0(T=>{const{targetSnapshot:I,id:O,extractedUrl:N,rawUrl:H,extras:{skipLocationChange:oe,replaceUrl:ce}}=T;return this.hooks.beforePreactivation(I,{navigationId:O,appliedUrlTree:N,rawUrlTree:H,skipLocationChange:!!oe,replaceUrl:!!ce})}),js(T=>{const I=new p2(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(I)}),We(T=>Object.assign(Object.assign({},T),{guards:wP(T.targetSnapshot,T.currentSnapshot,this.rootContexts)})),function SP(t,e){return Or(n=>{const{targetSnapshot:a,currentSnapshot:u,guards:{canActivateChecks:m,canDeactivateChecks:v}}=n;return 0===v.length&&0===m.length?Un(Object.assign(Object.assign({},n),{guardsResult:!0})):function IP(t,e,n,a){return sr(t).pipe(Or(u=>function OP(t,e,n,a,u){const m=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return m&&0!==m.length?Un(m.map(T=>{const I=ty(T,e,u);let O;if(function aP(t){return t&&Vu(t.canDeactivate)}(I))O=Wl(I.canDeactivate(t,e,n,a));else{if(!Vu(I))throw new Error("Invalid CanDeactivate guard");O=Wl(I(t,e,n,a))}return O.pipe(If())})).pipe(Em()):Un(!0)}(u.component,u.route,n,e,a)),If(u=>!0!==u,!0))}(v,a,u,t).pipe(Or(T=>T&&function rP(t){return"boolean"==typeof t}(T)?function MP(t,e,n,a){return sr(e).pipe(Sf(u=>N_(function PP(t,e){return null!==t&&e&&e(new y2(t)),Un(!0)}(u.route.parent,a),function AP(t,e){return null!==t&&e&&e(new x2(t)),Un(!0)}(u.route,a),function RP(t,e,n){const a=e[e.length-1],m=e.slice(0,e.length-1).reverse().map(v=>function EP(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(v)).filter(v=>null!==v).map(v=>U_(()=>Un(v.guards.map(I=>{const O=ty(I,v.node,n);let N;if(function sP(t){return t&&Vu(t.canActivateChild)}(O))N=Wl(O.canActivateChild(a,t));else{if(!Vu(O))throw new Error("Invalid CanActivateChild guard");N=Wl(O(a,t))}return N.pipe(If())})).pipe(Em())));return Un(m).pipe(Em())}(t,u.path,n),function kP(t,e,n){const a=e.routeConfig?e.routeConfig.canActivate:null;if(!a||0===a.length)return Un(!0);const u=a.map(m=>U_(()=>{const v=ty(m,e,n);let T;if(function oP(t){return t&&Vu(t.canActivate)}(v))T=Wl(v.canActivate(e,t));else{if(!Vu(v))throw new Error("Invalid CanActivate guard");T=Wl(v(e,t))}return T.pipe(If())}));return Un(u).pipe(Em())}(t,u.route,n))),If(u=>!0!==u,!0))}(a,m,t,e):Un(T)),We(T=>Object.assign(Object.assign({},n),{guardsResult:T})))})}(this.ngModule.injector,T=>this.triggerEvent(T)),js(T=>{if(ed(T.guardsResult)){const O=Vx(`Redirecting to "${this.serializeUrl(T.guardsResult)}"`);throw O.url=T.guardsResult,O}const I=new m2(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot,!!T.guardsResult);this.triggerEvent(I)}),ua(T=>!!T.guardsResult||(this.restoreHistory(T),this.cancelNavigationTransition(T,""),!1)),t0(T=>{if(T.guards.canActivateChecks.length)return Un(T).pipe(js(I=>{const O=new g2(I.id,this.serializeUrl(I.extractedUrl),this.serializeUrl(I.urlAfterRedirects),I.targetSnapshot);this.triggerEvent(O)}),Oa(I=>{let O=!1;return Un(I).pipe(function VP(t,e){return Or(n=>{const{targetSnapshot:a,guards:{canActivateChecks:u}}=n;if(!u.length)return Un(n);let m=0;return sr(u).pipe(Sf(v=>function $P(t,e,n,a){return function GP(t,e,n,a){const u=ZE(t);if(0===u.length)return Un({});const m={};return sr(u).pipe(Or(v=>function HP(t,e,n,a){const u=ty(t,e,a);return Wl(u.resolve?u.resolve(e,n):u(e,n))}(t[v],e,n,a).pipe(js(T=>{m[v]=T}))),Ux(1),Or(()=>ZE(m).length===u.length?Un(m):Df))}(t._resolve,t,e,a).pipe(We(m=>(t._resolvedData=m,t.data=Object.assign(Object.assign({},t.data),TE(t,n).resolve),null)))}(v.route,a,t,e)),js(()=>m++),Ux(1),Or(v=>m===u.length?Un(n):Df))})}(this.paramsInheritanceStrategy,this.ngModule.injector),js({next:()=>O=!0,complete:()=>{O||(this.restoreHistory(I),this.cancelNavigationTransition(I,"At least one route resolver didn't emit any value."))}}))}),js(I=>{const O=new _2(I.id,this.serializeUrl(I.extractedUrl),this.serializeUrl(I.urlAfterRedirects),I.targetSnapshot);this.triggerEvent(O)}))}),t0(T=>{const{targetSnapshot:I,id:O,extractedUrl:N,rawUrl:H,extras:{skipLocationChange:oe,replaceUrl:ce}}=T;return this.hooks.afterPreactivation(I,{navigationId:O,appliedUrlTree:N,rawUrlTree:H,skipLocationChange:!!oe,replaceUrl:!!ce})}),We(T=>{const I=function G2(t,e,n){const a=xm(t,e._root,n?n._root:void 0);return new wE(a,e)}(this.routeReuseStrategy,T.targetSnapshot,T.currentRouterState);return Object.assign(Object.assign({},T),{targetRouterState:I})}),js(T=>{this.currentUrlTree=T.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(T.urlAfterRedirects,T.rawUrl),this.routerState=T.targetRouterState,"deferred"===this.urlUpdateStrategy&&(T.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,T),this.browserUrlTree=T.urlAfterRedirects)}),((t,e,n)=>We(a=>(new tP(e,a.targetRouterState,a.currentRouterState,n).activate(t),a)))(this.rootContexts,this.routeReuseStrategy,T=>this.triggerEvent(T)),js({next(){m=!0},complete(){m=!0}}),function c2(t){return e=>e.lift(new u2(t))}(()=>{var T;m||v||this.cancelNavigationTransition(u,`Navigation ID ${u.id} is not equal to the current navigation id ${this.navigationId}`),(null===(T=this.currentNavigation)||void 0===T?void 0:T.id)===u.id&&(this.currentNavigation=null)}),Yh(T=>{if(v=!0,function E2(t){return t&&t[aE]}(T)){const I=ed(T.url);I||(this.navigated=!0,this.restoreHistory(u,!0));const O=new rE(u.id,this.serializeUrl(u.extractedUrl),T.message);a.next(O),I?setTimeout(()=>{const N=this.urlHandlingStrategy.merge(T.url,this.rawUrlTree),H={skipLocationChange:u.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||KE(u.source)};this.scheduleNavigation(N,"imperative",null,H,{resolve:u.resolve,reject:u.reject,promise:u.promise})},0):u.resolve(!1)}else{this.restoreHistory(u,!0);const I=new d2(u.id,this.serializeUrl(u.extractedUrl),T);a.next(I);try{u.resolve(this.errorHandler(T))}catch(O){u.reject(O)}}return Df}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),n))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const a="popstate"===n.type?"popstate":"hashchange";"popstate"===a&&setTimeout(()=>{var u;const m={replaceUrl:!0},v=(null===(u=n.state)||void 0===u?void 0:u.navigationId)?n.state:null;if(v){const I=Object.assign({},v);delete I.navigationId,delete I.\u0275routerPageId,0!==Object.keys(I).length&&(m.state=I)}const T=this.parseUrl(n.url);this.scheduleNavigation(T,a,v,m)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){RE(n),this.config=n.map(Qx),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,a={}){const{relativeTo:u,queryParams:m,fragment:v,queryParamsHandling:T,preserveFragment:I}=a,O=u||this.routerState.root,N=I?this.currentUrlTree.fragment:v;let H=null;switch(T){case"merge":H=Object.assign(Object.assign({},this.currentUrlTree.queryParams),m);break;case"preserve":H=this.currentUrlTree.queryParams;break;default:H=m||null}return null!==H&&(H=this.removeEmptyProps(H)),function Z2(t,e,n,a,u){if(0===n.length)return Xx(e.root,e.root,e.root,a,u);const m=function W2(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new IE(!0,0,t);let e=0,n=!1;const a=t.reduce((u,m,v)=>{if("object"==typeof m&&null!=m){if(m.outlets){const T={};return zo(m.outlets,(I,O)=>{T[O]="string"==typeof I?I.split("/"):I}),[...u,{outlets:T}]}if(m.segmentPath)return[...u,m.segmentPath]}return"string"!=typeof m?[...u,m]:0===v?(m.split("/").forEach((T,I)=>{0==I&&"."===T||(0==I&&""===T?n=!0:".."===T?e++:""!=T&&u.push(T))}),u):[...u,m]},[]);return new IE(n,e,a)}(n);if(m.toRoot())return Xx(e.root,e.root,new _r([],{}),a,u);const v=function X2(t,e,n){if(t.isAbsolute)return new Kx(e.root,!0,0);if(-1===n.snapshot._lastPathIndex){const m=n.snapshot._urlSegment;return new Kx(m,m===e.root,0)}const a=Z_(t.commands[0])?0:1;return function K2(t,e,n){let a=t,u=e,m=n;for(;m>u;){if(m-=u,a=a.parent,!a)throw new Error("Invalid number of '../'");u=a.segments.length}return new Kx(a,!1,u-m)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+a,t.numberOfDoubleDots)}(m,e,t),T=v.processChildren?W_(v.segmentGroup,v.index,m.commands):ME(v.segmentGroup,v.index,m.commands);return Xx(e.root,v.segmentGroup,T,a,u)}(O,this.currentUrlTree,n,H,null!=N?N:null)}navigateByUrl(n,a={skipLocationChange:!1}){const u=ed(n)?n:this.parseUrl(n),m=this.urlHandlingStrategy.merge(u,this.rawUrlTree);return this.scheduleNavigation(m,"imperative",null,a)}navigate(n,a={skipLocationChange:!1}){return function tk(t){for(let e=0;e<t.length;e++){const n=t[e];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${e}`)}}(n),this.navigateByUrl(this.createUrlTree(n,a),a)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let a;try{a=this.urlSerializer.parse(n)}catch(u){a=this.malformedUriErrorHandler(u,this.urlSerializer,n)}return a}isActive(n,a){let u;if(u=!0===a?Object.assign({},QP):!1===a?Object.assign({},ek):a,ed(n))return dE(this.currentUrlTree,n,u);const m=this.parseUrl(n);return dE(this.currentUrlTree,m,u)}removeEmptyProps(n){return Object.keys(n).reduce((a,u)=>{const m=n[u];return null!=m&&(a[u]=m),a},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new _m(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,a,u,m,v){var T,I;if(this.disposed)return Promise.resolve(!1);let O,N,H;v?(O=v.resolve,N=v.reject,H=v.promise):H=new Promise((Re,lt)=>{O=Re,N=lt});const oe=++this.navigationId;let ce;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(u=this.location.getState()),ce=u&&u.\u0275routerPageId?u.\u0275routerPageId:m.replaceUrl||m.skipLocationChange?null!==(T=this.browserPageId)&&void 0!==T?T:0:(null!==(I=this.browserPageId)&&void 0!==I?I:0)+1):ce=0,this.setTransition({id:oe,targetPageId:ce,source:a,restoredState:u,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:m,resolve:O,reject:N,promise:H,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),H.catch(Re=>Promise.reject(Re))}setBrowserUrl(n,a){const u=this.urlSerializer.serialize(n),m=Object.assign(Object.assign({},a.extras.state),this.generateNgRouterState(a.id,a.targetPageId));this.location.isCurrentPathEqualTo(u)||a.extras.replaceUrl?this.location.replaceState(u,"",m):this.location.go(u,"",m)}restoreHistory(n,a=!1){var u,m;if("computed"===this.canceledNavigationResolution){const v=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(u=this.currentNavigation)||void 0===u?void 0:u.finalUrl)||0===v?this.currentUrlTree===(null===(m=this.currentNavigation)||void 0===m?void 0:m.finalUrl)&&0===v&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(v)}else"replace"===this.canceledNavigationResolution&&(a&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,a){const u=new rE(n.id,this.serializeUrl(n.extractedUrl),a);this.triggerEvent(u),n.resolve(!1)}generateNgRouterState(n,a){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:a}:{navigationId:n}}}return t.\u0275fac=function(n){Cv()},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();function KE(t){return"imperative"!==t}let r0=(()=>{class t{constructor(n,a,u,m,v){this.router=n,this.route=a,this.tabIndexAttribute=u,this.renderer=m,this.el=v,this.commands=null,this.onChanges=new Tt,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){if(null!=this.tabIndexAttribute)return;const a=this.renderer,u=this.el.nativeElement;null!==n?a.setAttribute(u,"tabindex",n):a.removeAttribute(u,"tabindex")}ngOnChanges(n){this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const n={skipLocationChange:kf(this.skipLocationChange),replaceUrl:kf(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,n),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:kf(this.preserveFragment)})}}return t.\u0275fac=function(n){return new(n||t)(yn(ha),yn(Pf),Ne("tabindex"),yn(c_),yn(Nu))},t.\u0275dir=Yr({type:t,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(n,a){1&n&&Qp("click",function(){return a.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Ps]}),t})(),ny=(()=>{class t{constructor(n,a,u){this.router=n,this.route=a,this.locationStrategy=u,this.commands=null,this.href=null,this.onChanges=new Tt,this.subscription=n.events.subscribe(m=>{m instanceof _m&&this.updateTargetUrlAndHref()})}set routerLink(n){this.commands=null!=n?Array.isArray(n)?n:[n]:null}ngOnChanges(n){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(n,a,u,m,v){if(0!==n||a||u||m||v||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const T={skipLocationChange:kf(this.skipLocationChange),replaceUrl:kf(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,T),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:kf(this.preserveFragment)})}}return t.\u0275fac=function(n){return new(n||t)(yn(ha),yn(Pf),yn(Tf))},t.\u0275dir=Yr({type:t,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(n,a){1&n&&Qp("click",function(m){return a.onClick(m.button,m.ctrlKey,m.shiftKey,m.altKey,m.metaKey)}),2&n&&nr("target",a.target)("href",a.href,wh)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Ps]}),t})();function kf(t){return""===t||!!t}let YE=(()=>{class t{constructor(n,a,u,m,v,T){this.router=n,this.element=a,this.renderer=u,this.cdr=m,this.link=v,this.linkWithHref=T,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new vs,this.routerEventsSubscription=n.events.subscribe(I=>{I instanceof _m&&this.update()})}ngAfterContentInit(){Un(this.links.changes,this.linksWithHrefs.changes,Un(null)).pipe(hi()).subscribe(n=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var n;null===(n=this.linkInputChangesSubscription)||void 0===n||n.unsubscribe();const a=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(u=>!!u).map(u=>u.onChanges);this.linkInputChangesSubscription=sr(a).pipe(hi()).subscribe(u=>{this.isActive!==this.isLinkActive(this.router)(u)&&this.update()})}set routerLinkActive(n){const a=Array.isArray(n)?n:n.split(" ");this.classes=a.filter(u=>!!u)}ngOnChanges(n){this.update()}ngOnDestroy(){var n;this.routerEventsSubscription.unsubscribe(),null===(n=this.linkInputChangesSubscription)||void 0===n||n.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const n=this.hasActiveLinks();this.isActive!==n&&(this.isActive=n,this.cdr.markForCheck(),this.classes.forEach(a=>{n?this.renderer.addClass(this.element.nativeElement,a):this.renderer.removeClass(this.element.nativeElement,a)}),this.isActiveChange.emit(n))})}isLinkActive(n){const a=function nk(t){return!!t.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return u=>!!u.urlTree&&n.isActive(u.urlTree,a)}hasActiveLinks(){const n=this.isLinkActive(this.router);return this.link&&n(this.link)||this.linkWithHref&&n(this.linkWithHref)||this.links.some(n)||this.linksWithHrefs.some(n)}}return t.\u0275fac=function(n){return new(n||t)(yn(ha),yn(Nu),yn(c_),yn(dx),yn(r0,8),yn(ny,8))},t.\u0275dir=Yr({type:t,selectors:[["","routerLinkActive",""]],contentQueries:function(n,a,u){if(1&n&&(Yv(u,r0,5),Yv(u,ny,5)),2&n){let m;f_(m=p_())&&(a.links=m),f_(m=p_())&&(a.linksWithHrefs=m)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[Ps]}),t})();class JE{}class QE{preload(e,n){return Un(null)}}let eT=(()=>{class t{constructor(n,a,u,m){this.router=n,this.injector=u,this.preloadingStrategy=m,this.loader=new WE(u,a,I=>n.triggerEvent(new iE(I)),I=>n.triggerEvent(new oE(I)))}setUpPreloading(){this.subscription=this.router.events.pipe(ua(n=>n instanceof _m),Sf(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(Fc);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,a){const u=[];for(const m of a)if(m.loadChildren&&!m.canLoad&&m._loadedConfig){const v=m._loadedConfig;u.push(this.processRoutes(v.module,v.routes))}else m.loadChildren&&!m.canLoad?u.push(this.preloadConfig(n,m)):m.children&&u.push(this.processRoutes(n,m.children));return sr(u).pipe(hi(),We(m=>{}))}preloadConfig(n,a){return this.preloadingStrategy.preload(a,()=>(a._loadedConfig?Un(a._loadedConfig):this.loader.load(n.injector,a)).pipe(Or(m=>(a._loadedConfig=m,this.processRoutes(m.module,m.routes)))))}}return t.\u0275fac=function(n){return new(n||t)(on(ha),on(Y1),on(Vi),on(JE))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})(),o0=(()=>{class t{constructor(n,a,u={}){this.router=n,this.viewportScroller=a,this.options=u,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},u.scrollPositionRestoration=u.scrollPositionRestoration||"disabled",u.anchorScrolling=u.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof jx?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof _m&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof sE&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,a){this.router.triggerEvent(new sE(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,a))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(n){Cv()},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();const td=new Vt("ROUTER_CONFIGURATION"),tT=new Vt("ROUTER_FORROOT_GUARD"),ik=[vx,{provide:gE,useClass:_E},{provide:ha,useFactory:function ck(t,e,n,a,u,m,v={},T,I){const O=new ha(null,t,e,n,a,u,cE(m));return T&&(O.urlHandlingStrategy=T),I&&(O.routeReuseStrategy=I),function uk(t,e){t.errorHandler&&(e.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(e.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(e.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(e.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(e.urlUpdateStrategy=t.urlUpdateStrategy),t.canceledNavigationResolution&&(e.canceledNavigationResolution=t.canceledNavigationResolution)}(v,O),v.enableTracing&&O.events.subscribe(N=>{var H,oe;null===(H=console.group)||void 0===H||H.call(console,`Router Event: ${N.constructor.name}`),console.log(N.toString()),console.log(N),null===(oe=console.groupEnd)||void 0===oe||oe.call(console)}),O},deps:[gE,Tm,vx,Vi,Y1,n0,td,[class XP{},new Fs],[class qP{},new Fs]]},Tm,{provide:Pf,useFactory:function hk(t){return t.routerState.root},deps:[ha]},eT,QE,class rk{preload(e,n){return n().pipe(Yh(()=>Un(null)))}},{provide:td,useValue:{enableTracing:!1}}];function ok(){return new nw("Router",ha)}let nT=(()=>{class t{constructor(n,a){}static forRoot(n,a){return{ngModule:t,providers:[ik,rT(n),{provide:tT,useFactory:lk,deps:[[ha,new Fs,new wa]]},{provide:td,useValue:a||{}},{provide:Tf,useFactory:ak,deps:[Kh,[new hu(yx),new Fs],td]},{provide:o0,useFactory:sk,deps:[ha,XM,td]},{provide:JE,useExisting:a&&a.preloadingStrategy?a.preloadingStrategy:QE},{provide:nw,multi:!0,useFactory:ok},[s0,{provide:y_,multi:!0,useFactory:dk,deps:[s0]},{provide:iT,useFactory:fk,deps:[s0]},{provide:K1,multi:!0,useExisting:iT}]]}}static forChild(n){return{ngModule:t,providers:[rT(n)]}}}return t.\u0275fac=function(n){return new(n||t)(on(tT,8),on(ha,8))},t.\u0275mod=oi({type:t}),t.\u0275inj=br({}),t})();function sk(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new o0(t,e,n)}function ak(t,e,n={}){return n.useHash?new II(t,e):new bw(t,e)}function lk(t){return"guarded"}function rT(t){return[{provide:Qr,multi:!0,useValue:t},{provide:n0,multi:!0,useValue:t}]}let s0=(()=>{class t{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Tt}appInitializer(){return this.injector.get(CI,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let a=null;const u=new Promise(T=>a=T),m=this.injector.get(ha),v=this.injector.get(td);return"disabled"===v.initialNavigation?(m.setUpLocationChangeListener(),a(!0)):"enabled"===v.initialNavigation||"enabledBlocking"===v.initialNavigation?(m.hooks.afterPreactivation=()=>this.initNavigation?Un(null):(this.initNavigation=!0,a(!0),this.resultOfPreactivationDone),m.initialNavigation()):a(!0),u})}bootstrapListener(n){const a=this.injector.get(td),u=this.injector.get(eT),m=this.injector.get(o0),v=this.injector.get(ha),T=this.injector.get(v_);n===T.components[0]&&(("enabledNonBlocking"===a.initialNavigation||void 0===a.initialNavigation)&&v.initialNavigation(),u.setUpPreloading(),m.init(),v.resetRootComponentType(T.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return t.\u0275fac=function(n){return new(n||t)(on(Vi))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();function dk(t){return t.appInitializer.bind(t)}function fk(t){return t.bootstrapListener.bind(t)}const iT=new Vt("Router Initializer");let mk=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Dr({type:t,selectors:[["app-home"]],decls:2,vars:0,template:function(n,a){1&n&&(_s(0,"p"),pl(1,"home works!"),Bs())},styles:[""]}),t})();function oT(t,e,n,a,u,m,v){try{var T=t[m](v),I=T.value}catch(O){return void n(O)}T.done?e(I):Promise.resolve(I).then(a,u)}function sT(t){return function(){var e=this,n=arguments;return new Promise(function(a,u){var m=t.apply(e,n);function v(I){oT(m,a,u,v,T,"next",I)}function T(I){oT(m,a,u,v,T,"throw",I)}v(void 0)})}}const nd={production:!1,appVersion:fa(147).i8,lastUpdated:"11:42",environmentName:"Production",CompanyName:"Actilogic",AuthorName:"Antonio Joboy",mapbox:{accessToken:"pk.eyJ1IjoiYW50b25pb2pvYm95IiwiYSI6ImNsMXBhd3hsYTBhb24zY2tiaTNjMG1mMTcifQ.Y7o3Fo3xLvPXMAbTnrc7IA"}};class gk{constructor(e){this.title="",this.ttl="",this.link="",this.description="",this.language="",this.copyright="",this.lastBuildDate="",this.image=null,this.item=null,this.rss=null,this.title=e.title,this.ttl=e.ttl,this.link=e.link,this.description=e.description,this.language=e.language,this.copyright=e.copyright,this.lastBuildDate=e.lastBuildDate,this.image=e.image,this.item=e.item,this.rss=e.rss}toString(){return this.copyright}}class Gc{constructor(){}xmlToJson(e){let n={};if(1===e.nodeType){if(e.attributes.length>0){n["@attributes"]={};for(let a=0;a<e.attributes.length;a+=1){const u=e.attributes.item(a);n["@attributes"][u.nodeName]=u.nodeValue}}}else 3===e.nodeType&&(n=e.nodeValue);if(e.hasChildNodes()&&1===e.childNodes.length&&3===e.childNodes[0].nodeType)n=e.childNodes[0].nodeValue;else if(e.hasChildNodes())for(let a=0;a<e.childNodes.length;a+=1){const u=e.childNodes.item(a),m=u.nodeName;if(void 0===n[m])n[m]=this.xmlToJson(u);else{if(void 0===n[m].push){const v=n[m];n[m]=[],n[m].push(v)}n[m].push(this.xmlToJson(u))}}return n}}Gc.\u0275fac=function(e){return new(e||Gc)},Gc.\u0275prov=hn({token:Gc,factory:Gc.\u0275fac,providedIn:"root"}),Gc.ngInjectableDef=is({factory:function(){return new Gc},token:Gc,providedIn:"root"});class aT{}class lT{}class Hc{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(n=>{const a=n.indexOf(":");if(a>0){const u=n.slice(0,a),m=u.toLowerCase(),v=n.slice(a+1).trim();this.maybeSetNormalizedName(u,m),this.headers.has(m)?this.headers.get(m).push(v):this.headers.set(m,[v])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(n=>{let a=e[n];const u=n.toLowerCase();"string"==typeof a&&(a=[a]),a.length>0&&(this.headers.set(u,a),this.maybeSetNormalizedName(n,u))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const n=this.headers.get(e.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,n){return this.clone({name:e,value:n,op:"a"})}set(e,n){return this.clone({name:e,value:n,op:"s"})}delete(e,n){return this.clone({name:e,value:n,op:"d"})}maybeSetNormalizedName(e,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,e)}init(){this.lazyInit&&(this.lazyInit instanceof Hc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(n=>{this.headers.set(n,e.headers.get(n)),this.normalizedNames.set(n,e.normalizedNames.get(n))})}clone(e){const n=new Hc;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Hc?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([e]),n}applyUpdate(e){const n=e.name.toLowerCase();switch(e.op){case"a":case"s":let a=e.value;if("string"==typeof a&&(a=[a]),0===a.length)return;this.maybeSetNormalizedName(e.name,n);const u=("a"===e.op?this.headers.get(n):void 0)||[];u.push(...a),this.headers.set(n,u);break;case"d":const m=e.value;if(m){let v=this.headers.get(n);if(!v)return;v=v.filter(T=>-1===m.indexOf(T)),0===v.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,v)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>e(this.normalizedNames.get(n),this.headers.get(n)))}}class _k{encodeKey(e){return cT(e)}encodeValue(e){return cT(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const vk=/%(\d[a-f0-9])/gi,xk={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function cT(t){return encodeURIComponent(t).replace(vk,(e,n)=>{var a;return null!==(a=xk[n])&&void 0!==a?a:e})}function uT(t){return`${t}`}class $u{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new _k,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function yk(t,e){const n=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(u=>{const m=u.indexOf("="),[v,T]=-1==m?[e.decodeKey(u),""]:[e.decodeKey(u.slice(0,m)),e.decodeValue(u.slice(m+1))],I=n.get(v)||[];I.push(T),n.set(v,I)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(n=>{const a=e.fromObject[n];this.map.set(n,Array.isArray(a)?a:[a])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const n=this.map.get(e);return n?n[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,n){return this.clone({param:e,value:n,op:"a"})}appendAll(e){const n=[];return Object.keys(e).forEach(a=>{const u=e[a];Array.isArray(u)?u.forEach(m=>{n.push({param:a,value:m,op:"a"})}):n.push({param:a,value:u,op:"a"})}),this.clone(n)}set(e,n){return this.clone({param:e,value:n,op:"s"})}delete(e,n){return this.clone({param:e,value:n,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const n=this.encoder.encodeKey(e);return this.map.get(e).map(a=>n+"="+this.encoder.encodeValue(a)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const n=new $u({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(e),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const n=("a"===e.op?this.map.get(e.param):void 0)||[];n.push(uT(e.value)),this.map.set(e.param,n);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let a=this.map.get(e.param)||[];const u=a.indexOf(uT(e.value));-1!==u&&a.splice(u,1),a.length>0?this.map.set(e.param,a):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class bk{constructor(){this.map=new Map}set(e,n){return this.map.set(e,n),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function hT(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function dT(t){return"undefined"!=typeof Blob&&t instanceof Blob}function fT(t){return"undefined"!=typeof FormData&&t instanceof FormData}class Im{constructor(e,n,a,u){let m;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function wk(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||u?(this.body=void 0!==a?a:null,m=u):m=a,m&&(this.reportProgress=!!m.reportProgress,this.withCredentials=!!m.withCredentials,m.responseType&&(this.responseType=m.responseType),m.headers&&(this.headers=m.headers),m.context&&(this.context=m.context),m.params&&(this.params=m.params)),this.headers||(this.headers=new Hc),this.context||(this.context=new bk),this.params){const v=this.params.toString();if(0===v.length)this.urlWithParams=n;else{const T=n.indexOf("?");this.urlWithParams=n+(-1===T?"?":T<n.length-1?"&":"")+v}}else this.params=new $u,this.urlWithParams=n}serializeBody(){return null===this.body?null:hT(this.body)||dT(this.body)||fT(this.body)||function Ek(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof $u?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||fT(this.body)?null:dT(this.body)?this.body.type||null:hT(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof $u?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var n;const a=e.method||this.method,u=e.url||this.url,m=e.responseType||this.responseType,v=void 0!==e.body?e.body:this.body,T=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,I=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let O=e.headers||this.headers,N=e.params||this.params;const H=null!==(n=e.context)&&void 0!==n?n:this.context;return void 0!==e.setHeaders&&(O=Object.keys(e.setHeaders).reduce((oe,ce)=>oe.set(ce,e.setHeaders[ce]),O)),e.setParams&&(N=Object.keys(e.setParams).reduce((oe,ce)=>oe.set(ce,e.setParams[ce]),N)),new Im(a,u,v,{params:N,headers:O,context:H,reportProgress:I,responseType:m,withCredentials:T})}}var Yi=(()=>((Yi=Yi||{})[Yi.Sent=0]="Sent",Yi[Yi.UploadProgress=1]="UploadProgress",Yi[Yi.ResponseHeader=2]="ResponseHeader",Yi[Yi.DownloadProgress=3]="DownloadProgress",Yi[Yi.Response=4]="Response",Yi[Yi.User=5]="User",Yi))();class a0{constructor(e,n=200,a="OK"){this.headers=e.headers||new Hc,this.status=void 0!==e.status?e.status:n,this.statusText=e.statusText||a,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class l0 extends a0{constructor(e={}){super(e),this.type=Yi.ResponseHeader}clone(e={}){return new l0({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class ry extends a0{constructor(e={}){super(e),this.type=Yi.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new ry({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class pT extends a0{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function c0(t,e){return{body:e,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let mT=(()=>{class t{constructor(n){this.handler=n}request(n,a,u={}){let m;if(n instanceof Im)m=n;else{let I,O;I=u.headers instanceof Hc?u.headers:new Hc(u.headers),u.params&&(O=u.params instanceof $u?u.params:new $u({fromObject:u.params})),m=new Im(n,a,void 0!==u.body?u.body:null,{headers:I,context:u.context,params:O,reportProgress:u.reportProgress,responseType:u.responseType||"json",withCredentials:u.withCredentials})}const v=Un(m).pipe(Sf(I=>this.handler.handle(I)));if(n instanceof Im||"events"===u.observe)return v;const T=v.pipe(ua(I=>I instanceof ry));switch(u.observe||"body"){case"body":switch(m.responseType){case"arraybuffer":return T.pipe(We(I=>{if(null!==I.body&&!(I.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return I.body}));case"blob":return T.pipe(We(I=>{if(null!==I.body&&!(I.body instanceof Blob))throw new Error("Response is not a Blob.");return I.body}));case"text":return T.pipe(We(I=>{if(null!==I.body&&"string"!=typeof I.body)throw new Error("Response is not a string.");return I.body}));default:return T.pipe(We(I=>I.body))}case"response":return T;default:throw new Error(`Unreachable: unhandled observe type ${u.observe}}`)}}delete(n,a={}){return this.request("DELETE",n,a)}get(n,a={}){return this.request("GET",n,a)}head(n,a={}){return this.request("HEAD",n,a)}jsonp(n,a){return this.request("JSONP",n,{params:(new $u).append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,a={}){return this.request("OPTIONS",n,a)}patch(n,a,u={}){return this.request("PATCH",n,c0(u,a))}post(n,a,u={}){return this.request("POST",n,c0(u,a))}put(n,a,u={}){return this.request("PUT",n,c0(u,a))}}return t.\u0275fac=function(n){return new(n||t)(on(aT))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();class gT{constructor(e,n){this.next=e,this.interceptor=n}handle(e){return this.interceptor.intercept(e,this.next)}}const _T=new Vt("HTTP_INTERCEPTORS");let Tk=(()=>{class t{intercept(n,a){return a.handle(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();const Ck=/^\)\]\}',?\n/;let yT=(()=>{class t{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new gt(a=>{const u=this.xhrFactory.build();if(u.open(n.method,n.urlWithParams),n.withCredentials&&(u.withCredentials=!0),n.headers.forEach((ce,Re)=>u.setRequestHeader(ce,Re.join(","))),n.headers.has("Accept")||u.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const ce=n.detectContentTypeHeader();null!==ce&&u.setRequestHeader("Content-Type",ce)}if(n.responseType){const ce=n.responseType.toLowerCase();u.responseType="json"!==ce?ce:"text"}const m=n.serializeBody();let v=null;const T=()=>{if(null!==v)return v;const ce=u.statusText||"OK",Re=new Hc(u.getAllResponseHeaders()),lt=function Dk(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(u)||n.url;return v=new l0({headers:Re,status:u.status,statusText:ce,url:lt}),v},I=()=>{let{headers:ce,status:Re,statusText:lt,url:Et}=T(),Pt=null;204!==Re&&(Pt=void 0===u.response?u.responseText:u.response),0===Re&&(Re=Pt?200:0);let Je=Re>=200&&Re<300;if("json"===n.responseType&&"string"==typeof Pt){const sn=Pt;Pt=Pt.replace(Ck,"");try{Pt=""!==Pt?JSON.parse(Pt):null}catch(Wn){Pt=sn,Je&&(Je=!1,Pt={error:Wn,text:Pt})}}Je?(a.next(new ry({body:Pt,headers:ce,status:Re,statusText:lt,url:Et||void 0})),a.complete()):a.error(new pT({error:Pt,headers:ce,status:Re,statusText:lt,url:Et||void 0}))},O=ce=>{const{url:Re}=T(),lt=new pT({error:ce,status:u.status||0,statusText:u.statusText||"Unknown Error",url:Re||void 0});a.error(lt)};let N=!1;const H=ce=>{N||(a.next(T()),N=!0);let Re={type:Yi.DownloadProgress,loaded:ce.loaded};ce.lengthComputable&&(Re.total=ce.total),"text"===n.responseType&&!!u.responseText&&(Re.partialText=u.responseText),a.next(Re)},oe=ce=>{let Re={type:Yi.UploadProgress,loaded:ce.loaded};ce.lengthComputable&&(Re.total=ce.total),a.next(Re)};return u.addEventListener("load",I),u.addEventListener("error",O),u.addEventListener("timeout",O),u.addEventListener("abort",O),n.reportProgress&&(u.addEventListener("progress",H),null!==m&&u.upload&&u.upload.addEventListener("progress",oe)),u.send(m),a.next({type:Yi.Sent}),()=>{u.removeEventListener("error",O),u.removeEventListener("abort",O),u.removeEventListener("load",I),u.removeEventListener("timeout",O),n.reportProgress&&(u.removeEventListener("progress",H),null!==m&&u.upload&&u.upload.removeEventListener("progress",oe)),u.readyState!==u.DONE&&u.abort()}})}}return t.\u0275fac=function(n){return new(n||t)(on(Bw))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();const u0=new Vt("XSRF_COOKIE_NAME"),h0=new Vt("XSRF_HEADER_NAME");class vT{}let Sk=(()=>{class t{constructor(n,a,u){this.doc=n,this.platform=a,this.cookieName=u,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=Pw(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return t.\u0275fac=function(n){return new(n||t)(on(ca),on(hm),on(u0))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})(),d0=(()=>{class t{constructor(n,a){this.tokenService=n,this.headerName=a}intercept(n,a){const u=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||u.startsWith("http://")||u.startsWith("https://"))return a.handle(n);const m=this.tokenService.getToken();return null!==m&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,m)})),a.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(on(vT),on(h0))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})(),Ik=(()=>{class t{constructor(n,a){this.backend=n,this.injector=a,this.chain=null}handle(n){if(null===this.chain){const a=this.injector.get(_T,[]);this.chain=a.reduceRight((u,m)=>new gT(u,m),this.backend)}return this.chain.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(on(lT),on(Vi))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})(),Mk=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:d0,useClass:Tk}]}}static withOptions(n={}){return{ngModule:t,providers:[n.cookieName?{provide:u0,useValue:n.cookieName}:[],n.headerName?{provide:h0,useValue:n.headerName}:[]]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=oi({type:t}),t.\u0275inj=br({providers:[d0,{provide:_T,useExisting:d0,multi:!0},{provide:vT,useClass:Sk},{provide:u0,useValue:"XSRF-TOKEN"},{provide:h0,useValue:"X-XSRF-TOKEN"}]}),t})(),Ak=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=oi({type:t}),t.\u0275inj=br({providers:[mT,{provide:aT,useClass:Ik},yT,{provide:lT,useExisting:yT}],imports:[[Mk.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})(),xT=(()=>{class t{constructor(n){this.http=n,this.fuelWatchURL="https://www.fuelwatch.wa.gov.au/fuelwatch/fuelWatchRSS?",this.CORS_PROXY="https://cors-anywhere.herokuapp.com/"}get(){return this.http.get(nd.production?this.fuelWatchURL:this.CORS_PROXY+this.fuelWatchURL)}static test(){return console.log("test function called"),"this is the returened data from test"}}return t.\u0275fac=function(n){return new(n||t)(on(mT))},t.\u0275prov=hn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Pk=(()=>{class t{constructor(n){this.viewContainerRef=n}}return t.\u0275fac=function(n){return new(n||t)(yn(Pa))},t.\u0275dir=Yr({type:t,selectors:[["","dynamicChildLoader",""]]}),t})();var Mm=fa(898);let kk=(()=>{class t{constructor(){}getPosition(){return new Promise((n,a)=>{navigator.geolocation.getCurrentPosition(u=>{n({lng:u.coords.longitude,lat:u.coords.latitude})},u=>{a(u)})})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=hn({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Rk=fa(518);let Ok=(()=>{class t{constructor(){this.style="mapbox://styles/antoniojoboy/cl2569rep000415mf7upq7j1m",this.lat=-31.9523,this.lng=115.8613,this.perth=[this.lng,this.lat],this.currentLocation=this.perth,this.zoom=13,this.pumpIcon="../../assets/Mapbox-marker/Fuel-Saver/pump-256x256.png",this.geojson={},this.locationService=new kk,this.feed={},Mm.accessToken=nd.mapbox.accessToken}ngOnInit(){this.map=new Mm.Map({container:"map",style:this.style,zoom:this.zoom,center:this.currentLocation}),this.map.addControl(new Mm.NavigationControl),this.map.addControl(new Rk({accessToken:Mm.accessToken,unit:"metric"}),"top-left"),this.map.on("load",()=>{this.gotoCurrentLocation(),this.map.loadImage(this.pumpIcon,(a,u)=>{if(a)throw a;this.map.addImage("pump",u),this.addFuelStations()}),this.addUser()}),this.map.on("click","stations",a=>{var u=a.features[0].geometry.coordinates.slice(),m=JSON.parse(a.features[0].properties.popup).html;console.log("station.features[0]",a.features[0]);var v=this.map.queryRenderedFeatures(a.point,{layers:["stations"]}),T=v;for(v.length&&(T=v[0]);Math.abs(a.lngLat.lng-u[0])>180;)u[0]+=a.lngLat.lng>u[0]?360:-360;console.log("feature()",T),(new Mm.Popup).setLngLat(u).setHTML(m).addTo(this.map),document.getElementById("calcCost").addEventListener("click",function(){console.log("clicked a button"),console.log(T),function n(){alert("are we there yet"),console.log("this.map",this.map)}()})}),this.map.on("mouseenter","stations",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave","stations",()=>{this.map.getCanvas().style.cursor=""})}goTo(n){console.log("location",n),console.log("about to fly to 1",n),this.map.flyTo({center:n,zoom:this.zoom+3,essential:!0}),console.log("flew")}ngOnChanges(n){for(let a in n)"feed"===a&&(this.FuelWatchFeedtoGeoJSON(n[a].currentValue),this.addFuelStations())}addUser(){this.map.loadImage(this.pumpIcon,(n,a)=>{this.map.addImage("pump",a),console.log("images load for pump",a)}),this.map.addLayer({id:"z",type:"symbol",source:"fuelStations",layout:{"icon-image":"pump","icon-size":.1}})}addFuelStations(){console.log("adding from this",this.geojson);var n=this.map.getSource("fuelStations");n?n.setData(this.geojson):this.map.addSource("fuelStations",{type:"geojson",data:this.geojson}),this.map.addLayer({id:"stations",type:"symbol",source:"fuelStations",layout:{"icon-image":"pump","icon-size":.1}})}FuelWatchFeedtoGeoJSON(n){var a={type:"FeatureCollection",features:[]};n.item.forEach(u=>{a.features.push({type:"Feature",geometry:{type:"Point",coordinates:[u.longitude,u.latitude]},properties:{title:u.title,description:u.description,popup:{html:this.toPopup(u)}}})}),this.geojson=a,console.log("this.geojson",this.geojson)}toPopup(n){return`\n    <div class="simplebar-content" style="padding: 0px;">\n    <div class="fuel-station__name-wrapper">\n        <div class="container-fluid">\n\n            <div class="row position-relative">\n                <div class="col-8 col-lg-9">\n                    <div>\n                        <h2>${n["trading-name"]}</h2>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n\n    <div class="fuel-station__address-wrapper">\n\n        <hr class="divider">\n\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-12">\n                    <span>Address: ${n.address}</span>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="col-12">\n                    <div class="fuel-station__contact-number">\n                        Call: <a href="tel:${n.phone}">${n.phone}</a>\n                    </div>\n                </div>\n            </div>\n\n            <hr class="divider">\n\n        </div>\n\n    </div>\n\n    <div class="fuel-station__pricing-wrapper ng-star-inserted">\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-12">\n                    <h4 class="fuel-price__title">ULP prices</h4>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="col-6 ng-star-inserted">\n                    <div>\n                        <p class="h2">\n                            ${n.price}\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="fuel-station__direction-wrapper ng-star-inserted">\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-12">\n                    <button id="calcCost" \n                        <span class="mat-button-wrapper">\n                            Directions\n                            <mat-icon role="img" class="mat-icon notranslate material-icons mat-icon-no-color"\n                                aria-hidden="true" data-mat-icon-type="font">\n                                directions\n                            </mat-icon>\n                        </span>\n                        <span matripple="" class="mat-ripple mat-button-ripple"></span>\n                        <span class="mat-button-focus-overlay"> </span>\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<app-popup></app-popup>\n`}testMap(){alert("clicked the calc button on popup")}gotoCurrentLocation(){this.locationService.getPosition().then(n=>{console.log(`Positon: ${n.lng} ${n.lat}`),this.currentLocation=[n.lng,n.lat],this.goTo(this.currentLocation)})}getLocation(){this.locationService.getPosition().then(n=>{console.log(`Positon: ${n.lng} ${n.lat}`)})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Dr({type:t,selectors:[["app-fuel-map"]],viewQuery:function(n,a){if(1&n&&function I1(t,e,n){const a=Qn();a.firstCreatePass&&(A1(a,new D1(t,e,n),-1),2==(2&e)&&(a.staticViewQueries=!0)),M1(a,nt(),e)}(Pk,7),2&n){let u;f_(u=p_())&&(a.dynamicChild=u.first)}},inputs:{feed:"feed"},features:[Ps],decls:5,vars:0,consts:[["href","https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css","rel","stylesheet"],["id","map-container"],["id","map"]],template:function(n,a){1&n&&(Lc(0,"link",0),_s(1,"p"),pl(2,"fuel-map works!"),Bs(),_s(3,"div",1),Lc(4,"div",2),Bs())},styles:["#map-container[_ngcontent-%COMP%]{top:10;bottom:0}#map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}.marker[_ngcontent-%COMP%]{background-size:cover;width:50px;height:50px;border-radius:50%}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:200px}.mapboxgl-popup-content[_ngcontent-%COMP%]{text-align:center;font-family:Open Sans,sans-serif}"]}),t})();const Lk=[{path:"home",component:mk},{path:"FuelSaver",component:(()=>{class t{constructor(n,a){this.FuelWatch=n,this.FuelWatchService=a,this.environment=nd,this.FuelWatchFeedList=null,this.ngxXml2jsonService=new Gc,this.Feed=new gk({})}ngOnInit(){var n=this;return sT(function*(){yield n.loadData()})()}loadData(){var n=this;return sT(function*(){n.FuelWatchService.get().subscribe(a=>{var m=n.parseXML(a.rss.channel);n.Feed=m.rss.channel},a=>{if(nd.production)alert("Error in loading the"),console.error("Error in loading the fuel watch rss Feed");else{var m=n.parseXML(a.error.text);n.Feed=m.rss.channel}})})()}parseXML(n){var u=(new DOMParser).parseFromString(n,"text/xml");return this.ngxXml2jsonService.xmlToJson(u)}}return t.\u0275fac=function(n){return new(n||t)(yn(xT),yn(xT))},t.\u0275cmp=Dr({type:t,selectors:[["app-fuel-saver"]],decls:7,vars:2,consts:[["id","fuelwatchload",3,"click"],[3,"feed"]],template:function(n,a){1&n&&(_s(0,"p"),pl(1),Bs(),_s(2,"p"),pl(3,"fuel-saver works! 2"),Bs(),_s(4,"button",0),Qp("click",function(){return a.loadData()}),pl(5," CLICK ME TO LOAD DATA\n"),Bs(),Lc(6,"app-fuel-map",1)),2&n&&(Ec(1),r_(" Current environment: ",a.environment.environmentName,"\n"),Ec(5),Jp("feed",a.Feed))},directives:[Ok],styles:[""]}),t})()},{path:"",redirectTo:"/",pathMatch:"full"},{path:"**",redirectTo:"/",pathMatch:"full"}];let Fk=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=oi({type:t}),t.\u0275inj=br({imports:[[nT.forRoot(Lk)],nT]}),t})();const zk=function(){return["/home"]},Nk=function(){return["/FuelSaver"]};let Bk=(()=>{class t{constructor(){}ngOnInit(){var n=document.getElementById("myTopnav");"topnav"===n.className?n.className+=" responsive":n.className="topnav",document.getElementById("myTopnav").getElementsByClassName("btn")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Dr({type:t,selectors:[["app-navigation-bar"]],decls:10,vars:4,consts:[[1,"navbar","navbar-fixed-top","navbar-dark","bg-inverse"],["rel","stylesheet","href","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"],[1,"title"],["id","myTopnav",1,"topnav"],["routerLinkActive","active",3,"routerLink"]],template:function(n,a){1&n&&(_s(0,"nav",0),Lc(1,"link",1),_s(2,"div",2),pl(3," Actilogic "),Bs(),_s(4,"div",3)(5,"a",4),pl(6,"Home"),Bs(),_s(7,"a",4),pl(8,"Fuel Saver"),Bs()()(),Lc(9,"router-outlet")),2&n&&(Ec(5),Jp("routerLink",Vv(2,zk)),Ec(2),Jp("routerLink",Vv(3,Nk)))},directives:[ny,YE,X_],styles:[".topnav[_ngcontent-%COMP%]{background-color:#333;overflow:hidden}.topnav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{float:left;display:block;color:#f2f2f2;text-align:center;padding:14px 16px;text-decoration:none;font-size:17px}.topnav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#ddd;color:#000}.topnav[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:#04aa6d;color:#fff}.topnav[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:none}.title[_ngcontent-%COMP%]{display:block;padding:5px 10px;color:#1fc551;font-size:3em;letter-spacing:1px;text-align:center;text-decoration:none;text-transform:uppercase}.title[_ngcontent-%COMP%]:hover{background:rgba(0,0,0,0)}"]}),t})(),Uk=(()=>{class t{constructor(){this.a=123,this.environment=nd,this.year=(new Date).getFullYear()}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Dr({type:t,selectors:[["app-footer"]],decls:3,vars:4,consts:[[1,"footer-basic"],[1,"copyright"]],template:function(n,a){1&n&&(_s(0,"footer",0)(1,"p",1),pl(2),Bs()()),2&n&&(Ec(2),kv("",a.environment.CompanyName," \xa9 ",a.year," ",a.environment.AuthorName," version: ",a.environment.appVersion,""))},styles:[".footer-basic[_ngcontent-%COMP%]{padding:40px 0;background-color:#fff;color:#4b4c4d;width:100%;height:60px;margin-top:auto;right:0;bottom:0;left:0;flex-shrink:0}.footer-basic[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:0;list-style:none;text-align:center;font-size:18px;line-height:1.6;margin-bottom:0}.footer-basic[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:0 10px}.footer-basic[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:inherit;text-decoration:none;opacity:.8}.footer-basic[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{opacity:1}.footer-basic[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%]{text-align:center;padding-bottom:25px}.footer-basic[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{font-size:24px;width:40px;height:40px;line-height:40px;display:inline-block;text-align:center;border-radius:50%;border:1px solid #ccc;margin:0 8px;color:inherit;opacity:.75}.footer-basic[_ngcontent-%COMP%]   .social[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{opacity:.9}.footer-basic[_ngcontent-%COMP%]   .copyright[_ngcontent-%COMP%]{margin-top:15px;text-align:center;font-size:13px;color:#aaa;margin-bottom:0}"]}),t})(),jk=(()=>{class t{constructor(){this.title="Actilogic"}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=Dr({type:t,selectors:[["app-root"]],decls:3,vars:0,template:function(n,a){1&n&&Lc(0,"app-navigation-bar")(1,"app-footer")(2,"router-outlet")},directives:[Bk,Uk,X_],styles:['[_nghost-%COMP%]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;font-size:14px;color:#333;box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{margin:8px 0;color:#f0f8ff}p[_ngcontent-%COMP%]{margin:0;color:#f0f8ff}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{background-color:#171716}a[_ngcontent-%COMP%], a[_ngcontent-%COMP%]:visited, a[_ngcontent-%COMP%]:hover{color:#1976d2;text-decoration:none}a[_ngcontent-%COMP%]:hover{color:#125699}footer[_ngcontent-%COMP%]{margin-top:8px;display:flex;align-items:center;line-height:20px}footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center}svg#clouds[_ngcontent-%COMP%]{position:fixed;background-color:#171716;bottom:-160px;left:-230px;z-index:-10;width:1920px}@media screen and (max-width: 767px){.card-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(.circle-link), .terminal[_ngcontent-%COMP%]{width:100%}.card[_ngcontent-%COMP%]:not(.highlight-card){height:16px;margin:8px 0}.card.highlight-card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:72px}svg#rocket-smoke[_ngcontent-%COMP%]{right:120px;transform:rotate(-5deg)}}@media screen and (max-width: 575px){svg#rocket-smoke[_ngcontent-%COMP%]{display:none;visibility:hidden}}']}),t})();function f0(t,e,n,a){return pa(n)&&(a=n,n=void 0),a?f0(t,e,n).pipe(We(u=>Ie(u)?a(...u):a(u))):new gt(u=>{bT(t,e,function m(v){u.next(arguments.length>1?Array.prototype.slice.call(arguments):v)},u,n)})}function bT(t,e,n,a,u){let m;if(function Gk(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){const v=t;t.addEventListener(e,n,u),m=()=>v.removeEventListener(e,n,u)}else if(function $k(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){const v=t;t.on(e,n),m=()=>v.off(e,n)}else if(function Vk(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){const v=t;t.addListener(e,n),m=()=>v.removeListener(e,n)}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(let v=0,T=t.length;v<T;v++)bT(t[v],e,n,a,u)}a.add(m)}const Gu=new gt(jc);class qk extends ae{constructor(e,n){super()}schedule(e,n=0){return this}}let wT=(()=>{class t{constructor(n,a=t.now){this.SchedulerAction=n,this.now=a}schedule(n,a=0,u){return new this.SchedulerAction(this,n).schedule(u,a)}}return t.now=()=>Date.now(),t})();class Hu extends wT{constructor(e,n=wT.now){super(e,()=>Hu.delegate&&Hu.delegate!==this?Hu.delegate.now():n()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,n=0,a){return Hu.delegate&&Hu.delegate!==this?Hu.delegate.schedule(e,n,a):super.schedule(e,n,a)}flush(e){const{actions:n}=this;if(this.active)return void n.push(e);let a;this.active=!0;do{if(a=e.execute(e.state,e.delay))break}while(e=n.shift());if(this.active=!1,a){for(;e=n.shift();)e.unsubscribe();throw a}}}const Wk=new Hu(class Zk extends qk{constructor(e,n){super(e,n),this.scheduler=e,this.work=n,this.pending=!1}schedule(e,n=0){if(this.closed)return this;this.state=e;const a=this.id,u=this.scheduler;return null!=a&&(this.id=this.recycleAsyncId(u,a,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(u,this.id,n),this}requestAsyncId(e,n,a=0){return setInterval(e.flush.bind(e,this),a)}recycleAsyncId(e,n,a=0){if(null!==a&&this.delay===a&&!1===this.pending)return n;clearInterval(n)}execute(e,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const a=this._execute(e,n);if(a)return a;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,n){let u,a=!1;try{this.work(e)}catch(m){a=!0,u=!!m&&m||new Error(m)}if(a)return this.unsubscribe(),u}_unsubscribe(){const e=this.id,n=this.scheduler,a=n.actions,u=a.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==u&&a.splice(u,1),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null}});class yl{constructor(e,n,a){this.kind=e,this.value=n,this.error=a,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,n,a){switch(this.kind){case"N":return e&&e(this.value);case"E":return n&&n(this.error);case"C":return a&&a()}}accept(e,n,a){return e&&"function"==typeof e.next?this.observe(e):this.do(e,n,a)}toObservable(){switch(this.kind){case"N":return Un(this.value);case"E":return Cf(this.error);case"C":return B_()}throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new yl("N",e):yl.undefinedValueNotification}static createError(e){return new yl("E",void 0,e)}static createComplete(){return yl.completeNotification}}yl.completeNotification=new yl("C"),yl.undefinedValueNotification=new yl("N",void 0);class Yk{constructor(e,n){this.delay=e,this.scheduler=n}call(e,n){return n.subscribe(new p0(e,this.delay,this.scheduler))}}class p0 extends Le{constructor(e,n,a){super(e),this.delay=n,this.scheduler=a,this.queue=[],this.active=!1,this.errored=!1}static dispatch(e){const n=e.source,a=n.queue,u=e.scheduler,m=e.destination;for(;a.length>0&&a[0].time-u.now()<=0;)a.shift().notification.observe(m);if(a.length>0){const v=Math.max(0,a[0].time-u.now());this.schedule(e,v)}else this.unsubscribe(),n.active=!1}_schedule(e){this.active=!0,this.destination.add(e.schedule(p0.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}scheduleNotification(e){if(!0===this.errored)return;const n=this.scheduler,a=new Jk(n.now()+this.delay,e);this.queue.push(a),!1===this.active&&this._schedule(n)}_next(e){this.scheduleNotification(yl.createNext(e))}_error(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()}_complete(){this.scheduleNotification(yl.createComplete()),this.unsubscribe()}}class Jk{constructor(e,n){this.time=e,this.notification=n}}const Am="Service workers are disabled or not supported by this browser";class iy{constructor(e){if(this.serviceWorker=e,e){const a=f0(e,"controllerchange").pipe(We(()=>e.controller)),m=N_(U_(()=>Un(e.controller)),a);this.worker=m.pipe(ua(N=>!!N)),this.registration=this.worker.pipe(Oa(()=>e.getRegistration()));const O=f0(e,"message").pipe(We(N=>N.data)).pipe(ua(N=>N&&N.type)).pipe(function Hk(t){return t?Ii(()=>new Tt,t):Ii(new Tt)}());O.connect(),this.events=O}else this.worker=this.events=this.registration=function Qk(t){return U_(()=>Cf(new Error(t)))}(Am)}postMessage(e,n){return this.worker.pipe(Uc(1),js(a=>{a.postMessage(Object.assign({action:e},n))})).toPromise().then(()=>{})}postMessageWithOperation(e,n,a){const u=this.waitForOperationCompleted(a),m=this.postMessage(e,n);return Promise.all([m,u]).then(([,v])=>v)}generateNonce(){return Math.round(1e7*Math.random())}eventsOfType(e){let n;return n="string"==typeof e?a=>a.type===e:a=>e.includes(a.type),this.events.pipe(ua(n))}nextEventOfType(e){return this.eventsOfType(e).pipe(Uc(1))}waitForOperationCompleted(e){return this.eventsOfType("OPERATION_COMPLETED").pipe(ua(n=>n.nonce===e),Uc(1),We(n=>{if(void 0!==n.result)return n.result;throw new Error(n.error)})).toPromise()}get isEnabled(){return!!this.serviceWorker}}let eR=(()=>{class t{constructor(n){if(this.sw=n,this.subscriptionChanges=new Tt,!n.isEnabled)return this.messages=Gu,this.notificationClicks=Gu,void(this.subscription=Gu);this.messages=this.sw.eventsOfType("PUSH").pipe(We(u=>u.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(We(u=>u.data)),this.pushManager=this.sw.registration.pipe(We(u=>u.pushManager));const a=this.pushManager.pipe(Oa(u=>u.getSubscription()));this.subscription=Qi(a,this.subscriptionChanges)}get isEnabled(){return this.sw.isEnabled}requestSubscription(n){if(!this.sw.isEnabled)return Promise.reject(new Error(Am));const a={userVisibleOnly:!0};let u=this.decodeBase64(n.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),m=new Uint8Array(new ArrayBuffer(u.length));for(let v=0;v<u.length;v++)m[v]=u.charCodeAt(v);return a.applicationServerKey=m,this.pushManager.pipe(Oa(v=>v.subscribe(a)),Uc(1)).toPromise().then(v=>(this.subscriptionChanges.next(v),v))}unsubscribe(){return this.sw.isEnabled?this.subscription.pipe(Uc(1),Oa(a=>{if(null===a)throw new Error("Not subscribed to push notifications.");return a.unsubscribe().then(u=>{if(!u)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})})).toPromise():Promise.reject(new Error(Am))}decodeBase64(n){return atob(n)}}return t.\u0275fac=function(n){return new(n||t)(on(iy))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})(),tR=(()=>{class t{constructor(n){if(this.sw=n,!n.isEnabled)return this.versionUpdates=Gu,this.available=Gu,this.activated=Gu,void(this.unrecoverable=Gu);this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY"]),this.available=this.versionUpdates.pipe(ua(a=>"VERSION_READY"===a.type),We(a=>({type:"UPDATE_AVAILABLE",current:a.currentVersion,available:a.latestVersion}))),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED"),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}get isEnabled(){return this.sw.isEnabled}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(Am));const n=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:n},n)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(Am));const n=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:n},n)}}return t.\u0275fac=function(n){return new(n||t)(on(iy))},t.\u0275prov=hn({token:t,factory:t.\u0275fac}),t})();class m0{}const ET=new Vt("NGSW_REGISTER_SCRIPT");function nR(t,e,n,a){return()=>{if(!zw(a)||!("serviceWorker"in navigator)||!1===n.enabled)return;let m;if(navigator.serviceWorker.addEventListener("controllerchange",()=>{null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})}),"function"==typeof n.registrationStrategy)m=n.registrationStrategy();else{const[T,...I]=(n.registrationStrategy||"registerWhenStable:30000").split(":");switch(T){case"registerImmediately":m=Un(null);break;case"registerWithDelay":m=TT(+I[0]||0);break;case"registerWhenStable":m=I[0]?Qi(CT(t),TT(+I[0])):CT(t);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${n.registrationStrategy}`)}}t.get(To).runOutsideAngular(()=>m.pipe(Uc(1)).subscribe(()=>navigator.serviceWorker.register(e,{scope:n.scope}).catch(T=>console.error("Service worker registration failed with:",T))))}}function TT(t){return Un(null).pipe(function Kk(t,e=Wk){const a=function Xk(t){return t instanceof Date&&!isNaN(+t)}(t)?+t-e.now():Math.abs(t);return u=>u.lift(new Yk(a,e))}(t))}function CT(t){return t.get(v_).isStable.pipe(ua(n=>n))}function rR(t,e){return new iy(zw(e)&&!1!==t.enabled?navigator.serviceWorker:void 0)}let iR=(()=>{class t{static register(n,a={}){return{ngModule:t,providers:[{provide:ET,useValue:n},{provide:m0,useValue:a},{provide:iy,useFactory:rR,deps:[m0,hm]},{provide:y_,useFactory:nR,deps:[Vi,ET,m0,hm],multi:!0}]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=oi({type:t}),t.\u0275inj=br({providers:[eR,tR]}),t})(),oR=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=oi({type:t,bootstrap:[jk]}),t.\u0275inj=br({providers:[],imports:[[wA,Fk,Ak,iR.register("ngsw-worker.js",{enabled:nd.production,registrationStrategy:"registerWhenStable:30000"})]]}),t})();nd.production&&function iI(){aw=!1}(),xA().bootstrapModule(oR).catch(t=>console.error(t))},898:function(Xl){Xl.exports=function(){"use strict";var Fa,fa,pa;function it(f,Se){if(Fa)if(fa){var Ie="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Fa+")(sharedChunk); ("+fa+")(sharedChunk); self.onerror = null;",Ue={};Fa(Ue),pa=Se(Ue),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(pa.workerUrl=window.URL.createObjectURL(new Blob([Ie],{type:"text/javascript"})))}else fa=Se;else Fa=Se}return it(0,function(f){var Ie=Ue;function Ue(o,r,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=c,this.p2x=s,this.p2y=c}Ue.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},Ue.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},Ue.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},Ue.prototype.solveCurveX=function(o,r){var s,c,d,g,y;for(void 0===r&&(r=1e-6),d=o,y=0;y<8;y++){if(g=this.sampleCurveX(d)-o,Math.abs(g)<r)return d;var x=this.sampleCurveDerivativeX(d);if(Math.abs(x)<1e-6)break;d-=g/x}if((d=o)<(s=0))return s;if(d>(c=1))return c;for(;s<c;){if(g=this.sampleCurveX(d),Math.abs(g-o)<r)return d;o>g?s=d:c=d,d=.5*(c-s)+s}return d},Ue.prototype.solve=function(o,r){return this.sampleCurveY(this.solveCurveX(o,r))};var se=me;function me(o,r){this.x=o,this.y=r}me.prototype={clone:function(){return new me(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,r){return this.clone()._rotateAround(o,r)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var r=o.x-this.x,s=o.y-this.y;return r*r+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,r){return Math.atan2(this.x*r-this.y*o,this.x*o+this.y*r)},_matMult:function(o){var r=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=r,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var r=Math.cos(o),s=Math.sin(o),c=s*this.x+r*this.y;return this.x=r*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,r){var s=Math.cos(o),c=Math.sin(o),d=r.y+c*(this.x-r.x)+s*(this.y-r.y);return this.x=r.x+s*(this.x-r.x)-c*(this.y-r.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},me.convert=function(o){return o instanceof me?o:Array.isArray(o)?new me(o[0],o[1]):o};var ae="undefined"!=typeof self?self:{};const ge=Math.PI/180,_e=180/Math.PI;function ve(o){return o*ge}function Le(o){return o*_e}const yt=[[0,0],[1,0],[1,1],[0,1]];function wt(o){if(o<=0)return 0;if(o>=1)return 1;const r=o*o,s=r*o;return 4*(o<.5?s:3*(o-r)+s-.75)}function rt(o,r,s,c){const d=new Ie(o,r,s,c);return function(g){return d.solve(g)}}const Ze=rt(.25,.1,.25,1);function De(o,r,s){return Math.min(s,Math.max(r,o))}function Ge(o,r,s){return(s=De((s-o)/(r-o),0,1))*s*(3-2*s)}function ct(o,r,s){const c=s-r,d=((o-r)%c+c)%c+r;return d===r?s:d}function gt(o,r,s){if(!o.length)return s(null,[]);let c=o.length;const d=new Array(o.length);let g=null;o.forEach((y,x)=>{r(y,(E,D)=>{E&&(g=E),d[x]=D,0==--c&&s(g,d)})})}function Kt(o){const r=[];for(const s in o)r.push(o[s]);return r}function en(o,...r){for(const s of r)for(const c in s)o[c]=s[c];return o}let rn=1;function Wt(){return rn++}function St(){return function o(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Tt(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Nt(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function tt(o,r){o.forEach(s=>{r[s]&&(r[s]=r[s].bind(r))})}function We(o,r){return-1!==o.indexOf(r,o.length-r.length)}function cn(o,r,s){const c={};for(const d in o)c[d]=r.call(s||this,o[d],d,o);return c}function Cn(o,r,s){const c={};for(const d in o)r.call(s||this,o[d],d,o)&&(c[d]=o[d]);return c}function Qt(o){return Array.isArray(o)?o.map(Qt):"object"==typeof o&&o?cn(o,Qt):o}const On={};function un(o){On[o]||("undefined"!=typeof console&&console.warn(o),On[o]=!0)}function Vn(o,r,s){return(s.y-o.y)*(r.x-o.x)>(r.y-o.y)*(s.x-o.x)}function cr(o){let r=0;for(let s,c,d=0,g=o.length,y=g-1;d<g;y=d++)s=o[d],c=o[y],r+=(c.x-s.x)*(s.y+c.y);return r}function Ct(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function kn(o){const r={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,d,g)=>{const y=d||g;return r[c]=!y||y.toLowerCase(),""}),r["max-age"]){const s=parseInt(r["max-age"],10);isNaN(s)?delete r["max-age"]:r["max-age"]=s}return r}let qe,kt,Gt,wn,ft=null;function Sn(o){if(null==ft){const r=o.navigator?o.navigator.userAgent:null;ft=!!o.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return ft}function Ur(o){try{const r=ae[o];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}const or={now:()=>void 0!==Gt?Gt:ae.performance.now(),setNow(o){Gt=o},restoreNow(){Gt=void 0},frame(o){const r=ae.requestAnimationFrame(o);return{cancel:()=>ae.cancelAnimationFrame(r)}},getImageData(o,r=0){const{width:s,height:c}=o;wn||(wn=ae.document.createElement("canvas"));const d=wn.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return(s>wn.width||c>wn.height)&&(wn.width=s,wn.height=c),d.clearRect(-r,-r,s+2*r,c+2*r),d.drawImage(o,0,0,s,c),d.getImageData(-r,-r,s+2*r,c+2*r)},resolveURL:o=>(qe||(qe=ae.document.createElement("a")),qe.href=o,qe.href),get devicePixelRatio(){return ae.devicePixelRatio},get prefersReducedMotion(){return!!ae.matchMedia&&(null==kt&&(kt=ae.matchMedia("(prefers-reduced-motion: reduce)")),kt.matches)}};let Xn;const fn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Xn){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Xn=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch(r){Xn=o}}return Xn},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},sr={supported:!1,testSupport:function(o){!Vr&&Di&&(Ri?Co(o):Ln=o)}};let Ln,Di,Vr=!1,Ri=!1;function Co(o){const r=o.createTexture();o.bindTexture(o.TEXTURE_2D,r);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Di),o.isContextLost())return;sr.supported=!0}catch(s){}o.deleteTexture(r),Vr=!0}ae.document&&(Di=ae.document.createElement("img"),Di.onload=function(){Ln&&Co(Ln),Ln=null,Ri=!0},Di.onerror=function(){Vr=!0,Ln=null},Di.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Or="01",Ji="NO_ACCESS_TOKEN";function Gi(o){return 0===o.indexOf("mapbox:")}function No(o){return fn.API_URL_REGEX.test(o)}const hi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Si(o){const r=o.match(hi);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Qi(o){const r=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${r}`}function Bo(o){if(!o)return null;const r=o.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(ae.atob(r[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class es{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const s=Bo(fn.ACCESS_TOKEN);let c="";return c=s&&s.u?ae.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(d,g)=>String.fromCharCode(Number("0x"+g)))):fn.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const r=Ur("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{const d=ae.localStorage.getItem(s);d&&(this.eventData=JSON.parse(d));const g=ae.localStorage.getItem(c);g&&(this.anonId=g)}catch(d){un("Unable to read from LocalStorage")}}saveEventData(){const r=Ur("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{ae.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&ae.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(d){un("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,s,c,d){if(!fn.EVENTS_URL)return;const g=Si(fn.EVENTS_URL);g.params.push(`access_token=${d||fn.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.8.1",skuId:Or,userId:this.anonId},x=s?en(y,s):y,E={url:Qi(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=de(E,D=>{this.pendingRequest=null,c(D),this.saveEventData(),this.processRequests(d)})}queueRequest(r,s){this.queue.push(r),this.processRequests(s)}}const bs=new class extends es{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,r){fn.EVENTS_URL&&fn.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>Gi(s)||No(s))&&this.queueRequest(Date.now(),r)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Bo(fn.ACCESS_TOKEN),s=r?r.u:fn.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;Nt(this.anonId)||(this.anonId=St(),c=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),y=new Date(d),x=(d-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||g.getDate()!==y.getDate()}else c=!0;c?this.postEvent(d,{"enabled.telemetry":!1},g=>{g||(this.eventData.lastSuccess=d,this.eventData.tokenU=s)},o):this.processRequests()}},ts=bs.postTurnstileEvent.bind(bs),ws=new class extends es{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,r,s,c){this.skuToken=r,this.errorCb=c,fn.EVENTS_URL&&(s||fn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Ji)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:s}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Nt(this.anonId)||(this.anonId=St()),this.postEvent(s,{skuToken:this.skuToken},c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},o))}},Vs=ws.postMapLoadEvent.bind(ws),gi=new class extends es{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,r,s,c){if(!fn.API_URL||!fn.SESSION_PATH)return;const d=Si(fn.API_URL+fn.SESSION_PATH);d.params.push(`sku=${r||""}`),d.params.push(`access_token=${c||fn.ACCESS_TOKEN||""}`);const g={url:Qi(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=pe(g,y=>{this.pendingRequest=null,s(y),this.saveEventData(),this.processRequests(c)})}getSessionAPI(o,r,s,c){this.skuToken=r,this.errorCb=c,fn.SESSION_PATH&&fn.API_URL&&(s||fn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Ji)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:s}=this.queue.shift();r&&this.success[r]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},o)}},$s=gi.getSessionAPI.bind(gi),Ii=new Set,Es="mapbox-tiles";let _i,$r,Zn=500,eo=50;function Kn(){ae.caches&&!_i&&(_i=ae.caches.open(Es))}function Oi(o){const r=o.indexOf("?");return r<0?o:o.slice(0,r)}let Uo=1/0;const K={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(K);class z extends Error{constructor(r,s,c){401===s&&No(c)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const j=Ct()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ae.location.protocol?ae.parent:ae).location.href,X=function(o,r){if(!(/^file:/.test(s=o.url)||/^file:/.test(j())&&!/^\w+:/.test(s))){if(ae.fetch&&ae.Request&&ae.AbortController&&ae.Request.prototype.hasOwnProperty("signal"))return function(c,d){const g=new ae.AbortController,y=new ae.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:j(),signal:g.signal});let x=!1,E=!1;const D=(M=y.url).indexOf("sku=")>0&&No(M);var M;"json"===c.type&&y.headers.set("Accept","application/json");const A=(F,U,G)=>{if(E)return;if(F&&"SecurityError"!==F.message&&un(F),U&&G)return k(U);const Z=Date.now();ae.fetch(y).then(Q=>{if(Q.ok){const ue=D?Q.clone():null;return k(Q,ue,Z)}return d(new z(Q.statusText,Q.status,c.url))}).catch(Q=>{20!==Q.code&&d(new Error(Q.message))})},k=(F,U,G)=>{("arrayBuffer"===c.type?F.arrayBuffer():"json"===c.type?F.json():F.text()).then(Z=>{E||(U&&G&&function(Q,ue,ye){if(Kn(),!_i)return;const be={status:ue.status,statusText:ue.statusText,headers:new ae.Headers};ue.headers.forEach((Be,Ve)=>be.headers.set(Ve,Be));const Ee=kn(ue.headers.get("Cache-Control")||"");if(Ee["no-store"])return;Ee["max-age"]&&be.headers.set("Expires",new Date(ye+1e3*Ee["max-age"]).toUTCString());const Te=be.headers.get("Expires");Te&&(new Date(Te).getTime()-ye<42e4||function(Be,Ve){if(void 0===$r)try{new Response(new ReadableStream),$r=!0}catch(Ye){$r=!1}$r?Ve(Be.body):Be.blob().then(Ve)}(ue,Be=>{const Ve=new ae.Response(Be,be);Kn(),_i&&_i.then(Ye=>Ye.put(Oi(Q.url),Ve)).catch(Ye=>un(Ye.message))}))}(y,U,G),x=!0,d(null,Z,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(Z=>{E||d(new Error(Z.message))})};return D?function(F,U){if(Kn(),!_i)return U(null);const G=Oi(F.url);_i.then(Z=>{Z.match(G).then(Q=>{const ue=function(ye){if(!ye)return!1;const be=new Date(ye.headers.get("Expires")||0),Ee=kn(ye.headers.get("Cache-Control")||"");return be>Date.now()&&!Ee["no-cache"]}(Q);Z.delete(G),ue&&Z.put(G,Q.clone()),U(null,Q,ue)}).catch(U)}).catch(U)}(y,A):A(null,null),{cancel:()=>{E=!0,x||g.abort()}}}(o,r);if(Ct()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,r,void 0,!0)}var s;return function(c,d){const g=new ae.XMLHttpRequest;g.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(g.responseType="arraybuffer");for(const y in c.headers)g.setRequestHeader(y,c.headers[y]);return"json"===c.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===c.credentials,g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let y=g.response;if("json"===c.type)try{y=JSON.parse(g.response)}catch(x){return d(x)}d(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else d(new z(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}}(o,r)},Y=function(o,r){return X(en(o,{type:"arrayBuffer"}),r)},de=function(o,r){return X(en(o,{method:"POST"}),r)},pe=function(o,r){return X(en(o,{method:"GET"}),r)};function we(o){const r=ae.document.createElement("a");return r.href=o,r.protocol===ae.document.location.protocol&&r.host===ae.document.location.host}const xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Pe,Ke;Pe=[],Ke=0;const vt=function(o,r){if(sr.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Ke>=fn.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:o,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Pe.push(g),g}Ke++;let s=!1;const c=()=>{if(!s)for(s=!0,Ke--;Pe.length&&Ke<fn.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Pe.shift(),{requestParameters:y,callback:x,cancelled:E}=g;E||(g.cancel=vt(y,x).cancel)}},d=Y(o,(g,y,x,E)=>{c(),g?r(g):y&&(ae.createImageBitmap?function(D,M){const A=new ae.Blob([new Uint8Array(D)],{type:"image/png"});ae.createImageBitmap(A).then(k=>{M(null,k)}).catch(k=>{M(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(D,M)=>r(D,M,x,E)):function(D,M){const A=new ae.Image,k=ae.URL;A.onload=()=>{M(null,A),k.revokeObjectURL(A.src),A.onload=null,ae.requestAnimationFrame(()=>{A.src=xe})},A.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new ae.Blob([new Uint8Array(D)],{type:"image/png"});A.src=D.byteLength?k.createObjectURL(F):xe}(y,(D,M)=>r(D,M,x,E)))});return{cancel:()=>{d.cancel(),c()}}};function Xe(o,r,s){s[o]&&-1!==s[o].indexOf(r)||(s[o]=s[o]||[],s[o].push(r))}function Yt(o,r,s){if(s&&s[o]){const c=s[o].indexOf(r);-1!==c&&s[o].splice(c,1)}}class Bt{constructor(r,s={}){en(this,s),this.type=r}}class Ut extends Bt{constructor(r,s={}){super("error",en({error:r},s))}}class Xt{on(r,s){return this._listeners=this._listeners||{},Xe(r,s,this._listeners),this}off(r,s){return Yt(r,s,this._listeners),Yt(r,s,this._oneTimeListeners),this}once(r,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Xe(r,s,this._oneTimeListeners),this):new Promise(c=>this.once(r,c))}fire(r,s){"string"==typeof r&&(r=new Bt(r,s||{}));const c=r.type;if(this.listens(c)){r.target=this;const d=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of d)x.call(this,r);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of g)Yt(c,x,this._oneTimeListeners),x.call(this,r);const y=this._eventedParent;y&&(en(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(r))}else r instanceof Ut&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,s){return this._eventedParent=r,this._eventedParentData=s,this}}var ke=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Yn(o,...r){for(const s of r)for(const c in s)o[c]=s[c];return o}function Ot(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Gn(o){if(Array.isArray(o))return o.map(Gn);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const r={};for(const s in o)r[s]=Gn(o[s]);return r}return Ot(o)}class Mn extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}class ns{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[c,d]of s)this.bindings[c]=d}concat(r){return new ns(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Do={kind:"null"},xt={kind:"number"},an={kind:"string"},Zt={kind:"boolean"},yi={kind:"color"},rs={kind:"object"},Rn={kind:"value"},hn={kind:"collator"},is={kind:"formatted"},br={kind:"resolvedImage"};function ai(o,r){return{kind:"array",itemType:o,N:r}}function wr(o){if("array"===o.kind){const r=wr(o.itemType);return"number"==typeof o.N?`array<${r}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${r}>`}return o.kind}const Kl=[Do,xt,an,Zt,yi,is,rs,ai(Rn),br];function Hi(o,r){if("error"===r.kind)return null;if("array"===o.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!Hi(o.itemType,r.itemType))&&("number"!=typeof o.N||o.N===r.N))return null}else{if(o.kind===r.kind)return null;if("value"===o.kind)for(const s of Kl)if(!Hi(s,r))return null}return`Expected ${wr(o)} but found ${wr(r)} instead.`}function Gs(o,r){return r.some(s=>s.kind===o.kind)}function to(o,r){return r.some(s=>"null"===s?null===o:"array"===s?Array.isArray(o):"object"===s?o&&!Array.isArray(o)&&"object"==typeof o:s===typeof o)}function Ts(o){var r={exports:{}};return o(r,r.exports),r.exports}var Hs=Ts(function(o,r){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(x){return(x=Math.round(x))<0?0:x>255?255:x}function d(x){return c("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function g(x){return(E="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:E>1?1:E;var E}function y(x,E,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?x+(E-x)*D*6:2*D<1?E:3*D<2?x+(E-x)*(2/3-D)*6:x}try{r.parseCSSColor=function(x){var E,D=x.replace(/ /g,"").toLowerCase();if(D in s)return s[D].slice();if("#"===D[0])return 4===D.length?(E=parseInt(D.substr(1),16))>=0&&E<=4095?[(3840&E)>>4|(3840&E)>>8,240&E|(240&E)>>4,15&E|(15&E)<<4,1]:null:7===D.length&&(E=parseInt(D.substr(1),16))>=0&&E<=16777215?[(16711680&E)>>16,(65280&E)>>8,255&E,1]:null;var M=D.indexOf("("),A=D.indexOf(")");if(-1!==M&&A+1===D.length){var k=D.substr(0,M),F=D.substr(M+1,A-(M+1)).split(","),U=1;switch(k){case"rgba":if(4!==F.length)return null;U=g(F.pop());case"rgb":return 3!==F.length?null:[d(F[0]),d(F[1]),d(F[2]),U];case"hsla":if(4!==F.length)return null;U=g(F.pop());case"hsl":if(3!==F.length)return null;var G=(parseFloat(F[0])%360+360)%360/360,Z=g(F[1]),Q=g(F[2]),ue=Q<=.5?Q*(Z+1):Q+Z-Q*Z,ye=2*Q-ue;return[c(255*y(ye,ue,G+1/3)),c(255*y(ye,ue,G)),c(255*y(ye,ue,G-1/3)),U];default:return null}}return null}}catch(x){}});class jn{constructor(r,s,c,d=1){this.r=r,this.g=s,this.b=c,this.a=d}static parse(r){if(!r)return;if(r instanceof jn)return r;if("string"!=typeof r)return;const s=Hs.parseCSSColor(r);return s?new jn(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[r,s,c,d]=this.toArray();return`rgba(${Math.round(r)},${Math.round(s)},${Math.round(c)},${d})`}toArray(){const{r,g:s,b:c,a:d}=this;return 0===d?[0,0,0,0]:[255*r/d,255*s/d,255*c/d,d]}}jn.black=new jn(0,0,0,1),jn.white=new jn(1,1,1,1),jn.transparent=new jn(0,0,0,0),jn.red=new jn(1,0,0,1),jn.blue=new jn(0,0,1,1);class mn{constructor(r,s,c){this.sensitivity=r?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class So{constructor(r,s,c,d,g){this.text=r.normalize?r.normalize():r,this.image=s,this.scale=c,this.fontStack=d,this.textColor=g}}class Gr{constructor(r){this.sections=r}static fromString(r){return new Gr([new So(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof Gr?r:Gr.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const s of this.sections){if(s.image){r.push(["image",s.image.name]);continue}r.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),r.push(c)}return r}}class Cr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Cr({name:r,available:!1}):null}serialize(){return["image",this.name]}}function di(o,r,s,c){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[o,r,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[o,r,s,c]:[o,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Io(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof jn||o instanceof mn||o instanceof Gr||o instanceof Cr)return!0;if(Array.isArray(o)){for(const r of o)if(!Io(r))return!1;return!0}if("object"==typeof o){for(const r in o)if(!Io(o[r]))return!1;return!0}return!1}function gr(o){if(null===o)return Do;if("string"==typeof o)return an;if("boolean"==typeof o)return Zt;if("number"==typeof o)return xt;if(o instanceof jn)return yi;if(o instanceof mn)return hn;if(o instanceof Gr)return is;if(o instanceof Cr)return br;if(Array.isArray(o)){const r=o.length;let s;for(const c of o){const d=gr(c);if(s){if(s===d)continue;s=Rn;break}s=d}return ai(s||Rn,r)}return rs}function ei(o){const r=typeof o;return null===o?"":"string"===r||"number"===r||"boolean"===r?String(o):o instanceof jn||o instanceof Gr||o instanceof Cr?o.toString():JSON.stringify(o)}class jo{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(2!==r.length)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Io(r[1]))return s.error("invalid value");const c=r[1];let d=gr(c);const g=s.expectedType;return"array"!==d.kind||0!==d.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(d=g),new jo(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof jn?["rgba"].concat(this.value.toArray()):this.value instanceof Gr?this.value.serialize():this.value}}class fi{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const Mi={string:an,number:xt,boolean:Zt,object:rs};class no{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let c,d=1;const g=r[0];if("array"===g){let x,E;if(r.length>2){const D=r[1];if("string"!=typeof D||!(D in Mi)||"object"===D)return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=Mi[D],d++}else x=Rn;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);E=r[2],d++}c=ai(x,E)}else c=Mi[g];const y=[];for(;d<r.length;d++){const x=s.parse(r[d],d,Rn);if(!x)return null;y.push(x)}return new no(c,y)}evaluate(r){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(r);if(!Hi(this.type,gr(c)))return c;if(s===this.args.length-1)throw new fi(`Expected value to be of type ${wr(this.type)}, but found ${wr(gr(c))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,s=[r.kind];if("array"===r.kind){const c=r.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){s.push(c.kind);const d=r.N;("number"==typeof d||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(c=>c.serialize()))}}class Cs{constructor(r){this.type=is,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const c=r[1];if(!Array.isArray(c)&&"object"==typeof c)return s.error("First argument must be an image or text section.");const d=[];let g=!1;for(let y=1;y<=r.length-1;++y){const x=r[y];if(g&&"object"==typeof x&&!Array.isArray(x)){g=!1;let E=null;if(x["font-scale"]&&(E=s.parse(x["font-scale"],1,xt),!E))return null;let D=null;if(x["text-font"]&&(D=s.parse(x["text-font"],1,ai(an)),!D))return null;let M=null;if(x["text-color"]&&(M=s.parse(x["text-color"],1,yi),!M))return null;const A=d[d.length-1];A.scale=E,A.font=D,A.textColor=M}else{const E=s.parse(r[y],1,Rn);if(!E)return null;const D=E.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:E,scale:null,font:null,textColor:null})}}return new Cs(d)}evaluate(r){return new Gr(this.sections.map(s=>{const c=s.content.evaluate(r);return gr(c)===br?new So("",c,null,null,null):new So(ei(c),null,s.scale?s.scale.evaluate(r):null,s.font?s.font.evaluate(r).join(","):null,s.textColor?s.textColor.evaluate(r):null)}))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const s of this.sections){r.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),r.push(c)}return r}}class os{constructor(r){this.type=br,this.input=r}static parse(r,s){if(2!==r.length)return s.error("Expected two arguments.");const c=s.parse(r[1],1,an);return c?new os(c):s.error("No image name provided.")}evaluate(r){const s=this.input.evaluate(r),c=Cr.fromString(s);return c&&r.availableImages&&(c.available=r.availableImages.indexOf(s)>-1),c}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const za={"to-boolean":Zt,"to-color":yi,"to-number":xt,"to-string":an};class An{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const c=r[0];if(("to-boolean"===c||"to-string"===c)&&2!==r.length)return s.error("Expected one argument.");const d=za[c],g=[];for(let y=1;y<r.length;y++){const x=s.parse(r[y],y,Rn);if(!x)return null;g.push(x)}return new An(d,g)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let s,c;for(const d of this.args){if(s=d.evaluate(r),c=null,s instanceof jn)return s;if("string"==typeof s){const g=r.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:di(s[0],s[1],s[2],s[3]),!c))return new jn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new fi(c||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const c of this.args){if(s=c.evaluate(r),null===s)return 0;const d=Number(s);if(!isNaN(d))return d}throw new fi(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?Gr.fromString(ei(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?Cr.fromString(ei(this.args[0].evaluate(r))):ei(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Cs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new os(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(s=>{r.push(s.serialize())}),r}}const Yl=["Unknown","Point","LineString","Polygon"];class Jl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Yl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:c,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*s-r[0])+this.featureDistanceData.bearing[1]*(d*s-r[1])}return 0}parseColor(r){let s=this._parseColorCache[r];return s||(s=this._parseColorCache[r]=jn.parse(r)),s}}class fe{constructor(r,s,c,d){this.name=r,this.type=s,this._evaluate=c,this.args=d}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,s){const c=r[0],d=fe.definitions[c];if(!d)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,x=y.filter(([D])=>!Array.isArray(D)||D.length===r.length-1);let E=null;for(const[D,M]of x){E=new Qe(s.registry,s.path,null,s.scope);const A=[];let k=!1;for(let F=1;F<r.length;F++){const U=r[F],G=Array.isArray(D)?D[F-1]:D.type,Z=E.parse(U,1+A.length,G);if(!Z){k=!0;break}A.push(Z)}if(!k)if(Array.isArray(D)&&D.length!==A.length)E.error(`Expected ${D.length} arguments, but found ${A.length} instead.`);else{for(let F=0;F<A.length;F++){const U=Array.isArray(D)?D[F]:D.type,G=A[F];E.concat(F+1).checkSubtype(U,G.type)}if(0===E.errors.length)return new fe(c,g,M,A)}}if(1===x.length)s.errors.push(...E.errors);else{const D=(x.length?x:y).map(([A])=>{return k=A,Array.isArray(k)?`(${k.map(wr).join(", ")})`:`(${wr(k.type)}...)`;var k}).join(" | "),M=[];for(let A=1;A<r.length;A++){const k=s.parse(r[A],1+M.length);if(!k)return null;M.push(wr(k.type))}s.error(`Expected arguments of type ${D}, but found (${M.join(", ")}) instead.`)}return null}static register(r,s){fe.definitions=s;for(const c in s)r[c]=fe}}class Fe{constructor(r,s,c){this.type=hn,this.locale=c,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(2!==r.length)return s.error("Expected one argument.");const c=r[1];if("object"!=typeof c||Array.isArray(c))return s.error("Collator options argument must be an object.");const d=s.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,Zt);if(!d)return null;const g=s.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,Zt);if(!g)return null;let y=null;return c.locale&&(y=s.parse(c.locale,1,an),!y)?null:new Fe(d,g,y)}evaluate(r){return new mn(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const st=8192;function Dn(o,r){o[0]=Math.min(o[0],r[0]),o[1]=Math.min(o[1],r[1]),o[2]=Math.max(o[2],r[0]),o[3]=Math.max(o[3],r[1])}function Hn(o,r){return!(o[0]<=r[0]||o[2]>=r[2]||o[1]<=r[1]||o[3]>=r[3])}function Hr(o,r){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,d=Math.pow(2,r.z);return[Math.round(s*d*st),Math.round(c*d*st)]}function dr(o,r,s){const c=o[0]-r[0],d=o[1]-r[1],g=o[0]-s[0],y=o[1]-s[1];return c*y-g*d==0&&c*g<=0&&d*y<=0}function yr(o,r){let s=!1;for(let y=0,x=r.length;y<x;y++){const E=r[y];for(let D=0,M=E.length;D<M-1;D++){if(dr(o,E[D],E[D+1]))return!1;(d=E[D])[1]>(c=o)[1]!=(g=E[D+1])[1]>c[1]&&c[0]<(g[0]-d[0])*(c[1]-d[1])/(g[1]-d[1])+d[0]&&(s=!s)}}var c,d,g;return s}function po(o,r){for(let s=0;s<r.length;s++)if(yr(o,r[s]))return!0;return!1}function Dr(o,r,s,c){const d=c[0]-s[0],g=c[1]-s[1],y=(o[0]-s[0])*g-d*(o[1]-s[1]),x=(r[0]-s[0])*g-d*(r[1]-s[1]);return y>0&&x<0||y<0&&x>0}function vl(o,r,s){for(const D of s)for(let M=0;M<D.length-1;++M)if((x=[(y=D[M+1])[0]-(g=D[M])[0],y[1]-g[1]])[0]*(E=[(d=r)[0]-(c=o)[0],d[1]-c[1]])[1]-x[1]*E[0]!=0&&Dr(c,d,g,y)&&Dr(g,y,c,d))return!0;var c,d,g,y,x,E;return!1}function ii(o,r){for(let s=0;s<o.length;++s)if(!yr(o[s],r))return!1;for(let s=0;s<o.length-1;++s)if(vl(o[s],o[s+1],r))return!1;return!0}function xl(o,r){for(let s=0;s<r.length;s++)if(ii(o,r[s]))return!0;return!1}function Ds(o,r,s){const c=[];for(let d=0;d<o.length;d++){const g=[];for(let y=0;y<o[d].length;y++){const x=Hr(o[d][y],s);Dn(r,x),g.push(x)}c.push(g)}return c}function oi(o,r,s){const c=[];for(let d=0;d<o.length;d++){const g=Ds(o[d],r,s);c.push(g)}return c}function Ss(o,r,s,c){if(o[0]<s[0]||o[0]>s[2]){const d=.5*c;let g=o[0]-s[0]>d?-c:s[0]-o[0]>d?c:0;0===g&&(g=o[0]-s[2]>d?-c:s[2]-o[0]>d?c:0),o[0]+=g}Dn(r,o)}function Vo(o,r,s,c){const d=Math.pow(2,c.z)*st,g=[c.x*st,c.y*st],y=[];if(!o)return y;for(const x of o)for(const E of x){const D=[E.x+g[0],E.y+g[1]];Ss(D,r,s,d),y.push(D)}return y}function Yr(o,r,s,c){const d=Math.pow(2,c.z)*st,g=[c.x*st,c.y*st],y=[];if(!o)return y;for(const E of o){const D=[];for(const M of E){const A=[M.x+g[0],M.y+g[1]];Dn(r,A),D.push(A)}y.push(D)}if(r[2]-r[0]<=d/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of y)for(const D of E)Ss(D,r,s,d)}var x;return y}class Lr{constructor(r,s){this.type=Zt,this.geojson=r,this.geometries=s}static parse(r,s){if(2!==r.length)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Io(r[1])){const c=r[1];if("FeatureCollection"===c.type)for(let d=0;d<c.features.length;++d){const g=c.features[d].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new Lr(c,c.features[d].geometry)}else if("Feature"===c.type){const d=c.geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new Lr(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new Lr(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(s,c){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(!y)return!1;if("Polygon"===c.type){const x=Ds(c.coordinates,g,y),E=Vo(s.geometry(),d,g,y);if(!Hn(d,g))return!1;for(const D of E)if(!yr(D,x))return!1}if("MultiPolygon"===c.type){const x=oi(c.coordinates,g,y),E=Vo(s.geometry(),d,g,y);if(!Hn(d,g))return!1;for(const D of E)if(!po(D,x))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(s,c){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(!y)return!1;if("Polygon"===c.type){const x=Ds(c.coordinates,g,y),E=Yr(s.geometry(),d,g,y);if(!Hn(d,g))return!1;for(const D of E)if(!ii(D,x))return!1}if("MultiPolygon"===c.type){const x=oi(c.coordinates,g,y),E=Yr(s.geometry(),d,g,y);if(!Hn(d,g))return!1;for(const D of E)if(!xl(D,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function fr(o){if(o instanceof fe&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof Lr)return!1;let r=!0;return o.eachChild(s=>{r&&!fr(s)&&(r=!1)}),r}function Li(o){if(o instanceof fe&&"feature-state"===o.name)return!1;let r=!0;return o.eachChild(s=>{r&&!Li(s)&&(r=!1)}),r}function ne(o,r){if(o instanceof fe&&r.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!ne(c,r)&&(s=!1)}),s}class Ce{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(2!==r.length||"string"!=typeof r[1])return s.error("'var' expression requires exactly one string literal argument.");const c=r[1];return s.scope.has(c)?new Ce(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Qe{constructor(r,s=[],c,d=new ns,g=[]){this.registry=r,this.path=s,this.key=s.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=g,this.expectedType=c}parse(r,s,c,d,g={}){return s?this.concat(s,c,d)._parse(r,g):this._parse(r,g)}_parse(r,s){function c(d,g,y){return"assert"===y?new no(g,[d]):"coerce"===y?new An(g,[d]):d}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=r[0];if("string"!=typeof d)return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[d];if(g){let y=g.parse(r,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,E=y.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==E.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==E.kind&&"string"!==E.kind){if(this.checkSubtype(x,E))return null}else y=c(y,x,s.typeAnnotation||"coerce");else y=c(y,x,s.typeAnnotation||"assert")}if(!(y instanceof jo)&&"resolvedImage"!==y.type.kind&&$t(y)){const x=new Jl;try{y=new jo(y.type,y.evaluate(x))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,s,c){const d="number"==typeof r?this.path.concat(r):this.path,g=c?this.scope.concat(c):this.scope;return new Qe(this.registry,d,s||null,g,this.errors)}error(r,...s){const c=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new Mn(c,r))}checkSubtype(r,s){const c=Hi(r,s);return c&&this.error(c),c}}function $t(o){if(o instanceof Ce)return $t(o.boundExpression);if(o instanceof fe&&"error"===o.name||o instanceof Fe||o instanceof Lr)return!1;const r=o instanceof An||o instanceof no;let s=!0;return o.eachChild(c=>{s=r?s&&$t(c):s&&c instanceof jo}),!!s&&fr(o)&&ne(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ar(o,r){const s=o.length-1;let c,d,g=0,y=s,x=0;for(;g<=y;)if(x=Math.floor((g+y)/2),c=o[x],d=o[x+1],c<=r){if(x===s||r<d)return x;g=x+1}else{if(!(c>r))throw new fi("Input is not a number.");y=x-1}return 0}class Tn{constructor(r,s,c){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[d,g]of c)this.labels.push(d),this.outputs.push(g)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(r[1],1,xt);if(!c)return null;const d=[];let g=null;s.expectedType&&"value"!==s.expectedType.kind&&(g=s.expectedType);for(let y=1;y<r.length;y+=2){const x=1===y?-1/0:r[y],E=r[y+1],D=y,M=y+1;if("number"!=typeof x)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(d.length&&d[d.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const A=s.parse(E,M,g);if(!A)return null;g=g||A.type,d.push([x,A])}return new Tn(g,c,d)}evaluate(r){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(r);const d=this.input.evaluate(r);if(d<=s[0])return c[0].evaluate(r);const g=s.length;return d>=s[g-1]?c[g-1].evaluate(r):c[ar(s,d)].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&r.push(this.labels[s]),r.push(this.outputs[s].serialize());return r}}function bt(o,r,s){return o*(1-s)+r*s}var Jn=Object.freeze({__proto__:null,number:bt,color:function(o,r,s){return new jn(bt(o.r,r.r,s),bt(o.g,r.g,s),bt(o.b,r.b,s),bt(o.a,r.a,s))},array:function(o,r,s){return o.map((c,d)=>bt(c,r[d],s))}});const Dt=4/29,vn=6/29,Bn=3*vn*vn,Fr=Math.PI/180,li=180/Math.PI;function Er(o){return o>.008856451679035631?Math.pow(o,1/3):o/Bn+Dt}function Jr(o){return o>vn?o*o*o:Bn*(o-Dt)}function ur(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Is(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function mo(o){const r=Is(o.r),s=Is(o.g),c=Is(o.b),d=Er((.4124564*r+.3575761*s+.1804375*c)/.95047),g=Er((.2126729*r+.7151522*s+.072175*c)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-Er((.0193339*r+.119192*s+.9503041*c)/1.08883)),alpha:o.a}}function In(o){let r=(o.l+16)/116,s=isNaN(o.a)?r:r+o.a/500,c=isNaN(o.b)?r:r-o.b/200;return r=1*Jr(r),s=.95047*Jr(s),c=1.08883*Jr(c),new jn(ur(3.2404542*s-1.5371385*r-.4985314*c),ur(-.969266*s+1.8760108*r+.041556*c),ur(.0556434*s-.2040259*r+1.0572252*c),o.alpha)}function qc(o,r,s){const c=r-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const Ms={forward:mo,reverse:In,interpolate:function(o,r,s){return{l:bt(o.l,r.l,s),a:bt(o.a,r.a,s),b:bt(o.b,r.b,s),alpha:bt(o.alpha,r.alpha,s)}}},Na={forward:function(o){const{l:r,a:s,b:c}=mo(o),d=Math.atan2(c,s)*li;return{h:d<0?d+360:d,c:Math.sqrt(s*s+c*c),l:r,alpha:o.a}},reverse:function(o){const r=o.h*Fr,s=o.c;return In({l:o.l,a:Math.cos(r)*s,b:Math.sin(r)*s,alpha:o.alpha})},interpolate:function(o,r,s){return{h:qc(o.h,r.h,s),c:bt(o.c,r.c,s),l:bt(o.l,r.l,s),alpha:bt(o.alpha,r.alpha,s)}}};var ma=Object.freeze({__proto__:null,lab:Ms,hcl:Na});class jr{constructor(r,s,c,d,g){this.type=r,this.operator=s,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[y,x]of g)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(r,s,c,d){let g=0;if("exponential"===r.name)g=ga(s,r.base,c,d);else if("linear"===r.name)g=ga(s,1,c,d);else if("cubic-bezier"===r.name){const y=r.controlPoints;g=new Ie(y[0],y[1],y[2],y[3]).solve(ga(s,1,c,d))}return g}static parse(r,s){let[c,d,g,...y]=r;if(!Array.isArray(d)||0===d.length)return s.error("Expected an interpolation type expression.",1);if("linear"===d[0])d={name:"linear"};else if("exponential"===d[0]){const D=d[1];if("number"!=typeof D)return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:D}}else{if("cubic-bezier"!==d[0])return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const D=d.slice(1);if(4!==D.length||D.some(M=>"number"!=typeof M||M<0||M>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:D}}}if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,xt),!g)return null;const x=[];let E=null;"interpolate-hcl"===c||"interpolate-lab"===c?E=yi:s.expectedType&&"value"!==s.expectedType.kind&&(E=s.expectedType);for(let D=0;D<y.length;D+=2){const M=y[D],A=y[D+1],k=D+3,F=D+4;if("number"!=typeof M)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(x.length&&x[x.length-1][0]>=M)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const U=s.parse(A,F,E);if(!U)return null;E=E||U.type,x.push([M,U])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new jr(E,c,d,g,x):s.error(`Type ${wr(E)} is not interpolatable.`)}evaluate(r){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(r);const d=this.input.evaluate(r);if(d<=s[0])return c[0].evaluate(r);const g=s.length;if(d>=s[g-1])return c[g-1].evaluate(r);const y=ar(s,d),x=jr.interpolationFactor(this.interpolation,d,s[y],s[y+1]),E=c[y].evaluate(r),D=c[y+1].evaluate(r);return"interpolate"===this.operator?Jn[this.type.kind.toLowerCase()](E,D,x):"interpolate-hcl"===this.operator?Na.reverse(Na.interpolate(Na.forward(E),Na.forward(D),x)):Ms.reverse(Ms.interpolate(Ms.forward(E),Ms.forward(D),x))}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,r,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function ga(o,r,s,c){const d=c-s,g=o-s;return 0===d?0:1===r?g/d:(Math.pow(r,g)-1)/(Math.pow(r,d)-1)}class As{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expectected at least one argument.");let c=null;const d=s.expectedType;d&&"value"!==d.kind&&(c=d);const g=[];for(const x of r.slice(1)){const E=s.parse(x,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,g.push(E)}const y=d&&g.some(x=>Hi(d,x.type));return new As(y?Rn:c,g)}evaluate(r){let s,c=null,d=0;for(const g of this.args){if(d++,c=g.evaluate(r),c&&c instanceof Cr&&!c.available&&(s||(s=c),c=null,d===this.args.length))return s;if(null!==c)break}return c}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class ro{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const c=[];for(let g=1;g<r.length-1;g+=2){const y=r[g];if("string"!=typeof y)return s.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=s.parse(r[g+1],g+1);if(!x)return null;c.push([y,x])}const d=s.parse(r[r.length-1],r.length-1,s.expectedType,c);return d?new ro(c,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[s,c]of this.bindings)r.push(s,c.serialize());return r.push(this.result.serialize()),r}}class Pr{constructor(r,s,c){this.type=r,this.index=s,this.input=c}static parse(r,s){if(3!==r.length)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,xt),d=s.parse(r[2],2,ai(s.expectedType||Rn));return c&&d?new Pr(d.type.itemType,c,d):null}evaluate(r){const s=this.index.evaluate(r),c=this.input.evaluate(r);if(s<0)throw new fi(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new fi(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new fi(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Zc{constructor(r,s){this.type=Zt,this.needle=r,this.haystack=s}static parse(r,s){if(3!==r.length)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,Rn),d=s.parse(r[2],2,Rn);return c&&d?Gs(c.type,[Zt,an,xt,Do,Rn])?new Zc(c,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${wr(c.type)} instead`):null}evaluate(r){const s=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(null==c)return!1;if(!to(s,["boolean","string","number","null"]))throw new fi(`Expected first argument to be of type boolean, string, number or null, but found ${wr(gr(s))} instead.`);if(!to(c,["string","array"]))throw new fi(`Expected second argument to be of type array or string, but found ${wr(gr(c))} instead.`);return c.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Wc{constructor(r,s,c){this.type=xt,this.needle=r,this.haystack=s,this.fromIndex=c}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,Rn),d=s.parse(r[2],2,Rn);if(!c||!d)return null;if(!Gs(c.type,[Zt,an,xt,Do,Rn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${wr(c.type)} instead`);if(4===r.length){const g=s.parse(r[3],3,xt);return g?new Wc(c,d,g):null}return new Wc(c,d)}evaluate(r){const s=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!to(s,["boolean","string","number","null"]))throw new fi(`Expected first argument to be of type boolean, string, number or null, but found ${wr(gr(s))} instead.`);if(!to(c,["string","array"]))throw new fi(`Expected second argument to be of type array or string, but found ${wr(gr(c))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(r);return c.indexOf(s,d)}return c.indexOf(s)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Mo{constructor(r,s,c,d,g,y){this.inputType=r,this.type=s,this.input=c,this.cases=d,this.outputs=g,this.otherwise=y}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return s.error("Expected an even number of arguments.");let c,d;s.expectedType&&"value"!==s.expectedType.kind&&(d=s.expectedType);const g={},y=[];for(let D=2;D<r.length-1;D+=2){let M=r[D];const A=r[D+1];Array.isArray(M)||(M=[M]);const k=s.concat(D);if(0===M.length)return k.error("Expected at least one branch label.");for(const U of M){if("number"!=typeof U&&"string"!=typeof U)return k.error("Branch labels must be numbers or strings.");if("number"==typeof U&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof U&&Math.floor(U)!==U)return k.error("Numeric branch labels must be integer values.");if(c){if(k.checkSubtype(c,gr(U)))return null}else c=gr(U);if(void 0!==g[String(U)])return k.error("Branch labels must be unique.");g[String(U)]=y.length}const F=s.parse(A,D,d);if(!F)return null;d=d||F.type,y.push(F)}const x=s.parse(r[1],1,Rn);if(!x)return null;const E=s.parse(r[r.length-1],r.length-1,d);return E?"value"!==x.type.kind&&s.concat(1).checkSubtype(c,x.type)?null:new Mo(c,d,x,g,y,E):null}evaluate(r){const s=this.input.evaluate(r);return(gr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],d={};for(const y of s){const x=d[this.cases[y]];void 0===x?(d[this.cases[y]]=c.length,c.push([this.cases[y],[y]])):c[x][1].push(y)}const g=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,x]of c)r.push(1===x.length?g(x[0]):x.map(g)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}class go{constructor(r,s,c){this.type=r,this.branches=s,this.otherwise=c}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&"value"!==s.expectedType.kind&&(c=s.expectedType);const d=[];for(let y=1;y<r.length-1;y+=2){const x=s.parse(r[y],y,Zt);if(!x)return null;const E=s.parse(r[y+1],y+1,c);if(!E)return null;d.push([x,E]),c=c||E.type}const g=s.parse(r[r.length-1],r.length-1,c);return g?new go(c,d,g):null}evaluate(r){for(const[s,c]of this.branches)if(s.evaluate(r))return c.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,c]of this.branches)r(s),r(c);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(s=>{r.push(s.serialize())}),r}}class bl{constructor(r,s,c,d){this.type=r,this.input=s,this.beginIndex=c,this.endIndex=d}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=s.parse(r[1],1,Rn),d=s.parse(r[2],2,xt);if(!c||!d)return null;if(!Gs(c.type,[ai(Rn),an,Rn]))return s.error(`Expected first argument to be of type array or string, but found ${wr(c.type)} instead`);if(4===r.length){const g=s.parse(r[3],3,xt);return g?new bl(c.type,c,d,g):null}return new bl(c.type,c,d)}evaluate(r){const s=this.input.evaluate(r),c=this.beginIndex.evaluate(r);if(!to(s,["string","array"]))throw new fi(`Expected first argument to be of type array or string, but found ${wr(gr(s))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(r);return s.slice(c,d)}return s.slice(c)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ql(o,r){return"=="===o||"!="===o?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function ec(o,r,s,c){return 0===c.compare(r,s)}function qi(o,r,s){const c="=="!==o&&"!="!==o;return class DT{constructor(g,y,x){this.type=Zt,this.lhs=g,this.rhs=y,this.collator=x,this.hasUntypedArgument="value"===g.type.kind||"value"===y.type.kind}static parse(g,y){if(3!==g.length&&4!==g.length)return y.error("Expected two or three arguments.");const x=g[0];let E=y.parse(g[1],1,Rn);if(!E)return null;if(!Ql(x,E.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${wr(E.type)}'.`);let D=y.parse(g[2],2,Rn);if(!D)return null;if(!Ql(x,D.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${wr(D.type)}'.`);if(E.type.kind!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return y.error(`Cannot compare types '${wr(E.type)}' and '${wr(D.type)}'.`);c&&("value"===E.type.kind&&"value"!==D.type.kind?E=new no(D.type,[E]):"value"!==E.type.kind&&"value"===D.type.kind&&(D=new no(E.type,[D])));let M=null;if(4===g.length){if("string"!==E.type.kind&&"string"!==D.type.kind&&"value"!==E.type.kind&&"value"!==D.type.kind)return y.error("Cannot use collator to compare non-string types.");if(M=y.parse(g[3],3,hn),!M)return null}return new DT(E,D,M)}evaluate(g){const y=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const E=gr(y),D=gr(x);if(E.kind!==D.kind||"string"!==E.kind&&"number"!==E.kind)throw new fi(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${E.kind}, ${D.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=gr(y),D=gr(x);if("string"!==E.kind||"string"!==D.kind)return r(g,y,x)}return this.collator?s(g,y,x,this.collator.evaluate(g)):r(g,y,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[o];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const Rf=qi("==",function(o,r,s){return r===s},ec),Pm=qi("!=",function(o,r,s){return r!==s},function(o,r,s,c){return!ec(0,r,s,c)}),id=qi("<",function(o,r,s){return r<s},function(o,r,s,c){return c.compare(r,s)<0}),Of=qi(">",function(o,r,s){return r>s},function(o,r,s,c){return c.compare(r,s)>0}),km=qi("<=",function(o,r,s){return r<=s},function(o,r,s,c){return c.compare(r,s)<=0}),Rm=qi(">=",function(o,r,s){return r>=s},function(o,r,s,c){return c.compare(r,s)>=0});class od{constructor(r,s,c,d,g){this.type=an,this.number=r,this.locale=s,this.currency=c,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(r,s){if(3!==r.length)return s.error("Expected two arguments.");const c=s.parse(r[1],1,xt);if(!c)return null;const d=r[2];if("object"!=typeof d||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=s.parse(d.locale,1,an),!g))return null;let y=null;if(d.currency&&(y=s.parse(d.currency,1,an),!y))return null;let x=null;if(d["min-fraction-digits"]&&(x=s.parse(d["min-fraction-digits"],1,xt),!x))return null;let E=null;return d["max-fraction-digits"]&&(E=s.parse(d["max-fraction-digits"],1,xt),!E)?null:new od(c,g,y,x,E)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class qu{constructor(r){this.type=xt,this.input=r}static parse(r,s){if(2!==r.length)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const c=s.parse(r[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?s.error(`Expected argument of type string or array, but found ${wr(c.type)} instead.`):new qu(c):null}evaluate(r){const s=this.input.evaluate(r);if("string"==typeof s||Array.isArray(s))return s.length;throw new fi(`Expected value to be of type string or array, but found ${wr(gr(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(s=>{r.push(s.serialize())}),r}}const wl={"==":Rf,"!=":Pm,">":Of,"<":id,">=":Rm,"<=":km,array:no,at:Pr,boolean:no,case:go,coalesce:As,collator:Fe,format:Cs,image:os,in:Zc,"index-of":Wc,interpolate:jr,"interpolate-hcl":jr,"interpolate-lab":jr,length:qu,let:ro,literal:jo,match:Mo,number:no,"number-format":od,object:no,slice:bl,step:Tn,string:no,"to-boolean":An,"to-color":An,"to-number":An,"to-string":An,var:Ce,within:Lr};function sd(o,[r,s,c,d]){r=r.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const g=d?d.evaluate(o):1,y=di(r,s,c,g);if(y)throw new fi(y);return new jn(r/255*g,s/255*g,c/255*g,g)}function Lf(o,r){return o in r}function ad(o,r){const s=r[o];return void 0===s?null:s}function Ba(o){return{type:o}}function ld(o){return{result:"success",value:o}}function El(o){return{result:"error",value:o}}function tc(o){return"data-driven"===o["property-type"]||"cross-faded-data-driven"===o["property-type"]}function Ff(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function cd(o){return!!o.expression&&o.expression.interpolated}function lr(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function qs(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function zf(o){return o}function ud(o,r){const s="color"===r.type,c=o.stops&&"object"==typeof o.stops[0][0],d=c||!(c||void 0!==o.property),g=o.type||(cd(r)?"exponential":"interval");if(s&&((o=Yn({},o)).stops&&(o.stops=o.stops.map(D=>[D[0],jn.parse(D[1])])),o.default=jn.parse(o.default?o.default:r.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!ma[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let y,x,E;if("exponential"===g)y=Ps;else if("interval"===g)y=Nf;else if("categorical"===g){y=Ua,x=Object.create(null);for(const D of o.stops)x[D[0]]=D[1];E=typeof o.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);y=Zu}if(c){const D={},M=[];for(let F=0;F<o.stops.length;F++){const U=o.stops[F],G=U[0].zoom;void 0===D[G]&&(D[G]={zoom:G,type:o.type,property:o.property,default:o.default,stops:[]},M.push(G)),D[G].stops.push([U[0].value,U[1]])}const A=[];for(const F of M)A.push([D[F].zoom,ud(D[F],r)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:jr.interpolationFactor.bind(void 0,k),zoomStops:A.map(F=>F[0]),evaluate:({zoom:F},U)=>Ps({stops:A,base:o.base},r,F).evaluate(F,U)}}if(d){const D="exponential"===g?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:jr.interpolationFactor.bind(void 0,D),zoomStops:o.stops.map(M=>M[0]),evaluate:({zoom:M})=>y(o,r,M,x,E)}}return{kind:"source",evaluate(D,M){const A=M&&M.properties?M.properties[o.property]:void 0;return void 0===A?Xc(o.default,r.default):y(o,r,A,x,E)}}}function Xc(o,r,s){return void 0!==o?o:void 0!==r?r:void 0!==s?s:void 0}function Ua(o,r,s,c,d){return Xc(typeof s===d?c[s]:void 0,o.default,r.default)}function Nf(o,r,s){if("number"!==lr(s))return Xc(o.default,r.default);const c=o.stops.length;if(1===c||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const d=ar(o.stops.map(g=>g[0]),s);return o.stops[d][1]}function Ps(o,r,s){const c=void 0!==o.base?o.base:1;if("number"!==lr(s))return Xc(o.default,r.default);const d=o.stops.length;if(1===d||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[d-1][0])return o.stops[d-1][1];const g=ar(o.stops.map(M=>M[0]),s),y=function(M,A,k,F){const U=F-k,G=M-k;return 0===U?0:1===A?G/U:(Math.pow(A,G)-1)/(Math.pow(A,U)-1)}(s,c,o.stops[g][0],o.stops[g+1][0]),x=o.stops[g][1],E=o.stops[g+1][1];let D=Jn[r.type]||zf;if(o.colorSpace&&"rgb"!==o.colorSpace){const M=ma[o.colorSpace];D=(A,k)=>M.reverse(M.interpolate(M.forward(A),M.forward(k),y))}return"function"==typeof x.evaluate?{evaluate(...M){const A=x.evaluate.apply(void 0,M),k=E.evaluate.apply(void 0,M);if(void 0!==A&&void 0!==k)return D(A,k,y)}}:D(x,E,y)}function Zu(o,r,s){return"color"===r.type?s=jn.parse(s):"formatted"===r.type?s=Gr.fromString(s.toString()):"resolvedImage"===r.type?s=Cr.fromString(s.toString()):lr(s)===r.type||"enum"===r.type&&r.values[s]||(s=void 0),Xc(s,o.default,r.default)}fe.register(wl,{error:[{kind:"error"},[an],(o,[r])=>{throw new fi(r.evaluate(o))}],typeof:[an,[Rn],(o,[r])=>wr(gr(r.evaluate(o)))],"to-rgba":[ai(xt,4),[yi],(o,[r])=>r.evaluate(o).toArray()],rgb:[yi,[xt,xt,xt],sd],rgba:[yi,[xt,xt,xt,xt],sd],has:{type:Zt,overloads:[[[an],(o,[r])=>Lf(r.evaluate(o),o.properties())],[[an,rs],(o,[r,s])=>Lf(r.evaluate(o),s.evaluate(o))]]},get:{type:Rn,overloads:[[[an],(o,[r])=>ad(r.evaluate(o),o.properties())],[[an,rs],(o,[r,s])=>ad(r.evaluate(o),s.evaluate(o))]]},"feature-state":[Rn,[an],(o,[r])=>ad(r.evaluate(o),o.featureState||{})],properties:[rs,[],o=>o.properties()],"geometry-type":[an,[],o=>o.geometryType()],id:[Rn,[],o=>o.id()],zoom:[xt,[],o=>o.globals.zoom],pitch:[xt,[],o=>o.globals.pitch||0],"distance-from-center":[xt,[],o=>o.distanceFromCenter()],"heatmap-density":[xt,[],o=>o.globals.heatmapDensity||0],"line-progress":[xt,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[xt,[],o=>o.globals.skyRadialProgress||0],accumulated:[Rn,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[xt,Ba(xt),(o,r)=>{let s=0;for(const c of r)s+=c.evaluate(o);return s}],"*":[xt,Ba(xt),(o,r)=>{let s=1;for(const c of r)s*=c.evaluate(o);return s}],"-":{type:xt,overloads:[[[xt,xt],(o,[r,s])=>r.evaluate(o)-s.evaluate(o)],[[xt],(o,[r])=>-r.evaluate(o)]]},"/":[xt,[xt,xt],(o,[r,s])=>r.evaluate(o)/s.evaluate(o)],"%":[xt,[xt,xt],(o,[r,s])=>r.evaluate(o)%s.evaluate(o)],ln2:[xt,[],()=>Math.LN2],pi:[xt,[],()=>Math.PI],e:[xt,[],()=>Math.E],"^":[xt,[xt,xt],(o,[r,s])=>Math.pow(r.evaluate(o),s.evaluate(o))],sqrt:[xt,[xt],(o,[r])=>Math.sqrt(r.evaluate(o))],log10:[xt,[xt],(o,[r])=>Math.log(r.evaluate(o))/Math.LN10],ln:[xt,[xt],(o,[r])=>Math.log(r.evaluate(o))],log2:[xt,[xt],(o,[r])=>Math.log(r.evaluate(o))/Math.LN2],sin:[xt,[xt],(o,[r])=>Math.sin(r.evaluate(o))],cos:[xt,[xt],(o,[r])=>Math.cos(r.evaluate(o))],tan:[xt,[xt],(o,[r])=>Math.tan(r.evaluate(o))],asin:[xt,[xt],(o,[r])=>Math.asin(r.evaluate(o))],acos:[xt,[xt],(o,[r])=>Math.acos(r.evaluate(o))],atan:[xt,[xt],(o,[r])=>Math.atan(r.evaluate(o))],min:[xt,Ba(xt),(o,r)=>Math.min(...r.map(s=>s.evaluate(o)))],max:[xt,Ba(xt),(o,r)=>Math.max(...r.map(s=>s.evaluate(o)))],abs:[xt,[xt],(o,[r])=>Math.abs(r.evaluate(o))],round:[xt,[xt],(o,[r])=>{const s=r.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[xt,[xt],(o,[r])=>Math.floor(r.evaluate(o))],ceil:[xt,[xt],(o,[r])=>Math.ceil(r.evaluate(o))],"filter-==":[Zt,[an,Rn],(o,[r,s])=>o.properties()[r.value]===s.value],"filter-id-==":[Zt,[Rn],(o,[r])=>o.id()===r.value],"filter-type-==":[Zt,[an],(o,[r])=>o.geometryType()===r.value],"filter-<":[Zt,[an,Rn],(o,[r,s])=>{const c=o.properties()[r.value],d=s.value;return typeof c==typeof d&&c<d}],"filter-id-<":[Zt,[Rn],(o,[r])=>{const s=o.id(),c=r.value;return typeof s==typeof c&&s<c}],"filter->":[Zt,[an,Rn],(o,[r,s])=>{const c=o.properties()[r.value],d=s.value;return typeof c==typeof d&&c>d}],"filter-id->":[Zt,[Rn],(o,[r])=>{const s=o.id(),c=r.value;return typeof s==typeof c&&s>c}],"filter-<=":[Zt,[an,Rn],(o,[r,s])=>{const c=o.properties()[r.value],d=s.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[Zt,[Rn],(o,[r])=>{const s=o.id(),c=r.value;return typeof s==typeof c&&s<=c}],"filter->=":[Zt,[an,Rn],(o,[r,s])=>{const c=o.properties()[r.value],d=s.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[Zt,[Rn],(o,[r])=>{const s=o.id(),c=r.value;return typeof s==typeof c&&s>=c}],"filter-has":[Zt,[Rn],(o,[r])=>r.value in o.properties()],"filter-has-id":[Zt,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[Zt,[ai(an)],(o,[r])=>r.value.indexOf(o.geometryType())>=0],"filter-id-in":[Zt,[ai(Rn)],(o,[r])=>r.value.indexOf(o.id())>=0],"filter-in-small":[Zt,[an,ai(Rn)],(o,[r,s])=>s.value.indexOf(o.properties()[r.value])>=0],"filter-in-large":[Zt,[an,ai(Rn)],(o,[r,s])=>function(c,d,g,y){for(;g<=y;){const x=g+y>>1;if(d[x]===c)return!0;d[x]>c?y=x-1:g=x+1}return!1}(o.properties()[r.value],s.value,0,s.value.length-1)],all:{type:Zt,overloads:[[[Zt,Zt],(o,[r,s])=>r.evaluate(o)&&s.evaluate(o)],[Ba(Zt),(o,r)=>{for(const s of r)if(!s.evaluate(o))return!1;return!0}]]},any:{type:Zt,overloads:[[[Zt,Zt],(o,[r,s])=>r.evaluate(o)||s.evaluate(o)],[Ba(Zt),(o,r)=>{for(const s of r)if(s.evaluate(o))return!0;return!1}]]},"!":[Zt,[Zt],(o,[r])=>!r.evaluate(o)],"is-supported-script":[Zt,[an],(o,[r])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(r.evaluate(o))}],upcase:[an,[an],(o,[r])=>r.evaluate(o).toUpperCase()],downcase:[an,[an],(o,[r])=>r.evaluate(o).toLowerCase()],concat:[an,Ba(Rn),(o,r)=>r.map(s=>ei(s.evaluate(o))).join("")],"resolved-locale":[an,[hn],(o,[r])=>r.evaluate(o).resolvedLocale()]});class Kc{constructor(r,s){var c;this.expression=r,this._warningHistory={},this._evaluator=new Jl,this._defaultValue=s?"color"===(c=s).type&&qs(c.default)?new jn(0,0,0,0):"color"===c.type?jn.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(r,s,c,d,g,y,x,E){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,s,c,d,g,y,x,E){this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new fi(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,"undefined"!=typeof console&&console.warn(D.message)),this._defaultValue}}}function Tl(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in wl}function Cl(o,r){const s=new Qe(wl,[],r?function(d){const g={color:yi,string:an,number:xt,enum:an,boolean:Zt,formatted:is,resolvedImage:br};return"array"===d.type?ai(g[d.value]||Rn,d.length):g[d.type]}(r):void 0),c=s.parse(o,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return c?ld(new Kc(c,r)):El(s.errors)}class Yc{constructor(r,s){this.kind=r,this._styleExpression=s,this.isStateDependent="constant"!==r&&!Li(s.expression)}evaluateWithoutErrorHandling(r,s,c,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,s,c,d,g,y)}evaluate(r,s,c,d,g,y){return this._styleExpression.evaluate(r,s,c,d,g,y)}}class Wu{constructor(r,s,c,d){this.kind=r,this.zoomStops=c,this._styleExpression=s,this.isStateDependent="camera"!==r&&!Li(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(r,s,c,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,s,c,d,g,y)}evaluate(r,s,c,d,g,y){return this._styleExpression.evaluate(r,s,c,d,g,y)}interpolationFactor(r,s,c){return this.interpolationType?jr.interpolationFactor(this.interpolationType,r,s,c):0}}function Jc(o,r){if("error"===(o=Cl(o,r)).result)return o;const s=o.value.expression,c=fr(s);if(!c&&!tc(r))return El([new Mn("","data expressions not supported")]);const d=ne(s,["zoom","pitch","distance-from-center"]);if(!d&&!Ff(r))return El([new Mn("","zoom expressions not supported")]);const g=io(s);return g||d?g instanceof Mn?El([g]):g instanceof jr&&!cd(r)?El([new Mn("",'"interpolate" expressions cannot be used with this property')]):ld(g?new Wu(c?"camera":"composite",o.value,g.labels,g instanceof jr?g.interpolation:void 0):new Yc(c?"constant":"source",o.value)):El([new Mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Qc{constructor(r,s){this._parameters=r,this._specification=s,Yn(this,ud(this._parameters,this._specification))}static deserialize(r){return new Qc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function io(o){let r=null;if(o instanceof ro)r=io(o.result);else if(o instanceof As){for(const s of o.args)if(r=io(s),r)break}else(o instanceof Tn||o instanceof jr)&&o.input instanceof fe&&"zoom"===o.input.name&&(r=o);return r instanceof Mn||o.eachChild(s=>{const c=io(s);c instanceof Mn?r=c:!r&&c?r=new Mn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&c&&r!==c&&(r=new Mn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class It{constructor(r,s,c,d){this.message=(r?`${r}: `:"")+c,d&&(this.identifier=d),null!=s&&s.__line__&&(this.line=s.__line__)}}function $o(o){const r=o.key,s=o.value,c=o.valueSpec||{},d=o.objectElementValidators||{},g=o.style,y=o.styleSpec;let x=[];const E=lr(s);if("object"!==E)return[new It(r,s,`object expected, ${E} found`)];for(const D in s){const M=D.split(".")[0],A=c[M]||c["*"];let k;d[M]?k=d[M]:c[M]?k=vi:d["*"]?k=d["*"]:c["*"]&&(k=vi),k?x=x.concat(k({key:(r&&`${r}.`)+D,value:s[D],valueSpec:A,style:g,styleSpec:y,object:s,objectKey:D},s)):x.push(new It(r,s[D],`unknown property "${D}"`))}for(const D in c)d[D]||c[D].required&&void 0===c[D].default&&void 0===s[D]&&x.push(new It(r,s,`missing required property "${D}"`));return x}function ja(o){const r=o.value,s=o.valueSpec,c=o.style,d=o.styleSpec,g=o.key,y=o.arrayElementValidator||vi;if("array"!==lr(r))return[new It(g,r,`array expected, ${lr(r)} found`)];if(s.length&&r.length!==s.length)return[new It(g,r,`array length ${s.length} expected, length ${r.length} found`)];if(s["min-length"]&&r.length<s["min-length"])return[new It(g,r,`array length at least ${s["min-length"]} expected, length ${r.length} found`)];let x={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};d.$version<7&&(x.function=s.function),"object"===lr(s.value)&&(x=s.value);let E=[];for(let D=0;D<r.length;D++)E=E.concat(y({array:r,arrayIndex:D,value:r[D],valueSpec:x,style:c,styleSpec:d,key:`${g}[${D}]`}));return E}function hd(o){const r=o.key,s=o.value,c=o.valueSpec;let d=lr(s);if("number"===d&&s!=s&&(d="NaN"),"number"!==d)return[new It(r,s,`number expected, ${d} found`)];if("minimum"in c){let g=c.minimum;if("array"===lr(c.minimum)&&(g=c.minimum[o.arrayIndex]),s<g)return[new It(r,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in c){let g=c.maximum;if("array"===lr(c.maximum)&&(g=c.maximum[o.arrayIndex]),s>g)return[new It(r,s,`${s} is greater than the maximum value ${g}`)]}return[]}function dd(o){const r=o.valueSpec,s=Ot(o.value.type);let c,d,g,y={};const x="categorical"!==s&&void 0===o.value.property,E=!x,D="array"===lr(o.value.stops)&&"array"===lr(o.value.stops[0])&&"object"===lr(o.value.stops[0][0]),M=$o({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(F){if("identity"===s)return[new It(F.key,F.value,'identity function may not have a "stops" property')];let U=[];const G=F.value;return U=U.concat(ja({key:F.key,value:G,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:A})),"array"===lr(G)&&0===G.length&&U.push(new It(F.key,G,"array must have at least one stop")),U},default:function(F){return vi({key:F.key,value:F.value,valueSpec:r,style:F.style,styleSpec:F.styleSpec})}}});return"identity"===s&&x&&M.push(new It(o.key,o.value,'missing required property "property"')),"identity"===s||o.value.stops||M.push(new It(o.key,o.value,'missing required property "stops"')),"exponential"===s&&o.valueSpec.expression&&!cd(o.valueSpec)&&M.push(new It(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(E&&!tc(o.valueSpec)?M.push(new It(o.key,o.value,"property functions not supported")):x&&!Ff(o.valueSpec)&&M.push(new It(o.key,o.value,"zoom functions not supported"))),"categorical"!==s&&!D||void 0!==o.value.property||M.push(new It(o.key,o.value,'"property" property is required')),M;function A(F){let U=[];const G=F.value,Z=F.key;if("array"!==lr(G))return[new It(Z,G,`array expected, ${lr(G)} found`)];if(2!==G.length)return[new It(Z,G,`array length 2 expected, length ${G.length} found`)];if(D){if("object"!==lr(G[0]))return[new It(Z,G,`object expected, ${lr(G[0])} found`)];if(void 0===G[0].zoom)return[new It(Z,G,"object stop key must have zoom")];if(void 0===G[0].value)return[new It(Z,G,"object stop key must have value")];const Q=Ot(G[0].zoom);if("number"!=typeof Q)return[new It(Z,G[0].zoom,"stop zoom values must be numbers")];if(g&&g>Q)return[new It(Z,G[0].zoom,"stop zoom values must appear in ascending order")];Q!==g&&(g=Q,d=void 0,y={}),U=U.concat($o({key:`${Z}[0]`,value:G[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:hd,value:k}}))}else U=U.concat(k({key:`${Z}[0]`,value:G[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},G));return Tl(Gn(G[1]))?U.concat([new It(`${Z}[1]`,G[1],"expressions are not allowed in function stops.")]):U.concat(vi({key:`${Z}[1]`,value:G[1],valueSpec:r,style:F.style,styleSpec:F.styleSpec}))}function k(F,U){const G=lr(F.value),Z=Ot(F.value),Q=null!==F.value?F.value:U;if(c){if(G!==c)return[new It(F.key,Q,`${G} stop domain type must match previous stop domain type ${c}`)]}else c=G;if("number"!==G&&"string"!==G&&"boolean"!==G&&"number"!=typeof Z&&"string"!=typeof Z&&"boolean"!=typeof Z)return[new It(F.key,Q,"stop domain value must be a number, string, or boolean")];if("number"!==G&&"categorical"!==s){let ue=`number expected, ${G} found`;return tc(r)&&void 0===s&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(F.key,Q,ue)]}return"categorical"!==s||"number"!==G||"number"==typeof Z&&isFinite(Z)&&Math.floor(Z)===Z?"categorical"!==s&&"number"===G&&"number"==typeof Z&&"number"==typeof d&&void 0!==d&&Z<d?[new It(F.key,Q,"stop domain values must appear in ascending order")]:(d=Z,"categorical"===s&&Z in y?[new It(F.key,Q,"stop domain values must be unique")]:(y[Z]=!0,[])):[new It(F.key,Q,`integer expected, found ${String(Z)}`)]}}function _a(o){const r=("property"===o.expressionContext?Jc:Cl)(Gn(o.value),o.valueSpec);if("error"===r.result)return r.value.map(c=>new It(`${o.key}${c.key}`,o.value,c.message));const s=r.value.expression||r.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!s.outputDefined())return[new It(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!Li(s))return[new It(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return Zs(s,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!ne(s,["zoom","feature-state"]))return[new It(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!fr(s))return[new It(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zs(o,r){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const d of r.valueSpec.expression.parameters)s.delete(d);if(0===s.size)return[];const c=[];return o instanceof fe&&s.has(o.name)?[new It(r.key,r.value,`["${o.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(o.eachChild(d=>{c.push(...Zs(d,r))}),c)}function Va(o){const r=o.key,s=o.value,c=o.valueSpec,d=[];return Array.isArray(c.values)?-1===c.values.indexOf(Ot(s))&&d.push(new It(r,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(c.values).indexOf(Ot(s))&&d.push(new It(r,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),d}function $a(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const r of o.slice(1))if(!$a(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function Sr(o,r="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};$a(o)||(o=Zi(o));const s=o;let c=!0;try{c=function(D){if(!zr(D))return D;let M=Gn(D);return fd(M),M=eu(M),M}(s)}catch(D){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const d=ke[`filter_${r}`],g=Cl(c,d);let y=null;if("error"===g.result)throw new Error(g.value.map(D=>`${D.key}: ${D.message}`).join(", "));y=(D,M,A)=>g.value.evaluate(D,M,{},A);let x=null,E=null;if(c!==s){const D=Cl(s,d);if("error"===D.result)throw new Error(D.value.map(M=>`${M.key}: ${M.message}`).join(", "));x=(M,A,k,F,U)=>D.value.evaluate(M,A,{},k,void 0,void 0,F,U),E=!fr(D.value.expression)}return y=y,{filter:y,dynamicFilter:x||void 0,needGeometry:Ga(c),needFeature:!!E}}function eu(o){if(!Array.isArray(o))return o;const r=function(s){if(pd.has(s[0]))for(let c=1;c<s.length;c++)if(zr(s[c]))return!0;return s}(o);return!0===r?r:r.map(s=>eu(s))}function fd(o){let r=!1;const s=[];if("case"===o[0]){for(let c=1;c<o.length-1;c+=2)r=r||zr(o[c]),s.push(o[c+1]);s.push(o[o.length-1])}else if("match"===o[0]){r=r||zr(o[1]);for(let c=2;c<o.length-1;c+=2)s.push(o[c+1]);s.push(o[o.length-1])}else if("step"===o[0]){r=r||zr(o[1]);for(let c=1;c<o.length-1;c+=2)s.push(o[c+1])}r&&(o.length=0,o.push("any",...s));for(let c=1;c<o.length;c++)fd(o[c])}function zr(o){if(!Array.isArray(o))return!1;if("pitch"===(r=o[0])||"distance-from-center"===r)return!0;var r;for(let s=1;s<o.length;s++)if(zr(o[s]))return!0;return!1}const pd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function md(o,r){return o<r?-1:o>r?1:0}function Ga(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let r=1;r<o.length;r++)if(Ga(o[r]))return!0;return!1}function Zi(o){if(!o)return!0;const r=o[0];return o.length<=1?"any"!==r:"=="===r?nc(o[1],o[2],"=="):"!="===r?Fi(nc(o[1],o[2],"==")):"<"===r||">"===r||"<="===r||">="===r?nc(o[1],o[2],r):"any"===r?(s=o.slice(1),["any"].concat(s.map(Zi))):"all"===r?["all"].concat(o.slice(1).map(Zi)):"none"===r?["all"].concat(o.slice(1).map(Zi).map(Fi)):"in"===r?rc(o[1],o.slice(2)):"!in"===r?Fi(rc(o[1],o.slice(2))):"has"===r?ya(o[1]):"!has"===r?Fi(ya(o[1])):"within"!==r||o;var s}function nc(o,r,s){switch(o){case"$type":return[`filter-type-${s}`,r];case"$id":return[`filter-id-${s}`,r];default:return[`filter-${s}`,o,r]}}function rc(o,r){if(0===r.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(s=>typeof s!=typeof r[0])?["filter-in-large",o,["literal",r.sort(md)]]:["filter-in-small",o,["literal",r]]}}function ya(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Fi(o){return["!",o]}function Ws(o){return $a(Gn(o.value))?_a(Yn({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):ic(o)}function ic(o){const r=o.value,s=o.key;if("array"!==lr(r))return[new It(s,r,`array expected, ${lr(r)} found`)];const c=o.styleSpec;let d,g=[];if(r.length<1)return[new It(s,r,"filter array must have at least 1 element")];switch(g=g.concat(Va({key:`${s}[0]`,value:r[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Ot(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Ot(r[1])&&g.push(new It(s,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&g.push(new It(s,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(d=lr(r[1]),"string"!==d&&g.push(new It(`${s}[1]`,r[1],`string expected, ${d} found`)));for(let y=2;y<r.length;y++)d=lr(r[y]),"$type"===Ot(r[1])?g=g.concat(Va({key:`${s}[${y}]`,value:r[y],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==d&&"number"!==d&&"boolean"!==d&&g.push(new It(`${s}[${y}]`,r[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<r.length;y++)g=g.concat(ic({key:`${s}[${y}]`,value:r[y],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":d=lr(r[1]),2!==r.length?g.push(new It(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==d&&g.push(new It(`${s}[1]`,r[1],`string expected, ${d} found`));break;case"within":d=lr(r[1]),2!==r.length?g.push(new It(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==d&&g.push(new It(`${s}[1]`,r[1],`object expected, ${d} found`))}return g}function Xu(o,r){const s=o.key,c=o.style,d=o.styleSpec,g=o.value,y=o.objectKey,x=d[`${r}_${o.layerType}`];if(!x)return[];const E=y.match(/^(.*)-transition$/);if("paint"===r&&E&&x[E[1]]&&x[E[1]].transition)return vi({key:s,value:g,valueSpec:d.transition,style:c,styleSpec:d});const D=o.valueSpec||x[y];if(!D)return[new It(s,g,`unknown property "${y}"`)];let M;if("string"===lr(g)&&tc(D)&&!D.tokens&&(M=/^{([^}]+)}$/.exec(g)))return[new It(s,g,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const A=[];return"symbol"===o.layerType&&("text-field"===y&&c&&!c.glyphs&&A.push(new It(s,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&qs(Gn(g))&&"identity"===Ot(g.type)&&A.push(new It(s,g,'"text-font" does not support identity functions'))),A.concat(vi({key:o.key,value:g,valueSpec:D,style:c,styleSpec:d,expressionContext:"property",propertyType:r,propertyKey:y}))}function ss(o){return Xu(o,"paint")}function tu(o){return Xu(o,"layout")}function nu(o){let r=[];const s=o.value,c=o.key,d=o.style,g=o.styleSpec;s.type||s.ref||r.push(new It(c,s,'either "type" or "ref" is required'));let y=Ot(s.type);const x=Ot(s.ref);if(s.id){const E=Ot(s.id);for(let D=0;D<o.arrayIndex;D++){const M=d.layers[D];Ot(M.id)===E&&r.push(new It(c,s.id,`duplicate layer id "${s.id}", previously used at line ${M.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(D=>{D in s&&r.push(new It(c,s[D],`"${D}" is prohibited for ref layers`))}),d.layers.forEach(D=>{Ot(D.id)===x&&(E=D)}),E?E.ref?r.push(new It(c,s.ref,"ref cannot reference another ref layer")):y=Ot(E.type):"string"==typeof x&&r.push(new It(c,s.ref,`ref layer "${x}" not found`))}else if("background"!==y&&"sky"!==y)if(s.source){const E=d.sources&&d.sources[s.source],D=E&&Ot(E.type);E?"vector"===D&&"raster"===y?r.push(new It(c,s.source,`layer "${s.id}" requires a raster source`)):"raster"===D&&"raster"!==y?r.push(new It(c,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==D||s["source-layer"]?"raster-dem"===D&&"hillshade"!==y?r.push(new It(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!s.paint||!s.paint["line-gradient"]||"geojson"===D&&E.lineMetrics||r.push(new It(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new It(c,s,`layer "${s.id}" must specify a "source-layer"`)):r.push(new It(c,s.source,`source "${s.source}" not found`))}else r.push(new It(c,s,'missing required property "source"'));return r=r.concat($o({key:c,value:s,valueSpec:g.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>vi({key:`${c}.type`,value:s.type,valueSpec:g.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:E=>Ws(Yn({layerType:y},E)),layout:E=>$o({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>tu(Yn({layerType:y},D))}}),paint:E=>$o({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":D=>ss(Yn({layerType:y},D))}})}})),r}function gn(o){const r=o.value,s=o.key,c=lr(r);return"string"!==c?[new It(s,r,`string expected, ${c} found`)]:[]}const Bf={promoteId:function({key:o,value:r}){if("string"===lr(r))return gn({key:o,value:r});{const s=[];for(const c in r)s.push(...gn({key:`${o}.${c}`,value:r[c]}));return s}}};function gd(o){const r=o.value,s=o.key,c=o.styleSpec,d=o.style;if(!r.type)return[new It(s,r,'"type" is required')];const g=Ot(r.type);let y;switch(g){case"vector":case"raster":case"raster-dem":return y=$o({key:s,value:r,valueSpec:c[`source_${g.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:Bf}),y;case"geojson":if(y=$o({key:s,value:r,valueSpec:c.source_geojson,style:d,styleSpec:c,objectElementValidators:Bf}),r.cluster)for(const x in r.clusterProperties){const[E,D]=r.clusterProperties[x],M="string"==typeof E?[E,["accumulated"],["get",x]]:E;y.push(..._a({key:`${s}.${x}.map`,value:D,expressionContext:"cluster-map"})),y.push(..._a({key:`${s}.${x}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return y;case"video":return $o({key:s,value:r,valueSpec:c.source_video,style:d,styleSpec:c});case"image":return $o({key:s,value:r,valueSpec:c.source_image,style:d,styleSpec:c});case"canvas":return[new It(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Va({key:`${s}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:c})}}function _d(o){const r=o.value,s=o.styleSpec,c=s.light,d=o.style;let g=[];const y=lr(r);if(void 0===r)return g;if("object"!==y)return g=g.concat([new It("light",r,`object expected, ${y} found`)]),g;for(const x in r){const E=x.match(/^(.*)-transition$/);g=g.concat(E&&c[E[1]]&&c[E[1]].transition?vi({key:x,value:r[x],valueSpec:s.transition,style:d,styleSpec:s}):c[x]?vi({key:x,value:r[x],valueSpec:c[x],style:d,styleSpec:s}):[new It(x,r[x],`unknown property "${x}"`)])}return g}function yd(o){const r=o.value,s=o.key,c=o.style,d=o.styleSpec,g=d.terrain;let y=[];const x=lr(r);if(void 0===r)return y;if("object"!==x)return y=y.concat([new It("terrain",r,`object expected, ${x} found`)]),y;for(const E in r){const D=E.match(/^(.*)-transition$/);y=y.concat(D&&g[D[1]]&&g[D[1]].transition?vi({key:E,value:r[E],valueSpec:d.transition,style:c,styleSpec:d}):g[E]?vi({key:E,value:r[E],valueSpec:g[E],style:c,styleSpec:d}):[new It(E,r[E],`unknown property "${E}"`)])}if(r.source){const E=c.sources&&c.sources[r.source],D=E&&Ot(E.type);E?"raster-dem"!==D&&y.push(new It(s,r.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):y.push(new It(s,r.source,`source "${r.source}" not found`))}else y.push(new It(s,r,'terrain is missing required property "source"'));return y}function Ku(o){const r=o.value,s=o.style,c=o.styleSpec,d=c.fog;let g=[];const y=lr(r);if(void 0===r)return g;if("object"!==y)return g=g.concat([new It("fog",r,`object expected, ${y} found`)]),g;for(const x in r){const E=x.match(/^(.*)-transition$/);g=g.concat(E&&d[E[1]]&&d[E[1]].transition?vi({key:x,value:r[x],valueSpec:c.transition,style:s,styleSpec:c}):d[x]?vi({key:x,value:r[x],valueSpec:d[x],style:s,styleSpec:c}):[new It(x,r[x],`unknown property "${x}"`)])}return g}const oc={"*":()=>[],array:ja,boolean:function(o){const r=o.value,s=o.key,c=lr(r);return"boolean"!==c?[new It(s,r,`boolean expected, ${c} found`)]:[]},number:hd,color:function(o){const r=o.key,s=o.value,c=lr(s);return"string"!==c?[new It(r,s,`color expected, ${c} found`)]:null===Hs.parseCSSColor(s)?[new It(r,s,`color expected, "${s}" found`)]:[]},enum:Va,filter:Ws,function:dd,layer:nu,object:$o,source:gd,light:_d,terrain:yd,fog:Ku,string:gn,formatted:function(o){return 0===gn(o).length?[]:_a(o)},resolvedImage:function(o){return 0===gn(o).length?[]:_a(o)},projection:function(o){const r=o.value,s=o.styleSpec,c=s.projection,d=o.style;let g=[];const y=lr(r);if("object"===y)for(const x in r)g=g.concat(vi({key:x,value:r[x],valueSpec:c[x],style:d,styleSpec:s}));else"string"!==y&&(g=g.concat([new It("projection",r,`object or string expected, ${y} found`)]));return g}};function vi(o){const r=o.value,s=o.valueSpec,c=o.styleSpec;return s.expression&&qs(Ot(r))?dd(o):s.expression&&Tl(Gn(r))?_a(o):s.type&&oc[s.type]?oc[s.type](o):$o(Yn({},o,{valueSpec:s.type?c[s.type]:s}))}function nt(o){const r=o.value,s=o.key,c=gn(o);return c.length||(-1===r.indexOf("{fontstack}")&&c.push(new It(s,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&c.push(new It(s,r,'"glyphs" url must include a "{range}" token'))),c}function Qn(o,r=ke){return ks(vi({key:"",value:o,valueSpec:r.$root,styleSpec:r,style:o,objectElementValidators:{glyphs:nt,"*":()=>[]}}))}const Uf=o=>ks(ss(o)),xi=o=>ks(tu(o));function ks(o){return o.slice().sort((r,s)=>r.line&&s.line?r.line-s.line:0)}function Dl(o,r){let s=!1;if(r&&r.length)for(const c of r)o.fire(new Ut(new Error(c.message))),s=!0;return s}var zi=Go;function Go(o,r,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var d=new Int32Array(this.arrayBuffer);o=d[0],this.d=(r=d[1])+2*(s=d[2]);for(var g=0;g<this.d*this.d;g++){var y=d[3+g],x=d[3+g+1];c.push(y===x?null:d.subarray(y,x))}var E=d[3+c.length+1];this.keys=d.subarray(d[3+c.length],E),this.bboxes=d.subarray(E),this.insert=this._insertReadonly}else{this.d=r+2*s;for(var D=0;D<this.d*this.d;D++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=o,this.padding=s,this.scale=r/o,this.uid=0;var M=s/r*o;this.min=-M,this.max=o+M}Go.prototype.insert=function(o,r,s,c,d){this._forEachCell(r,s,c,d,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(d)},Go.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Go.prototype._insertCell=function(o,r,s,c,d,g){this.cells[d].push(g)},Go.prototype.query=function(o,r,s,c,d){var g=this.min,y=this.max;if(o<=g&&r<=g&&y<=s&&y<=c&&!d)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(o,r,s,c,this._queryCell,x,{},d),x},Go.prototype._queryCell=function(o,r,s,c,d,g,y,x){var E=this.cells[d];if(null!==E)for(var D=this.keys,M=this.bboxes,A=0;A<E.length;A++){var k=E[A];if(void 0===y[k]){var F=4*k;(x?x(M[F+0],M[F+1],M[F+2],M[F+3]):o<=M[F+2]&&r<=M[F+3]&&s>=M[F+0]&&c>=M[F+1])?(y[k]=!0,g.push(D[k])):y[k]=!1}}},Go.prototype._forEachCell=function(o,r,s,c,d,g,y,x){for(var E=this._convertToCellCoord(o),D=this._convertToCellCoord(r),M=this._convertToCellCoord(s),A=this._convertToCellCoord(c),k=E;k<=M;k++)for(var F=D;F<=A;F++){var U=this.d*F+k;if((!x||x(this._convertFromCellCoord(k),this._convertFromCellCoord(F),this._convertFromCellCoord(k+1),this._convertFromCellCoord(F+1)))&&d.call(this,o,r,s,c,U,g,y,x))return}},Go.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Go.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Go.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,r=3+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var d=new Int32Array(r+s+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var g=r,y=0;y<o.length;y++){var x=o[y];d[3+y]=g,d.set(x,g),g+=x.length}return d[3+o.length]=g,d.set(this.keys,g),d[3+o.length+1]=g+=this.keys.length,d.set(this.bboxes,g),g+=this.bboxes.length,d.buffer};const Xs={};function Rt(o,r={}){Xs[o.name]={klass:o,omit:r.omit||[]}}Rt(Object),zi.serialize=function(o,r){const s=o.toArrayBuffer();return r&&r.push(s),{buffer:s}},zi.deserialize=function(o){return new zi(o.buffer)},Object.defineProperty(zi,"name",{value:"Grid"}),Rt(zi),Rt(jn),Rt(Error),Rt(z),Rt(Cr),Rt(Qc),Rt(Kc,{omit:["_evaluator"]}),Rt(Wu),Rt(Yc),Rt(fe,{omit:["_evaluate"]});for(const o in wl)Xs[wl[o].name]||Rt(wl[o]);function vd(o){return o&&"undefined"!=typeof ArrayBuffer&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function Ha(o){return ae.ImageBitmap&&o instanceof ae.ImageBitmap}function va(o,r){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(vd(o)||Ha(o))return r&&r.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return r&&r.push(s.buffer),s}if(o instanceof ae.ImageData)return r&&r.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const c of o)s.push(va(c,r));return s}if("object"==typeof o){const s=o.constructor,c=s.name;if(!Xs[c])throw new Error(`can't serialize object of unregistered class ${c}`);const d=s.serialize?s.serialize(o,r):{};if(!s.serialize){for(const g in o)o.hasOwnProperty(g)&&(Xs[c].omit.indexOf(g)>=0||(d[g]=va(o[g],r)));o instanceof Error&&(d.message=o.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(d.$name=c),d}throw new Error("can't serialize object of type "+typeof o)}function mi(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||vd(o)||Ha(o)||ArrayBuffer.isView(o)||o instanceof ae.ImageData)return o;if(Array.isArray(o))return o.map(mi);if("object"==typeof o){const r=o.$name||"Object",{klass:s}=Xs[r];if(!s)throw new Error(`can't deserialize unregistered class ${r}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const d of Object.keys(o))"$name"!==d&&(c[d]=mi(o[d]));return c}throw new Error("can't deserialize object of type "+typeof o)}class as{constructor(){this.first=!0}update(r,s){const c=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=c,!0))}}const Yu=o=>o>=1536&&o<=1791,Ks=o=>o>=1872&&o<=1919,Ao=o=>o>=2208&&o<=2303,Ju=o=>o>=11904&&o<=12031,Qu=o=>o>=12032&&o<=12255,eh=o=>o>=12272&&o<=12287,ru=o=>o>=12288&&o<=12351,qa=o=>o>=12352&&o<=12447,Sl=o=>o>=12448&&o<=12543,th=o=>o>=12544&&o<=12591,iu=o=>o>=12704&&o<=12735,xd=o=>o>=12736&&o<=12783,ou=o=>o>=12784&&o<=12799,sc=o=>o>=12800&&o<=13055,nh=o=>o>=13056&&o<=13311,rh=o=>o>=13312&&o<=19903,su=o=>o>=19968&&o<=40959,ih=o=>o>=40960&&o<=42127,ac=o=>o>=42128&&o<=42191,bd=o=>o>=44032&&o<=55215,lc=o=>o>=63744&&o<=64255,Ni=o=>o>=64336&&o<=65023,Ys=o=>o>=65040&&o<=65055,Nr=o=>o>=65072&&o<=65103,wd=o=>o>=65104&&o<=65135,au=o=>o>=65136&&o<=65279,oh=o=>o>=65280&&o<=65519;function lu(o){for(const r of o)if(Za(r.charCodeAt(0)))return!0;return!1}function Ed(o){for(const r of o)if(!Td(r.charCodeAt(0)))return!1;return!0}function Td(o){return!(Yu(o)||Ks(o)||Ao(o)||Ni(o)||au(o))}function Za(o){return!(746!==o&&747!==o&&(o<4352||!(iu(o)||th(o)||Nr(o)&&!(o>=65097&&o<=65103)||lc(o)||nh(o)||Ju(o)||xd(o)||!(!ru(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||rh(o)||su(o)||sc(o)||(r=o,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(o)||(r=>r>=55216&&r<=55295)(o)||(r=>r>=4352&&r<=4607)(o)||bd(o)||qa(o)||eh(o)||(r=>r>=12688&&r<=12703)(o)||Qu(o)||ou(o)||Sl(o)&&12540!==o||!(!oh(o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!wd(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(r=>r>=5120&&r<=5759)(o)||(r=>r>=6320&&r<=6399)(o)||Ys(o)||(r=>r>=19904&&r<=19967)(o)||ih(o)||ac(o))));var r}function Wa(o){return!(Za(o)||(r=o,(s=r)>=128&&s<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(s=>s>=8192&&s<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(s=>s>=8448&&s<=8527)(r)||(s=>s>=8528&&s<=8591)(r)||(s=>s>=8960&&s<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(s=>s>=9216&&s<=9279)(r)&&9251!==r||(s=>s>=9280&&s<=9311)(r)||(s=>s>=9312&&s<=9471)(r)||(s=>s>=9632&&s<=9727)(r)||(s=>s>=9728&&s<=9983)(r)&&!(r>=9754&&r<=9759)||(s=>s>=11008&&s<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||ru(r)||Sl(r)||(s=>s>=57344&&s<=63743)(r)||Nr(r)||wd(r)||oh(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,s}function Xa(o){return o>=1424&&o<=2303||Ni(o)||au(o)}function sh(o,r){return!(!r&&Xa(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(s=o,s>=6016&&s<=6143));var s}function Cd(o){for(const r of o)if(Xa(r.charCodeAt(0)))return!0;return!1}const ah="deferred",Ho="loading",Ka="loaded";let lh=null,_o="unavailable",Bi=null;const Ya=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(_o="error"),lh&&lh(o)};function Ja(){ch.fire(new Bt("pluginStateChange",{pluginStatus:_o,pluginURL:Bi}))}const ch=new Xt,uh=function(){return _o},cc=function(){if(_o!==ah||!Bi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_o=Ho,Ja(),Bi&&Y({url:Bi},o=>{o?Ya(o):(_o=Ka,Ja())})},oo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_o===Ka||null!=oo.applyArabicShaping,isLoading:()=>_o===Ho,setState(o){_o=o.pluginStatus,Bi=o.pluginURL},isParsed:()=>null!=oo.applyArabicShaping&&null!=oo.processBidirectionalText&&null!=oo.processStyledBidirectionalText,getPluginURL:()=>Bi};class Ir{constructor(r,s){this.zoom=r,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new as,this.transition={},this.pitch=0)}isSupportedScript(r){return function(s,c){for(const d of s)if(!sh(d.charCodeAt(0),c))return!1;return!0}(r,oo.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,s=r-Math.floor(r),c=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class Qa{constructor(r,s){this.property=r,this.value=s,this.expression=function(c,d){if(qs(c))return new Qc(c,d);if(Tl(c)){const g=Jc(c,d);if("error"===g.result)throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=c;return"string"==typeof c&&"color"===d.type&&(g=jn.parse(c)),{kind:"constant",evaluate:()=>g}}}(void 0===s?r.specification.default:s,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,s,c){return this.property.possiblyEvaluate(this,r,s,c)}}class Js{constructor(r){this.property=r,this.value=new Qa(r,void 0)}transitioned(r,s){return new i(this.property,this.value,s,en({},r.transition,this.transition),r.now)}untransitioned(){return new i(this.property,this.value,null,{},0)}}class p{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Qt(this._values[r].value.value)}setValue(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new Js(this._values[r].property)),this._values[r].value=new Qa(this._values[r].property,null===s?void 0:Qt(s))}getTransition(r){return Qt(this._values[r].transition)}setTransition(r,s){this._values.hasOwnProperty(r)||(this._values[r]=new Js(this._values[r].property)),this._values[r].transition=Qt(s)||void 0}serialize(){const r={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(r[s]=c);const d=this.getTransition(s);void 0!==d&&(r[`${s}-transition`]=d)}return r}transitioned(r,s){const c=new h(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(r,s._values[d]);return c}untransitioned(){const r=new h(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].untransitioned();return r}}class i{constructor(r,s,c,d,g){const y=d.delay||0,x=d.duration||0;g=g||0,this.property=r,this.value=s,this.begin=g+y,this.end=this.begin+x,r.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(r,s,c){const d=r.now||0,g=this.value.possiblyEvaluate(r,s,c),y=this.prior;if(y){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return y.possiblyEvaluate(r,s,c);{const x=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,s,c),g,wt(x))}}return g}}class h{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,s,c){const d=new w(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(r,s,c);return d}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class _{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Qt(this._values[r].value)}setValue(r,s){this._values[r]=new Qa(this._values[r].property,null===s?void 0:Qt(s))}serialize(){const r={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(r[s]=c)}return r}possiblyEvaluate(r,s,c){const d=new w(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(r,s,c);return d}}class b{constructor(r,s,c){this.property=r,this.value=s,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,s,c,d){return this.property.evaluate(this.value,this.parameters,r,s,c,d)}}class w{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class C{constructor(r){this.specification=r}possiblyEvaluate(r,s){return r.expression.evaluate(s)}interpolate(r,s,c){const d=Jn[this.specification.type];return d?d(r,s,c):r}}class S{constructor(r,s){this.specification=r,this.overrides=s}possiblyEvaluate(r,s,c,d){return new b(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(s,null,{},c,d)}:r.expression,s)}interpolate(r,s,c){if("constant"!==r.value.kind||"constant"!==s.value.kind)return r;if(void 0===r.value.value||void 0===s.value.value)return new b(this,{kind:"constant",value:void 0},r.parameters);const d=Jn[this.specification.type];return d?new b(this,{kind:"constant",value:d(r.value.value,s.value.value,c)},r.parameters):r}evaluate(r,s,c,d,g,y){return"constant"===r.kind?r.value:r.evaluate(s,c,d,g,y)}}class P extends S{possiblyEvaluate(r,s,c,d){if(void 0===r.value)return new b(this,{kind:"constant",value:void 0},s);if("constant"===r.expression.kind){const g=r.expression.evaluate(s,null,{},c,d),y="resolvedImage"===r.property.specification.type&&"string"!=typeof g?g.name:g,x=this._calculate(y,y,y,s);return new b(this,{kind:"constant",value:x},s)}if("camera"===r.expression.kind){const g=this._calculate(r.expression.evaluate({zoom:s.zoom-1}),r.expression.evaluate({zoom:s.zoom}),r.expression.evaluate({zoom:s.zoom+1}),s);return new b(this,{kind:"constant",value:g},s)}return new b(this,r.expression,s)}evaluate(r,s,c,d,g,y){if("source"===r.kind){const x=r.evaluate(s,c,d,g,y);return this._calculate(x,x,x,s)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(s.zoom)-1},c,d),r.evaluate({zoom:Math.floor(s.zoom)},c,d),r.evaluate({zoom:Math.floor(s.zoom)+1},c,d),s):r.value}_calculate(r,s,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:r,to:s,other:c}:{from:c,to:s,other:r}}interpolate(r){return r}}class R{constructor(r){this.specification=r}possiblyEvaluate(r,s,c,d){if(void 0!==r.value){if("constant"===r.expression.kind){const g=r.expression.evaluate(s,null,{},c,d);return this._calculate(g,g,g,s)}return this._calculate(r.expression.evaluate(new Ir(Math.floor(s.zoom-1),s)),r.expression.evaluate(new Ir(Math.floor(s.zoom),s)),r.expression.evaluate(new Ir(Math.floor(s.zoom+1),s)),s)}}_calculate(r,s,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:r,to:s}:{from:c,to:s}}interpolate(r){return r}}class L{constructor(r){this.specification=r}possiblyEvaluate(r,s,c,d){return!!r.expression.evaluate(s,null,{},c,d)}interpolate(){return!1}}class B{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in r){const c=r[s];c.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new Qa(c,void 0),g=this.defaultTransitionablePropertyValues[s]=new Js(c);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}}}function $(o,r){return 256*(o=De(Math.floor(o),0,255))+De(Math.floor(r),0,255)}Rt(S),Rt(C),Rt(P),Rt(R),Rt(L);const W={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class q{constructor(r,s){this._structArray=r,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class V{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,s){return r._trim(),s&&(r.isTransferred=!0,s.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const s=Object.create(this.prototype);return s.arrayBuffer=r.arrayBuffer,s.length=r.length,s.capacity=r.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function re(o,r=1){let s=0,c=0;return{members:o.map(d=>{const g=W[d.type].BYTES_PER_ELEMENT,y=s=J(s,Math.max(r,g)),x=d.components||1;return c=Math.max(c,g),s+=g*x,{name:d.name,type:d.type,components:x,offset:y}}),size:J(s,Math.max(c,r)),alignment:r}}function J(o,r){return Math.ceil(o/r)*r}class te extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s){const c=this.length;return this.resize(c+1),this.emplace(c,r,s)}emplace(r,s,c){const d=2*r;return this.int16[d+0]=s,this.int16[d+1]=c,r}}te.prototype.bytesPerElement=4,Rt(te);class ie extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,s,c)}emplace(r,s,c,d){const g=3*r;return this.int16[g+0]=s,this.int16[g+1]=c,this.int16[g+2]=d,r}}ie.prototype.bytesPerElement=6,Rt(ie);class le extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,c,d)}emplace(r,s,c,d,g){const y=4*r;return this.int16[y+0]=s,this.int16[y+1]=c,this.int16[y+2]=d,this.int16[y+3]=g,r}}le.prototype.bytesPerElement=8,Rt(le);class ee extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,c,d,g,y,x)}emplace(r,s,c,d,g,y,x,E){const D=6*r,M=12*r,A=3*r;return this.int16[D+0]=s,this.int16[D+1]=c,this.uint8[M+4]=d,this.uint8[M+5]=g,this.uint8[M+6]=y,this.uint8[M+7]=x,this.float32[A+2]=E,r}}ee.prototype.bytesPerElement=12,Rt(ee);class he extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,s,c)}emplace(r,s,c,d){const g=3*r;return this.float32[g+0]=s,this.float32[g+1]=c,this.float32[g+2]=d,r}}he.prototype.bytesPerElement=12,Rt(he);class Ae extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y,x,E,D,M){const A=this.length;return this.resize(A+1),this.emplace(A,r,s,c,d,g,y,x,E,D,M)}emplace(r,s,c,d,g,y,x,E,D,M,A){const k=10*r;return this.uint16[k+0]=s,this.uint16[k+1]=c,this.uint16[k+2]=d,this.uint16[k+3]=g,this.uint16[k+4]=y,this.uint16[k+5]=x,this.uint16[k+6]=E,this.uint16[k+7]=D,this.uint16[k+8]=M,this.uint16[k+9]=A,r}}Ae.prototype.bytesPerElement=20,Rt(Ae);class ze extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y,x,E){const D=this.length;return this.resize(D+1),this.emplace(D,r,s,c,d,g,y,x,E)}emplace(r,s,c,d,g,y,x,E,D){const M=8*r;return this.uint16[M+0]=s,this.uint16[M+1]=c,this.uint16[M+2]=d,this.uint16[M+3]=g,this.uint16[M+4]=y,this.uint16[M+5]=x,this.uint16[M+6]=E,this.uint16[M+7]=D,r}}ze.prototype.bytesPerElement=16,Rt(ze);class $e extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,s,c,d,g,y)}emplace(r,s,c,d,g,y,x){const E=6*r;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=d,this.int16[E+3]=g,this.int16[E+4]=y,this.int16[E+5]=x,r}}$e.prototype.bytesPerElement=12,Rt($e);class je extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y,x,E,D,M,A,k,F,U,G,Z){const Q=this.length;return this.resize(Q+1),this.emplace(Q,r,s,c,d,g,y,x,E,D,M,A,k,F,U,G,Z)}emplace(r,s,c,d,g,y,x,E,D,M,A,k,F,U,G,Z,Q){const ue=16*r;return this.int16[ue+0]=s,this.int16[ue+1]=c,this.int16[ue+2]=d,this.int16[ue+3]=g,this.uint16[ue+4]=y,this.uint16[ue+5]=x,this.uint16[ue+6]=E,this.uint16[ue+7]=D,this.int16[ue+8]=M,this.int16[ue+9]=A,this.int16[ue+10]=k,this.int16[ue+11]=F,this.int16[ue+12]=U,this.int16[ue+13]=G,this.int16[ue+14]=Z,this.int16[ue+15]=Q,r}}je.prototype.bytesPerElement=32,Rt(je);class mt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint32[1*r+0]=s,r}}mt.prototype.bytesPerElement=4,Rt(mt);class Me extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y,x,E,D,M,A,k,F){const U=this.length;return this.resize(U+1),this.emplace(U,r,s,c,d,g,y,x,E,D,M,A,k,F)}emplace(r,s,c,d,g,y,x,E,D,M,A,k,F,U){const G=20*r,Z=10*r;return this.int16[G+0]=s,this.int16[G+1]=c,this.int16[G+2]=d,this.int16[G+3]=g,this.int16[G+4]=y,this.float32[Z+3]=x,this.float32[Z+4]=E,this.float32[Z+5]=D,this.float32[Z+6]=M,this.int16[G+14]=A,this.uint32[Z+8]=k,this.uint16[G+18]=F,this.uint16[G+19]=U,r}}Me.prototype.bytesPerElement=40,Rt(Me);class at extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,c,d,g,y,x)}emplace(r,s,c,d,g,y,x,E){const D=8*r;return this.int16[D+0]=s,this.int16[D+1]=c,this.int16[D+2]=d,this.int16[D+4]=g,this.int16[D+5]=y,this.int16[D+6]=x,this.int16[D+7]=E,r}}at.prototype.bytesPerElement=16,Rt(at);class ut extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,c,d,g)}emplace(r,s,c,d,g,y){const x=4*r,E=8*r;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=d,this.int16[E+6]=g,this.int16[E+7]=y,r}}ut.prototype.bytesPerElement=16,Rt(ut);class Lt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,c,d)}emplace(r,s,c,d,g){const y=12*r,x=3*r;return this.uint8[y+0]=s,this.uint8[y+1]=c,this.float32[x+1]=d,this.float32[x+2]=g,r}}Lt.prototype.bytesPerElement=12,Rt(Lt);class Ne extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,s,c)}emplace(r,s,c,d){const g=3*r;return this.uint16[g+0]=s,this.uint16[g+1]=c,this.uint16[g+2]=d,r}}Ne.prototype.bytesPerElement=6,Rt(Ne);class jt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y,x,E,D,M,A,k,F,U,G,Z,Q,ue,ye,be,Ee){const Te=this.length;return this.resize(Te+1),this.emplace(Te,r,s,c,d,g,y,x,E,D,M,A,k,F,U,G,Z,Q,ue,ye,be,Ee)}emplace(r,s,c,d,g,y,x,E,D,M,A,k,F,U,G,Z,Q,ue,ye,be,Ee,Te){const Be=30*r,Ve=15*r,Ye=60*r;return this.int16[Be+0]=s,this.int16[Be+1]=c,this.int16[Be+2]=d,this.float32[Ve+2]=g,this.float32[Ve+3]=y,this.uint16[Be+8]=x,this.uint16[Be+9]=E,this.uint32[Ve+5]=D,this.uint32[Ve+6]=M,this.uint32[Ve+7]=A,this.uint16[Be+16]=k,this.uint16[Be+17]=F,this.uint16[Be+18]=U,this.float32[Ve+10]=G,this.float32[Ve+11]=Z,this.uint8[Ye+48]=Q,this.uint8[Ye+49]=ue,this.uint8[Ye+50]=ye,this.uint32[Ve+13]=be,this.int16[Be+28]=Ee,this.uint8[Ye+58]=Te,r}}jt.prototype.bytesPerElement=60,Rt(jt);class Ht extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y,x,E,D,M,A,k,F,U,G,Z,Q,ue,ye,be,Ee,Te,Be,Ve,Ye,et,Oe,He,ot,pt){const ht=this.length;return this.resize(ht+1),this.emplace(ht,r,s,c,d,g,y,x,E,D,M,A,k,F,U,G,Z,Q,ue,ye,be,Ee,Te,Be,Ve,Ye,et,Oe,He,ot,pt)}emplace(r,s,c,d,g,y,x,E,D,M,A,k,F,U,G,Z,Q,ue,ye,be,Ee,Te,Be,Ve,Ye,et,Oe,He,ot,pt,ht){const _t=38*r,dn=19*r;return this.int16[_t+0]=s,this.int16[_t+1]=c,this.int16[_t+2]=d,this.float32[dn+2]=g,this.float32[dn+3]=y,this.int16[_t+8]=x,this.int16[_t+9]=E,this.int16[_t+10]=D,this.int16[_t+11]=M,this.int16[_t+12]=A,this.int16[_t+13]=k,this.uint16[_t+14]=F,this.uint16[_t+15]=U,this.uint16[_t+16]=G,this.uint16[_t+17]=Z,this.uint16[_t+18]=Q,this.uint16[_t+19]=ue,this.uint16[_t+20]=ye,this.uint16[_t+21]=be,this.uint16[_t+22]=Ee,this.uint16[_t+23]=Te,this.uint16[_t+24]=Be,this.uint16[_t+25]=Ve,this.uint16[_t+26]=Ye,this.uint16[_t+27]=et,this.uint16[_t+28]=Oe,this.uint32[dn+15]=He,this.float32[dn+16]=ot,this.float32[dn+17]=pt,this.float32[dn+18]=ht,r}}Ht.prototype.bytesPerElement=76,Rt(Ht);class At extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.float32[1*r+0]=s,r}}At.prototype.bytesPerElement=4,Rt(At);class Ft extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,c,d,g,y,x)}emplace(r,s,c,d,g,y,x,E){const D=7*r;return this.float32[D+0]=s,this.float32[D+1]=c,this.float32[D+2]=d,this.float32[D+3]=g,this.float32[D+4]=y,this.float32[D+5]=x,this.float32[D+6]=E,r}}Ft.prototype.bytesPerElement=28,Rt(Ft);class tn extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,s,c,d,g)}emplace(r,s,c,d,g,y){const x=5*r;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=d,this.float32[x+3]=g,this.float32[x+4]=y,r}}tn.prototype.bytesPerElement=20,Rt(tn);class _n extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,c,d)}emplace(r,s,c,d,g){const y=6*r;return this.uint32[3*r+0]=s,this.uint16[y+2]=c,this.uint16[y+3]=d,this.uint16[y+4]=g,r}}_n.prototype.bytesPerElement=12,Rt(_n);class qt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,s){const c=this.length;return this.resize(c+1),this.emplace(c,r,s)}emplace(r,s,c){const d=2*r;return this.uint16[d+0]=s,this.uint16[d+1]=c,r}}qt.prototype.bytesPerElement=4,Rt(qt);class pn extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const s=this.length;return this.resize(s+1),this.emplace(s,r)}emplace(r,s){return this.uint16[1*r+0]=s,r}}pn.prototype.bytesPerElement=2,Rt(pn);class Vt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s){const c=this.length;return this.resize(c+1),this.emplace(c,r,s)}emplace(r,s,c){const d=2*r;return this.float32[d+0]=s,this.float32[d+1]=c,r}}Vt.prototype.bytesPerElement=8,Rt(Vt);class Qr extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,s,c,d)}emplace(r,s,c,d,g){const y=4*r;return this.float32[y+0]=s,this.float32[y+1]=c,this.float32[y+2]=d,this.float32[y+3]=g,r}}Qr.prototype.bytesPerElement=16,Rt(Qr);class so extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,s,c,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,s,c,d,g,y,x)}emplace(r,s,c,d,g,y,x,E){const D=8*r,M=4*r;return this.int16[D+0]=s,this.int16[D+1]=c,this.int16[D+2]=d,this.int16[D+3]=g,this.int16[D+4]=y,this.int16[D+5]=x,this.float32[M+3]=E,r}}so.prototype.bytesPerElement=16,Rt(so);class ao extends q{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ao.prototype.size=12;class qo extends $e{get(r){return new ao(this,r)}}Rt(qo);class Rs extends q{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Rs.prototype.size=40;class xa extends Me{get(r){return new Rs(this,r)}}Rt(xa);class el extends q{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}el.prototype.size=60;class Po extends jt{get(r){return new el(this,r)}}Rt(Po);class ti extends q{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ti.prototype.size=76;class $n extends Ht{get(r){return new ti(this,r)}}Rt($n);class tr extends At{getoffsetX(r){return this.float32[1*r+0]}}Rt(tr);class qr extends ie{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Rt(qr);class Zo extends q{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Zo.prototype.size=12;class Zr extends _n{get(r){return new Zo(this,r)}}Rt(Zr);class ni extends q{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ni.prototype.size=4;class yo extends qt{get(r){return new ni(this,r)}}Rt(yo);class vo extends q{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}vo.prototype.size=16;class Os extends so{get(r){return new vo(this,r)}}Rt(Os);const Il=re([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),cu=re([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Ml=Ts(function(o){o.exports=function(r,s){var c,d,g,y,x,E,D,M;for(d=r.length-(c=3&r.length),g=s,x=3432918353,E=461845907,M=0;M<d;)D=255&r.charCodeAt(M)|(255&r.charCodeAt(++M))<<8|(255&r.charCodeAt(++M))<<16|(255&r.charCodeAt(++M))<<24,++M,g=27492+(65535&(y=5*(65535&(g=(g^=D=(65535&(D=(D=(65535&D)*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*E+(((D>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(D=0,c){case 3:D^=(255&r.charCodeAt(M+2))<<16;case 2:D^=(255&r.charCodeAt(M+1))<<8;case 1:g^=D=(65535&(D=(D=(65535&(D^=255&r.charCodeAt(M)))*x+(((D>>>16)*x&65535)<<16)&4294967295)<<15|D>>>17))*E+(((D>>>16)*E&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),jf=Ts(function(o){o.exports=function(r,s){for(var c,d=r.length,g=s^d,y=0;d>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:g^=(255&r.charCodeAt(y+2))<<16;case 2:g^=(255&r.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),tl=Ml,Dd=jf;tl.murmur3=Ml,tl.murmur2=Dd;class hh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,s,c,d){this.ids.push(Wo(r)),this.positions.push(s,c,d)}getPositions(r){const s=Wo(r);let c=0,d=this.ids.length-1;for(;c<d;){const y=c+d>>1;this.ids[y]>=s?d=y:c=y+1}const g=[];for(;this.ids[c]===s;)g.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return g}static serialize(r,s){const c=new Float64Array(r.ids),d=new Uint32Array(r.positions);return dh(c,d,0,c.length-1),s&&s.push(c.buffer,d.buffer),{ids:c,positions:d}}static deserialize(r){const s=new hh;return s.ids=r.ids,s.positions=r.positions,s.indexed=!0,s}}function Wo(o){const r=+o;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:tl(String(o))}function dh(o,r,s,c){for(;s<c;){const d=o[s+c>>1];let g=s-1,y=c+1;for(;;){do{g++}while(o[g]<d);do{y--}while(o[y]>d);if(g>=y)break;nl(o,g,y),nl(r,3*g,3*y),nl(r,3*g+1,3*y+1),nl(r,3*g+2,3*y+2)}y-s<c-y?(dh(o,r,s,y),s=y+1):(dh(o,r,y+1,c),c=y)}}function nl(o,r,s){const c=o[r];o[r]=o[s],o[s]=c}Rt(hh);class Al{constructor(r,s){this.gl=r.gl,this.location=s}}class fh extends Al{constructor(r,s){super(r,s),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Om extends Al{constructor(r,s){super(r,s),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Lm extends Al{constructor(r,s){super(r,s),this.current=jn.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const oy=new Float32Array(16),sy=new Float32Array(9),ay=new Float32Array(4);function Sd(o){return[$(255*o.r,255*o.g),$(255*o.b,255*o.a)]}class uc{constructor(r,s,c){this.value=r,this.uniformNames=s.map(d=>`u_${d}`),this.type=c}setUniform(r,s,c){r.set(c.constantOr(this.value))}getBinding(r,s,c){return"color"===this.type?new Lm(r,s):new fh(r,s)}}class rl{constructor(r,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,s){this.pixelRatioFrom=s.pixelRatio||1,this.pixelRatioTo=r.pixelRatio||1,this.patternFrom=s.tl.concat(s.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,s,c,d){const g="u_pattern_to"===d||"u_dash_to"===d?this.patternTo:"u_pattern_from"===d||"u_dash_from"===d?this.patternFrom:"u_pixel_ratio_to"===d?this.pixelRatioTo:"u_pixel_ratio_from"===d?this.pixelRatioFrom:null;g&&r.set(g)}getBinding(r,s,c){return"u_pattern_from"===c||"u_pattern_to"===c||"u_dash_from"===c||"u_dash_to"===c?new Om(r,s):new fh(r,s)}}class Pl{constructor(r,s,c,d){this.expression=r,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(r,s,c,d,g,y){const x=this.paintVertexArray.length,E=this.expression.evaluate(new Ir(0),s,{},g,d,y);this.paintVertexArray.resize(r),this._setPaintValue(x,r,E)}updatePaintArray(r,s,c,d,g){const y=this.expression.evaluate({zoom:0},c,d,void 0,g);this._setPaintValue(r,s,y)}_setPaintValue(r,s,c){if("color"===this.type){const d=Sd(c);for(let g=r;g<s;g++)this.paintVertexArray.emplace(g,d[0],d[1])}else{for(let d=r;d<s;d++)this.paintVertexArray.emplace(d,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ko{constructor(r,s,c,d,g,y){this.expression=r,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=d,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,s,c,d,g,y){const x=this.expression.evaluate(new Ir(this.zoom),s,{},g,d,y),E=this.expression.evaluate(new Ir(this.zoom+1),s,{},g,d,y),D=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(D,r,x,E)}updatePaintArray(r,s,c,d,g){const y=this.expression.evaluate({zoom:this.zoom},c,d,void 0,g),x=this.expression.evaluate({zoom:this.zoom+1},c,d,void 0,g);this._setPaintValue(r,s,y,x)}_setPaintValue(r,s,c,d){if("color"===this.type){const g=Sd(c),y=Sd(d);for(let x=r;x<s;x++)this.paintVertexArray.emplace(x,g[0],g[1],y[0],y[1])}else{for(let g=r;g<s;g++)this.paintVertexArray.emplace(g,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=De(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);r.set(d)}getBinding(r,s,c){return new fh(r,s)}}class ba{constructor(r,s,c,d,g,y,x){this.expression=r,this.type=c,this.useIntegerZoom=d,this.zoom=g,this.layerId=x,this.paintVertexAttributes=("array"===c?cu:Il).members;for(let E=0;E<s.length;++E);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(r,s,c){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(d,r,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(r,s,c,d,g,y){this._setPaintValues(r,s,c.patterns&&c.patterns[this.layerId],y)}_setPaintValues(r,s,c,d){if(!d||!c)return;const{min:g,mid:y,max:x}=c,E=d[g],D=d[y],M=d[x];if(E&&D&&M)for(let A=r;A<s;A++)this._setPaintValue(this.zoomInPaintVertexArray,A,D,E),this._setPaintValue(this.zoomOutPaintVertexArray,A,D,M)}_setPaintValue(r,s,c,d){r.emplace(s,c.tl[0],c.tl[1],c.br[0],c.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1],c.pixelRatio,d.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Qs{constructor(r,s,c=(()=>!0)){this.binders={},this._buffers=[];const d=[];for(const g in r.paint._values){if(!c(g))continue;const y=r.paint.get(g);if(!(y instanceof b&&tc(y.property.specification)))continue;const x=cy(g,r.type),E=y.value,D=y.property.specification.type,M=y.property.useIntegerZoom,A=y.property.specification["property-type"],k="cross-faded"===A||"cross-faded-data-driven"===A,F="line-dasharray"===String(g)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==E.kind||F)if("source"===E.kind||F||k){const U=uu(g,D,"source");this.binders[g]=k?new ba(E,x,D,M,s,U,r.id):new Pl(E,x,D,U),d.push(`/a_${g}`)}else{const U=uu(g,D,"composite");this.binders[g]=new ko(E,x,D,M,s,U),d.push(`/z_${g}`)}else this.binders[g]=k?new rl(E.value,x):new uc(E.value,x,D),d.push(`/u_${g}`)}this.cacheKey=d.sort().join("")}getMaxValue(r){const s=this.binders[r];return s instanceof Pl||s instanceof ko?s.maxValue:0}populatePaintArrays(r,s,c,d,g,y){for(const x in this.binders){const E=this.binders[x];(E instanceof Pl||E instanceof ko||E instanceof ba)&&E.populatePaintArray(r,s,c,d,g,y)}}setConstantPatternPositions(r,s){for(const c in this.binders){const d=this.binders[c];d instanceof rl&&d.setConstantPatternPositions(r,s)}}updatePaintArrays(r,s,c,d,g,y){let x=!1;for(const E in r){const D=s.getPositions(E);for(const M of D){const A=c.feature(M.index);for(const k in this.binders){const F=this.binders[k];if((F instanceof Pl||F instanceof ko||F instanceof ba)&&!0===F.expression.isStateDependent){const U=d.paint.get(k);F.expression=U.value,F.updatePaintArray(M.start,M.end,A,r[E],g,y),x=!0}}}}return x}defines(){const r=[];for(const s in this.binders){const c=this.binders[s];(c instanceof uc||c instanceof rl)&&r.push(...c.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return r}getBinderAttributes(){const r=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof Pl||c instanceof ko||c instanceof ba)for(let d=0;d<c.paintVertexAttributes.length;d++)r.push(c.paintVertexAttributes[d].name)}return r}getBinderUniforms(){const r=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof uc||c instanceof rl||c instanceof ko)for(const d of c.uniformNames)r.push(d)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,s){const c=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof uc||g instanceof rl||g instanceof ko)for(const y of g.uniformNames)if(s[y]){const x=g.getBinding(r,s[y],y);c.push({name:y,property:d,binding:x})}}return c}setUniforms(r,s,c,d){for(const{name:g,property:y,binding:x}of s)this.binders[y].setUniform(x,d,c.get(y),g)}updatePaintBuffers(r){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(r&&c instanceof ba){const d=2===r.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(c instanceof Pl||c instanceof ko)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(r){for(const s in this.binders){const c=this.binders[s];(c instanceof Pl||c instanceof ko||c instanceof ba)&&c.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const s=this.binders[r];(s instanceof Pl||s instanceof ko||s instanceof ba)&&s.destroy()}}}class hc{constructor(r,s,c=(()=>!0)){this.programConfigurations={};for(const d of r)this.programConfigurations[d.id]=new Qs(d,s,c);this.needsUpload=!1,this._featureMap=new hh,this._bufferOffset=0}populatePaintArrays(r,s,c,d,g,y,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,s,d,g,y,x);void 0!==s.id&&this._featureMap.add(s.id,c,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,s,c,d,g){for(const y of c)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,s,y,d,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const ly={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function cy(o,r){return ly[o]||[o.replace(`${r}-`,"").replace(/-/g,"_")]}const Fm={"line-pattern":{source:Ae,composite:Ae},"fill-pattern":{source:Ae,composite:Ae},"fill-extrusion-pattern":{source:Ae,composite:Ae},"line-dasharray":{source:ze,composite:ze}},uy={color:{source:Vt,composite:Qr},number:{source:At,composite:Vt}};function uu(o,r,s){const c=Fm[o];return c&&c[s]||uy[r][s]}Rt(uc),Rt(rl),Rt(Pl),Rt(ba),Rt(ko),Rt(Qs,{omit:["_buffers"]}),Rt(hc);const ph="-transition";class ea extends Xt{constructor(r,s){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),s.layout&&(this._unevaluatedLayout=new _(s.layout)),s.paint)){this._transitionablePaint=new p(s.paint);for(const c in r.paint)this.setPaintProperty(c,r.paint[c],{validate:!1});for(const c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new w(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,s,c={}){null!=s&&this._validate(xi,`layers.${this.id}.layout.${r}`,r,s,c)||("visibility"!==r?this._unevaluatedLayout.setValue(r,s):this.visibility=s)}getPaintProperty(r){return We(r,ph)?this._transitionablePaint.getTransition(r.slice(0,-ph.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,s,c={}){if(null!=s&&this._validate(Uf,`layers.${this.id}.paint.${r}`,r,s,c))return!1;if(We(r,ph))return this._transitionablePaint.setTransition(r.slice(0,-ph.length),s||void 0),!1;{const d=this._transitionablePaint._values[r],g="cross-faded-data-driven"===d.property.specification["property-type"],y=d.value.isDataDriven(),x=d.value;this._transitionablePaint.setValue(r,s),this._handleSpecialPaintPropertyUpdate(r);const E=this._transitionablePaint._values[r].value;return E.isDataDriven()||y||g||this._handleOverridablePaintPropertyUpdate(r,x,E)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,s,c){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,s){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,s)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Cn(r,(s,c)=>!(void 0===s||"layout"===c&&!Object.keys(s).length||"paint"===c&&!Object.keys(s).length))}_validate(r,s,c,d,g={}){return(!g||!1!==g.validate)&&Dl(this,r.call(Qn,{key:s,layerType:this.type,objectKey:c,value:d,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const s=this.paint.get(r);if(s instanceof b&&tc(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Sr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const on=re([{name:"a_pos",components:2,type:"Int16"}],4),zm=re([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class ri{constructor(r=[]){this.segments=r}prepareSegment(r,s,c,d){let g=this.segments[this.segments.length-1];return r>ri.MAX_VERTEX_ARRAY_LENGTH&&un(`Max vertices per segment is ${ri.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>ri.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==d&&(g.sortKey=d),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const r of this.segments)for(const s in r.vaos)r.vaos[s].destroy()}static simpleSegment(r,s,c,d){return new ri([{vertexOffset:r,primitiveOffset:s,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}ri.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rt(ri);var En=8192;class Ls{constructor(r,s){r&&(s?this.setSouthWest(r).setNorthEast(s):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof vr?new vr(r.lng,r.lat):vr.convert(r),this}setSouthWest(r){return this._sw=r instanceof vr?new vr(r.lng,r.lat):vr.convert(r),this}extend(r){const s=this._sw,c=this._ne;let d,g;if(r instanceof vr)d=r,g=r;else{if(!(r instanceof Ls))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(Ls.convert(r)):this.extend(vr.convert(r)):this;if(d=r._sw,g=r._ne,!d||!g)return this}return s||c?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new vr(d.lng,d.lat),this._ne=new vr(g.lng,g.lat)),this}getCenter(){return new vr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vr(this.getWest(),this.getNorth())}getSouthEast(){return new vr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:s,lat:c}=vr.convert(r);let d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(r){return!r||r instanceof Ls?r:new Ls(r)}}const Vf=6371008.8;class vr{constructor(r,s){if(isNaN(r)||isNaN(s))throw new Error(`Invalid LngLat object: (${r}, ${s})`);if(this.lng=+r,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new vr(ct(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const s=Math.PI/180,c=this.lat*s,d=r.lat*s,g=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((r.lng-this.lng)*s);return Vf*Math.acos(Math.min(g,1))}toBounds(r=0){const s=360*r/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Ls(new vr(this.lng-c,this.lat-s),new vr(this.lng+c,this.lat+s))}static convert(r){if(r instanceof vr)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new vr(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new vr(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Nm=2*Math.PI*Vf;function hu(o){return Nm*Math.cos(o*Math.PI/180)}function Fs(o){return(180+o)/360}function dc(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function wa(o,r){return o/hu(r)}function zs(o){return 360*o-180}function Ui(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Id(o,r){return o*hu(Ui(r))}const ls=85.051129;class mh{constructor(r,s,c=0){this.x=+r,this.y=+s,this.z=+c}static fromLngLat(r,s=0){const c=vr.convert(r);return new mh(Fs(c.lng),dc(c.lat),wa(s,c.lat))}toLngLat(){return new vr(zs(this.x),Ui(this.y))}toAltitude(){return Id(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Nm*(r=Ui(this.y),1/Math.cos(r*Math.PI/180));var r}}function $f(o,r,s,c,d,g,y,x,E){const D=(r+c)/2,M=(s+d)/2,A=new se(D,M);x(A),function(k,F,U,G,Z,Q){const ue=U-Z,ye=G-Q;return Math.abs((G-F)*ue-(U-k)*ye)/Math.hypot(ue,ye)}(A.x,A.y,g.x,g.y,y.x,y.y)>=E?($f(o,r,s,D,M,g,A,x,E),$f(o,D,M,c,d,A,y,x,E)):o.push(y)}function hy(o,r,s){let c=o[0],d=c.x,g=c.y;r(c);const y=[c];for(let x=1;x<o.length;x++){const E=o[x],{x:D,y:M}=E;r(E),$f(y,d,g,D,M,c,E,r,s),d=D,g=M,c=E}return y}const kl=Math.pow(2,14)-1,du=-kl-1;function dy(o,r){const s=Math.round(o.x*r),c=Math.round(o.y*r);return o.x=De(s,du,kl),o.y=De(c,du,kl),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&un("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Rl(o,r,s){const c=o.loadGeometry(),d=o.extent,g=En/d;if(r&&s&&s.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:x,x:E,y:D,projection:M}=s,A=k=>{const F=zs((r.x+k.x/d)/y),U=Ui((r.y+k.y/d)/y),G=M.project(F,U);k.x=(G.x*x-E)*d,k.y=(G.y*x-D)*d};for(let k=0;k<c.length;k++)if(1!==o.type)c[k]=hy(c[k],A,1);else{const F=[];for(const U of c[k])U.x<0||U.x>=d||U.y<0||U.y>=d||(A(U),F.push(U));c[k]=F}}for(const y of c)for(const x of y)dy(x,g);return c}function Ol(o,r){return{type:o.type,id:o.id,properties:o.properties,geometry:r?Rl(o):[]}}function Md(o,r,s,c,d){o.emplaceBack(2*r+(c+1)/2,2*s+(d+1)/2)}function Gf(o,r,s,c){o.emplaceBack(r.x,r.y,r.z,16384*s[0],16384*s[1],16384*s[2],c)}class Hf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new te,this.indexArray=new Ne,this.segments=new ri,this.programConfigurations=new hc(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,c,d){const g=this.layers[0],y=[];let x=null;"circle"===g.type&&(x=g.layout.get("circle-sort-key"));for(const{feature:D,id:M,index:A,sourceLayerIndex:k}of r){const F=this.layers[0]._featureFilter.needGeometry,U=Ol(D,F);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),U,c))continue;const G=x?x.evaluate(U,{},c):void 0,Z={id:M,properties:D.properties,type:D.type,sourceLayerIndex:k,index:A,geometry:F?U.geometry:Rl(D,c,d),patterns:{},sortKey:G};y.push(Z)}x&&y.sort((D,M)=>D.sortKey-M.sortKey);let E=null;"globe"===d.projection.name&&(this.globeExtVertexArray=new Os,E=d.projection);for(const D of y){const{geometry:M,index:A,sourceLayerIndex:k}=D,F=r[A].feature;this.addFeature(D,M,A,s.availableImages,c,E),s.featureIndex.insert(F,M,A,k,this.index)}}update(r,s,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,on.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,zm.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,s,c,d,g,y){for(const x of s)for(const E of x){const D=E.x,M=E.y;if(D<0||D>=En||M<0||M>=En)continue;if(y){const F=y.projectTilePoint(D,M,g),U=y.upVector(g,D,M),G=Ui((M/En+g.y)/(1<<g.z)),Z=y.pixelsPerMeter(G,1)/wa(1,G),Q=this.globeExtVertexArray;Gf(Q,F,U,Z),Gf(Q,F,U,Z),Gf(Q,F,U,Z),Gf(Q,F,U,Z)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),k=A.vertexLength;Md(this.layoutVertexArray,D,M,-1,-1),Md(this.layoutVertexArray,D,M,1,-1),Md(this.layoutVertexArray,D,M,1,1),Md(this.layoutVertexArray,D,M,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,{},d,g)}}function Bm(o,r){for(let s=0;s<o.length;s++)if(Fl(r,o[s]))return!0;for(let s=0;s<r.length;s++)if(Fl(o,r[s]))return!0;return!!Ll(o,r)}function fy(o,r,s){return!!Fl(o,r)||!!Zf(r,o,s)}function gh(o,r){if(1===o.length)return _h(r,o[0]);for(let s=0;s<r.length;s++){const c=r[s];for(let d=0;d<c.length;d++)if(Fl(o,c[d]))return!0}for(let s=0;s<o.length;s++)if(_h(r,o[s]))return!0;for(let s=0;s<r.length;s++)if(Ll(o,r[s]))return!0;return!1}function qf(o,r,s){if(o.length>1){if(Ll(o,r))return!0;for(let c=0;c<r.length;c++)if(Zf(r[c],o,s))return!0}for(let c=0;c<o.length;c++)if(Zf(o[c],r,s))return!0;return!1}function Ll(o,r){if(0===o.length||0===r.length)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],d=o[s+1];for(let g=0;g<r.length-1;g++)if(py(c,d,r[g],r[g+1]))return!0}return!1}function py(o,r,s,c){return Vn(o,s,c)!==Vn(r,s,c)&&Vn(o,r,s)!==Vn(o,r,c)}function Zf(o,r,s){const c=s*s;if(1===r.length)return o.distSqr(r[0])<c;for(let d=1;d<r.length;d++)if(my(o,r[d-1],r[d])<c)return!0;return!1}function my(o,r,s){const c=r.distSqr(s);if(0===c)return o.distSqr(r);const d=((o.x-r.x)*(s.x-r.x)+(o.y-r.y)*(s.y-r.y))/c;return o.distSqr(d<0?r:d>1?s:s.sub(r)._mult(d)._add(r))}function _h(o,r){let s,c,d,g=!1;for(let y=0;y<o.length;y++){s=o[y];for(let x=0,E=s.length-1;x<s.length;E=x++)c=s[x],d=s[E],c.y>r.y!=d.y>r.y&&r.x<(d.x-c.x)*(r.y-c.y)/(d.y-c.y)+c.x&&(g=!g)}return g}function Fl(o,r){let s=!1;for(let c=0,d=o.length-1;c<o.length;d=c++){const g=o[c],y=o[d];g.y>r.y!=y.y>r.y&&r.x<(y.x-g.x)*(r.y-g.y)/(y.y-g.y)+g.x&&(s=!s)}return s}function Wf(o,r,s,c,d){for(const y of o)if(r<=y.x&&s<=y.y&&c>=y.x&&d>=y.y)return!0;const g=[new se(r,s),new se(r,d),new se(c,d),new se(c,s)];if(o.length>2)for(const y of g)if(Fl(o,y))return!0;for(let y=0;y<o.length-1;y++)if(Um(o[y],o[y+1],g))return!0;return!1}function Um(o,r,s){const c=s[0],d=s[2];if(o.x<c.x&&r.x<c.x||o.x>d.x&&r.x>d.x||o.y<c.y&&r.y<c.y||o.y>d.y&&r.y>d.y)return!1;const g=Vn(o,r,s[0]);return g!==Vn(o,r,s[1])||g!==Vn(o,r,s[2])||g!==Vn(o,r,s[3])}function fc(o,r,s){const c=r.paint.get(o).value;return"constant"===c.kind?c.value:s.programConfigurations.get(r.id).getMaxValue(o)}function yh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function jm(o,r,s,c,d){if(!r[0]&&!r[1])return o;const g=se.convert(r)._mult(d);"viewport"===s&&g._rotate(-c);const y=[];for(let x=0;x<o.length;x++)y.push(o[x].sub(g));return y}function Vm(o,r,s,c){const d=se.convert(o)._mult(c);return"viewport"===r&&d._rotate(-s),d}Rt(Hf,{omit:["layers"]});const gy=new B({"circle-sort-key":new S(ke.layout_circle["circle-sort-key"])});var _y={paint:new B({"circle-radius":new S(ke.paint_circle["circle-radius"]),"circle-color":new S(ke.paint_circle["circle-color"]),"circle-blur":new S(ke.paint_circle["circle-blur"]),"circle-opacity":new S(ke.paint_circle["circle-opacity"]),"circle-translate":new C(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new C(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new C(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new C(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new S(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new S(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new S(ke.paint_circle["circle-stroke-opacity"])}),layout:gy},Xf=1e-6,bi="undefined"!=typeof Float32Array?Float32Array:Array;function fu(){var o=new bi(9);return bi!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Ea(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function $m(o,r,s){var c=r[0],d=r[1],g=r[2],y=r[3],x=r[4],E=r[5],D=r[6],M=r[7],A=r[8],k=r[9],F=r[10],U=r[11],G=r[12],Z=r[13],Q=r[14],ue=r[15],ye=s[0],be=s[1],Ee=s[2],Te=s[3];return o[0]=ye*c+be*x+Ee*A+Te*G,o[1]=ye*d+be*E+Ee*k+Te*Z,o[2]=ye*g+be*D+Ee*F+Te*Q,o[3]=ye*y+be*M+Ee*U+Te*ue,o[4]=(ye=s[4])*c+(be=s[5])*x+(Ee=s[6])*A+(Te=s[7])*G,o[5]=ye*d+be*E+Ee*k+Te*Z,o[6]=ye*g+be*D+Ee*F+Te*Q,o[7]=ye*y+be*M+Ee*U+Te*ue,o[8]=(ye=s[8])*c+(be=s[9])*x+(Ee=s[10])*A+(Te=s[11])*G,o[9]=ye*d+be*E+Ee*k+Te*Z,o[10]=ye*g+be*D+Ee*F+Te*Q,o[11]=ye*y+be*M+Ee*U+Te*ue,o[12]=(ye=s[12])*c+(be=s[13])*x+(Ee=s[14])*A+(Te=s[15])*G,o[13]=ye*d+be*E+Ee*k+Te*Z,o[14]=ye*g+be*D+Ee*F+Te*Q,o[15]=ye*y+be*M+Ee*U+Te*ue,o}function pu(o,r,s){var c,d,g,y,x,E,D,M,A,k,F,U,G=s[0],Z=s[1],Q=s[2];return r===o?(o[12]=r[0]*G+r[4]*Z+r[8]*Q+r[12],o[13]=r[1]*G+r[5]*Z+r[9]*Q+r[13],o[14]=r[2]*G+r[6]*Z+r[10]*Q+r[14],o[15]=r[3]*G+r[7]*Z+r[11]*Q+r[15]):(d=r[1],g=r[2],y=r[3],x=r[4],E=r[5],D=r[6],M=r[7],A=r[8],k=r[9],F=r[10],U=r[11],o[0]=c=r[0],o[1]=d,o[2]=g,o[3]=y,o[4]=x,o[5]=E,o[6]=D,o[7]=M,o[8]=A,o[9]=k,o[10]=F,o[11]=U,o[12]=c*G+x*Z+A*Q+r[12],o[13]=d*G+E*Z+k*Q+r[13],o[14]=g*G+D*Z+F*Q+r[14],o[15]=y*G+M*Z+U*Q+r[15]),o}function pc(o,r,s){var c=s[0],d=s[1],g=s[2];return o[0]=r[0]*c,o[1]=r[1]*c,o[2]=r[2]*c,o[3]=r[3]*c,o[4]=r[4]*d,o[5]=r[5]*d,o[6]=r[6]*d,o[7]=r[7]*d,o[8]=r[8]*g,o[9]=r[9]*g,o[10]=r[10]*g,o[11]=r[11]*g,o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o}function Gm(o,r,s){var c=Math.sin(s),d=Math.cos(s),g=r[4],y=r[5],x=r[6],E=r[7],D=r[8],M=r[9],A=r[10],k=r[11];return r!==o&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[4]=g*d+D*c,o[5]=y*d+M*c,o[6]=x*d+A*c,o[7]=E*d+k*c,o[8]=D*d-g*c,o[9]=M*d-y*c,o[10]=A*d-x*c,o[11]=k*d-E*c,o}function Hm(o,r,s){var c=Math.sin(s),d=Math.cos(s),g=r[0],y=r[1],x=r[2],E=r[3],D=r[8],M=r[9],A=r[10],k=r[11];return r!==o&&(o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=g*d-D*c,o[1]=y*d-M*c,o[2]=x*d-A*c,o[3]=E*d-k*c,o[8]=g*c+D*d,o[9]=y*c+M*d,o[10]=x*c+A*d,o[11]=E*c+k*d,o}Math.hypot||(Math.hypot=function(){for(var o=0,r=arguments.length;r--;)o+=arguments[r]*arguments[r];return Math.sqrt(o)});var qm=$m;function Kf(){var o=new bi(3);return bi!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Zm(o){var r=new bi(3);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r}function Wm(o){return Math.hypot(o[0],o[1],o[2])}function vh(o,r,s){var c=new bi(3);return c[0]=o,c[1]=r,c[2]=s,c}function yy(o,r,s){return o[0]=r[0]+s[0],o[1]=r[1]+s[1],o[2]=r[2]+s[2],o}function Xm(o,r,s){return o[0]=r[0]-s[0],o[1]=r[1]-s[1],o[2]=r[2]-s[2],o}function xh(o,r,s){return o[0]=r[0]*s[0],o[1]=r[1]*s[1],o[2]=r[2]*s[2],o}function Ad(o,r,s){return o[0]=Math.min(r[0],s[0]),o[1]=Math.min(r[1],s[1]),o[2]=Math.min(r[2],s[2]),o}function Ns(o,r,s){return o[0]=Math.max(r[0],s[0]),o[1]=Math.max(r[1],s[1]),o[2]=Math.max(r[2],s[2]),o}function il(o,r,s){return o[0]=r[0]*s,o[1]=r[1]*s,o[2]=r[2]*s,o}function Pd(o,r,s,c){return o[0]=r[0]+s[0]*c,o[1]=r[1]+s[1]*c,o[2]=r[2]+s[2]*c,o}function mu(o,r){var s=r[0],c=r[1],d=r[2],g=s*s+c*c+d*d;return g>0&&(g=1/Math.sqrt(g)),o[0]=r[0]*g,o[1]=r[1]*g,o[2]=r[2]*g,o}function gu(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]}function vy(o,r,s){var c=r[0],d=r[1],g=r[2],y=s[0],x=s[1],E=s[2];return o[0]=d*E-g*x,o[1]=g*y-c*E,o[2]=c*x-d*y,o}function _u(o,r,s){var c=r[0],d=r[1],g=r[2],y=s[3]*c+s[7]*d+s[11]*g+s[15];return o[0]=(s[0]*c+s[4]*d+s[8]*g+s[12])/(y=y||1),o[1]=(s[1]*c+s[5]*d+s[9]*g+s[13])/y,o[2]=(s[2]*c+s[6]*d+s[10]*g+s[14])/y,o}function xy(o,r,s){var c=s[0],d=s[1],g=s[2],y=r[0],x=r[1],E=r[2],D=d*E-g*x,M=g*y-c*E,A=c*x-d*y,k=d*A-g*M,F=g*D-c*A,U=c*M-d*D,G=2*s[3];return M*=G,A*=G,F*=2,U*=2,o[0]=y+(D*=G)+(k*=2),o[1]=x+M+F,o[2]=E+A+U,o}var mc,zl=Xm,Yf=xh,C0=Wm;function bh(o,r,s){var c=r[0],d=r[1],g=r[2],y=r[3];return o[0]=s[0]*c+s[4]*d+s[8]*g+s[12]*y,o[1]=s[1]*c+s[5]*d+s[9]*g+s[13]*y,o[2]=s[2]*c+s[6]*d+s[10]*g+s[14]*y,o[3]=s[3]*c+s[7]*d+s[11]*g+s[15]*y,o}function Jf(){var o=new bi(4);return bi!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Km(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Ym(o,r,s){s*=.5;var c=r[0],d=r[1],g=r[2],y=r[3],x=Math.sin(s),E=Math.cos(s);return o[0]=c*E+y*x,o[1]=d*E+g*x,o[2]=g*E-d*x,o[3]=y*E-c*x,o}Kf(),mc=new bi(4),bi!=Float32Array&&(mc[0]=0,mc[1]=0,mc[2]=0,mc[3]=0),Kf(),vh(1,0,0),vh(0,1,0),Jf(),Jf(),fu();class Qf{constructor(r,s){this.points=r,this.planes=s}static fromInvProjectionMatrix(r,s,c,d){const g=Math.pow(2,c),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const D=bh([],E,r),M=1/D[3]/s*g;return(A=D)[0]=(k=D)[0]*(F=[M,M,d?1/D[3]:M,M])[0],A[1]=k[1]*F[1],A[2]=k[2]*F[2],A[3]=k[3]*F[3],A;var A,k,F}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const D=mu([],vy([],zl([],y[E[0]],y[E[1]]),zl([],y[E[2]],y[E[1]]))),M=-gu(D,y[E[1]]);return D.concat(M)});return new Qf(y,x)}}class cs{constructor(r,s){this.min=r,this.max=s,this.center=il([],yy([],this.min,this.max),.5)}quadrant(r){const s=[r%2==0,r<2],c=Zm(this.min),d=Zm(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],d[g]=s[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new cs(c,d)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,s=this.max;return[[r[0],r[1],r[2]],[s[0],r[1],r[2]],[s[0],s[1],r[2]],[r[0],s[1],r[2]],[r[0],r[1],s[2]],[s[0],r[1],s[2]],[s[0],s[1],s[2]],[r[0],s[1],s[2]]]}intersects(r){const s=this.getCorners();let c=!0;for(let d=0;d<r.planes.length;d++){const g=r.planes[d];let y=0;for(let x=0;x<s.length;x++)y+=gu(g,s[x])+g[3]>=0;if(0===y)return 0;y!==s.length&&(c=!1)}if(c)return 2;for(let d=0;d<3;d++){let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const E=r.points[x][d]-this.min[d];g=Math.min(g,E),y=Math.max(y,E)}if(y<0||g>this.max[d]-this.min[d])return 0}return 1}}function ep(o,r,s,c,d,g,y,x,E){if(g&&o.queryGeometry.isAboveHorizon)return!1;g&&(E*=o.pixelToTileUnitsFactor);for(const D of r)for(const M of D){const A=M.add(x),k=d&&s.elevation?s.elevation.exaggeration()*d.getElevationAt(A.x,A.y,!0):0,F=g?A:kd(A,k,c),U=g?o.tilespaceRays.map(Z=>by(Z,k)):o.queryGeometry.screenGeometry,G=bh([],[M.x,M.y,k,1],c);if(!y&&g?E*=G[3]/s.cameraToCenterDistance:y&&!g&&(E*=s.cameraToCenterDistance/G[3]),fy(U,F,E))return!0}return!1}function kd(o,r,s){const c=bh([],[o.x,o.y,r,1],s);return new se(c[0]/c[3],c[1]/c[3])}const Jm=vh(0,0,0),tp=vh(0,0,1);function by(o,r){const s=Kf();return Jm[2]=r,o.intersectsPlane(Jm,tp,s),new se(s[0],s[1])}class wi extends Hf{}function Qm(o,{width:r,height:s},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==r*s*c)throw new RangeError("mismatched image size")}else d=new Uint8Array(r*s*c);return o.width=r,o.height=s,o.data=d,o}function eg(o,r,s){const{width:c,height:d}=r;c===o.width&&d===o.height||(wh(o,r,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,d)},s),o.width=c,o.height=d,o.data=r.data)}function wh(o,r,s,c,d,g){if(0===d.width||0===d.height)return r;if(d.width>o.width||d.height>o.height||s.x>o.width-d.width||s.y>o.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>r.width||d.height>r.height||c.x>r.width-d.width||c.y>r.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=o.data,x=r.data;for(let E=0;E<d.height;E++){const D=((s.y+E)*o.width+s.x)*g,M=((c.y+E)*r.width+c.x)*g;for(let A=0;A<d.width*g;A++)x[M+A]=y[D+A]}return r}Rt(wi,{omit:["layers"]});class Ta{constructor(r,s){Qm(this,r,1,s)}resize(r){eg(this,new Ta(r),1)}clone(){return new Ta({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,c,d,g){wh(r,s,c,d,g,1)}}class Xo{constructor(r,s){Qm(this,r,4,s)}resize(r){eg(this,new Xo(r),4)}replace(r,s){s?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Xo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,s,c,d,g){wh(r,s,c,d,g,4)}}Rt(Ta),Rt(Xo);var wy={paint:new B({"heatmap-radius":new S(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new S(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new C(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new L(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new C(ke.paint_heatmap["heatmap-opacity"])})};function np(o){const r={},s=o.resolution||256,c=o.clips?o.clips.length:1,d=o.image||new Xo({width:s,height:c}),g=(y,x,E)=>{r[o.evaluationKey]=E;const D=o.expression.evaluate(r);d.data[y+x+0]=Math.floor(255*D.r/D.a),d.data[y+x+1]=Math.floor(255*D.g/D.a),d.data[y+x+2]=Math.floor(255*D.b/D.a),d.data[y+x+3]=Math.floor(255*D.a)};if(o.clips)for(let y=0,x=0;y<c;++y,x+=4*s)for(let E=0,D=0;E<s;E++,D+=4){const M=E/(s-1),{start:A,end:k}=o.clips[y];g(x,D,A*(1-M)+k*M)}else for(let y=0,x=0;y<s;y++,x+=4)g(0,x,y/(s-1));return d}var Ey={paint:new B({"hillshade-illumination-direction":new C(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new C(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new C(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new C(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new C(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new C(ke.paint_hillshade["hillshade-accent-color"])})};const Ty=re([{name:"a_pos",components:2,type:"Int16"}],4),{members:D0}=Ty;var rp=Wi,Eh=Wi;function Wi(o,r,s){s=s||2;var c,d,g,y,x,E,D,M=r&&r.length,A=M?r[0]*s:o.length,k=Rd(o,0,A,s,!0),F=[];if(!k||k.next===k.prev)return F;if(M&&(k=function(G,Z,Q,ue){var ye,be,Ee,Te=[];for(ye=0,be=Z.length;ye<be;ye++)(Ee=Rd(G,Z[ye]*ue,ye<be-1?Z[ye+1]*ue:G.length,ue,!1))===Ee.next&&(Ee.steiner=!0),Te.push(Iy(Ee));for(Te.sort(Dy),ye=0;ye<Te.length;ye++)Q=ol(Q=tg(Te[ye],Q),Q.next);return Q}(o,r,k,s)),o.length>80*s){c=g=o[0],d=y=o[1];for(var U=s;U<A;U+=s)(x=o[U])<c&&(c=x),(E=o[U+1])<d&&(d=E),x>g&&(g=x),E>y&&(y=E);D=0!==(D=Math.max(g-c,y-d))?1/D:0}return yu(k,F,s,c,d,D),F}function Rd(o,r,s,c,d){var g,y;if(d===sp(o,r,s,c)>0)for(g=r;g<s;g+=c)y=bu(g,o[g],o[g+1],y);else for(g=s-c;g>=r;g-=c)y=bu(g,o[g],o[g+1],y);return y&&vu(y,y.next)&&(Dh(y),y=y.next),y}function ol(o,r){if(!o)return o;r||(r=o);var s,c=o;do{if(s=!1,c.steiner||!vu(c,c.next)&&0!==ci(c.prev,c,c.next))c=c.next;else{if(Dh(c),(c=r=c.prev)===c.next)break;s=!0}}while(s||c!==r);return r}function yu(o,r,s,c,d,g,y){if(o){!y&&g&&function(M,A,k,F){var U=M;do{null===U.z&&(U.z=Od(U.x,U.y,A,k,F)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next}while(U!==M);U.prevZ.nextZ=null,U.prevZ=null,function(G){var Z,Q,ue,ye,be,Ee,Te,Be,Ve=1;do{for(Q=G,G=null,be=null,Ee=0;Q;){for(Ee++,ue=Q,Te=0,Z=0;Z<Ve&&(Te++,ue=ue.nextZ);Z++);for(Be=Ve;Te>0||Be>0&&ue;)0!==Te&&(0===Be||!ue||Q.z<=ue.z)?(ye=Q,Q=Q.nextZ,Te--):(ye=ue,ue=ue.nextZ,Be--),be?be.nextZ=ye:G=ye,ye.prevZ=be,be=ye;Q=ue}be.nextZ=null,Ve*=2}while(Ee>1)}(U)}(o,c,d,g);for(var x,E,D=o;o.prev!==o.next;)if(x=o.prev,E=o.next,g?Th(o,c,d,g):xo(o))r.push(x.i/s),r.push(o.i/s),r.push(E.i/s),Dh(o),o=E.next,D=E.next;else if((o=E)===D){y?1===y?yu(o=ip(ol(o),r,s),r,s,c,d,g,2):2===y&&Cy(o,r,s,c,d,g):yu(ol(o),r,s,c,d,g,1);break}}}function xo(o){var r=o.prev,s=o,c=o.next;if(ci(r,s,c)>=0)return!1;for(var d=o.next.next;d!==o.prev;){if(gc(r.x,r.y,s.x,s.y,c.x,c.y,d.x,d.y)&&ci(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function Th(o,r,s,c){var d=o.prev,g=o,y=o.next;if(ci(d,g,y)>=0)return!1;for(var x=d.x>g.x?d.x>y.x?d.x:y.x:g.x>y.x?g.x:y.x,E=d.y>g.y?d.y>y.y?d.y:y.y:g.y>y.y?g.y:y.y,D=Od(d.x<g.x?d.x<y.x?d.x:y.x:g.x<y.x?g.x:y.x,d.y<g.y?d.y<y.y?d.y:y.y:g.y<y.y?g.y:y.y,r,s,c),M=Od(x,E,r,s,c),A=o.prevZ,k=o.nextZ;A&&A.z>=D&&k&&k.z<=M;){if(A!==o.prev&&A!==o.next&&gc(d.x,d.y,g.x,g.y,y.x,y.y,A.x,A.y)&&ci(A.prev,A,A.next)>=0||(A=A.prevZ,k!==o.prev&&k!==o.next&&gc(d.x,d.y,g.x,g.y,y.x,y.y,k.x,k.y)&&ci(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;A&&A.z>=D;){if(A!==o.prev&&A!==o.next&&gc(d.x,d.y,g.x,g.y,y.x,y.y,A.x,A.y)&&ci(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;k&&k.z<=M;){if(k!==o.prev&&k!==o.next&&gc(d.x,d.y,g.x,g.y,y.x,y.y,k.x,k.y)&&ci(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function ip(o,r,s){var c=o;do{var d=c.prev,g=c.next.next;!vu(d,g)&&ng(d,c,c.next,g)&&Ch(d,g)&&Ch(g,d)&&(r.push(d.i/s),r.push(c.i/s),r.push(g.i/s),Dh(c),Dh(c.next),c=o=g),c=c.next}while(c!==o);return ol(c)}function Cy(o,r,s,c,d,g){var y=o;do{for(var x=y.next.next;x!==y.prev;){if(y.i!==x.i&&My(y,x)){var E=rg(y,x);return y=ol(y,y.next),E=ol(E,E.next),yu(y,r,s,c,d,g),void yu(E,r,s,c,d,g)}x=x.next}y=y.next}while(y!==o)}function Dy(o,r){return o.x-r.x}function tg(o,r){var s=function(g,y){var x,E=y,D=g.x,M=g.y,A=-1/0;do{if(M<=E.y&&M>=E.next.y&&E.next.y!==E.y){var k=E.x+(M-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(k<=D&&k>A){if(A=k,k===D){if(M===E.y)return E;if(M===E.next.y)return E.next}x=E.x<E.next.x?E:E.next}}E=E.next}while(E!==y);if(!x)return null;if(D===A)return x;var F,U=x,G=x.x,Z=x.y,Q=1/0;E=x;do{D>=E.x&&E.x>=G&&D!==E.x&&gc(M<Z?D:A,M,G,Z,M<Z?A:D,M,E.x,E.y)&&(F=Math.abs(M-E.y)/(D-E.x),Ch(E,g)&&(F<Q||F===Q&&(E.x>x.x||E.x===x.x&&Sy(x,E)))&&(x=E,Q=F)),E=E.next}while(E!==U);return x}(o,r);if(!s)return r;var c=rg(s,o),d=ol(s,s.next);return ol(c,c.next),r===s?d:r}function Sy(o,r){return ci(o.prev,o,r.prev)<0&&ci(r.next,o,o.next)<0}function Od(o,r,s,c,d){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-s)*d)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-c)*d)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Iy(o){var r=o,s=o;do{(r.x<s.x||r.x===s.x&&r.y<s.y)&&(s=r),r=r.next}while(r!==o);return s}function gc(o,r,s,c,d,g,y,x){return(d-y)*(r-x)-(o-y)*(g-x)>=0&&(o-y)*(c-x)-(s-y)*(r-x)>=0&&(s-y)*(g-x)-(d-y)*(c-x)>=0}function My(o,r){return o.next.i!==r.i&&o.prev.i!==r.i&&!function(s,c){var d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==c.i&&d.next.i!==c.i&&ng(d,d.next,s,c))return!0;d=d.next}while(d!==s);return!1}(o,r)&&(Ch(o,r)&&Ch(r,o)&&function(s,c){var d=s,g=!1,y=(s.x+c.x)/2,x=(s.y+c.y)/2;do{d.y>x!=d.next.y>x&&d.next.y!==d.y&&y<(d.next.x-d.x)*(x-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next}while(d!==s);return g}(o,r)&&(ci(o.prev,o,r.prev)||ci(o,r.prev,r))||vu(o,r)&&ci(o.prev,o,o.next)>0&&ci(r.prev,r,r.next)>0)}function ci(o,r,s){return(r.y-o.y)*(s.x-r.x)-(r.x-o.x)*(s.y-r.y)}function vu(o,r){return o.x===r.x&&o.y===r.y}function ng(o,r,s,c){var d=xu(ci(o,r,s)),g=xu(ci(o,r,c)),y=xu(ci(s,c,o)),x=xu(ci(s,c,r));return d!==g&&y!==x||!(0!==d||!Ld(o,s,r))||!(0!==g||!Ld(o,c,r))||!(0!==y||!Ld(s,o,c))||!(0!==x||!Ld(s,r,c))}function Ld(o,r,s){return r.x<=Math.max(o.x,s.x)&&r.x>=Math.min(o.x,s.x)&&r.y<=Math.max(o.y,s.y)&&r.y>=Math.min(o.y,s.y)}function xu(o){return o>0?1:o<0?-1:0}function Ch(o,r){return ci(o.prev,o,o.next)<0?ci(o,r,o.next)>=0&&ci(o,o.prev,r)>=0:ci(o,r,o.prev)<0||ci(o,o.next,r)<0}function rg(o,r){var s=new op(o.i,o.x,o.y),c=new op(r.i,r.x,r.y),d=o.next,g=r.prev;return o.next=r,r.prev=o,s.next=d,d.prev=s,c.next=s,s.prev=c,g.next=c,c.prev=g,c}function bu(o,r,s,c){var d=new op(o,r,s);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function Dh(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function op(o,r,s){this.i=o,this.x=r,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sp(o,r,s,c){for(var d=0,g=r,y=s-c;g<s;g+=c)d+=(o[y]-o[g])*(o[g+1]+o[y+1]),y=g;return d}function Ay(o,r,s,c,d){ig(o,r,s||0,c||o.length-1,d||Py)}function ig(o,r,s,c,d){for(;c>s;){if(c-s>600){var g=c-s+1,y=r-s+1,x=Math.log(g),E=.5*Math.exp(2*x/3),D=.5*Math.sqrt(x*E*(g-E)/g)*(y-g/2<0?-1:1);ig(o,r,Math.max(s,Math.floor(r-y*E/g+D)),Math.min(c,Math.floor(r+(g-y)*E/g+D)),d)}var M=o[r],A=s,k=c;for(wu(o,s,r),d(o[c],M)>0&&wu(o,s,c);A<k;){for(wu(o,A,k),A++,k--;d(o[A],M)<0;)A++;for(;d(o[k],M)>0;)k--}0===d(o[s],M)?wu(o,s,k):wu(o,++k,c),k<=r&&(s=k+1),r<=k&&(c=k-1)}}function wu(o,r,s){var c=o[r];o[r]=o[s],o[s]=c}function Py(o,r){return o<r?-1:o>r?1:0}function ap(o,r){const s=o.length;if(s<=1)return[o];const c=[];let d,g;for(let y=0;y<s;y++){const x=cr(o[y]);0!==x&&(o[y].area=Math.abs(x),void 0===g&&(g=x<0),g===x<0?(d&&c.push(d),d=[o[y]]):d.push(o[y]))}if(d&&c.push(d),r>1)for(let y=0;y<c.length;y++)c[y].length<=r||(Ay(c[y],r,1,c[y].length-1,ky),c[y]=c[y].slice(0,r));return c}function ky(o,r){return r.area-o.area}function lp(o,r,s){const c=s.patternDependencies;let d=!1;for(const g of r){const y=g.paint.get(`${o}-pattern`);y.isConstant()||(d=!0);const x=y.constantOr(null);x&&(d=!0,c[x.to]=!0,c[x.from]=!0)}return d}function cp(o,r,s,c,d){const g=d.patternDependencies;for(const y of r){const x=y.paint.get(`${o}-pattern`).value;if("constant"!==x.kind){let E=x.evaluate({zoom:c-1},s,{},d.availableImages),D=x.evaluate({zoom:c},s,{},d.availableImages),M=x.evaluate({zoom:c+1},s,{},d.availableImages);E=E&&E.name?E.name:E,D=D&&D.name?D.name:D,M=M&&M.name?M.name:M,g[E]=!0,g[D]=!0,g[M]=!0,s.patterns[y.id]={min:E,mid:D,max:M}}}return s}Wi.deviation=function(o,r,s,c){var d=r&&r.length,g=Math.abs(sp(o,0,d?r[0]*s:o.length,s));if(d)for(var y=0,x=r.length;y<x;y++)g-=Math.abs(sp(o,r[y]*s,y<x-1?r[y+1]*s:o.length,s));var E=0;for(y=0;y<c.length;y+=3){var D=c[y]*s,M=c[y+1]*s,A=c[y+2]*s;E+=Math.abs((o[D]-o[A])*(o[M+1]-o[D+1])-(o[D]-o[M])*(o[A+1]-o[D+1]))}return 0===g&&0===E?0:Math.abs((E-g)/g)},Wi.flatten=function(o){for(var r=o[0][0].length,s={vertices:[],holes:[],dimensions:r},c=0,d=0;d<o.length;d++){for(var g=0;g<o[d].length;g++)for(var y=0;y<r;y++)s.vertices.push(o[d][g][y]);d>0&&s.holes.push(c+=o[d-1].length)}return s},rp.default=Eh;class Fd{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new te,this.indexArray=new Ne,this.indexArray2=new qt,this.programConfigurations=new hc(r.layers,r.zoom),this.segments=new ri,this.segments2=new ri,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=r.projection}populate(r,s,c,d){this.hasPattern=lp("fill",this.layers,s);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:x,id:E,index:D,sourceLayerIndex:M}of r){const A=this.layers[0]._featureFilter.needGeometry,k=Ol(x,A);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),k,c))continue;const F=g?g.evaluate(k,{},c,s.availableImages):void 0,U={id:E,properties:x.properties,type:x.type,sourceLayerIndex:M,index:D,geometry:A?k.geometry:Rl(x,c,d),patterns:{},sortKey:F};y.push(U)}g&&y.sort((x,E)=>x.sortKey-E.sortKey);for(const x of y){const{geometry:E,index:D,sourceLayerIndex:M}=x;if(this.hasPattern){const A=cp("fill",this.layers,x,this.zoom,s);this.patternFeatures.push(A)}else this.addFeature(x,E,D,c,{},s.availableImages);s.featureIndex.insert(r[D].feature,E,D,M,this.index)}}update(r,s,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c,d)}addFeatures(r,s,c,d,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,s,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,D0),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,s,c,d,g,y=[]){for(const x of ap(s,500)){let E=0;for(const U of x)E+=U.length;const D=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),M=D.vertexLength,A=[],k=[];for(const U of x){if(0===U.length)continue;U!==x[0]&&k.push(A.length/2);const G=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),Z=G.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(Z+U.length-1,Z),A.push(U[0].x),A.push(U[0].y);for(let Q=1;Q<U.length;Q++)this.layoutVertexArray.emplaceBack(U[Q].x,U[Q].y),this.indexArray2.emplaceBack(Z+Q-1,Z+Q),A.push(U[Q].x),A.push(U[Q].y);G.vertexLength+=U.length,G.primitiveLength+=U.length}const F=rp(A,k);for(let U=0;U<F.length;U+=3)this.indexArray.emplaceBack(M+F[U],M+F[U+1],M+F[U+2]);D.vertexLength+=E,D.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,g,y,d)}}Rt(Fd,{omit:["layers","patternFeatures"]});const Ry=new B({"fill-sort-key":new S(ke.layout_fill["fill-sort-key"])});var Oy={paint:new B({"fill-antialias":new C(ke.paint_fill["fill-antialias"]),"fill-opacity":new S(ke.paint_fill["fill-opacity"]),"fill-color":new S(ke.paint_fill["fill-color"]),"fill-outline-color":new S(ke.paint_fill["fill-outline-color"]),"fill-translate":new C(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new C(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new P(ke.paint_fill["fill-pattern"])}),layout:Ry};const Eu=re([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ca=re([{name:"a_centroid_pos",components:2,type:"Uint16"}]),S0=re([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:I0}=Eu;var up=Sh;function Sh(o,r,s,c,d){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=d,o.readFields(us,this,r)}function us(o,r,s){1==o?r.id=s.readVarint():2==o?function(c,d){for(var g=c.readVarint()+c.pos;c.pos<g;){var y=d._keys[c.readVarint()],x=d._values[c.readVarint()];d.properties[y]=x}}(s,r):3==o?r.type=s.readVarint():4==o&&(r._geometry=s.pos)}function hp(o){for(var r,s,c=0,d=0,g=o.length,y=g-1;d<g;y=d++)c+=((s=o[y]).x-(r=o[d]).x)*(r.y+s.y);return c}Sh.types=["Unknown","Point","LineString","Polygon"],Sh.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var r,s=o.readVarint()+o.pos,c=1,d=0,g=0,y=0,x=[];o.pos<s;){if(d<=0){var E=o.readVarint();c=7&E,d=E>>3}if(d--,1===c||2===c)g+=o.readSVarint(),y+=o.readSVarint(),1===c&&(r&&x.push(r),r=[]),r.push(new se(g,y));else{if(7!==c)throw new Error("unknown command "+c);r&&r.push(r[0].clone())}}return r&&x.push(r),x},Sh.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var r=o.readVarint()+o.pos,s=1,c=0,d=0,g=0,y=1/0,x=-1/0,E=1/0,D=-1/0;o.pos<r;){if(c<=0){var M=o.readVarint();s=7&M,c=M>>3}if(c--,1===s||2===s)(d+=o.readSVarint())<y&&(y=d),d>x&&(x=d),(g+=o.readSVarint())<E&&(E=g),g>D&&(D=g);else if(7!==s)throw new Error("unknown command "+s)}return[y,E,x,D]},Sh.prototype.toGeoJSON=function(o,r,s){var c,d,g=this.extent*Math.pow(2,s),y=this.extent*o,x=this.extent*r,E=this.loadGeometry(),D=Sh.types[this.type];function M(F){for(var U=0;U<F.length;U++){var G=F[U];F[U]=[360*(G.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+x)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(c=0;c<E.length;c++)A[c]=E[c][0];M(E=A);break;case 2:for(c=0;c<E.length;c++)M(E[c]);break;case 3:for(E=function(F){var U=F.length;if(U<=1)return[F];for(var G,Z,Q=[],ue=0;ue<U;ue++){var ye=hp(F[ue]);0!==ye&&(void 0===Z&&(Z=ye<0),Z===ye<0?(G&&Q.push(G),G=[F[ue]]):G.push(F[ue]))}return G&&Q.push(G),Q}(E),c=0;c<E.length;c++)for(d=0;d<E[c].length;d++)M(E[c][d])}1===E.length?E=E[0]:D="Multi"+D;var k={type:"Feature",geometry:{type:D,coordinates:E},properties:this.properties};return"id"in this&&(k.id=this.id),k};var zd=og;function og(o,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(sg,this,r),this.length=this._features.length}function sg(o,r,s){15===o?r.version=s.readVarint():1===o?r.name=s.readString():5===o?r.extent=s.readVarint():2===o?r._features.push(s.pos):3===o?r._keys.push(s.readString()):4===o&&r._values.push(function(c){for(var d=null,g=c.readVarint()+c.pos;c.pos<g;){var y=c.readVarint()>>3;d=1===y?c.readString():2===y?c.readFloat():3===y?c.readDouble():4===y?c.readVarint64():5===y?c.readVarint():6===y?c.readSVarint():7===y?c.readBoolean():null}return d}(s))}function Ih(o,r,s){if(3===o){var c=new zd(s,s.readVarint()+s.pos);c.length&&(r[c.name]=c)}}og.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var r=this._pbf.readVarint()+this._pbf.pos;return new up(this._pbf,r,this.extent,this._keys,this._values)};var Nl={VectorTile:function(o,r){this.layers=o.readFields(Ih,{},r)},VectorTileFeature:up,VectorTileLayer:zd};function Mh(o,r,s,c){const d=[],g=0===c?(y,x,E,D,M,A)=>{y.push(new se(A,E+(A-x)/(D-x)*(M-E)))}:(y,x,E,D,M,A)=>{y.push(new se(x+(A-E)/(M-E)*(D-x),A))};for(const y of o){const x=[];for(const E of y){if(E.length<=2)continue;const D=[];for(let k=0;k<E.length-1;k++){const F=E[k].x,U=E[k].y,G=E[k+1].x,Z=E[k+1].y,Q=0===c?F:U,ue=0===c?G:Z;Q<r?ue>r&&g(D,F,U,G,Z,r):Q>s?ue<s&&g(D,F,U,G,Z,s):D.push(E[k]),ue<r&&Q>=r&&g(D,F,U,G,Z,r),ue>s&&Q<=s&&g(D,F,U,G,Z,s)}let M=E[E.length-1];const A=0===c?M.x:M.y;A>=r&&A<=s&&D.push(M),D.length&&(M=D[D.length-1],D[0].x===M.x&&D[0].y===M.y||D.push(D[0]),x.push(D))}x.length&&d.push(x)}return d}const dp=Nl.VectorTileFeature.types,fp=Math.pow(2,13);function Tu(o,r,s,c,d,g,y,x){o.emplaceBack((r<<1)+y,(s<<1)+g,(Math.floor(c*fp)<<1)+d,Math.round(x))}function Nd(o,r,s){o.emplaceBack(r.x,r.y,r.z,16384*s[0],16384*s[1],16384*s[2])}class _c{constructor(){this.acc=new se(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new se(r.x,r.y),this.max=new se(r.x,r.y))}append(r,s){this.currentPolyCount.edges++,this.acc._add(r);const c=this.min,d=this.max;r.x<c.x?c.x=r.x:r.x>d.x&&(d.x=r.x),r.y<c.y?c.y=r.y:r.y>d.y&&(d.y=r.y),((0===r.x||r.x===En)&&r.x===s.x)!=((0===r.y||r.y===En)&&r.y===s.y)&&this.processBorderOverlap(r,s),s.x<0!=r.x<0&&this.addBorderIntersection(0,bt(s.y,r.y,(0-s.x)/(r.x-s.x))),s.x>En!=r.x>En&&this.addBorderIntersection(1,bt(s.y,r.y,(En-s.x)/(r.x-s.x))),s.y<0!=r.y<0&&this.addBorderIntersection(2,bt(s.x,r.x,(0-s.y)/(r.y-s.y))),s.y>En!=r.y>En&&this.addBorderIntersection(3,bt(s.x,r.x,(En-s.y)/(r.y-s.y)))}addBorderIntersection(r,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[r];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(r,s){if(r.x===s.x){if(r.y===s.y)return;const c=0===r.x?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,r.y)}else{const c=0===r.y?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,r.x)}}centroid(){const r=this.polyCount.reduce((s,c)=>s+c.edges,0);return 0!==r?this.acc.div(r)._round():new se(0,0)}span(){return new se(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,s)=>r+ +(s[0]!==Number.MAX_VALUE),0)}}class yc{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new le,this.centroidVertexArray=new yo,this.indexArray=new Ne,this.programConfigurations=new hc(r.layers,r.zoom),this.segments=new ri,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=r.enableTerrain}populate(r,s,c,d){this.features=[],this.hasPattern=lp("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const y=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*y/(y*y+1)/En/(1<<g.z)}(c);for(const{feature:g,id:y,index:x,sourceLayerIndex:E}of r){const D=this.layers[0]._featureFilter.needGeometry,M=Ol(g,D);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),M,c))continue;const A={id:y,sourceLayerIndex:E,index:x,geometry:D?M.geometry:Rl(g,c,d),properties:g.properties,type:g.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(cp("fill-extrusion",this.layers,A,this.zoom,s)):this.addFeature(A,A.geometry,x,c,{},s.availableImages,d),s.featureIndex.insert(g,A.geometry,x,E,this.index,k)}this.sortBorders()}addFeatures(r,s,c,d,g){for(const y of this.features){const{geometry:x}=y;this.addFeature(y,x,y.index,s,c,d,g)}this.sortBorders()}update(r,s,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,I0),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,S0.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Ca.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,s,c,d,g,y,x){const E=[new se(0,0),new se(En,En)],D=x.projection,M="globe"===D.name,A=this.enableTerrain&&!M?new _c:null;M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new qo);const k=ap(s,500);for(let G=k.length-1;G>=0;G--){const Z=k[G];(0===Z.length||(F=Z[0]).every(Q=>Q.x<=0)||F.every(Q=>Q.x>=En)||F.every(Q=>Q.y<=0)||F.every(Q=>Q.y>=En))&&k.splice(G,1)}var F;let U;if(M){const Z=1<<d.z,Q=zs(d.x/Z),ue=zs((d.x+1)/Z),ye=Ui(d.y/Z),be=Ui((d.y+1)/Z);U=function(Ee,Te,Be,Ve,Ye=0,et){const Oe=[];if(!Ee.length||!Be||!Ve)return Oe;const He=(ln,nn)=>{for(const zt of ln)Oe.push({polygon:zt,bounds:nn})},ot=Math.ceil(Math.log2(Be)),pt=Math.ceil(Math.log2(Ve)),ht=ot-pt,_t=[];for(let ln=0;ln<Math.abs(ht);ln++)_t.push(ht>0?0:1);for(let ln=0;ln<Math.min(ot,pt);ln++)_t.push(0),_t.push(1);let dn=Ee;if(dn=Mh(dn,Te[0].y-Ye,Te[1].y+Ye,1),dn=Mh(dn,Te[0].x-Ye,Te[1].x+Ye,0),!dn.length)return Oe;const xn=[];for(_t.length?xn.push({polygons:dn,bounds:Te,depth:0}):He(dn,Te);xn.length;){const ln=xn.pop(),nn=ln.depth,zt=_t[nn],Mt=ln.bounds[0],bn=ln.bounds[1],nr=0===zt?Mt.x:Mt.y,Wr=0===zt?bn.x:bn.y,pr=et?et(zt,nr,Wr):.5*(nr+Wr),Xr=Mh(ln.polygons,nr-Ye,pr+Ye,zt),qn=Mh(ln.polygons,pr-Ye,Wr+Ye,zt);if(Xr.length){const Fn=[Mt,new se(0===zt?pr:bn.x,1===zt?pr:bn.y)];_t.length>nn+1?xn.push({polygons:Xr,bounds:Fn,depth:nn+1}):He(Xr,Fn)}if(qn.length){const Fn=[new se(0===zt?pr:Mt.x,1===zt?pr:Mt.y),bn];_t.length>nn+1?xn.push({polygons:qn,bounds:Fn,depth:nn+1}):He(qn,Fn)}}return Oe}(k,E,Math.ceil((ue-Q)/11.25),Math.ceil((ye-be)/11.25),1,(Ee,Te,Be)=>{if(0===Ee)return.5*(Te+Be);{const Ve=Ui((d.y+Te/En)/Z);return(dc(.5*(Ui((d.y+Be/En)/Z)+Ve))*Z-d.y)*En}})}else{U=[];for(const G of k)U.push({polygon:G,bounds:E})}for(const G of U){const Z=G.polygon;let Q=0,ue=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Be=0;Be<Z.length;Be++){const Ve=Z[Be];if(0===Ve.length)continue;Q+=Ve.length;let Ye=0;A&&A.startRing(Ve[0]);for(let et=0;et<Ve.length;et++){const Oe=Ve[et];if(et>=1){const He=Ve[et-1];if(!ag(Oe,He,G.bounds)){A&&A.append(Oe,He),ue.vertexLength+4>ri.MAX_VERTEX_ARRAY_LENGTH&&(ue=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ot=Oe.sub(He)._perp(),pt=ot.x/(Math.abs(ot.x)+Math.abs(ot.y)),ht=ot.y>0?1:0,_t=He.dist(Oe);Ye+_t>32768&&(Ye=0),Tu(this.layoutVertexArray,Oe.x,Oe.y,pt,ht,0,0,Ye),Tu(this.layoutVertexArray,Oe.x,Oe.y,pt,ht,0,1,Ye),Ye+=_t,Tu(this.layoutVertexArray,He.x,He.y,pt,ht,0,0,Ye),Tu(this.layoutVertexArray,He.x,He.y,pt,ht,0,1,Ye);const dn=ue.vertexLength;if(this.indexArray.emplaceBack(dn,dn+2,dn+1),this.indexArray.emplaceBack(dn+1,dn+2,dn+3),ue.vertexLength+=4,ue.primitiveLength+=2,M){const xn=this.layoutVertexExtArray,ln=D.projectTilePoint(Oe.x,Oe.y,d),nn=D.projectTilePoint(He.x,He.y,d),zt=D.upVector(d,Oe.x,Oe.y),Mt=D.upVector(d,He.x,He.y);Nd(xn,ln,zt),Nd(xn,ln,zt),Nd(xn,nn,Mt),Nd(xn,nn,Mt)}}}}}if(ue.vertexLength+Q>ri.MAX_VERTEX_ARRAY_LENGTH&&(ue=this.segments.prepareSegment(Q,this.layoutVertexArray,this.indexArray)),"Polygon"!==dp[r.type])continue;const ye=[],be=[],Ee=ue.vertexLength;for(let Be=0;Be<Z.length;Be++){const Ve=Z[Be];if(0!==Ve.length){Ve!==Z[0]&&be.push(ye.length/2);for(let Ye=0;Ye<Ve.length;Ye++){const et=Ve[Ye];Tu(this.layoutVertexArray,et.x,et.y,0,0,1,1,0),ye.push(et.x),ye.push(et.y),A&&A.currentPolyCount.top++,M&&Nd(this.layoutVertexExtArray,D.projectTilePoint(et.x,et.y,d),D.upVector(d,et.x,et.y))}}}const Te=rp(ye,be);for(let Be=0;Be<Te.length;Be+=3)this.indexArray.emplaceBack(Ee+Te[Be],Ee+Te[Be+2],Ee+Te[Be+1]);ue.primitiveLength+=Te.length/3,ue.vertexLength+=Q}if(A&&A.polyCount.length>0){if(A.borders){A.vertexArrayOffset=this.centroidVertexArray.length;const G=A.borders,Z=this.featuresOnBorder.push(A)-1;for(let Q=0;Q<4;Q++)G[Q][0]!==Number.MAX_VALUE&&this.borders[Q].push(Z)}this.encodeCentroid(A.borders?void 0:A.centroid(),A)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,g,y,d)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((s,c)=>this.featuresOnBorder[s].borders[r][0]-this.featuresOnBorder[c].borders[r][0])}encodeCentroid(r,s,c=!0){let d,g;if(r)if(0!==r.y){const x=s.span()._mult(this.tileToMeter);d=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),g=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else d=Math.ceil(7*(r.x+450)),g=0;else d=0,g=+c;let y=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const x of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(y++,0,g),this.centroidVertexArray.emplace(y++,d,g);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(y++,d,g)}}}function ag(o,r,s){return o.x===r.x&&(o.x<s[0].x||o.x>s[1].x)||o.y===r.y&&(o.y<s[0].y||o.y>s[1].y)}Rt(yc,{omit:["layers","features"]}),Rt(_c);var Ly={paint:new B({"fill-extrusion-opacity":new C(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new S(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new C(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new C(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new P(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new S(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new S(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new C(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function vc(o,r){return o.x*r.x+o.y*r.y}function lg(o,r){if(1===o.length){let s=0;const c=r[s++];let d;for(;!d||c.equals(d);)if(d=r[s++],!d)return 1/0;for(;s<r.length;s++){const g=r[s],y=o[0],x=d.sub(c),E=g.sub(c),D=y.sub(c),M=vc(x,x),A=vc(x,E),k=vc(E,E),F=vc(D,x),U=vc(D,E),G=M*k-A*A,Z=(k*F-A*U)/G,Q=(M*U-A*F)/G,ue=c.z*(1-Z-Q)+d.z*Z+g.z*Q;if(isFinite(ue))return ue}return 1/0}{let s=1/0;for(const c of r)s=Math.min(s,c.z);return s}}function cg(o){const r=new se(o[0],o[1]);return r.z=o[2],r}function Fy(o,r,s,c,d,g,y,x){const E=y*d.getElevationAt(o,r,!0,!0),D=0!==g[0],M=D?0===g[1]?y*(g[0]/7-450):y*function(A,k,F){const U=Math.floor(k[0]/8),G=Math.floor(k[1]/8),Z=10*(k[0]-8*U),Q=10*(k[1]-8*G),ue=A.getElevationAt(U,G,!0,!0),ye=A.getMeterToDEM(F),be=Math.floor(.5*(Z*ye-1)),Ee=Math.floor(.5*(Q*ye-1)),Te=A.tileCoordToPixel(U,G),Be=2*be+1,Ve=2*Ee+1,Ye=(xn=Be,ln=Ve,[(ht=A).getElevationAtPixel(_t=Te.x-be,dn=Te.y-Ee,!0),ht.getElevationAtPixel(_t+ln,dn,!0),ht.getElevationAtPixel(_t,dn+ln,!0),ht.getElevationAtPixel(_t+xn,dn+ln,!0)]),et=Math.abs(Ye[0]-Ye[1]),Oe=Math.abs(Ye[2]-Ye[3]),He=Math.abs(Ye[0]-Ye[2])+Math.abs(Ye[1]-Ye[3]),ot=Math.min(.25,.5*ye*(et+Oe)/Be),pt=Math.min(.25,.5*ye*He/Ve);var ht,_t,dn,xn,ln;return ue+Math.max(ot*Z,pt*Q)}(d,g,x):E;return{base:E+(0===s)?-1:s,top:D?Math.max(M+c,E+s+2):E+c}}const zy=re([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ny}=zy,By=re([{name:"a_packed",components:3,type:"Float32"}]),{members:ug}=By,pp=Nl.VectorTileFeature.types,hg=Math.cos(Math.PI/180*37.5);class Cu{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(s=>s.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new ee,this.layoutVertexArray2=new he,this.indexArray=new Ne,this.programConfigurations=new hc(r.layers,r.zoom),this.segments=new ri,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(r,s,c,d){this.hasPattern=lp("line",this.layers,s);const g=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:M,id:A,index:k,sourceLayerIndex:F}of r){const U=this.layers[0]._featureFilter.needGeometry,G=Ol(M,U);if(!this.layers[0]._featureFilter.filter(new Ir(this.zoom),G,c))continue;const Z=g?g.evaluate(G,{},c):void 0,Q={id:A,properties:M.properties,type:M.type,sourceLayerIndex:F,index:k,geometry:U?G.geometry:Rl(M,c,d),patterns:{},sortKey:Z};y.push(Q)}g&&y.sort((M,A)=>M.sortKey-A.sortKey);const{lineAtlas:x,featureIndex:E}=s,D=this.addConstantDashes(x);for(const M of y){const{geometry:A,index:k,sourceLayerIndex:F}=M;if(D&&this.addFeatureDashes(M,x),this.hasPattern){const U=cp("line",this.layers,M,this.zoom,s);this.patternFeatures.push(U)}else this.addFeature(M,A,k,c,x.positions,s.availableImages);E.insert(r[k].feature,A,k,F,this.index)}}addConstantDashes(r){let s=!1;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if("constant"!==d.kind||"constant"!==g.kind)s=!0;else{const y=g.value,x=d.value;if(!x)continue;r.addDash(x.from,y),r.addDash(x.to,y),x.other&&r.addDash(x.other,y)}}return s}addFeatureDashes(r,s){const c=this.zoom;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===y.kind)continue;let x,E,D,M,A,k;if("constant"===g.kind){const Z=g.value;if(!Z)continue;x=Z.other||Z.to,E=Z.to,D=Z.from}else x=g.evaluate({zoom:c-1},r),E=g.evaluate({zoom:c},r),D=g.evaluate({zoom:c+1},r);"constant"===y.kind?M=A=k=y.value:(M=y.evaluate({zoom:c-1},r),A=y.evaluate({zoom:c},r),k=y.evaluate({zoom:c+1},r)),s.addDash(x,M),s.addDash(E,A),s.addDash(D,k);const F=s.getKey(x,M),U=s.getKey(E,A),G=s.getKey(D,k);r.patterns[d.id]={min:F,mid:U,max:G}}}update(r,s,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,s,this.stateDependentLayers,c,d)}addFeatures(r,s,c,d,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,s,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,ug)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ny),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,s,c,d,g,y){const x=this.layers[0].layout,E=x.get("line-join").evaluate(r,{}),D=x.get("line-cap").evaluate(r,{}),M=x.get("line-miter-limit"),A=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const k of s)this.addLine(k,r,E,D,M,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,g,y,d)}addLine(r,s,c,d,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<r.length-1;Q++)this.totalDistance+=r[Q].dist(r[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===pp[s.type];let E=r.length;for(;E>=2&&r[E-1].equals(r[E-2]);)E--;let D=0;for(;D<E-1&&r[D].equals(r[D+1]);)D++;if(E<(x?3:2))return;"bevel"===c&&(g=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,A=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let k,F,U,G,Z;this.e1=this.e2=-1,x&&(k=r[E-2],Z=r[D].sub(k)._unit()._perp());for(let Q=D;Q<E;Q++){if(U=Q===E-1?x?r[D+1]:void 0:r[Q+1],U&&r[Q].equals(U))continue;Z&&(G=Z),k&&(F=k),k=r[Q],Z=U?U.sub(k)._unit()._perp():G,G=G||Z;let ue=G.add(Z);0===ue.x&&0===ue.y||ue._unit();const ye=G.x*Z.x+G.y*Z.y,be=ue.x*Z.x+ue.y*Z.y,Ee=0!==be?1/be:1/0,Te=2*Math.sqrt(2-2*be),Be=be<hg&&F&&U,Ve=G.x*Z.y-G.y*Z.x>0;if(Be&&Q>D){const Oe=k.dist(F);if(Oe>2*M){const He=k.sub(k.sub(F)._mult(M/Oe)._round());this.updateDistance(F,He),this.addCurrentVertex(He,G,0,0,A),F=He}}const Ye=F&&U;let et=Ye?c:x?"butt":d;if(Ye&&"round"===et&&(Ee<y?et="miter":Ee<=2&&(et="fakeround")),"miter"===et&&Ee>g&&(et="bevel"),"bevel"===et&&(Ee>2&&(et="flipbevel"),Ee<g&&(et="miter")),F&&this.updateDistance(F,k),"miter"===et)ue._mult(Ee),this.addCurrentVertex(k,ue,0,0,A);else if("flipbevel"===et){if(Ee>100)ue=Z.mult(-1);else{const Oe=Ee*G.add(Z).mag()/G.sub(Z).mag();ue._perp()._mult(Oe*(Ve?-1:1))}this.addCurrentVertex(k,ue,0,0,A),this.addCurrentVertex(k,ue.mult(-1),0,0,A)}else if("bevel"===et||"fakeround"===et){const Oe=-Math.sqrt(Ee*Ee-1),He=Ve?Oe:0,ot=Ve?0:Oe;if(F&&this.addCurrentVertex(k,G,He,ot,A),"fakeround"===et){const pt=Math.round(180*Te/Math.PI/20);for(let ht=1;ht<pt;ht++){let _t=ht/pt;if(.5!==_t){const xn=_t-.5;_t+=_t*xn*(_t-1)*((1.0904+ye*(ye*(3.55645-1.43519*ye)-3.2452))*xn*xn+(.848013+ye*(.215638*ye-1.06021)))}const dn=Z.sub(G)._mult(_t)._add(G)._unit()._mult(Ve?-1:1);this.addHalfVertex(k,dn.x,dn.y,!1,Ve,0,A)}}U&&this.addCurrentVertex(k,Z,-He,-ot,A)}else if("butt"===et)this.addCurrentVertex(k,ue,0,0,A);else if("square"===et){const Oe=F?1:-1;F||this.addCurrentVertex(k,ue,Oe,Oe,A),this.addCurrentVertex(k,ue,0,0,A),F&&this.addCurrentVertex(k,ue,Oe,Oe,A)}else"round"===et&&(F&&(this.addCurrentVertex(k,G,0,0,A),this.addCurrentVertex(k,G,1,1,A,!0)),U&&(this.addCurrentVertex(k,Z,-1,-1,A,!0),this.addCurrentVertex(k,Z,0,0,A)));if(Be&&Q<E-1){const Oe=k.dist(U);if(Oe>2*M){const He=k.add(U.sub(k)._mult(M/Oe)._round());this.updateDistance(k,He),this.addCurrentVertex(He,Z,0,0,A),k=He}}}}addCurrentVertex(r,s,c,d,g,y=!1){const x=s.y*d-s.x,E=-s.y-s.x*d;this.addHalfVertex(r,s.x+s.y*c,s.y-s.x*c,y,!1,c,g),this.addHalfVertex(r,x,E,y,!0,-d,g)}addHalfVertex({x:r,y:s},c,d,g,y,x,E){this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(s<<1)+(y?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const D=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),E.primitiveLength++),y?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,s){this.distance+=r.dist(s),this.updateScaledDistance()}}Rt(Cu,{omit:["layers","patternFeatures"]});const Uy=new B({"line-cap":new S(ke.layout_line["line-cap"]),"line-join":new S(ke.layout_line["line-join"]),"line-miter-limit":new C(ke.layout_line["line-miter-limit"]),"line-round-limit":new C(ke.layout_line["line-round-limit"]),"line-sort-key":new S(ke.layout_line["line-sort-key"])});var dg={paint:new B({"line-opacity":new S(ke.paint_line["line-opacity"]),"line-color":new S(ke.paint_line["line-color"]),"line-translate":new C(ke.paint_line["line-translate"]),"line-translate-anchor":new C(ke.paint_line["line-translate-anchor"]),"line-width":new S(ke.paint_line["line-width"]),"line-gap-width":new S(ke.paint_line["line-gap-width"]),"line-offset":new S(ke.paint_line["line-offset"]),"line-blur":new S(ke.paint_line["line-blur"]),"line-dasharray":new P(ke.paint_line["line-dasharray"]),"line-pattern":new P(ke.paint_line["line-pattern"]),"line-gradient":new L(ke.paint_line["line-gradient"])}),layout:Uy};const mp=new class extends S{possiblyEvaluate(o,r){return r=new Ir(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(o,r)}evaluate(o,r,s,c){return r=en({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(o,r,s,c)}}(dg.paint.properties["line-width"].specification);function gp(o,r){return r>0?r+2*o:o}mp.useIntegerZoom=!0;const xc=re([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),fg=re([{name:"a_projected_pos",components:3,type:"Float32"}],4);re([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pg=re([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),jy=re([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);re([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ah=re([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Vy=re([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);re([{name:"triangle",components:3,type:"Uint16"}]),re([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),re([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),re([{type:"Float32",name:"offsetX"}]),re([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ta=128;function Bd(o,r){const{expression:s}=r;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new Ir(o+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:d}=s;let g=0;for(;g<c.length&&c[g]<=o;)g++;g=Math.max(0,g-1);let y=g;for(;y<c.length&&c[y]<o+1;)y++;y=Math.min(c.length-1,y);const x=c[g],E=c[y];return"composite"===s.kind?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:d}:{kind:"camera",minZoom:x,maxZoom:E,minSize:s.evaluate(new Ir(x)),maxSize:s.evaluate(new Ir(E)),interpolationType:d}}}function Du(o,{uSize:r,uSizeT:s},{lowerSize:c,upperSize:d}){return"source"===o.kind?c/ta:"composite"===o.kind?bt(c/ta,d/ta,s):r}function bc(o,r){let s=0,c=0;if("constant"===o.kind)c=o.layoutSize;else if("source"!==o.kind){const{interpolationType:d,minZoom:g,maxZoom:y}=o,x=d?De(jr.interpolationFactor(d,r,g,y),0,1):0;"camera"===o.kind?c=bt(o.minSize,o.maxSize,x):s=x}return{uSizeT:s,uSize:c}}var Ud=Object.freeze({__proto__:null,getSizeData:Bd,evaluateSizeForFeature:Du,evaluateSizeForZoom:bc,SIZE_PACK_FACTOR:ta});function jd(o,r,s){return o.sections.forEach(c=>{c.text=function(d,g,y){const x=g.layout.get("text-transform").evaluate(y,{});return"uppercase"===x?d=d.toLocaleUpperCase():"lowercase"===x&&(d=d.toLocaleLowerCase()),oo.applyArabicShaping&&(d=oo.applyArabicShaping(d)),d}(c.text,r,s)}),o}const Su={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function _p(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function mg(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var Vd=function(o,r,s,c,d){var g,y,x=8*d-c-1,E=(1<<x)-1,D=E>>1,M=-7,A=s?d-1:0,k=s?-1:1,F=o[r+A];for(A+=k,g=F&(1<<-M)-1,F>>=-M,M+=x;M>0;g=256*g+o[r+A],A+=k,M-=8);for(y=g&(1<<-M)-1,g>>=-M,M+=c;M>0;y=256*y+o[r+A],A+=k,M-=8);if(0===g)g=1-D;else{if(g===E)return y?NaN:1/0*(F?-1:1);y+=Math.pow(2,c),g-=D}return(F?-1:1)*y*Math.pow(2,g-c)},Iu=function(o,r,s,c,d,g){var y,x,E,D=8*g-d-1,M=(1<<D)-1,A=M>>1,k=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,F=c?0:g-1,U=c?1:-1,G=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,y=M):(y=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-y))<1&&(y--,E*=2),(r+=y+A>=1?k/E:k*Math.pow(2,1-A))*E>=2&&(y++,E/=2),y+A>=M?(x=0,y=M):y+A>=1?(x=(r*E-1)*Math.pow(2,d),y+=A):(x=r*Math.pow(2,A-1)*Math.pow(2,d),y=0));d>=8;o[s+F]=255&x,F+=U,x/=256,d-=8);for(y=y<<d|x,D+=d;D>0;o[s+F]=255&y,F+=U,y/=256,D-=8);o[s+F-U]|=128*G},Ph=Tr;function Tr(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Tr.Varint=0,Tr.Fixed64=1,Tr.Bytes=2,Tr.Fixed32=5;var yp=4294967296,gg=1/yp,vp="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function na(o){return o.type===Tr.Bytes?o.readVarint()+o.pos:o.pos+1}function $y(o,r,s){var c=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));s.realloc(c);for(var d=s.pos-1;d>=o;d--)s.buf[d+c]=s.buf[d]}function _g(o,r){for(var s=0;s<o.length;s++)r.writeVarint(o[s])}function Gy(o,r){for(var s=0;s<o.length;s++)r.writeSVarint(o[s])}function yg(o,r){for(var s=0;s<o.length;s++)r.writeFloat(o[s])}function Hy(o,r){for(var s=0;s<o.length;s++)r.writeDouble(o[s])}function qy(o,r){for(var s=0;s<o.length;s++)r.writeBoolean(o[s])}function ra(o,r){for(var s=0;s<o.length;s++)r.writeFixed32(o[s])}function Zy(o,r){for(var s=0;s<o.length;s++)r.writeSFixed32(o[s])}function vg(o,r){for(var s=0;s<o.length;s++)r.writeFixed64(o[s])}function Wy(o,r){for(var s=0;s<o.length;s++)r.writeSFixed64(o[s])}function $d(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+16777216*o[r+3]}function Mu(o,r,s){o[s]=r,o[s+1]=r>>>8,o[s+2]=r>>>16,o[s+3]=r>>>24}function xg(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+(o[r+3]<<24)}function bg(o,r,s){r.glyphs=[],1===o&&s.readMessage(Xy,r)}function Xy(o,r,s){if(3===o){const{id:c,bitmap:d,width:g,height:y,left:x,top:E,advance:D}=s.readMessage(Ky,{});r.glyphs.push({id:c,bitmap:new Ta({width:g+6,height:y+6},d),metrics:{width:g,height:y,left:x,top:E,advance:D}})}else 4===o?r.ascender=s.readSVarint():5===o&&(r.descender=s.readSVarint())}function Ky(o,r,s){1===o?r.id=s.readVarint():2===o?r.bitmap=s.readBytes():3===o?r.width=s.readVarint():4===o?r.height=s.readVarint():5===o?r.left=s.readSVarint():6===o?r.top=s.readSVarint():7===o&&(r.advance=s.readVarint())}function xp(o){let r=0,s=0;for(const y of o)r+=y.w*y.h,s=Math.max(s,y.w);o.sort((y,x)=>x.h-y.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),s),h:1/0}];let d=0,g=0;for(const y of o)for(let x=c.length-1;x>=0;x--){const E=c[x];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,g=Math.max(g,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===E.w&&y.h===E.h){const D=c.pop();x<c.length&&(c[x]=D)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(c.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:d,h:g,fill:r/(d*g)||0}}Tr.prototype={destroy:function(){this.buf=null},readFields:function(o,r,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),d=c>>3,g=this.pos;this.type=7&c,o(d,r,this),this.pos===g&&this.skip(c)}return r},readMessage:function(o,r){return this.readFields(o,r,this.readVarint()+this.pos)},readFixed32:function(){var o=$d(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=xg(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=$d(this.buf,this.pos)+$d(this.buf,this.pos+4)*yp;return this.pos+=8,o},readSFixed64:function(){var o=$d(this.buf,this.pos)+xg(this.buf,this.pos+4)*yp;return this.pos+=8,o},readFloat:function(){var o=Vd(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Vd(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var r,s,c=this.buf;return r=127&(s=c[this.pos++]),s<128?r:(r|=(127&(s=c[this.pos++]))<<7,s<128?r:(r|=(127&(s=c[this.pos++]))<<14,s<128?r:(r|=(127&(s=c[this.pos++]))<<21,s<128?r:function(d,g,y){var x,E,D=y.buf;if(x=(112&(E=D[y.pos++]))>>4,E<128||(x|=(127&(E=D[y.pos++]))<<3,E<128)||(x|=(127&(E=D[y.pos++]))<<10,E<128)||(x|=(127&(E=D[y.pos++]))<<17,E<128)||(x|=(127&(E=D[y.pos++]))<<24,E<128)||(x|=(1&(E=D[y.pos++]))<<31,E<128))return function wc(o,r,s){return s?4294967296*r+(o>>>0):4294967296*(r>>>0)+(o>>>0)}(d,x,g);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,r=this.pos;return this.pos=o,o-r>=12&&vp?vp.decode(this.buf.subarray(r,o)):function(s,c,d){for(var g="",y=c;y<d;){var x,E,D,M=s[y],A=null,k=M>239?4:M>223?3:M>191?2:1;if(y+k>d)break;1===k?M<128&&(A=M):2===k?128==(192&(x=s[y+1]))&&(A=(31&M)<<6|63&x)<=127&&(A=null):3===k?(E=s[y+2],128==(192&(x=s[y+1]))&&128==(192&E)&&((A=(15&M)<<12|(63&x)<<6|63&E)<=2047||A>=55296&&A<=57343)&&(A=null)):4===k&&(E=s[y+2],D=s[y+3],128==(192&(x=s[y+1]))&&128==(192&E)&&128==(192&D)&&((A=(15&M)<<18|(63&x)<<12|(63&E)<<6|63&D)<=65535||A>=1114112)&&(A=null)),null===A?(A=65533,k=1):A>65535&&(A-=65536,g+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),g+=String.fromCharCode(A),y+=k}return g}(this.buf,r,o)},readBytes:function(){var o=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,o);return this.pos=o,r},readPackedVarint:function(o,r){if(this.type!==Tr.Bytes)return o.push(this.readVarint(r));var s=na(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(r));return o},readPackedSVarint:function(o){if(this.type!==Tr.Bytes)return o.push(this.readSVarint());var r=na(this);for(o=o||[];this.pos<r;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Tr.Bytes)return o.push(this.readBoolean());var r=na(this);for(o=o||[];this.pos<r;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Tr.Bytes)return o.push(this.readFloat());var r=na(this);for(o=o||[];this.pos<r;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Tr.Bytes)return o.push(this.readDouble());var r=na(this);for(o=o||[];this.pos<r;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Tr.Bytes)return o.push(this.readFixed32());var r=na(this);for(o=o||[];this.pos<r;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Tr.Bytes)return o.push(this.readSFixed32());var r=na(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Tr.Bytes)return o.push(this.readFixed64());var r=na(this);for(o=o||[];this.pos<r;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Tr.Bytes)return o.push(this.readSFixed64());var r=na(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed64());return o},skip:function(o){var r=7&o;if(r===Tr.Varint)for(;this.buf[this.pos++]>127;);else if(r===Tr.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Tr.Fixed32)this.pos+=4;else{if(r!==Tr.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(o,r){this.writeVarint(o<<3|r)},realloc:function(o){for(var r=this.length||16;r<this.pos+o;)r*=2;if(r!==this.length){var s=new Uint8Array(r);s.set(this.buf),this.buf=s,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Mu(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Mu(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Mu(this.buf,-1&o,this.pos),Mu(this.buf,Math.floor(o*gg),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Mu(this.buf,-1&o,this.pos),Mu(this.buf,Math.floor(o*gg),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(r,s){var c,d,g,x;if(r>=0?(c=r%4294967296|0,d=r/4294967296|0):(d=~(-r/4294967296),4294967295^(c=~(-r%4294967296))?c=c+1|0:(c=0,d=d+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),g=c,(x=s).buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7),function(g,y){var x=(7&g)<<4;y.buf[y.pos++]|=x|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(d,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var r=this.pos;this.pos=function(c,d,g){for(var y,x,E=0;E<d.length;E++){if((y=d.charCodeAt(E))>55295&&y<57344){if(!x){y>56319||E+1===d.length?(c[g++]=239,c[g++]=191,c[g++]=189):x=y;continue}if(y<56320){c[g++]=239,c[g++]=191,c[g++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(c[g++]=239,c[g++]=191,c[g++]=189,x=null);y<128?c[g++]=y:(y<2048?c[g++]=y>>6|192:(y<65536?c[g++]=y>>12|224:(c[g++]=y>>18|240,c[g++]=y>>12&63|128),c[g++]=y>>6&63|128),c[g++]=63&y|128)}return g}(this.buf,o,this.pos);var s=this.pos-r;s>=128&&$y(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),Iu(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Iu(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var r=o.length;this.writeVarint(r),this.realloc(r);for(var s=0;s<r;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,r){this.pos++;var s=this.pos;o(r,this);var c=this.pos-s;c>=128&&$y(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,r,s){this.writeTag(o,Tr.Bytes),this.writeRawMessage(r,s)},writePackedVarint:function(o,r){r.length&&this.writeMessage(o,_g,r)},writePackedSVarint:function(o,r){r.length&&this.writeMessage(o,Gy,r)},writePackedBoolean:function(o,r){r.length&&this.writeMessage(o,qy,r)},writePackedFloat:function(o,r){r.length&&this.writeMessage(o,yg,r)},writePackedDouble:function(o,r){r.length&&this.writeMessage(o,Hy,r)},writePackedFixed32:function(o,r){r.length&&this.writeMessage(o,ra,r)},writePackedSFixed32:function(o,r){r.length&&this.writeMessage(o,Zy,r)},writePackedFixed64:function(o,r){r.length&&this.writeMessage(o,vg,r)},writePackedSFixed64:function(o,r){r.length&&this.writeMessage(o,Wy,r)},writeBytesField:function(o,r){this.writeTag(o,Tr.Bytes),this.writeBytes(r)},writeFixed32Field:function(o,r){this.writeTag(o,Tr.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(o,r){this.writeTag(o,Tr.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(o,r){this.writeTag(o,Tr.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(o,r){this.writeTag(o,Tr.Fixed64),this.writeSFixed64(r)},writeVarintField:function(o,r){this.writeTag(o,Tr.Varint),this.writeVarint(r)},writeSVarintField:function(o,r){this.writeTag(o,Tr.Varint),this.writeSVarint(r)},writeStringField:function(o,r){this.writeTag(o,Tr.Bytes),this.writeString(r)},writeFloatField:function(o,r){this.writeTag(o,Tr.Fixed32),this.writeFloat(r)},writeDoubleField:function(o,r){this.writeTag(o,Tr.Fixed64),this.writeDouble(r)},writeBooleanField:function(o,r){this.writeVarintField(o,Boolean(r))}};class Nn{constructor(r,{pixelRatio:s,version:c,stretchX:d,stretchY:g,content:y}){this.paddedRect=r,this.pixelRatio=s,this.stretchX=d,this.stretchY=g,this.content=y,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ec{constructor(r,s){const c={},d={};this.haveRenderCallbacks=[];const g=[];this.addImages(r,c,g),this.addImages(s,d,g);const{w:y,h:x}=xp(g),E=new Xo({width:y||1,height:x||1});for(const D in r){const M=r[D],A=c[D].paddedRect;Xo.copy(M.data,E,{x:0,y:0},{x:A.x+1,y:A.y+1},M.data)}for(const D in s){const M=s[D],A=d[D].paddedRect,k=A.x+1,F=A.y+1,U=M.data.width,G=M.data.height;Xo.copy(M.data,E,{x:0,y:0},{x:k,y:F},M.data),Xo.copy(M.data,E,{x:0,y:G-1},{x:k,y:F-1},{width:U,height:1}),Xo.copy(M.data,E,{x:0,y:0},{x:k,y:F+G},{width:U,height:1}),Xo.copy(M.data,E,{x:U-1,y:0},{x:k-1,y:F},{width:1,height:G}),Xo.copy(M.data,E,{x:0,y:0},{x:k+U,y:F},{width:1,height:G})}this.image=E,this.iconPositions=c,this.patternPositions=d}addImages(r,s,c){for(const d in r){const g=r[d],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};c.push(y),s[d]=new Nn(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(r,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>r.hasImage(c)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in r.updatedImages)this.patchUpdatedImage(this.iconPositions[c],r.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],r.getImage(c),s)}patchUpdatedImage(r,s,c){if(!r||!s||r.version===s.version)return;r.version=s.version;const[d,g]=r.tl;c.update(s.data,void 0,{x:d,y:g})}}Rt(Nn),Rt(Ec);const Ko={horizontal:1,vertical:2,horizontalOnly:3};class Au{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,s){const c=new Au;return c.scale=r||1,c.fontStack=s,c}static forImage(r){const s=new Au;return s.imageName=r,s}}class sl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,s){const c=new sl;for(let d=0;d<r.sections.length;d++){const g=r.sections[d];g.image?c.addImageSection(g):c.addTextSection(g,s)}return c}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(s,c){let d="";for(let g=0;g<s.length;g++){const y=s.charCodeAt(g+1)||null,x=s.charCodeAt(g-1)||null;d+=!c&&(y&&Wa(y)&&!Su[s[g+1]]||x&&Wa(x)&&!Su[s[g-1]])||!Su[s[g]]?s[g]:Su[s[g]]}return d}(this.text,r)}trim(){let r=0;for(let c=0;c<this.text.length&&kh[this.text.charCodeAt(c)];c++)r++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=r&&kh[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(r,s),this.sectionIndex=this.sectionIndex.slice(r,s)}substring(r,s){const c=new sl;return c.text=this.text.substring(r,s),c.sectionIndex=this.sectionIndex.slice(r,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,s)=>Math.max(r,this.sections[s].scale),0)}addTextSection(r,s){this.text+=r.text,this.sections.push(Au.forText(r.scale,r.fontStack||s));const c=this.sections.length-1;for(let d=0;d<r.text.length;++d)this.sectionIndex.push(c)}addImageSection(r){const s=r.image?r.image.name:"";if(0===s.length)return void un("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Au.forImage(s)),this.sectionIndex.push(this.sections.length-1)):un("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hs(o,r,s,c,d,g,y,x,E,D,M,A,k,F,U,G){const Z=sl.fromFeature(o,d);let Q;A===Ko.vertical&&Z.verticalizePunctuation(k);const{processBidirectionalText:ue,processStyledBidirectionalText:ye}=oo;if(ue&&1===Z.sections.length){Q=[];const Te=ue(Z.toString(),wg(Z,D,g,r,c,F,U));for(const Be of Te){const Ve=new sl;Ve.text=Be,Ve.sections=Z.sections;for(let Ye=0;Ye<Be.length;Ye++)Ve.sectionIndex.push(0);Q.push(Ve)}}else if(ye){Q=[];const Te=ye(Z.text,Z.sectionIndex,wg(Z,D,g,r,c,F,U));for(const Be of Te){const Ve=new sl;Ve.text=Be[0],Ve.sectionIndex=Be[1],Ve.sections=Z.sections,Q.push(Ve)}}else Q=function(Te,Be){const Ve=[],Ye=Te.text;let et=0;for(const Oe of Be)Ve.push(Te.substring(et,Oe)),et=Oe;return et<Ye.length&&Ve.push(Te.substring(et,Ye.length)),Ve}(Z,wg(Z,D,g,r,c,F,U));const be=[],Ee={positionedLines:be,text:Z.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Te,Be,Ve,Ye,et,Oe,He,ot,pt,ht,_t,dn){let xn=0,ln=0,nn=0;const zt="right"===ot?1:"left"===ot?0:.5;let Mt=!1;for(const qn of et){const Fn=qn.getSections();for(const ir of Fn){if(ir.imageName)continue;const Mr=Be[ir.fontStack];if(Mr&&(Mt=void 0!==Mr.ascender&&void 0!==Mr.descender,!Mt))break}if(!Mt)break}let bn=0;for(const qn of et){qn.trim();const Fn=qn.getMaxScale(),ir=24*(Fn-1),Mr={positionedGlyphs:[],lineOffset:0};Te.positionedLines[bn]=Mr;const kr=Mr.positionedGlyphs;let Kr=0;if(!qn.length()){ln+=Oe,++bn;continue}let Ei=0,Ro=0;for(let xr=0;xr<qn.length();xr++){const lo=qn.getSection(xr),Oo=qn.getSectionIndex(xr),Ai=qn.getCharCode(xr);let Ti=lo.scale,Br=null,Rr=null,Lo=null,Eo=24,ui=0;const co=!(pt===Ko.horizontal||!_t&&!Za(Ai)||_t&&(kh[Ai]||(nr=Ai,Yu(nr)||Ks(nr)||Ao(nr)||Ni(nr)||au(nr))));if(lo.imageName){const uo=Ye[lo.imageName];if(!uo)continue;Lo=lo.imageName,Te.iconsInText=Te.iconsInText||!0,Rr=uo.paddedRect;const Pi=uo.displaySize;Ti=24*Ti/dn,Br={width:Pi[0],height:Pi[1],left:1,top:-3,advance:co?Pi[1]:Pi[0],localGlyph:!1},ui=Mt?-Br.height*Ti:24*Fn-17-Pi[1]*Ti,Eo=Br.advance;const gs=(co?Pi[0]:Pi[1])*Ti-24*Fn;gs>0&&gs>Kr&&(Kr=gs)}else{const uo=Ve[lo.fontStack];if(!uo)continue;uo[Ai]&&(Rr=uo[Ai]);const Pi=Be[lo.fontStack];if(!Pi)continue;const gs=Pi.glyphs[Ai];if(!gs)continue;if(Br=gs.metrics,Eo=8203!==Ai?24:0,Mt){const Gl=void 0!==Pi.ascender?Math.abs(Pi.ascender):0,Fu=void 0!==Pi.descender?Math.abs(Pi.descender):0,Gh=(Gl+Fu)*Ti;Ei<Gh&&(Ei=Gh,Ro=(Gl-Fu)/2*Ti),ui=-Gl*Ti}else ui=24*(Fn-Ti)-17}co?(Te.verticalizable=!0,kr.push({glyph:Ai,imageName:Lo,x:xn,y:ln+ui,vertical:co,scale:Ti,localGlyph:Br.localGlyph,fontStack:lo.fontStack,sectionIndex:Oo,metrics:Br,rect:Rr}),xn+=Eo*Ti+ht):(kr.push({glyph:Ai,imageName:Lo,x:xn,y:ln+ui,vertical:co,scale:Ti,localGlyph:Br.localGlyph,fontStack:lo.fontStack,sectionIndex:Oo,metrics:Br,rect:Rr}),xn+=Br.advance*Ti+ht)}0!==kr.length&&(nn=Math.max(xn-ht,nn),Mt?Jy(kr,zt,Kr,Ro,Oe*Fn/2):Jy(kr,zt,Kr,0,Oe/2)),xn=0;const wo=Oe*Fn+Kr;Mr.lineOffset=Math.max(Kr,ir),ln+=wo,++bn}var nr;const Wr=ln,{horizontalAlign:pr,verticalAlign:Xr}=qd(He);(function(qn,Fn,ir,Mr,kr,Kr){const Ei=(Fn-ir)*kr,Ro=-Kr*Mr;for(const wo of qn)for(const xr of wo.positionedGlyphs)xr.x+=Ei,xr.y+=Ro})(Te.positionedLines,zt,pr,Xr,nn,Wr),Te.top+=-Xr*Wr,Te.bottom=Te.top+Wr,Te.left+=-pr*nn,Te.right=Te.left+nn,Te.hasBaseline=Mt}(Ee,r,s,c,Q,y,x,E,A,D,k,G),!function(Te){for(const Be of Te)if(0!==Be.positionedGlyphs.length)return!1;return!0}(be)&&Ee}const kh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Yy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Gd(o,r,s,c,d,g){if(r.imageName){const y=c[r.imageName];return y?y.displaySize[0]*r.scale*24/g+d:0}{const y=s[r.fontStack],x=y&&y.glyphs[o];return x?x.metrics.advance*r.scale+d:0}}function Da(o,r,s,c){const d=Math.pow(o-r,2);return c?o<r?d/2:2*d:d+Math.abs(s)*s}function bp(o,r,s){let c=0;return 10===o&&(c-=1e4),s&&(c+=150),40!==o&&65288!==o||(c+=50),41!==r&&65289!==r||(c+=50),c}function wp(o,r,s,c,d,g){let y=null,x=Da(r,s,d,g);for(const E of c){const D=Da(r-E.x,s,d,g)+E.badness;D<=x&&(y=E,x=D)}return{index:o,x:r,priorBreak:y,badness:x}}function Hd(o){return o?Hd(o.priorBreak).concat(o.index):[]}function wg(o,r,s,c,d,g,y){if("point"!==g)return[];if(!o)return[];const x=[],E=function(k,F,U,G,Z,Q){let ue=0;for(let ye=0;ye<k.length();ye++){const be=k.getSection(ye);ue+=Gd(k.getCharCode(ye),be,G,Z,F,Q)}return ue/Math.max(1,Math.ceil(ue/U))}(o,r,s,c,d,y),D=o.text.indexOf("\u200b")>=0;let M=0;for(let k=0;k<o.length();k++){const F=o.getSection(k),U=o.getCharCode(k);if(kh[U]||(M+=Gd(U,F,c,d,r,y)),k<o.length()-1){const G=!((A=U)<11904||!(iu(A)||th(A)||Nr(A)||lc(A)||nh(A)||Ju(A)||xd(A)||ru(A)||rh(A)||su(A)||sc(A)||oh(A)||qa(A)||eh(A)||Qu(A)||ou(A)||Sl(A)||Ys(A)||ac(A)||ih(A)));(Yy[U]||G||F.imageName)&&x.push(wp(k+1,M,E,x,bp(U,o.getCharCode(k+1),G&&D),!1))}}var A;return Hd(wp(o.length(),M,E,x,0,!0))}function qd(o){let r=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:r,verticalAlign:s}}function Jy(o,r,s,c,d){if(!(r||s||c||d))return;const g=o.length-1,y=o[g],x=(y.x+y.metrics.advance*y.scale)*r;for(let E=0;E<=g;E++)o[E].x-=x,o[E].y+=s+c+d}function Zd(o,r,s){const{horizontalAlign:c,verticalAlign:d}=qd(s),g=r[0]-o.displaySize[0]*c,y=r[1]-o.displaySize[1]*d;return{image:o,top:y,bottom:y+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function Rh(o,r,s,c,d,g){const y=o.image;let x;if(y.content){const Z=y.content,Q=y.pixelRatio||1;x=[Z[0]/Q,Z[1]/Q,y.displaySize[0]-Z[2]/Q,y.displaySize[1]-Z[3]/Q]}const E=r.left*g,D=r.right*g;let M,A,k,F;"width"===s||"both"===s?(F=d[0]+E-c[3],A=d[0]+D+c[1]):(F=d[0]+(E+D-y.displaySize[0])/2,A=F+y.displaySize[0]);const U=r.top*g,G=r.bottom*g;return"height"===s||"both"===s?(M=d[1]+U-c[0],k=d[1]+G+c[2]):(M=d[1]+(U+G-y.displaySize[1])/2,k=M+y.displaySize[1]),{image:y,top:M,right:A,bottom:k,left:F,collisionPadding:x}}class ia extends se{constructor(r,s,c,d,g){super(r,s),this.angle=d,this.z=c,void 0!==g&&(this.segment=g)}clone(){return new ia(this.x,this.y,this.z,this.angle,this.segment)}}function Wd(o,r,s,c,d){if(void 0===r.segment)return!0;let g=r,y=r.segment+1,x=0;for(;x>-s/2;){if(y--,y<0)return!1;x-=o[y].dist(g),g=o[y]}x+=o[y].dist(o[y+1]),y++;const E=[];let D=0;for(;x<s/2;){const M=o[y],A=o[y+1];if(!A)return!1;let k=o[y-1].angleTo(M)-M.angleTo(A);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:k}),D+=k;x-E[0].distance>c;)D-=E.shift().angleDelta;if(D>d)return!1;y++,x+=M.dist(A)}return!0}function Xd(o){let r=0;for(let s=0;s<o.length-1;s++)r+=o[s].dist(o[s+1]);return r}function Qy(o,r,s){return o?.6*r*s:0}function Eg(o,r){return Math.max(o?o.right-o.left:0,r?r.right-r.left:0)}function ev(o,r,s,c,d,g){const y=Qy(s,d,g),x=Eg(s,c)*g;let E=0;const D=Xd(o)/2;for(let M=0;M<o.length-1;M++){const A=o[M],k=o[M+1],F=A.dist(k);if(E+F>D){const U=(D-E)/F,G=bt(A.x,k.x,U),Z=bt(A.y,k.y,U),Q=new ia(G,Z,0,k.angleTo(A),M);return!y||Wd(o,Q,x,y,r)?Q:void 0}E+=F}}function tv(o,r,s,c,d,g,y,x,E){const D=Qy(c,g,y),M=Eg(c,d),A=M*y,k=0===o[0].x||o[0].x===E||0===o[0].y||o[0].y===E;return r-A<r/4&&(r=A+r/4),Tg(o,k?r/2*x%r:(M/2+2*g)*y*x%r,r,D,s,A,k,!1,E)}function Tg(o,r,s,c,d,g,y,x,E){const D=g/2,M=Xd(o);let A=0,k=r-s,F=[];for(let U=0;U<o.length-1;U++){const G=o[U],Z=o[U+1],Q=G.dist(Z),ue=Z.angleTo(G);for(;k+s<A+Q;){k+=s;const ye=(k-A)/Q,be=bt(G.x,Z.x,ye),Ee=bt(G.y,Z.y,ye);if(be>=0&&be<E&&Ee>=0&&Ee<E&&k-D>=0&&k+D<=M){const Te=new ia(be,Ee,0,ue,U);Te._round(),c&&!Wd(o,Te,g,c,d)||F.push(Te)}}A+=Q}return x||F.length||y||(F=Tg(o,A/2,s,c,d,g,y,!0,E)),F}function Ep(o,r,s,c,d){const g=[];for(let y=0;y<o.length;y++){const x=o[y];let E;for(let D=0;D<x.length-1;D++){let M=x[D],A=x[D+1];M.x<r&&A.x<r||(M.x<r?M=new se(r,M.y+(r-M.x)/(A.x-M.x)*(A.y-M.y))._round():A.x<r&&(A=new se(r,M.y+(r-M.x)/(A.x-M.x)*(A.y-M.y))._round()),M.y<s&&A.y<s||(M.y<s?M=new se(M.x+(s-M.y)/(A.y-M.y)*(A.x-M.x),s)._round():A.y<s&&(A=new se(M.x+(s-M.y)/(A.y-M.y)*(A.x-M.x),s)._round()),M.x>=c&&A.x>=c||(M.x>=c?M=new se(c,M.y+(c-M.x)/(A.x-M.x)*(A.y-M.y))._round():A.x>=c&&(A=new se(c,M.y+(c-M.x)/(A.x-M.x)*(A.y-M.y))._round()),M.y>=d&&A.y>=d||(M.y>=d?M=new se(M.x+(d-M.y)/(A.y-M.y)*(A.x-M.x),d)._round():A.y>=d&&(A=new se(M.x+(d-M.y)/(A.y-M.y)*(A.x-M.x),d)._round()),E&&M.equals(E[E.length-1])||(E=[M],g.push(E)),E.push(A)))))}}return g}Rt(ia);const Kd=1e20;function Cg(o,r,s,c,d,g,y,x,E){for(let D=r;D<r+c;D++)nv(o,s*g+D,g,d,y,x,E);for(let D=s;D<s+d;D++)nv(o,D*g+r,1,c,y,x,E)}function nv(o,r,s,c,d,g,y){g[0]=0,y[0]=-Kd,y[1]=Kd,d[0]=o[r];for(let x=1,E=0,D=0;x<c;x++){d[x]=o[r+x*s];const M=x*x;do{const A=g[E];D=(d[x]-d[A]+M-A*A)/(x-A)/2}while(D<=y[E]&&--E>-1);E++,g[E]=x,y[E]=D,y[E+1]=Kd}for(let x=0,E=0;x<c;x++){for(;y[E+1]<x;)E++;const D=g[E],M=x-D;o[r+x*s]=d[D]+M*M}}const Yd={none:0,ideographs:1,all:2};class Tc{constructor(r,s,c){this.requestManager=r,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,s){const c=[];for(const d in r)for(const g of r[d])c.push({stack:d,id:g});gt(c,({stack:d,id:g},y)=>{let x=this.entries[d];x||(x=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[g];if(void 0!==E)return void y(null,{stack:d,id:g,glyph:E});if(E=this._tinySDF(x,d,g),E)return x.glyphs[g]=E,void y(null,{stack:d,id:g,glyph:E});const D=Math.floor(g/256);if(256*D>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[D])return void y(null,{stack:d,id:g,glyph:E});let M=x.requests[D];M||(M=x.requests[D]=[],Tc.loadGlyphRange(d,D,this.url,this.requestManager,(A,k)=>{if(k){x.ascender=k.ascender,x.descender=k.descender;for(const F in k.glyphs)this._doesCharSupportLocalGlyph(+F)||(x.glyphs[+F]=k.glyphs[+F]);x.ranges[D]=!0}for(const F of M)F(A,k);delete x.requests[D]})),M.push((A,k)=>{A?y(A):k&&y(null,{stack:d,id:g,glyph:k.glyphs[g]||null})})},(d,g)=>{if(d)s(d);else if(g){const y={};for(const{stack:x,id:E,glyph:D}of g)void 0===y[x]&&(y[x]={}),void 0===y[x].glyphs&&(y[x].glyphs={}),y[x].glyphs[E]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;s(null,y)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Yd.none&&(this.localGlyphMode===Yd.all?!!this.localFontFamily:!!this.localFontFamily&&(su(r)||bd(r)||qa(r)||Sl(r)||ru(r)))}_tinySDF(r,s,c){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let g=r.tinySDF;if(!g){let G="400";/bold/i.test(s)?G="900":/medium/i.test(s)?G="500":/light/i.test(s)&&(G="200"),g=r.tinySDF=new Tc.TinySDF({fontFamily:d,fontWeight:G,fontSize:48,buffer:6,radius:16}),g.fontWeight=G}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const y=String.fromCharCode(c),{data:x,width:E,height:D,glyphWidth:M,glyphHeight:A,glyphLeft:k,glyphTop:F,glyphAdvance:U}=g.draw(y);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new Ta({width:E,height:D},x),metrics:{width:M/2,height:A/2,left:k/2,top:F/2-27,advance:U/2,localGlyph:!0}}}}function Dg(o,r,s,c){const d=[],g=o.image,y=g.pixelRatio,x=g.paddedRect.w-2,E=g.paddedRect.h-2,D=o.right-o.left,M=o.bottom-o.top,A=g.stretchX||[[0,x]],k=g.stretchY||[[0,E]],F=(Oe,He)=>Oe+He[1]-He[0],U=A.reduce(F,0),G=k.reduce(F,0),Z=x-U,Q=E-G;let ue=0,ye=U,be=0,Ee=G,Te=0,Be=Z,Ve=0,Ye=Q;if(g.content&&c){const Oe=g.content;ue=Pu(A,0,Oe[0]),be=Pu(k,0,Oe[1]),ye=Pu(A,Oe[0],Oe[2]),Ee=Pu(k,Oe[1],Oe[3]),Te=Oe[0]-ue,Ve=Oe[1]-be,Be=Oe[2]-Oe[0]-ye,Ye=Oe[3]-Oe[1]-Ee}const et=(Oe,He,ot,pt)=>{const ht=Tp(Oe.stretch-ue,ye,D,o.left),_t=Cp(Oe.fixed-Te,Be,Oe.stretch,U),dn=Tp(He.stretch-be,Ee,M,o.top),xn=Cp(He.fixed-Ve,Ye,He.stretch,G),ln=Tp(ot.stretch-ue,ye,D,o.left),nn=Cp(ot.fixed-Te,Be,ot.stretch,U),zt=Tp(pt.stretch-be,Ee,M,o.top),Mt=Cp(pt.fixed-Ve,Ye,pt.stretch,G),bn=new se(ht,dn),nr=new se(ln,dn),Wr=new se(ln,zt),pr=new se(ht,zt),Xr=new se(_t/y,xn/y),qn=new se(nn/y,Mt/y),Fn=r*Math.PI/180;if(Fn){const kr=Math.sin(Fn),Kr=Math.cos(Fn),Ei=[Kr,-kr,kr,Kr];bn._matMult(Ei),nr._matMult(Ei),pr._matMult(Ei),Wr._matMult(Ei)}const ir=Oe.stretch+Oe.fixed,Mr=He.stretch+He.fixed;return{tl:bn,tr:nr,bl:pr,br:Wr,tex:{x:g.paddedRect.x+1+ir,y:g.paddedRect.y+1+Mr,w:ot.stretch+ot.fixed-ir,h:pt.stretch+pt.fixed-Mr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xr,pixelOffsetBR:qn,minFontScaleX:Be/y/D,minFontScaleY:Ye/y/M,isSDF:s}};if(c&&(g.stretchX||g.stretchY)){const Oe=rv(A,Z,U),He=rv(k,Q,G);for(let ot=0;ot<Oe.length-1;ot++){const pt=Oe[ot],ht=Oe[ot+1];for(let _t=0;_t<He.length-1;_t++)d.push(et(pt,He[_t],ht,He[_t+1]))}}else d.push(et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return d}function Pu(o,r,s){let c=0;for(const d of o)c+=Math.max(r,Math.min(s,d[1]))-Math.max(r,Math.min(s,d[0]));return c}function rv(o,r,s){const c=[{fixed:-1,stretch:0}];for(const[d,g]of o){const y=c[c.length-1];c.push({fixed:d-y.stretch,stretch:y.stretch}),c.push({fixed:d-y.stretch,stretch:y.stretch+(g-d)})}return c.push({fixed:r+1,stretch:s}),c}function Tp(o,r,s,c){return o/r*s+c}function Cp(o,r,s,c){return o-r*s/c}function M0(o,r,s,c){const d=r+o.positionedLines[c].lineOffset;return 0===c?s+d/2:s+(d+(r+o.positionedLines[c-1].lineOffset))/2}Tc.loadGlyphRange=function(o,r,s,c,d){const g=256*r,y=g+255,x=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${g}-${y}`),K.Glyphs);Y(x,(E,D)=>{if(E)d(E);else if(D){const M={},A=new Ph(D).readFields(bg,{});for(const k of A.glyphs)M[k.id]=k;d(null,{glyphs:M,ascender:A.ascender,descender:A.descender})}})},Tc.TinySDF=class{constructor({fontSize:o=24,buffer:r=3,radius:s=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}){this.buffer=r,this.cutoff=c,this.radius=s;const x=this.size=o+4*r,E=this._createCanvas(x),D=this.ctx=E.getContext("2d",{willReadFrequently:!0});D.font=`${y} ${g} ${o}px ${d}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(o){const r=document.createElement("canvas");return r.width=r.height=o,r}draw(o){const{width:r,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(o),y=Math.floor(s),x=Math.min(this.size-this.buffer,Math.ceil(g-d)),E=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(c)),D=x+2*this.buffer,M=E+2*this.buffer,A=D*M,k=new Uint8ClampedArray(A),F={data:k,width:D,height:M,glyphWidth:x,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(0===x||0===E)return F;const{ctx:U,buffer:G,gridInner:Z,gridOuter:Q}=this;U.clearRect(G,G,x,E),U.fillText(o,G,G+y+1);const ue=U.getImageData(G,G,x,E);Q.fill(Kd,0,A),Z.fill(0,0,A);for(let ye=0;ye<E;ye++)for(let be=0;be<x;be++){const Ee=ue.data[4*(ye*x+be)+3]/255;if(0===Ee)continue;const Te=(ye+G)*D+be+G;if(1===Ee)Q[Te]=0,Z[Te]=Kd;else{const Be=.5-Ee;Q[Te]=Be>0?Be*Be:0,Z[Te]=Be<0?Be*Be:0}}Cg(Q,0,0,D,M,D,this.f,this.v,this.z),Cg(Z,G,G,x,E,D,this.f,this.v,this.z);for(let ye=0;ye<A;ye++){const be=Math.sqrt(Q[ye])-Math.sqrt(Z[ye]);k[ye]=Math.round(255-255*(be/this.radius+this.cutoff))}return F}};class A0{constructor(r=[],s=P0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:c}=this,d=s[r];for(;r>0;){const g=r-1>>1,y=s[g];if(c(d,y)>=0)break;s[r]=y,r=g}s[r]=d}_down(r){const{data:s,compare:c}=this,d=this.length>>1,g=s[r];for(;r<d;){let y=1+(r<<1),x=s[y];const E=y+1;if(E<this.length&&c(s[E],x)<0&&(y=E,x=s[E]),c(x,g)>=0)break;s[r]=x,r=y}s[r]=g}}function P0(o,r){return o<r?-1:o>r?1:0}function k0(o,r=1,s=!1){let c=1/0,d=1/0,g=-1/0,y=-1/0;const x=o[0];for(let F=0;F<x.length;F++){const U=x[F];(!F||U.x<c)&&(c=U.x),(!F||U.y<d)&&(d=U.y),(!F||U.x>g)&&(g=U.x),(!F||U.y>y)&&(y=U.y)}const E=Math.min(g-c,y-d);let D=E/2;const M=new A0([],R0);if(0===E)return new se(c,d);for(let F=c;F<g;F+=E)for(let U=d;U<y;U+=E)M.push(new Oh(F+D,U+D,D,o));let A=function(F){let U=0,G=0,Z=0;const Q=F[0];for(let ue=0,ye=Q.length,be=ye-1;ue<ye;be=ue++){const Ee=Q[ue],Te=Q[be],Be=Ee.x*Te.y-Te.x*Ee.y;G+=(Ee.x+Te.x)*Be,Z+=(Ee.y+Te.y)*Be,U+=3*Be}return new Oh(G/U,Z/U,0,F)}(o),k=M.length;for(;M.length;){const F=M.pop();(F.d>A.d||!A.d)&&(A=F,s&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,k)),F.max-A.d<=r||(D=F.h/2,M.push(new Oh(F.p.x-D,F.p.y-D,D,o)),M.push(new Oh(F.p.x+D,F.p.y-D,D,o)),M.push(new Oh(F.p.x-D,F.p.y+D,D,o)),M.push(new Oh(F.p.x+D,F.p.y+D,D,o)),k+=4)}return s&&(console.log(`num probes: ${k}`),console.log(`best distance: ${A.d}`)),A.p}function R0(o,r){return r.max-o.max}function Oh(o,r,s,c){this.p=new se(o,r),this.h=s,this.d=function(d,g){let y=!1,x=1/0;for(let E=0;E<g.length;E++){const D=g[E];for(let M=0,A=D.length,k=A-1;M<A;k=M++){const F=D[M],U=D[k];F.y>d.y!=U.y>d.y&&d.x<(U.x-F.x)*(d.y-F.y)/(U.y-F.y)+F.x&&(y=!y),x=Math.min(x,my(d,F,U))}}return(y?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const Sg=Number.POSITIVE_INFINITY,Bl=Math.sqrt(2);function Jd(o,r){return r[1]!==Sg?function(s,c,d){let g=0,y=0;switch(c=Math.abs(c),d=Math.abs(d),s){case"top-right":case"top-left":case"top":y=d-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-d}switch(s){case"top-right":case"bottom-right":case"right":g=-c;break;case"top-left":case"bottom-left":case"left":g=c}return[g,y]}(o,r[0],r[1]):function(s,c){let d=0,g=0;c<0&&(c=0);const y=c/Bl;switch(s){case"top-right":case"top-left":g=y-7;break;case"bottom-right":case"bottom-left":g=7-y;break;case"bottom":g=7-c;break;case"top":g=c-7}switch(s){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=c;break;case"right":d=-c}return[d,g]}(o,r[0])}function iv(o,r,s,c,d,g,y,x,E,D){o.createArrays(),o.tilePixelRatio=En/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const M=o.layers[0].layout,A=o.layers[0]._unevaluatedLayout._values,k={};if("composite"===o.textSizeData.kind){const{minZoom:G,maxZoom:Z}=o.textSizeData;k.compositeTextSizes=[A["text-size"].possiblyEvaluate(new Ir(G),x),A["text-size"].possiblyEvaluate(new Ir(Z),x)]}if("composite"===o.iconSizeData.kind){const{minZoom:G,maxZoom:Z}=o.iconSizeData;k.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new Ir(G),x),A["icon-size"].possiblyEvaluate(new Ir(Z),x)]}k.layoutTextSize=A["text-size"].possiblyEvaluate(new Ir(E+1),x),k.layoutIconSize=A["icon-size"].possiblyEvaluate(new Ir(E+1),x),k.textMaxSize=A["text-size"].possiblyEvaluate(new Ir(18),x);const F="map"===M.get("text-rotation-alignment")&&"point"!==M.get("symbol-placement"),U=M.get("text-size");for(const G of o.features){const Z=M.get("text-font").evaluate(G,{},x).join(","),Q=U.evaluate(G,{},x),ue=k.layoutTextSize.evaluate(G,{},x),ye=(k.layoutIconSize.evaluate(G,{},x),{horizontal:{},vertical:void 0}),be=G.text;let Ee,Te=[0,0];if(be){const Ye=be.toString(),et=24*M.get("text-letter-spacing").evaluate(G,{},x),Oe=24*M.get("text-line-height").evaluate(G,{},x),He=Ed(Ye)?et:0,ot=M.get("text-anchor").evaluate(G,{},x),pt=M.get("text-variable-anchor");if(!pt){const nn=M.get("text-radial-offset").evaluate(G,{},x);Te=nn?Jd(ot,[24*nn,Sg]):M.get("text-offset").evaluate(G,{},x).map(zt=>24*zt)}let ht=F?"center":M.get("text-justify").evaluate(G,{},x);const _t=M.get("symbol-placement"),dn="point"===_t,xn="point"===_t?24*M.get("text-max-width").evaluate(G,{},x):0,ln=nn=>{o.allowVerticalPlacement&&lu(Ye)&&(ye.vertical=hs(be,r,s,d,Z,xn,Oe,ot,nn,He,Te,Ko.vertical,!0,_t,ue,Q))};if(!F&&pt){const nn="auto"===ht?pt.map(Mt=>Qd(Mt)):[ht];let zt=!1;for(let Mt=0;Mt<nn.length;Mt++){const bn=nn[Mt];if(!ye.horizontal[bn])if(zt)ye.horizontal[bn]=ye.horizontal[0];else{const nr=hs(be,r,s,d,Z,xn,Oe,"center",bn,He,Te,Ko.horizontal,!1,_t,ue,Q);nr&&(ye.horizontal[bn]=nr,zt=1===nr.positionedLines.length)}}ln("left")}else{if("auto"===ht&&(ht=Qd(ot)),dn||M.get("text-writing-mode").indexOf("horizontal")>=0||!lu(Ye)){const nn=hs(be,r,s,d,Z,xn,Oe,ot,ht,He,Te,Ko.horizontal,!1,_t,ue,Q);nn&&(ye.horizontal[ht]=nn)}ln("point"===_t?"left":ht)}}let Be=!1;if(G.icon&&G.icon.name){const Ye=c[G.icon.name];Ye&&(Ee=Zd(d[G.icon.name],M.get("icon-offset").evaluate(G,{},x),M.get("icon-anchor").evaluate(G,{},x)),Be=Ye.sdf,void 0===o.sdfIcons?o.sdfIcons=Ye.sdf:o.sdfIcons!==Ye.sdf&&un("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==o.pixelRatio||0!==M.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const Ve=Ig(ye.horizontal)||ye.vertical;o.iconsInText||(o.iconsInText=!!Ve&&Ve.iconsInText),(Ve||Ee)&&Dp(o,G,ye,Ee,c,k,ue,0,Te,Be,y,x,D)}g&&o.generateCollisionDebugBuffers(E,o.collisionBoxArray)}function Qd(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dp(o,r,s,c,d,g,y,x,E,D,M,A,k){let F=g.textMaxSize.evaluate(r,{},A);void 0===F&&(F=y);const U=o.layers[0].layout,G=U.get("icon-offset").evaluate(r,{},A),Z=Ig(s.horizontal)||s.vertical,Q=y/24,ue=o.tilePixelRatio*F/24,ye=(Oe=o.overscaling,o.zoom>18&&Oe>2&&(Oe>>=1),Math.max(En/(512*Oe),1)*U.get("symbol-spacing")),be=U.get("text-padding")*o.tilePixelRatio,Ee=U.get("icon-padding")*o.tilePixelRatio,Te=ve(U.get("text-max-angle")),Be="map"===U.get("text-rotation-alignment")&&"point"!==U.get("symbol-placement"),Ve="map"===U.get("icon-rotation-alignment")&&"point"!==U.get("symbol-placement"),Ye=U.get("symbol-placement"),et=ye/2;var Oe;const He=U.get("icon-text-fit");let ot;c&&"none"!==He&&(o.allowVerticalPlacement&&s.vertical&&(ot=Rh(c,s.vertical,He,U.get("icon-text-fit-padding"),G,Q)),Z&&(c=Rh(c,Z,He,U.get("icon-text-fit-padding"),G,Q)));const pt=(ht,_t,dn)=>{if(_t.x<0||_t.x>=En||_t.y<0||_t.y>=En)return;const{x:xn,y:ln,z:nn}=k.projectTilePoint(_t.x,_t.y,dn),zt=new ia(xn,ln,nn,0,void 0);!function(Mt,bn,nr,Wr,pr,Xr,qn,Fn,ir,Mr,kr,Kr,Ei,Ro,wo,xr,lo,Oo,Ai,Ti,Br,Rr,Lo,Eo,ui){const co=Mt.addToLineVertexArray(bn,Wr);let uo,Pi,gs,Gl,Fu,Gh,Jg,bv=0,Qg=0,pf=0,mf=0,Xp=-1,e_=-1;const hl={};let wv=tl(""),Kp=0,gf=0;if(void 0===ir._unevaluatedLayout.getValue("text-radial-offset")?[Kp,gf]=ir.layout.get("text-offset").evaluate(Br,{},ui).map(Qo=>24*Qo):(Kp=24*ir.layout.get("text-radial-offset").evaluate(Br,{},ui),gf=Sg),Mt.allowVerticalPlacement&&pr.vertical){const Qo=pr.vertical;if(wo)Gh=tf(Qo),Fn&&(Jg=tf(Fn));else{const Fo=ir.layout.get("text-rotate").evaluate(Br,{},ui)+90;gs=oa(Mr,nr,bn,kr,Kr,Ei,Qo,Ro,Fo,xr),Fn&&(Gl=oa(Mr,nr,bn,kr,Kr,Ei,Fn,Oo,Fo))}}if(Xr){const Qo=ir.layout.get("icon-rotate").evaluate(Br,{},ui),Fo="none"!==ir.layout.get("icon-text-fit"),Hh=Dg(Xr,Qo,Lo,Fo),_f=Fn?Dg(Fn,Qo,Lo,Fo):void 0;Pi=oa(Mr,nr,bn,kr,Kr,Ei,Xr,Oo,Qo),bv=4*Hh.length;const qh=Mt.iconSizeData;let Oc=null;"source"===qh.kind?(Oc=[ta*ir.layout.get("icon-size").evaluate(Br,{},ui)],Oc[0]>al&&un(`${Mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===qh.kind&&(Oc=[ta*Rr.compositeIconSizes[0].evaluate(Br,{},ui),ta*Rr.compositeIconSizes[1].evaluate(Br,{},ui)],(Oc[0]>al||Oc[1]>al)&&un(`${Mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Mt.addSymbols(Mt.icon,Hh,Oc,Ti,Ai,Br,!1,nr,bn,co.lineStartIndex,co.lineLength,-1,Eo,ui),Xp=Mt.icon.placedSymbolArray.length-1,_f&&(Qg=4*_f.length,Mt.addSymbols(Mt.icon,_f,Oc,Ti,Ai,Br,Ko.vertical,nr,bn,co.lineStartIndex,co.lineLength,-1,Eo,ui),e_=Mt.icon.placedSymbolArray.length-1)}for(const Qo in pr.horizontal){const Fo=pr.horizontal[Qo];uo||(wv=tl(Fo.text),wo?Fu=tf(Fo):uo=oa(Mr,nr,bn,kr,Kr,Ei,Fo,Ro,ir.layout.get("text-rotate").evaluate(Br,{},ui),xr));const Hh=1===Fo.positionedLines.length;if(pf+=ef(Mt,nr,bn,Fo,qn,ir,wo,Br,xr,co,pr.vertical?Ko.horizontal:Ko.horizontalOnly,Hh?Object.keys(pr.horizontal):[Qo],hl,Xp,Rr,Eo,ui),Hh)break}pr.vertical&&(mf+=ef(Mt,nr,bn,pr.vertical,qn,ir,wo,Br,xr,co,Ko.vertical,["vertical"],hl,e_,Rr,Eo,ui));let Rc=-1;const Yp=(Qo,Fo)=>Qo?Math.max(Qo,Fo):Fo;Rc=Yp(Fu,Rc),Rc=Yp(Gh,Rc),Rc=Yp(Jg,Rc);const zu=Rc>-1?1:0;Mt.glyphOffsetArray.length>=Sa.MAX_GLYPHS&&un("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Br.sortKey&&Mt.addToSortKeyRanges(Mt.symbolInstances.length,Br.sortKey),Mt.symbolInstances.emplaceBack(nr.x,nr.y,nr.z,bn.x,bn.y,hl.right>=0?hl.right:-1,hl.center>=0?hl.center:-1,hl.left>=0?hl.left:-1,hl.vertical>=0?hl.vertical:-1,Xp,e_,wv,void 0!==uo?uo:Mt.collisionBoxArray.length,void 0!==uo?uo+1:Mt.collisionBoxArray.length,void 0!==gs?gs:Mt.collisionBoxArray.length,void 0!==gs?gs+1:Mt.collisionBoxArray.length,void 0!==Pi?Pi:Mt.collisionBoxArray.length,void 0!==Pi?Pi+1:Mt.collisionBoxArray.length,Gl||Mt.collisionBoxArray.length,Gl?Gl+1:Mt.collisionBoxArray.length,kr,pf,mf,bv,Qg,zu,0,Kp,gf,Rc)}(o,_t,zt,ht,s,c,d,ot,o.layers[0],o.collisionBoxArray,r.index,r.sourceLayerIndex,o.index,be,Be,E,0,Ee,Ve,G,r,g,D,M,A)};if("line"===Ye)for(const ht of Ep(r.geometry,0,0,En,En)){const _t=tv(ht,ye,Te,s.vertical||Z,c,24,ue,o.overscaling,En);for(const dn of _t){const xn=Z;xn&&ov(o,xn.text,et,dn)||pt(ht,dn,A)}}else if("line-center"===Ye){for(const ht of r.geometry)if(ht.length>1){const _t=ev(ht,Te,s.vertical||Z,c,24,ue);_t&&pt(ht,_t,A)}}else if("Polygon"===r.type)for(const ht of ap(r.geometry,0)){const _t=k0(ht,16);pt(ht[0],new ia(_t.x,_t.y,0,0,void 0),A)}else if("LineString"===r.type)for(const ht of r.geometry)pt(ht,new ia(ht[0].x,ht[0].y,0,0,void 0),A);else if("Point"===r.type)for(const ht of r.geometry)for(const _t of ht)pt([_t],new ia(_t.x,_t.y,0,0,void 0),A)}const al=32640;function ef(o,r,s,c,d,g,y,x,E,D,M,A,k,F,U,G,Z){const Q=function(be,Ee,Te,Be,Ve,Ye,et,Oe){const He=[];if(0===Ee.positionedLines.length)return He;const ot=Be.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,pt=function(ln){const nn=ln[0],zt=ln[1],Mt=nn*zt;return Mt>0?[nn,-zt]:Mt<0?[-nn,zt]:0===nn?[zt,nn]:[zt,-nn]}(Te);let ht=Math.abs(Ee.top-Ee.bottom);for(const ln of Ee.positionedLines)ht-=ln.lineOffset;const _t=Ee.positionedLines.length,dn=ht/_t;let xn=Ee.top-Te[1];for(let ln=0;ln<_t;++ln){const nn=Ee.positionedLines[ln];xn=M0(Ee,dn,xn,ln);for(const zt of nn.positionedGlyphs){if(!zt.rect)continue;const Mt=zt.rect||{};let bn=4,nr=!0,Wr=1,pr=0;if(zt.imageName){const Rr=et[zt.imageName];if(!Rr)continue;if(Rr.sdf){un("SDF images are not supported in formatted text and will be ignored.");continue}nr=!1,Wr=Rr.pixelRatio,bn=1/Wr}const Xr=(Ve||Oe)&&zt.vertical,qn=zt.metrics.advance*zt.scale/2,Fn=zt.metrics,ir=zt.rect;if(null===ir)continue;Oe&&Ee.verticalizable&&(pr=zt.imageName?qn-zt.metrics.width*zt.scale/2:0);const Mr=Ve?[zt.x+qn,zt.y]:[0,0];let kr=[0,0],Kr=[0,0],Ei=!1;Ve||(Xr?(Kr=[zt.x+qn+pt[0],zt.y+pt[1]-pr],Ei=!0):kr=[zt.x+qn+Te[0],zt.y+Te[1]-pr]);const Ro=ir.w*zt.scale/(Wr*(zt.localGlyph?2:1)),wo=ir.h*zt.scale/(Wr*(zt.localGlyph?2:1));let xr,lo,Oo,Ai;if(Xr){const Rr=zt.y-xn,Lo=new se(-qn,qn-Rr),Eo=-Math.PI/2,ui=new se(...Kr);xr=new se(-qn+kr[0],kr[1]),xr._rotateAround(Eo,Lo)._add(ui),xr.x+=-Rr+qn,xr.y-=(Fn.left-bn)*zt.scale;const co=zt.imageName?Fn.advance*zt.scale:24*zt.scale,uo=String.fromCharCode(zt.glyph);_p(uo)?xr.x+=(1-bn)*zt.scale:mg(uo)?xr.x+=co-Fn.height*zt.scale+(-bn-1)*zt.scale:xr.x+=zt.imageName||Fn.width+2*bn===ir.w&&Fn.height+2*bn===ir.h?(co-wo)/2:(co-(Fn.height+2*bn)*zt.scale)/2,lo=new se(xr.x,xr.y-Ro),Oo=new se(xr.x+wo,xr.y),Ai=new se(xr.x+wo,xr.y-Ro)}else{const Rr=(Fn.left-bn)*zt.scale-qn+kr[0],Lo=(-Fn.top-bn)*zt.scale+kr[1],Eo=Rr+Ro,ui=Lo+wo;xr=new se(Rr,Lo),lo=new se(Eo,Lo),Oo=new se(Rr,ui),Ai=new se(Eo,ui)}if(ot){let Rr;Rr=Ve?new se(0,0):Ei?new se(pt[0],pt[1]):new se(Te[0],Te[1]),xr._rotateAround(ot,Rr),lo._rotateAround(ot,Rr),Oo._rotateAround(ot,Rr),Ai._rotateAround(ot,Rr)}const Ti=new se(0,0),Br=new se(0,0);He.push({tl:xr,tr:lo,bl:Oo,br:Ai,tex:Mt,writingMode:Ee.writingMode,glyphOffset:Mr,sectionIndex:zt.sectionIndex,isSDF:nr,pixelOffsetTL:Ti,pixelOffsetBR:Br,minFontScaleX:0,minFontScaleY:0})}}return He}(0,c,E,g,y,x,d,o.allowVerticalPlacement),ue=o.textSizeData;let ye=null;"source"===ue.kind?(ye=[ta*g.layout.get("text-size").evaluate(x,{},Z)],ye[0]>al&&un(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ue.kind&&(ye=[ta*U.compositeTextSizes[0].evaluate(x,{},Z),ta*U.compositeTextSizes[1].evaluate(x,{},Z)],(ye[0]>al||ye[1]>al)&&un(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,Q,ye,E,y,x,M,r,s,D.lineStartIndex,D.lineLength,F,G,Z);for(const be of A)k[be]=o.text.placedSymbolArray.length-1;return 4*Q.length}function Ig(o){for(const r in o)return o[r];return null}function oa(o,r,s,c,d,g,y,x,E,D){let M=y.top,A=y.bottom,k=y.left,F=y.right;const U=y.collisionPadding;if(U&&(k-=U[0],M-=U[1],F+=U[2],A+=U[3]),E){const G=new se(k,M),Z=new se(F,M),Q=new se(k,A),ue=new se(F,A),ye=ve(E);let be=new se(0,0);D&&(be=new se(D[0],D[1])),G._rotateAround(ye,be),Z._rotateAround(ye,be),Q._rotateAround(ye,be),ue._rotateAround(ye,be),k=Math.min(G.x,Z.x,Q.x,ue.x),F=Math.max(G.x,Z.x,Q.x,ue.x),M=Math.min(G.y,Z.y,Q.y,ue.y),A=Math.max(G.y,Z.y,Q.y,ue.y)}return o.emplaceBack(r.x,r.y,r.z,s.x,s.y,k,M,F,A,x,c,d,g),o.length-1}function tf(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const r=o.bottom-o.top;return r>0?Math.max(10,r):null}function ov(o,r,s,c){const d=o.compareText;if(r in d){const g=d[r];for(let y=g.length-1;y>=0;y--)if(c.dist(g[y])<s)return!0}else d[r]=[];return d[r].push(c),!1}const Sp=Nl.VectorTileFeature.types,sv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lh(o,r,s,c,d,g,y,x,E,D,M,A,k,F,U,G){const Z=M?Math.min(al,Math.round(M[0])):0,Q=M?Math.min(al,Math.round(M[1])):0;o.emplaceBack(r,s,Math.round(32*y),Math.round(32*x),E,D,(Z<<1)+(A?1:0),Q,16*k,16*F,256*U,256*G,c,d,g,0)}function Ip(o,r,s){o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s),o.emplaceBack(r.x,r.y,s)}function av(o){for(const r of o.sections)if(Cd(r.text))return!0;return!1}class Cc{constructor(r){this.layoutVertexArray=new je,this.indexArray=new Ne,this.programConfigurations=r,this.segments=new ri,this.dynamicLayoutVertexArray=new he,this.opacityVertexArray=new mt,this.placedSymbolArray=new Po}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,s,c,d){this.isEmpty()||(c&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,xc.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,fg.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,sv,!0),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Rt(Cc);class Ul{constructor(r,s,c){this.layoutVertexArray=new r,this.layoutAttributes=s,this.indexArray=new c,this.segments=new ri,this.collisionVertexArray=new Lt,this.collisionVertexArrayExt=new he}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,pg.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,jy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Rt(Ul);class Sa{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ea([]),this.placementViewportMatrix=Ea([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bd(this.zoom,s["text-size"]),this.iconSizeData=Bd(this.zoom,s["icon-size"]);const c=this.layers[0].layout,d=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==d.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(y=>Ko[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new Cc(new hc(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Cc(new hc(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new tr,this.lineVertexArray=new qr,this.symbolInstances=new $n}calculateGlyphDependencies(r,s,c,d,g){for(let y=0;y<r.length;y++)if(s[r.charCodeAt(y)]=!0,d&&g){const x=Su[r.charAt(y)];x&&(s[x.charCodeAt(0)]=!0)}}populate(r,s,c,d){const g=this.layers[0],y=g.layout,x=y.get("text-font"),E=y.get("text-field"),D=y.get("icon-image"),M=("constant"!==E.value.kind||E.value.value instanceof Gr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),A="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,k=y.get("symbol-sort-key");if(this.features=[],!M&&!A)return;const F=s.iconDependencies,U=s.glyphDependencies,G=s.availableImages,Z=new Ir(this.zoom);for(const{feature:Q,id:ue,index:ye,sourceLayerIndex:be}of r){const Ee=g._featureFilter.needGeometry,Te=Ol(Q,Ee);if(!g._featureFilter.filter(Z,Te,c))continue;let Be,Ve;if(Ee||(Te.geometry=Rl(Q,c,d)),M){const et=g.getValueAndResolveTokens("text-field",Te,c,G),Oe=Gr.factory(et);av(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===uh()||this.hasRTLText&&oo.isParsed())&&(Be=jd(Oe,g,Te))}if(A){const et=g.getValueAndResolveTokens("icon-image",Te,c,G);Ve=et instanceof Cr?et:Cr.fromString(et)}if(!Be&&!Ve)continue;const Ye=this.sortFeaturesByKey?k.evaluate(Te,{},c):void 0;if(this.features.push({id:ue,text:Be,icon:Ve,index:ye,sourceLayerIndex:be,geometry:Te.geometry,properties:Q.properties,type:Sp[Q.type],sortKey:Ye}),Ve&&(F[Ve.name]=!0),Be){const et=x.evaluate(Te,{},c).join(","),Oe="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ko.vertical)>=0;for(const He of Be.sections)if(He.image)F[He.image.name]=!0;else{const ot=lu(Be.toString()),pt=He.fontStack||et,ht=U[pt]=U[pt]||{};this.calculateGlyphDependencies(He.text,ht,Oe,this.allowVerticalPlacement,ot)}}}"line"===y.get("symbol-placement")&&(this.features=function(Q){const ue={},ye={},be=[];let Ee=0;function Te(et){be.push(Q[et]),Ee++}function Be(et,Oe,He){const ot=ye[et];return delete ye[et],ye[Oe]=ot,be[ot].geometry[0].pop(),be[ot].geometry[0]=be[ot].geometry[0].concat(He[0]),ot}function Ve(et,Oe,He){const ot=ue[Oe];return delete ue[Oe],ue[et]=ot,be[ot].geometry[0].shift(),be[ot].geometry[0]=He[0].concat(be[ot].geometry[0]),ot}function Ye(et,Oe,He){const ot=He?Oe[0][Oe[0].length-1]:Oe[0][0];return`${et}:${ot.x}:${ot.y}`}for(let et=0;et<Q.length;et++){const Oe=Q[et],He=Oe.geometry,ot=Oe.text?Oe.text.toString():null;if(!ot){Te(et);continue}const pt=Ye(ot,He),ht=Ye(ot,He,!0);if(pt in ye&&ht in ue&&ye[pt]!==ue[ht]){const _t=Ve(pt,ht,He),dn=Be(pt,ht,be[_t].geometry);delete ue[pt],delete ye[ht],ye[Ye(ot,be[dn].geometry,!0)]=dn,be[_t].geometry=null}else pt in ye?Be(pt,ht,He):ht in ue?Ve(pt,ht,He):(Te(et),ue[pt]=Ee-1,ye[ht]=Ee-1)}return be.filter(et=>et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,ue)=>Q.sortKey-ue.sortKey)}update(r,s,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,s,this.layers,c,d),this.icon.programConfigurations.updatePaintArrays(r,s,this.layers,c,d))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,s){const c=this.lineVertexArray.length,d=r.segment;if(void 0!==d){let g=r.dist(s[d+1]),y=r.dist(s[d]);const x={};for(let E=d+1;E<s.length;E++)x[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:g},E<s.length-1&&(g+=s[E+1].dist(s[E]));for(let E=d||0;E>=0;E--)x[E]={x:s[E].x,y:s[E].y,tileUnitDistanceFromAnchor:y},E>0&&(y+=s[E-1].dist(s[E]));for(let E=0;E<s.length;E++){const D=x[E];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(r,s,c,d,g,y,x,E,D,M,A,k,F,U){const G=r.indexArray,Z=r.layoutVertexArray,Q=r.segments.prepareSegment(4*s.length,Z,G,this.canOverlap?y.sortKey:void 0),ue=this.glyphOffsetArray.length,ye=Q.vertexLength,be=this.allowVerticalPlacement&&x===Ko.vertical?Math.PI/2:0,Ee=y.text&&y.text.sections;for(let Te=0;Te<s.length;Te++){const{tl:Be,tr:Ve,bl:Ye,br:et,tex:Oe,pixelOffsetTL:He,pixelOffsetBR:ot,minFontScaleX:pt,minFontScaleY:ht,glyphOffset:_t,isSDF:dn,sectionIndex:xn}=s[Te],ln=Q.vertexLength,nn=_t[1];Lh(Z,E.x,E.y,E.z,D.x,D.y,Be.x,nn+Be.y,Oe.x,Oe.y,c,dn,He.x,He.y,pt,ht),Lh(Z,E.x,E.y,E.z,D.x,D.y,Ve.x,nn+Ve.y,Oe.x+Oe.w,Oe.y,c,dn,ot.x,He.y,pt,ht),Lh(Z,E.x,E.y,E.z,D.x,D.y,Ye.x,nn+Ye.y,Oe.x,Oe.y+Oe.h,c,dn,He.x,ot.y,pt,ht),Lh(Z,E.x,E.y,E.z,D.x,D.y,et.x,nn+et.y,Oe.x+Oe.w,Oe.y+Oe.h,c,dn,ot.x,ot.y,pt,ht),Ip(r.dynamicLayoutVertexArray,E,be),G.emplaceBack(ln,ln+1,ln+2),G.emplaceBack(ln+1,ln+2,ln+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_t[0]),Te!==s.length-1&&xn===s[Te+1].sectionIndex||r.programConfigurations.populatePaintArrays(Z.length,y,y.index,{},F,U,Ee&&Ee[xn])}r.placedSymbolArray.emplaceBack(E.x,E.y,E.z,D.x,D.y,ue,this.glyphOffsetArray.length-ue,ye,M,A,D.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],x,0,!1,0,k,0)}_commitLayoutVertex(r,s,c,d,g,y,x){r.emplaceBack(s,c,d,g,y,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,s,c,d,g,y,x){const E=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),D=E.vertexLength,M=x.tileAnchorX,A=x.tileAnchorY;for(let F=0;F<4;F++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(s,r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(s,r.padding,r.padding),c.collisionVertexArrayExt.emplaceBack(s,-r.padding,r.padding),this._commitLayoutVertex(c.layoutVertexArray,d,g,y,M,A,new se(r.x1,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,g,y,M,A,new se(r.x2,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,g,y,M,A,new se(r.x2,r.y2)),this._commitLayoutVertex(c.layoutVertexArray,d,g,y,M,A,new se(r.x1,r.y2)),E.vertexLength+=4;const k=c.indexArray;k.emplaceBack(D,D+1),k.emplaceBack(D+1,D+2),k.emplaceBack(D+2,D+3),k.emplaceBack(D+3,D),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,s,c,d,g,y){for(let x=d;x<g;x++){const E=c.get(x),D=this.getSymbolInstanceTextSize(r,y,s,x);this._addCollisionDebugVertices(E,D,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,s,c,d,g,y){for(let x=d;x<g;x++){const E=c.get(x),D=this.getSymbolInstanceIconSize(r,s,x);this._addCollisionDebugVertices(E,D,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ul(at,Ah.members,qt),this.iconCollisionBox=new Ul(at,Ah.members,qt);const c=bc(this.iconSizeData,r),d=bc(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(d,r,s,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(d,r,s,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,r,s,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,r,s,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(r,s,c,d){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:d),y=Du(this.textSizeData,r,g)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,s,c){const d=this.icon.placedSymbolArray.get(c),g=Du(this.iconSizeData,r,d);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,s,c){r.emplaceBack(s,-c,-c),r.emplaceBack(s,c,-c),r.emplaceBack(s,c,c),r.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(r,s,c,d,g,y){for(let x=d;x<g;x++){const E=c.get(x),D=this.getSymbolInstanceTextSize(r,y,s,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,E.padding)}}_updateIconDebugCollisionBoxes(r,s,c,d,g){for(let y=d;y<g;y++){const x=c.get(y),E=this.getSymbolInstanceIconSize(r,s,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,x.padding)}}updateCollisionDebugBuffers(r,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=bc(this.iconSizeData,r),d=bc(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(d,r,s,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(d,r,s,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(c,r,s,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,r,s,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,s,c,d,g,y,x,E,D){const M={};for(let A=s;A<c;A++){const k=r.get(A);M.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},M.textFeatureIndex=k.featureIndex;break}for(let A=d;A<g;A++){const k=r.get(A);M.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},M.verticalTextFeatureIndex=k.featureIndex;break}for(let A=y;A<x;A++){const k=r.get(A);M.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},M.iconFeatureIndex=k.featureIndex;break}for(let A=E;A<D;A++){const k=r.get(A);M.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},M.verticalIconFeatureIndex=k.featureIndex;break}return M}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,s){const c=r.placedSymbolArray.get(s),d=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<d;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(r),c=Math.cos(r),d=[],g=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const E=this.symbolInstances.get(x);d.push(0|Math.round(s*E.tileAnchorX+c*E.tileAnchorY)),g.push(E.featureIndex)}return y.sort((x,E)=>d[x]-d[E]||g[E]-g[x]),y}addToSortKeyRanges(r,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((d,g,y)=>{d>=0&&y.indexOf(d)===g&&this.addIndicesForPlacedSymbol(this.text,d)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Rt(Sa,{omit:["layers","collisionBoxArray","features","compareText"]}),Sa.MAX_GLYPHS=65535,Sa.addDynamicAttributes=Ip;const ku=new B({"symbol-placement":new C(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new C(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new C(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new S(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new C(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new C(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new C(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new C(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new C(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new S(ke.layout_symbol["icon-size"]),"icon-text-fit":new C(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new C(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new S(ke.layout_symbol["icon-image"]),"icon-rotate":new S(ke.layout_symbol["icon-rotate"]),"icon-padding":new C(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new C(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new S(ke.layout_symbol["icon-offset"]),"icon-anchor":new S(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new C(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new C(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new C(ke.layout_symbol["text-rotation-alignment"]),"text-field":new S(ke.layout_symbol["text-field"]),"text-font":new S(ke.layout_symbol["text-font"]),"text-size":new S(ke.layout_symbol["text-size"]),"text-max-width":new S(ke.layout_symbol["text-max-width"]),"text-line-height":new S(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new S(ke.layout_symbol["text-letter-spacing"]),"text-justify":new S(ke.layout_symbol["text-justify"]),"text-radial-offset":new S(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new C(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new S(ke.layout_symbol["text-anchor"]),"text-max-angle":new C(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new C(ke.layout_symbol["text-writing-mode"]),"text-rotate":new S(ke.layout_symbol["text-rotate"]),"text-padding":new C(ke.layout_symbol["text-padding"]),"text-keep-upright":new C(ke.layout_symbol["text-keep-upright"]),"text-transform":new S(ke.layout_symbol["text-transform"]),"text-offset":new S(ke.layout_symbol["text-offset"]),"text-allow-overlap":new C(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new C(ke.layout_symbol["text-ignore-placement"]),"text-optional":new C(ke.layout_symbol["text-optional"])});var Dc={paint:new B({"icon-opacity":new S(ke.paint_symbol["icon-opacity"]),"icon-color":new S(ke.paint_symbol["icon-color"]),"icon-halo-color":new S(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new S(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new S(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new C(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new C(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new S(ke.paint_symbol["text-opacity"]),"text-color":new S(ke.paint_symbol["text-color"],{runtimeType:yi,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new S(ke.paint_symbol["text-halo-color"]),"text-halo-width":new S(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new S(ke.paint_symbol["text-halo-blur"]),"text-translate":new C(ke.paint_symbol["text-translate"]),"text-translate-anchor":new C(ke.paint_symbol["text-translate-anchor"])}),layout:ku};class Sc{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Do,this.defaultValue=r}evaluate(r){if(r.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(r.formattedSection))return s.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rt(Sc,{omit:["defaultValue"]});class nf extends ea{constructor(r){super(r,Dc)}recalculate(r,s){super.recalculate(r,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const d=[];for(const g of c)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,s,c,d){const g=this.layout.get(r).evaluate(s,{},c,d),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||Tl(y.value)||!g?g:(x=s.properties,g.replace(/{([^{}]+)}/g,(D,M)=>M in x?String(x[M]):""));var x}createBucket(r){return new Sa(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Dc.paint.overridableProperties){if(!nf.hasPaintOverride(this.layout,r))continue;const s=this.paint.get(r),c=new Sc(s),d=new Kc(c,s.property.specification);let g=null;g="constant"===s.value.kind||"source"===s.value.kind?new Yc("source",d):new Wu("composite",d,s.value.zoomStops,s.value._interpolationType),this.paint._values[r]=new b(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(r,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&nf.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,s){const c=r.get("text-field"),d=Dc.paint.properties[s];let g=!1;const y=x=>{for(const E of x)if(d.overrides&&d.overrides.hasOverride(E))return void(g=!0)};if("constant"===c.value.kind&&c.value.value instanceof Gr)y(c.value.value.sections);else if("source"===c.value.kind){const x=D=>{g||(D instanceof jo&&gr(D.value)===is?y(D.value.sections):D instanceof Cs?y(D.sections):D.eachChild(x))},E=c.value;E._styleExpression&&x(E._styleExpression.expression)}return g}getProgramConfiguration(r){return new Qs(this,r)}}var Mg={paint:new B({"background-color":new C(ke.paint_background["background-color"]),"background-pattern":new R(ke.paint_background["background-pattern"]),"background-opacity":new C(ke.paint_background["background-opacity"])})},Ag={paint:new B({"raster-opacity":new C(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new C(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new C(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new C(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new C(ke.paint_raster["raster-saturation"]),"raster-contrast":new C(ke.paint_raster["raster-contrast"]),"raster-resampling":new C(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new C(ke.paint_raster["raster-fade-duration"])})};class Mp extends ea{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var Ap={paint:new B({"sky-type":new C(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new C(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new C(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new C(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new C(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new L(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new C(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new C(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new C(ke.paint_sky["sky-opacity"])})};function rf(o,r,s){const c=[0,0,1],d=Km([]);return function(g,y,x){x*=.5;var E=y[0],D=y[1],M=y[2],A=y[3],k=Math.sin(x),F=Math.cos(x);g[0]=E*F-M*k,g[1]=D*F+A*k,g[2]=M*F+E*k,g[3]=A*F-D*k}(d,d,s?-ve(o)+Math.PI:ve(o)),Ym(d,d,-ve(r)),xy(c,c,d),mu(c,c)}const of={circle:class extends ea{constructor(o){super(o,_y)}createBucket(o){return new Hf(o)}queryRadius(o){const r=o;return fc("circle-radius",this,r)+fc("circle-stroke-width",this,r)+yh(this.paint.get("circle-translate"))}queryIntersectsFeature(o,r,s,c,d,g,y,x){const E=Vm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s);return ep(o,c,g,y,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,D)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Qs(this,o)}},heatmap:class extends ea{createBucket(o){return new wi(o)}constructor(o){super(o,wy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=np({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return fc("heatmap-radius",this,o)}queryIntersectsFeature(o,r,s,c,d,g,y,x){const E=this.paint.get("heatmap-radius").evaluate(r,s);return ep(o,c,g,y,x,!0,!0,new se(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Qs(this,o)}},hillshade:class extends ea{constructor(o){super(o,Ey)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ea{constructor(o){super(o,Oy)}getProgramIds(){const o=this.paint.get("fill-pattern"),r=o&&o.constantOr(1),s=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new Qs(this,o)}recalculate(o,r){super.recalculate(o,r);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Fd(o)}queryRadius(){return yh(this.paint.get("fill-translate"))}queryIntersectsFeature(o,r,s,c,d,g){return!o.queryGeometry.isAboveHorizon&&gh(jm(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends ea{constructor(o){super(o,Ly)}createBucket(o){return new yc(o)}queryRadius(){return yh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Qs(this,o)}queryIntersectsFeature(o,r,s,c,d,g,y,x,E){const D=Vm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(r,s),A=this.paint.get("fill-extrusion-base").evaluate(r,s),k=[0,0],F=x&&g.elevation,U=g.elevation?g.elevation.exaggeration():1,G=o.tile.getBucket(this);if(F&&G instanceof yc){const ue=G.centroidVertexArray,ye=E+1;if(ye<ue.length){const be=ue.get(ye);k[0]=be.a_centroid_pos0,k[1]=be.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;const Z=(ue=c,ye=A,be=M,Ee=D,Te=y,(Be=F?x:null)?function(Oe,He,ot,pt,ht,_t,dn,xn,ln){const nn=[],zt=[],Mt=[0,0,0,1];for(const bn of Oe){const nr=[],Wr=[];for(const pr of bn){const Xr=pr.x+pt.x,qn=pr.y+pt.y,Fn=Fy(Xr,qn,He,ot,_t,dn,xn,ln);Mt[0]=Xr,Mt[1]=qn,Mt[2]=Fn.base,Mt[3]=1,bh(Mt,Mt,ht),Mt[3]=Math.max(Mt[3],1e-5);const ir=cg([Mt[0]/Mt[3],Mt[1]/Mt[3],Mt[2]/Mt[3]]);Mt[0]=Xr,Mt[1]=qn,Mt[2]=Fn.top,Mt[3]=1,bh(Mt,Mt,ht),Mt[3]=Math.max(Mt[3],1e-5);const Mr=cg([Mt[0]/Mt[3],Mt[1]/Mt[3],Mt[2]/Mt[3]]);nr.push(ir),Wr.push(Mr)}nn.push(nr),zt.push(Wr)}return[nn,zt]}(ue,ye,be,Ee,Te,Be,k,U,g.center.lat):function(Oe,He,ot,pt,ht){const _t=[],dn=[],xn=ht[8]*He,ln=ht[9]*He,nn=ht[10]*He,zt=ht[11]*He,Mt=ht[8]*ot,bn=ht[9]*ot,nr=ht[10]*ot,Wr=ht[11]*ot;for(const pr of Oe){const Xr=[],qn=[];for(const Fn of pr){const ir=Fn.x+pt.x,Mr=Fn.y+pt.y,kr=ht[0]*ir+ht[4]*Mr+ht[12],Kr=ht[1]*ir+ht[5]*Mr+ht[13],Ei=ht[2]*ir+ht[6]*Mr+ht[14],Ro=ht[3]*ir+ht[7]*Mr+ht[15],wo=kr+xn,xr=Kr+ln,lo=Ei+nn,Oo=Math.max(Ro+zt,1e-5),Ai=kr+Mt,Ti=Kr+bn,Br=Ei+nr,Rr=Math.max(Ro+Wr,1e-5),Lo=new se(wo/Oo,xr/Oo);Lo.z=lo/Oo,Xr.push(Lo);const Eo=new se(Ai/Rr,Ti/Rr);Eo.z=Br/Rr,qn.push(Eo)}_t.push(Xr),dn.push(qn)}return[_t,dn]}(ue,ye,be,Ee,Te)),Q=o.queryGeometry;var ue,ye,be,Ee,Te,Be;return function(ue,ye,be){let Ee=1/0;gh(be,ye)&&(Ee=lg(be,ye[0]));for(let Te=0;Te<ye.length;Te++){const Be=ye[Te],Ve=ue[Te];for(let Ye=0;Ye<Be.length-1;Ye++){const et=Be[Ye],Oe=[et,Be[Ye+1],Ve[Ye+1],Ve[Ye],et];Bm(be,Oe)&&(Ee=Math.min(Ee,lg(be,Oe)))}}return Ee!==1/0&&Ee}(Z[0],Z[1],Q.isPointQuery()?Q.screenBounds:Q.screenGeometry)}},line:class extends ea{constructor(o){super(o,dg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Tn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,r){super.recalculate(o,r),this.paint._values["line-floorwidth"]=mp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Cu(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Qs(this,o)}queryRadius(o){const r=o,s=gp(fc("line-width",this,r),fc("line-gap-width",this,r)),c=fc("line-offset",this,r);return s/2+Math.abs(c)+yh(this.paint.get("line-translate"))}queryIntersectsFeature(o,r,s,c,d,g){if(o.queryGeometry.isAboveHorizon)return!1;const y=jm(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),x=o.pixelToTileUnitsFactor/2*gp(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),E=this.paint.get("line-offset").evaluate(r,s);return E&&(c=function(D,M){const A=[],k=new se(0,0);for(let F=0;F<D.length;F++){const U=D[F],G=[];for(let Z=0;Z<U.length;Z++){const Q=U[Z-1],ue=U[Z],ye=U[Z+1],be=0===Z?k:ue.sub(Q)._unit()._perp(),Ee=Z===U.length-1?k:ye.sub(ue)._unit()._perp(),Te=be._add(Ee)._unit();Te._mult(1/(Te.x*Ee.x+Te.y*Ee.y)),G.push(Te._mult(M)._add(ue))}A.push(G)}return A}(c,E*o.pixelToTileUnitsFactor)),function(D,M,A){for(let k=0;k<M.length;k++){const F=M[k];if(D.length>=3)for(let U=0;U<F.length;U++)if(Fl(D,F[U]))return!0;if(qf(D,F,A))return!0}return!1}(y,c,x)}isTileClipped(){return!0}},symbol:nf,background:class extends ea{constructor(o){super(o,Mg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ea{constructor(o){super(o,Ag)}getProgramIds(){return["raster"]}},sky:class extends ea{constructor(o){super(o,Ap),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=np({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(o,r){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),d=!c,g=o.style.light,y=g.properties.get("position");return d&&"viewport"===g.properties.get("anchor")&&un("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?rf(y.azimuthal,90-y.polar,r):rf(c[0],90-c[1],r)}const s=this.paint.get("sky-gradient-center");return rf(s[0],90-s[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class Fh{constructor(r,s,c,d){this.context=r,this.format=c,this.texture=r.gl.createTexture(),this.update(s,d)}update(r,s,c){const{width:d,height:g}=r,{context:y}=this,{gl:x}=y,{HTMLImageElement:E,HTMLCanvasElement:D,HTMLVideoElement:M,ImageData:A,ImageBitmap:k}=ae;if(x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!s||!1!==s.premultiply)),c||this.size&&this.size[0]===d&&this.size[1]===g){const{x:F,y:U}=c||{x:0,y:0};r instanceof E||r instanceof D||r instanceof M||r instanceof A||k&&r instanceof k?x.texSubImage2D(x.TEXTURE_2D,0,F,U,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,F,U,d,g,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[d,g],r instanceof E||r instanceof D||r instanceof M||r instanceof A||k&&r instanceof k?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,d,g,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,s){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),r!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?r===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:r),this.filter=r),s!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class sf{constructor(r,s){this.width=r,this.height=s,this.nextRow=0,this.image=new Ta({width:r,height:s}),this.positions={},this.uploaded=!1}getDash(r,s){const c=this.getKey(r,s);return this.positions[c]}trim(){const r=this.width,s=this.height=Tt(this.nextRow);this.image.resize({width:r,height:s})}getKey(r,s){return r.join(",")+s}getDashRanges(r,s,c){const d=[];let g=r.length%2==1?-r[r.length-1]*c:0,y=r[0]*c,x=!0;d.push({left:g,right:y,isDash:x,zeroLength:0===r[0]});let E=r[0];for(let D=1;D<r.length;D++){x=!x;const M=r[D];g=E*c,E+=M,y=E*c,d.push({left:g,right:y,isDash:x,zeroLength:0===M})}return d}addRoundDash(r,s,c){const d=s/2;for(let g=-c;g<=c;g++){const y=this.width*(this.nextRow+c+g);let x=0,E=r[x];for(let D=0;D<this.width;D++){D/E.right>1&&(E=r[++x]);const M=Math.abs(D-E.left),A=Math.abs(D-E.right),k=Math.min(M,A);let F;const U=g/c*(d+1);if(E.isDash){const G=d-Math.abs(U);F=Math.sqrt(k*k+G*G)}else F=d-Math.sqrt(k*k+U*U);this.image.data[y+D]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(r,s){for(let E=r.length-1;E>=0;--E){const D=r[E],M=r[E+1];D.zeroLength?r.splice(E,1):M&&M.isDash===D.isDash&&(M.left=D.left,r.splice(E,1))}const c=r[0],d=r[r.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const g=this.width*this.nextRow;let y=0,x=r[y];for(let E=0;E<this.width;E++){E/x.right>1&&(x=r[++y]);const D=Math.abs(E-x.left),M=Math.abs(E-x.right),A=Math.min(D,M);this.image.data[g+E]=Math.max(0,Math.min(255,(x.isDash?A:-A)+s+128))}}addDash(r,s){const c=this.getKey(r,s);if(this.positions[c])return this.positions[c];const d="round"===s,g=d?7:0,y=2*g+1;if(this.nextRow+y>this.height)return un("LineAtlas out of space"),null;0===r.length&&r.push(1);let x=0;for(let M=0;M<r.length;M++)r[M]<0&&(un("Negative value is found in line dasharray, replacing values with 0"),r[M]=0),x+=r[M];if(0!==x){const M=this.width/x,A=this.getDashRanges(r,this.width,M);d?this.addRoundDash(A,M,g):this.addRegularDash(A,"square"===s?.5*M:0)}const E=this.nextRow+g;this.nextRow+=y;const D={tl:[E,g],br:[x,0]};return this.positions[c]=D,D}}Rt(sf);class O0{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const Pg=ae.performance;function Pp(o){const r=o?o.url.toString():void 0;return Pg.getEntriesByName(r)}class lv{constructor(){this.tasks={},this.taskQueue=[],tt(["process"],this),this.invoker=new O0(this.process),this.nextId=0}add(r,s){const c=this.nextId++,d=function({type:g,isSymbolTile:y,zoom:x}){return x=x||0,"message"===g?0:"maybePrepare"!==g||y?"parseTile"!==g||y?"parseTile"===g&&y?300-x:"maybePrepare"===g&&y?400-x:500:200-x:100-x}(s);if(0===d){Ct();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:r,metadata:s,priority:d,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){Ct();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const s=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let r=null,s=1/0;for(let d=0;d<this.taskQueue.length;d++){const g=this.tasks[this.taskQueue[d]];g.priority<s&&(s=g.priority,r=d)}if(null===r)return null;const c=this.taskQueue[r];return this.taskQueue.splice(r,1),c}remove(){this.invoker.remove()}}const kg=re([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),cv=re([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Rg}=kg,Yo=re([{name:"a_pos_3",components:3,type:"Int16"}]);var zh=re([{name:"a_pos",type:"Int16",components:2}]);const Ru=En/Math.PI/2,ds=-Ru,fs=Ru,Og=[new cs([ds,ds,ds],[fs,fs,fs]),new cs([ds,ds,ds],[0,0,fs]),new cs([0,ds,ds],[fs,0,fs]),new cs([ds,0,ds],[0,fs,fs]),new cs([0,0,ds],[fs,fs,fs])];class L0{constructor(r,s,c){this.a=zl([],r,c),this.b=zl([],s,c),this.center=c;const d=mu([],this.a),g=mu([],this.b);this.angle=Math.acos(gu(d,g))}}function kp(o,r){if(0===o.angle)return null;let s;return s=0===o.a[r]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[r]/o.a[r]/Math.sin(o.angle)-1/Math.tan(o.angle)),s<0||s>1?null:function(c,d,g,y){const x=Math.sin(g);return c*(Math.sin((1-y)*g)/x)+d*(Math.sin(y*g)/x)}(o.a[r],o.b[r],o.angle,De(s,0,1))+o.center[r]}function Ic(o){if(o.z<=1)return Og[o.z+2*o.y+o.x];const[r,s]=Rp(o),c=[ll(r[0],r[1]),ll(r[0],s[1]),ll(s[0],r[1]),ll(s[0],s[1])],d=[fs,fs,fs],g=[ds,ds,ds];for(const y of c)d[0]=Math.min(d[0],y[0]),d[1]=Math.min(d[1],y[1]),d[2]=Math.min(d[2],y[2]),g[0]=Math.max(g[0],y[0]),g[1]=Math.max(g[1],y[1]),g[2]=Math.max(g[2],y[2]);return new cs(d,g)}function Rp(o){const r=1<<o.z,s=o.x/r,c=(o.x+1)/r,d=(o.y+1)/r;return[[Ui(o.y/r),zs(s)],[Ui(d),zs(c)]]}function Fg(o,r,s,c=Ru){return s=ve(s),[o*Math.sin(s)*c,-r*c,o*Math.cos(s)*c]}function ll(o,r,s){return Fg(Math.cos(ve(o)),Math.sin(ve(o)),r,s)}function Op(o,r,s){const c=Math.pow(2,s.z),d=(o/En+s.x)/c;return ll(Ui((r/En+s.y)/c),zs(d))}function Lp(o){return 16383/Math.max(...zl([],o.max,o.min))}function Fp(o){const r=Ea(new Float64Array(16)),s=Lp(o);var c,d;return pc(r,r,[s,s,s]),pu(r,r,((c=[])[0]=-(d=o.min)[0],c[1]=-d[1],c[2]=-d[2],c)),r}function zg(o,r,s,c,d){const g=function(E){const D=En/(2*Math.PI);return E/(2*Math.PI)/D}(s),y=[o,r,-s/(2*Math.PI)],x=Ea(new Float64Array(16));return pu(x,x,y),pc(x,x,[g,g,g]),Gm(x,x,ve(-d)),Hm(x,x,ve(-c)),x}function Ng(o){const{x:r,y:s}=o.point,{lng:c,lat:d}=o._center;return zg(r,s,o.worldSize,c,d)}const zp=ve(85),Bg=Math.cos(zp),uv=Math.sin(zp);function sa(o,r,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,r*c-2*Math.PI*6378137/2]}class Ou{constructor(r,s,c){this.z=r,this.x=s,this.y=c,this.key=af(0,r,r,s,c)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,s){const c=(y=this.y,x=this.z,E=sa(256*(g=this.x),256*(y=Math.pow(2,x)-y-1),x),D=sa(256*(g+1),256*(y+1),x),E[0]+","+E[1]+","+D[0]+","+D[1]),d=function(g,y,x){let E,D="";for(let M=g;M>0;M--)E=1<<M-1,D+=(y&E?1:0)+(x&E?2:0);return D}(this.z,this.x,this.y);var g,y,x,E,D;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ug{constructor(r,s){this.wrap=r,this.canonical=s,this.key=af(r,s.z,s.z,s.x,s.y)}}class bo{constructor(r,s,c,d,g){this.overscaledZ=r,this.wrap=s,this.canonical=new Ou(c,+d,+g),this.key=0===s&&r===c?this.canonical.key:af(s,r,c,d,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const s=this.canonical.z-r;return r>this.canonical.z?new bo(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new bo(r,this.wrap,r,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(r,s=!0){if(this.overscaledZ===r&&s)return this.key;if(r>this.canonical.z)return af(this.wrap*+s,r,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-r;return af(this.wrap*+s,r,r,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const s=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>s&&r.canonical.y===this.canonical.y>>s}children(r){if(this.overscaledZ>=r)return[new bo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new bo(s,this.wrap,s,c,d),new bo(s,this.wrap,s,c+1,d),new bo(s,this.wrap,s,c,d+1),new bo(s,this.wrap,s,c+1,d+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new bo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new bo(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ug(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function af(o,r,s,c,d){const g=1<<Math.min(s,22);let y=g*(d%g)+c%g;return o&&s<22&&(y+=g*g*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*y+s)+(r-s)}function jl(o,r){if(!r.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:r};const s=Math.pow(2,-o.z),c=o.x*s,d=(o.x+1)*s,g=o.y*s,y=(o.y+1)*s,x=zs(c),E=zs(d),D=Ui(g),M=Ui(y),A=r.project(x,D),k=r.project(E,D),F=r.project(E,M),U=r.project(x,M);let G=Math.min(A.x,k.x,F.x,U.x),Z=Math.min(A.y,k.y,F.y,U.y),Q=Math.max(A.x,k.x,F.x,U.x),ue=Math.max(A.y,k.y,F.y,U.y);const ye=s/16;function be(Te,Be,Ve,Ye,et,Oe){const He=(Ve+et)/2,ot=(Ye+Oe)/2,pt=r.project(zs(He),Ui(ot)),ht=Math.max(0,G-pt.x,Z-pt.y,pt.x-Q,pt.y-ue);G=Math.min(G,pt.x),Q=Math.max(Q,pt.x),Z=Math.min(Z,pt.y),ue=Math.max(ue,pt.y),ht>ye&&(be(Te,pt,Ve,Ye,He,ot),be(pt,Be,He,ot,et,Oe))}be(A,k,c,g,d,g),be(k,F,d,g,d,y),be(F,U,d,y,c,y),be(U,A,c,y,c,g),G-=ye,Z-=ye,Q+=ye,ue+=ye;const Ee=1/Math.max(Q-G,ue-Z);return{scale:Ee,x:G*Ee,y:Z*Ee,x2:Q*Ee,y2:ue*Ee,projection:r}}Rt(Ou),Rt(bo,{omit:["projMatrix"]});class jg{constructor(r){this._stringToNumber={},this._numberToString=[];for(let s=0;s<r.length;s++){const c=r[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const hv=["tile","layer","source","sourceLayer","state"];class Vg{constructor(r,s,c,d,g){this.type="Feature",this._vectorTileFeature=r,this._z=s,this._x=c,this._y=d,this.properties=r.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(r.id=this.id);for(const s of hv)void 0!==this[s]&&(r[s]=this[s]);return r}}const Vl=new Uint16Array(8184);for(let o=0;o<2046;o++){let r=o+2,s=0,c=0,d=0,g=0,y=0,x=0;for(1&r?d=g=y=32:s=c=x=32;(r>>=1)>1;){const D=s+d>>1,M=c+g>>1;1&r?(d=s,g=c,s=y,c=x):(s=d,c=g,d=y,g=x),y=D,x=M}const E=4*o;Vl[E+0]=s,Vl[E+1]=c,Vl[E+2]=d,Vl[E+3]=g}const ps=new Uint16Array(2178),Ma=new Uint8Array(1089),lf=new Uint16Array(1089);function cf(o){return 0===o?-.03125:32===o?.03125:0}var uf=re([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Np={type:2,extent:En,loadGeometry:()=>[[new se(0,0),new se(8193,0),new se(8193,8193),new se(0,8193),new se(0,0)]]};class Bp{constructor(r,s,c,d,g){this.tileID=r,this.uid=Wt(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(r){const s=r+this.timeAdded;s<or.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=jl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,s,c){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(d,g){const y={};if(!g)return y;for(const x of d){const E=x.layerIds.map(D=>g.getLayer(D)).filter(Boolean);if(0!==E.length){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(D=>E.filter(M=>M.id===D)[0]));for(const D of E)y[D.id]=x}}return y}(r.buckets,s.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const g=this.buckets[d];if(g instanceof Sa){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const g=this.buckets[d];if(g instanceof Sa&&g.hasRTLText){this.hasRTLText=!0,oo.isLoading()||oo.isLoaded()||"deferred"!==uh()||cc();break}}this.queryPadding=0;for(const d in this.buckets){const g=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(d).queryRadius(g))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new xa}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(r)}const s=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Fh(r,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Fh(r,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Fh(r,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,s,c,d,g,y,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:x,transform:y,params:g,tileTransform:this.tileTransform},r,s,c):{}}querySourceFeatures(r,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),g=s?s.sourceLayer:"",y=d._geojsonTileLayer||d[g];if(!y)return;const x=Sr(s&&s.filter),{z:E,x:D,y:M}=this.tileID.canonical,A={z:E,x:D,y:M};for(let k=0;k<y.length;k++){const F=y.feature(k);if(x.needGeometry){const Z=Ol(F,!0);if(!x.filter(new Ir(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!x.filter(new Ir(this.tileID.overscaledZ),F))continue;const U=c.getId(F,g),G=new Vg(F,E,D,M,U);G.tile=A,r.push(G)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const s=this.expirationTime;if(r.cacheControl){const c=kn(r.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(s)if(this.expirationTime<s)d=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),d=s.style.listImages();for(const g in this.buckets){if(!s.style.hasLayer(g))continue;const y=this.buckets[g],x=y.layers[0].sourceLayer||"_geojsonTileLayer",E=c[x],D=r[x];if(!E||!D||0===Object.keys(D).length)continue;if(y.update(D,E,d,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof Cu||y instanceof Fd){const A=s.style._getSourceCache(y.layers[0].source);s._terrain&&s._terrain.enabled&&A&&y.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(A.id,this.tileID)}const M=s&&s.style&&s.style.getLayer(g);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<or.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=or.now()+r}setTexture(r,s){const c=s.context,d=c.gl;this.texture=s.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new Fh(c,r,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),c.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax))}setDependencies(r,s){const c={};for(const d of s)c[d]=!0;this.dependencies[r]=c}hasDependency(r,s){for(const c of r){const d=this.dependencies[c];if(d)for(const g of s)if(d[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const c=Rl(Np,this.tileID.canonical,this.tileTransform)[0],d=new te,g=new pn;for(let y=0;y<c.length;y++){const{x,y:E}=c[y];d.emplaceBack(x,E),g.emplaceBack(y)}g.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(d,zh.members),this._tileDebugSegments=ri.simpleSegment(0,0,d.length,g.length)}_makeTileBoundsBuffers(r,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const c=Rl(Np,this.tileID.canonical,this.tileTransform)[0];let d,g;if(this.isRaster){const y=function(x,E){const D=jl(x,E),M=Math.pow(2,x.z);for(let Z=0;Z<33;Z++)for(let Q=0;Q<33;Q++){const ue=zs((x.x+(Q+cf(Q))/32)/M),ye=Ui((x.y+(Z+cf(Z))/32)/M),be=E.project(ue,ye),Ee=33*Z+Q;ps[2*Ee+0]=Math.round((be.x*D.scale-D.x)*En),ps[2*Ee+1]=Math.round((be.y*D.scale-D.y)*En)}Ma.fill(0),lf.fill(0);for(let Z=2045;Z>=0;Z--){const Q=4*Z,ue=Vl[Q+0],ye=Vl[Q+1],be=Vl[Q+2],Ee=Vl[Q+3],Te=ue+be>>1,Be=ye+Ee>>1,Ve=Te+Be-ye,Ye=Be+ue-Te,et=33*ye+ue,Oe=33*Ee+be,He=33*Be+Te,ot=Math.hypot((ps[2*et+0]+ps[2*Oe+0])/2-ps[2*He+0],(ps[2*et+1]+ps[2*Oe+1])/2-ps[2*He+1])>=16;if(Ma[He]=Ma[He]||(ot?1:0),Z<1022){const pt=33*(ye+Ye>>1)+(ue+Ve>>1),ht=33*(Ee+Ye>>1)+(be+Ve>>1);Ma[He]=Ma[He]||Ma[pt]||Ma[ht]}}const A=new le,k=new Ne;let F=0;function U(Z,Q){const ue=33*Q+Z;return 0===lf[ue]&&(A.emplaceBack(ps[2*ue+0],ps[2*ue+1],Z*En/32,Q*En/32),lf[ue]=++F),lf[ue]-1}function G(Z,Q,ue,ye,be,Ee){const Te=Z+ue>>1,Be=Q+ye>>1;if(Math.abs(Z-be)+Math.abs(Q-Ee)>1&&Ma[33*Be+Te])G(be,Ee,Z,Q,Te,Be),G(ue,ye,be,Ee,Te,Be);else{const Ve=U(Z,Q),Ye=U(ue,ye),et=U(be,Ee);k.emplaceBack(Ve,Ye,et)}}return G(0,0,32,32,32,0),G(32,32,0,0,0,32),{vertices:A,indices:k}}(this.tileID.canonical,s);d=y.vertices,g=y.indices}else{d=new le,g=new Ne;for(const{x,y:E}of c)d.emplaceBack(x,E,0,0);const y=rp(d.int16,void 0,4);for(let x=0;x<y.length;x+=3)g.emplaceBack(y[x],y[x+1],y[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(d,uf.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(g),this._tileBoundsSegments=ri.simpleSegment(0,0,d.length,g.length)}_makeGlobeTileDebugBuffers(r,s){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!s||"globe"!==s.name)return;const c=this.tileID.canonical,d=Fp(Ic(c));this._makeGlobeTileDebugBorderBuffer(r,c,d),this._makeGlobeTileDebugTextBuffer(r,c,d)}_makeGlobeTileDebugBorderBuffer(r,s,c){const d=new te,g=new pn,y=new ie,x=(D,M,A,k,F)=>{const U=(A-D)/(F-1),G=(k-M)/(F-1),Z=d.length;for(let Q=0;Q<F;Q++){const ue=D+Q*U,ye=M+Q*G;d.emplaceBack(ue,ye);const be=Op(ue,ye,s),Ee=_u(be,be,c);y.emplaceBack(Ee[0],Ee[1],Ee[2]),g.emplaceBack(Z+Q)}},E=En;x(0,0,E,0,16),x(E,0,E,E,16),x(E,E,0,E,16),x(0,E,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(d,zh.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(y,Yo.members),this._tileDebugSegments=ri.simpleSegment(0,0,d.length,g.length)}_makeGlobeTileDebugTextBuffer(r,s,c){const d=new te,g=new Ne,y=new ie,x=25;g.reserve(32),d.reserve(x),y.reserve(x);const E=(D,M)=>x*D+M;for(let D=0;D<x;D++){const M=2048*D;for(let A=0;A<x;A++){const k=2048*A;d.emplaceBack(k,M);const F=Op(k,M,s),U=_u(F,F,c);y.emplaceBack(U[0],U[1],U[2])}}for(let D=0;D<4;D++)for(let M=0;M<4;M++){const A=E(D,M),k=E(D,M+1),F=E(D+1,M),U=E(D+1,M+1);g.emplaceBack(A,k,F),g.emplaceBack(F,k,U)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(g),this._tileDebugTextBuffer=r.createVertexBuffer(d,zh.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(y,Yo.members),this._tileDebugTextSegments=ri.simpleSegment(0,0,x,32)}}class dv{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,s,c){const d=String(s);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][d]=this.stateChanges[r][d]||{},en(this.stateChanges[r][d],c),null===this.deletedStates[r]){this.deletedStates[r]={};for(const g in this.state[r])g!==d&&(this.deletedStates[r][g]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][d]){this.deletedStates[r][d]={};for(const g in this.state[r][d])c[g]||(this.deletedStates[r][d][g]=null)}else for(const g in c)this.deletedStates[r]&&this.deletedStates[r][d]&&null===this.deletedStates[r][d][g]&&delete this.deletedStates[r][d][g]}removeFeatureState(r,s,c){if(null===this.deletedStates[r])return;const d=String(s);if(this.deletedStates[r]=this.deletedStates[r]||{},c&&void 0!==s)null!==this.deletedStates[r][d]&&(this.deletedStates[r][d]=this.deletedStates[r][d]||{},this.deletedStates[r][d][c]=null);else if(void 0!==s)if(this.stateChanges[r]&&this.stateChanges[r][d])for(c in this.deletedStates[r][d]={},this.stateChanges[r][d])this.deletedStates[r][d][c]=null;else this.deletedStates[r][d]=null;else this.deletedStates[r]=null}getState(r,s){const c=String(s),d=en({},(this.state[r]||{})[c],(this.stateChanges[r]||{})[c]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const g=this.deletedStates[r][s];if(null===g)return{};for(const y in g)delete d[y]}return d}initializeTileState(r,s){r.setFeatureState(this.state,s)}coalesceChanges(r,s){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const g={};for(const y in this.stateChanges[d])this.state[d][y]||(this.state[d][y]={}),en(this.state[d][y],this.stateChanges[d][y]),g[y]=this.state[d][y];c[d]=g}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const g={};if(null===this.deletedStates[d])for(const y in this.state[d])g[y]={},this.state[d][y]={};else for(const y in this.deletedStates[d]){if(null===this.deletedStates[d][y])this.state[d][y]={};else for(const x of Object.keys(this.deletedStates[d][y]))delete this.state[d][y][x];g[y]=this.state[d][y]}c[d]=c[d]||{},en(c[d],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const d in r)r[d].setFeatureState(c,s)}}class hf{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,s){const c=this.toIdx(r,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(r,s){return this.leaves[this.toIdx(r,s)]}toIdx(r,s){return s*this.size+r}}function fv(o,r,s,c){let d=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(c[y])<1e-15){if(s[y]<o[y]||s[y]>r[y])return null}else{const x=1/c[y];let E=(o[y]-s[y])*x,D=(r[y]-s[y])*x;if(E>D){const M=E;E=D,D=M}if(E>d&&(d=E),D<g&&(g=D),d>g)return null}return d}function $g(o,r,s,c,d,g,y,x,E,D,M){const A=c-o,k=d-r,F=g-s,U=y-o,G=x-r,Z=E-s,Q=M[1]*Z-M[2]*G,ue=M[2]*U-M[0]*Z,ye=M[0]*G-M[1]*U,be=A*Q+k*ue+F*ye;if(Math.abs(be)<1e-15)return null;const Ee=1/be,Te=D[0]-o,Be=D[1]-r,Ve=D[2]-s,Ye=(Te*Q+Be*ue+Ve*ye)*Ee;if(Ye<0||Ye>1)return null;const et=Be*F-Ve*k,Oe=Ve*A-Te*F,He=Te*k-Be*A,ot=(M[0]*et+M[1]*Oe+M[2]*He)*Ee;return ot<0||Ye+ot>1?null:(U*et+G*Oe+Z*He)*Ee}function Up(o,r,s){return(o-r)/(s-r)}function jp(o,r,s,c,d,g,y,x,E){const D=1<<s,M=g-c,A=y-d,k=(o+1)/D*M+c,F=(r+0)/D*A+d,U=(r+1)/D*A+d;x[0]=(o+0)/D*M+c,x[1]=F,E[0]=k,E[1]=U}class Vp{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const y=Math.ceil(Math.log2(g.dim/8)),x=[];let E=Math.ceil(Math.pow(2,y));const D=1/E,M=(F,U,G,Z,Q)=>{const ue=Z?1:0,ye=(F+1)*G-ue,be=U*G,Ee=(U+1)*G-ue;Q[0]=F*G,Q[1]=be,Q[2]=ye,Q[3]=Ee};let A=new hf(E);const k=[];for(let F=0;F<E*E;F++){M(F%E,Math.floor(F/E),D,!1,k);const U=cl(k[0],k[1],g),G=cl(k[2],k[1],g),Z=cl(k[2],k[3],g),Q=cl(k[0],k[3],g);A.minimums.push(Math.min(U,G,Z,Q)),A.maximums.push(Math.max(U,G,Z,Q)),A.leaves.push(1)}for(x.push(A),E/=2;E>=1;E/=2){const F=x[x.length-1];A=new hf(E);for(let U=0;U<E*E;U++){M(U%E,Math.floor(U/E),2,!0,k);const G=F.getElevation(k[0],k[1]),Z=F.getElevation(k[2],k[1]),Q=F.getElevation(k[2],k[3]),ue=F.getElevation(k[0],k[3]),ye=F.isLeaf(k[0],k[1]),be=F.isLeaf(k[2],k[1]),Ee=F.isLeaf(k[2],k[3]),Te=F.isLeaf(k[0],k[3]),Be=Math.min(G.min,Z.min,Q.min,ue.min),Ve=Math.max(G.max,Z.max,Q.max,ue.max),Ye=ye&&be&&Ee&&Te;A.maximums.push(Ve),A.minimums.push(Be),A.leaves.push(Ve-Be<=5&&Ye?1:0)}x.push(A)}return x}(this.dem),c=s.length-1,d=s[c];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(r,s,c,d,g,y,x=1){return fv([r,s,-100],[c,d,this.maximums[0]*x],g,y)}raycast(r,s,c,d,g,y,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,s,c,d,g,y,x);if(null==E)return null;const D=[],M=[],A=[],k=[],F=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:U,t:G,nodex:Z,nodey:Q,depth:ue}=F.pop();if(this.leaves[U]){jp(Z,Q,ue,r,s,c,d,A,k);const be=1<<ue,Ee=(Z+0)/be,Te=(Z+1)/be,Be=(Q+0)/be,Ve=(Q+1)/be,Ye=cl(Ee,Be,this.dem)*x,et=cl(Te,Be,this.dem)*x,Oe=cl(Te,Ve,this.dem)*x,He=cl(Ee,Ve,this.dem)*x,ot=$g(A[0],A[1],Ye,k[0],A[1],et,k[0],k[1],Oe,g,y),pt=$g(k[0],k[1],Oe,A[0],k[1],He,A[0],A[1],Ye,g,y),ht=Math.min(null!==ot?ot:Number.MAX_VALUE,null!==pt?pt:Number.MAX_VALUE);if(ht!==Number.MAX_VALUE)return ht;{const _t=Pd([],g,y,G);if($p(Ye,et,He,Oe,Up(_t[0],A[0],k[0]),Up(_t[1],A[1],k[1]))>=_t[2])return G}continue}let ye=0;for(let be=0;be<this._siblingOffset.length;be++){jp((Z<<1)+this._siblingOffset[be][0],(Q<<1)+this._siblingOffset[be][1],ue+1,r,s,c,d,A,k),A[2]=-100,k[2]=this.maximums[this.childOffsets[U]+be]*x;const Ee=fv(A,k,g,y);if(null!=Ee){const Te=Ee;D[be]=Te;let Be=!1;for(let Ve=0;Ve<ye&&!Be;Ve++)Te>=D[M[Ve]]&&(M.splice(Ve,0,be),Be=!0);Be||(M[ye]=be),ye++}}for(let be=0;be<ye;be++){const Ee=M[be];F.push({idx:this.childOffsets[U]+Ee,t:D[Ee],nodex:(Z<<1)+this._siblingOffset[Ee][0],nodey:(Q<<1)+this._siblingOffset[Ee][1],depth:ue+1})}}return null}_addNode(r,s,c){return this.minimums.push(r),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(r,s,c,d,g){if(1===r[d].isLeaf(s,c))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=d-1,x=r[y];let E=0,D=0;for(let M=0;M<this._siblingOffset.length;M++){const A=2*s+this._siblingOffset[M][0],k=2*c+this._siblingOffset[M][1],F=x.getElevation(A,k),U=x.isLeaf(A,k),G=this._addNode(F.min,F.max,U);U&&(E|=1<<M),D||(D=G)}for(let M=0;M<this._siblingOffset.length;M++)E&1<<M||this._construct(r,2*s+this._siblingOffset[M][0],2*c+this._siblingOffset[M][1],y,D+M)}}function $p(o,r,s,c,d,g){return bt(bt(o,s,g),bt(r,c,g),d)}function cl(o,r,s){const c=s.dim,d=De(o*c-.5,0,c-1),g=De(r*c-.5,0,c-1),y=Math.floor(d),x=Math.floor(g),E=Math.min(y+1,c-1),D=Math.min(x+1,c-1);return $p(s.get(y,x),s.get(E,x),s.get(y,D),s.get(E,D),d-y,g-x)}const Aa={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Mc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,s,c,d=!1,g=!1){if(this.uid=r,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return un(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const y=this.dim=s.height-2,x=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=d,!d){for(let E=0;E<y;E++)x[this._idx(-1,E)]=x[this._idx(0,E)],x[this._idx(y,E)]=x[this._idx(y-1,E)],x[this._idx(E,-1)]=x[this._idx(E,0)],x[this._idx(E,y)]=x[this._idx(E,y-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(y,-1)]=x[this._idx(y-1,0)],x[this._idx(-1,y)]=x[this._idx(0,y-1)],x[this._idx(y,y)]=x[this._idx(y-1,y-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Vp(this)}get(r,s,c=!1){c&&(r=De(r,-1,this.dim),s=De(s,-1,this.dim));const d=4*this._idx(r,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[d],this.pixels[d+1],this.pixels[d+2])}static getUnpackVector(r){return Aa[r]}get unpackVector(){return Aa[this.encoding]}_idx(r,s){if(r<-1||r>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(r+1)}_unpackMapbox(r,s,c){return(256*r*256+256*s+c)/10-1e4}_unpackTerrarium(r,s,c){return 256*r+s+c/256-32768}static pack(r,s){const c=[0,0,0,0],d=Mc.getUnpackVector(s);let g=Math.floor((r+d[3])/d[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new Xo({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,s,c){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,g=s*this.dim+this.dim,y=c*this.dim,x=c*this.dim+this.dim;switch(s){case-1:d=g-1;break;case 1:g=d+1}switch(c){case-1:y=x-1;break;case 1:x=y+1}const E=-s*this.dim,D=-c*this.dim;for(let M=y;M<x;M++)for(let A=d;A<g;A++){const k=4*this._idx(A,M),F=4*this._idx(A+E,M+D);this.pixels[k+0]=r.pixels[F+0],this.pixels[k+1]=r.pixels[F+1],this.pixels[k+2]=r.pixels[F+2],this.pixels[k+3]=r.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Rt(Mc),Rt(Vp,{omit:["dem"]});class pv{constructor(r,s){this.max=r,this.onRemove=s,this.reset()}reset(){for(const r in this.data)for(const s of this.data[r])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(r,s,c){const d=r.wrapped().key;void 0===this.data[d]&&(this.data[d]=[]);const g={value:s,timeout:void 0};if(void 0!==c&&(g.timeout=setTimeout(()=>{this.remove(r,g)},c)),this.data[d].push(g),this.order.push(d),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const s=this.data[r].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),s.value}getByKey(r){const s=this.data[r];return s?s[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,s){if(!this.has(r))return this;const c=r.wrapped().key,d=void 0===s?0:this.data[c].indexOf(s),g=this.data[c][d];return this.data[c].splice(d,1),g.timeout&&clearTimeout(g.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(r){const s=[];for(const c in this.data)for(const d of this.data[c])r(d.value)||s.push(d);for(const c of s)this.remove(c.value.tileID,c)}}class Lu{constructor(r,s,c){this.func=r,this.mask=s,this.range=c}}Lu.ReadOnly=!1,Lu.ReadWrite=!0,Lu.disabled=new Lu(519,Lu.ReadOnly,[0,1]);class Nh{constructor(r,s,c,d,g,y){this.test=r,this.ref=s,this.mask=c,this.fail=d,this.depthFail=g,this.pass=y}}Nh.disabled=new Nh({func:519,mask:0},0,0,7680,7680,7680);class aa{constructor(r,s,c){this.blendFunction=r,this.blendColor=s,this.mask=c}}aa.Replace=[1,0],aa.disabled=new aa(aa.Replace,jn.transparent,[!1,!1,!1,!1]),aa.unblended=new aa(aa.Replace,jn.transparent,[!0,!0,!0,!0]),aa.alphaBlended=new aa([1,771],jn.transparent,[!0,!0,!0,!0]);class la{constructor(r,s,c){this.enable=r,this.mode=s,this.frontFace=c}}la.disabled=new la(!1,1029,2305),la.backCCW=new la(!0,1029,2305),la.backCW=new la(!0,1029,2304),la.frontCW=new la(!0,1028,2304),la.frontCCW=new la(!0,1028,2305);class ul extends Xt{constructor(r,s,c){super(),this.id=r,this._onlySymbols=c,s.on("data",d=>{"source"===d.dataType&&"metadata"===d.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===d.dataType&&"content"===d.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new pv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new dv,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const s=this._tiles[r];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,s){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,s)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const s in this._tiles){const c=this._tiles[s];this._source.prepareTile(c)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,c.tileID),c.upload(r),c.prepare(this.map.style.imageManager)}else for(const s in this._tiles){const c=this._tiles[s];c.upload(r),c.prepare(this.map.style.imageManager)}}getIds(){return Kt(this._tiles).map(r=>r.tileID).sort(Gp).map(r=>r.key)}getRenderableIds(r){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,r)&&s.push(this._tiles[c]);return r?s.sort((c,d)=>{const g=c.tileID,y=d.tileID,x=new se(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),E=new se(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-y.overscaledZ||E.y-x.y||E.x-x.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Gp).map(c=>c.key)}hasRenderableParent(r){const s=this.findLoadedParent(r,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(r,s){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(s||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,s){const c=this._tiles[r];c&&("loading"!==c.state&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,r,s)))}_tileLoaded(r,s,c,d){if(d)if(r.state="errored",404!==d.status)this._source.fire(new Ut(d,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=or.now(),"expired"===c&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(s,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Bt("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const s=this.getRenderableIds();for(let d=0;d<s.length;d++){const g=s[d];if(r.neighboringTiles&&r.neighboringTiles[g]){const y=this.getTileByID(g);c(r,y),c(y,r)}}function c(d,g){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let y=g.tileID.canonical.x-d.tileID.canonical.x;const x=g.tileID.canonical.y-d.tileID.canonical.y,E=Math.pow(2,d.tileID.canonical.z),D=g.tileID.key;0===y&&0===x||Math.abs(x)>1||(Math.abs(y)>1&&(1===Math.abs(y+E)?y+=E:1===Math.abs(y-E)&&(y-=E)),g.dem&&d.dem&&(d.dem.backfillBorder(g.dem,y,x),d.neighboringTiles&&d.neighboringTiles[D]&&(d.neighboringTiles[D].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,s,c,d){for(const g in this._tiles){let y=this._tiles[g];if(d[g]||!y.hasData()||y.tileID.overscaledZ<=s||y.tileID.overscaledZ>c)continue;let x=y.tileID;for(;y&&y.tileID.overscaledZ>s+1;){const D=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[D.key],y&&y.hasData()&&(x=D)}let E=x;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),r[E.key]){d[x.key]=x;break}}}findLoadedParent(r,s){if(r.key in this._loadedParentTiles){const c=this._loadedParentTiles[r.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=r.overscaledZ-1;c>=s;c--){const d=r.scaledTo(c),g=this._getLoadedTile(d);if(g)return g}}_getLoadedTile(r){const s=this._tiles[r.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,s){s=s||this._source.tileSize;const c=Math.ceil(r.width/s)+1,d=Math.ceil(r.height/s)+1,g=Math.floor(c*d*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(r){const s=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,s){const c={};for(const d in this._tiles){const g=this._tiles[d];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(r,s,c){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let d;this.updateCacheSize(r,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new bo(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(d=r.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(x=>this._source.hasTile(x)))):d=[];const g=this._updateRetainedTiles(d);if(Hp(this._source.type)&&0!==d.length){const x={},E={},D=Object.keys(g);for(const A of D){const k=g[A],F=this._tiles[A];if(!F||F.fadeEndTime&&F.fadeEndTime<=or.now())continue;const U=this.findLoadedParent(k,Math.max(k.overscaledZ-ul.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),x[U.tileID.key]=U.tileID),E[A]=k}const M=d[d.length-1].overscaledZ;for(const A in this._tiles){const k=this._tiles[A];if(g[A]||!k.hasData())continue;let F=k.tileID;for(;F.overscaledZ>M;){F=F.scaledTo(F.overscaledZ-1);const U=this._tiles[F.key];if(U&&U.hasData()&&E[F.key]){g[A]=k.tileID;break}}}for(const A in x)g[A]||(this._coveredTiles[A]=!0,g[A]=x[A])}for(const x in g)this._tiles[x].clearFadeHold();const y=function(x,E){const D=[];for(const M in x)M in E||D.push(M);return D}(this._tiles,g);for(const x of y){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const s={};if(0===r.length)return s;const c={},d=r.reduce((D,M)=>Math.min(D,M.overscaledZ),1/0),g=r[0].overscaledZ,y=Math.max(g-ul.maxOverzooming,this._source.minzoom),x=Math.max(g+ul.maxUnderzooming,this._source.minzoom),E={};for(const D of r){const M=this._addTile(D);s[D.key]=D,M.hasData()||d<this._source.maxzoom&&(E[D.key]=D)}this._retainLoadedChildren(E,d,x,s);for(const D of r){let M=this._tiles[D.key];if(M.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const k=D.children(this._source.maxzoom)[0],F=this.getTile(k);if(F&&F.hasData()){s[k.key]=k;continue}}else{const k=D.children(this._source.maxzoom);if(s[k[0].key]&&s[k[1].key]&&s[k[2].key]&&s[k[3].key])continue}let A=M.wasRequested();for(let k=D.overscaledZ-1;k>=y;--k){const F=D.scaledTo(k);if(c[F.key]||(c[F.key]=!0,M=this.getTile(F),!M&&A&&(M=this._addTile(F)),M&&(s[F.key]=F,A=M.wasRequested(),M.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const s=[];let c,d=this._tiles[r].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}s.push(d.key);const g=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;d=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(r){let s=this._tiles[r.key];if(s)return this._source.prepareTile&&this._source.prepareTile(s),s;s=this._cache.getAndRemove(r),s&&(this._setTileReloadTimer(r.key,s),s.tileID=r,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,s)));const c=Boolean(s);if(!c){const d=this.map?this.map.painter:null;s=new Bp(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,d,this._isRaster),this._source.prepareTile&&this._source.prepareTile(s)||this._loadTile(s,this._tileLoaded.bind(this,s,r.key,s.state))}return s?(s.uses++,this._tiles[r.key]=s,c||this._source.fire(new Bt("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(r,s){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const c=s.getExpiryTimeout();c&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},c))}_removeTile(r){const s=this._tiles[r];s&&(s.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,s,c){const d=[],g=this.transform;if(!g)return d;for(const y in this._tiles){const x=this._tiles[y];if(c&&x.clearQueryDebugViz(),x.holdingForFade())continue;const E=r.containsTile(x,g,s);E&&d.push(E)}return d}getVisibleCoordinates(r){const s=this.getRenderableIds(r).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Hp(this._source.type))for(const r in this._tiles){const s=this._tiles[r];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=or.now())return!0}return!1}setFeatureState(r,s,c){this._state.updateState(r=r||"_geojsonTileLayer",s,c)}removeFeatureState(r,s,c){this._state.removeFeatureState(r=r||"_geojsonTileLayer",s,c)}getFeatureState(r,s){return this._state.getState(r=r||"_geojsonTileLayer",s)}setDependencies(r,s,c){const d=this._tiles[r];d&&d.setDependencies(s,c)}reloadTilesForDependencies(r,s){for(const c in this._tiles)this._tiles[c].hasDependency(r,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(r,s))}_preloadTiles(r,s){const c=new Map,d=Array.isArray(r)?r:[r],g=this.map.painter.terrain,y=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const x of d){const E=x.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of E)c.set(D.key,D);this.usedForTerrain&&x.updateElevation(!1)}gt(Array.from(c.values()),(x,E)=>{const D=new Bp(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,M=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),E(M,D)})},s)}}function Gp(o,r){const s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*r.wrap)-+(r.wrap<0);return o.overscaledZ-r.overscaledZ||c-s||r.canonical.y-o.canonical.y||r.canonical.x-o.canonical.x}function Hp(o){return"raster"===o||"image"===o||"video"===o}ul.maxOverzooming=10,ul.maxUnderzooming=3;class Uh{constructor(r,s,c){this._demTile=r,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(r,s,c){const d=c||r.findDEMTileFor(s);if(!d||!d.dem)return;const g=d.dem,y=d.tileID,x=1<<s.canonical.z-y.canonical.z;return new Uh(d,d.tileSize/En/x,[(s.canonical.x/x-y.canonical.x)*g.dim,(s.canonical.y/x-y.canonical.y)*g.dim])}tileCoordToPixel(r,s){const c=s*this._scale+this._offset[1],d=Math.floor(r*this._scale+this._offset[0]),g=Math.floor(c);return new se(d,g)}getElevationAt(r,s,c,d){const g=r*this._scale+this._offset[0],y=s*this._scale+this._offset[1],x=Math.floor(g),E=Math.floor(y),D=this._dem;return d=!!d,c?bt(bt(D.get(x,E,d),D.get(x,E+1,d),y-E),bt(D.get(x+1,E,d),D.get(x+1,E+1,d),y-E),g-x):D.get(x,E,d)}getElevationAtPixel(r,s,c){return this._dem.get(r,s,!!c)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*wa(1,r)*this._dem.stride}}class Hg{constructor(r,s){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new zi(En,16,0),this.featureIndexArray=new Zr,this.promoteId=s}insert(r,s,c,d,g,y=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,g,y);const E=this.grid;for(let D=0;D<s.length;D++){const M=s[D],A=[1/0,1/0,-1/0,-1/0];for(let k=0;k<M.length;k++){const F=M[k];A[0]=Math.min(A[0],F.x),A[1]=Math.min(A[1],F.y),A[2]=Math.max(A[2],F.x),A[3]=Math.max(A[3],F.y)}A[0]<En&&A[1]<En&&A[2]>=0&&A[3]>=0&&E.insert(x,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Nl.VectorTile(new Ph(this.rawTileData)).layers,this.sourceLayerCoder=new jg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,s,c,d){this.loadVTLayers();const g=r.params||{},y=Sr(g.filter),x=r.tileResult,E=r.transform,D=x.bufferedTilespaceBounds,M=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(U,G,Z,Q)=>Wf(x.bufferedTilespaceGeometry,U,G,Z,Q));M.sort(mv);let A=null;E.elevation&&M.length>0&&(A=Uh.create(E.elevation,this.tileID));const k={};let F;for(let U=0;U<M.length;U++){const G=M[U];if(G===F)continue;F=G;const Z=this.featureIndexArray.get(G);let Q=null;this.loadMatchingFeature(k,Z,y,g.layers,g.availableImages,s,c,d,(ue,ye,be,Ee=0)=>(Q||(Q=Rl(ue,this.tileID.canonical,r.tileTransform)),ye.queryIntersectsFeature(x,ue,be,Q,this.z,r.transform,r.pixelPosMatrix,A,Ee)))}return k}loadMatchingFeature(r,s,c,d,g,y,x,E,D){const{featureIndex:M,bucketIndex:A,sourceLayerIndex:k,layoutVertexArrayOffset:F}=s,U=this.bucketLayerIDs[A];if(d&&!function(ue,ye){for(let be=0;be<ue.length;be++)if(ye.indexOf(ue[be])>=0)return!0;return!1}(d,U))return;const G=this.sourceLayerCoder.decode(k),Z=this.vtLayers[G].feature(M);if(c.needGeometry){const ue=Ol(Z,!0);if(!c.filter(new Ir(this.tileID.overscaledZ),ue,this.tileID.canonical))return}else if(!c.filter(new Ir(this.tileID.overscaledZ),Z))return;const Q=this.getId(Z,G);for(let ue=0;ue<U.length;ue++){const ye=U[ue];if(d&&d.indexOf(ye)<0)continue;const be=y[ye];if(!be)continue;let Ee={};void 0!==Q&&E&&(Ee=E.getState(be.sourceLayer||"_geojsonTileLayer",Q));const Te=en({},x[ye]);Te.paint=df(Te.paint,be.paint,Z,Ee,g),Te.layout=df(Te.layout,be.layout,Z,Ee,g);const Be=!D||D(Z,be,Ee,F);if(!Be)continue;const Ve=new Vg(Z,this.z,this.x,this.y,Q);Ve.layer=Te;let Ye=r[ye];void 0===Ye&&(Ye=r[ye]=[]),Ye.push({featureIndex:M,feature:Ve,intersectionZ:Be})}}lookupSymbolFeatures(r,s,c,d,g,y,x,E){const D={};this.loadVTLayers();const M=Sr(g);for(const A of r)this.loadMatchingFeature(D,{bucketIndex:c,sourceLayerIndex:d,featureIndex:A,layoutVertexArrayOffset:0},M,y,x,E,s);return D}loadFeature(r){const{featureIndex:s,sourceLayerIndex:c}=r;this.loadVTLayers();const d=this.sourceLayerCoder.decode(c),g=this.vtFeatures[d];if(g[s])return g[s];const y=this.vtLayers[d].feature(s);return g[s]=y,y}hasLayer(r){for(const s of this.bucketLayerIDs)for(const c of s)if(r===c)return!0;return!1}getId(r,s){let c=r.id;return this.promoteId&&(c=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof c&&(c=Number(c))),c}}function df(o,r,s,c,d){return cn(o,(g,y)=>{const x=r instanceof w?r.get(y):null;return x&&x.evaluate?x.evaluate(s,c,d):x})}function mv(o,r){return r-o}Rt(Hg,{omit:["rawTileData","sourceLayerCoder"]});class qg{constructor(r){const s={},c=[];for(const x in r){const E=r[x],D=s[x]={};for(const M in E.glyphs){const A=E.glyphs[+M];if(!A||0===A.bitmap.width||0===A.bitmap.height)continue;const k=A.metrics.localGlyph?2:1,F={x:0,y:0,w:A.bitmap.width+2*k,h:A.bitmap.height+2*k};c.push(F),D[M]=F}}const{w:d,h:g}=xp(c),y=new Ta({width:d||1,height:g||1});for(const x in r){const E=r[x];for(const D in E.glyphs){const M=E.glyphs[+D];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const A=s[x][D],k=M.metrics.localGlyph?2:1;Ta.copy(M.bitmap,y,{x:0,y:0},{x:A.x+k,y:A.y+k},M.bitmap)}}this.image=y,this.positions=s}}Rt(qg);class Zg{constructor(r){this.tileID=new bo(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=jl(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,s,c,d,g){this.status="parsing",this.data=r,this.collisionBoxArray=new xa;const y=new jg(Object.keys(r.layers).sort()),x=new Hg(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},D=new sf(256,256),M={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:c},A=s.familiesBySource[this.source];for(const Ee in A){const Te=r.layers[Ee];if(!Te)continue;let Be=!1,Ve=!1;for(const Oe of A[Ee])"symbol"===Oe[0].type?Be=!0:Ve=!0;if(!0===this.isSymbolTile&&!Be||!1===this.isSymbolTile&&!Ve)continue;1===Te.version&&un(`Vector tile source "${this.source}" layer "${Ee}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ye=y.encode(Ee),et=[];for(let Oe=0;Oe<Te.length;Oe++){const He=Te.feature(Oe),ot=x.getId(He,Ee);et.push({feature:He,id:ot,index:Oe,sourceLayerIndex:Ye})}for(const Oe of A[Ee]){const He=Oe[0];void 0!==this.isSymbolTile&&"symbol"===He.type!==this.isSymbolTile||He.minzoom&&this.zoom<Math.floor(He.minzoom)||He.maxzoom&&this.zoom>=He.maxzoom||"none"!==He.visibility&&($l(Oe,this.zoom,c),(E[He.id]=He.createBucket({index:x.bucketLayerIDs.length,layers:Oe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ye,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:c})).populate(et,M,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Oe.map(ot=>ot.id)))}}let k,F,U,G;D.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Q=cn(M.glyphDependencies,Ee=>Object.keys(Ee).map(Number));Object.keys(Q).length?d.send("getGlyphs",{uid:this.uid,stacks:Q},(Ee,Te)=>{k||(k=Ee,F=Te,be.call(this))},void 0,!1,Z):F={};const ue=Object.keys(M.iconDependencies);ue.length?d.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"icons"},(Ee,Te)=>{k||(k=Ee,U=Te,be.call(this))},void 0,!1,Z):U={};const ye=Object.keys(M.patternDependencies);function be(){if(k)return g(k);if(F&&U&&G){const Ee=new qg(F),Te=new Ec(U,G);for(const Be in E){const Ve=E[Be];Ve instanceof Sa?($l(Ve.layers,this.zoom,c),iv(Ve,F,Ee.positions,U,Te.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):Ve.hasPattern&&(Ve instanceof Cu||Ve instanceof Fd||Ve instanceof yc)&&($l(Ve.layers,this.zoom,c),Ve.addFeatures(M,this.tileID.canonical,Te.patternPositions,c,this.tileTransform))}this.status="done",g(null,{buckets:Kt(E).filter(Be=>!Be.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ee.image,lineAtlas:D,imageAtlas:Te,glyphMap:this.returnDependencies?F:null,iconMap:this.returnDependencies?U:null,glyphPositions:this.returnDependencies?Ee.positions:null})}}ye.length?d.send("getImages",{icons:ye,source:this.source,tileID:this.tileID,type:"patterns"},(Ee,Te)=>{k||(k=Ee,G=Te,be.call(this))},void 0,!1,Z):G={},be.call(this)}}function $l(o,r,s){const c=new Ir(r);for(const d of o)d.recalculate(c,s)}class qp{constructor(r){this.entries={},this.scheduler=r}request(r,s,c,d){const g=this.entries[r]=this.entries[r]||{callbacks:[]};if(g.result){const[y,x]=g.result;return this.scheduler?this.scheduler.add(()=>{d(y,x)},s):d(y,x),()=>{}}return g.callbacks.push(d),g.cancel||(g.cancel=c((y,x)=>{g.result=[y,x];for(const E of g.callbacks)this.scheduler?this.scheduler.add(()=>{E(y,x)},s):E(y,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(y=>y!==d),g.callbacks.length||(g.cancel(),delete this.entries[r]))}}}function Wg(o,r,s){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},d=>{const g=Y(o.request,(y,x,E,D)=>{y?d(y):x&&d(null,{vectorTile:s?void 0:new Nl.VectorTile(new Ph(x)),rawData:x,cacheControl:E,expires:D})});return()=>{g.cancel(),d()}},r)}const gv=Ea(new Float32Array(16));class ms{constructor(r){this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,s){return{x:0,y:0,z:0}}unproject(r,s){return new vr(0,0)}projectTilePoint(r,s,c){return{x:r,y:s,z:0}}locationPoint(r,s){return r._coordinatePoint(r.locationCoordinate(s),!1)}pixelsPerMeter(r,s){return wa(1,r)*s}farthestPixelDistance(r){return function(s,c){const d=s.fovAboveCenter,g=s.elevation?s.elevation.getMinElevationBelowMSL()*c:0,y=(s._camera.position[2]*s.worldSize-g)/Math.cos(s._pitch),x=Math.sin(d)*y/Math.sin(Math.max(Math.PI/2-s._pitch-d,.01)),E=Math.sin(s._pitch)*x+y;return Math.min(1.01*E,y*(1/s._horizonShift))}(r,r.pixelsPerMeter)}pointCoordinate(r,s,c,d){const g=r.horizonLineFromTop(!1),y=new se(s,Math.max(g,c));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,d))}createInversionMatrix(r,s){return gv}createTileMatrix(r,s,c){let d,g,y;const x=c.canonical,E=Ea(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=jl(x,this);d=1,g=D.x+c.wrap*D.scale,y=D.y,pc(E,E,[d/D.scale,d/D.scale,r.pixelsPerMeter/s])}else d=s/r.zoomScale(x.z),g=(x.x+Math.pow(2,x.z)*c.wrap)*d,y=x.y*d;return pu(E,E,[g,y,0]),pc(E,E,[d/En,d/En,1]),E}upVector(r,s,c){return[0,0,1]}upVectorScale(r,s,c){return{metersToTile:1,metersToLabelSpace:1}}}class _v extends ms{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,s){return{x:Fs(r),y:dc(s),z:0}}unproject(r,s){const c=zs(r),d=Ui(s);return new vr(c,d)}}class yv extends ms{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[s,c]=this.parallels=r.parallels||[29.5,45.5],d=Math.sin(ve(s));this.n=(d+Math.sin(ve(c)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(r,s){const{n:c,c:d,r0:g}=this,y=ve(r-this.center[0]),x=ve(s),E=Math.sqrt(d-2*c*Math.sin(x))/c;return{x:E*Math.sin(y*c),y:E*Math.cos(y*c)-g,z:0}}unproject(r,s){const{n:c,c:d,r0:g}=this,y=g+s;let x=Math.atan2(r,Math.abs(y))*Math.sign(y);y*c<0&&(x-=Math.PI*Math.sign(r)*Math.sign(y));const E=ve(this.center[0])*c;x=ct(x,-Math.PI-E,Math.PI-E);const D=Le(x/c)+this.center[0],M=Math.asin(De((d-(r*r+y*y)*c*c)/(2*c),-1,1)),A=De(Le(M),-85.051129,ls);return new vr(D,A)}}const jh=1.340264,Vh=-.081106,Vi=893e-6,Pc=.003796,$h=Math.sqrt(3)/2;class Xg extends ms{project(r,s){s=s/180*Math.PI,r=r/180*Math.PI;const c=Math.asin($h*Math.sin(s)),d=c*c,g=d*d*d;return{x:.5*(r*Math.cos(c)/($h*(jh+3*Vh*d+g*(7*Vi+9*Pc*d)))/Math.PI+.5),y:1-.5*(c*(jh+Vh*d+g*(Vi+Pc*d))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,d=c*c,g=d*d*d;for(let M,A,k,F=0;F<12&&(A=c*(jh+Vh*d+g*(Vi+Pc*d))-s,k=jh+3*Vh*d+g*(7*Vi+9*Pc*d),M=A/k,c=De(c-M,-Math.PI/3,Math.PI/3),d=c*c,g=d*d*d,!(Math.abs(M)<1e-12));++F);const y=$h*r*(jh+3*Vh*d+g*(7*Vi+9*Pc*d))/Math.cos(c),x=Math.asin(Math.sin(c)/$h),E=De(180*y/Math.PI,-180,180),D=De(180*x/Math.PI,-85.051129,ls);return new vr(E,D)}}class Kg extends ms{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){return{x:.5+r/360,y:.5-s/360,z:0}}unproject(r,s){const c=360*(r-.5),d=De(360*(.5-s),-85.051129,ls);return new vr(c,d)}}const kc=Math.PI/2;function ff(o){return Math.tan((kc+o)/2)}class vv extends ms{constructor(r){super(r),this.center=r.center||[0,30];const[s,c]=this.parallels=r.parallels||[30,30],d=ve(s),g=ve(c),y=Math.cos(d);this.n=d===g?Math.sin(d):Math.log(y/Math.cos(g))/Math.log(ff(g)/ff(d)),this.f=y*Math.pow(ff(d),this.n)/this.n}project(r,s){s=ve(s),r=ve(r-this.center[0]);const c=1e-6,{n:d,f:g}=this;g>0?s<-kc+c&&(s=-kc+c):s>kc-c&&(s=kc-c);const y=g/Math.pow(ff(s),d),x=y*Math.sin(d*r),E=g-y*Math.cos(d*r);return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+.5),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI,s=(2*(1-s)-.5)*Math.PI;const{n:c,f:d}=this,g=d-s,y=Math.sign(g),x=Math.sign(c)*Math.sqrt(r*r+g*g);let E=Math.atan2(r,Math.abs(g))*y;g*c<0&&(E-=Math.PI*Math.sign(r)*y);const D=De(Le(E/c)+this.center[0],-180,180),M=De(Le(2*Math.atan(Math.pow(d/x,1/c))-kc),-85.051129,ls);return new vr(D,M)}}const Yg=ve(ls);class xv extends ms{project(r,s){const c=(s=ve(s))*s,d=c*c;return{x:.5*((r=ve(r))*(.8707-.131979*c+d*(d*(.003971*c-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+d*(.028874*c-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(r,s){r=(2*r-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,d=25,g=0,y=c*c;do{y=c*c;const D=y*y;g=(c*(1.007226+y*(.015085+D*(.028874*y-.044475-.005916*D)))-s)/(1.007226+y*(.045255+D*(.259866*y-.311325-.005916*11*D))),c=De(c-g,-Yg,Yg)}while(Math.abs(g)>1e-6&&--d>0);y=c*c;const x=De(Le(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=Le(c);return new vr(x,E)}}const Zp=ve(ls);class F0 extends ms{project(r,s){s=ve(s),r=ve(r);const c=Math.cos(s),d=2/Math.PI,g=Math.acos(c*Math.cos(r/2)),y=Math.sin(g)/g,x=.5*(r*d+2*c*Math.sin(r/2)/y)||0,E=.5*(s+Math.sin(s)/y)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,s){let c=r=(2*r-.5)*Math.PI,d=s=(2*(1-s)-1)*Math.PI,g=25;const y=1e-6;let x=0,E=0;do{const D=Math.cos(d),M=Math.sin(d),A=2*M*D,k=M*M,F=D*D,U=Math.cos(c/2),G=Math.sin(c/2),Z=2*U*G,Q=G*G,ue=1-F*U*U,ye=ue?1/ue:0,be=ue?Math.acos(D*U)*Math.sqrt(1/ue):0,Ee=.5*(2*be*D*G+2*c/Math.PI)-r,Te=.5*(be*M+d)-s,Be=.5*ye*(F*Q+be*D*U*k)+1/Math.PI,Ve=ye*(Z*A/4-be*M*G),Ye=.125*ye*(A*G-be*M*F*Z),et=.5*ye*(k*U+be*Q*D)+.5,Oe=Ve*Ye-et*Be;x=(Te*Ve-Ee*et)/Oe,E=(Ee*Ye-Te*Be)/Oe,c=De(c-x,-Math.PI,Math.PI),d=De(d-E,-Zp,Zp)}while((Math.abs(x)>y||Math.abs(E)>y)&&--g>0);return new vr(Le(c),Le(d))}}class Wp extends ms{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ve(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,s){const{scale:c,cosPhi:d}=this;return{x:ve(r)*d*c+.5,y:-Math.sin(ve(s))/d*c+.5,z:0}}unproject(r,s){const{scale:c,cosPhi:d}=this,g=-(s-.5)/c,y=De(Le((r-.5)/c)/d,-180,180),x=Math.asin(De(g*d,-1,1)),E=De(Le(x),-85.051129,ls);return new vr(y,E)}}f.ARRAY_TYPE=bi,f.AUTH_ERR_MSG=Ji,f.Aabb=cs,f.Actor=class{constructor(o,r,s){this.target=o,this.parent=r,this.mapId=s,this.callbacks={},this.cancelCallbacks={},tt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ct()?o:ae,this.scheduler=new lv}send(o,r,s,c,d=!1,g){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=g,this.callbacks[y]=s);const x=Sn(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:o,hasCallback:!!s,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:va(r,x)},x),{cancel:()=>{s&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const r=o.data,s=r.id;if(s&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(r.mustQueue||Ct()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,r),c&&c.metadata||{type:"message"})}else this.processTask(s,r)}processTask(o,r){if("<response>"===r.type){const s=this.callbacks[o];delete this.callbacks[o],s&&(r.error?s(mi(r.error)):s(null,mi(r.data)))}else{const s=Sn(this.globalScope)?void 0:[],c=r.hasCallback?(g,y)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:g?va(g):null,data:va(y,s)},s)}:g=>{},d=mi(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,d,c);else if(this.parent.getWorkerSource){const g=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,g[0],d.source)[g[1]](d,c)}else c(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},f.CanonicalTileID=Ou,f.Color=jn,f.ColorMode=aa,f.CullFaceMode=la,f.DEMData=Mc,f.DataConstantProperty=C,f.DedupedRequest=qp,f.DepthMode=Lu,f.EXTENT=En,f.Elevation=class{isDataAvailableAtPoint(o){const r=this._source();if(!r||o.y<0||o.y>1)return!1;const s=r.getSource().maxzoom,c=1<<s,d=Math.floor(o.x),g=Math.floor((o.x-d)*c),y=Math.floor(o.y*c),x=this.findDEMTileFor(new bo(s,d,s,g,y));return!(!x||!x.dem)}getAtPointOrZero(o,r=0){return this.getAtPoint(o,r)||0}getAtPoint(o,r,s=!0){null==r&&(r=null);const c=this._source();if(!c||o.y<0||o.y>1)return r;const d=c.getSource().maxzoom,g=1<<d,y=Math.floor(o.x),x=o.x-y,E=new bo(d,y,d,Math.floor(x*g),Math.floor(o.y*g)),D=this.findDEMTileFor(E);if(!D||!D.dem)return r;const M=D.dem,A=1<<D.tileID.canonical.z,k=(x*A-D.tileID.canonical.x)*M.dim,F=(o.y*A-D.tileID.canonical.y)*M.dim,U=Math.floor(k),G=Math.floor(F);return(s?this.exaggeration():1)*bt(bt(M.get(U,G),M.get(U,G+1),F-G),bt(M.get(U+1,G),M.get(U+1,G+1),F-G),k-U)}getAtTileOffset(o,r,s){const c=1<<o.canonical.z;return this.getAtPointOrZero(new mh(o.wrap+(o.canonical.x+r/En)/c,(o.canonical.y+s/En)/c))}getAtTileOffsetFunc(o,r,s,c){return d=>{const g=this.getAtTileOffset(o,d.x,d.y),y=c.upVector(o.canonical,d.x,d.y);return il(y,y,g*c.upVectorScale(o.canonical,r,s).metersToTile),y}}getForTilePoints(o,r,s,c){const d=Uh.create(this,o,c);return!!d&&(r.forEach(g=>{g[2]=this.exaggeration()*d.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(o){const r=this.findDEMTileFor(o);if(!r||!r.dem)return null;const s=r.dem.tree,c=r.tileID,d=1<<o.canonical.z-c.canonical.z;let g=o.canonical.x/d-c.canonical.x,y=o.canonical.y/d-c.canonical.y,x=0;for(let E=0;E<o.canonical.z-c.canonical.z&&!s.leaves[x];E++){g*=2,y*=2;const D=2*Math.floor(y)+Math.floor(g);x=s.childOffsets[x]+D,g%=1,y%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,r,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},f.ErrorEvent=Ut,f.EvaluationParameters=Ir,f.Event=Bt,f.Evented=Xt,f.FillExtrusionBucket=yc,f.Frustum=Qf,f.GLOBE_RADIUS=Ru,f.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o),this._createAtmosphere(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(o){const r=new te,s=new Ne,c=65;for(let d=0;d<c;d++)for(let g=0;g<c;g++)r.emplaceBack(g,d);for(let d=0;d<64;d++)for(let g=0;g<64;g++){const y=d*c+g;s.emplaceBack(y+1,y,y+c),s.emplaceBack(y+c,y+c+1,y+1)}this._gridBuffer=o.createVertexBuffer(r,zh.members),this._gridIndexBuffer=o.createIndexBuffer(s,!0),this._gridSegments=ri.simpleSegment(0,0,4225,8192)}_createPoles(o){const r=new Ne;for(let d=0;d<=64;d++)r.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=o.createIndexBuffer(r,!0);const s=new Ft,c=new Ft;this._poleSegments=[];for(let d=0,g=0;d<5;d++){const y=1<<d,x=512*y/Math.PI/2,E=360/y;s.emplaceBack(0,-x,0,0,0,.5,0),c.emplaceBack(0,-x,0,0,0,.5,1);for(let D=0;D<=64;D++){const M=D/64,A=bt(0,E,M),[k,F,U]=Fg(Bg,uv,A,x);s.emplaceBack(k,F,U,0,0,M,0),c.emplaceBack(k,F,U,0,0,M,1)}this._poleSegments.push(ri.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(s,Rg,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,Rg,!1)}_createAtmosphere(o){const r=new tn;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const s=new Ne;s.emplaceBack(0,1,2),s.emplaceBack(2,3,0),this.atmosphereVertexBuffer=o.createVertexBuffer(r,cv.members),this.atmosphereIndexBuffer=o.createIndexBuffer(s),this.atmosphereSegments=ri.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o){if(!this._wireframeSegments){const r=new qt,s=64,c=s+1;for(let d=0;d<s;d++)for(let g=0;g<s;g++){const y=d*c+g;r.emplaceBack(y,y+1),r.emplaceBack(y,y+c),r.emplaceBack(y,y+c+1)}this._wireframeIndexBuffer=o.createIndexBuffer(r),this._wireframeSegments=ri.simpleSegment(0,0,s*s,r.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},f.GlyphManager=Tc,f.ImagePosition=Nn,f.LineAtlas=sf,f.LngLat=vr,f.LngLatBounds=Ls,f.LocalGlyphMode=Yd,f.MAX_MERCATOR_LATITUDE=ls,f.MercatorCoordinate=mh,f.ONE_EM=24,f.OverscaledTileID=bo,f.Properties=B,f.RGBAImage=Xo,f.Ray=class{constructor(o,r){this.pos=o,this.dir=r}intersectsPlane(o,r,s){const c=gu(r,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((o[0]-this.pos[0])*r[0]+(o[1]-this.pos[1])*r[1]+(o[2]-this.pos[2])*r[2])/c;return s[0]=this.pos[0]+this.dir[0]*d,s[1]=this.pos[1]+this.dir[1]*d,s[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(o,r,s){if(U=(k=this.pos)[0],G=k[1],Z=k[2],Q=(F=o)[0],ue=F[1],ye=F[2],Math.abs(U-Q)<=Xf*Math.max(1,Math.abs(U),Math.abs(Q))&&Math.abs(G-ue)<=Xf*Math.max(1,Math.abs(G),Math.abs(ue))&&Math.abs(Z-ye)<=Xf*Math.max(1,Math.abs(Z),Math.abs(ye))||0===r)return s[0]=s[1]=s[2]=0,!1;var k,F,U,G,Z,Q,ue,ye;const[c,d,g]=this.dir,y=this.pos[0]-o[0],x=this.pos[1]-o[1],E=this.pos[2]-o[2],D=c*c+d*d+g*g,M=2*(y*c+x*d+E*g),A=M*M-4*D*(y*y+x*x+E*E-r*r);if(A<0){const k=Math.max(-M/2,0),F=y+c*k,U=x+d*k,G=E+g*k,Z=Math.hypot(F,U,G);return s[0]=F*r/Z,s[1]=U*r/Z,s[2]=G*r/Z,!1}{const k=(-M-Math.sqrt(A))/(2*D);if(k<0){const F=Math.hypot(y,x,E);return s[0]=y*r/F,s[1]=x*r/F,s[2]=E*r/F,!1}return s[0]=y+c*k,s[1]=x+d*k,s[2]=E+g*k,!0}}},f.RequestManager=class{constructor(o,r,s){this._transformRequestFn=o,this._customAccessToken=r,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let r="";for(let s=0;s<10;s++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Or,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,r){return this._transformRequestFn&&this._transformRequestFn(o,r)||{url:o}}normalizeStyleURL(o,r){if(!Gi(o))return o;const s=Si(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeGlyphsURL(o,r){if(!Gi(o))return o;const s=Si(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||r)}normalizeSourceURL(o,r){if(!Gi(o))return o;const s=Si(o);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||r)}normalizeSpriteURL(o,r,s,c){const d=Si(o);return Gi(o)?(d.path=`/styles/v1${d.path}/sprite${r}${s}`,this._makeAPIURL(d,this._customAccessToken||c)):(d.path+=`${r}${s}`,Qi(d))}normalizeTileURL(o,r,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Gi(o))return o;const c=Si(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||s&&"raster"!==c.authority&&512===s?"@2x":""}${sr.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${fn.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${fn.TILE_URL_VERSION}${c.path}`);const d=this._customAccessToken||function(g){for(const y of g){const x=y.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||fn.ACCESS_TOKEN;return fn.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,d)}canonicalizeTileURL(o,r){const s=Si(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${fn.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${fn.TILE_URL_VERSION}/`,"")}`;let d=s.params;return r&&(d=d.filter(g=>!g.match(/^access_token=/))),d.length&&(c+=`?${d.join("&")}`),c}canonicalizeTileset(o,r){const s=!!r&&Gi(r),c=[];for(const d of o.tiles||[])No(d)?c.push(this.canonicalizeTileURL(d,s)):c.push(d);return c}_makeAPIURL(o,r){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=Si(fn.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,"http"===o.protocol){const d=o.params.indexOf("secure");d>=0&&o.params.splice(d,1)}if("/"!==c.path&&(o.path=`${c.path}${o.path}`),!fn.REQUIRE_ACCESS_TOKEN)return Qi(o);if(r=r||fn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(d=>-1===d.indexOf("access_token")),o.params.push(`access_token=${r||""}`),Qi(o)}},f.ResourceType=K,f.SegmentVector=ri,f.SourceCache=ul,f.StencilMode=Nh,f.StructArrayLayout1ui2=pn,f.StructArrayLayout2f1f2i16=ut,f.StructArrayLayout2i4=te,f.StructArrayLayout2ui4=qt,f.StructArrayLayout3f12=he,f.StructArrayLayout3ui6=Ne,f.StructArrayLayout4i8=le,f.Texture=Fh,f.Tile=Bp,f.Transitionable=p,f.Uniform1f=fh,f.Uniform1i=class extends Al{constructor(o,r){super(o,r),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},f.Uniform2f=class extends Al{constructor(o,r){super(o,r),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},f.Uniform3f=class extends Al{constructor(o,r){super(o,r),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},f.Uniform4f=Om,f.UniformColor=Lm,f.UniformMatrix2f=class extends Al{constructor(o,r){super(o,r),this.current=ay}set(o){for(let r=0;r<4;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}},f.UniformMatrix3f=class extends Al{constructor(o,r){super(o,r),this.current=sy}set(o){for(let r=0;r<9;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},f.UniformMatrix4f=class extends Al{constructor(o,r){super(o,r),this.current=oy}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let r=1;r<16;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},f.UnwrappedTileID=Ug,f.ValidationError=It,f.VectorTileWorkerSource=class extends Xt{constructor(o,r,s,c,d){super(),this.actor=o,this.layerIndex=r,this.availableImages=s,this.loadVectorData=d||Wg,this.loading={},this.loaded={},this.deduped=new qp(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,r){const s=o.uid,c=o&&o.request,d=c&&c.collectResourceTiming,g=this.loading[s]=new Zg(o);g.abort=this.loadVectorData(o,(y,x)=>{const E=!this.loading[s];if(delete this.loading[s],E||y||!x)return g.status="done",E||(this.loaded[s]=g),r(y);const D=x.rawData,M={};x.expires&&(M.expires=x.expires),x.cacheControl&&(M.cacheControl=x.cacheControl),g.vectorTile=x.vectorTile||new Nl.VectorTile(new Ph(D));const A=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,F)=>{if(k||!F)return r(k);const U={};if(d){const G=Pp(c);G.length>0&&(U.resourceTiming=JSON.parse(JSON.stringify(G)))}r(null,en({rawTileData:D.slice(0)},F,M,U))})};this.isSpriteLoaded?A():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(A,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):A()}),this.loaded=this.loaded||{},this.loaded[s]=g})}reloadTile(o,r){const s=this.loaded,c=o.uid,d=this;if(s&&s[c]){const g=s[c];g.showCollisionBoxes=o.showCollisionBoxes,g.enableTerrain=!!o.enableTerrain,g.projection=o.projection,g.tileTransform=jl(o.tileID.canonical,o.projection);const y=(x,E)=>{const D=g.reloadCallback;D&&(delete g.reloadCallback,g.parse(g.vectorTile,d.layerIndex,this.availableImages,d.actor,D)),r(x,E)};"parsing"===g.status?g.reloadCallback=y:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(o,r){const s=o.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),r()}removeTile(o,r){const s=this.loaded,c=o.uid;s&&s[c]&&delete s[c],r()}},f.WritingMode=Ko,f.ZoomHistory=as,f.add=yy,f.addDynamicAttributes=Ip,f.adjoint=function(o,r){var s=r[0],c=r[1],d=r[2],g=r[3],y=r[4],x=r[5],E=r[6],D=r[7],M=r[8];return o[0]=y*M-x*D,o[1]=d*D-c*M,o[2]=c*x-d*y,o[3]=x*E-g*M,o[4]=s*M-d*E,o[5]=d*g-s*x,o[6]=g*D-y*E,o[7]=c*E-s*D,o[8]=s*y-c*g,o},f.asyncAll=gt,f.bezier=rt,f.bindAll=tt,f.boundsAttributes=uf,f.bufferConvexPolygon=function(o,r){const s=[];for(let c=0;c<o.length;c++){const d=ct(c-1,-1,o.length-1),g=ct(c+1,-1,o.length-1),y=o[c],x=o[g],E=o[d].sub(y).unit(),D=x.sub(y).unit(),M=D.angleWithSep(E.x,E.y),A=E.add(D).unit().mult(-1*r/Math.sin(M/2));s.push(y.add(A))}return s},f.cacheEntryPossiblyAdded=function(o){Uo++,Uo>eo&&(o.getActor().send("enforceCacheSizeLimit",Zn),Uo=0)},f.calculateGlobeLabelMatrix=function(o,r){const{lng:s,lat:c}=o._center,d=zg(0,0,o.worldSize/o._projectionScaler,s,c);return $m(d,d,function(g){const y=Ea(new Float64Array(16)),x=1/Lp(g);return pu(y,y,g.min),pc(y,y,[x,x,x]),y}(Ic(r)))},f.calculateGlobeMatrix=Ng,f.calculateGlobeMercatorMatrix=function(o){const r=o.worldSize,s=o.point,c=wa(1,o.center.lat)*r,d=o.pixelsPerMeter,g=r/(c/o.pixelsPerMeter),y=Ea(new Float64Array(16));return pu(y,y,[s.x,s.y,0]),pc(y,y,[g,g,d]),Float32Array.from(y)},f.circumferenceAtLatitude=hu,f.clamp=De,f.clearTileCache=function(o){const r=ae.caches.delete(Es);o&&r.catch(o).then(()=>o())},f.clipLine=Ep,f.clone=function(o){var r=new bi(16);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],r[9]=o[9],r[10]=o[10],r[11]=o[11],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15],r},f.clone$1=Qt,f.collisionCircleLayout=Vy,f.config=fn,f.conjugate=function(o,r){return o[0]=-r[0],o[1]=-r[1],o[2]=-r[2],o[3]=r[3],o},f.create=function(){var o=new bi(16);return bi!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},f.create$1=fu,f.createExpression=Cl,f.createLayout=re,f.createStyleLayer=function(o){return"custom"===o.type?new Mp(o):new of[o.type](o)},f.cross=vy,f.degToRad=ve,f.div=function(o,r,s){return o[0]=r[0]/s[0],o[1]=r[1]/s[1],o[2]=r[2]/s[2],o},f.dot=gu,f.earthRadius=Vf,f.ease=Ze,f.easeCubicInOut=wt,f.emitValidationErrors=Dl,f.endsWith=We,f.enforceCacheSizeLimit=function(o){Kn(),_i&&_i.then(r=>{r.keys().then(s=>{for(let c=0;c<s.length-o;c++)r.delete(s[c])})})},f.evaluateSizeForFeature=Du,f.evaluateSizeForZoom=bc,f.evaluateVariableOffset=Jd,f.evented=ch,f.exactEquals=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]&&o[3]===r[3]},f.exactEquals$1=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]},f.exported=or,f.exported$1=sr,f.extend=en,f.extend$1=Yn,f.filterObject=Cn,f.fromMat4=function(o,r){return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[4],o[4]=r[5],o[5]=r[6],o[6]=r[8],o[7]=r[9],o[8]=r[10],o},f.fromQuat=function(o,r){var s=r[0],c=r[1],d=r[2],g=r[3],y=s+s,x=c+c,E=d+d,D=s*y,M=c*y,A=c*x,k=d*y,F=d*x,U=d*E,G=g*y,Z=g*x,Q=g*E;return o[0]=1-A-U,o[1]=M+Q,o[2]=k-Z,o[3]=0,o[4]=M-Q,o[5]=1-D-U,o[6]=F+G,o[7]=0,o[8]=k+Z,o[9]=F-G,o[10]=1-D-A,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},f.fromRotation=function(o,r){var s=Math.sin(r),c=Math.cos(r);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},f.fromScaling=function(o,r){return o[0]=r[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},f.furthestTileCorner=function(o){const r=Math.round((o+45+360)%360/90)%4;return yt[r]},f.getAABBPointSquareDist=function(o,r,s){let c=0;for(let d=0;d<2;++d){const g=s?s[d]:0;o[d]>g&&(c+=(o[d]-g)*(o[d]-g)),r[d]<g&&(c+=(g-r[d])*(g-r[d]))}return c},f.getAnchorAlignment=qd,f.getAnchorJustification=Qd,f.getBounds=function(o){let r=1/0,s=1/0,c=-1/0,d=-1/0;for(const g of o)r=Math.min(r,g.x),s=Math.min(s,g.y),c=Math.max(c,g.x),d=Math.max(d,g.y);return{min:new se(r,s),max:new se(c,d)}},f.getColumn=function(o,r){return[o[4*r],o[4*r+1],o[4*r+2],o[4*r+3]]},f.getGridMatrix=function(o,r){const[s,c]=r,d=.015625;return[0,(c[1]-s[1])*d,1<<o.z,(c[0]-s[0])*d,0,o.y,s[0],s[1],d]},f.getImage=vt,f.getJSON=function(o,r){return X(en(o,{type:"json"}),r)},f.getMapSessionAPI=$s,f.getPerformanceMeasurement=Pp,f.getProjection=function(o){const r=o.parallels,s=!!r&&Math.abs(r[0]+r[1])<.01;switch(o.name){case"mercator":return new _v(o);case"equirectangular":return new Kg(o);case"naturalEarth":return new xv(o);case"equalEarth":return new Xg(o);case"winkelTripel":return new F0(o);case"albers":return s?new Wp(o):new yv(o);case"lambertConformalConic":return s?new Wp(o):new vv(o)}throw new Error(`Invalid projection name: ${o.name}`)},f.getRTLTextPluginStatus=uh,f.getReferrer=j,f.getTilePoint=function(o,{x:r,y:s},c=0){return new se(((r-c)*o.scale-o.x)*En,(s*o.scale-o.y)*En)},f.getTileVec3=function(o,r,s=0){return vh(((r.x-s)*o.scale-o.x)*En,(r.y*o.scale-o.y)*En,Id(r.z,r.y))},f.getVideo=function(o,r){const s=ae.document.createElement("video");s.muted=!0,s.onloadstart=function(){r(null,s)};for(let c=0;c<o.length;c++){const d=ae.document.createElement("source");we(o[c])||(s.crossOrigin="Anonymous"),d.src=o[c],s.appendChild(d)}return{cancel:()=>{}}},f.globeECEFOrigin=function(o,r){const s=[0,0,0];return _u(s,s,Fp(Ic(r.canonical))),_u(s,s,o),s},f.globePixelsToTileUnits=function(o,r){return En/(512*Math.pow(2,o))*Lp(Ic(r))},f.globePoleMatrixForTile=function(o,r,s){const c=Ea(new Float64Array(16)),d=1<<o,g=360*(r/d-.5),y=s.point,x=s.worldSize/(s.tileSize*d);return pu(c,c,[y.x,y.y,-s.worldSize/Math.PI/2]),pc(c,c,[x,x,x]),Gm(c,c,ve(-s._center.lat)),Hm(c,c,ve(-s._center.lng+g)),Float32Array.from(c)},f.globeTileLatLngCorners=Rp,f.globeToMercatorTransition=function(o){return Ge(5,6,o)},f.identity=Ea,f.identity$1=Km,f.invert=function(o,r){var s=r[0],c=r[1],d=r[2],g=r[3],y=r[4],x=r[5],E=r[6],D=r[7],M=r[8],A=r[9],k=r[10],F=r[11],U=r[12],G=r[13],Z=r[14],Q=r[15],ue=s*x-c*y,ye=s*E-d*y,be=s*D-g*y,Ee=c*E-d*x,Te=c*D-g*x,Be=d*D-g*E,Ve=M*G-A*U,Ye=M*Z-k*U,et=M*Q-F*U,Oe=A*Z-k*G,He=A*Q-F*G,ot=k*Q-F*Z,pt=ue*ot-ye*He+be*Oe+Ee*et-Te*Ye+Be*Ve;return pt?(o[0]=(x*ot-E*He+D*Oe)*(pt=1/pt),o[1]=(d*He-c*ot-g*Oe)*pt,o[2]=(G*Be-Z*Te+Q*Ee)*pt,o[3]=(k*Te-A*Be-F*Ee)*pt,o[4]=(E*et-y*ot-D*Ye)*pt,o[5]=(s*ot-d*et+g*Ye)*pt,o[6]=(Z*be-U*Be-Q*ye)*pt,o[7]=(M*Be-k*be+F*ye)*pt,o[8]=(y*He-x*et+D*Ve)*pt,o[9]=(c*et-s*He-g*Ve)*pt,o[10]=(U*Te-G*be+Q*ue)*pt,o[11]=(A*be-M*Te-F*ue)*pt,o[12]=(x*Ye-y*Oe-E*Ve)*pt,o[13]=(s*Oe-c*Ye+d*Ve)*pt,o[14]=(G*ye-U*Ee-Z*ue)*pt,o[15]=(M*Ee-A*ye+k*ue)*pt,o):null},f.isMapAuthenticated=function(o){return Ii.has(o)},f.isMapboxURL=Gi,f.isSafariWithAntialiasingBug=function(o){const r=o.navigator?o.navigator.userAgent:null;return!!Sn(o)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},f.latFromMercatorY=Ui,f.len=C0,f.length=Wm,f.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},f.loadVectorTile=Wg,f.makeRequest=X,f.mercatorXfromLng=Fs,f.mercatorYfromLat=dc,f.mercatorZfromAltitude=wa,f.mul=qm,f.mul$1=Yf,f.multiply=function(o,r,s){var c=r[0],d=r[1],g=r[2],y=r[3],x=r[4],E=r[5],D=r[6],M=r[7],A=r[8],k=s[0],F=s[1],U=s[2],G=s[3],Z=s[4],Q=s[5],ue=s[6],ye=s[7],be=s[8];return o[0]=k*c+F*y+U*D,o[1]=k*d+F*x+U*M,o[2]=k*g+F*E+U*A,o[3]=G*c+Z*y+Q*D,o[4]=G*d+Z*x+Q*M,o[5]=G*g+Z*E+Q*A,o[6]=ue*c+ye*y+be*D,o[7]=ue*d+ye*x+be*M,o[8]=ue*g+ye*E+be*A,o},f.multiply$1=$m,f.multiply$2=xh,f.nextPowerOfTwo=Tt,f.normalize=mu,f.normalize$1=function(o,r){var s=r[0],c=r[1],d=r[2],g=r[3],y=s*s+c*c+d*d+g*g;return y>0&&(y=1/Math.sqrt(y)),o[0]=s*y,o[1]=c*y,o[2]=d*y,o[3]=g*y,o},f.number=bt,f.ortho=function(o,r,s,c,d,g,y){var x=1/(r-s),E=1/(c-d),D=1/(g-y);return o[0]=-2*x,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*E,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*D,o[11]=0,o[12]=(r+s)*x,o[13]=(d+c)*E,o[14]=(y+g)*D,o[15]=1,o},f.pbf=Ph,f.perspective=function(o,r,s,c,d){var g,y=1/Math.tan(r/2);return o[0]=y/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=y,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=d&&d!==1/0?(o[10]=(d+c)*(g=1/(c-d)),o[14]=2*d*c*g):(o[10]=-1,o[14]=-2*c),o},f.pick=function(o,r){const s={};for(let c=0;c<r.length;c++){const d=r[c];d in o&&(s[d]=o[d])}return s},f.plugin=oo,f.pointGeometry=se,f.polygonIntersectsBox=Wf,f.polygonIntersectsPolygon=Bm,f.polygonizeBounds=function(o,r,s=0,c=!0){const d=new se(s,s),g=o.sub(d),y=r.add(d),x=[g,new se(y.x,g.y),y,new se(g.x,y.y)];return c&&x.push(g),x},f.posAttributes=zh,f.postMapLoadEvent=Vs,f.postTurnstileEvent=ts,f.potpack=xp,f.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},f.radToDeg=Le,f.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],f.registerForPluginStateChange=function(o){return o({pluginStatus:_o,pluginURL:Bi}),ch.on("pluginStateChange",o),o},f.removeAuthState=function(o){Ii.delete(o)},f.renderColorRamp=np,f.rotateX=Gm,f.rotateX$1=Ym,f.rotateY=Hm,f.rotateZ=function(o,r,s){var c=Math.sin(s),d=Math.cos(s),g=r[0],y=r[1],x=r[2],E=r[3],D=r[4],M=r[5],A=r[6],k=r[7];return r!==o&&(o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=g*d+D*c,o[1]=y*d+M*c,o[2]=x*d+A*c,o[3]=E*d+k*c,o[4]=D*d-g*c,o[5]=M*d-y*c,o[6]=A*d-x*c,o[7]=k*d-E*c,o},f.rotateZ$1=function(o,r,s){s*=.5;var c=r[0],d=r[1],g=r[2],y=r[3],x=Math.sin(s),E=Math.cos(s);return o[0]=c*E+d*x,o[1]=d*E-c*x,o[2]=g*E+y*x,o[3]=y*E-g*x,o},f.scale=pc,f.scale$1=function(o,r,s){return o[0]=r[0]*s,o[1]=r[1]*s,o[2]=r[2]*s,o[3]=r[3]*s,o},f.scale$2=il,f.scaleAndAdd=Pd,f.setCacheLimits=function(o,r){Zn=o,eo=r},f.setColumn=function(o,r,s){o[4*r+0]=s[0],o[4*r+1]=s[1],o[4*r+2]=s[2],o[4*r+3]=s[3]},f.setRTLTextPlugin=function(o,r,s=!1){if(_o===ah||_o===Ho||_o===Ka)throw new Error("setRTLTextPlugin cannot be called multiple times.");Bi=or.resolveURL(o),_o=ah,lh=r,Ja(),s||cc()},f.smoothstep=Ge,f.spec=ke,f.storeAuthState=function(o,r){r?Ii.add(o):Ii.delete(o)},f.sub=zl,f.subtract=Xm,f.symbolSize=Ud,f.tileAABB=function(o,r,s,c,d,g,y,x,E){if("globe"===E.name)return function Lg(o,r,s){const c=r/o.worldSize,d=(He,ot)=>{il(He,He,c),il(ot,ot,c)},g=Number.MAX_VALUE,y=[-g,-g,-g],x=[g,g,g],E=Ng(o);if(s.z<=1){const He=Ic(s).getCorners();for(let ot=0;ot<He.length;ot++)_u(He[ot],He[ot],E),Ad(x,x,He[ot]),Ns(y,y,He[ot]);return d(x,y),new cs(x,y)}const[D,M]=Rp(s),A=new Ls;A.setSouthWest([D[1],M[0]]),A.setNorthEast([M[1],D[0]]);const k=[ll(A.getSouth(),A.getWest()),ll(A.getSouth(),A.getEast()),ll(A.getNorth(),A.getEast()),ll(A.getNorth(),A.getWest())];for(let He=0;He<k.length;He++)_u(k[He],k[He],E),Ad(x,x,k[He]),Ns(y,y,k[He]);if(A.contains(o.center))return y[2]=0,d(x,y),new cs(x,y);const F=[E[12],E[13],E[14]],U=o.center.lng,G=De(o.center.lat,-85.051129,ls),Z=[Fs(U),dc(G)],Q=A.getCenter().lng,ue=De(A.getCenter().lat,-85.051129,ls),ye=[Fs(Q),dc(ue)];let be=new Array(3),Ee=0;const Te=Z[0]-ye[0],Be=Z[1]-ye[1];if(Math.abs(Te)>Math.abs(Be))Ee=Te>=0?1:3,be=F;else{Ee=Be>=0?0:2;const He=[E[4],E[5],E[6]];let ot;ot=Be>=0?-Math.sin(ve(A.getSouth()))*Ru:-Math.sin(ve(A.getNorth()))*Ru,be=Pd(be,F,He,ot)}const Ve=k[Ee],Ye=k[(Ee+1)%4],et=new L0(Ve,Ye,be),Oe=[kp(et,0)||Ve[0],kp(et,1)||Ve[1],kp(et,2)||Ve[2]];return x[2]=Math.min(Ve[2],Ye[2]),Ad(x,x,Oe),Ns(y,y,Oe),d(x,y),new cs(x,y)}(o,r,new Ou(s,c,d));const D=jl({z:s,x:c,y:d},E);return new cs([(g+D.x/D.scale)*r,r*(D.y/D.scale),y],[(g+D.x2/D.scale)*r,r*(D.y2/D.scale),x])},f.tileTransform=jl,f.transformMat3=function(o,r,s){var c=r[0],d=r[1],g=r[2];return o[0]=c*s[0]+d*s[3]+g*s[6],o[1]=c*s[1]+d*s[4]+g*s[7],o[2]=c*s[2]+d*s[5]+g*s[8],o},f.transformMat4=_u,f.transformMat4$1=bh,f.transformQuat=xy,f.translate=pu,f.transpose=function(o,r){if(o===r){var s=r[1],c=r[2],d=r[5];o[1]=r[3],o[2]=r[6],o[3]=s,o[5]=r[7],o[6]=c,o[7]=d}else o[0]=r[0],o[1]=r[3],o[2]=r[6],o[3]=r[1],o[4]=r[4],o[5]=r[7],o[6]=r[2],o[7]=r[5],o[8]=r[8];return o},f.triggerPluginCompletionEvent=Ya,f.uniqueId=Wt,f.validateCustomStyleLayer=function(o){const r=[],s=o.id;return void 0===s&&r.push({message:`layers.${s}: missing required property "id"`}),void 0===o.render&&r.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&r.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),r},f.validateFilter=o=>ks(Ws(o)),f.validateFog=o=>ks(Ku(o)),f.validateLayer=o=>ks(nu(o)),f.validateLight=o=>ks(_d(o)),f.validateSource=o=>ks(gd(o)),f.validateStyle=Qn,f.validateTerrain=o=>ks(yd(o)),f.values=Kt,f.vectorTile=Nl,f.version="2.8.1",f.warnOnce=un,f.window=ae,f.wrap=ct}),it(0,function(f){function Se(K){if("number"==typeof K||"boolean"==typeof K||"string"==typeof K||null==K)return JSON.stringify(K);if(Array.isArray(K)){let j="[";for(const X of K)j+=`${Se(X)},`;return`${j}]`}let z="{";for(const j of Object.keys(K).sort())z+=`${j}:${Se(K[j])},`;return`${z}}`}function Ie(K){let z="";for(const j of f.refProperties)z+=`/${Se(K[j])}`;return z}class Ue{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,j){for(const Y of z)this._layerConfigs[Y.id]=Y,(this._layers[Y.id]=f.createStyleLayer(Y)).compileFilter(),this.keyCache[Y.id]&&delete this.keyCache[Y.id];for(const Y of j)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const X=function(Y,de){const pe={};for(let xe=0;xe<Y.length;xe++){const Pe=de&&de[Y[xe].id]||Ie(Y[xe]);de&&(de[Y[xe].id]=Pe);let Ke=pe[Pe];Ke||(Ke=pe[Pe]=[]),Ke.push(Y[xe])}const we=[];for(const xe in pe)we.push(pe[xe]);return we}(f.values(this._layerConfigs),this.keyCache);for(const Y of X){const de=Y.map(vt=>this._layers[vt.id]),pe=de[0];if("none"===pe.visibility)continue;const we=pe.source||"";let xe=this.familiesBySource[we];xe||(xe=this.familiesBySource[we]={});const Pe=pe.sourceLayer||"_geojsonTileLayer";let Ke=xe[Pe];Ke||(Ke=xe[Pe]=[]),Ke.push(de)}}}class se{loadTile(z,j){const{uid:X,encoding:Y,rawImageData:de,padding:pe,buildQuadTree:we}=z,xe=f.window.ImageBitmap&&de instanceof f.window.ImageBitmap?this.getImageData(de,pe):de;j(null,new f.DEMData(X,xe,Y,pe<1,we))}getImageData(z,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const X=this.offscreenCanvasContext.getImageData(-j,-j,z.width+2*j,z.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),X}}var me=function K(z,j){var X,Y=z&&z.type;if("FeatureCollection"===Y)for(X=0;X<z.features.length;X++)K(z.features[X],j);else if("GeometryCollection"===Y)for(X=0;X<z.geometries.length;X++)K(z.geometries[X],j);else if("Feature"===Y)K(z.geometry,j);else if("Polygon"===Y)ae(z.coordinates,j);else if("MultiPolygon"===Y)for(X=0;X<z.coordinates.length;X++)ae(z.coordinates[X],j);return z};function ae(K,z){if(0!==K.length){ge(K[0],z);for(var j=1;j<K.length;j++)ge(K[j],!z)}}function ge(K,z){for(var j=0,X=0,Y=0,de=K.length,pe=de-1;Y<de;pe=Y++){var we=(K[Y][0]-K[pe][0])*(K[pe][1]+K[Y][1]),xe=j+we;X+=Math.abs(j)>=Math.abs(we)?j-xe+we:we-xe+j,j=xe}j+X>=0!=!!z&&K.reverse()}const _e=f.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ve{constructor(z){this._feature=z,this.extent=f.EXTENT,this.type=z.type,this.properties=z.tags,"id"in z&&!isNaN(z.id)&&(this.id=parseInt(z.id,10))}loadGeometry(){if(1===this._feature.type){const z=[];for(const j of this._feature.geometry)z.push([new f.pointGeometry(j[0],j[1])]);return z}{const z=[];for(const j of this._feature.geometry){const X=[];for(const Y of j)X.push(new f.pointGeometry(Y[0],Y[1]));z.push(X)}return z}}toGeoJSON(z,j,X){return _e.call(this,z,j,X)}}class Le{constructor(z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.EXTENT,this.length=z.length,this._features=z}feature(z){return new ve(this._features[z])}}var yt=f.vectorTile.VectorTileFeature,wt=rt;function rt(K,z){this.options=z||{},this.features=K,this.length=K.length}function Ze(K,z){this.id="number"==typeof K.id?K.id:void 0,this.type=K.type,this.rawGeometry=1===K.type?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=z||4096}rt.prototype.feature=function(K){return new Ze(this.features[K],this.options.extent)},Ze.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var z=0;z<K.length;z++){for(var j=K[z],X=[],Y=0;Y<j.length;Y++)X.push(new f.pointGeometry(j[Y][0],j[Y][1]));this.geometry.push(X)}return this.geometry},Ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,z=1/0,j=-1/0,X=1/0,Y=-1/0,de=0;de<K.length;de++)for(var pe=K[de],we=0;we<pe.length;we++){var xe=pe[we];z=Math.min(z,xe.x),j=Math.max(j,xe.x),X=Math.min(X,xe.y),Y=Math.max(Y,xe.y)}return[z,X,j,Y]},Ze.prototype.toGeoJSON=yt.prototype.toGeoJSON;var De=ct,Ge=wt;function ct(K){var z=new f.pbf;return function(j,X){for(var Y in j.layers)X.writeMessage(3,gt,j.layers[Y])}(K,z),z.finish()}function gt(K,z){var j;z.writeVarintField(15,K.version||1),z.writeStringField(1,K.name||""),z.writeVarintField(5,K.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<K.length;j++)X.feature=K.feature(j),z.writeMessage(2,Kt,X);var Y=X.keys;for(j=0;j<Y.length;j++)z.writeStringField(3,Y[j]);var de=X.values;for(j=0;j<de.length;j++)z.writeMessage(4,Tt,de[j])}function Kt(K,z){var j=K.feature;void 0!==j.id&&z.writeVarintField(1,j.id),z.writeMessage(2,en,K),z.writeVarintField(3,j.type),z.writeMessage(4,St,j)}function en(K,z){var j=K.feature,X=K.keys,Y=K.values,de=K.keycache,pe=K.valuecache;for(var we in j.properties){var xe=j.properties[we],Pe=de[we];if(null!==xe){void 0===Pe&&(X.push(we),de[we]=Pe=X.length-1),z.writeVarint(Pe);var Ke=typeof xe;"string"!==Ke&&"boolean"!==Ke&&"number"!==Ke&&(xe=JSON.stringify(xe));var vt=Ke+":"+xe,Xe=pe[vt];void 0===Xe&&(Y.push(xe),pe[vt]=Xe=Y.length-1),z.writeVarint(Xe)}}}function rn(K,z){return(z<<3)+(7&K)}function Wt(K){return K<<1^K>>31}function St(K,z){for(var j=K.loadGeometry(),X=K.type,Y=0,de=0,pe=j.length,we=0;we<pe;we++){var xe=j[we],Pe=1;1===X&&(Pe=xe.length),z.writeVarint(rn(1,Pe));for(var Ke=3===X?xe.length-1:xe.length,vt=0;vt<Ke;vt++){1===vt&&1!==X&&z.writeVarint(rn(2,Ke-1));var Xe=xe[vt].x-Y,Yt=xe[vt].y-de;z.writeVarint(Wt(Xe)),z.writeVarint(Wt(Yt)),Y+=Xe,de+=Yt}3===X&&z.writeVarint(rn(7,1))}}function Tt(K,z){var j=typeof K;"string"===j?z.writeStringField(1,K):"boolean"===j?z.writeBooleanField(7,K):"number"===j&&(K%1!=0?z.writeDoubleField(3,K):K<0?z.writeSVarintField(6,K):z.writeVarintField(5,K))}function Nt(K,z,j,X,Y,de){if(Y-X<=j)return;const pe=X+Y>>1;tt(K,z,pe,X,Y,de%2),Nt(K,z,j,X,pe-1,de+1),Nt(K,z,j,pe+1,Y,de+1)}function tt(K,z,j,X,Y,de){for(;Y>X;){if(Y-X>600){const Pe=Y-X+1,Ke=j-X+1,vt=Math.log(Pe),Xe=.5*Math.exp(2*vt/3),Yt=.5*Math.sqrt(vt*Xe*(Pe-Xe)/Pe)*(Ke-Pe/2<0?-1:1);tt(K,z,j,Math.max(X,Math.floor(j-Ke*Xe/Pe+Yt)),Math.min(Y,Math.floor(j+(Pe-Ke)*Xe/Pe+Yt)),de)}const pe=z[2*j+de];let we=X,xe=Y;for(We(K,z,X,j),z[2*Y+de]>pe&&We(K,z,X,Y);we<xe;){for(We(K,z,we,xe),we++,xe--;z[2*we+de]<pe;)we++;for(;z[2*xe+de]>pe;)xe--}z[2*X+de]===pe?We(K,z,X,xe):(xe++,We(K,z,xe,Y)),xe<=j&&(X=xe+1),j<=xe&&(Y=xe-1)}}function We(K,z,j,X){cn(K,j,X),cn(z,2*j,2*X),cn(z,2*j+1,2*X+1)}function cn(K,z,j){const X=K[z];K[z]=K[j],K[j]=X}function Cn(K,z,j,X){const Y=K-j,de=z-X;return Y*Y+de*de}De.fromVectorTileJs=ct,De.fromGeojsonVt=function(K,z){z=z||{};var j={};for(var X in K)j[X]=new wt(K[X].features,z),j[X].name=X,j[X].version=z.version,j[X].extent=z.extent;return ct({layers:j})},De.GeoJSONWrapper=Ge;const Qt=K=>K[0],On=K=>K[1];class un{constructor(z,j=Qt,X=On,Y=64,de=Float64Array){this.nodeSize=Y,this.points=z;const pe=z.length<65536?Uint16Array:Uint32Array,we=this.ids=new pe(z.length),xe=this.coords=new de(2*z.length);for(let Pe=0;Pe<z.length;Pe++)we[Pe]=Pe,xe[2*Pe]=j(z[Pe]),xe[2*Pe+1]=X(z[Pe]);Nt(we,xe,Y,0,we.length-1,0)}range(z,j,X,Y){return function(de,pe,we,xe,Pe,Ke,vt){const Xe=[0,de.length-1,0],Yt=[];let Bt,Ut;for(;Xe.length;){const Xt=Xe.pop(),ke=Xe.pop(),Yn=Xe.pop();if(ke-Yn<=vt){for(let Mn=Yn;Mn<=ke;Mn++)Bt=pe[2*Mn],Ut=pe[2*Mn+1],Bt>=we&&Bt<=Pe&&Ut>=xe&&Ut<=Ke&&Yt.push(de[Mn]);continue}const Ot=Math.floor((Yn+ke)/2);Bt=pe[2*Ot],Ut=pe[2*Ot+1],Bt>=we&&Bt<=Pe&&Ut>=xe&&Ut<=Ke&&Yt.push(de[Ot]);const Gn=(Xt+1)%2;(0===Xt?we<=Bt:xe<=Ut)&&(Xe.push(Yn),Xe.push(Ot-1),Xe.push(Gn)),(0===Xt?Pe>=Bt:Ke>=Ut)&&(Xe.push(Ot+1),Xe.push(ke),Xe.push(Gn))}return Yt}(this.ids,this.coords,z,j,X,Y,this.nodeSize)}within(z,j,X){return function(Y,de,pe,we,xe,Pe){const Ke=[0,Y.length-1,0],vt=[],Xe=xe*xe;for(;Ke.length;){const Yt=Ke.pop(),Bt=Ke.pop(),Ut=Ke.pop();if(Bt-Ut<=Pe){for(let Gn=Ut;Gn<=Bt;Gn++)Cn(de[2*Gn],de[2*Gn+1],pe,we)<=Xe&&vt.push(Y[Gn]);continue}const Xt=Math.floor((Ut+Bt)/2),ke=de[2*Xt],Yn=de[2*Xt+1];Cn(ke,Yn,pe,we)<=Xe&&vt.push(Y[Xt]);const Ot=(Yt+1)%2;(0===Yt?pe-xe<=ke:we-xe<=Yn)&&(Ke.push(Ut),Ke.push(Xt-1),Ke.push(Ot)),(0===Yt?pe+xe>=ke:we+xe>=Yn)&&(Ke.push(Xt+1),Ke.push(Bt),Ke.push(Ot))}return vt}(this.ids,this.coords,z,j,X,this.nodeSize)}}const Vn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},cr=Math.fround||(Ct=new Float32Array(1),K=>(Ct[0]=+K,Ct[0]));var Ct;class kn{constructor(z){this.options=or(Object.create(Vn),z),this.trees=new Array(this.options.maxZoom+1)}load(z){const{log:j,minZoom:X,maxZoom:Y,nodeSize:de}=this.options;j&&console.time("total time");const pe=`prepare ${z.length} points`;j&&console.time(pe),this.points=z;let we=[];for(let xe=0;xe<z.length;xe++)z[xe].geometry&&we.push(kt(z[xe],xe));this.trees[Y+1]=new un(we,Xn,fn,de,Float32Array),j&&console.timeEnd(pe);for(let xe=Y;xe>=X;xe--){const Pe=+Date.now();we=this._cluster(we,xe),this.trees[xe]=new un(we,Xn,fn,de,Float32Array),j&&console.log("z%d: %d clusters in %dms",xe,we.length,+Date.now()-Pe)}return j&&console.timeEnd("total time"),this}getClusters(z,j){let X=((z[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,z[1]));let de=180===z[2]?180:((z[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)X=-180,de=180;else if(X>de){const Ke=this.getClusters([X,Y,180,pe],j),vt=this.getClusters([-180,Y,de,pe],j);return Ke.concat(vt)}const we=this.trees[this._limitZoom(j)],xe=we.range(ft(X),Sn(pe),ft(de),Sn(Y)),Pe=[];for(const Ke of xe){const vt=we.points[Ke];Pe.push(vt.numPoints?Gt(vt):this.points[vt.index])}return Pe}getChildren(z){const j=this._getOriginId(z),X=this._getOriginZoom(z),Y="No cluster with the specified id.",de=this.trees[X];if(!de)throw new Error(Y);const pe=de.points[j];if(!pe)throw new Error(Y);const we=this.options.radius/(this.options.extent*Math.pow(2,X-1)),xe=de.within(pe.x,pe.y,we),Pe=[];for(const Ke of xe){const vt=de.points[Ke];vt.parentId===z&&Pe.push(vt.numPoints?Gt(vt):this.points[vt.index])}if(0===Pe.length)throw new Error(Y);return Pe}getLeaves(z,j,X){const Y=[];return this._appendLeaves(Y,z,j=j||10,X=X||0,0),Y}getTile(z,j,X){const Y=this.trees[this._limitZoom(z)],de=Math.pow(2,z),{extent:pe,radius:we}=this.options,xe=we/pe,Pe=(X-xe)/de,Ke=(X+1+xe)/de,vt={features:[]};return this._addTileFeatures(Y.range((j-xe)/de,Pe,(j+1+xe)/de,Ke),Y.points,j,X,de,vt),0===j&&this._addTileFeatures(Y.range(1-xe/de,Pe,1,Ke),Y.points,de,X,de,vt),j===de-1&&this._addTileFeatures(Y.range(0,Pe,xe/de,Ke),Y.points,-1,X,de,vt),vt.features.length?vt:null}getClusterExpansionZoom(z){let j=this._getOriginZoom(z)-1;for(;j<=this.options.maxZoom;){const X=this.getChildren(z);if(j++,1!==X.length)break;z=X[0].properties.cluster_id}return j}_appendLeaves(z,j,X,Y,de){const pe=this.getChildren(j);for(const we of pe){const xe=we.properties;if(xe&&xe.cluster?de+xe.point_count<=Y?de+=xe.point_count:de=this._appendLeaves(z,xe.cluster_id,X,Y,de):de<Y?de++:z.push(we),z.length===X)break}return de}_addTileFeatures(z,j,X,Y,de,pe){for(const we of z){const xe=j[we],Pe=xe.numPoints;let Ke,vt,Xe;if(Pe)Ke=wn(xe),vt=xe.x,Xe=xe.y;else{const Ut=this.points[xe.index];Ke=Ut.properties,vt=ft(Ut.geometry.coordinates[0]),Xe=Sn(Ut.geometry.coordinates[1])}const Yt={type:1,geometry:[[Math.round(this.options.extent*(vt*de-X)),Math.round(this.options.extent*(Xe*de-Y))]],tags:Ke};let Bt;Pe?Bt=xe.id:this.options.generateId?Bt=xe.index:this.points[xe.index].id&&(Bt=this.points[xe.index].id),void 0!==Bt&&(Yt.id=Bt),pe.features.push(Yt)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(+z,this.options.maxZoom+1))}_cluster(z,j){const X=[],{radius:Y,extent:de,reduce:pe,minPoints:we}=this.options,xe=Y/(de*Math.pow(2,j));for(let Pe=0;Pe<z.length;Pe++){const Ke=z[Pe];if(Ke.zoom<=j)continue;Ke.zoom=j;const vt=this.trees[j+1],Xe=vt.within(Ke.x,Ke.y,xe),Yt=Ke.numPoints||1;let Bt=Yt;for(const Ut of Xe){const Xt=vt.points[Ut];Xt.zoom>j&&(Bt+=Xt.numPoints||1)}if(Bt>Yt&&Bt>=we){let Ut=Ke.x*Yt,Xt=Ke.y*Yt,ke=pe&&Yt>1?this._map(Ke,!0):null;const Yn=(Pe<<5)+(j+1)+this.points.length;for(const Ot of Xe){const Gn=vt.points[Ot];if(Gn.zoom<=j)continue;Gn.zoom=j;const Mn=Gn.numPoints||1;Ut+=Gn.x*Mn,Xt+=Gn.y*Mn,Gn.parentId=Yn,pe&&(ke||(ke=this._map(Ke,!0)),pe(ke,this._map(Gn)))}Ke.parentId=Yn,X.push(qe(Ut/Bt,Xt/Bt,Yn,Bt,ke))}else if(X.push(Ke),Bt>1)for(const Ut of Xe){const Xt=vt.points[Ut];Xt.zoom<=j||(Xt.zoom=j,X.push(Xt))}}return X}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,j){if(z.numPoints)return j?or({},z.properties):z.properties;const X=this.points[z.index].properties,Y=this.options.map(X);return j&&Y===X?or({},Y):Y}}function qe(K,z,j,X,Y){return{x:cr(K),y:cr(z),zoom:1/0,id:j,parentId:-1,numPoints:X,properties:Y}}function kt(K,z){const[j,X]=K.geometry.coordinates;return{x:cr(ft(j)),y:cr(Sn(X)),zoom:1/0,index:z,parentId:-1}}function Gt(K){return{type:"Feature",id:K.id,properties:wn(K),geometry:{type:"Point",coordinates:[(z=K.x,360*(z-.5)),Ur(K.y)]}};var z}function wn(K){const z=K.numPoints,j=z>=1e4?`${Math.round(z/1e3)}k`:z>=1e3?Math.round(z/100)/10+"k":z;return or(or({},K.properties),{cluster:!0,cluster_id:K.id,point_count:z,point_count_abbreviated:j})}function ft(K){return K/360+.5}function Sn(K){const z=Math.sin(K*Math.PI/180),j=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return j<0?0:j>1?1:j}function Ur(K){const z=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function or(K,z){for(const j in z)K[j]=z[j];return K}function Xn(K){return K.x}function fn(K){return K.y}function sr(K,z,j,X){for(var Y,de=X,pe=j-z>>1,we=j-z,xe=K[z],Pe=K[z+1],Ke=K[j],vt=K[j+1],Xe=z+3;Xe<j;Xe+=3){var Yt=Ln(K[Xe],K[Xe+1],xe,Pe,Ke,vt);if(Yt>de)Y=Xe,de=Yt;else if(Yt===de){var Bt=Math.abs(Xe-pe);Bt<we&&(Y=Xe,we=Bt)}}de>X&&(Y-z>3&&sr(K,z,Y,X),K[Y+2]=de,j-Y>3&&sr(K,Y,j,X))}function Ln(K,z,j,X,Y,de){var pe=Y-j,we=de-X;if(0!==pe||0!==we){var xe=((K-j)*pe+(z-X)*we)/(pe*pe+we*we);xe>1?(j=Y,X=de):xe>0&&(j+=pe*xe,X+=we*xe)}return(pe=K-j)*pe+(we=z-X)*we}function Di(K,z,j,X){var Y={id:void 0===K?null:K,type:z,geometry:j,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var pe=de.geometry,we=de.type;if("Point"===we||"MultiPoint"===we||"LineString"===we)Vr(de,pe);else if("Polygon"===we||"MultiLineString"===we)for(var xe=0;xe<pe.length;xe++)Vr(de,pe[xe]);else if("MultiPolygon"===we)for(xe=0;xe<pe.length;xe++)for(var Pe=0;Pe<pe[xe].length;Pe++)Vr(de,pe[xe][Pe])}(Y),Y}function Vr(K,z){for(var j=0;j<z.length;j+=3)K.minX=Math.min(K.minX,z[j]),K.minY=Math.min(K.minY,z[j+1]),K.maxX=Math.max(K.maxX,z[j]),K.maxY=Math.max(K.maxY,z[j+1])}function Ri(K,z,j,X){if(z.geometry){var Y=z.geometry.coordinates,de=z.geometry.type,pe=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),we=[],xe=z.id;if(j.promoteId?xe=z.properties[j.promoteId]:j.generateId&&(xe=X||0),"Point"===de)Co(Y,we);else if("MultiPoint"===de)for(var Pe=0;Pe<Y.length;Pe++)Co(Y[Pe],we);else if("LineString"===de)Or(Y,we,pe,!1);else if("MultiLineString"===de){if(j.lineMetrics){for(Pe=0;Pe<Y.length;Pe++)Or(Y[Pe],we=[],pe,!1),K.push(Di(xe,"LineString",we,z.properties));return}Ji(Y,we,pe,!1)}else if("Polygon"===de)Ji(Y,we,pe,!0);else{if("MultiPolygon"!==de){if("GeometryCollection"===de){for(Pe=0;Pe<z.geometry.geometries.length;Pe++)Ri(K,{id:xe,geometry:z.geometry.geometries[Pe],properties:z.properties},j,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Pe=0;Pe<Y.length;Pe++){var Ke=[];Ji(Y[Pe],Ke,pe,!0),we.push(Ke)}}K.push(Di(xe,de,we,z.properties))}}function Co(K,z){z.push(Gi(K[0])),z.push(No(K[1])),z.push(0)}function Or(K,z,j,X){for(var Y,de,pe=0,we=0;we<K.length;we++){var xe=Gi(K[we][0]),Pe=No(K[we][1]);z.push(xe),z.push(Pe),z.push(0),we>0&&(pe+=X?(Y*Pe-xe*de)/2:Math.sqrt(Math.pow(xe-Y,2)+Math.pow(Pe-de,2))),Y=xe,de=Pe}var Ke=z.length-3;z[2]=1,sr(z,0,Ke,j),z[Ke+2]=1,z.size=Math.abs(pe),z.start=0,z.end=z.size}function Ji(K,z,j,X){for(var Y=0;Y<K.length;Y++){var de=[];Or(K[Y],de,j,X),z.push(de)}}function Gi(K){return K/360+.5}function No(K){var z=Math.sin(K*Math.PI/180),j=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return j<0?0:j>1?1:j}function hi(K,z,j,X,Y,de,pe,we){if(X/=z,de>=(j/=z)&&pe<X)return K;if(pe<j||de>=X)return null;for(var xe=[],Pe=0;Pe<K.length;Pe++){var Ke=K[Pe],vt=Ke.geometry,Xe=Ke.type,Yt=0===Y?Ke.minX:Ke.minY,Bt=0===Y?Ke.maxX:Ke.maxY;if(Yt>=j&&Bt<X)xe.push(Ke);else if(!(Bt<j||Yt>=X)){var Ut=[];if("Point"===Xe||"MultiPoint"===Xe)Si(vt,Ut,j,X,Y);else if("LineString"===Xe)Qi(vt,Ut,j,X,Y,!1,we.lineMetrics);else if("MultiLineString"===Xe)es(vt,Ut,j,X,Y,!1);else if("Polygon"===Xe)es(vt,Ut,j,X,Y,!0);else if("MultiPolygon"===Xe)for(var Xt=0;Xt<vt.length;Xt++){var ke=[];es(vt[Xt],ke,j,X,Y,!0),ke.length&&Ut.push(ke)}if(Ut.length){if(we.lineMetrics&&"LineString"===Xe){for(Xt=0;Xt<Ut.length;Xt++)xe.push(Di(Ke.id,Xe,Ut[Xt],Ke.tags));continue}"LineString"!==Xe&&"MultiLineString"!==Xe||(1===Ut.length?(Xe="LineString",Ut=Ut[0]):Xe="MultiLineString"),"Point"!==Xe&&"MultiPoint"!==Xe||(Xe=3===Ut.length?"Point":"MultiPoint"),xe.push(Di(Ke.id,Xe,Ut,Ke.tags))}}}return xe.length?xe:null}function Si(K,z,j,X,Y){for(var de=0;de<K.length;de+=3){var pe=K[de+Y];pe>=j&&pe<=X&&(z.push(K[de]),z.push(K[de+1]),z.push(K[de+2]))}}function Qi(K,z,j,X,Y,de,pe){for(var we,xe,Pe=Bo(K),Ke=0===Y?ts:ws,vt=K.start,Xe=0;Xe<K.length-3;Xe+=3){var Yt=K[Xe],Bt=K[Xe+1],Ut=K[Xe+2],Xt=K[Xe+3],ke=K[Xe+4],Yn=0===Y?Yt:Bt,Ot=0===Y?Xt:ke,Gn=!1;pe&&(we=Math.sqrt(Math.pow(Yt-Xt,2)+Math.pow(Bt-ke,2))),Yn<j?Ot>j&&(xe=Ke(Pe,Yt,Bt,Xt,ke,j),pe&&(Pe.start=vt+we*xe)):Yn>X?Ot<X&&(xe=Ke(Pe,Yt,Bt,Xt,ke,X),pe&&(Pe.start=vt+we*xe)):bs(Pe,Yt,Bt,Ut),Ot<j&&Yn>=j&&(xe=Ke(Pe,Yt,Bt,Xt,ke,j),Gn=!0),Ot>X&&Yn<=X&&(xe=Ke(Pe,Yt,Bt,Xt,ke,X),Gn=!0),!de&&Gn&&(pe&&(Pe.end=vt+we*xe),z.push(Pe),Pe=Bo(K)),pe&&(vt+=we)}var Mn=K.length-3;Yt=K[Mn],Bt=K[Mn+1],Ut=K[Mn+2],(Yn=0===Y?Yt:Bt)>=j&&Yn<=X&&bs(Pe,Yt,Bt,Ut),Mn=Pe.length-3,de&&Mn>=3&&(Pe[Mn]!==Pe[0]||Pe[Mn+1]!==Pe[1])&&bs(Pe,Pe[0],Pe[1],Pe[2]),Pe.length&&z.push(Pe)}function Bo(K){var z=[];return z.size=K.size,z.start=K.start,z.end=K.end,z}function es(K,z,j,X,Y,de){for(var pe=0;pe<K.length;pe++)Qi(K[pe],z,j,X,Y,de,!1)}function bs(K,z,j,X){K.push(z),K.push(j),K.push(X)}function ts(K,z,j,X,Y,de){var pe=(de-z)/(X-z);return K.push(de),K.push(j+(Y-j)*pe),K.push(1),pe}function ws(K,z,j,X,Y,de){var pe=(de-j)/(Y-j);return K.push(z+(X-z)*pe),K.push(de),K.push(1),pe}function Vs(K,z){for(var j=[],X=0;X<K.length;X++){var Y,de=K[X],pe=de.type;if("Point"===pe||"MultiPoint"===pe||"LineString"===pe)Y=gi(de.geometry,z);else if("MultiLineString"===pe||"Polygon"===pe){Y=[];for(var we=0;we<de.geometry.length;we++)Y.push(gi(de.geometry[we],z))}else if("MultiPolygon"===pe)for(Y=[],we=0;we<de.geometry.length;we++){for(var xe=[],Pe=0;Pe<de.geometry[we].length;Pe++)xe.push(gi(de.geometry[we][Pe],z));Y.push(xe)}j.push(Di(de.id,pe,Y,de.tags))}return j}function gi(K,z){var j=[];j.size=K.size,void 0!==K.start&&(j.start=K.start,j.end=K.end);for(var X=0;X<K.length;X+=3)j.push(K[X]+z,K[X+1],K[X+2]);return j}function $s(K,z){if(K.transformed)return K;var j,X,Y,de=1<<K.z,pe=K.x,we=K.y;for(j=0;j<K.features.length;j++){var xe=K.features[j],Pe=xe.geometry,Ke=xe.type;if(xe.geometry=[],1===Ke)for(X=0;X<Pe.length;X+=2)xe.geometry.push(Ii(Pe[X],Pe[X+1],z,de,pe,we));else for(X=0;X<Pe.length;X++){var vt=[];for(Y=0;Y<Pe[X].length;Y+=2)vt.push(Ii(Pe[X][Y],Pe[X][Y+1],z,de,pe,we));xe.geometry.push(vt)}}return K.transformed=!0,K}function Ii(K,z,j,X,Y,de){return[Math.round(j*(K*X-Y)),Math.round(j*(z*X-de))]}function Es(K,z,j,X,Y){for(var de=z===Y.maxZoom?0:Y.tolerance/((1<<z)*Y.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:X,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},we=0;we<K.length;we++){pe.numFeatures++,_i(pe,K[we],de,Y);var xe=K[we].minX,Pe=K[we].minY,Ke=K[we].maxX,vt=K[we].maxY;xe<pe.minX&&(pe.minX=xe),Pe<pe.minY&&(pe.minY=Pe),Ke>pe.maxX&&(pe.maxX=Ke),vt>pe.maxY&&(pe.maxY=vt)}return pe}function _i(K,z,j,X){var Y=z.geometry,de=z.type,pe=[];if("Point"===de||"MultiPoint"===de)for(var we=0;we<Y.length;we+=3)pe.push(Y[we]),pe.push(Y[we+1]),K.numPoints++,K.numSimplified++;else if("LineString"===de)$r(pe,Y,K,j,!1,!1);else if("MultiLineString"===de||"Polygon"===de)for(we=0;we<Y.length;we++)$r(pe,Y[we],K,j,"Polygon"===de,0===we);else if("MultiPolygon"===de)for(var xe=0;xe<Y.length;xe++){var Pe=Y[xe];for(we=0;we<Pe.length;we++)$r(pe,Pe[we],K,j,!0,0===we)}if(pe.length){var Ke=z.tags||null;if("LineString"===de&&X.lineMetrics){for(var vt in Ke={},z.tags)Ke[vt]=z.tags[vt];Ke.mapbox_clip_start=Y.start/Y.size,Ke.mapbox_clip_end=Y.end/Y.size}var Xe={geometry:pe,type:"Polygon"===de||"MultiPolygon"===de?3:"LineString"===de||"MultiLineString"===de?2:1,tags:Ke};null!==z.id&&(Xe.id=z.id),K.features.push(Xe)}}function $r(K,z,j,X,Y,de){var pe=X*X;if(X>0&&z.size<(Y?pe:X))j.numPoints+=z.length/3;else{for(var we=[],xe=0;xe<z.length;xe+=3)(0===X||z[xe+2]>pe)&&(j.numSimplified++,we.push(z[xe]),we.push(z[xe+1])),j.numPoints++;Y&&function(Pe,Ke){for(var vt=0,Xe=0,Yt=Pe.length,Bt=Yt-2;Xe<Yt;Bt=Xe,Xe+=2)vt+=(Pe[Xe]-Pe[Bt])*(Pe[Xe+1]+Pe[Bt+1]);if(vt>0===Ke)for(Xe=0,Yt=Pe.length;Xe<Yt/2;Xe+=2){var Ut=Pe[Xe],Xt=Pe[Xe+1];Pe[Xe]=Pe[Yt-2-Xe],Pe[Xe+1]=Pe[Yt-1-Xe],Pe[Yt-2-Xe]=Ut,Pe[Yt-1-Xe]=Xt}}(we,de),K.push(we)}}function Zn(K,z){var j=(z=this.options=function(Y,de){for(var pe in de)Y[pe]=de[pe];return Y}(Object.create(this.options),z)).debug;if(j&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y,de,pe,we,xe,Pe,X=function(Y,de){var pe=[];if("FeatureCollection"===Y.type)for(var we=0;we<Y.features.length;we++)Ri(pe,Y.features[we],de,we);else Ri(pe,"Feature"===Y.type?Y:{geometry:Y},de);return pe}(K,z);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Y=X,de=z,pe=de.buffer/de.extent,we=Y,xe=hi(Y,1,-1-pe,pe,0,-1,2,de),Pe=hi(Y,1,1-pe,2+pe,0,-1,2,de),(xe||Pe)&&(we=hi(Y,1,-pe,1+pe,0,-1,2,de)||[],xe&&(we=Vs(xe,1).concat(we)),Pe&&(we=we.concat(Vs(Pe,-1)))),X=we).length&&this.splitTile(X,0,0,0),j&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function eo(K,z,j){return 32*((1<<K)*j+z)+K}function Kn(K,z){const j=K.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const X=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!X)return z(null,null);const Y=new Le(X.features);let de=De(Y);0===de.byteOffset&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),z(null,{vectorTile:Y,rawData:de.buffer})}Zn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Zn.prototype.splitTile=function(K,z,j,X,Y,de,pe){for(var we=[K,z,j,X],xe=this.options,Pe=xe.debug;we.length;){X=we.pop(),j=we.pop(),z=we.pop(),K=we.pop();var Ke=1<<z,vt=eo(z,j,X),Xe=this.tiles[vt];if(!Xe&&(Pe>1&&console.time("creation"),Xe=this.tiles[vt]=Es(K,z,j,X,xe),this.tileCoords.push({z,x:j,y:X}),Pe)){Pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,j,X,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));var Yt="z"+z;this.stats[Yt]=(this.stats[Yt]||0)+1,this.total++}if(Xe.source=K,Y){if(z===xe.maxZoom||z===Y)continue;var Bt=1<<Y-z;if(j!==Math.floor(de/Bt)||X!==Math.floor(pe/Bt))continue}else if(z===xe.indexMaxZoom||Xe.numPoints<=xe.indexMaxPoints)continue;if(Xe.source=null,0!==K.length){Pe>1&&console.time("clipping");var Ut,Xt,ke,Yn,Ot,Gn,Mn=.5*xe.buffer/xe.extent,ns=.5-Mn,Do=.5+Mn,xt=1+Mn;Ut=Xt=ke=Yn=null,Ot=hi(K,Ke,j-Mn,j+Do,0,Xe.minX,Xe.maxX,xe),Gn=hi(K,Ke,j+ns,j+xt,0,Xe.minX,Xe.maxX,xe),K=null,Ot&&(Ut=hi(Ot,Ke,X-Mn,X+Do,1,Xe.minY,Xe.maxY,xe),Xt=hi(Ot,Ke,X+ns,X+xt,1,Xe.minY,Xe.maxY,xe),Ot=null),Gn&&(ke=hi(Gn,Ke,X-Mn,X+Do,1,Xe.minY,Xe.maxY,xe),Yn=hi(Gn,Ke,X+ns,X+xt,1,Xe.minY,Xe.maxY,xe),Gn=null),Pe>1&&console.timeEnd("clipping"),we.push(Ut||[],z+1,2*j,2*X),we.push(Xt||[],z+1,2*j,2*X+1),we.push(ke||[],z+1,2*j+1,2*X),we.push(Yn||[],z+1,2*j+1,2*X+1)}}},Zn.prototype.getTile=function(K,z,j){var X=this.options,Y=X.extent,de=X.debug;if(K<0||K>24)return null;var pe=1<<K,we=eo(K,z=(z%pe+pe)%pe,j);if(this.tiles[we])return $s(this.tiles[we],Y);de>1&&console.log("drilling down to z%d-%d-%d",K,z,j);for(var xe,Pe=K,Ke=z,vt=j;!xe&&Pe>0;)Pe--,Ke=Math.floor(Ke/2),vt=Math.floor(vt/2),xe=this.tiles[eo(Pe,Ke,vt)];return xe&&xe.source?(de>1&&console.log("found parent tile z%d-%d-%d",Pe,Ke,vt),de>1&&console.time("drilling down"),this.splitTile(xe.source,Pe,Ke,vt,K,z,j),de>1&&console.timeEnd("drilling down"),this.tiles[we]?$s(this.tiles[we],Y):null):null};class Oi extends f.VectorTileWorkerSource{constructor(z,j,X,Y,de){super(z,j,X,Y,Kn),de&&(this.loadGeoJSON=de)}loadData(z,j){const X=z&&z.request,Y=X&&X.collectResourceTiming;this.loadGeoJSON(z,(de,pe)=>{if(de||!pe)return j(de);if("object"!=typeof pe)return j(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{me(pe,!0);try{if(z.filter){const xe=f.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===xe.result)throw new Error(xe.value.map(Ke=>`${Ke.key}: ${Ke.message}`).join(", "));const Pe=pe.features.filter(Ke=>xe.value.evaluate({zoom:0},Ke));pe={type:"FeatureCollection",features:Pe}}this._geoJSONIndex=z.cluster?new kn(function({superclusterOptions:xe,clusterProperties:Pe}){if(!Pe||!xe)return xe;const Ke={},vt={},Xe={accumulated:null,zoom:0},Yt={properties:null},Bt=Object.keys(Pe);for(const Ut of Bt){const[Xt,ke]=Pe[Ut],Yn=f.createExpression(ke),Ot=f.createExpression("string"==typeof Xt?[Xt,["accumulated"],["get",Ut]]:Xt);Ke[Ut]=Yn.value,vt[Ut]=Ot.value}return xe.map=Ut=>{Yt.properties=Ut;const Xt={};for(const ke of Bt)Xt[ke]=Ke[ke].evaluate(Xe,Yt);return Xt},xe.reduce=(Ut,Xt)=>{Yt.properties=Xt;for(const ke of Bt)Xe.accumulated=Ut[ke],Ut[ke]=vt[ke].evaluate(Xe,Yt)},xe}(z)).load(pe.features):new Zn(xe=pe,z.geojsonVtOptions)}catch(xe){return j(xe)}this.loaded={};const we={};if(Y){const xe=f.getPerformanceMeasurement(X);xe&&(we.resourceTiming={},we.resourceTiming[z.source]=JSON.parse(JSON.stringify(xe)))}j(null,we)}var xe})}reloadTile(z,j){const X=this.loaded;return X&&X[z.uid]?super.reloadTile(z,j):this.loadTile(z,j)}loadGeoJSON(z,j){if(z.request)f.getJSON(z.request,j);else{if("string"!=typeof z.data)return j(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(z.data))}catch(X){return j(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(z,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(X){j(X)}}getClusterChildren(z,j){try{j(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(X){j(X)}}getClusterLeaves(z,j){try{j(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(X){j(X)}}}class Uo{constructor(z){this.self=z,this.actor=new f.Actor(z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=f.getProjection({name:"mercator"}),this.workerSourceTypes={vector:f.VectorTileWorkerSource,geojson:Oi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,X)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=X},this.self.registerRTLTextPlugin=j=>{if(f.plugin.isParsed())throw new Error("RTL text plugin already registered.");f.plugin.applyArabicShaping=j.applyArabicShaping,f.plugin.processBidirectionalText=j.processBidirectionalText,f.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(z,j,X){delete this.layerIndexes[z],delete this.availableImages[z],delete this.workerSources[z],delete this.demWorkerSources[z],X()}checkIfReady(z,j,X){X()}setReferrer(z,j){this.referrer=j}spriteLoaded(z,j){this.isSpriteLoaded[z]=j;for(const X in this.workerSources[z]){const Y=this.workerSources[z][X];for(const de in Y)Y[de]instanceof f.VectorTileWorkerSource&&(Y[de].isSpriteLoaded=j,Y[de].fire(new f.Event("isSpriteLoaded")))}}setImages(z,j,X){this.availableImages[z]=j;for(const Y in this.workerSources[z]){const de=this.workerSources[z][Y];for(const pe in de)de[pe].availableImages=j}X()}enableTerrain(z,j,X){this.terrain=j,X()}setProjection(z,j){this.projections[z]=f.getProjection(j)}setLayers(z,j,X){this.getLayerIndex(z).replace(j),X()}updateLayers(z,j,X){this.getLayerIndex(z).update(j.layers,j.removedIds),X()}loadTile(z,j,X){const Y=this.enableTerrain?f.extend({enableTerrain:this.terrain},j):j;Y.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,j.type,j.source).loadTile(Y,X)}loadDEMTile(z,j,X){const Y=this.enableTerrain?f.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(z,j.source).loadTile(Y,X)}reloadTile(z,j,X){const Y=this.enableTerrain?f.extend({enableTerrain:this.terrain},j):j;Y.projection=this.projections[z]||this.defaultProjection,this.getWorkerSource(z,j.type,j.source).reloadTile(Y,X)}abortTile(z,j,X){this.getWorkerSource(z,j.type,j.source).abortTile(j,X)}removeTile(z,j,X){this.getWorkerSource(z,j.type,j.source).removeTile(j,X)}removeSource(z,j,X){if(!this.workerSources[z]||!this.workerSources[z][j.type]||!this.workerSources[z][j.type][j.source])return;const Y=this.workerSources[z][j.type][j.source];delete this.workerSources[z][j.type][j.source],void 0!==Y.removeSource?Y.removeSource(j,X):X()}loadWorkerSource(z,j,X){try{this.self.importScripts(j.url),X()}catch(Y){X(Y.toString())}}syncRTLPluginState(z,j,X){try{f.plugin.setState(j);const Y=f.plugin.getPluginURL();if(f.plugin.isLoaded()&&!f.plugin.isParsed()&&null!=Y){this.self.importScripts(Y);const de=f.plugin.isParsed();X(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),de)}}catch(Y){X(Y.toString())}}getAvailableImages(z){let j=this.availableImages[z];return j||(j=[]),j}getLayerIndex(z){let j=this.layerIndexes[z];return j||(j=this.layerIndexes[z]=new Ue),j}getWorkerSource(z,j,X){return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][j]||(this.workerSources[z][j]={}),this.workerSources[z][j][X]||(this.workerSources[z][j][X]=new this.workerSourceTypes[j]({send:(Y,de,pe,we,xe,Pe)=>{this.actor.send(Y,de,pe,z,xe,Pe)},scheduler:this.actor.scheduler},this.getLayerIndex(z),this.getAvailableImages(z),this.isSpriteLoaded[z])),this.workerSources[z][j][X]}getDEMWorkerSource(z,j){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][j]||(this.demWorkerSources[z][j]=new se),this.demWorkerSources[z][j]}enforceCacheSizeLimit(z,j){f.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(z,j,X){X(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Uo(self)),Uo}),it(0,function(f){var Se=Ie;function Ie(p){return i=p,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,b,w=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(w);try{b=new Worker(C),_=!0}catch(S){_=!1}return b&&b.terminate(),URL.revokeObjectURL(C),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var b=_.getContext("2d");if(!b)return!1;var w=b.getImageData(0,0,1,1);return w&&w.width===_.width}()||(void 0===Ue[h=i&&i.failIfMajorPerformanceCaveat]&&(Ue[h]=function(_){var b,C,S,P,w=(C=_,S=document.createElement("canvas"),(P=Object.create(Ie.webGLContextAttributes)).failIfMajorPerformanceCaveat=C,S.getContext("webgl",P)||S.getContext("experimental-webgl",P));if(!w)return!1;try{b=w.createShader(w.VERTEX_SHADER)}catch(C){return!1}return!(!b||w.isContextLost())&&(w.shaderSource(b,"void main() {}"),w.compileShader(b),!0===w.getShaderParameter(b,w.COMPILE_STATUS))}(h)),!Ue[h]||document.documentMode));var i,h}var Ue={};function se(p,i){if(Array.isArray(p)){if(!Array.isArray(i)||p.length!==i.length)return!1;for(let h=0;h<p.length;h++)if(!se(p[h],i[h]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==i){if("object"!=typeof i||Object.keys(p).length!==Object.keys(i).length)return!1;for(const h in p)if(!se(p[h],i[h]))return!1;return!0}return p===i}function me(p,i,h){const _=f.window.document.createElement(p);return void 0!==i&&(_.className=i),h&&h.appendChild(_),_}function ae(p,i,h){const _=f.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const b of Object.keys(i))_.setAttributeNS(null,b,i[b]);return h&&h.appendChild(_),_}Ie.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ge=f.window.document&&f.window.document.documentElement.style,_e=ge&&void 0!==ge.userSelect?"userSelect":"WebkitUserSelect";let ve;function Le(){ge&&_e&&(ve=ge[_e],ge[_e]="none")}function yt(){ge&&_e&&(ge[_e]=ve)}function wt(p){p.preventDefault(),p.stopPropagation(),f.window.removeEventListener("click",wt,!0)}function rt(){f.window.addEventListener("click",wt,!0),f.window.setTimeout(()=>{f.window.removeEventListener("click",wt,!0)},0)}function Ze(p,i){const h=p.getBoundingClientRect();return ct(p,h,i)}function De(p,i){const h=p.getBoundingClientRect(),_=[];for(let b=0;b<i.length;b++)_.push(ct(p,h,i[b]));return _}function Ge(p){return void 0!==f.window.InstallTrigger&&2===p.button&&p.ctrlKey&&f.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function ct(p,i,h){const _=p.offsetWidth===i.width?1:p.offsetWidth/i.width;return new f.pointGeometry((h.clientX-i.left)*_,(h.clientY-i.top)*_)}function gt(p,i){var h=i[0],_=i[1],b=i[2],w=i[3],C=h*w-b*_;return C?(p[0]=w*(C=1/C),p[1]=-_*C,p[2]=-b*C,p[3]=h*C,p):null}function Kt(p){const{userImage:i}=p;return!!(i&&i.render&&i.render())&&(p.data.replace(new Uint8Array(i.data.buffer)),!0)}class en extends f.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,h){this._validate(i,h)&&(this.images[i]=h)}_validate(i,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new f.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new f.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new f.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),_=!1),_}_validateStretch(i,h){if(!i)return!0;let _=0;for(const b of i){if(b[0]<_||b[1]<b[0]||h<b[1])return!1;_=b[1]}return!0}_validateContent(i,h){return!(i&&(4!==i.length||i[0]<0||h.data.width<i[0]||i[1]<0||h.data.height<i[1]||i[2]<0||h.data.width<i[2]||i[3]<0||h.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,h){h.version=this.images[i].version+1,this.images[i]=h,this.updatedImages[i]=!0}removeImage(i){const h=this.images[i];delete this.images[i],delete this.patterns[i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,h){let _=!0;if(!this.isLoaded())for(const b of i)this.images[b]||(_=!1);this.isLoaded()||_?this._notify(i,h):this.requestors.push({ids:i,callback:h})}_notify(i,h){const _={};for(const b of i){this.images[b]||this.fire(new f.Event("styleimagemissing",{id:b}));const w=this.images[b];w?_[b]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:Boolean(w.userImage&&w.userImage.render)}:f.warnOnce(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:i,height:h}=this.atlasImage;return{width:i,height:h}}getPattern(i){const h=this.patterns[i],_=this.getImage(i);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new f.ImagePosition(b,_);this.patterns[i]={bin:b,position:w}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const h=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.Texture(i,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const w in this.patterns)i.push(this.patterns[w].bin);const{w:h,h:_}=f.potpack(i),b=this.atlasImage;b.resize({width:h||1,height:_||1});for(const w in this.patterns){const{bin:C}=this.patterns[w],S=C.x+1,P=C.y+1,R=this.images[w].data,L=R.width,B=R.height;f.RGBAImage.copy(R,b,{x:0,y:0},{x:S,y:P},{width:L,height:B}),f.RGBAImage.copy(R,b,{x:0,y:B-1},{x:S,y:P-1},{width:L,height:1}),f.RGBAImage.copy(R,b,{x:0,y:0},{x:S,y:P+B},{width:L,height:1}),f.RGBAImage.copy(R,b,{x:L-1,y:0},{x:S-1,y:P},{width:1,height:B}),f.RGBAImage.copy(R,b,{x:0,y:0},{x:S+L,y:P},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const h of i){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];Kt(_)&&this.updateImage(h,_)}}}const rn=new f.Properties({anchor:new f.DataConstantProperty(f.spec.light.anchor),position:new class{constructor(){this.specification=f.spec.light.position}possiblyEvaluate(p,i){return function([h,_,b]){const w=f.degToRad(_+90),C=f.degToRad(b);return{x:h*Math.cos(w)*Math.sin(C),y:h*Math.sin(w)*Math.sin(C),z:h*Math.cos(C),azimuthal:_,polar:b}}(p.expression.evaluate(i))}interpolate(p,i,h){return{x:f.number(p.x,i.x,h),y:f.number(p.y,i.y,h),z:f.number(p.z,i.z,h),azimuthal:f.number(p.azimuthal,i.azimuthal,h),polar:f.number(p.polar,i.polar,h)}}},color:new f.DataConstantProperty(f.spec.light.color),intensity:new f.DataConstantProperty(f.spec.light.intensity)}),Wt="-transition";class St extends f.Evented{constructor(i){super(),this._transitionable=new f.Transitionable(rn),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,h={}){if(!this._validate(f.validateLight,i,h))for(const _ in i){const b=i[_];f.endsWith(_,Wt)?this._transitionable.setTransition(_.slice(0,-Wt.length),b):this._transitionable.setValue(_,b)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,_){return(!_||!1!==_.validate)&&f.emitValidationErrors(this,i.call(f.validateStyle,f.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}const Tt=new f.Properties({source:new f.DataConstantProperty(f.spec.terrain.source),exaggeration:new f.DataConstantProperty(f.spec.terrain.exaggeration)}),Nt="-transition";class tt extends f.Evented{constructor(i,h){super(),this._transitionable=new f.Transitionable(Tt),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(i){for(const h in i){const _=i[h];f.endsWith(h,Nt)?this._transitionable.setTransition(h.slice(0,-Nt.length),_):this._transitionable.setValue(h,_)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function We(p,i,h,_){const b=f.smoothstep(45,65,h),[w,C]=cn(p,_),S=f.length(i);let P=1-Math.min(1,Math.exp((S-w)/(C-w)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*b*p.alpha}function cn(p,i){const h=.5/Math.tan(.5*i);return[p.range[0]+h,p.range[1]+h]}const Cn=new f.Properties({range:new f.DataConstantProperty(f.spec.fog.range),color:new f.DataConstantProperty(f.spec.fog.color),"horizon-blend":new f.DataConstantProperty(f.spec.fog["horizon-blend"])}),Qt="-transition";class On extends f.Evented{constructor(i,h){super(),this._transitionable=new f.Transitionable(Cn),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,h={}){if(!this._validate(f.validateFog,i,h))for(const _ in i){const b=i[_];f.endsWith(_,Qt)?this._transitionable.setTransition(_.slice(0,-Qt.length),b):this._transitionable.setValue(_,b)}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return f.smoothstep(45,65,i)*h.a}getOpacityAtLatLng(i,h){return this._transform.projection.supportsFog?function(_,b,w){const C=f.MercatorCoordinate.fromLngLat(b),S=w.elevation?w.elevation.getAtPointOrZero(C):0,P=[C.x,C.y,S];return f.transformMat4(P,P,w.mercatorFogMatrix),We(_,P,w.pitch,w._fov)}(this.state,i,h):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?cn(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,_){return(!_||!1!==_.validate)&&f.emitValidationErrors(this,i.call(f.validateStyle,f.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:f.spec})))}}class un{constructor(i,h){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=f.uniqueId();const _=this.workerPool.acquire(this.id);for(let b=0;b<_.length;b++){const w=new un.Actor(_[b],h,this.id);w.name=`Worker ${b}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,h,_){f.asyncAll(this.actors,(b,w)=>{b.send(i,h,w)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Vn(p,i,h){return i*(f.EXTENT/(p.tileSize*Math.pow(2,h-p.tileID.overscaledZ)))}un.Actor=f.Actor;class cr{constructor(i,h,_,b){this.screenBounds=i,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(w=>b.pointCoordinate3D(w)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(i,h){let _,b;if(i instanceof f.pointGeometry||"number"==typeof i[0]){const w=f.pointGeometry.convert(i);_=[f.pointGeometry.convert(i)],b=h.isPointAboveHorizon(w)}else{const w=f.pointGeometry.convert(i[0]),C=f.pointGeometry.convert(i[1]);_=[w,C],b=f.polygonizeBounds(w,C).every(S=>h.isPointAboveHorizon(S))}return new cr(_,h.getCameraPoint(),b,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return f.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new f.pointGeometry(1,1)):this.screenBounds[1],b=f.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?b[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(b[3]=this.cameraPoint)),f.bufferConvexPolygon(b,i)}containsTile(i,h,_){const b=i.queryPadding+1,w=i.tileID.wrap,C=_?this._bufferedCameraMercator(b,h).map(q=>f.getTilePoint(i.tileTransform,q,w)):this._bufferedScreenMercator(b,h).map(q=>f.getTilePoint(i.tileTransform,q,w)),S=this.screenGeometryMercator.map(q=>f.getTileVec3(i.tileTransform,q,w)),P=S.map(q=>new f.pointGeometry(q[0],q[1])),R=h.getFreeCameraOptions().position||new f.MercatorCoordinate(0,0,0),L=f.getTileVec3(i.tileTransform,R,w),B=S.map(q=>{const V=f.sub(q,q,L);return f.normalize(V,V),new f.Ray(L,V)}),$=Vn(i,1,h.zoom);if(f.polygonIntersectsBox(C,0,0,f.EXTENT,f.EXTENT))return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:B,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(W=f.getBounds(C),W.min.x=f.clamp(W.min.x,0,f.EXTENT),W.min.y=f.clamp(W.min.y,0,f.EXTENT),W.max.x=f.clamp(W.max.x,0,f.EXTENT),W.max.y=f.clamp(W.max.y,0,f.EXTENT),W),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:$};var W}_bufferedScreenMercator(i,h){const _=Ct(i);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{const b=this.bufferedScreenGeometry(i).map(w=>h.pointCoordinate3D(w));return this._screenRaycastCache[_]=b,b}}_bufferedCameraMercator(i,h){const _=Ct(i);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{const b=this.bufferedCameraGeometry(i).map(w=>h.pointCoordinate3D(w));return this._cameraRaycastCache[_]=b,b}}}function Ct(p){return 100*p|0}function kn(p,i,h){const _=function(b,w){if(b)return h(b);if(w){const C=f.pick(f.extend(w,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(C.vectorLayers=w.vector_layers,C.vectorLayerIds=C.vectorLayers.map(S=>S.id)),C.tiles=i.canonicalizeTileset(C,p.url),h(null,C)}};return p.url?f.getJSON(i.transformRequest(i.normalizeSourceURL(p.url),f.ResourceType.Source),_):f.exported.frame(()=>_(null,p))}class qe{constructor(i,h,_){this.bounds=f.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const h=Math.pow(2,i.z),_=Math.floor(f.mercatorXfromLng(this.bounds.getWest())*h),b=Math.floor(f.mercatorYfromLat(this.bounds.getNorth())*h),w=Math.ceil(f.mercatorXfromLng(this.bounds.getEast())*h),C=Math.ceil(f.mercatorYfromLat(this.bounds.getSouth())*h);return i.x>=_&&i.x<w&&i.y>=b&&i.y<C}}class kt{constructor(i,h,_){this.context=i;const b=i.gl;this.buffer=b.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Gt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class wn{constructor(i,h,_,b){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=b,this.context=i;const w=i.gl;this.buffer=w.createBuffer(),i.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,h){for(let _=0;_<this.attributes.length;_++){const b=h.attributes[this.attributes[_].name];void 0!==b&&i.enableVertexAttribArray(b)}}setVertexAttribPointers(i,h,_){for(let b=0;b<this.attributes.length;b++){const w=this.attributes[b],C=h.attributes[w.name];void 0!==C&&i.vertexAttribPointer(C,w.components,i[Gt[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ft{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Sn extends ft{getDefault(){return f.Color.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Ur extends ft{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class or extends ft{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Xn extends ft{getDefault(){return[!0,!0,!0,!0]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class fn extends ft{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class sr extends ft{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Ln extends ft{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const h=this.current;(i.func!==h.func||i.ref!==h.ref||i.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Di extends ft{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Vr extends ft{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=i,this.dirty=!1}}class Ri extends ft{getDefault(){return[0,1]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Co extends ft{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=i,this.dirty=!1}}class Or extends ft{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Ji extends ft{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.BLEND):h.disable(h.BLEND),this.current=i,this.dirty=!1}}class Gi extends ft{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class No extends ft{getDefault(){return f.Color.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class hi extends ft{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Si extends ft{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=i,this.dirty=!1}}class Qi extends ft{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Bo extends ft{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class es extends ft{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class bs extends ft{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class ts extends ft{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class ws extends ft{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Vs extends ft{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class gi extends ft{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class $s extends ft{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ii extends ft{getDefault(){return null}set(i){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Es extends ft{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class _i extends ft{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class $r extends ft{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Zn extends ft{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class eo extends ft{constructor(i,h){super(i),this.context=i,this.parent=h}getDefault(){return null}}class Kn extends eo{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Oi extends eo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Uo extends Oi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class K{constructor(i,h,_,b){this.context=i,this.width=h,this.height=_;const w=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Kn(i,w),b&&(this.depthAttachment=new Oi(i,w))}destroy(){const i=this.context.gl,h=this.colorAttachment.get();if(h&&i.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&i.deleteRenderbuffer(_)}i.deleteFramebuffer(this.framebuffer)}}class z{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Sn(this),this.clearDepth=new Ur(this),this.clearStencil=new or(this),this.colorMask=new Xn(this),this.depthMask=new fn(this),this.stencilMask=new sr(this),this.stencilFunc=new Ln(this),this.stencilOp=new Di(this),this.stencilTest=new Vr(this),this.depthRange=new Ri(this),this.depthTest=new Co(this),this.depthFunc=new Or(this),this.blend=new Ji(this),this.blendFunc=new Gi(this),this.blendColor=new No(this),this.blendEquation=new hi(this),this.cullFace=new Si(this),this.cullFaceSide=new Qi(this),this.frontFace=new Bo(this),this.program=new es(this),this.activeTexture=new bs(this),this.viewport=new ts(this),this.bindFramebuffer=new ws(this),this.bindRenderbuffer=new Vs(this),this.bindTexture=new gi(this),this.bindVertexBuffer=new $s(this),this.bindElementBuffer=new Ii(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Es(this),this.pixelStoreUnpack=new _i(this),this.pixelStoreUnpackPremultiplyAlpha=new $r(this),this.pixelStoreUnpackFlipY=new Zn(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,h){return new kt(this,i,h)}createVertexBuffer(i,h,_){return new wn(this,i,h,_)}createRenderbuffer(i,h,_){const b=this.gl,w=b.createRenderbuffer();return this.bindRenderbuffer.set(w),b.renderbufferStorage(b.RENDERBUFFER,i,h,_),this.bindRenderbuffer.set(null),w}createFramebuffer(i,h,_){return new K(this,i,h,_)}clear({color:i,depth:h,stencil:_}){const b=this.gl;let w=0;i&&(w|=b.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(w|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(w|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(w)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){se(i.blendFunction,f.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class j extends f.Evented{constructor(i,h,_,b){super(),this.id=i,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.extend({type:"raster"},h),f.extend(this,f.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=kn(this._options,this.map._requestManager,(i,h)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new f.ErrorEvent(i)):h&&(f.extend(this,h),h.bounds&&(this.tileBounds=new qe(h.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(h.tiles),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,h){const _=f.exported.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);i.request=f.getImage(this.map._requestManager.transformRequest(b,f.ResourceType.Tile),(w,C,S,P)=>(delete i.request,i.aborted?(i.state="unloaded",h(null)):w?(i.state="errored",h(w)):C?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:S,expires:P}),i.setTexture(C,this.map.painter),i.state="loaded",f.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(i,h,_){i.setTexture(h,_)}static unloadTileData(i,h){i.texture&&h.saveTileTexture(i.texture)}abortTile(i,h){i.request&&(i.request.cancel(),delete i.request),h()}unloadTile(i,h){i.texture&&this.map.painter.saveTileTexture(i.texture),h()}hasTransition(){return!1}}let X;function Y(p,i,h,_,b,w,C,S){const P=[p,h,b,i,_,w,1,1,1],R=[C,S,1],L=f.adjoint([],P),[B,$,W]=f.transformMat3(R,R,f.transpose(L,L));return f.multiply(P,[B,0,0,0,$,0,0,0,W],P)}class de extends f.Evented{constructor(i,h,_,b){super(),this.id=i,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}load(i){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this.url=this.options.url,f.getImage(this.map._requestManager.transformRequest(this.url,f.ResourceType.Image),(h,_)=>{if(this._loaded=!0,h)this.fire(new f.ErrorEvent(h));else if(_){const{HTMLImageElement:b}=f.window;this.image=_ instanceof b?f.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const h=i.map(f.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let b=1/0,w=1/0,C=-1/0,S=-1/0;for(const B of _)b=Math.min(b,B.x),w=Math.min(w,B.y),C=Math.max(C,B.x),S=Math.max(S,B.y);const P=Math.max(C-b,S-w),R=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),L=Math.pow(2,R);return new f.CanonicalTileID(R,Math.floor((b+C)/2*L),Math.floor((w+S)/2*L))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const P in this.tiles){const R=this.tiles[P];"loaded"!==R.state&&(R.state="loaded",R.texture=this.texture)}if(this._boundsArray)return;const h=f.tileTransform(this.tileID,this.map.transform.projection),[_,b,w,C]=this.coordinates.map(P=>{const R=h.projection.project(P[0],P[1]);return f.getTilePoint(h,R)._round()});this.perspectiveTransform=function(P,R,L,B,$,W,q,V,re,J){const te=Y(0,0,P,0,0,R,P,R),ie=Y(L,B,$,W,q,V,re,J);return f.multiply(ie,f.adjoint(te,te),ie),[ie[6]/ie[8]*P/f.EXTENT,ie[7]/ie[8]*R/f.EXTENT]}(this.width,this.height,_.x,_.y,b.x,b.y,C.x,C.y,w.x,w.y);const S=this._boundsArray=new f.StructArrayLayout4i8;S.emplaceBack(_.x,_.y,0,0),S.emplaceBack(b.x,b.y,f.EXTENT,0),S.emplaceBack(C.x,C.y,0,f.EXTENT),S.emplaceBack(w.x,w.y,f.EXTENT,f.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(S,f.boundsAttributes.members),this.boundsSegments=f.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,h=i.gl;this.texture?this.texture.update(this.image):(this.texture=new f.Texture(i,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._prepareData(i)}loadTile(i,h){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},h(null)):(i.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const pe={vector:class extends f.Evented{constructor(p,i,h,_){if(super(),this.id=p,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.extend(this,f.pick(i,["url","scheme","tileSize","promoteId"])),this._options=f.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new f.DedupedRequest}load(){this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=kn(this._options,this.map._requestManager,(p,i)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new f.ErrorEvent(p)):i&&(f.extend(this,i),i.bounds&&(this.tileBounds=new qe(i.bounds,this.minzoom,this.maxzoom)),f.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p();const i=this.map.style._getSourceCaches(this.id);for(const h of i)h.clearTiles();this.load()}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return f.extend({},this._options)}loadTile(p,i){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,f.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=i:p.request=p.actor.send("reloadTile",_,b.bind(this));else if(p.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",_,b.bind(this),void 0,!0);else{const w=f.loadVectorTile.call({deduped:this._deduped},_,(C,S)=>{C||!S?b.call(this,C):(_.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},p.actor&&p.actor.send("loadTile",_,b.bind(this),void 0,!0))},!0);p.request={cancel:w}}function b(w,C){return delete p.request,p.aborted?i(null):w&&404!==w.status?i(w):(C&&C.resourceTiming&&(p.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&p.setExpiryData(C),p.loadVectorData(C,this.map.painter),f.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:j,"raster-dem":class extends j{constructor(p,i,h,_){super(p,i,h,_),this.type="raster-dem",this.maxzoom=22,this._options=f.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(p,i){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(b,w){b&&(p.state="errored",i(b)),w&&(p.dem=w,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",i(null))}p.request=f.getImage(this.map._requestManager.transformRequest(h,f.ResourceType.Tile),function(b,w,C,S){if(delete p.request,p.aborted)p.state="unloaded",i(null);else if(b)p.state="errored",i(b);else if(w){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:C,expires:S});const P=f.window.ImageBitmap&&w instanceof f.window.ImageBitmap&&(null==X&&(X=f.window.OffscreenCanvas&&new f.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof f.window.createImageBitmap),X),R=1-(w.width-f.prevPowerOfTwo(w.width))/2;R<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const L=P?w:f.exported.getImageData(w,R),B={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:R};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",B,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const i=p.canonical,h=Math.pow(2,i.z),_=(i.x-1+h)%h,b=0===i.x?p.wrap-1:p.wrap,w=(i.x+1+h)%h,C=i.x+1===h?p.wrap+1:p.wrap,S={};return S[new f.OverscaledTileID(p.overscaledZ,b,i.z,_,i.y).key]={backfilled:!1},S[new f.OverscaledTileID(p.overscaledZ,C,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(S[new f.OverscaledTileID(p.overscaledZ,b,i.z,_,i.y-1).key]={backfilled:!1},S[new f.OverscaledTileID(p.overscaledZ,p.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},S[new f.OverscaledTileID(p.overscaledZ,C,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<h&&(S[new f.OverscaledTileID(p.overscaledZ,b,i.z,_,i.y+1).key]={backfilled:!1},S[new f.OverscaledTileID(p.overscaledZ,p.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},S[new f.OverscaledTileID(p.overscaledZ,C,i.z,w,i.y+1).key]={backfilled:!1}),S}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends f.Evented{constructor(p,i,h,_){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=i.data,this._options=f.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const b=f.EXTENT/this.tileSize;this.workerOptions=f.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*b,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*b,extent:f.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:f.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*b,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},i),this}getClusterChildren(p,i){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},i),this}getClusterLeaves(p,i,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:i,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new f.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=f.extend({},this.workerOptions),i=this._data;"string"==typeof i?(p.request=this.map._requestManager.transformRequest(f.exported.resolveURL(i),f.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new f.ErrorEvent(h));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(b.resourceTiming=_.resourceTiming[this.id]),this.fire(new f.Event("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,i){const h=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(h,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:f.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,b)=>(delete p.request,p.unloadVectorData(),p.aborted?i(null):_?i(_):(p.loadVectorData(b,this.map.painter,"reloadTile"===h),i(null))),void 0,"loadTile"===h)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return f.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends de{constructor(p,i,h,_){super(p,i,h,_),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const i of p.urls)this.urls.push(this.map._requestManager.transformRequest(i,f.ResourceType.Source).url);f.getVideo(this.urls,(i,h)=>{this._loaded=!0,i?this.fire(new f.ErrorEvent(i)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const i=this.video.seekable;p<i.start(0)||p>i.end(0)?this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,i=p.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new f.Texture(p,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:de,canvas:class extends de{constructor(p,i,h,_){super(p,i,h,_),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(b=>!Array.isArray(b)||2!==b.length||b.some(w=>"number"!=typeof w))||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof f.window.HTMLCanvasElement||this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.ErrorEvent(new f.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof f.window.HTMLCanvasElement?this.options.canvas:f.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new f.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends f.Evented{constructor(p,i,h,_){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=i,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new f.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new f.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new qe(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.coveringTiles=this._coveringTiles.bind(this),f.extend(this,f.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return f.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new f.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new f.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:i,y:h,z:_}=p.canonical;return this._implementation.hasTile({x:i,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,i){const{x:h,y:_,z:b}=p.tileID.canonical,w=new f.window.AbortController,C=this._implementation.loadTile({x:h,y:_,z:b},{signal:w.signal});if(!C)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",i(null);C.cancel=()=>w.abort(),p.request=C.then(function(S){return delete p.request,p.aborted?(p.state="unloaded",i(null)):S?(P=S)instanceof f.window.ImageData||P instanceof f.window.ImageBitmap||P instanceof f.window.HTMLCanvasElement?(this.loadTileData(p,S),p.state="loaded",void i(null)):(p.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",i(null));var P}.bind(this)).catch(S=>{20!==S.code&&(p.state="errored",i(S))})}loadTileData(p,i){j.loadTileData(p,i,this._map.painter)}unloadTileData(p){j.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:i,y:h,z:_}=p.tileID.canonical,b=this._implementation.prepareTile({x:i,y:h,z:_});return b?(this.loadTileData(p,b),p.state="loaded",b):null}unloadTile(p,i){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:h,y:_,z:b}=p.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:b})}i()}abortTile(p,i){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new f.Event("data",{dataType:"source",sourceDataType:"content"}))}}},we=function(p,i,h,_){const b=new pe[i.type](p,i,h,_);if(b.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${b.id}`);return f.bindAll(["load","abort","unload","serialize","prepare"],b),b};function xe(p,i){const h=f.identity([]);return f.scale(h,h,[.5*p.width,.5*-p.height,1]),f.translate(h,h,[1,-1,0]),f.multiply$1(h,h,p.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(h)}function Pe(p,i,h,_,b,w,C,S=!1){const P=p.tilesIn(_,C,S);P.sort(vt);const R=[];for(const B of P)R.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(i,h,p._state,B,b,w,xe(p.transform,B.tile.tileID),S)});const L=function(B){const $={},W={};for(const q of B){const V=q.queryResults,re=q.wrappedTileID,J=W[re]=W[re]||{};for(const te in V){const ie=V[te],le=J[te]=J[te]||{},ee=$[te]=$[te]||[];for(const he of ie)le[he.featureIndex]||(le[he.featureIndex]=!0,ee.push(he))}}return $}(R);for(const B in L)L[B].forEach($=>{const W=$.feature,q=W.layer;q&&"background"!==q.type&&"sky"!==q.type&&(W.source=q.source,q["source-layer"]&&(W.sourceLayer=q["source-layer"]),W.state=void 0!==W.id?p.getFeatureState(q["source-layer"],W.id):{})});return L}function Ke(p,i){const h=p.getRenderableIds().map(w=>p.getTileByID(w)),_=[],b={};for(let w=0;w<h.length;w++){const C=h[w],S=C.tileID.canonical.key;b[S]||(b[S]=!0,C.querySourceFeatures(_,i))}return _}function vt(p,i){const h=p.tileID,_=i.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function Xe(){return null!=Js.workerClass?new Js.workerClass:new f.window.Worker(Js.workerUrl)}const Yt="mapboxgl_preloaded_worker_pool";class Bt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Bt.workerCount;)this.workers.push(new Xe);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Yt]}numActive(){return Object.keys(this.active).length}}let Ut;function Xt(){return Ut||(Ut=new Bt),Ut}function ke(p,i){const h={};for(const _ in p)"ref"!==_&&(h[_]=p[_]);return f.refProperties.forEach(_=>{_ in i&&(h[_]=i[_])}),h}function Yn(p){p=p.slice();const i=Object.create(null);for(let h=0;h<p.length;h++)i[p[h].id]=p[h];for(let h=0;h<p.length;h++)"ref"in p[h]&&(p[h]=ke(p[h],i[p[h].ref]));return p}Bt.workerCount=2;const Ot={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Gn(p,i,h){h.push({command:Ot.addSource,args:[p,i[p]]})}function Mn(p,i,h){i.push({command:Ot.removeSource,args:[p]}),h[p]=!0}function ns(p,i,h,_){Mn(p,h,_),Gn(p,i,h)}function Do(p,i,h){let _;for(_ in p[h])if(p[h].hasOwnProperty(_)&&"data"!==_&&!se(p[h][_],i[h][_]))return!1;for(_ in i[h])if(i[h].hasOwnProperty(_)&&"data"!==_&&!se(p[h][_],i[h][_]))return!1;return!0}function xt(p,i,h,_,b,w){let C;for(C in i=i||{},p=p||{})p.hasOwnProperty(C)&&(se(p[C],i[C])||h.push({command:w,args:[_,C,i[C],b]}));for(C in i)i.hasOwnProperty(C)&&!p.hasOwnProperty(C)&&(se(p[C],i[C])||h.push({command:w,args:[_,C,i[C],b]}))}function an(p){return p.id}function Zt(p,i){return p[i.id]=i,p}class yi{constructor(i,h){this.reset(i,h)}reset(i,h){this.points=i||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=f.clamp(i,0,1);let h=1,_=this._distances[h];const b=i*this.paddedLength+this.padding;for(;_<b&&h<this._distances.length;)_=this._distances[++h];const w=h-1,C=this._distances[w],S=_-C,P=S>0?(b-C)/S:0;return this.points[w].mult(1-P).add(this.points[h].mult(P))}}class rs{constructor(i,h,_){const b=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/_),this.yCellCount=Math.ceil(h/_);for(let C=0;C<this.xCellCount*this.yCellCount;C++)b.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=h,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,h,_,b,w){this._forEachCell(h,_,b,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(w)}insertCircle(i,h,_,b){this._forEachCell(h-b,_-b,h+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(h),this.circles.push(_),this.circles.push(b)}_insertBoxCell(i,h,_,b,w,C){this.boxCells[w].push(C)}_insertCircleCell(i,h,_,b,w,C){this.circleCells[w].push(C)}_query(i,h,_,b,w,C){if(_<0||i>this.width||b<0||h>this.height)return!w&&[];const S=[];if(i<=0&&h<=0&&this.width<=_&&this.height<=b){if(w)return!0;for(let P=0;P<this.boxKeys.length;P++)S.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const R=this.circles[3*P],L=this.circles[3*P+1],B=this.circles[3*P+2];S.push({key:this.circleKeys[P],x1:R-B,y1:L-B,x2:R+B,y2:L+B})}return C?S.filter(C):S}return this._forEachCell(i,h,_,b,this._queryCell,S,{hitTest:w,seenUids:{box:{},circle:{}}},C),w?S.length>0:S}_queryCircle(i,h,_,b,w){const C=i-_,S=i+_,P=h-_,R=h+_;if(S<0||C>this.width||R<0||P>this.height)return!b&&[];const L=[];return this._forEachCell(C,P,S,R,this._queryCellCircle,L,{hitTest:b,circle:{x:i,y:h,radius:_},seenUids:{box:{},circle:{}}},w),b?L.length>0:L}query(i,h,_,b,w){return this._query(i,h,_,b,!1,w)}hitTest(i,h,_,b,w){return this._query(i,h,_,b,!0,w)}hitTestCircle(i,h,_,b){return this._queryCircle(i,h,_,!0,b)}_queryCell(i,h,_,b,w,C,S,P){const R=S.seenUids,L=this.boxCells[w];if(null!==L){const $=this.bboxes;for(const W of L)if(!R.box[W]){R.box[W]=!0;const q=4*W;if(i<=$[q+2]&&h<=$[q+3]&&_>=$[q+0]&&b>=$[q+1]&&(!P||P(this.boxKeys[W]))){if(S.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[W],x1:$[q],y1:$[q+1],x2:$[q+2],y2:$[q+3]})}}}const B=this.circleCells[w];if(null!==B){const $=this.circles;for(const W of B)if(!R.circle[W]){R.circle[W]=!0;const q=3*W;if(this._circleAndRectCollide($[q],$[q+1],$[q+2],i,h,_,b)&&(!P||P(this.circleKeys[W]))){if(S.hitTest)return C.push(!0),!0;{const V=$[q],re=$[q+1],J=$[q+2];C.push({key:this.circleKeys[W],x1:V-J,y1:re-J,x2:V+J,y2:re+J})}}}}}_queryCellCircle(i,h,_,b,w,C,S,P){const R=S.circle,L=S.seenUids,B=this.boxCells[w];if(null!==B){const W=this.bboxes;for(const q of B)if(!L.box[q]){L.box[q]=!0;const V=4*q;if(this._circleAndRectCollide(R.x,R.y,R.radius,W[V+0],W[V+1],W[V+2],W[V+3])&&(!P||P(this.boxKeys[q])))return C.push(!0),!0}}const $=this.circleCells[w];if(null!==$){const W=this.circles;for(const q of $)if(!L.circle[q]){L.circle[q]=!0;const V=3*q;if(this._circlesCollide(W[V],W[V+1],W[V+2],R.x,R.y,R.radius)&&(!P||P(this.circleKeys[q])))return C.push(!0),!0}}}_forEachCell(i,h,_,b,w,C,S,P){const R=this._convertToXCellCoord(i),L=this._convertToYCellCoord(h),B=this._convertToXCellCoord(_),$=this._convertToYCellCoord(b);for(let W=R;W<=B;W++)for(let q=L;q<=$;q++)if(w.call(this,i,h,_,b,this.xCellCount*q+W,C,S,P))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,h,_,b,w,C){const S=b-i,P=w-h,R=_+C;return R*R>S*S+P*P}_circleAndRectCollide(i,h,_,b,w,C,S){const P=(C-b)/2,R=Math.abs(i-(b+P));if(R>P+_)return!1;const L=(S-w)/2,B=Math.abs(h-(w+L));if(B>L+_)return!1;if(R<=P||B<=L)return!0;const $=R-P,W=B-L;return $*$+W*W<=_*_}}const Rn=Math.tan(85*Math.PI/180);function hn(p,i,h,_,b,w){const C=f.create();if(h){if("globe"===b.projection.name)f.multiply$1(C,C,f.calculateGlobeLabelMatrix(b,i));else{const S=gt([],w);C[0]=S[0],C[1]=S[1],C[4]=S[2],C[5]=S[3]}_||f.rotateZ(C,C,b.angle)}else f.multiply$1(C,b.labelPlaneMatrix,p);return C}function is(p,i,h,_,b,w){if(h){if("globe"===b.projection.name){const C=hn(p,i,h,_,b,w);return f.invert(C,C),f.multiply$1(C,p,C),C}{const C=f.clone(p),S=f.identity([]);return S[0]=w[0],S[1]=w[1],S[4]=w[2],S[5]=w[3],f.multiply$1(C,C,S),_||f.rotateZ(C,C,-b.angle),C}}return b.glCoordMatrix}function br(p,i,h=0){const _=[p.x,p.y,h,1];h?f.transformMat4$1(_,_,i):Cr(_,_,i);const b=_[3];return{point:new f.pointGeometry(_[0]/b,_[1]/b),signedDistanceFromCamera:b}}function ai(p,i){const h=[p[0],p[1],p[2],1];f.transformMat4$1(h,h,i);const _=h[3];return{point:new f.pointGeometry(h[0]/_,h[1]/_),signedDistanceFromCamera:_}}function wr(p,i){return Math.min(.5+p/i*.5,1.5)}function Kl(p,i){const h=p[0]/p[3],_=p[1]/p[3];return h>=-i[0]&&h<=i[0]&&_>=-i[1]&&_<=i[1]}function Hi(p,i,h,_,b,w,C,S,P,R){const L=h.transform,B=_?p.textSizeData:p.iconSizeData,$=f.evaluateSizeForZoom(B,h.transform.zoom),W=[256/h.width*2+1,256/h.height*2+1],q=_?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;q.clear();const V=p.lineVertexArray,re=_?p.text.placedSymbolArray:p.icon.placedSymbolArray,J=h.transform.width/h.transform.height;let te=!1;for(let ie=0;ie<re.length;ie++){const le=re.get(ie);if(le.writingMode!==f.WritingMode.vertical||te||0!==ie&&re.get(ie-1).writingMode===f.WritingMode.horizontal||(te=!0),(le.hidden||le.writingMode===f.WritingMode.vertical)&&!te){Gr(le.numGlyphs,q);continue}te=!1;const ee=new f.pointGeometry(le.tileAnchorX,le.tileAnchorY),he=P?P(ee):[0,0,0],Ae=L.projection.projectTilePoint(ee.x,ee.y,R.canonical),ze=[Ae.x+he[0],Ae.y+he[1],Ae.z+he[2]],$e=[...ze,1];if(f.transformMat4$1($e,$e,i),!Kl($e,W)){Gr(le.numGlyphs,q);continue}const je=wr(h.transform.cameraToCenterDistance,$e[3]),mt=f.evaluateSizeForFeature(B,$,le),Me=C?mt/je:mt*je,at=br(new f.pointGeometry(ze[0],ze[1]),b,ze[2]);if(at.signedDistanceFromCamera<=0){Gr(le.numGlyphs,q);continue}let ut={};const Lt=C?null:P,Ne=Ts(le,Me,!1,S,i,b,w,p.glyphOffsetArray,V,q,at.point,ee,ut,J,Lt,L.projection,R);te=Ne.useVertical,Lt&&Ne.needsFlipping&&(ut={}),(Ne.notEnoughRoom||te||Ne.needsFlipping&&Ts(le,Me,!0,S,i,b,w,p.glyphOffsetArray,V,q,at.point,ee,ut,J,Lt,L.projection,R).notEnoughRoom)&&Gr(le.numGlyphs,q)}_?p.text.dynamicLayoutVertexBuffer.updateData(q):p.icon.dynamicLayoutVertexBuffer.updateData(q)}function Gs(p,i,h,_,b,w,C,S,P,R,L,B,$,W,q){const V=S.glyphStartIndex+S.numGlyphs,re=S.lineStartIndex,J=S.lineStartIndex+S.lineLength,te=i.getoffsetX(S.glyphStartIndex),ie=i.getoffsetX(V-1),le=mn(p*te,h,_,b,w,C,S.segment,re,J,P,R,L,B,$,!0,W,q);if(!le)return null;const ee=mn(p*ie,h,_,b,w,C,S.segment,re,J,P,R,L,B,$,!0,W,q);return ee?{first:le,last:ee}:null}function to(p,i,h,_){return p.writingMode===f.WritingMode.horizontal&&Math.abs(h.y-i.y)>Math.abs(h.x-i.x)*_?{useVertical:!0}:p.writingMode===f.WritingMode.vertical?i.y<h.y?{needsFlipping:!0}:null:0!==p.flipState&&function(b,w,C){const S=(w.x-b.x)*C;return 0===S||Math.abs((w.y-b.y)/S)>Rn}(i,h,_)?1===p.flipState?{needsFlipping:!0}:null:i.x>h.x?{needsFlipping:!0}:null}function Ts(p,i,h,_,b,w,C,S,P,R,L,B,$,W,q,V,re){const J=i/24,te=p.lineOffsetX*J,ie=p.lineOffsetY*J;let le;if(p.numGlyphs>1){const ee=p.glyphStartIndex+p.numGlyphs,he=p.lineStartIndex,Ae=p.lineStartIndex+p.lineLength,ze=Gs(J,S,te,ie,h,L,B,p,P,w,$,q,!1,V,re);if(!ze)return{notEnoughRoom:!0};const $e=br(ze.first.point,C).point,je=br(ze.last.point,C).point;if(_&&!h){const mt=to(p,$e,je,W);if(p.flipState=mt&&mt.needsFlipping?1:2,mt)return mt}le=[ze.first];for(let mt=p.glyphStartIndex+1;mt<ee-1;mt++)le.push(mn(J*S.getoffsetX(mt),te,ie,h,L,B,p.segment,he,Ae,P,w,$,q,!1,!1,V,re));le.push(ze.last)}else{if(_&&!h){const he=br(B,b).point,Ae=p.lineStartIndex+p.segment+1,ze=new f.pointGeometry(P.getx(Ae),P.gety(Ae)),$e=br(ze,b),je=to(p,he,$e.signedDistanceFromCamera>0?$e.point:jn(B,ze,he,1,b,void 0,V,re.canonical),W);if(p.flipState=je&&je.needsFlipping?1:2,je)return je}const ee=mn(J*S.getoffsetX(p.glyphStartIndex),te,ie,h,L,B,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,P,w,$,q,!1,!1,V,re);if(!ee)return{notEnoughRoom:!0};le=[ee]}for(const ee of le)f.addDynamicAttributes(R,ee.point,ee.angle);return{}}function Hs(p,i,h,_,b){const w=_.projectTilePoint(p.x,p.y,i);if(!b)return br(w,h,w.z);const C=b(p);return br(new f.pointGeometry(w.x+C[0],w.y+C[1]),h,w.z+C[2])}function jn(p,i,h,_,b,w,C,S){const P=Hs(p.add(p.sub(i)._unit()),S,b,C,w).point,R=h.sub(P);return h.add(R._mult(_/R.mag()))}function mn(p,i,h,_,b,w,C,S,P,R,L,B,$,W,q,V,re){const J=_?p-i:p+i;let te=J>0?1:-1,ie=0;_&&(te*=-1,ie=Math.PI),te<0&&(ie+=Math.PI);let le=te>0?S+C:S+C+1,ee=b,he=b,Ae=0,ze=0;const $e=Math.abs(J),je=[],mt=[];let Me=w;const at=()=>{const At=le-te;return 0===Ae?w:new f.pointGeometry(R.getx(At),R.gety(At))},ut=()=>jn(at(),Me,he,$e-Ae+1,L,$,V,re.canonical);for(;Ae+ze<=$e;){if(le+=te,le<S||le>=P)return null;if(he=ee,je.push(ee),W&&mt.push(Me||at()),ee=B[le],void 0===ee){Me=new f.pointGeometry(R.getx(le),R.gety(le));const At=Hs(Me,re.canonical,L,V,$);ee=At.signedDistanceFromCamera>0?B[le]=At.point:ut()}else Me=null;Ae+=ze,ze=he.dist(ee)}q&&$&&(Me=Me||new f.pointGeometry(R.getx(le),R.gety(le)),B[le]=ee=void 0===B[le]?ee:ut(),ze=he.dist(ee));const Lt=($e-Ae)/ze,Ne=ee.sub(he),jt=Ne.mult(Lt)._add(he);h&&jt._add(Ne._unit()._perp()._mult(h*te));const Ht=ie+Math.atan2(ee.y-he.y,ee.x-he.x);return je.push(jt),W&&(Me=Me||new f.pointGeometry(R.getx(le),R.gety(le)),mt.push(function(At,Ft,tn){const _n=1-tn;return new f.pointGeometry(At.x*_n+Ft.x*tn,At.y*_n+Ft.y*tn)}(mt.length>0?mt[mt.length-1]:Me,Me,Lt))),{point:jt,angle:Ht,path:je,tilePath:mt}}const So=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Gr(p,i){for(let h=0;h<p;h++){const _=i.length;i.resize(_+4),i.float32.set(So,3*_)}}function Cr(p,i,h){const _=i[0],b=i[1];return p[0]=h[0]*_+h[4]*b+h[12],p[1]=h[1]*_+h[5]*b+h[13],p[3]=h[3]*_+h[7]*b+h[15],p}const di=100;class Io{constructor(i,h,_=new rs(i.width+200,i.height+200,25),b=new rs(i.width+200,i.height+200,25)){this.transform=i,this.grid=_,this.ignoredGrid=b,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+di,this.screenBottomBoundary=i.height+di,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=h}placeCollisionBox(i,h,_,b,w,C,S){let P=h.projectedAnchorX,R=h.projectedAnchorY,L=h.projectedAnchorZ;const B=h.elevation,$=h.tileID;if(B&&$){const le=this.transform.projection.upVector($.canonical,h.tileAnchorX,h.tileAnchorY),ee=this.transform.projection.upVectorScale($.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=le[0]*B*ee,R+=le[1]*B*ee,L+=le[2]*B*ee}const W=this.projectAndGetPerspectiveRatio(C,[P,R,L],h.tileID,"globe"===this.transform.projection.name||!!B||this.transform.pitch>0),q=w*W.perspectiveRatio,V=(h.x1*i+_.x-h.padding)*q+W.point.x,re=(h.y1*i+_.y-h.padding)*q+W.point.y,J=(h.x2*i+_.x+h.padding)*q+W.point.x,te=(h.y2*i+_.y+h.padding)*q+W.point.y,ie=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(V,re,J,te)||!b&&this.grid.hitTest(V,re,J,te,S)||ie?{box:[],offscreen:!1,occluded:W.occluded}:{box:[V,re,J,te],offscreen:this.isOffscreen(V,re,J,te),occluded:!1}}placeCollisionCircles(i,h,_,b,w,C,S,P,R,L,B,$,W,q){const V=[],re=this.transform.elevation,J=re?re.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,this.transform.projection):ut=>[0,0,0],te=new f.pointGeometry(h.tileAnchorX,h.tileAnchorY),ie=this.transform.projection.projectTilePoint(h.tileAnchorX,h.tileAnchorY,q.canonical),le=J(te),ee=[ie.x+le[0],ie.y+le[1],ie.z+le[2]],he=this.projectAndGetPerspectiveRatio(C,[ee[0],ee[1],ee[2]],q,"globe"===this.transform.projection.name||!!re||this.transform.pitch>0),{perspectiveRatio:Ae}=he,ze=(L?w/Ae:w*Ae)/f.ONE_EM,$e=br(new f.pointGeometry(ee[0],ee[1]),S,ee[2]).point,je=he.signedDistanceFromCamera>0?Gs(ze,b,h.lineOffsetX*ze,h.lineOffsetY*ze,!1,$e,te,h,_,S,{},re&&!L?J:null,L&&!!re,this.transform.projection,q):null;let mt=!1,Me=!1,at=!0;if(je&&!he.occluded){const ut=.5*$*Ae+W,Lt=new f.pointGeometry(-100,-100),Ne=new f.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),jt=new yi,Ht=je.first,At=je.last;let Ft=[];for(let qt=Ht.path.length-1;qt>=1;qt--)Ft.push(Ht.path[qt]);for(let qt=1;qt<At.path.length;qt++)Ft.push(At.path[qt]);const tn=2.5*ut;if(P){const qt=Ft.map(re?(pn,Vt)=>{const Qr=J(Vt<Ht.path.length-1?Ht.tilePath[Ht.path.length-1-Vt]:At.tilePath[Vt-Ht.path.length+2]);return br(pn,P,Qr[2])}:pn=>br(pn,P));Ft=qt.some(pn=>pn.signedDistanceFromCamera<=0)?[]:qt.map(pn=>pn.point)}let _n=[];if(Ft.length>0){const qt=Ft[0].clone(),pn=Ft[0].clone();for(let Vt=1;Vt<Ft.length;Vt++)qt.x=Math.min(qt.x,Ft[Vt].x),qt.y=Math.min(qt.y,Ft[Vt].y),pn.x=Math.max(pn.x,Ft[Vt].x),pn.y=Math.max(pn.y,Ft[Vt].y);_n=qt.x>=Lt.x&&pn.x<=Ne.x&&qt.y>=Lt.y&&pn.y<=Ne.y?[Ft]:pn.x<Lt.x||qt.x>Ne.x||pn.y<Lt.y||qt.y>Ne.y?[]:f.clipLine([Ft],Lt.x,Lt.y,Ne.x,Ne.y)}for(const qt of _n){jt.reset(qt,.25*ut);let pn=0;pn=jt.length<=.5*ut?1:Math.ceil(jt.paddedLength/tn)+1;for(let Vt=0;Vt<pn;Vt++){const Qr=Vt/Math.max(pn-1,1),so=jt.lerp(Qr),ao=so.x+di,qo=so.y+di;V.push(ao,qo,ut,0);const Rs=ao-ut,xa=qo-ut,el=ao+ut,Po=qo+ut;if(at=at&&this.isOffscreen(Rs,xa,el,Po),Me=Me||this.isInsideGrid(Rs,xa,el,Po),!i&&this.grid.hitTestCircle(ao,qo,ut,B)&&(mt=!0,!R))return{circles:[],offscreen:!1,collisionDetected:mt,occluded:!1}}}}return{circles:!R&&mt||!Me?[]:V,offscreen:at,collisionDetected:mt,occluded:he.occluded}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,b=1/0,w=-1/0,C=-1/0;for(const L of i){const B=new f.pointGeometry(L.x+di,L.y+di);_=Math.min(_,B.x),b=Math.min(b,B.y),w=Math.max(w,B.x),C=Math.max(C,B.y),h.push(B)}const S=this.grid.query(_,b,w,C).concat(this.ignoredGrid.query(_,b,w,C)),P={},R={};for(const L of S){const B=L.key;if(void 0===P[B.bucketInstanceId]&&(P[B.bucketInstanceId]={}),P[B.bucketInstanceId][B.featureIndex])continue;const $=[new f.pointGeometry(L.x1,L.y1),new f.pointGeometry(L.x2,L.y1),new f.pointGeometry(L.x2,L.y2),new f.pointGeometry(L.x1,L.y2)];f.polygonIntersectsPolygon(h,$)&&(P[B.bucketInstanceId][B.featureIndex]=!0,void 0===R[B.bucketInstanceId]&&(R[B.bucketInstanceId]=[]),R[B.bucketInstanceId].push(B.featureIndex))}return R}insertCollisionBox(i,h,_,b,w){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:w},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,h,_,b,w){const C=h?this.ignoredGrid:this.grid,S={bucketInstanceId:_,featureIndex:b,collisionGroupID:w};for(let P=0;P<i.length;P+=4)C.insertCircle(S,i[P],i[P+1],i[P+2])}projectAndGetPerspectiveRatio(i,h,_,b){const w=[h[0],h[1],h[2],1];let C=!1;return h[2]||this.transform.pitch>0?(f.transformMat4$1(w,w,i),this.fogState&&_&&(C=function(S,P,R,L,B,$){const W=$.calculateFogTileMatrix(B),q=[P,R,L];return f.transformMat4(q,q,W),We(S,q,$.pitch,$._fov)}(this.fogState,h[0],h[1],h[2],_.toUnwrapped(),this.transform)>.9)):Cr(w,w,i),{point:new f.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+di,(-w[1]/w[3]+1)/2*this.transform.height+di),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/w[3]*.5,1.5),signedDistanceFromCamera:w[3],occluded:b&&w[2]>w[3]||C}}isOffscreen(i,h,_,b){return _<di||i>=this.screenRightBoundary||b<di||h>this.screenBottomBoundary}isInsideGrid(i,h,_,b){return _>=0&&i<this.gridRightBoundary&&b>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const i=f.identity([]);return f.translate(i,i,[-100,-100,0]),i}}class gr{constructor(i,h,_,b){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?h:-h))):b&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class ei{constructor(i,h,_,b,w,C=!1){this.text=new gr(i?i.text:null,h,_,w),this.icon=new gr(i?i.icon:null,h,b,w),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jo{constructor(i,h,_,b=!1){this.text=i,this.icon=h,this.skipFade=_,this.clipped=b}}class fi{constructor(){this.invProjMatrix=f.create(),this.viewportMatrix=f.create(),this.circles=[]}}class Mi{constructor(i,h,_,b,w){this.bucketInstanceId=i,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=w}}class no{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const h=++this.maxGroupID;this.collisionGroups[i]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[i]}}function Cs(p,i,h,_,b){const{horizontalAlign:w,verticalAlign:C}=f.getAnchorAlignment(p),S=-(w-.5)*i,P=-(C-.5)*h,R=f.evaluateVariableOffset(p,_);return new f.pointGeometry(S+R[0]*b,P+R[1]*b)}function os(p,i,h,_,b){const w=new f.pointGeometry(p,i);return h&&w._rotate(_?b:-b),w}class za{constructor(i,h,_,b,w){this.transform=i.clone(),this.collisionIndex=new Io(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new no(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,h,_,b){const w=_.getBucket(h),C=_.latestFeatureIndex;if(!w||!C||h.id!==w.layerIds[0])return;const S=w.layers[0].layout,P=_.collisionBoxArray,R=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),L=_.tileSize/f.EXTENT,B=_.tileID.toUnwrapped(),$=this.transform.calculateProjMatrix(B),W="map"===S.get("text-pitch-alignment"),q="map"===S.get("text-rotation-alignment");h.compileFilter();const V=h.dynamicFilter(),re=h.dynamicFilterNeedsFeature(),J=this.transform.calculatePixelsToTileUnitsMatrix(_),te=hn($,_.tileID.canonical,W,q,this.transform,J);let ie=null;if(W){const he=is($,_.tileID.canonical,W,q,this.transform,J);ie=f.multiply$1([],this.transform.labelPlaneMatrix,he)}let le=null;V&&_.latestFeatureIndex&&(le={unwrappedTileID:B,dynamicFilter:V,dynamicFilterNeedsFeature:re,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new Mi(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,_.tileID);const ee={bucket:w,layout:S,posMatrix:$,textLabelPlaneMatrix:te,labelToScreenMatrix:ie,clippingData:le,scale:R,textPixelRatio:L,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:f.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:f.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(b)for(const he of w.sortKeyRanges){const{sortKey:Ae,symbolInstanceStart:ze,symbolInstanceEnd:$e}=he;i.push({sortKey:Ae,symbolInstanceStart:ze,symbolInstanceEnd:$e,parameters:ee})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(i,h,_,b,w,C,S,P,R,L,B,$,W,q,V,re,J,te){const ie=[$.textOffset0,$.textOffset1],le=Cs(i,_,b,ie,w),ee=this.collisionIndex.placeCollisionBox(w,h,os(le.x,le.y,C,S,this.transform.angle),B,P,R,L.predicate);if((!re||0!==this.collisionIndex.placeCollisionBox(q.getSymbolInstanceIconSize(te,this.transform.zoom,W),re,os(le.x,le.y,C,S,this.transform.angle),B,P,R,L.predicate).box.length)&&ee.box.length>0){let he;return this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(he=this.prevPlacement.variableOffsets[$.crossTileID].anchor),this.variableOffsets[$.crossTileID]={textOffset:ie,width:_,height:b,anchor:i,textScale:w,prevAnchor:he},this.markUsedJustification(q,i,$,V),q.allowVerticalPlacement&&(this.markUsedOrientation(q,V,$),this.placedOrientations[$.crossTileID]=V),{shift:le,placedGlyphBoxes:ee}}}placeLayerBucketPart(i,h,_,b){const{bucket:w,layout:C,posMatrix:S,textLabelPlaneMatrix:P,labelToScreenMatrix:R,clippingData:L,textPixelRatio:B,holdingForFade:$,collisionBoxArray:W,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:V,collisionGroup:re}=i.parameters,J=C.get("text-optional"),te=C.get("icon-optional"),ie=C.get("text-allow-overlap"),le=C.get("icon-allow-overlap"),ee="map"===C.get("text-rotation-alignment"),he="map"===C.get("text-pitch-alignment"),Ae="none"!==C.get("icon-text-fit"),ze="viewport-y"===C.get("symbol-z-order");let $e=ie&&(le||!w.hasIconData()||te),je=le&&(ie||!w.hasTextData()||J);!w.collisionArrays&&W&&w.deserializeCollisionBoxes(W),_&&b&&w.updateCollisionDebugBuffers(this.transform.zoom,W);const mt=(Me,at,ut)=>{if(L){const ti={zoom:this.transform.zoom,pitch:this.transform.pitch};let $n=null;if(L.dynamicFilterNeedsFeature){const tr=this.retainedQueryData[w.bucketInstanceId];$n=L.featureIndex.loadFeature({featureIndex:Me.featureIndex,bucketIndex:tr.bucketIndex,sourceLayerIndex:tr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(ti,$n,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new f.pointGeometry(Me.tileAnchorX,Me.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Me.crossTileID]=new jo(!1,!1,!1,!0),void(h[Me.crossTileID]=!0)}if(h[Me.crossTileID])return;if($)return void(this.placements[Me.crossTileID]=new jo(!1,!1,!1));let Lt=!1,Ne=!1,jt=!0,Ht=!1,At=!1,Ft=null,tn={box:null,offscreen:null,occluded:null},_n={box:null,offscreen:null,occluded:null},qt=null,pn=null,Vt=null,Qr=0,so=0,ao=0;ut.textFeatureIndex?Qr=ut.textFeatureIndex:Me.useRuntimeCollisionCircles&&(Qr=Me.featureIndex),ut.verticalTextFeatureIndex&&(so=ut.verticalTextFeatureIndex);const qo=ti=>{ti.tileID=this.retainedQueryData[w.bucketInstanceId].tileID,(this.transform.elevation||ti.elevation)&&(ti.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[w.bucketInstanceId].tileID,ti.tileAnchorX,ti.tileAnchorY):0)},Rs=ut.textBox;if(Rs){qo(Rs);const ti=tr=>{let qr=f.WritingMode.horizontal;if(w.allowVerticalPlacement&&!tr&&this.prevPlacement){const Zo=this.prevPlacement.placedOrientations[Me.crossTileID];Zo&&(this.placedOrientations[Me.crossTileID]=Zo,qr=Zo,this.markUsedOrientation(w,qr,Me))}return qr},$n=(tr,qr)=>{if(w.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&ut.verticalTextBox){for(const Zo of w.writingModes)if(Zo===f.WritingMode.vertical?(tn=qr(),_n=tn):tn=tr(),tn&&tn.box&&tn.box.length)break}else tn=tr()};if(C.get("text-variable-anchor")){let tr=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Me.crossTileID]){const Zr=this.prevPlacement.variableOffsets[Me.crossTileID];tr.indexOf(Zr.anchor)>0&&(tr=tr.filter(ni=>ni!==Zr.anchor),tr.unshift(Zr.anchor))}const qr=(Zr,ni,yo)=>{const vo=w.getSymbolInstanceTextSize(q,Me,this.transform.zoom,at),Os=(Zr.x2-Zr.x1)*vo+2*Zr.padding,Il=(Zr.y2-Zr.y1)*vo+2*Zr.padding,cu=Ae&&!le?ni:null;cu&&qo(cu);let Ml={box:[],offscreen:!1,occluded:!1};const jf=ie?2*tr.length:tr.length;for(let tl=0;tl<jf;++tl){const Dd=this.attemptAnchorPlacement(tr[tl%tr.length],Zr,Os,Il,vo,ee,he,B,S,re,tl>=tr.length,Me,at,w,yo,cu,q,V);if(Dd&&(Ml=Dd.placedGlyphBoxes,Ml&&Ml.box&&Ml.box.length)){Lt=!0,Ft=Dd.shift;break}}return Ml};$n(()=>qr(Rs,ut.iconBox,f.WritingMode.horizontal),()=>{const Zr=ut.verticalTextBox;return Zr&&qo(Zr),w.allowVerticalPlacement&&!(tn&&tn.box&&tn.box.length)&&Me.numVerticalGlyphVertices>0&&Zr?qr(Zr,ut.verticalIconBox,f.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),tn&&(Lt=tn.box,jt=tn.offscreen,Ht=tn.occluded);const Zo=ti(tn&&tn.box);if(!Lt&&this.prevPlacement){const Zr=this.prevPlacement.variableOffsets[Me.crossTileID];Zr&&(this.variableOffsets[Me.crossTileID]=Zr,this.markUsedJustification(w,Zr.anchor,Me,Zo))}}else{const tr=(qr,Zo)=>{const Zr=w.getSymbolInstanceTextSize(q,Me,this.transform.zoom,at),ni=this.collisionIndex.placeCollisionBox(Zr,qr,new f.pointGeometry(0,0),ie,B,S,re.predicate);return ni&&ni.box&&ni.box.length&&(this.markUsedOrientation(w,Zo,Me),this.placedOrientations[Me.crossTileID]=Zo),ni};$n(()=>tr(Rs,f.WritingMode.horizontal),()=>{const qr=ut.verticalTextBox;return w.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&qr?(qo(qr),tr(qr,f.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ti(tn&&tn.box&&tn.box.length)}}if(qt=tn,Lt=qt&&qt.box&&qt.box.length>0,jt=qt&&qt.offscreen,Ht=qt&&qt.occluded,Me.useRuntimeCollisionCircles){const ti=w.text.placedSymbolArray.get(Me.centerJustifiedTextSymbolIndex>=0?Me.centerJustifiedTextSymbolIndex:Me.verticalPlacedTextSymbolIndex),$n=f.evaluateSizeForFeature(w.textSizeData,q,ti),tr=C.get("text-padding");pn=this.collisionIndex.placeCollisionCircles(ie,ti,w.lineVertexArray,w.glyphOffsetArray,$n,S,P,R,_,he,re.predicate,Me.collisionCircleDiameter*$n/f.ONE_EM,tr,this.retainedQueryData[w.bucketInstanceId].tileID),Lt=ie||pn.circles.length>0&&!pn.collisionDetected,jt=jt&&pn.offscreen,Ht=pn.occluded}if(ut.iconFeatureIndex&&(ao=ut.iconFeatureIndex),ut.iconBox){const ti=$n=>{qo($n);const tr=Ae&&Ft?os(Ft.x,Ft.y,ee,he,this.transform.angle):new f.pointGeometry(0,0),qr=w.getSymbolInstanceIconSize(V,this.transform.zoom,at);return this.collisionIndex.placeCollisionBox(qr,$n,tr,le,B,S,re.predicate)};_n&&_n.box&&_n.box.length&&ut.verticalIconBox?(Vt=ti(ut.verticalIconBox),Ne=Vt.box.length>0):(Vt=ti(ut.iconBox),Ne=Vt.box.length>0),jt=jt&&Vt.offscreen,At=Vt.occluded}const xa=J||0===Me.numHorizontalGlyphVertices&&0===Me.numVerticalGlyphVertices,el=te||0===Me.numIconVertices;if(xa||el?el?xa||(Ne=Ne&&Lt):Lt=Ne&&Lt:Ne=Lt=Ne&&Lt,Lt&&qt&&qt.box&&this.collisionIndex.insertCollisionBox(qt.box,C.get("text-ignore-placement"),w.bucketInstanceId,_n&&_n.box&&so?so:Qr,re.ID),Ne&&Vt&&this.collisionIndex.insertCollisionBox(Vt.box,C.get("icon-ignore-placement"),w.bucketInstanceId,ao,re.ID),pn&&(Lt&&this.collisionIndex.insertCollisionCircles(pn.circles,C.get("text-ignore-placement"),w.bucketInstanceId,Qr,re.ID),_)){const ti=w.bucketInstanceId;let $n=this.collisionCircleArrays[ti];void 0===$n&&($n=this.collisionCircleArrays[ti]=new fi);for(let tr=0;tr<pn.circles.length;tr+=4)$n.circles.push(pn.circles[tr+0]),$n.circles.push(pn.circles[tr+1]),$n.circles.push(pn.circles[tr+2]),$n.circles.push(pn.collisionDetected?1:0)}const Po="globe"!==this.transform.projection.name;$e=$e&&(Po||!Ht),je=je&&(Po||!At),this.placements[Me.crossTileID]=new jo(Lt||$e,Ne||je,jt||w.justReloaded),h[Me.crossTileID]=!0};if(ze){const Me=w.getSortedSymbolIndexes(this.transform.angle);for(let at=Me.length-1;at>=0;--at){const ut=Me[at];mt(w.symbolInstances.get(ut),ut,w.collisionArrays[ut])}}else for(let Me=i.symbolInstanceStart;Me<i.symbolInstanceEnd;Me++)mt(w.symbolInstances.get(Me),Me,w.collisionArrays[Me]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[w.bucketInstanceId];f.invert(Me.invProjMatrix,S),Me.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(i,h,_,b){let w;w=b===f.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[f.getAnchorJustification(h)];const C=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const S of C)S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=w>=0&&S!==w?0:_.crossTileID)}markUsedOrientation(i,h,_){const b=h===f.WritingMode.horizontal||h===f.WritingMode.horizontalOnly?h:0,w=h===f.WritingMode.vertical?h:0,C=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const S of C)i.text.placedSymbolArray.get(S).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const b=h?h.symbolFadeChange(i):1,w=h?h.opacities:{},C=h?h.variableOffsets:{},S=h?h.placedOrientations:{};for(const P in this.placements){const R=this.placements[P],L=w[P];L?(this.opacities[P]=new ei(L,b,R.text,R.icon,null,R.clipped),_=_||R.text!==L.text.placed||R.icon!==L.icon.placed):(this.opacities[P]=new ei(null,b,R.text,R.icon,R.skipFade,R.clipped),_=_||R.text||R.icon)}for(const P in w){const R=w[P];if(!this.opacities[P]){const L=new ei(R,b,!1,!1);L.isHidden()||(this.opacities[P]=L,_=_||R.text.placed||R.icon.placed)}}for(const P in C)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=C[P]);for(const P in S)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=S[P]);_?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:i)}updateLayerOpacities(i,h){const _={};for(const b of h){const w=b.getBucket(i);w&&b.latestFeatureIndex&&i.id===w.layerIds[0]&&this.updateBucketOpacities(w,_,b.collisionBoxArray)}}updateBucketOpacities(i,h,_){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const b=i.layers[0].layout,w=!!i.layers[0].dynamicFilter(),C=new ei(null,0,!1,!1,!0),S=b.get("text-allow-overlap"),P=b.get("icon-allow-overlap"),R=b.get("text-variable-anchor"),L="map"===b.get("text-rotation-alignment"),B="map"===b.get("text-pitch-alignment"),$="none"!==b.get("icon-text-fit"),W=new ei(null,0,S&&(P||!i.hasIconData()||b.get("icon-optional")),P&&(S||!i.hasTextData()||b.get("text-optional")),!0);!i.collisionArrays&&_&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(_);const q=(re,J,te)=>{for(let ie=0;ie<J/4;ie++)re.opacityVertexArray.emplaceBack(te)};let V=0;for(let re=0;re<i.symbolInstances.length;re++){const J=i.symbolInstances.get(re),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ie,crossTileID:le}=J;let ee=this.opacities[le];h[le]?ee=C:ee||(ee=W,this.opacities[le]=ee),h[le]=!0;const he=te>0||ie>0,Ae=J.numIconVertices>0,ze=this.placedOrientations[J.crossTileID],$e=ze===f.WritingMode.vertical,je=ze===f.WritingMode.horizontal||ze===f.WritingMode.horizontalOnly;if(!he&&!Ae||ee.isHidden()||V++,he){const mt=Hr(ee.text);q(i.text,te,$e?dr:mt),q(i.text,ie,je?dr:mt);const Me=ee.text.isHidden();[J.rightJustifiedTextSymbolIndex,J.centerJustifiedTextSymbolIndex,J.leftJustifiedTextSymbolIndex].forEach(Lt=>{Lt>=0&&(i.text.placedSymbolArray.get(Lt).hidden=Me||$e?1:0)}),J.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(J.verticalPlacedTextSymbolIndex).hidden=Me||je?1:0);const at=this.variableOffsets[J.crossTileID];at&&this.markUsedJustification(i,at.anchor,J,ze);const ut=this.placedOrientations[J.crossTileID];ut&&(this.markUsedJustification(i,"left",J,ut),this.markUsedOrientation(i,ut,J))}if(Ae){const mt=Hr(ee.icon);J.placedIconSymbolIndex>=0&&(q(i.icon,J.numIconVertices,$e?dr:mt),i.icon.placedSymbolArray.get(J.placedIconSymbolIndex).hidden=ee.icon.isHidden()),J.verticalPlacedIconSymbolIndex>=0&&(q(i.icon,J.numVerticalIconVertices,je?dr:mt),i.icon.placedSymbolArray.get(J.verticalPlacedIconSymbolIndex).hidden=ee.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const mt=i.collisionArrays[re];if(mt){let Me=new f.pointGeometry(0,0),at=!0;if(mt.textBox||mt.verticalTextBox){if(R){const Lt=this.variableOffsets[le];Lt?(Me=Cs(Lt.anchor,Lt.width,Lt.height,Lt.textOffset,Lt.textScale),L&&Me._rotate(B?this.transform.angle:-this.transform.angle)):at=!1}w&&(at=!ee.clipped),mt.textBox&&An(i.textCollisionBox.collisionVertexArray,ee.text.placed,!at||$e,Me.x,Me.y),mt.verticalTextBox&&An(i.textCollisionBox.collisionVertexArray,ee.text.placed,!at||je,Me.x,Me.y)}const ut=at&&Boolean(!je&&mt.verticalIconBox);mt.iconBox&&An(i.iconCollisionBox.collisionVertexArray,ee.icon.placed,ut,$?Me.x:0,$?Me.y:0),mt.verticalIconBox&&An(i.iconCollisionBox.collisionVertexArray,ee.icon.placed,!ut,$?Me.x:0,$?Me.y:0)}}}if(i.fullyClipped=0===V,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=re.invProjMatrix,i.placementViewportMatrix=re.viewportMatrix,i.collisionCircleArray=re.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>i}setStale(){this.stale=!0}}function An(p,i,h,_,b){p.emplaceBack(i?1:0,h?1:0,_||0,b||0),p.emplaceBack(i?1:0,h?1:0,_||0,b||0),p.emplaceBack(i?1:0,h?1:0,_||0,b||0),p.emplaceBack(i?1:0,h?1:0,_||0,b||0)}const Yl=Math.pow(2,25),Jl=Math.pow(2,24),fe=Math.pow(2,17),Fe=Math.pow(2,16),st=Math.pow(2,9),Dn=Math.pow(2,8),Hn=Math.pow(2,1);function Hr(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const i=p.placed?1:0,h=Math.floor(127*p.opacity);return h*Yl+i*Jl+h*fe+i*Fe+h*st+i*Dn+h*Hn+i}const dr=0;class yr{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,h,_,b,w){const C=this._bucketParts;for(;this._currentTileIndex<i.length;)if(h.getBucketParts(C,b,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((S,P)=>S.sortKey-P.sortKey));this._currentPartIndex<C.length;){const S=C[this._currentPartIndex];if(h.placeLayerBucketPart(S,this._seenCrossTileIDs,_,0===S.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class po{constructor(i,h,_,b,w,C,S,P){this.placement=new za(i,w,C,S,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(i,h,_){const b=f.exported.now(),w=()=>{const C=f.exported.now()-b;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=h[i[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===C.type&&(!C.minzoom||C.minzoom<=S)&&(!C.maxzoom||C.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new yr(C)),this._inProgressLayer.continuePlacement(_[C.source],this.placement,this._showCollisionBoxes,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Dr=512/f.EXTENT/2;class vl{constructor(i,h,_){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let b=0;b<h.length;b++){const w=h.get(b),C=w.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,i)})}}getScaledCoordinates(i,h){const _=Dr/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*f.EXTENT+i.tileAnchorX)*_),y:Math.floor((h.canonical.y*f.EXTENT+i.tileAnchorY)*_)}}findMatches(i,h,_){const b=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let w=0;w<i.length;w++){const C=i.get(w);if(C.crossTileID)continue;const S=this.indexedSymbolInstances[C.key];if(!S)continue;const P=this.getScaledCoordinates(C,h);for(const R of S)if(Math.abs(R.coord.x-P.x)<=b&&Math.abs(R.coord.y-P.y)<=b&&!_[R.crossTileID]){_[R.crossTileID]=!0,C.crossTileID=R.crossTileID;break}}}}class ii{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const h=Math.round((i-this.lng)/360);if(0!==h)for(const _ in this.indexes){const b=this.indexes[_],w={};for(const C in b){const S=b[C];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),w[S.tileID.key]=S}this.indexes[_]=w}this.lng=i}addBucket(i,h,_){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const b=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const C=this.indexes[w];if(Number(w)>i.overscaledZ)for(const S in C){const P=C[S];P.tileID.isChildOf(i)&&P.findMatches(h.symbolInstances,i,b)}else{const S=C[i.scaledTo(Number(w)).key];S&&S.findMatches(h.symbolInstances,i,b)}}for(let w=0;w<h.symbolInstances.length;w++){const C=h.symbolInstances.get(w);C.crossTileID||(C.crossTileID=_.generate(),b[C.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new vl(i,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(i,h){for(const _ in h.indexedSymbolInstances)for(const b of h.indexedSymbolInstances[_])delete this.usedCrossTileIDs[i][b.crossTileID]}removeStaleBuckets(i){let h=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const w in b)i[b[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[w]),delete b[w],h=!0)}return h}}class Ds{constructor(){this.layerIndexes={},this.crossTileIDs=new ii,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,h,_,b){let w=this.layerIndexes[i.id];void 0===w&&(w=this.layerIndexes[i.id]=new xl);let C=!1;const S={};"globe"!==b.name&&w.handleWrapJump(_);for(const P of h){const R=P.getBucket(i);R&&i.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(P.tileID,R,this.crossTileIDs)&&(C=!0),S[R.bucketInstanceId]=!0)}return w.removeStaleBuckets(S)&&(C=!0),C}pruneUnusedLayers(i){const h={};i.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const oi=(p,i)=>f.emitValidationErrors(p,i&&i.filter(h=>"source.canvas"!==h.identifier)),Ss=f.pick(Ot,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Vo=f.pick(Ot,["setCenter","setZoom","setBearing","setPitch"]),Yr={version:8,layers:[],sources:{}},Lr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class fr extends f.Evented{constructor(i,h={}){super(),this.map=i,this.dispatcher=new un(Xt(),this),this.imageManager=new en,this.imageManager.setEventedParent(this),this.glyphManager=new f.GlyphManager(i._requestManager,h.localFontFamily?f.LocalGlyphMode.all:h.localIdeographFontFamily?f.LocalGlyphMode.ideographs:f.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new f.LineAtlas(256,512),this.crossTileSymbolIndex=new Ds,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new f.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",f.getReferrer());const _=this;this._rtlTextPluginCallback=fr.registerForPluginStateChange(b=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(w,C)=>{if(f.triggerPluginCompletionEvent(w),C&&C.every(S=>S))for(const S in _._sourceCaches){const P=_._sourceCaches[S],R=P.getSource().type;"vector"!==R&&"geojson"!==R||P.reload()}})}),this.on("data",b=>{if("source"!==b.dataType||"metadata"!==b.sourceDataType)return;const w=this.getSource(b.sourceId);if(w&&w.vectorLayerIds)for(const C in this._layers){const S=this._layers[C];S.source===w.id&&this._validateLayer(S)}})}loadURL(i,h={}){this.fire(new f.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!f.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,h.accessToken);const b=this.map._requestManager.transformRequest(i,f.ResourceType.Style);this._request=f.getJSON(b,(w,C)=>{this._request=null,w?this.fire(new f.ErrorEvent(w)):C&&this._load(C,_)})}loadJSON(i,h={}){this.fire(new f.Event("dataloading",{dataType:"style"})),this._request=f.exported.frame(()=>{this._request=null,this._load(i,!1!==h.validate)})}loadEmpty(){this.fire(new f.Event("dataloading",{dataType:"style"})),this._load(Yr,!1)}_updateLayerCount(i,h){const _=h?1:-1;i.is3D()&&(this._num3DLayers+=_),"circle"===i.type&&(this._numCircleLayers+=_),"symbol"===i.type&&(this._numSymbolLayers+=_)}_load(i,h){if(h&&oi(this,f.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i,this._updateMapProjection();for(const b in i.sources)this.addSource(b,i.sources[b],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const _=Yn(this.stylesheet.layers);this._order=_.map(b=>b.id),this._layers={},this._serializedLayers={};for(let b of _)b=f.createStyleLayer(b),b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new St(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new f.Event("data",{dataType:"style"})),this.fire(new f.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(i){this._spriteRequest=function(h,_,b){let w,C,S;const P=f.exported.devicePixelRatio>1?"@2x":"";let R=f.getJSON(_.transformRequest(_.normalizeSpriteURL(h,P,".json"),f.ResourceType.SpriteJSON),($,W)=>{R=null,S||(S=$,w=W,B())}),L=f.getImage(_.transformRequest(_.normalizeSpriteURL(h,P,".png"),f.ResourceType.SpriteImage),($,W)=>{L=null,S||(S=$,C=W,B())});function B(){if(S)b(S);else if(w&&C){const $=f.exported.getImageData(C),W={};for(const q in w){const{width:V,height:re,x:J,y:te,sdf:ie,pixelRatio:le,stretchX:ee,stretchY:he,content:Ae}=w[q],ze=new f.RGBAImage({width:V,height:re});f.RGBAImage.copy($,ze,{x:J,y:te},{x:0,y:0},{width:V,height:re}),W[q]={data:ze,pixelRatio:le,sdf:ie,stretchX:ee,stretchY:he,content:Ae}}b(null,W)}}return{cancel(){R&&(R.cancel(),R=null),L&&(L.cancel(),L=null)}}}(i,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new f.ErrorEvent(h));else if(_)for(const b in _)this.imageManager.addImage(b,_[b]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new f.Event("data",{dataType:"style"}))})}_validateLayer(i){const h=this.getSource(i.source);if(!h)return;const _=i.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new f.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const h=[];for(const _ of i){const b=this._layers[_];"custom"!==b.type&&h.push(b.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&Lr[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const h=this._changed;if(this._changed){const b=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(b.length||w.length)&&this._updateWorkerLayers(b,w);for(const C in this._updatedSources){const S=this._updatedSources[C];"reload"===S?this._reloadSource(C):"clear"===S&&this._clearSource(C)}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const _={};for(const b in this._sourceCaches){const w=this._sourceCaches[b];_[b]=w.used,w.used=!1}for(const b of this._order){const w=this._layers[b];if(w.recalculate(i,this._availableImages),!w.isHidden(i.zoom)){const S=this._getLayerSourceCache(w);S&&(S.used=!0)}const C=this.map.painter;if(C){const S=w.getProgramIds();if(!S)continue;const P=w.getProgramConfiguration(i.zoom);for(const R of S)C.useProgram(R,P)}}for(const b in _){const w=this._sourceCaches[b];_[b]!==w.used&&w.getSource().fire(new f.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new f.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),oi(this,f.validateStyle(i)))return!1;(i=f.clone$1(i)).layers=Yn(i.layers);const h=function(b,w){if(!b)return[{command:Ot.setStyle,args:[w]}];let C=[];try{if(!se(b.version,w.version))return[{command:Ot.setStyle,args:[w]}];se(b.center,w.center)||C.push({command:Ot.setCenter,args:[w.center]}),se(b.zoom,w.zoom)||C.push({command:Ot.setZoom,args:[w.zoom]}),se(b.bearing,w.bearing)||C.push({command:Ot.setBearing,args:[w.bearing]}),se(b.pitch,w.pitch)||C.push({command:Ot.setPitch,args:[w.pitch]}),se(b.sprite,w.sprite)||C.push({command:Ot.setSprite,args:[w.sprite]}),se(b.glyphs,w.glyphs)||C.push({command:Ot.setGlyphs,args:[w.glyphs]}),se(b.transition,w.transition)||C.push({command:Ot.setTransition,args:[w.transition]}),se(b.light,w.light)||C.push({command:Ot.setLight,args:[w.light]}),se(b.fog,w.fog)||C.push({command:Ot.setFog,args:[w.fog]}),se(b.projection,w.projection)||C.push({command:Ot.setProjection,args:[w.projection]});const S={},P=[];!function(B,$,W,q){let V;for(V in $=$||{},B=B||{})B.hasOwnProperty(V)&&($.hasOwnProperty(V)||Mn(V,W,q));for(V in $)$.hasOwnProperty(V)&&(B.hasOwnProperty(V)?se(B[V],$[V])||("geojson"===B[V].type&&"geojson"===$[V].type&&Do(B,$,V)?W.push({command:Ot.setGeoJSONSourceData,args:[V,$[V].data]}):ns(V,$,W,q)):Gn(V,$,W))}(b.sources,w.sources,P,S);const R=[];b.layers&&b.layers.forEach(B=>{B.source&&S[B.source]?C.push({command:Ot.removeLayer,args:[B.id]}):R.push(B)});let L=b.terrain;L&&S[L.source]&&(C.push({command:Ot.setTerrain,args:[void 0]}),L=void 0),C=C.concat(P),se(L,w.terrain)||C.push({command:Ot.setTerrain,args:[w.terrain]}),function(B,$,W){$=$||[];const q=(B=B||[]).map(an),V=$.map(an),re=B.reduce(Zt,{}),J=$.reduce(Zt,{}),te=q.slice(),ie=Object.create(null);let le,ee,he,Ae,ze,$e,je;for(le=0,ee=0;le<q.length;le++)he=q[le],J.hasOwnProperty(he)?ee++:(W.push({command:Ot.removeLayer,args:[he]}),te.splice(te.indexOf(he,ee),1));for(le=0,ee=0;le<V.length;le++)he=V[V.length-1-le],te[te.length-1-le]!==he&&(re.hasOwnProperty(he)?(W.push({command:Ot.removeLayer,args:[he]}),te.splice(te.lastIndexOf(he,te.length-ee),1)):ee++,$e=te[te.length-le],W.push({command:Ot.addLayer,args:[J[he],$e]}),te.splice(te.length-le,0,he),ie[he]=!0);for(le=0;le<V.length;le++)if(he=V[le],Ae=re[he],ze=J[he],!ie[he]&&!se(Ae,ze))if(se(Ae.source,ze.source)&&se(Ae["source-layer"],ze["source-layer"])&&se(Ae.type,ze.type)){for(je in xt(Ae.layout,ze.layout,W,he,null,Ot.setLayoutProperty),xt(Ae.paint,ze.paint,W,he,null,Ot.setPaintProperty),se(Ae.filter,ze.filter)||W.push({command:Ot.setFilter,args:[he,ze.filter]}),se(Ae.minzoom,ze.minzoom)&&se(Ae.maxzoom,ze.maxzoom)||W.push({command:Ot.setLayerZoomRange,args:[he,ze.minzoom,ze.maxzoom]}),Ae)Ae.hasOwnProperty(je)&&"layout"!==je&&"paint"!==je&&"filter"!==je&&"metadata"!==je&&"minzoom"!==je&&"maxzoom"!==je&&(0===je.indexOf("paint.")?xt(Ae[je],ze[je],W,he,je.slice(6),Ot.setPaintProperty):se(Ae[je],ze[je])||W.push({command:Ot.setLayerProperty,args:[he,je,ze[je]]}));for(je in ze)ze.hasOwnProperty(je)&&!Ae.hasOwnProperty(je)&&"layout"!==je&&"paint"!==je&&"filter"!==je&&"metadata"!==je&&"minzoom"!==je&&"maxzoom"!==je&&(0===je.indexOf("paint.")?xt(Ae[je],ze[je],W,he,je.slice(6),Ot.setPaintProperty):se(Ae[je],ze[je])||W.push({command:Ot.setLayerProperty,args:[he,je,ze[je]]}))}else W.push({command:Ot.removeLayer,args:[he]}),$e=te[te.lastIndexOf(he)+1],W.push({command:Ot.addLayer,args:[ze,$e]})}(R,w.layers,C)}catch(S){console.warn("Unable to compute style diff:",S),C=[{command:Ot.setStyle,args:[w]}]}return C}(this.serialize(),i).filter(b=>!(b.command in Vo));if(0===h.length)return!1;const _=h.filter(b=>!(b.command in Ss));if(_.length>0)throw new Error(`Unimplemented: ${_.map(b=>b.command).join(", ")}.`);return h.forEach(b=>{"setTransition"!==b.command&&this[b.command].apply(this,b.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,h){return this.getImage(i)?this.fire(new f.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,h),this._afterImageUpdated(i),this)}updateImage(i,h){this.imageManager.updateImage(i,h)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new f.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new f.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(f.validateSource,`sources.${i}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const b=we(i,h,this.dispatcher,this);b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:b.serialize(),sourceId:i}));const w=C=>{const S=(C?"symbol:":"other:")+i,P=this._sourceCaches[S]=new f.SourceCache(S,b,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[i]=P,P.style=this,P.onAdd(this.map)};w(!1),"vector"!==h.type&&"geojson"!==h.type||w(!0),b.onAdd&&b.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const h=this.getSource(i);if(!h)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===i)return this.fire(new f.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new f.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(i);for(const b of _)delete this._sourceCaches[b.id],delete this._updatedSources[b.id],b.fire(new f.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,h){this._checkLoaded(),this.getSource(i).setData(h),this._changed=!0}getSource(i){const h=this._getSourceCache(i);return h&&h.getSource()}addLayer(i,h,_={}){this._checkLoaded();const b=i.id;if(this.getLayer(b))return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${b}" already exists on this map`)));let w;if("custom"===i.type){if(oi(this,f.validateCustomStyleLayer(i)))return;w=f.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(b,i.source),i=f.clone$1(i),i=f.extend(i,{source:b})),this._validate(f.validateLayer,`layers.${b}`,i,{arrayIndex:-1},_))return;w=f.createStyleLayer(i),this._validateLayer(w),w.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const C=h?this._order.indexOf(h):this._order.length;if(h&&-1===C)return void this.fire(new f.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(C,0,b),this._layerOrderChanged=!0,this._layers[b]=w;const S=this._getLayerSourceCache(w);if(this._removedLayers[b]&&w.source&&S&&"custom"!==w.type){const P=this._removedLayers[b];delete this._removedLayers[b],P.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",S.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,h){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===h)return;const _=this._order.indexOf(i);this._order.splice(_,1);const b=h?this._order.indexOf(h):this._order.length;h&&-1===b?this.fire(new f.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(b,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const h=this._layers[i];if(!h)return void this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(i);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=h,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const h in this._layers)if(this._layers[h].type===i)return!0;return!1}setLayerZoomRange(i,h,_){this._checkLoaded();const b=this.getLayer(i);b?b.minzoom===h&&b.maxzoom===_||(null!=h&&(b.minzoom=h),null!=_&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,h,_={}){this._checkLoaded();const b=this.getLayer(i);if(b){if(!se(b.filter,h))return null==h?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(f.validateFilter,`layers.${b.id}.filter`,h,{layerType:b.type},_)||(b.filter=f.clone$1(h),this._updateLayer(b)))}else this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const h=this.getLayer(i);return h&&f.clone$1(h.filter)}setLayoutProperty(i,h,_,b={}){this._checkLoaded();const w=this.getLayer(i);w?se(w.getLayoutProperty(h),_)||(w.setLayoutProperty(h,_,b),this._updateLayer(w)):this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,h){const _=this.getLayer(i);if(_)return _.getLayoutProperty(h);this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,h,_,b={}){this._checkLoaded();const w=this.getLayer(i);w?se(w.getPaintProperty(h),_)||(w.setPaintProperty(h,_,b)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new f.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,h){const _=this.getLayer(i);return _&&_.getPaintProperty(h)}setFeatureState(i,h){this._checkLoaded();const _=i.source,b=i.sourceLayer,w=this.getSource(_);if(!w)return void this.fire(new f.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=w.type;if("geojson"===C&&b)return void this.fire(new f.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===C&&!b)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(_);for(const P of S)P.setFeatureState(b,i.id,h)}removeFeatureState(i,h){this._checkLoaded();const _=i.source,b=this.getSource(_);if(!b)return void this.fire(new f.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const w=b.type,C="vector"===w?i.sourceLayer:void 0;if("vector"===w&&!C)return void this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new f.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(_);for(const P of S)P.removeFeatureState(C,i.id,h)}getFeatureState(i){this._checkLoaded();const h=i.source,_=i.sourceLayer,b=this.getSource(h);if(b){if("vector"!==b.type||_)return void 0===i.id&&this.fire(new f.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,i.id);this.fire(new f.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new f.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return f.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();i[_.id]||(i[_.id]=_.serialize())}return f.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(i){this._updatedLayers[i.id]=!0;const h=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[i.source]="reload",h.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const h=C=>"fill-extrusion"===this._layers[C].type,_={},b=[];for(let C=this._order.length-1;C>=0;C--){const S=this._order[C];if(h(S)){_[S]=C;for(const P of i){const R=P[S];if(R)for(const L of R)b.push(L)}}}b.sort((C,S)=>S.intersectionZ-C.intersectionZ);const w=[];for(let C=this._order.length-1;C>=0;C--){const S=this._order[C];if(h(S))for(let P=b.length-1;P>=0;P--){const R=b[P].feature;if(_[R.layer.id]<C)break;w.push(R),b.pop()}else for(const P of i){const R=P[S];if(R)for(const L of R)w.push(L.feature)}}return w}queryRenderedFeatures(i,h,_){h&&h.filter&&this._validate(f.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const b={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new f.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of h.layers){const R=this._layers[P];if(!R)return this.fire(new f.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];b[R.source]=!0}}const w=[];h.availableImages=this._availableImages;const C=h&&h.layers?h.layers.some(P=>{const R=this.getLayer(P);return R&&R.is3D()}):this.has3DLayers(),S=cr.createFromScreenPoints(i,_);for(const P in this._sourceCaches){const R=this._sourceCaches[P].getSource().id;h.layers&&!b[R]||w.push(Pe(this._sourceCaches[P],this._layers,this._serializedLayers,S,h,_,C,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(P,R,L,B,$,W,q){const V={},re=W.queryRenderedSymbols(B),J=[];for(const te of Object.keys(re).map(Number))J.push(q[te]);J.sort(vt);for(const te of J){const ie=te.featureIndex.lookupSymbolFeatures(re[te.bucketInstanceId],R,te.bucketIndex,te.sourceLayerIndex,$.filter,$.layers,$.availableImages,P);for(const le in ie){const ee=V[le]=V[le]||[],he=ie[le];he.sort((Ae,ze)=>{const $e=te.featureSortOrder;if($e){const je=$e.indexOf(Ae.featureIndex);return $e.indexOf(ze.featureIndex)-je}return ze.featureIndex-Ae.featureIndex});for(const Ae of he)ee.push(Ae)}}for(const te in V)V[te].forEach(ie=>{const le=ie.feature,ee=L(P[te]).getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=ee});return V}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(i,h){h&&h.filter&&this._validate(f.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(i);let b=[];for(const w of _)b=b.concat(Ke(w,h));return b}addSourceType(i,h,_){return fr.getSourceType(i)?_(new Error(`A source type called "${i}" already exists.`)):(fr.setSourceType(i,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(i,h={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const C in i)if(!se(i[C],_[C])){b=!0;break}if(!b)return;const w={now:f.exported.now(),transition:f.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,h),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,h=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===h){if("object"==typeof i.source){const _="terrain-dem-src";this.addSource(_,i.source),i=f.clone$1(i),i=f.extend(i,{source:_})}if(this._validate(f.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(i,h);else{const _=this.terrain,b=_.get();for(const w in i)if(!se(i[w],b[w])){_.set(i),this.stylesheet.terrain=i;const C={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(C);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const h=this.fog=new On(i,this.map.transform);this.stylesheet.fog=i;const _={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();for(const b in i)if(!se(i[b],_[b])){h.set(i),this.stylesheet.fog=i;const w={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(w);break}}else this._createFog(i);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...h)}_createTerrain(i,h){const _=this.terrain=new tt(i,h);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const b={now:f.exported.now(),transition:f.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(b)}_force3DLayerUpdate(){for(const i in this._layers){const h=this._layers[i];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const h=this._layers[i];"symbol"===h.type&&this._updateLayer(h)}}_validate(i,h,_,b,w={}){return(!w||!1!==w.validate)&&oi(this,i.call(f.validateStyle,f.extend({key:h,style:this.serialize(),value:_,styleSpec:f.spec},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),f.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const h=this._getSourceCaches(i);for(const _ of h)_.clearTiles()}_reloadSource(i){const h=this._getSourceCaches(i);for(const _ of h)_.resume(),_.reload()}_updateSources(i){for(const h in this._sourceCaches)this._sourceCaches[h].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const h=this._sourceCaches[i];h.resume(),h.reload()}}_updatePlacement(i,h,_,b,w=!1){let C=!1,S=!1;const P={};for(const R of this._order){const L=this._layers[R];if("symbol"!==L.type)continue;if(!P[L.source]){const $=this._getLayerSourceCache(L);if(!$)continue;P[L.source]=$.getRenderableIds(!0).map(W=>$.getTileByID(W)).sort((W,q)=>q.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(q.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(L,P[L.source],i.center.lng,i.projection);C=C||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new f.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(f.exported.now(),i.zoom))&&(this.pauseablePlacement=new po(i,this._order,w,h,_,b,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(f.exported.now()),S=!0),C&&this.pauseablePlacement.placement.setStale()),S||C)for(const R of this._order){const L=this._layers[R];"symbol"===L.type&&this.placement.updateLayerOpacities(L,P[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(f.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const b=w=>{w&&w.setDependencies(h.tileID.key,h.type,h.icons)};b(this._otherSourceCaches[h.source]),b(this._symbolSourceCaches[h.source])}getGlyphs(i,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(i,h,_){return f.makeRequest(h,_)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const h=[];return this._otherSourceCaches[i]&&h.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&h.push(this._symbolSourceCaches[i]),h}_isSourceCacheLoaded(i){const h=this._getSourceCaches(i);return 0===h.length?(this.fire(new f.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}fr.getSourceType=function(p){return pe[p]},fr.setSourceType=function(p,i){pe[p]=i},fr.registerForPluginStateChange=f.registerForPluginStateChange;var Li="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",ne="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ce={},Qe={};Ce=bt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Qe=bt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const $t=bt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ar=Li;var Tn={background:bt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:bt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:bt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:bt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:bt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:bt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:bt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:bt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:bt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:bt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:bt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:bt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:bt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:bt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:bt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:bt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:bt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:bt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:bt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:bt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:bt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:bt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:bt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:bt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:bt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ne),skyboxGradient:bt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ne),skyboxCapture:bt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:bt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:bt("uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)\ndiscard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function bt(p,i,h){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,w=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),C=p.match(b),S=i.match(b),P=Li.match(b);let R=S?S.concat(C):C;h||(Ce.staticUniforms&&(R=Ce.staticUniforms.concat(R)),Qe.staticUniforms&&(R=Qe.staticUniforms.concat(R))),R&&(R=R.concat(P));const L={};return{fragmentSource:p=p.replace(_,(B,$,W,q,V)=>(L[V]=!0,"define"===$?`\n#ifndef HAS_UNIFORM_u_${V}\nvarying ${W} ${q} ${V};\n#else\nuniform ${W} ${q} u_${V};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${V}\n    ${W} ${q} ${V} = u_${V};\n#endif\n`)),vertexSource:i=i.replace(_,(B,$,W,q,V)=>{const re="float"===q?"vec2":"vec4",J=V.match(/color/)?"color":re;return L[V]?"define"===$?`\n#ifndef HAS_UNIFORM_u_${V}\nuniform lowp float u_${V}_t;\nattribute ${W} ${re} a_${V};\nvarying ${W} ${q} ${V};\n#else\nuniform ${W} ${q} u_${V};\n#endif\n`:"vec4"===J?`\n#ifndef HAS_UNIFORM_u_${V}\n    ${V} = a_${V};\n#else\n    ${W} ${q} ${V} = u_${V};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${V}\n    ${V} = unpack_mix_${J}(a_${V}, u_${V}_t);\n#else\n    ${W} ${q} ${V} = u_${V};\n#endif\n`:"define"===$?`\n#ifndef HAS_UNIFORM_u_${V}\nuniform lowp float u_${V}_t;\nattribute ${W} ${re} a_${V};\n#else\nuniform ${W} ${q} u_${V};\n#endif\n`:"vec4"===J?`\n#ifndef HAS_UNIFORM_u_${V}\n    ${W} ${q} ${V} = a_${V};\n#else\n    ${W} ${q} ${V} = u_${V};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${V}\n    ${W} ${q} ${V} = unpack_mix_${J}(a_${V}, u_${V}_t);\n#else\n    ${W} ${q} ${V} = u_${V};\n#endif\n`}),staticAttributes:w,staticUniforms:R}}class Jn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,h,_,b,w,C,S,P){this.context=i;let R=this.boundPaintVertexBuffers.length!==b.length;for(let L=0;!R&&L<b.length;L++)this.boundPaintVertexBuffers[L]!==b[L]&&(R=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===_&&!R&&this.boundIndexBuffer===w&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===P?(i.bindVertexArrayOES.set(this.vao),S&&S.bind(),w&&w.dynamicDraw&&w.bind(),P&&P.bind()):this.freshBind(h,_,b,w,C,S,P)}freshBind(i,h,_,b,w,C,S){let P;const R=i.numAttributes,L=this.context,B=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=i,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=S;else{P=L.currentNumAttributes||0;for(let $=R;$<P;$++)B.disableVertexAttribArray($)}h.enableAttributes(B,i);for(const $ of _)$.enableAttributes(B,i);C&&C.enableAttributes(B,i),S&&S.enableAttributes(B,i),h.bind(),h.setVertexAttribPointers(B,i,w);for(const $ of _)$.bind(),$.setVertexAttribPointers(B,i,w);C&&(C.bind(),C.setVertexAttribPointers(B,i,w)),b&&b.bind(),S&&(S.bind(),S.setVertexAttribPointers(B,i,w)),L.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function pi(p,i){const h=Math.pow(2,i.canonical.z),_=i.canonical.y;return[new f.MercatorCoordinate(0,_/h).toLngLat().lat,new f.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function er(p,i,h,_,b,w,C){const S=p.context,P=S.gl,R=h.fbo;if(!R)return;p.prepareDrawTile();const L=p.useProgram("hillshade");S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,R.colorAttachment.get());const B=((V,re,J,te)=>{const ie=J.paint.get("hillshade-shadow-color"),le=J.paint.get("hillshade-highlight-color"),ee=J.paint.get("hillshade-accent-color");let he=J.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===J.paint.get("hillshade-illumination-anchor")&&(he-=V.transform.angle);const Ae=!V.options.moving;return{u_matrix:te||V.transform.calculateProjMatrix(re.tileID.toUnwrapped(),Ae),u_image:0,u_latrange:pi(0,re.tileID),u_light:[J.paint.get("hillshade-exaggeration"),he],u_shadow:ie,u_highlight:le,u_accent:ee}})(p,h,_,p.terrain?i.projMatrix:null);p.prepareDrawProgram(S,L,i.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:W,tileBoundsSegments:q}=p.getTileBoundsBuffers(h);L.draw(S,P.TRIANGLES,b,w,C,f.CullFaceMode.disabled,B,_.id,$,W,q)}function Dt(p,i,h){if(!i.needsDEMTextureUpload)return;const _=p.context,b=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||p.getTileTexture(h.stride);const w=h.getPixels();i.demTexture?i.demTexture.update(w,{premultiply:!1}):i.demTexture=new f.Texture(_,w,b.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function vn(p,i,h,_,b,w){const C=p.context,S=C.gl;if(!i.dem)return;const P=i.dem;if(C.activeTexture.set(S.TEXTURE1),Dt(p,i,P),!i.demTexture)return;i.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const R=P.dim;C.activeTexture.set(S.TEXTURE0);let L=i.fbo;if(!L){const q=new f.Texture(C,{width:R,height:R,data:null},S.RGBA);q.bind(S.LINEAR,S.CLAMP_TO_EDGE),L=i.fbo=C.createFramebuffer(R,R,!0),L.colorAttachment.set(q.texture)}C.bindFramebuffer.set(L.framebuffer),C.viewport.set([0,0,R,R]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:$,tileBoundsSegments:W}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(C,S.TRIANGLES,_,b,w,f.CullFaceMode.disabled,((q,V)=>{const re=V.stride,J=f.create();return f.ortho(J,0,f.EXTENT,-f.EXTENT,0,0,1),f.translate(J,J,[0,-f.EXTENT,0]),{u_matrix:J,u_image:1,u_dimension:[re,re],u_zoom:q.overscaledZ,u_unpack:V.unpackVector}})(i.tileID,P),h.id,B,$,W),i.needsHillshadePrepare=!1}const Bn=(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_image0:new f.Uniform1i(p,i.u_image0),u_skirt_height:new f.Uniform1f(p,i.u_skirt_height)}),Fr=(p,i)=>({u_matrix:p,u_image0:0,u_skirt_height:i}),li=(p,i,h,_,b,w)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:i,u_merc_matrix:h,u_zoom_transition:_,u_merc_center:b,u_image0:0,u_grid_matrix:w?Float32Array.from(w):new Float32Array(9)});function Er(p,i){return null!=p&&null!=i&&!(!p.hasData()||!i.hasData())&&null!=p.demTexture&&null!=i.demTexture&&p.tileID.key!==i.tileID.key}const Jr=new class{constructor(){this.operations={}}newMorphing(p,i,h,_,b){if(p in this.operations){const w=this.operations[p];w.to.tileID.key!==h.tileID.key&&(w.queued=h)}else this.operations[p]={startTime:_,phase:0,duration:b,from:i,to:h,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const i=this.operations[p];return{from:i.from,to:i.to,phase:i.phase}}update(p){for(const i in this.operations){const h=this.operations[i];for(h.phase=(p-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,p)){delete this.operations[i];break}}}_nextOp(p,i){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=i,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},ur={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Is(p,i){const h=1<<p.z;return!i&&(0===p.x||p.x===h-1)||0===p.y||p.y===h-1}const mo=p=>({u_matrix:p});function In(p,i,h,_,b){if(b>0){const w=f.exported.now(),C=(w-p.timeAdded)/b,S=i?(w-i.timeAdded)/b:-1,P=h.getSource(),R=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),L=!i||Math.abs(i.tileID.overscaledZ-R)>Math.abs(p.tileID.overscaledZ-R),B=L&&p.refreshedUponExpiration?1:f.clamp(L?C:1-S,0,1);return p.refreshedUponExpiration&&C>=1&&(p.refreshedUponExpiration=!1),i?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}const qc=2*f.mercatorZfromAltitude(1,0)*f.GLOBE_RADIUS*Math.PI;class Ms extends f.SourceCache{constructor(i){const h={type:"raster-dem",maxzoom:i.transform.maxZoom},_=new un(Xt(),null),b=we("mock-dem",h,_,i.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,h){i.state="loaded",h(null)}}class Na extends f.SourceCache{constructor(i){const h=we("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new un(Xt(),null),i.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,h,_){if(i.freezeTileCoverage)return;this.transform=i;const b=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,C)=>{if(w[C.key]="",!this._tiles[C.key]){const S=new f.Tile(C,this._source.tileSize*C.overscaleFactor(),i.tileZoom);S.state="loaded",this._tiles[C.key]=S}return w},{});for(const w in this._tiles)w in b||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(i){const h=this.proxyCachedFBO[i];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ma extends f.OverscaledTileID{constructor(i,h,_){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class jr extends f.Elevation{constructor(i,h){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,b,w]=function(P){const R=new f.StructArrayLayout4i8,L=new f.StructArrayLayout3ui6,B=131;R.reserve(17161),L.reserve(33800);const $=f.EXTENT/128,W=f.EXTENT+$/2,q=W+$;for(let re=-$;re<q;re+=$)for(let J=-$;J<q;J+=$){const te=J<0||J>W||re<0||re>W?24575:0,ie=f.clamp(Math.round(J),0,f.EXTENT),le=f.clamp(Math.round(re),0,f.EXTENT);R.emplaceBack(ie+te,le,ie,le)}const V=(re,J)=>{const te=J*B+re;L.emplaceBack(te+1,te,te+B),L.emplaceBack(te+B,te+B+1,te+1)};for(let re=1;re<129;re++)for(let J=1;J<129;J++)V(J,re);return[0,129].forEach(re=>{for(let J=0;J<130;J++)V(J,re),V(re,J)}),[R,L,32768]}(),C=i.context;this.gridBuffer=C.createVertexBuffer(_,f.boundsAttributes.members),this.gridIndexBuffer=C.createIndexBuffer(b),this.gridSegments=f.SegmentVector.simpleSegment(0,0,_.length,b.length),this.gridNoSkirtSegments=f.SegmentVector.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Na(h.map),this.orthoMatrix=f.create(),f.ortho(this.orthoMatrix,0,f.EXTENT,0,f.EXTENT,0,1);const S=C.gl;this._overlapStencilMode=new f.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ms(h.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,h,_){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const b=i.terrain.properties;this.sourceCache=0===i.terrain.drapeRenderMode?this._mockSourceCache:i._getSourceCache(b.get("source")),this._exaggeration=b.get("exaggeration");const w=()=>{this.sourceCache.used&&f.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(h,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),h.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&f.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=h.getIds().map(P=>{const R=h.getTileByID(P).tileID;return R.projMatrix=_.calculateProjMatrix(R.toUnwrapped()),R});(function(P,R){const L=R.transform.pointCoordinate(R.transform.getCameraPoint()),B=new f.pointGeometry(L.x,L.y);P.sort(($,W)=>{if(W.overscaledZ-$.overscaledZ)return W.overscaledZ-$.overscaledZ;const q=new f.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),V=new f.pointGeometry(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),re=B.mult(1<<$.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(q)-re.distSqr(V)})})(b,this.painter),this._previousZoom=_.zoom;const w=this.proxyToSource||{};this.proxyToSource={},b.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const C=this._style._sourceCaches;for(const P in C){const R=C[P];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,i[P],w),R.usedForTerrain))continue;const L=i[P];R.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[h.id]=b.map(P=>new ma(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=f.exported.now();const S={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const R=this.terrainTileForTile[P.key];if(!R)continue;const L=R.tileID.key;L in S||(this._visibleDemTiles.push(R),S[L]=L)}}_assignTerrainTiles(i){this._initializing||i.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const i=this.painter.context,h=i.gl;for(const _ in this.terrainTileForTile){const b=this.terrainTileForTile[_],w=b.dem;!w||b.demTexture&&!b.needsDEMTextureUpload||(i.activeTexture.set(h.TEXTURE1),Dt(this.painter,b,w))}}_prepareDemTileUniforms(i,h,_,b){if(!h||null==h.demTexture)return!1;const w=i.tileID.canonical,C=Math.pow(2,h.tileID.canonical.z-w.z),S=b||"";return _[`u_dem_tl${S}`]=[w.x*C%1,w.y*C%1],_[`u_dem_scale${S}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,h=i.gl;if(!this._emptyDepthBufferTexture){const _=new f.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new f.Texture(i,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const h=this._visibleDemTiles.reduce((_,b)=>{if(!b.dem)return _;const w=b.dem.tree.minimums[0];return w>0&&i++,_+w},0);return i?h/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,h=i.gl;i.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),b=new f.RGBAImage({width:1,height:1},new Uint8Array(f.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(b,{premultiply:!1}):w=this._emptyDEMTexture=new f.Texture(i,b,h.RGBA,{premultiply:!1}),w}setupElevationDraw(i,h,_){const b=this.painter.context,w=b.gl,C=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:f.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;C.u_dem_size=this.sourceCache.getSource().tileSize,C.u_exaggeration=this.exaggeration();const P=this.painter.transform,R=P.projection,L=i.tileID.canonical;C.u_tile_tl_up=R.upVector(L,0,0),C.u_tile_tr_up=R.upVector(L,f.EXTENT,0),C.u_tile_br_up=R.upVector(L,f.EXTENT,f.EXTENT),C.u_tile_bl_up=R.upVector(L,0,f.EXTENT),C.u_tile_up_scale=_&&_.useDenormalizedUpVectorScale?qc:R.upVectorScale(L,P.center.lat,P.worldSize).metersToTile;let B=null,$=null,W=1;if(_&&_.morphing&&this._useVertexMorphing){const q=_.morphing.srcDemTile,V=_.morphing.dstDemTile;W=_.morphing.phase,q&&V&&(this._prepareDemTileUniforms(i,q,C,"_prev")&&($=q),this._prepareDemTileUniforms(i,V,C)&&(B=V))}if($&&B?(b.activeTexture.set(w.TEXTURE2),B.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),b.activeTexture.set(w.TEXTURE4),$.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),C.u_dem_lerp=W):(B=this.terrainTileForTile[i.tileID.key],b.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(i,B,C)?B.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),b.activeTexture.set(w.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&B){const q=(1<<B.tileID.canonical.z)*f.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=q}_&&_.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(b,C)}renderToBackBuffer(i){const h=this.painter,_=this.painter.context;0!==i.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),this.renderingToTexture=!1,function(b,w,C,S,P){if("globe"===b.transform.projection.name)!function(R,L,B,$,W){const q=R.context,V=q.gl;let re,J;const te=R.options.showTerrainWireframe?2:0,ie=(je,mt)=>{if(J===je)return;const Me=[ur[je],"PROJECTION_GLOBE_VIEW"];mt&&Me.push(ur[te]),re=R.useProgram("globeRaster",null,Me),J=je},le=R.colorModeForRenderPass(),ee=new f.DepthMode(V.LEQUAL,f.DepthMode.ReadWrite,R.depthRangeFor3D);Jr.update(W);const he=R.transform,Ae=f.calculateGlobeMercatorMatrix(he),ze=[f.mercatorXfromLng(he.center.lng),f.mercatorYfromLat(he.center.lat)],$e=R.globeSharedBuffers;if((te?[!1,!0]:[!1]).forEach(je=>{J=-1;const mt=je?V.LINES:V.TRIANGLES;for(const Me of $){const at=B.getTile(Me),ut=f.StencilMode.disabled,Lt=L.prevTerrainTileForTile[Me.key],Ne=L.terrainTileForTile[Me.key];Er(Lt,Ne)&&Jr.newMorphing(Me.key,Lt,Ne,W,250),q.activeTexture.set(V.TEXTURE0),at.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const jt=Jr.getMorphValuesForProxy(Me.key),Ht=jt?1:0,At={useDenormalizedUpVectorScale:!0};jt&&f.extend$1(At,{morphing:{srcDemTile:jt.from,dstDemTile:jt.to,phase:f.easeCubicInOut(jt.phase)}});const Ft=Float32Array.from(he.globeMatrix),tn=f.globeTileLatLngCorners(Me.canonical),_n=f.getGridMatrix(Me.canonical,tn),qt=li(he.projMatrix,Ft,Ae,f.globeToMercatorTransition(he.zoom),ze,_n);if(ie(Ht,je),L.setupElevationDraw(at,re,At),R.prepareDrawProgram(q,re,Me.toUnwrapped()),$e){const[pn,Vt,Qr]=je?$e.getWirefameBuffers(R.context):$e.getGridBuffers();re.draw(q,mt,ee,ut,le,f.CullFaceMode.backCCW,qt,"globe_raster",pn,Vt,Qr)}}}),$e){re=R.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const je of $){const{x:mt,y:Me,z:at}=je.canonical,ut=0===Me,Lt=Me===(1<<at)-1,[Ne,jt,Ht,At]=$e.getPoleBuffers(at);if(At&&(ut||Lt)){const Ft=B.getTile(je);q.activeTexture.set(V.TEXTURE0),Ft.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let tn=f.globePoleMatrixForTile(at,mt,he);const _n=(qt,pn)=>qt.draw(q,V.TRIANGLES,ee,f.StencilMode.disabled,le,f.CullFaceMode.disabled,li(he.projMatrix,tn,tn,0,ze),"globe_pole_raster",pn,Ht,At);L.setupElevationDraw(Ft,re,{}),R.prepareDrawProgram(q,re,je.toUnwrapped()),ut&&_n(re,Ne),Lt&&(tn=f.scale(f.create(),tn,[1,-1,1]),_n(re,jt))}}}}(b,w,C,S,P);else{const R=b.context,L=R.gl;let B,$;const W=b.options.showTerrainWireframe?2:0,q=(ie,le)=>{if($===ie)return;const ee=[ur[ie]];le&&ee.push(ur[W]),B=b.useProgram("terrainRaster",null,ee),$=ie},V=b.colorModeForRenderPass(),re=new f.DepthMode(L.LEQUAL,f.DepthMode.ReadWrite,b.depthRangeFor3D);Jr.update(P);const J=b.transform,te=6*Math.pow(1.5,22-J.zoom)*w.exaggeration();(W?[!1,!0]:[!1]).forEach(ie=>{$=-1;const le=ie?L.LINES:L.TRIANGLES,[ee,he]=ie?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const Ae of S){const ze=C.getTile(Ae),$e=f.StencilMode.disabled,je=w.prevTerrainTileForTile[Ae.key],mt=w.terrainTileForTile[Ae.key];Er(je,mt)&&Jr.newMorphing(Ae.key,je,mt,P,250),R.activeTexture.set(L.TEXTURE0),ze.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Me=Jr.getMorphValuesForProxy(Ae.key),at=Me?1:0;let ut;Me&&(ut={morphing:{srcDemTile:Me.from,dstDemTile:Me.to,phase:f.easeCubicInOut(Me.phase)}});const Lt=Fr(Ae.projMatrix,Is(Ae.canonical,J.renderWorldCopies)?te/10:te);q(at,ie),w.setupElevationDraw(ze,B,ut),b.prepareDrawProgram(R,B,Ae.toUnwrapped()),B.draw(R,le,re,$e,V,f.CullFaceMode.backCCW,Lt,"terrain_raster",w.gridBuffer,ee,he)}})}}(h,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,b=this.proxySourceCache,w=this.proxiedCoords[b.id],C=this._drapedRenderBatches.shift(),S=[],P=h.style.order;let R=0;for(const L of w){const B=b.getTileByID(L.proxyTileKey),$=b.proxyCachedFBO[L.key]?b.proxyCachedFBO[L.key][i]:void 0,W=void 0!==$?b.renderCache[$]:this.pool[R++],q=void 0!==$;if(B.texture=W.tex,q&&!W.dirty){S.push(B.tileID);continue}let V;_.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(_.clear({color:f.Color.transparent,stencil:0}),W.dirty=!1);for(let re=C.start;re<=C.end;++re){const J=h.style._layers[P[re]];if(J.isHidden(h.transform.zoom))continue;const te=h.style._getLayerSourceCache(J),ie=te?this.proxyToSource[L.key][te.id]:[L];if(!ie)continue;const le=ie;_.viewport.set([0,0,W.fb.width,W.fb.height]),V!==(te?te.id:null)&&(this._setupStencil(W,ie,J,te),V=te?te.id:null),h.renderLayer(h,te,J,le)}this.renderedToTile?(W.dirty=!0,S.push(B.tileID)):q||--R,5===R&&(R=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),C.end+1}postRender(){}renderCacheEfficiency(i){const h=i.order.length;if(0===h)return{efficiency:100};let _,b=0,w=0,C=!1;for(let S=0;S<h;++S){const P=i._layers[i.order[S]];this._style.isLayerDraped(P)?(C&&++b,++w):C||(C=!0,_=P.id)}return 0===w?{efficiency:100}:{efficiency:100*(1-b/w),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{i=Math.min(i,h.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,h,_){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const C=w.tileID,S=Math.pow(2,C.overscaledZ),{x:P,y:R}=C.canonical,L=P/S,B=(P+1)/S,$=R/S,W=(R+1)/S;return{minx:L,miny:$,maxx:B,maxy:W,t:w.dem.tree.raycastRoot(L,$,B,W,i,h,_),tile:w}});b.sort((w,C)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==C.t?C.t:Number.MAX_VALUE));for(const w of b){if(null==w.t)return null;const C=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,i,h,_);if(null!=C)return C}return null}_createFBO(){const i=this.painter.context,h=i.gl,_=this.drapeBufferSize;i.activeTexture.set(h.TEXTURE0);const b=new f.Texture(i,{width:_[0],height:_[1],data:null},h.RGBA);b.bind(h.LINEAR,h.CLAMP_TO_EDGE);const w=i.createFramebuffer(_[0],_[1],!1);return w.colorAttachment.set(b.texture),w.depthAttachment=new Uo(i,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:w,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const h=this._style._layers[i],_=h.isHidden(this.painter.transform.zoom),b=h.getCrossfadeParameters(),w=!!b&&1!==b.t,C=h.hasTransition();return"custom"!==h.type&&!_&&(w||C)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof j){i=!0;break}if(i)for(let h=0;h<this._style.order.length;++h){const _=this._style._layers[this._style.order[h]],b=_.isHidden(this.painter.transform.zoom),w=this._style._getLayerSourceCache(_);if("raster"!==_.type||b||!w)continue;const C=_.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const P=this.proxyToSource[S.key][w.id];if(P)for(const R of P){const L=In(w.getTile(R),w.findLoadedParent(R,0),w,this.painter.transform,C);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(w.id,R)}}}}_setupDrapedRenderBatches(){const i=this._style.order,h=i.length;if(0===h)return;const _=[];let b,w=0,C=this._style._layers[i[w]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++w<h;)C=this._style._layers[i[w]];for(;w<h;++w){const S=this._style._layers[i[w]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===b&&(b=w):void 0!==b&&(_.push({start:b,end:w-1}),b=void 0))}void 0!==b&&_.push({start:b,end:w-1}),this._drapedRenderBatches=_}_setupRenderCache(i){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const C=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let S=0;S<C.length;++S){const P=Object.values(C[S]);h.renderCachePool.push(...P)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,b=this._tilesDirty;for(let C=_.length-1;C>=0;C--){const S=_[C];if(h.getTileByID(S.key),void 0!==h.proxyCachedFBO[S.key]){const P=i[S.key],R=this.proxyToSource[S.key];let L=0;for(const B in R){const $=R[B],W=P[B];if(!W||W.length!==$.length||$.some((q,V)=>q!==W[V]||b[B]&&b[B].hasOwnProperty(q.key))){L=-1;break}++L}for(const B in h.proxyCachedFBO[S.key])h.renderCache[h.proxyCachedFBO[S.key][B]].dirty=L<0||L!==Object.values(P).length}}const w=[...this._drapedRenderBatches];w.sort((C,S)=>S.end-S.start-(C.end-C.start));for(const C of w)for(const S of _){if(h.proxyCachedFBO[S.key])continue;let P=h.renderCachePool.pop();void 0===P&&h.renderCache.length<50&&(P=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==P&&(h.proxyCachedFBO[S.key]={},h.proxyCachedFBO[S.key][C.start]=P,h.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(i,h,_,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,C=w.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let S;if(_.isTileClipped())S=h.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(i.key)||0),this._overlapStencilMode):f.StencilMode.disabled}_renderTileClippingMasks(i,h){const _=this.painter,b=this.painter.context,w=b.gl;_._tileClippingMaskIDs.clear(),b.setColorMode(f.ColorMode.disabled),b.setDepthMode(f.DepthMode.disabled);const C=_.useProgram("clippingMask");for(const S of i){const P=--h;_._tileClippingMaskIDs.set(S.key,P),C.draw(b,w.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:w.ALWAYS,mask:0},P,255,w.KEEP,w.KEEP,w.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,mo(S.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(i){const h=this.painter.transform;if(i.x<0||i.x>h.width||i.y<0||i.y>h.height)return null;const _=[i.x,i.y,1,1];f.transformMat4$1(_,_,h.pixelMatrixInverse),f.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const b=h._camera.position,w=f.mercatorZfromAltitude(1,h.center.lat),C=[b[0],b[1],b[2]/w,0],S=f.subtract([],_.slice(0,3),C);f.normalize(S,S);const P=this.raycast(C,S,this._exaggeration);return null!==P&&P?(f.scaleAndAdd(C,C,S,P),C[3]=C[2],C[2]*=w,C):null}drawDepth(){const i=this.painter,h=i.context,_=this.proxySourceCache,b=Math.ceil(i.width),w=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const C=h.gl,S=h.createFramebuffer(b,w,!0);h.activeTexture.set(C.TEXTURE0);const P=new f.Texture(h,{width:b,height:w,data:null},C.RGBA);P.bind(C.NEAREST,C.CLAMP_TO_EDGE),S.colorAttachment.set(P.texture);const R=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,b,w);S.depthAttachment.set(R),this._depthFBO=S,this._depthTexture=P}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,b,w]),function(C,S,P,R){if("globe"===C.transform.projection.name)return;const L=C.context,B=L.gl;L.clear({depth:1});const $=C.useProgram("terrainDepth"),W=new f.DepthMode(B.LESS,f.DepthMode.ReadWrite,C.depthRangeFor3D);for(const q of R){const V=P.getTile(q),re=Fr(q.projMatrix,0);S.setupElevationDraw(V,$),$.draw(L,B.TRIANGLES,W,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.backCCW,re,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(i,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,h,_){if(i.getSource()instanceof de)return this._setupProxiedCoordsForImageSource(i,h,_);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const b=this.proxiedCoords[i.id]=[],w=this.proxyCoords;for(let S=0;S<w.length;S++){const P=w[S],R=this._findTileCoveringTileID(P,i);if(R){const L=this._createProxiedId(P,R,_[P.key]&&_[P.key][i.id]);b.push(L),this.proxyToSource[P.key][i.id]=[L]}}let C=!1;for(let S=0;S<h.length;S++){const P=i.getTile(h[S]);if(!P||!P.hasData())continue;const R=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==P.tileID.canonical.z){const L=this.proxyToSource[R.tileID.key][i.id],B=this._createProxiedId(R.tileID,P,_[R.tileID.key]&&_[R.tileID.key][i.id]);L?L.splice(L.length-1,0,B):this.proxyToSource[R.tileID.key][i.id]=[B],b.push(B),C=!0}}this._sourceTilesOverlap[i.id]=C}_setupProxiedCoordsForImageSource(i,h,_){if(!i.getSource().loaded())return;const b=this.proxiedCoords[i.id]=[],w=this.proxyCoords,C=i.getSource(),S=new f.pointGeometry(C.tileID.x,C.tileID.y)._div(1<<C.tileID.z),P=C.coordinates.map(f.MercatorCoordinate.fromLngLat).reduce((L,B)=>(L.min.x=Math.min(L.min.x,B.x-S.x),L.min.y=Math.min(L.min.y,B.y-S.y),L.max.x=Math.max(L.max.x,B.x-S.x),L.max.y=Math.max(L.max.y,B.y-S.y),L),{min:new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new f.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(L,B)=>{const $=L.wrap+L.canonical.x/(1<<L.canonical.z),W=L.canonical.y/(1<<L.canonical.z),q=f.EXTENT/(1<<L.canonical.z),V=B.wrap+B.canonical.x/(1<<B.canonical.z),re=B.canonical.y/(1<<B.canonical.z);return $+q<V+P.min.x||$>V+P.max.x||W+q<re+P.min.y||W>re+P.max.y};for(let L=0;L<w.length;L++){const B=w[L];for(let $=0;$<h.length;$++){const W=i.getTile(h[$]);if(!W||!W.hasData()||R(B,W.tileID))continue;const q=this._createProxiedId(B,W,_[B.key]&&_[B.key][i.id]),V=this.proxyToSource[B.key][i.id];V?V.push(q):this.proxyToSource[B.key][i.id]=[q],b.push(q)}}}_createProxiedId(i,h,_){let b=this.orthoMatrix;if(_){const w=_.find(C=>C.key===h.tileID.key);if(w)return w}if(h.tileID.key!==i.key){const w=i.canonical.z-h.tileID.canonical.z;let C,S,P;b=f.create();const R=h.tileID.wrap-i.wrap<<i.overscaledZ;w>0?(C=f.EXTENT>>w,S=C*((h.tileID.canonical.x<<w)-i.canonical.x+R),P=C*((h.tileID.canonical.y<<w)-i.canonical.y)):(C=f.EXTENT<<-w,S=f.EXTENT*(h.tileID.canonical.x-(i.canonical.x+R<<-w)),P=f.EXTENT*(h.tileID.canonical.y-(i.canonical.y<<-w))),f.ortho(b,0,C,0,C,0,1),f.translate(b,b,[S,P,0])}return new ma(h.tileID,i.key,b)}_findTileCoveringTileID(i,h){let _=h.getTile(i);if(_&&_.hasData())return _;const b=this._findCoveringTileCache[h.id],w=b[i.key];if(_=w?h.getTileByID(w):null,_&&_.hasData()||null===w)return _;let C=_?_.tileID:i,S=C.overscaledZ;const P=h.getSource().minzoom,R=[];if(!w){const B=h.getSource().maxzoom;if(i.canonical.z>=B){const $=i.canonical.z-B;h.getSource().reparseOverscaled?(S=Math.max(i.canonical.z+2,h.transform.tileZoom),C=new f.OverscaledTileID(S,i.wrap,B,i.canonical.x>>$,i.canonical.y>>$)):0!==$&&(S=B,C=new f.OverscaledTileID(S,i.wrap,B,i.canonical.x>>$,i.canonical.y>>$))}C.key!==i.key&&(R.push(C.key),_=h.getTile(C))}const L=B=>{R.forEach($=>{b[$]=B}),R.length=0};for(S-=1;S>=P&&(!_||!_.hasData());S--){_&&L(_.tileID.key);const B=C.calculateScaledKey(S);if(_=h.getTileByID(B),_&&_.hasData())break;const $=b[B];if(null===$)break;void 0===$?R.push(B):_=h.getTileByID($)}return L(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,h){let _=this._tilesDirty[i];_||(_=this._tilesDirty[i]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(h){let _=0;const b=new f.StructArrayLayout2ui4,w=131;for(let C=1;C<129;C++){for(let S=1;S<129;S++)_=C*w+S,b.emplaceBack(_,_+1),b.emplaceBack(_,_+w),b.emplaceBack(_+1,_+w),128===C&&b.emplaceBack(_+w,_+w+1);b.emplaceBack(_+1,_+1+w)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=f.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function ga(p){const i=[];for(let h=0;h<p.length;h++){if(null===p[h])continue;const _=p[h].split(" ");i.push(_.pop())}return i}class As{static cacheKey(i,h,_){let b=`${i}${_?_.cacheKey:""}`;for(const w of h)b+=`/${w}`;return b}constructor(i,h,_,b,w,C){const S=i.gl;this.program=S.createProgram();const P=ga(_.staticAttributes),R=b?b.getBinderAttributes():[],L=P.concat(R),B=_.staticUniforms?ga(_.staticUniforms):[],$=b?b.getBinderUniforms():[],W=B.concat($),q=[];for(const ee of W)q.indexOf(ee)<0&&q.push(ee);let V=b?b.defines():[];V=V.concat(C.map(ee=>`#define ${ee}`));const re=V.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ar,$t.fragmentSource,Qe.fragmentSource,_.fragmentSource).join("\n"),J=V.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ar,$t.vertexSource,Qe.vertexSource,Ce.vertexSource,_.vertexSource).join("\n"),te=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(te,re),S.compileShader(te),S.attachShader(this.program,te);const ie=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ie,J),S.compileShader(ie),S.attachShader(this.program,ie),this.attributes={};const le={};this.numAttributes=L.length;for(let ee=0;ee<this.numAttributes;ee++)L[ee]&&(S.bindAttribLocation(this.program,ee,L[ee]),this.attributes[L[ee]]=ee);S.linkProgram(this.program),S.deleteShader(ie),S.deleteShader(te);for(let ee=0;ee<q.length;ee++){const he=q[ee];if(he&&!le[he]){const Ae=S.getUniformLocation(this.program,he);Ae&&(le[he]=Ae)}}var ee,he;this.fixedUniforms=w(i,le),this.binderUniforms=b?b.getUniforms(i,le):[],-1!==C.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new f.Uniform1i(ee=i,(he=le).u_dem),u_dem_prev:new f.Uniform1i(ee,he.u_dem_prev),u_dem_unpack:new f.Uniform4f(ee,he.u_dem_unpack),u_dem_tl:new f.Uniform2f(ee,he.u_dem_tl),u_dem_scale:new f.Uniform1f(ee,he.u_dem_scale),u_dem_tl_prev:new f.Uniform2f(ee,he.u_dem_tl_prev),u_dem_scale_prev:new f.Uniform1f(ee,he.u_dem_scale_prev),u_dem_size:new f.Uniform1f(ee,he.u_dem_size),u_dem_lerp:new f.Uniform1f(ee,he.u_dem_lerp),u_exaggeration:new f.Uniform1f(ee,he.u_exaggeration),u_depth:new f.Uniform1i(ee,he.u_depth),u_depth_size_inv:new f.Uniform2f(ee,he.u_depth_size_inv),u_meter_to_dem:new f.Uniform1f(ee,he.u_meter_to_dem),u_label_plane_matrix_inv:new f.UniformMatrix4f(ee,he.u_label_plane_matrix_inv),u_tile_tl_up:new f.Uniform3f(ee,he.u_tile_tl_up),u_tile_tr_up:new f.Uniform3f(ee,he.u_tile_tr_up),u_tile_br_up:new f.Uniform3f(ee,he.u_tile_br_up),u_tile_bl_up:new f.Uniform3f(ee,he.u_tile_bl_up),u_tile_up_scale:new f.Uniform1f(ee,he.u_tile_up_scale)}),-1!==C.indexOf("FOG")&&(this.fogUniforms=((ee,he)=>({u_fog_matrix:new f.UniformMatrix4f(ee,he.u_fog_matrix),u_fog_range:new f.Uniform2f(ee,he.u_fog_range),u_fog_color:new f.Uniform4f(ee,he.u_fog_color),u_fog_horizon_blend:new f.Uniform1f(ee,he.u_fog_horizon_blend),u_fog_temporal_offset:new f.Uniform1f(ee,he.u_fog_temporal_offset)}))(i,le))}setTerrainUniformValues(i,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const b in h)_[b].set(h[b])}}setFogUniformValues(i,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const b in h)_[b].location&&_[b].set(h[b])}}draw(i,h,_,b,w,C,S,P,R,L,B,$,W,q,V,re){const J=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(_),i.setStencilMode(b),i.setColorMode(w),i.setCullFace(C);for(const ie of Object.keys(this.fixedUniforms))this.fixedUniforms[ie].set(S[ie]);q&&q.setUniforms(i,this.binderUniforms,$,{zoom:W});const te={[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[h];for(const ie of B.get()){const le=ie.vaos||(ie.vaos={});(le[P]||(le[P]=new Jn)).bind(i,this,R,q?q.getPaintVertexBuffers():[],L,ie.vertexOffset,V,re),J.drawElements(h,ie.primitiveLength*te,J.UNSIGNED_SHORT,ie.primitiveOffset*te*2)}}}function ro(p,i,h){const _=1/Vn(h,1,i.transform.tileZoom),b=Math.pow(2,h.tileID.overscaledZ),w=h.tileSize*Math.pow(2,i.transform.tileZoom)/b,C=w*(h.tileID.canonical.x+h.tileID.wrap*b),S=w*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[C>>16,S>>16],u_pixel_coord_lower:[65535&C,65535&S]}}const Pr=f.create(),Zc=(p,i,h,_,b,w,C,S,P)=>{const R=i.style.light,L=R.properties.get("position"),B=[L.x,L.y,L.z],$=f.create$1();"viewport"===R.properties.get("anchor")&&(f.fromRotation($,-i.transform.angle),f.transformMat3(B,B,$));const W=R.properties.get("color"),q=i.transform,V={u_matrix:p,u_lightpos:B,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Pr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===q.projection.name&&(V.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],V.u_zoom_transition=C,V.u_inv_rot_matrix=P,V.u_merc_center=S,V.u_up_dir=q.projection.upVector(new f.CanonicalTileID(0,0,0),S[0]*f.EXTENT,S[1]*f.EXTENT),V.u_height_lift=w),V},Wc=(p,i,h,_,b,w,C,S,P,R,L)=>{const B=Zc(p,i,h,_,b,S,P,R,L),$={u_height_factor:-Math.pow(2,b.overscaledZ)/C.tileSize/8};return f.extend(B,ro(w,i,C),$)},Mo=p=>({u_matrix:p}),go=(p,i,h,_)=>f.extend(Mo(p),ro(h,i,_)),bl=(p,i)=>({u_matrix:p,u_world:i}),Ql=(p,i,h,_,b)=>f.extend(go(p,i,h,_),{u_world:b}),ec=f.create(),qi=(p,i,h,_,b,w)=>{const C=p.transform,S="globe"===C.projection.name;let P;if("map"===w.paint.get("circle-pitch-alignment"))if(S){const L=f.globePixelsToTileUnits(C.zoom,i.canonical);P=Float32Array.from([L,0,0,L])}else P=C.calculatePixelsToTileUnitsMatrix(h);else P=new Float32Array([C.pixelsToGLUnits[0],0,0,C.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:C.cameraToCenterDistance,u_matrix:p.translatePosMatrix(i.projMatrix,h,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:f.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:ec,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return S&&(R.u_inv_rot_matrix=_,R.u_merc_center=b,R.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],R.u_zoom_transition=f.globeToMercatorTransition(C.zoom),R.u_up_dir=C.projection.upVector(i.canonical,b[0],b[1])),R},Rf=p=>{const i=[];return"map"===p.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},Pm=(p,i,h)=>{const _=f.EXTENT/h.tileSize;return{u_matrix:p,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/_,i.pixelsToGLUnits[1]/_]}},id=(p,i,h=1)=>({u_matrix:p,u_color:i,u_overlay:0,u_overlay_scale:h}),Of=f.create(),km=(p,i,h,_,b,w,C)=>{const S=p.transform,P="globe"===S.projection.name,R=P?f.globePixelsToTileUnits(S.zoom,i.canonical):Vn(h,1,w),L={u_matrix:i.projMatrix,u_extrude_scale:R,u_intensity:C,u_inv_rot_matrix:Of,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return P&&(L.u_inv_rot_matrix=_,L.u_merc_center=b,L.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],L.u_zoom_transition=f.globeToMercatorTransition(S.zoom),L.u_up_dir=S.projection.upVector(i.canonical,b[0],b[1])),L},Rm=(p,i,h,_,b,w,C)=>{const S=p.transform,P=S.calculatePixelsToTileUnitsMatrix(i),R={u_matrix:wl(p,i,h,b),u_pixels_to_tile_units:P,u_device_pixel_ratio:C,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(sd(h)){const L=qu(i,p.transform);R.u_texsize=i.lineAtlasTexture.size,R.u_scale=[L,_.fromScale,_.toScale],R.u_mix=_.t}return R},od=(p,i,h,_,b,w)=>{const C=p.transform,S=qu(i,C);return{u_matrix:wl(p,i,h,b),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:w,u_image:0,u_scale:[S,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function qu(p,i){return 1/Vn(p,1,i.tileZoom)}function wl(p,i,h,_){return p.translatePosMatrix(_||i.tileID.projMatrix,i,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function sd(p){const i=p.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const Lf=(p,i,h,_,b,w)=>{return{u_matrix:p,u_tl_parent:i,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(S=b.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(C=b.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:ad(b.paint.get("raster-hue-rotate")),u_perspective_transform:w};var C,S};function ad(p){p*=Math.PI/180;const i=Math.sin(p),h=Math.cos(p);return[(2*h+1)/3,(-Math.sqrt(3)*i-h+1)/3,(Math.sqrt(3)*i-h+1)/3]}const Ba=f.create(),ld=(p,i,h,_,b,w,C,S,P,R,L,B,$,W)=>{const q=b.transform,V={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:q.width/q.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:C,u_coord_matrix:S,u_is_text:+P,u_pitch_with_map:+_,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ba,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ba};return"globe"===q.projection.name&&(V.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],V.u_zoom_transition=B,V.u_inv_rot_matrix=W,V.u_merc_center=$,V.u_camera_forward=q._camera.forward(),V.u_ecef_origin=f.globeECEFOrigin(q.globeMatrix,L.toUnwrapped()),V.u_tile_matrix=Float32Array.from(q.globeMatrix)),V},El=(p,i,h,_,b,w,C,S,P,R,L,B,$,W,q)=>{const{cameraToCenterDistance:V,_pitch:re}=b.transform;return f.extend(ld(p,i,h,_,b,w,C,S,P,R,B,$,W,q),{u_gamma_scale:_?V*Math.cos(b.terrain?0:re):1,u_device_pixel_ratio:f.exported.devicePixelRatio,u_is_halo:+L})},tc=(p,i,h,_,b,w,C,S,P,R,L,B,$,W)=>f.extend(El(p,i,h,_,b,w,C,S,!0,P,!0,L,B,$,W),{u_texsize_icon:R,u_texture_icon:1}),Ff=(p,i,h)=>({u_matrix:p,u_opacity:i,u_color:h}),cd=(p,i,h,_,b,w)=>f.extend(function(C,S,P,R){const L=P.imageManager.getPattern(C.from.toString()),B=P.imageManager.getPattern(C.to.toString()),{width:$,height:W}=P.imageManager.getPixelSize(),q=Math.pow(2,R.tileID.overscaledZ),V=R.tileSize*Math.pow(2,P.transform.tileZoom)/q,re=V*(R.tileID.canonical.x+R.tileID.wrap*q),J=V*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[$,W],u_mix:S.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Vn(R,1,P.transform.tileZoom),u_pixel_coord_upper:[re>>16,J>>16],u_pixel_coord_lower:[65535&re,65535&J]}}(_,w,h,b),{u_matrix:p,u_opacity:i}),lr={fillExtrusion:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_lightpos:new f.Uniform3f(p,i.u_lightpos),u_lightintensity:new f.Uniform1f(p,i.u_lightintensity),u_lightcolor:new f.Uniform3f(p,i.u_lightcolor),u_vertical_gradient:new f.Uniform1f(p,i.u_vertical_gradient),u_opacity:new f.Uniform1f(p,i.u_opacity),u_tile_id:new f.Uniform3f(p,i.u_tile_id),u_zoom_transition:new f.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,i.u_merc_center),u_up_dir:new f.Uniform3f(p,i.u_up_dir),u_height_lift:new f.Uniform1f(p,i.u_height_lift)}),fillExtrusionPattern:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_lightpos:new f.Uniform3f(p,i.u_lightpos),u_lightintensity:new f.Uniform1f(p,i.u_lightintensity),u_lightcolor:new f.Uniform3f(p,i.u_lightcolor),u_vertical_gradient:new f.Uniform1f(p,i.u_vertical_gradient),u_height_factor:new f.Uniform1f(p,i.u_height_factor),u_tile_id:new f.Uniform3f(p,i.u_tile_id),u_zoom_transition:new f.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,i.u_merc_center),u_up_dir:new f.Uniform3f(p,i.u_up_dir),u_height_lift:new f.Uniform1f(p,i.u_height_lift),u_image:new f.Uniform1i(p,i.u_image),u_texsize:new f.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new f.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new f.Uniform3f(p,i.u_scale),u_fade:new f.Uniform1f(p,i.u_fade),u_opacity:new f.Uniform1f(p,i.u_opacity)}),fill:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix)}),fillPattern:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_image:new f.Uniform1i(p,i.u_image),u_texsize:new f.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new f.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new f.Uniform3f(p,i.u_scale),u_fade:new f.Uniform1f(p,i.u_fade)}),fillOutline:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_world:new f.Uniform2f(p,i.u_world)}),fillOutlinePattern:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_world:new f.Uniform2f(p,i.u_world),u_image:new f.Uniform1i(p,i.u_image),u_texsize:new f.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new f.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new f.Uniform3f(p,i.u_scale),u_fade:new f.Uniform1f(p,i.u_fade)}),circle:(p,i)=>({u_camera_to_center_distance:new f.Uniform1f(p,i.u_camera_to_center_distance),u_extrude_scale:new f.UniformMatrix2f(p,i.u_extrude_scale),u_device_pixel_ratio:new f.Uniform1f(p,i.u_device_pixel_ratio),u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_inv_rot_matrix:new f.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,i.u_merc_center),u_tile_id:new f.Uniform3f(p,i.u_tile_id),u_zoom_transition:new f.Uniform1f(p,i.u_zoom_transition),u_up_dir:new f.Uniform3f(p,i.u_up_dir)}),collisionBox:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_camera_to_center_distance:new f.Uniform1f(p,i.u_camera_to_center_distance),u_extrude_scale:new f.Uniform2f(p,i.u_extrude_scale)}),collisionCircle:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_inv_matrix:new f.UniformMatrix4f(p,i.u_inv_matrix),u_camera_to_center_distance:new f.Uniform1f(p,i.u_camera_to_center_distance),u_viewport_size:new f.Uniform2f(p,i.u_viewport_size)}),debug:(p,i)=>({u_color:new f.UniformColor(p,i.u_color),u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_overlay:new f.Uniform1i(p,i.u_overlay),u_overlay_scale:new f.Uniform1f(p,i.u_overlay_scale)}),clippingMask:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix)}),heatmap:(p,i)=>({u_extrude_scale:new f.Uniform1f(p,i.u_extrude_scale),u_intensity:new f.Uniform1f(p,i.u_intensity),u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_inv_rot_matrix:new f.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,i.u_merc_center),u_tile_id:new f.Uniform3f(p,i.u_tile_id),u_zoom_transition:new f.Uniform1f(p,i.u_zoom_transition),u_up_dir:new f.Uniform3f(p,i.u_up_dir)}),heatmapTexture:(p,i)=>({u_image:new f.Uniform1i(p,i.u_image),u_color_ramp:new f.Uniform1i(p,i.u_color_ramp),u_opacity:new f.Uniform1f(p,i.u_opacity)}),hillshade:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_image:new f.Uniform1i(p,i.u_image),u_latrange:new f.Uniform2f(p,i.u_latrange),u_light:new f.Uniform2f(p,i.u_light),u_shadow:new f.UniformColor(p,i.u_shadow),u_highlight:new f.UniformColor(p,i.u_highlight),u_accent:new f.UniformColor(p,i.u_accent)}),hillshadePrepare:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_image:new f.Uniform1i(p,i.u_image),u_dimension:new f.Uniform2f(p,i.u_dimension),u_zoom:new f.Uniform1f(p,i.u_zoom),u_unpack:new f.Uniform4f(p,i.u_unpack)}),line:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_pixels_to_tile_units:new f.UniformMatrix2f(p,i.u_pixels_to_tile_units),u_device_pixel_ratio:new f.Uniform1f(p,i.u_device_pixel_ratio),u_units_to_pixels:new f.Uniform2f(p,i.u_units_to_pixels),u_dash_image:new f.Uniform1i(p,i.u_dash_image),u_gradient_image:new f.Uniform1i(p,i.u_gradient_image),u_image_height:new f.Uniform1f(p,i.u_image_height),u_texsize:new f.Uniform2f(p,i.u_texsize),u_scale:new f.Uniform3f(p,i.u_scale),u_mix:new f.Uniform1f(p,i.u_mix),u_alpha_discard_threshold:new f.Uniform1f(p,i.u_alpha_discard_threshold)}),linePattern:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_texsize:new f.Uniform2f(p,i.u_texsize),u_pixels_to_tile_units:new f.UniformMatrix2f(p,i.u_pixels_to_tile_units),u_device_pixel_ratio:new f.Uniform1f(p,i.u_device_pixel_ratio),u_image:new f.Uniform1i(p,i.u_image),u_units_to_pixels:new f.Uniform2f(p,i.u_units_to_pixels),u_scale:new f.Uniform3f(p,i.u_scale),u_fade:new f.Uniform1f(p,i.u_fade),u_alpha_discard_threshold:new f.Uniform1f(p,i.u_alpha_discard_threshold)}),raster:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_tl_parent:new f.Uniform2f(p,i.u_tl_parent),u_scale_parent:new f.Uniform1f(p,i.u_scale_parent),u_fade_t:new f.Uniform1f(p,i.u_fade_t),u_opacity:new f.Uniform1f(p,i.u_opacity),u_image0:new f.Uniform1i(p,i.u_image0),u_image1:new f.Uniform1i(p,i.u_image1),u_brightness_low:new f.Uniform1f(p,i.u_brightness_low),u_brightness_high:new f.Uniform1f(p,i.u_brightness_high),u_saturation_factor:new f.Uniform1f(p,i.u_saturation_factor),u_contrast_factor:new f.Uniform1f(p,i.u_contrast_factor),u_spin_weights:new f.Uniform3f(p,i.u_spin_weights),u_perspective_transform:new f.Uniform2f(p,i.u_perspective_transform)}),symbolIcon:(p,i)=>({u_is_size_zoom_constant:new f.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new f.Uniform1f(p,i.u_size_t),u_size:new f.Uniform1f(p,i.u_size),u_camera_to_center_distance:new f.Uniform1f(p,i.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new f.Uniform1f(p,i.u_fade_change),u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new f.Uniform1i(p,i.u_is_text),u_pitch_with_map:new f.Uniform1i(p,i.u_pitch_with_map),u_texsize:new f.Uniform2f(p,i.u_texsize),u_tile_id:new f.Uniform3f(p,i.u_tile_id),u_zoom_transition:new f.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,i.u_merc_center),u_camera_forward:new f.Uniform3f(p,i.u_camera_forward),u_tile_matrix:new f.UniformMatrix4f(p,i.u_tile_matrix),u_ecef_origin:new f.Uniform3f(p,i.u_ecef_origin),u_texture:new f.Uniform1i(p,i.u_texture)}),symbolSDF:(p,i)=>({u_is_size_zoom_constant:new f.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new f.Uniform1f(p,i.u_size_t),u_size:new f.Uniform1f(p,i.u_size),u_camera_to_center_distance:new f.Uniform1f(p,i.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new f.Uniform1f(p,i.u_fade_change),u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new f.Uniform1i(p,i.u_is_text),u_pitch_with_map:new f.Uniform1i(p,i.u_pitch_with_map),u_texsize:new f.Uniform2f(p,i.u_texsize),u_texture:new f.Uniform1i(p,i.u_texture),u_gamma_scale:new f.Uniform1f(p,i.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(p,i.u_device_pixel_ratio),u_tile_id:new f.Uniform3f(p,i.u_tile_id),u_zoom_transition:new f.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new f.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new f.Uniform2f(p,i.u_merc_center),u_camera_forward:new f.Uniform3f(p,i.u_camera_forward),u_tile_matrix:new f.UniformMatrix4f(p,i.u_tile_matrix),u_ecef_origin:new f.Uniform3f(p,i.u_ecef_origin),u_is_halo:new f.Uniform1i(p,i.u_is_halo)}),symbolTextAndIcon:(p,i)=>({u_is_size_zoom_constant:new f.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new f.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new f.Uniform1f(p,i.u_size_t),u_size:new f.Uniform1f(p,i.u_size),u_camera_to_center_distance:new f.Uniform1f(p,i.u_camera_to_center_distance),u_rotate_symbol:new f.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new f.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new f.Uniform1f(p,i.u_fade_change),u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new f.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new f.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new f.Uniform1i(p,i.u_is_text),u_pitch_with_map:new f.Uniform1i(p,i.u_pitch_with_map),u_texsize:new f.Uniform2f(p,i.u_texsize),u_texsize_icon:new f.Uniform2f(p,i.u_texsize_icon),u_texture:new f.Uniform1i(p,i.u_texture),u_texture_icon:new f.Uniform1i(p,i.u_texture_icon),u_gamma_scale:new f.Uniform1f(p,i.u_gamma_scale),u_device_pixel_ratio:new f.Uniform1f(p,i.u_device_pixel_ratio),u_is_halo:new f.Uniform1i(p,i.u_is_halo)}),background:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_opacity:new f.Uniform1f(p,i.u_opacity),u_color:new f.UniformColor(p,i.u_color)}),backgroundPattern:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_opacity:new f.Uniform1f(p,i.u_opacity),u_image:new f.Uniform1i(p,i.u_image),u_pattern_tl_a:new f.Uniform2f(p,i.u_pattern_tl_a),u_pattern_br_a:new f.Uniform2f(p,i.u_pattern_br_a),u_pattern_tl_b:new f.Uniform2f(p,i.u_pattern_tl_b),u_pattern_br_b:new f.Uniform2f(p,i.u_pattern_br_b),u_texsize:new f.Uniform2f(p,i.u_texsize),u_mix:new f.Uniform1f(p,i.u_mix),u_pattern_size_a:new f.Uniform2f(p,i.u_pattern_size_a),u_pattern_size_b:new f.Uniform2f(p,i.u_pattern_size_b),u_scale_a:new f.Uniform1f(p,i.u_scale_a),u_scale_b:new f.Uniform1f(p,i.u_scale_b),u_pixel_coord_upper:new f.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new f.Uniform2f(p,i.u_pixel_coord_lower),u_tile_units_to_pixels:new f.Uniform1f(p,i.u_tile_units_to_pixels)}),terrainRaster:Bn,terrainDepth:Bn,skybox:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_sun_direction:new f.Uniform3f(p,i.u_sun_direction),u_cubemap:new f.Uniform1i(p,i.u_cubemap),u_opacity:new f.Uniform1f(p,i.u_opacity),u_temporal_offset:new f.Uniform1f(p,i.u_temporal_offset)}),skyboxGradient:(p,i)=>({u_matrix:new f.UniformMatrix4f(p,i.u_matrix),u_color_ramp:new f.Uniform1i(p,i.u_color_ramp),u_center_direction:new f.Uniform3f(p,i.u_center_direction),u_radius:new f.Uniform1f(p,i.u_radius),u_opacity:new f.Uniform1f(p,i.u_opacity),u_temporal_offset:new f.Uniform1f(p,i.u_temporal_offset)}),skyboxCapture:(p,i)=>({u_matrix_3f:new f.UniformMatrix3f(p,i.u_matrix_3f),u_sun_direction:new f.Uniform3f(p,i.u_sun_direction),u_sun_intensity:new f.Uniform1f(p,i.u_sun_intensity),u_color_tint_r:new f.Uniform4f(p,i.u_color_tint_r),u_color_tint_m:new f.Uniform4f(p,i.u_color_tint_m),u_luminance:new f.Uniform1f(p,i.u_luminance)}),globeRaster:(p,i)=>({u_proj_matrix:new f.UniformMatrix4f(p,i.u_proj_matrix),u_globe_matrix:new f.UniformMatrix4f(p,i.u_globe_matrix),u_merc_matrix:new f.UniformMatrix4f(p,i.u_merc_matrix),u_zoom_transition:new f.Uniform1f(p,i.u_zoom_transition),u_merc_center:new f.Uniform2f(p,i.u_merc_center),u_image0:new f.Uniform1i(p,i.u_image0),u_grid_matrix:new f.UniformMatrix3f(p,i.u_grid_matrix)}),globeAtmosphere:(p,i)=>({u_frustum_tl:new f.Uniform3f(p,i.u_frustum_tl),u_frustum_tr:new f.Uniform3f(p,i.u_frustum_tr),u_frustum_br:new f.Uniform3f(p,i.u_frustum_br),u_frustum_bl:new f.Uniform3f(p,i.u_frustum_bl),u_globe_pos:new f.Uniform3f(p,i.u_globe_pos),u_globe_radius:new f.Uniform1f(p,i.u_globe_radius),u_opacity:new f.Uniform1f(p,i.u_opacity),u_fadeout_range:new f.Uniform1f(p,i.u_fadeout_range),u_start_color:new f.Uniform3f(p,i.u_start_color),u_end_color:new f.Uniform3f(p,i.u_end_color)})};let qs;function zf(p,i,h,_,b,w,C){const S=p.context,P=S.gl,R=p.useProgram("collisionBox"),L=[];let B=0,$=0;for(let ie=0;ie<_.length;ie++){const le=_[ie],ee=i.getTile(le),he=ee.getBucket(h);if(!he)continue;let Ae=le.projMatrix;0===b[0]&&0===b[1]||(Ae=p.translatePosMatrix(le.projMatrix,ee,b,w));const ze=C?he.textCollisionBox:he.iconCollisionBox,$e=he.collisionCircleArray;if($e.length>0){const je=f.create(),mt=Ae;f.mul(je,he.placementInvProjMatrix,p.transform.glCoordMatrix),f.mul(je,je,he.placementViewportMatrix),L.push({circleArray:$e,circleOffset:$,transform:mt,invTransform:je}),B+=$e.length/4,$=B}ze&&(p.terrain&&p.terrain.setupElevationDraw(ee,R),R.draw(S,P.LINES,f.DepthMode.disabled,f.StencilMode.disabled,p.colorModeForRenderPass(),f.CullFaceMode.disabled,Pm(Ae,p.transform,ee),h.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,null,p.transform.zoom,null,ze.collisionVertexBuffer,ze.collisionVertexBufferExt))}if(!C||!L.length)return;const W=p.useProgram("collisionCircle"),q=new f.StructArrayLayout2f1f2i16;q.resize(4*B),q._trim();let V=0;for(const ie of L)for(let le=0;le<ie.circleArray.length/4;le++){const ee=4*le,he=ie.circleArray[ee+0],Ae=ie.circleArray[ee+1],ze=ie.circleArray[ee+2],$e=ie.circleArray[ee+3];q.emplace(V++,he,Ae,ze,$e,0),q.emplace(V++,he,Ae,ze,$e,1),q.emplace(V++,he,Ae,ze,$e,2),q.emplace(V++,he,Ae,ze,$e,3)}(!qs||qs.length<2*B)&&(qs=function(ie){const le=2*ie,ee=new f.StructArrayLayout3ui6;ee.resize(le),ee._trim();for(let he=0;he<le;he++){const Ae=6*he;ee.uint16[Ae+0]=4*he+0,ee.uint16[Ae+1]=4*he+1,ee.uint16[Ae+2]=4*he+2,ee.uint16[Ae+3]=4*he+2,ee.uint16[Ae+4]=4*he+3,ee.uint16[Ae+5]=4*he+0}return ee}(B));const re=S.createIndexBuffer(qs,!0),J=S.createVertexBuffer(q,f.collisionCircleLayout.members,!0);for(const ie of L){const le={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(te=p.transform).cameraToCenterDistance,u_viewport_size:[te.width,te.height]};W.draw(S,P.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,p.colorModeForRenderPass(),f.CullFaceMode.disabled,le,h.id,J,re,f.SegmentVector.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,p.transform.zoom,null,null,null)}var te;J.destroy(),re.destroy()}const ud=f.create();function Xc(p,i,h,_,b,w){const{horizontalAlign:C,verticalAlign:S}=f.getAnchorAlignment(p),P=-(C-.5)*i,R=-(S-.5)*h,L=f.evaluateVariableOffset(p,_);return new f.pointGeometry((P/b+L[0])*w,(R/b+L[1])*w)}function Ua(p,i,h,_,b,w,C,S,P,R,L,B){const $=p.text.placedSymbolArray,W=p.text.dynamicLayoutVertexArray,q=p.icon.dynamicLayoutVertexArray,V={},re=S.projMatrix,J=w.elevation,te=B.upVectorScale(S.canonical,w.center.lat,w.worldSize);W.clear();for(let ie=0;ie<$.length;ie++){const le=$.get(ie),ee=p.allowVerticalPlacement&&!le.placedOrientation,he=le.hidden||!le.crossTileID||ee?null:_[le.crossTileID];if(he){const Ae=new f.pointGeometry(le.tileAnchorX,le.tileAnchorY),ze=B.upVector(S.canonical,Ae.x,Ae.y),$e=J?J.getAtTileOffset(S,Ae.x,Ae.y):0,je=ai([le.projectedAnchorX+$e*ze[0]*te.metersToTile,le.projectedAnchorY+$e*ze[1]*te.metersToTile,le.projectedAnchorZ+$e*ze[2]*te.metersToTile],h?re:C),mt=wr(w.cameraToCenterDistance,je.signedDistanceFromCamera);let Me=b.evaluateSizeForFeature(p.textSizeData,R,le)*mt/f.ONE_EM;h&&(Me*=p.tilePixelRatio/P);const{width:at,height:ut,anchor:Lt,textOffset:Ne,textScale:jt}=he,Ht=Xc(Lt,at,ut,Ne,jt,Me),At=h?br(Ae.add(Ht),C,$e*te.metersToLabelSpace).point:je.point.add(i?Ht.rotate(-w.angle):Ht),Ft=p.allowVerticalPlacement&&le.placedOrientation===f.WritingMode.vertical?Math.PI/2:0;for(let tn=0;tn<le.numGlyphs;tn++)f.addDynamicAttributes(W,At,Ft);L&&le.associatedIconIndex>=0&&(V[le.associatedIconIndex]={shiftedAnchor:At,angle:Ft})}else Gr(le.numGlyphs,W)}if(L){q.clear();const ie=p.icon.placedSymbolArray;for(let le=0;le<ie.length;le++){const ee=ie.get(le);if(ee.hidden)Gr(ee.numGlyphs,q);else{const he=V[le];if(he)for(let Ae=0;Ae<ee.numGlyphs;Ae++)f.addDynamicAttributes(q,he.shiftedAnchor,he.angle);else Gr(ee.numGlyphs,q)}}p.icon.dynamicLayoutVertexBuffer.updateData(q)}p.text.dynamicLayoutVertexBuffer.updateData(W)}function Nf(p,i,h){return h.iconsInText&&i?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Ps(p,i,h,_,b,w,C,S,P,R,L,B){const $=p.context,W=$.gl,q=p.transform,V="map"===S,re="map"===P,J=V&&"point"!==h.layout.get("symbol-placement"),te=V&&!re&&!J,ie=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let le=!1;const ee=p.depthModeForSublayer(0,f.DepthMode.ReadOnly),he=[f.mercatorXfromLng(q.center.lng),f.mercatorYfromLat(q.center.lat)],Ae=h.layout.get("text-variable-anchor"),ze="globe"===q.projection.name,$e=ze?f.globeToMercatorTransition(q.zoom):0,je=[],mt=[];p.terrain&&re&&mt.push("PITCH_WITH_MAP_TERRAIN"),ze&&mt.push("PROJECTION_GLOBE_VIEW");for(const Me of _){const at=i.getTile(Me),ut=at.getBucket(h);if(!ut||ut.projection!==q.projection.name)continue;const Lt=b?ut.text:ut.icon;if(!Lt||ut.fullyClipped||!Lt.segments.get().length)continue;const Ne=Lt.programConfigurations.get(h.id),jt=b||ut.sdfIcons,Ht=b?ut.textSizeData:ut.iconSizeData,At=re||0!==q.pitch,Ft=f.evaluateSizeForZoom(Ht,q.zoom);let tn,_n,qt,pn,Vt=[0,0],Qr=null;if(b){if(_n=at.glyphAtlasTexture,qt=W.LINEAR,tn=at.glyphAtlasTexture.size,ut.iconsInText){Vt=at.imageAtlasTexture.size,Qr=at.imageAtlasTexture;const vo="composite"===Ht.kind||"camera"===Ht.kind;pn=At||p.options.rotating||p.options.zooming||vo?W.LINEAR:W.NEAREST}}else{const vo=1!==h.layout.get("icon-size").constantOr(0)||ut.iconsNeedLinear;_n=at.imageAtlasTexture,qt=jt||p.options.rotating||p.options.zooming||vo||At?W.LINEAR:W.NEAREST,tn=at.imageAtlasTexture.size}const so=p.transform.calculatePixelsToTileUnitsMatrix(at),ao=hn(Me.projMatrix,at.tileID.canonical,re,V,p.transform,so),qo=p.terrain&&re&&J?f.invert(f.create(),ao):ud,Rs=is(Me.projMatrix,at.tileID.canonical,re,V,p.transform,so),xa=Ae&&ut.hasTextData(),el="none"!==h.layout.get("icon-text-fit")&&xa&&ut.hasIconData();if(J){const vo=q.elevation,Os=vo?vo.getAtTileOffsetFunc(Me,q.center.lat,q.worldSize,q.projection):Il=>[0,0,0];Hi(ut,Me.projMatrix,p,b,ao,Rs,re,R,Os,Me)}const Po=J||b&&Ae||el,ti=p.translatePosMatrix(Me.projMatrix,at,w,C),$n=Po?ud:ao,tr=p.translatePosMatrix(Rs,at,w,C,!0),qr=q.projection.createInversionMatrix(q,Me.canonical),Zo=Po?mt.concat(["PROJECTED_POS_ON_VIEWPORT"]):mt,Zr=jt&&0!==h.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1);let ni;ni=jt?ut.iconsInText?tc(Ht.kind,Ft,te,re,p,ti,$n,tr,tn,Vt,Me,$e,he,qr):El(Ht.kind,Ft,te,re,p,ti,$n,tr,b,tn,!0,Me,$e,he,qr):ld(Ht.kind,Ft,te,re,p,ti,$n,tr,b,tn,Me,$e,he,qr);const yo={program:p.useProgram(Nf(jt,b,ut),Ne,Zo),buffers:Lt,uniformValues:ni,atlasTexture:_n,atlasTextureIcon:Qr,atlasInterpolation:qt,atlasInterpolationIcon:pn,isSDF:jt,hasHalo:Zr,tile:at,labelPlaneMatrixInv:qo};if(ie&&ut.canOverlap){le=!0;const vo=Lt.segments.get();for(const Os of vo)je.push({segments:new f.SegmentVector([Os]),sortKey:Os.sortKey,state:yo})}else je.push({segments:Lt.segments,sortKey:0,state:yo})}le&&je.sort((Me,at)=>Me.sortKey-at.sortKey);for(const Me of je){const at=Me.state;if(p.terrain&&p.terrain.setupElevationDraw(at.tile,at.program,{useDepthForOcclusion:!ze,labelPlaneMatrixInv:at.labelPlaneMatrixInv}),$.activeTexture.set(W.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,W.CLAMP_TO_EDGE),at.atlasTextureIcon&&($.activeTexture.set(W.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),at.isSDF){const ut=at.uniformValues;at.hasHalo&&(ut.u_is_halo=1,Zu(at.buffers,Me.segments,h,p,at.program,ee,L,B,ut)),ut.u_is_halo=0}Zu(at.buffers,Me.segments,h,p,at.program,ee,L,B,at.uniformValues)}}function Zu(p,i,h,_,b,w,C,S,P){const R=_.context;b.draw(R,R.gl.TRIANGLES,w,C,S,f.CullFaceMode.disabled,P,h.id,p.layoutVertexBuffer,p.indexBuffer,i,h.paint,_.transform.zoom,p.programConfigurations.get(h.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Kc(p,i,h,_,b,w,C){const S=p.context.gl,P=h.paint.get("fill-pattern"),R=P&&P.constantOr(1),L=h.getCrossfadeParameters();let B,$,W,q,V;C?($=R&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=S.LINES):($=R?"fillPattern":"fill",B=S.TRIANGLES);for(const re of _){const J=i.getTile(re);if(R&&!J.patternsLoaded())continue;const te=J.getBucket(h);if(!te)continue;p.prepareDrawTile();const ie=te.programConfigurations.get(h.id),le=p.useProgram($,ie);R&&(p.context.activeTexture.set(S.TEXTURE0),J.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ie.updatePaintBuffers(L));const ee=P.constantOr(null);if(ee&&J.imageAtlas){const Ae=J.imageAtlas,ze=Ae.patternPositions[ee.to.toString()],$e=Ae.patternPositions[ee.from.toString()];ze&&$e&&ie.setConstantPatternPositions(ze,$e)}const he=p.translatePosMatrix(re.projMatrix,J,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(C){q=te.indexBuffer2,V=te.segments2;const Ae=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];W="fillOutlinePattern"===$&&R?Ql(he,p,L,J,Ae):bl(he,Ae)}else q=te.indexBuffer,V=te.segments,W=R?go(he,p,L,J):Mo(he);p.prepareDrawProgram(p.context,le,re.toUnwrapped()),le.draw(p.context,B,b,p.stencilModeForClipping(re),w,f.CullFaceMode.disabled,W,h.id,te.layoutVertexBuffer,q,V,h.paint,p.transform.zoom,ie)}}function Tl(p,i,h,_,b,w,C){const S=p.context,P=S.gl,R=p.transform,L=h.paint.get("fill-extrusion-pattern"),B=L.constantOr(1),$=h.getCrossfadeParameters(),W=h.paint.get("fill-extrusion-opacity"),q=function(ie){if("globe"!==ie.projection.name)return 0;const le=Math.PI/32,ee=Math.tan(le),he=f.earthRadius;return he*Math.sqrt(1+2*ee*ee)-he}(R),V="globe"===R.projection.name,re=V?f.globeToMercatorTransition(R.zoom):0,J=[f.mercatorXfromLng(R.center.lng),f.mercatorYfromLat(R.center.lat)],te=[];V&&te.push("PROJECTION_GLOBE_VIEW");for(const ie of _){const le=i.getTile(ie),ee=le.getBucket(h);if(!ee||ee.projection!==R.projection.name)continue;const he=ee.programConfigurations.get(h.id),Ae=p.useProgram(B?"fillExtrusionPattern":"fillExtrusion",he,te);if(p.terrain){const at=p.terrain;if(p.style.terrainSetForDrapingOnly())at.setupElevationDraw(le,Ae,{useMeterToDem:!0});else{if(!ee.enableTerrain)continue;if(at.setupElevationDraw(le,Ae,{useMeterToDem:!0}),Cl(S,i,ie,ee,h,at),!ee.centroidVertexBuffer){const ut=Ae.attributes.a_centroid_pos;void 0!==ut&&P.vertexAttrib2f(ut,0,0)}}}B&&(p.context.activeTexture.set(P.TEXTURE0),le.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),he.updatePaintBuffers($));const ze=L.constantOr(null);if(ze&&le.imageAtlas){const at=le.imageAtlas,ut=at.patternPositions[ze.to.toString()],Lt=at.patternPositions[ze.from.toString()];ut&&Lt&&he.setConstantPatternPositions(ut,Lt)}const $e=p.translatePosMatrix(ie.projMatrix,le,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),je=R.projection.createInversionMatrix(R,ie.canonical),mt=h.paint.get("fill-extrusion-vertical-gradient"),Me=B?Wc($e,p,mt,W,ie,$,le,q,re,J,je):Zc($e,p,mt,W,ie,q,re,J,je);p.prepareDrawProgram(S,Ae,ie.toUnwrapped()),Ae.draw(S,S.gl.TRIANGLES,b,w,C,f.CullFaceMode.backCCW,Me,h.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,h.paint,p.transform.zoom,he,p.terrain?ee.centroidVertexBuffer:null,V?ee.layoutVertexExtBuffer:null)}}function Cl(p,i,h,_,b,w){const C=[J=>{let te=J.canonical.x-1,ie=J.wrap;return te<0&&(te=(1<<J.canonical.z)-1,ie--),new f.OverscaledTileID(J.overscaledZ,ie,J.canonical.z,te,J.canonical.y)},J=>{let te=J.canonical.x+1,ie=J.wrap;return te===1<<J.canonical.z&&(te=0,ie++),new f.OverscaledTileID(J.overscaledZ,ie,J.canonical.z,te,J.canonical.y)},J=>new f.OverscaledTileID(J.overscaledZ,J.wrap,J.canonical.z,J.canonical.x,(0===J.canonical.y?1<<J.canonical.z:J.canonical.y)-1),J=>new f.OverscaledTileID(J.overscaledZ,J.wrap,J.canonical.z,J.canonical.x,J.canonical.y===(1<<J.canonical.z)-1?0:J.canonical.y+1)],S=J=>{const te=i.getSource().minzoom,ie=ee=>{const he=i.getTileByID(ee);if(he&&he.hasData())return he.getBucket(b)},le=[0,-1,1];for(const ee of le){if(J.overscaledZ+ee<te)continue;const he=ie(J.calculateScaledKey(J.overscaledZ+ee));if(he)return he}},P=[0,0,0],R=(J,te)=>(P[0]=Math.min(J.min.y,te.min.y),P[1]=Math.max(J.max.y,te.max.y),P[2]=f.EXTENT-te.min.x>J.max.x?te.min.x-f.EXTENT:J.max.x,P),L=(J,te)=>(P[0]=Math.min(J.min.x,te.min.x),P[1]=Math.max(J.max.x,te.max.x),P[2]=f.EXTENT-te.min.y>J.max.y?te.min.y-f.EXTENT:J.max.y,P),B=[(J,te)=>R(J,te),(J,te)=>R(te,J),(J,te)=>L(J,te),(J,te)=>L(te,J)],$=new f.pointGeometry(0,0);let W,q,V;const re=(J,te,ie,le,ee)=>{const he=[[le?ie:J,le?J:ie,0],[le?ie:te,le?te:ie,0]],Ae=ee<0?f.EXTENT+ee:ee,ze=[le?Ae:(J+te)/2,le?(J+te)/2:Ae,0];return 0===ie&&ee<0||0!==ie&&ee>0?w.getForTilePoints(V,[ze],!0,q):he.push(ze),w.getForTilePoints(h,he,!0,W),Math.max(he[0][2],he[1][2],ze[2])/w.exaggeration()};for(let J=0;J<4;J++){const te=(J<2?1:5)-J,ie=_.borders[J];if(0===ie.length)continue;const le=V=C[J](h),ee=S(le);if(!(ee&&ee instanceof f.FillExtrusionBucket&&ee.enableTerrain)||_.borderDoneWithNeighborZ[J]===ee.canonical.z&&ee.borderDoneWithNeighborZ[te]===_.canonical.z||(q=w.findDEMTileFor(le),!q||!q.dem))continue;if(!W){const $e=w.findDEMTileFor(h);if(!$e||!$e.dem)return;W=$e}const he=ee.borders[te];let Ae=0;const ze=ee.borderDoneWithNeighborZ[te]!==_.canonical.z;if(_.canonical.z===ee.canonical.z){for(let $e=0;$e<ie.length;$e++){const je=_.featuresOnBorder[ie[$e]],mt=je.borders[J];let Me;for(;Ae<he.length&&(Me=ee.featuresOnBorder[he[Ae]],!(Me.borders[te][1]>mt[0]+3));)ze&&ee.encodeCentroid(void 0,Me,!1),Ae++;if(Me&&Ae<he.length){const at=Ae;let ut=0;for(;!(Me.borders[te][0]>mt[1]-3)&&(ut++,++Ae!==he.length);)Me=ee.featuresOnBorder[he[Ae]];if(Me=ee.featuresOnBorder[he[at]],je.intersectsCount()>1||Me.intersectsCount()>1||1!==ut){1!==ut&&(Ae=at),_.encodeCentroid(void 0,je,!1),ze&&ee.encodeCentroid(void 0,Me,!1);continue}const Lt=B[J](je,Me),Ne=J%2?f.EXTENT-1:0;$.x=re(Lt[0],Math.min(f.EXTENT-1,Lt[1]),Ne,J<2,Lt[2]),$.y=0,_.encodeCentroid($,je,!1),ze&&ee.encodeCentroid($,Me,!1)}else _.encodeCentroid(void 0,je,!1)}_.borderDoneWithNeighborZ[J]=ee.canonical.z,_.needsCentroidUpdate=!0,ze&&(ee.borderDoneWithNeighborZ[te]=_.canonical.z,ee.needsCentroidUpdate=!0)}else{for(const $e of ie)_.encodeCentroid(void 0,_.featuresOnBorder[$e],!1);if(ze){for(const $e of he)ee.encodeCentroid(void 0,ee.featuresOnBorder[$e],!1);ee.borderDoneWithNeighborZ[te]=_.canonical.z,ee.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[J]=ee.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(p)}const Yc=new f.Color(1,0,0,1),Wu=new f.Color(0,1,0,1),Jc=new f.Color(0,0,1,1),Qc=new f.Color(1,0,1,1),io=new f.Color(0,1,1,1);function It(p,i,h,_){ja(p,0,i+h/2,p.transform.width,h,_)}function $o(p,i,h,_){ja(p,i-h/2,0,h,p.transform.height,_)}function ja(p,i,h,_,b,w){const C=p.context,S=C.gl;S.enable(S.SCISSOR_TEST),S.scissor(i*f.exported.devicePixelRatio,h*f.exported.devicePixelRatio,_*f.exported.devicePixelRatio,b*f.exported.devicePixelRatio),C.clear({color:w}),S.disable(S.SCISSOR_TEST)}function hd(p,i,h){const _=p.context,b=_.gl,w="globe"===p.transform.projection.name,C=h.projMatrix,S=p.useProgram("debug",null,w?["PROJECTION_GLOBE_VIEW"]:null),P=i.getTileByID(h.key);p.terrain&&p.terrain.setupElevationDraw(P,S);const R=f.DepthMode.disabled,L=f.StencilMode.disabled,B=p.colorModeForRenderPass(),$="$debug";_.activeTexture.set(b.TEXTURE0),p.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),w?P._makeGlobeTileDebugBuffers(p.context,p.transform.projection):P._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const W=P._tileDebugBuffer||p.debugBuffer,q=P._tileDebugIndexBuffer||p.debugIndexBuffer,V=P._tileDebugSegments||p.debugSegments;S.draw(_,b.LINE_STRIP,R,L,B,f.CullFaceMode.disabled,id(C,f.Color.red),$,W,q,V,null,null,null,P._globeTileDebugBorderBuffer);const re=P.latestRawTileData,J=Math.floor((re&&re.byteLength||0)/1024),te=i.getTile(h).tileSize,ie=512/Math.min(te,512)*(h.overscaledZ/p.transform.zoom)*.5;let le=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(le+=` => ${h.overscaledZ}`),function(ze,$e){ze.initDebugOverlayCanvas();const je=ze.debugOverlayCanvas,mt=ze.context.gl,Me=ze.debugOverlayCanvas.getContext("2d");Me.clearRect(0,0,je.width,je.height),Me.shadowColor="white",Me.shadowBlur=2,Me.lineWidth=1.5,Me.strokeStyle="white",Me.textBaseline="top",Me.font="bold 36px Open Sans, sans-serif",Me.fillText($e,5,5),Me.strokeText($e,5,5),ze.debugOverlayTexture.update(je),ze.debugOverlayTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE)}(p,`${le} ${J}kb`);const ee=P._tileDebugTextBuffer||p.debugBuffer,he=P._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ae=P._tileDebugTextSegments||p.debugSegments;S.draw(_,b.TRIANGLES,R,L,f.ColorMode.alphaBlended,f.CullFaceMode.disabled,id(C,f.Color.transparent,ie),$,ee,he,Ae,null,null,null,P._globeTileDebugTextBuffer)}const dd=f.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:_a}=dd;function Zs(p,i,h,_){p.emplaceBack(i,h,_)}class Va{constructor(i){this.vertexArray=new f.StructArrayLayout3f12,this.indices=new f.StructArrayLayout3ui6,Zs(this.vertexArray,-1,-1,1),Zs(this.vertexArray,1,-1,1),Zs(this.vertexArray,-1,1,1),Zs(this.vertexArray,1,1,1),Zs(this.vertexArray,-1,-1,-1),Zs(this.vertexArray,1,-1,-1),Zs(this.vertexArray,-1,1,-1),Zs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,_a),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=f.SegmentVector.simpleSegment(0,0,36,12)}}function $a(p,i,h,_,b,w){const C=p.gl,S=i.paint.get("sky-atmosphere-color"),P=i.paint.get("sky-atmosphere-halo-color"),R=i.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:f.fromMat4(f.create$1(),_),u_sun_direction:b,u_sun_intensity:R,u_color_tint_r:[(q=S).r,q.g,q.b,q.a],u_color_tint_m:[(V=P).r,V.g,V.b,V.a],u_luminance:5e-5};var q,V;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+w,i.skyboxTexture,0),h.draw(p,C.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,f.ColorMode.unblended,f.CullFaceMode.frontCW,L,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}function Sr(p,i){return f.transformMat4(p,p,i)}const eu={symbol:function(p,i,h,_,b){if("translucent"!==p.renderPass)return;const w=f.StencilMode.disabled,C=p.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(S,P,R,L,B,$,W){const q=P.transform,V="map"===B,re="map"===$;for(const J of S){const te=L.getTile(J),ie=te.getBucket(R);if(!ie||ie.projection!==q.projection.name||!ie.text||!ie.text.segments.get().length)continue;const le=f.evaluateSizeForZoom(ie.textSizeData,q.zoom),ee=P.transform.calculatePixelsToTileUnitsMatrix(te),he=hn(J.projMatrix,te.tileID.canonical,re,V,P.transform,ee),Ae="none"!==R.layout.get("icon-text-fit")&&ie.hasIconData();if(le){const ze=Math.pow(2,q.zoom-te.tileID.overscaledZ);Ua(ie,V,re,W,f.symbolSize,q,he,J,ze,le,Ae,q.projection)}}}(_,p,h,i,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),b),0!==h.paint.get("icon-opacity").constantOr(1)&&Ps(p,i,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),w,C),0!==h.paint.get("text-opacity").constantOr(1)&&Ps(p,i,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),w,C),i.map.showCollisionBoxes&&(zf(p,i,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),zf(p,i,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(p,i,h,_){if("translucent"!==p.renderPass)return;const b=h.paint.get("circle-opacity"),w=h.paint.get("circle-stroke-width"),C=h.paint.get("circle-stroke-opacity"),S=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===b.constantOr(1)&&(0===w.constantOr(1)||0===C.constantOr(1)))return;const P=p.context,R=P.gl,L=p.transform,B=p.depthModeForSublayer(0,f.DepthMode.ReadOnly),$=f.StencilMode.disabled,W=p.colorModeForRenderPass(),q="globe"===L.projection.name,V=[f.mercatorXfromLng(L.center.lng),f.mercatorYfromLat(L.center.lat)],re=[];for(let te=0;te<_.length;te++){const ie=_[te],le=i.getTile(ie),ee=le.getBucket(h);if(!ee)continue;const he=ee.programConfigurations.get(h.id),Ae=Rf(h);q&&Ae.push("PROJECTION_GLOBE_VIEW");const ze=p.useProgram("circle",he,Ae),$e=ee.layoutVertexBuffer,je=ee.globeExtVertexBuffer,mt=ee.indexBuffer,Me=L.projection.createInversionMatrix(L,ie.canonical),at={programConfiguration:he,program:ze,layoutVertexBuffer:$e,globeExtVertexBuffer:je,indexBuffer:mt,uniformValues:qi(p,ie,le,Me,V,h),tile:le};if(S){const ut=ee.segments.get();for(const Lt of ut)re.push({segments:new f.SegmentVector([Lt]),sortKey:Lt.sortKey,state:at})}else re.push({segments:ee.segments,sortKey:0,state:at})}S&&re.sort((te,ie)=>te.sortKey-ie.sortKey);const J={useDepthForOcclusion:!q};for(const te of re){const{programConfiguration:ie,program:le,layoutVertexBuffer:ee,globeExtVertexBuffer:he,indexBuffer:Ae,uniformValues:ze,tile:$e}=te.state,je=te.segments;p.terrain&&p.terrain.setupElevationDraw($e,le,J),p.prepareDrawProgram(P,le,$e.tileID.toUnwrapped()),le.draw(P,R.TRIANGLES,B,$,W,f.CullFaceMode.disabled,ze,h.id,ee,Ae,je,h.paint,L.zoom,ie,q?he:null)}},heatmap:function(p,i,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const b=p.context,w=b.gl,C=f.StencilMode.disabled,S=new f.ColorMode([w.ONE,w.ONE],f.Color.transparent,[!0,!0,!0,!0]);(function($,W,q){const V=$.gl;$.activeTexture.set(V.TEXTURE1),$.viewport.set([0,0,W.width/4,W.height/4]);let re=q.heatmapFbo;if(re)V.bindTexture(V.TEXTURE_2D,re.colorAttachment.get()),$.bindFramebuffer.set(re.framebuffer);else{const J=V.createTexture();V.bindTexture(V.TEXTURE_2D,J),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),re=q.heatmapFbo=$.createFramebuffer(W.width/4,W.height/4,!1),function(te,ie,le,ee){const he=te.gl;he.texImage2D(he.TEXTURE_2D,0,he.RGBA,ie.width/4,ie.height/4,0,he.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:he.UNSIGNED_BYTE,null),ee.colorAttachment.set(le)}($,W,J,re)}})(b,p,h),b.clear({color:f.Color.transparent});const P=p.transform,R="globe"===P.projection.name,L=R?["PROJECTION_GLOBE_VIEW"]:null,B=[f.mercatorXfromLng(P.center.lng),f.mercatorYfromLat(P.center.lat)];for(let $=0;$<_.length;$++){const W=_[$];if(i.hasRenderableParent(W))continue;const q=i.getTile(W),V=q.getBucket(h);if(!V)continue;const re=V.programConfigurations.get(h.id),J=p.useProgram("heatmap",re,L),{zoom:te}=p.transform;p.terrain&&p.terrain.setupElevationDraw(q,J),p.prepareDrawProgram(b,J,W.toUnwrapped());const ie=P.projection.createInversionMatrix(P,W.canonical);J.draw(b,w.TRIANGLES,f.DepthMode.disabled,C,S,f.CullFaceMode.disabled,km(p,W,q,ie,B,te,h.paint.get("heatmap-intensity")),h.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,h.paint,p.transform.zoom,re,R?V.globeExtVertexBuffer:null)}b.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(b,w){const C=b.context,S=C.gl,P=w.heatmapFbo;if(!P)return;C.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,P.colorAttachment.get()),C.activeTexture.set(S.TEXTURE1);let R=w.colorRampTexture;R||(R=w.colorRampTexture=new f.Texture(C,w.colorRamp,S.RGBA)),R.bind(S.LINEAR,S.CLAMP_TO_EDGE),b.useProgram("heatmapTexture").draw(C,S.TRIANGLES,f.DepthMode.disabled,f.StencilMode.disabled,b.colorModeForRenderPass(),f.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,w.paint,b.transform.zoom)}(p,h))},line:function(p,i,h,_){if("translucent"!==p.renderPass)return;const b=h.paint.get("line-opacity"),w=h.paint.get("line-width");if(0===b.constantOr(1)||0===w.constantOr(1))return;const C=p.depthModeForSublayer(0,f.DepthMode.ReadOnly),S=p.colorModeForRenderPass(),P=p.terrain&&p.terrain.renderingToTexture?1:f.exported.devicePixelRatio,R=h.paint.get("line-dasharray"),L=R.constantOr(1),B=h.layout.get("line-cap"),$=h.paint.get("line-pattern"),W=$.constantOr(1),q=h.paint.get("line-gradient"),V=h.getCrossfadeParameters(),re=W?"linePattern":"line",J=p.context,te=J.gl,ie=(ee=>{const he=[];sd(ee)&&he.push("RENDER_LINE_DASH"),ee.paint.get("line-gradient")&&he.push("RENDER_LINE_GRADIENT");const Ae=ee.paint.get("line-pattern").constantOr(1),ze=1!==ee.paint.get("line-opacity").constantOr(1);return!Ae&&ze&&he.push("RENDER_LINE_ALPHA_DISCARD"),he})(h);let le=ie.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const ee of _){const he=i.getTile(ee);if(W&&!he.patternsLoaded())continue;const Ae=he.getBucket(h);if(!Ae)continue;p.prepareDrawTile();const ze=Ae.programConfigurations.get(h.id),$e=p.useProgram(re,ze,ie),je=$.constantOr(null);if(je&&he.imageAtlas){const Ne=he.imageAtlas,jt=Ne.patternPositions[je.to.toString()],Ht=Ne.patternPositions[je.from.toString()];jt&&Ht&&ze.setConstantPatternPositions(jt,Ht)}const mt=R.constantOr(null),Me=B.constantOr(null);if(!W&&mt&&Me&&he.lineAtlas){const Ne=he.lineAtlas,jt=Ne.getDash(mt.to,Me),Ht=Ne.getDash(mt.from,Me);jt&&Ht&&ze.setConstantPatternPositions(jt,Ht)}const at=p.terrain?ee.projMatrix:null,ut=W?od(p,he,h,V,at,P):Rm(p,he,h,V,at,Ae.lineClipsArray.length,P);if(q){const Ne=Ae.gradients[h.id];let jt=Ne.texture;if(h.gradientVersion!==Ne.version){let Ht=256;if(h.stepInterpolant){const At=i.getSource().maxzoom,Ft=ee.canonical.z===At?Math.ceil(1<<p.transform.maxZoom-ee.canonical.z):1;Ht=f.clamp(f.nextPowerOfTwo(Ae.maxLineLength/f.EXTENT*1024*Ft),256,J.maxTextureSize)}Ne.gradient=f.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Ht,image:Ne.gradient||void 0,clips:Ae.lineClipsArray}),Ne.texture?Ne.texture.update(Ne.gradient):Ne.texture=new f.Texture(J,Ne.gradient,te.RGBA),Ne.version=h.gradientVersion,jt=Ne.texture}J.activeTexture.set(te.TEXTURE1),jt.bind(h.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}L&&(J.activeTexture.set(te.TEXTURE0),he.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),ze.updatePaintBuffers(V)),W&&(J.activeTexture.set(te.TEXTURE0),he.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),ze.updatePaintBuffers(V)),p.prepareDrawProgram(J,$e,ee.toUnwrapped());const Lt=Ne=>{$e.draw(J,te.TRIANGLES,C,Ne,S,f.CullFaceMode.disabled,ut,h.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,h.paint,p.transform.zoom,ze,Ae.layoutVertexBuffer2)};if(le){const Ne=p.stencilModeForClipping(ee).ref;0===Ne&&p.terrain&&J.clear({stencil:0});const jt={func:te.EQUAL,mask:255};ut.u_alpha_discard_threshold=.8,Lt(new f.StencilMode(jt,Ne,255,te.KEEP,te.KEEP,te.INVERT)),ut.u_alpha_discard_threshold=0,Lt(new f.StencilMode(jt,Ne,255,te.KEEP,te.KEEP,te.KEEP))}else Lt(p.stencilModeForClipping(ee))}le&&(p.resetStencilClippingMasks(),p.terrain&&J.clear({stencil:0}))},fill:function(p,i,h,_){const b=h.paint.get("fill-color"),w=h.paint.get("fill-opacity");if(0===w.constantOr(1))return;const C=p.colorModeForRenderPass(),S=h.paint.get("fill-pattern"),P=p.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===b.constantOr(f.Color.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(p.renderPass===P){const R=p.depthModeForSublayer(1,"opaque"===p.renderPass?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly);Kc(p,i,h,_,R,C,!1)}if("translucent"===p.renderPass&&h.paint.get("fill-antialias")){const R=p.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,f.DepthMode.ReadOnly);Kc(p,i,h,_,R,C,!0)}},"fill-extrusion":function(p,i,h,_){const b=h.paint.get("fill-extrusion-opacity");if(0!==b&&"translucent"===p.renderPass){const w=new f.DepthMode(p.context.gl.LEQUAL,f.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==b||h.paint.get("fill-extrusion-pattern").constantOr(1))Tl(p,i,h,_,w,f.StencilMode.disabled,f.ColorMode.disabled),Tl(p,i,h,_,w,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const C=p.colorModeForRenderPass();Tl(p,i,h,_,w,f.StencilMode.disabled,C)}}},hillshade:function(p,i,h,_){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const b=p.context,w=p.depthModeForSublayer(0,f.DepthMode.ReadOnly),C=p.colorModeForRenderPass(),S=p.terrain&&p.terrain.renderingToTexture,[P,R]="translucent"!==p.renderPass||S?[{},_]:p.stencilConfigForOverlap(_);for(const L of R){const B=i.getTile(L);if(B.needsHillshadePrepare&&"offscreen"===p.renderPass)vn(p,B,h,w,f.StencilMode.disabled,C);else if("translucent"===p.renderPass){const $=S&&p.terrain?p.terrain.stencilModeForRTTOverlap(L):P[L.overscaledZ];er(p,L,B,h,w,$,C)}}b.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,i,h,_,b,w){if("translucent"!==p.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const C=p.context,S=C.gl,P=i.getSource(),R=p.useProgram("raster"),L=p.colorModeForRenderPass(),B=p.terrain&&p.terrain.renderingToTexture,[$,W]=P instanceof de||B?[{},_]:p.stencilConfigForOverlap(_),q=W[W.length-1].overscaledZ,V=!p.options.moving;for(const re of W){const J=B?f.DepthMode.disabled:p.depthModeForSublayer(re.overscaledZ-q,1===h.paint.get("raster-opacity")?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly,S.LESS),te=re.toUnwrapped(),ie=i.getTile(re);if(B&&(!ie||!ie.hasData()))continue;const le=B?re.projMatrix:p.transform.calculateProjMatrix(te,V),ee=p.terrain&&B?p.terrain.stencilModeForRTTOverlap(re):$[re.overscaledZ],he=w?0:h.paint.get("raster-fade-duration");ie.registerFadeDuration(he);const Ae=i.findLoadedParent(re,0),ze=In(ie,Ae,i,p.transform,he);let $e,je;p.terrain&&p.terrain.prepareDrawTile();const mt="nearest"===h.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;C.activeTexture.set(S.TEXTURE0),ie.texture.bind(mt,S.CLAMP_TO_EDGE),C.activeTexture.set(S.TEXTURE1),Ae?(Ae.texture.bind(mt,S.CLAMP_TO_EDGE),$e=Math.pow(2,Ae.tileID.overscaledZ-ie.tileID.overscaledZ),je=[ie.tileID.canonical.x*$e%1,ie.tileID.canonical.y*$e%1]):ie.texture.bind(mt,S.CLAMP_TO_EDGE);const Me=Lf(le,je||[0,0],$e||1,ze,h,P instanceof de?P.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(C,R,te),P instanceof de)P.boundsBuffer&&P.boundsSegments&&R.draw(C,S.TRIANGLES,J,f.StencilMode.disabled,L,f.CullFaceMode.disabled,Me,h.id,P.boundsBuffer,p.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:at,tileBoundsIndexBuffer:ut,tileBoundsSegments:Lt}=p.getTileBoundsBuffers(ie);R.draw(C,S.TRIANGLES,J,ee,L,f.CullFaceMode.disabled,Me,h.id,at,ut,Lt)}}p.resetStencilClippingMasks()},background:function(p,i,h,_){const b=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(0===w)return;const C=p.context,S=C.gl,P=p.transform,R=P.tileSize,L=h.paint.get("background-pattern");if(p.isPatternMissing(L))return;const B=!L&&1===b.a&&1===w&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==B)return;const $=f.StencilMode.disabled,W=p.depthModeForSublayer(0,"opaque"===B?f.DepthMode.ReadWrite:f.DepthMode.ReadOnly),q=p.colorModeForRenderPass(),V=p.useProgram(L?"backgroundPattern":"background");let re,J=_;J||(re=p.getBackgroundTiles(),J=Object.values(re).map(ie=>ie.tileID)),L&&(C.activeTexture.set(S.TEXTURE0),p.imageManager.bind(p.context));const te=h.getCrossfadeParameters();for(const ie of J){const le=ie.toUnwrapped(),ee=_?ie.projMatrix:p.transform.calculateProjMatrix(le);p.prepareDrawTile();const he=i?i.getTile(ie):re?re[ie.key]:new f.Tile(ie,R,P.zoom,p),Ae=L?cd(ee,w,p,L,{tileID:ie,tileSize:R},te):Ff(ee,w,b);p.prepareDrawProgram(C,V,le);const{tileBoundsBuffer:ze,tileBoundsIndexBuffer:$e,tileBoundsSegments:je}=p.getTileBoundsBuffers(he);V.draw(C,S.TRIANGLES,W,$,q,f.CullFaceMode.disabled,Ae,h.id,ze,$e,je)}},sky:function(p,i,h){const _=p.transform,b="mercator"===_.projection.name||"globe"===_.projection.name?1:f.smoothstep(7,8,_.zoom),w=h.paint.get("sky-opacity")*b;if(0===w)return;const C=p.context,S=h.paint.get("sky-type"),P=new f.DepthMode(C.gl.LEQUAL,f.DepthMode.ReadOnly,[0,1]),R=p.frameCounter/1e3%1;"atmosphere"===S?"offscreen"===p.renderPass?h.needsSkyboxCapture(p)&&(function(L,B,$,W){const q=L.context,V=q.gl;let re=B.skyboxFbo;if(!re){re=B.skyboxFbo=q.createFramebuffer(32,32,!1),B.skyboxGeometry=new Va(q),B.skyboxTexture=q.gl.createTexture(),V.bindTexture(V.TEXTURE_CUBE_MAP,B.skyboxTexture),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MAG_FILTER,V.LINEAR);for(let le=0;le<6;++le)V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,V.RGBA,32,32,0,V.RGBA,V.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(re.framebuffer),q.viewport.set([0,0,32,32]);const J=B.getCenter(L,!0),te=L.useProgram("skyboxCapture"),ie=new Float64Array(16);f.identity(ie),f.rotateY(ie,ie,.5*-Math.PI),$a(q,B,te,ie,J,0),f.identity(ie),f.rotateY(ie,ie,.5*Math.PI),$a(q,B,te,ie,J,1),f.identity(ie),f.rotateX(ie,ie,.5*-Math.PI),$a(q,B,te,ie,J,2),f.identity(ie),f.rotateX(ie,ie,.5*Math.PI),$a(q,B,te,ie,J,3),f.identity(ie),$a(q,B,te,ie,J,4),f.identity(ie),f.rotateY(ie,ie,Math.PI),$a(q,B,te,ie,J,5),q.viewport.set([0,0,L.width,L.height])}(p,h),h.markSkyboxValid(p)):"sky"===p.renderPass&&function(L,B,$,W,q){const V=L.context,re=V.gl,J=L.transform,te=L.useProgram("skybox");V.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_CUBE_MAP,B.skyboxTexture);const ie={u_matrix:J.skyboxMatrix,u_sun_direction:B.getCenter(L,!1),u_cubemap:0,u_opacity:W,u_temporal_offset:q};L.prepareDrawProgram(V,te),te.draw(V,re.TRIANGLES,$,f.StencilMode.disabled,L.colorModeForRenderPass(),f.CullFaceMode.backCW,ie,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(p,h,P,w,R):"gradient"===S&&"sky"===p.renderPass&&function(L,B,$,W,q){const V=L.context,re=V.gl,J=L.transform,te=L.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Va(V)),V.activeTexture.set(re.TEXTURE0);let ie=B.colorRampTexture;ie||(ie=B.colorRampTexture=new f.Texture(V,B.colorRamp,re.RGBA)),ie.bind(re.LINEAR,re.CLAMP_TO_EDGE);const le=(ee=J.skyboxMatrix,he=B.getCenter(L,!1),Ae=B.paint.get("sky-gradient-radius"),ze=W,$e=q,{u_matrix:ee,u_color_ramp:0,u_center_direction:he,u_radius:f.degToRad(Ae),u_opacity:ze,u_temporal_offset:$e});var ee,he,Ae,ze,$e;L.prepareDrawProgram(V,te),te.draw(V,re.TRIANGLES,$,f.StencilMode.disabled,L.colorModeForRenderPass(),f.CullFaceMode.backCW,le,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(p,h,P,w,R)},debug:function(p,i,h){for(let _=0;_<h.length;_++)hd(p,i,h[_])},custom:function(p,i,h){const _=p.context,b=h.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))f.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===p.renderPass){const w=b.prerender;w&&(p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),w.call(b,_.gl,p.transform.customLayerMatrix()),_.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),_.setStencilMode(f.StencilMode.disabled);const w="3d"===b.renderingMode?new f.DepthMode(p.context.gl.LEQUAL,f.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,f.DepthMode.ReadOnly);_.setDepthMode(w),b.render(_.gl,p.transform.customLayerMatrix()),_.setDirty(),p.setBaseState(),_.bindFramebuffer.set(null)}}};class fd{constructor(i,h){this.context=new z(i),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=f.SourceCache.maxUnderzooming+f.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ds,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(i,h){const _=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new jr(this,i));const b=this._terrain;this.transform.elevation=_?b:null,b.update(i,this.transform,h)}_updateFog(i){const h=i.fog;if(!h||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,b]=h.getFovAdjustedRange(this.transform._fov);if(_>b)return void(this.transform.fogCullDistSq=null);const w=_+.78*(b-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,h){if(this.width=i*f.exported.devicePixelRatio,this.height=h*f.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const i=this.context,h=new f.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(f.EXTENT,0),h.emplaceBack(0,f.EXTENT),h.emplaceBack(f.EXTENT,f.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(h,f.posAttributes.members),this.tileExtentSegments=f.SegmentVector.simpleSegment(0,0,4,2);const _=new f.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(f.EXTENT,0),_.emplaceBack(0,f.EXTENT),_.emplaceBack(f.EXTENT,f.EXTENT),this.debugBuffer=i.createVertexBuffer(_,f.posAttributes.members),this.debugSegments=f.SegmentVector.simpleSegment(0,0,4,5);const b=new f.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(b,f.posAttributes.members),this.viewportSegments=f.SegmentVector.simpleSegment(0,0,4,2);const w=new f.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(f.EXTENT,0,f.EXTENT,0),w.emplaceBack(0,f.EXTENT,0,f.EXTENT),w.emplaceBack(f.EXTENT,f.EXTENT,f.EXTENT,f.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(w,f.boundsAttributes.members),this.mercatorBoundsSegments=f.SegmentVector.simpleSegment(0,0,4,2);const C=new f.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(C);const S=new f.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])S.emplaceBack(R);this.debugIndexBuffer=i.createIndexBuffer(S),this.emptyTexture=new f.Texture(i,new f.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=f.create();const P=this.context.gl;this.stencilClearMode=new f.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(f.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,h=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(i,h.TRIANGLES,f.DepthMode.disabled,this.stencilClearMode,f.ColorMode.disabled,f.CullFaceMode.disabled,mo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(i,h,_){if(!h||this.currentStencilSource===h.id||!i.isTileClipped()||!_||0===_.length)return;const b=[];let w=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const L of _)if(this._tileClippingMaskIDs.has(L.key)||(w=!0),this._skippedStencilTileIDs.has(L.key)){if(!h.getTile(L).getBucket(i))continue;this._skippedStencilTileIDs.delete(L.key),b.push(L)}if(!w&&0===b.length)return}const C=this.context,S=C.gl;C.setColorMode(f.ColorMode.disabled),C.setDepthMode(f.DepthMode.disabled);const P=this.useProgram("clippingMask"),R=L=>{const B=h.getTile(L),{tileBoundsBuffer:$,tileBoundsIndexBuffer:W,tileBoundsSegments:q}=this.getTileBoundsBuffers(B);P.draw(C,S.TRIANGLES,f.DepthMode.disabled,new f.StencilMode({func:S.GREATER,mask:255},this._tileClippingMaskIDs.get(L.key)||0,255,S.KEEP,S.KEEP,S.REPLACE),f.ColorMode.disabled,f.CullFaceMode.disabled,mo(L.projMatrix),"$clipping",$,W,q)};if(!w&&b.length>0)for(const L of b)R(L);else{(0===this._tileClippingMaskIDs.size||this.nextStencilID+_.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const L of _)this._tileClippingMaskIDs.set(L.key,this.nextStencilID++),h.getTile(L).getBucket(i)?R(L):this._skippedStencilTileIDs.add(L.key)}0===this._skippedStencilTileIDs.size&&(this.currentStencilSource=h.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,h=this.context.gl;return new f.StencilMode({func:h.NOTEQUAL,mask:255},i,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const h=this.context.gl;return new f.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs.get(i.key)||0,0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(i){const h=this.context.gl,_=i.sort((C,S)=>S.overscaledZ-C.overscaledZ),b=_[_.length-1].overscaledZ,w=_[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const C={};for(let S=0;S<w;S++)C[S+b]=new f.StencilMode({func:h.GEQUAL,mask:255},S+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[C,_]}return[{[b]:f.StencilMode.disabled},_]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new f.ColorMode([i.CONSTANT_COLOR,i.ONE],new f.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?f.ColorMode.unblended:f.ColorMode.alphaBlended}depthModeForSublayer(i,h,_){if(!this.opaquePassEnabledForLayer())return f.DepthMode.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new f.DepthMode(_||this.context.gl.LEQUAL,h,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,h){this.style=i,this.options=h,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(f.exported.now()),this.imageManager.beginFrame();const _=this.style.order,b=this.style._sourceCaches;for(const R in b){const L=b[R];L.used&&L.prepare(this.context)}const w={},C={},S={};for(const R in b){const L=b[R];w[R]=L.getVisibleCoordinates(),C[R]=w[R].slice().reverse(),S[R]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<_.length;R++)if(this.style._layers[_[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new f.GlobeSharedBuffers(this.context)),!f.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const R of _){const L=this.style._layers[R],B=i._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const $=B?C[B.id]:void 0;("custom"===L.type||L.isSky()||$&&$.length)&&this.renderLayer(this,B,L,$)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let P=f.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(P=this.style.fog.properties.get("color")),this.context.clear({color:h.showOverdrawInspector?f.Color.black:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[_[this.currentLayer]],L=i._getLayerSourceCache(R);if(R.isSky())continue;const B=L?C[L.id]:void 0;this._renderTileClippingMasks(R,L,B),this.renderLayer(this,L,R,B)}if(this.renderPass="sky",(f.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const R=this.style._layers[_[this.currentLayer]],L=i._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,L,R,L?C[L.id]:void 0)}for("globe"===this.transform.projection.name&&function(R){const L=R.context,B=L.gl,$=R.transform,W=new f.DepthMode(B.LEQUAL,f.DepthMode.ReadOnly,[0,1]),q=R.useProgram("globeAtmosphere"),V=$.centerOffset,re=$._camera.getCameraToClipPerspective($._fov,$.width/$.height,$._nearZ,$._farZ);re[8]=2*-V.x/$.width,re[9]=2*V.y/$.height;const J=f.invert([],re),te=f.mul([],J,$.projMatrix),ie={u_frustum_tl:Sr([-1,1,1],J),u_frustum_tr:Sr([1,1,1],J),u_frustum_br:Sr([1,-1,1],J),u_frustum_bl:Sr([-1,-1,1],J),u_globe_pos:Sr([$.globeMatrix[12],$.globeMatrix[13],$.globeMatrix[14]],te),u_globe_radius:$.worldSize/2/Math.PI-1,u_opacity:1-f.globeToMercatorTransition($.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};R.prepareDrawProgram(L,q);const le=R.globeSharedBuffers;le&&q.draw(L,B.TRIANGLES,W,f.StencilMode.disabled,f.ColorMode.alphaBlended,f.CullFaceMode.backCW,ie,"skybox",le.atmosphereVertexBuffer,le.atmosphereIndexBuffer,le.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const R=this.style._layers[_[this.currentLayer]],L=i._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=L?("symbol"===R.type?S:C)[L.id]:void 0;this._renderTileClippingMasks(R,L,L?w[L.id]:void 0),this.renderLayer(this,L,R,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;f.values(this.style._layers).forEach(L=>{const B=i._getLayerSourceCache(L);B&&!L.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<B.getSource().maxzoom)&&(R=B)}),R&&this.options.showTileBoundaries&&eu.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const L=R.transform.padding;It(R,R.transform.height-(L.top||0),3,Yc),It(R,L.bottom||0,3,Wu),$o(R,L.left||0,3,Jc),$o(R,R.transform.width-(L.right||0),3,Qc);const B=R.transform.centerPoint;var $,W,q,V;ja($=R,(W=B.x)-1,(q=R.transform.height-B.y)-10,2,20,V=io),ja($,W-10,q-1,20,2,V)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(f.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,h,_,b){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||b&&b.length)&&(this.id=_.id,this.gpuTimingStart(_),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(_.type)||eu[_.type](i,h,_,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[i.id];_||(_=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const h={};for(const _ in i){const b=i[_],w=this.context.extTimerQuery,C=w.getQueryObjectEXT(b.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(b.query),h[_]=C}return h}translatePosMatrix(i,h,_,b,w){if(!_[0]&&!_[1])return i;const C=w?"map"===b?this.transform.angle:0:"viewport"===b?-this.transform.angle:0;if(C){const R=Math.sin(C),L=Math.cos(C);_=[_[0]*L-_[1]*R,_[0]*R+_[1]*L]}const S=[w?_[0]:Vn(h,_[0],this.transform.zoom),w?_[1]:Vn(h,_[1],this.transform.zoom),0],P=new Float32Array(16);return f.translate(P,i,S),P}saveTileTexture(i){const h=this._tileTextures[i.size[0]];h?h.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const h=this._tileTextures[i];return h&&h.length>0?h.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const h=this.imageManager.getPattern(i.from.toString()),_=this.imageManager.getPattern(i.to.toString());return!h||!_}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),h&&!i&&0!==h.getOpacity(this.transform.pitch)&&_.push("FOG"),i&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(i,h,_){this.cache=this.cache||{};const b=_||[],w=this.currentGlobalDefines().concat(b),C=As.cacheKey(i,w,h);return this.cache[C]||(this.cache[C]=new As(this.context,i,Tn[i],h,lr[i],w)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=f.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const w=b.getOpacity(this.transform.pitch);0!==w&&h.setFogUniformValues(i,((C,S,P,R)=>{const L=S.properties.get("color"),B=C.frameCounter/1e3%1,$=[L.r/L.a,L.g/L.a,L.b/L.a,R];return{u_fog_matrix:P?C.transform.calculateFogTileMatrix(P):C.identityMat,u_fog_range:S.getFovAdjustedRange(C.transform._fov),u_fog_color:$,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:B}})(this,b,_,w))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,h=i.createTexture();return i.bindTexture(i.TEXTURE_2D,h),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const b of _)h[b.key]=i[b.key]||new f.Tile(b,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class zr{constructor(i=0,h=0,_=0,b=0){if(isNaN(i)||i<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=h,this.left=_,this.right=b}interpolate(i,h,_){return null!=h.top&&null!=i.top&&(this.top=f.number(i.top,h.top,_)),null!=h.bottom&&null!=i.bottom&&(this.bottom=f.number(i.bottom,h.bottom,_)),null!=h.left&&null!=i.left&&(this.left=f.number(i.left,h.left,_)),null!=h.right&&null!=i.right&&(this.right=f.number(i.right,h.right,_)),this}getCenter(i,h){const _=f.clamp((this.left+i-this.right)/2,0,i),b=f.clamp((this.top+h-this.bottom)/2,0,h);return new f.pointGeometry(_,b)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new zr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function pd(p,i){const h=f.getColumn(p,3);f.fromQuat(p,i),f.setColumn(p,3,h)}function md(p,i){const h=f.identity$1([]);return f.rotateZ$1(h,h,-i),f.rotateX$1(h,h,-p),h}function Ga(p,i){const h=[p[0],p[1],0],_=[i[0],i[1],0];if(f.length(h)>=1e-15){const C=f.normalize([],h);f.scale$2(_,C,f.dot(_,C)),i[0]=_[0],i[1]=_[1]}const b=f.cross([],i,p);if(f.len(b)<1e-15)return null;const w=Math.atan2(-b[1],b[0]);return md(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),w)}class Zi{constructor(i,h){this.position=i,this.orientation=h}get position(){return this._position}set position(i){if(i){const h=i instanceof f.MercatorCoordinate?i:new f.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(h.x=f.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(i,h){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(f.MercatorCoordinate.fromLngLat(i)):0,b=this.position,w=f.MercatorCoordinate.fromLngLat(i,_),C=[w.x-b.x,w.y-b.y,w.z-b.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Ga(C,h)}setPitchBearing(i,h){this.orientation=md(f.degToRad(i),f.degToRad(-h))}}class nc{constructor(i,h){this._transform=f.identity([]),this.orientation=h,this.position=i}get mercatorPosition(){const i=this.position;return new f.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=f.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var h;i&&f.setColumn(this._transform,3,[(h=i)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||f.identity$1([]),i&&pd(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,h){this._orientation=md(i,h),pd(this._transform,this._orientation)}forward(){const i=f.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=f.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=f.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,h){const _=new Float64Array(16);return f.invert(_,this.getWorldToCamera(i,h)),_}getWorldToCameraPosition(i,h,_){const b=this.position;f.scale$2(b,b,-i);const w=new Float64Array(16);return f.fromScaling(w,[_,_,_]),f.translate(w,w,b),w[10]*=h,w}getWorldToCamera(i,h){const _=new Float64Array(16),b=new Float64Array(4),w=this.position;return f.conjugate(b,this._orientation),f.scale$2(w,w,-i),f.fromQuat(_,b),f.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(i,h,_,b){const w=new Float64Array(16);return f.perspective(w,i,h,_,b),w}getDistanceToElevation(i){const h=0===i?0:f.mercatorZfromAltitude(i,this.position[1]),_=this.forward();return(h-this.position[2])/_[2]}clone(){return new nc([...this.position],[...this.orientation])}}function rc(p,i){const h=Fi(p),_=function(w,C,S,P,R){const L=new f.LngLat(S.lng-180*Ws,S.lat),B=new f.LngLat(S.lng+180*Ws,S.lat),$=w.project(L.lng,L.lat),W=w.project(B.lng,B.lat),q=-Math.atan2(W.y-$.y,W.x-$.x),V=f.MercatorCoordinate.fromLngLat(S);V.y=f.clamp(V.y,-.999975,.999975);const re=V.toLngLat(),J=w.project(re.lng,re.lat),te=f.MercatorCoordinate.fromLngLat(re);te.x+=Ws;const ie=te.toLngLat(),le=w.project(ie.lng,ie.lat),ee=Xu(le.x-J.x,le.y-J.y,q),he=f.MercatorCoordinate.fromLngLat(re);he.y+=Ws;const Ae=he.toLngLat(),ze=w.project(Ae.lng,Ae.lat),$e=Xu(ze.x-J.x,ze.y-J.y,q),je=Math.abs(ee.x)/Math.abs($e.y),mt=f.identity([]);f.rotateZ(mt,mt,-q*(1-(R?0:P)));const Me=f.identity([]);return f.scale(Me,Me,[1,1-(1-je)*P,1]),Me[4]=-$e.x/$e.y*P,f.rotateZ(Me,Me,q),f.multiply$1(Me,mt,Me),Me}(p.projection,0,p.center,h,i),b=ya(p);return f.scale(_,_,[b,b,1]),_}function ya(p){const i=p.projection,h=Fi(p),_=ic(i,p.center),b=ic(i,f.LngLat.convert(i.center));return Math.pow(2,_*h+(1-h)*b)}function Fi(p){const i=p.projection.range;if(!i)return 0;const h=Math.max(p.width,p.height),_=Math.log(h/1024)/Math.LN2;return f.smoothstep(i[0]+_,i[1]+_,p.zoom)}const Ws=1/4e4;function ic(p,i){const h=f.clamp(i.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),_=new f.LngLat(i.lng-180*Ws,h),b=new f.LngLat(i.lng+180*Ws,h),w=p.project(_.lng,h),C=p.project(b.lng,h),S=f.MercatorCoordinate.fromLngLat(_),P=f.MercatorCoordinate.fromLngLat(b),R=C.x-w.x,L=C.y-w.y,B=P.x-S.x,$=P.y-S.y,W=Math.sqrt((B*B+$*$)/(R*R+L*L));return Math.log(W)/Math.LN2}function Xu(p,i,h){const _=Math.cos(h),b=Math.sin(h);return{x:p*_-i*b,y:p*b+i*_}}class ss{constructor(i,h,_,b,w,C,S){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=i||0,this._maxZoom=h||22,this._minPitch=null==_?0:_,this._maxPitch=null==b?60:b,this.setProjection(C),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new f.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new zr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new nc,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const i=new ss(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||h)&&this._updateCameraOnTerrain(),(i||h)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return f.pick(this.projection,["name","center","parallels"])}setProjection(i){null==i&&(i={name:"mercator"}),this.projectionOptions=i;const h=this.projection?this.getProjection():void 0;this.projection=f.getProjection(i);const _=this.getProjection();return se(h,_)?null:(this._calcMatrices(),_)}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.pointGeometry(this.width,this.height)}get bearing(){return f.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const h=-i*Math.PI/180;var _,b,w,C,S,P,R,L,B,$;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new f.ARRAY_TYPE(4),f.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),b=this.rotationMatrix,C=this.angle,S=(w=this.rotationMatrix)[0],P=w[1],R=w[2],L=w[3],B=Math.sin(C),$=Math.cos(C),b[0]=S*$+R*B,b[1]=P*$+L*B,b[2]=S*-B+R*$,b[3]=P*-B+L*$)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const h=f.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const h=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let b=0,w=0;for(let C=0;C<h.length;C++){const S=new f.pointGeometry(h[C][0]*this.width,_+h[C][1]*(this.height-_)),P=i.pointCoordinate(S);if(!P)continue;const R=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);b+=P[3]*R,w+=R}return 0===w?NaN:b/w}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const i=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,b=this._mercatorZfromZoom(i),w=this._mercatorZfromZoom(this._maxZoom),C=Math.max(b-_,w);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let _;_=i.z<this._camera.position[2]?[h.x,h.y,h.z]:[i.x,i.y,i.z];const b=f.length(f.sub([],this._camera.position,_));return f.clamp(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let h=!1;if(i.orientation&&!f.exactEquals(i.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(i.orientation)),i.position){const _=[i.position.x,i.position.y,i.position.z];f.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,h=new Zi;return h.position=new f.MercatorCoordinate(i[0],i[1],i[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(i){if(!f.length$1(i))return!1;f.normalize$1(i,i);const h=f.transformQuat([],[0,0,-1],i),_=f.transformQuat([],[0,-1,0],i);if(_[2]<0)return!1;const b=Ga(h,_);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(i){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;i[2]=f.clamp(i[2],b/_,b/h),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,h,_){this._unmodified=!1,this._edgeInsets.interpolate(i,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const h=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(i){const h=[new f.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const _=this.pointCoordinate(new f.pointGeometry(0,0)),b=this.pointCoordinate(new f.pointGeometry(this.width,0)),w=this.pointCoordinate(new f.pointGeometry(this.width,this.height)),C=this.pointCoordinate(new f.pointGeometry(0,this.height)),S=Math.floor(Math.min(_.x,b.x,w.x,C.x)),P=Math.floor(Math.max(_.x,b.x,w.x,C.x)),R=1;for(let L=S-R;L<=P+R;L++)0!==L&&h.push(new f.UnwrappedTileID(L,i))}return h}coveringTiles(i){let h=this.coveringZoomLevel(i);const _=h,b=this.elevation&&!i.isTerrainDEM,w="mercator"===this.projection.name;if(void 0!==i.minzoom&&h<i.minzoom)return[];void 0!==i.maxzoom&&h>i.maxzoom&&(h=i.maxzoom);const C=this.locationCoordinate(this.center),S=this.center.lat,P=1<<h,R=[P*C.x,P*C.y,0],L="globe"===this.projection.name,B=!L,$=f.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,B),W=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=P*f.mercatorZfromAltitude(1,this.center.lat),V=this._camera.position[2]/f.mercatorZfromAltitude(1,this.center.lat),re=[P*W.x,P*W.y,V*(B?1:q)],J=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,ie=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=i.isTerrainDEM?-ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,ee=this.projection.isReprojectedInTileSpace?ya(this):1,he=Ne=>{const Ht=new f.MercatorCoordinate(Ne.x+25e-6,Ne.y,Ne.z),At=new f.MercatorCoordinate(Ne.x,Ne.y+25e-6,Ne.z),Ft=Ne.toLngLat(),tn=Ht.toLngLat(),_n=At.toLngLat(),qt=this.locationCoordinate(Ft),pn=this.locationCoordinate(tn),Vt=this.locationCoordinate(_n),Qr=Math.hypot(pn.x-qt.x,pn.y-qt.y),so=Math.hypot(Vt.x-qt.x,Vt.y-qt.y);return Math.sqrt(Qr*so)*ee/25e-6},Ae=Ne=>{const jt=ie,Ht=le;return{aabb:f.tileAABB(this,P,0,0,0,Ne,Ht,jt,this.projection),zoom:0,x:0,y:0,minZ:Ht,maxZ:jt,wrap:Ne,fullyVisible:!1}},ze=[];let $e=[];const je=h,mt=i.reparseOverscaled?_:h,Me=Ne=>Ne*Ne,at=Me((V-this._centerAltitude)*q),ut=Ne=>{if(!this._elevation||!Ne.tileID||!w)return;const jt=this._elevation.getMinMaxForTile(Ne.tileID),Ht=Ne.aabb;jt?(Ht.min[2]=jt.min,Ht.max[2]=jt.max,Ht.center[2]=(Ht.min[2]+Ht.max[2])/2):(Ne.shouldSplit=Lt(Ne),Ne.shouldSplit||(Ht.min[2]=Ht.max[2]=Ht.center[2]=this._centerAltitude))},Lt=Ne=>{if(Ne.zoom<te)return!0;if(Ne.zoom===je)return!1;if(null!=Ne.shouldSplit)return Ne.shouldSplit;const jt=Ne.aabb.distanceX(re),Ht=Ne.aabb.distanceY(re);let At=at,Ft=1;if(L){At=Me(Ne.aabb.distanceZ(re));const _n=Math.pow(2,Ne.zoom),qt=f.latFromMercatorY((Ne.y+1)/_n),pn=f.latFromMercatorY(Ne.y/_n),Vt=Math.min(Math.max(S,qt),pn),Qr=f.circumferenceAtLatitude(Vt)/f.circumferenceAtLatitude(S);Ft=Math.min(Qr,1)}else if(b&&(At=Me(Ne.aabb.distanceZ(re)*q)),this.projection.isReprojectedInTileSpace&&_<=5){const _n=Math.pow(2,Ne.zoom),qt=he(new f.MercatorCoordinate((Ne.x+.5)/_n,(Ne.y+.5)/_n));Ft=qt>.85?1:qt}const tn=jt*jt+Ht*Ht+At;return tn<Me((1<<je-Ne.zoom)*J*Ft*((_n,qt)=>{if(qt*Me(.707)<_n)return 1;const pn=Math.sqrt(qt/_n);return pn/(1.4144271570014144+(Math.pow(1.1,pn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(At,at),tn))};if(this.renderWorldCopies)for(let Ne=1;Ne<=3;Ne++)ze.push(Ae(-Ne)),ze.push(Ae(Ne));for(ze.push(Ae(0));ze.length>0;){const Ne=ze.pop(),jt=Ne.x,Ht=Ne.y;let At=Ne.fullyVisible;if(!At){const Ft=Ne.aabb.intersects($);if(0===Ft)continue;At=2===Ft}if(Ne.zoom!==je&&Lt(Ne))for(let Ft=0;Ft<4;Ft++){const tn=(jt<<1)+Ft%2,_n=(Ht<<1)+(Ft>>1),qt={aabb:w?Ne.aabb.quadrant(Ft):f.tileAABB(this,P,Ne.zoom+1,tn,_n,Ne.wrap,Ne.minZ,Ne.maxZ,this.projection),zoom:Ne.zoom+1,x:tn,y:_n,wrap:Ne.wrap,fullyVisible:At,tileID:void 0,shouldSplit:void 0,minZ:Ne.minZ,maxZ:Ne.maxZ};b&&!L&&(qt.tileID=new f.OverscaledTileID(Ne.zoom+1===je?mt:Ne.zoom+1,Ne.wrap,Ne.zoom+1,tn,_n),ut(qt)),ze.push(qt)}else{const Ft=Ne.zoom===je?mt:Ne.zoom;if(i.minzoom&&i.minzoom>Ft)continue;const tn=R[0]-(.5+jt+(Ne.wrap<<Ne.zoom))*(1<<h-Ne.zoom),_n=R[1]-.5-Ht,qt=Ne.tileID?Ne.tileID:new f.OverscaledTileID(Ft,Ne.wrap,Ne.zoom,jt,Ht);$e.push({tileID:qt,distanceSq:tn*tn+_n*_n})}}if(this.fogCullDistSq){const Ne=this.fogCullDistSq,jt=this.horizonLineFromTop();$e=$e.filter(Ht=>{const At=[0,0,0,1],Ft=[f.EXTENT,f.EXTENT,0,1],tn=this.calculateFogTileMatrix(Ht.tileID.toUnwrapped());f.transformMat4$1(At,At,tn),f.transformMat4$1(Ft,Ft,tn);const _n=f.getAABBPointSquareDist(At,Ft);if(0===_n)return!0;let qt=!1;const pn=this._elevation;if(pn&&_n>Ne&&0!==jt){const Vt=this.calculateProjMatrix(Ht.tileID.toUnwrapped());let Qr;i.isTerrainDEM||(Qr=pn.getMinMaxForTile(Ht.tileID)),Qr||(Qr={min:le,max:ie});const so=f.furthestTileCorner(this.rotation),ao=[so[0]*f.EXTENT,so[1]*f.EXTENT,Qr.max];f.transformMat4(ao,ao,Vt),qt=(1-ao[1])*this.height*.5<jt}return _n<Ne||qt})}return $e.sort((Ne,jt)=>Ne.distanceSq-jt.distanceSq).map(Ne=>Ne.tileID)}resize(i,h){this.width=i,this.height=h,this.pixelsToGLUnits=[2/i,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const h=f.clamp(i.lat,-f.MAX_MERCATOR_LATITUDE,f.MAX_MERCATOR_LATITUDE),_=this.projection.project(i.lng,h);return new f.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,h){let _,b;const w=this.centerPoint;if("globe"===this.projection.name){const S=this.worldSize;_=(h.x-w.x)/S,b=(h.y-w.y)/S}else{const S=this.pointCoordinate(h),P=this.pointCoordinate(w);_=S.x-P.x,b=S.y-P.y}const C=this.locationCoordinate(i);this.setLocation(new f.MercatorCoordinate(C.x-_,C.y-b))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,h){const _=h?f.mercatorZfromAltitude(h,i.lat):void 0,b=this.projection.project(i.lng,i.lat);return new f.MercatorCoordinate(b.x,b.y,_)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,h){const _=null!=h?h:this._centerAltitude,b=[i.x,i.y,0,1],w=[i.x,i.y,1,1];f.transformMat4$1(b,b,this.pixelMatrixInverse),f.transformMat4$1(w,w,this.pixelMatrixInverse);const C=w[3];f.scale$1(b,b,1/b[3]),f.scale$1(w,w,1/C);const S=b[2],P=w[2];return{p0:b,p1:w,t:S===P?0:(_-S)/(P-S)}}screenPointToMercatorRay(i){const h=[i.x,i.y,0,1],_=[i.x,i.y,1,1];return f.transformMat4$1(h,h,this.pixelMatrixInverse),f.transformMat4$1(_,_,this.pixelMatrixInverse),f.scale$1(h,h,1/h[3]),f.scale$1(_,_,1/_[3]),h[2]=f.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=f.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,f.scale$1(h,h,1/this.worldSize),f.scale$1(_,_,1/this.worldSize),new f.Ray([h[0],h[1],h[2]],f.normalize([],f.sub([],_,h)))}rayIntersectionCoordinate(i){const{p0:h,p1:_,t:b}=i,w=f.mercatorZfromAltitude(h[2],this._center.lat),C=f.mercatorZfromAltitude(_[2],this._center.lat);return new f.MercatorCoordinate(f.number(h[0],_[0],b)/this.worldSize,f.number(h[1],_[1],b)/this.worldSize,f.number(w,C,b))}pointCoordinate(i,h=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,h)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);const h=this.elevation;let _=this.elevation.pointCoordinate(i);if(_)return new f.MercatorCoordinate(_[0],_[1],_[2]);let b=0,w=this.horizonLineFromTop();if(i.y>w)return this.pointCoordinate(i);const C=.02*w,S=i.clone();for(let P=0;P<10&&w-b>C;P++){S.y=f.number(b,w,.66);const R=h.pointCoordinate(S);R?(w=S.y,_=R):b=S.y}return _?new f.MercatorCoordinate(_[0],_[1],_[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{const h=this.horizonLineFromTop();return i.y<h}}_coordinatePoint(i,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,b=[i.x*this.worldSize,i.y*this.worldSize,_+i.toAltitude(),1];return f.transformMat4$1(b,b,this.pixelMatrix),b[3]>0?new f.pointGeometry(b[0]/b[3],b[1]/b[3]):new f.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,h){const _=new f.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),b=new f.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),w=new f.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),C=new f.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(_,i),P=this.pointCoordinate(b,i);const R=this.pointCoordinate(w,h),L=this.pointCoordinate(C,h),B=($,W)=>(W.y-$.y)/(W.x-$.x);return S.y>1&&P.y>=0?S=new f.MercatorCoordinate((1-L.y)/B(L,S)+L.x,1):S.y<0&&P.y<=1&&(S=new f.MercatorCoordinate(-L.y/B(L,S)+L.x,0)),P.y>1&&S.y>=0?P=new f.MercatorCoordinate((1-R.y)/B(R,P)+R.x,1):P.y<0&&S.y<=1&&(P=new f.MercatorCoordinate(-R.y/B(R,P)+R.x,0)),(new f.LngLatBounds).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(R))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length)return this._getBounds(0,0);const h=i.visibleDemTiles.reduce((_,b)=>{if(b.dem){const w=b.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*i.exaggeration(),h.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return i?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-f.MAX_MERCATOR_LATITUDE,this.maxLat=f.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=f.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=f.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=f.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=f.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,h){return this.projection.createTileMatrix(this,h,i)}calculateDistanceTileData(i){const h=i.key,_=this._distanceTileDataCache;if(_[h])return _[h];const b=i.canonical,w=1/this.height,C=this.cameraWorldSize/this.zoomScale(b.z),S=(b.x+Math.pow(2,b.z)*i.wrap)*C,P=b.y*C,R=this.point,L=this.angle,B=Math.sin(-L),$=-Math.cos(-L);return _[h]={bearing:[B,$],center:[(R.x-S)*w,(R.y-P)*w],scale:C/f.EXTENT*w},_[h]}calculateFogTileMatrix(i){const h=i.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const b=this.calculatePosMatrix(i,this.cameraWorldSize);return f.multiply$1(b,this.worldToFogMatrix,b),_[h]=new Float32Array(b),_[h]}calculateProjMatrix(i,h=!1){const _=i.key,b=h?this._alignedProjMatrixCache:this._projMatrixCache;if(b[_])return b[_];const w=this.calculatePosMatrix(i,this.worldSize);return f.multiply$1(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,w),b[_]=new Float32Array(w),b[_]}calculatePixelsToTileUnitsMatrix(i){const h=i.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const b=function(w,C){const{scale:S}=w.tileTransform,P=S*f.EXTENT/(w.tileSize*Math.pow(2,C.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return R=new Float32Array(4),$=(L=C.inverseAdjustmentMatrix)[1],W=L[2],q=L[3],re=(B=[P,P])[1],R[0]=L[0]*(V=B[0]),R[1]=$*V,R[2]=W*re,R[3]=q*re,R;var R,L,B,$,W,q,V,re}(i,this);return _[h]=b,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const h=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),b=this._camera.forward(),w=f.mercatorZfromAltitude(1,this._center.lat);_[2]/=w,b[2]/=w,f.normalize(b,b);const C=i.raycast(_,b,i.exaggeration());if(C){const S=f.scaleAndAdd([],_,b,C),P=new f.MercatorCoordinate(S[0],S[1],f.mercatorZfromAltitude(S[2],f.latFromMercatorY(S[1]))),R=(P.z+f.length([P.x-_[0],P.y-_[1],P.z-_[2]*w]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const h=f.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),b=i.getAtPointOrZero(new f.MercatorCoordinate(..._)),w=this._minimumHeightOverTerrain()*Math.cos(f.degToRad(this._maxPitch)),C=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*b;if(C<w){const S=this.locationCoordinate(this._center,this._centerAltitude),P=[S.x-_[0],S.y-_[1],S.z-_[2]],R=f.length(P);P[2]-=(w-C)/this._projectionScaler;const L=f.length(P);if(0===L)return;f.scale$2(P,P,R/L*this._projectionScaler),this._camera.position=[S.x-P[0],S.y-P[1],S.z*this._projectionScaler-P[2]],this._camera.orientation=Ga(P,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const B=this.center;return B.lat=f.clamp(B.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(B.lng=f.clamp(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const i=this._unmodified,{x:h,y:_}=this.point;let b=0,w=h,C=_;const S=this.width/2,P=this.height/2,R=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(_-P<R&&(C=R+P),_+P>L&&(C=L-P),L-R<this.height&&(b=Math.max(b,this.height/(L-R)),C=(L+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,W=this.worldSize/2-(B+$)/2;w=(h+W+this.worldSize)%this.worldSize-W,w-S<B&&(w=B+S),w+S>$&&(w=$-S),$-B<this.width&&(b=Math.max(b,this.width/($-B)),w=($+B)/2)}w===h&&C===_||(this.center=this.unproject(new f.pointGeometry(w,C))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this._fov/2,h=this.centerOffset,_=this.pixelsPerMeter;this._projectionScaler=_/(f.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(i)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?_:1),w=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);w[8]=2*-h.x/this.width,w[9]=2*h.y/this.height;let C=f.mul([],w,b);if(this.projection.isReprojectedInTileSpace){const le=this.locationCoordinate(this.center),ee=f.identity([]);f.translate(ee,ee,[le.x*this.worldSize,le.y*this.worldSize,0]),f.multiply$1(ee,ee,rc(this)),f.translate(ee,ee,[-le.x*this.worldSize,-le.y*this.worldSize,0]),f.multiply$1(C,C,ee),this.inverseAdjustmentMatrix=function(he){const Ae=rc(he,!0);return gt([],[Ae[0],Ae[1],Ae[4],Ae[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=f.scale([],C,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=C,this.invProjMatrix=f.invert(new Float64Array(16),this.projMatrix);const S=new Float32Array(16);f.identity(S),f.scale(S,S,[1,-1,1]),f.rotateX(S,S,this._pitch),f.rotateZ(S,S,this.angle);const P=f.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-h.x/this.width,P[9]=2*(h.y+R)/this.height,this.skyboxMatrix=f.multiply$1(S,P,S);const L=this.point,B=L.x,$=L.y,W=this.width%2/2,q=this.height%2/2,V=Math.cos(this.angle),re=Math.sin(this.angle),J=B-Math.round(B)+V*W+re*q,te=$-Math.round($)+V*q+re*W,ie=new Float64Array(C);if(f.translate(ie,ie,[J>.5?J-1:J,te>.5?te-1:te,0]),this.alignedProjMatrix=ie,C=f.create(),f.scale(C,C,[this.width/2,-this.height/2,1]),f.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=f.create(),f.scale(C,C,[1,-1,1]),f.translate(C,C,[-1,-1,0]),f.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=f.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},C=f.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");this.pixelMatrixInverse=C,this.globeMatrix="globe"===this.projection.name?f.calculateGlobeMatrix(this):C,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,h=this.cameraPixelsPerMeter,_=this._camera.position,b=1/this.height,w=[i,i,h];f.scale$2(w,w,b),f.scale$2(_,_,-1),f.multiply$2(_,_,w);const C=f.create();f.translate(C,C,_),f.scale(C,C,w),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,h,b)}_computeCameraPosition(i){const h=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),b=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-i/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-_[0]*w,b.y/this.worldSize-_[1]*w,i/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=i[2];let b=1;_>0&&(b=Math.min((h-this._camera.position[2])/_,1)),this._camera.position=f.scaleAndAdd([],this._camera.position,i,b),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const i=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:b}=this._camera.getPitchBearing(),w=f.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(f.degToRad(this._maxPitch)),S=Math.max((i[2]-w)/Math.cos(_),C),P=this._zoomFromMercatorZ(S);f.scaleAndAdd(i,i,h,S),this._pitch=f.clamp(_,f.degToRad(this.minPitch),f.degToRad(this.maxPitch)),this.angle=f.wrap(b,-Math.PI,Math.PI),this._setZoom(f.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new f.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(f.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(i,h){const _=Math.min(i.x,h.x),b=Math.max(i.x,h.x),w=Math.min(i.y,h.y),C=Math.max(i.y,h.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new f.pointGeometry(_,w),new f.pointGeometry(b,C),new f.pointGeometry(_,C),new f.pointGeometry(b,w)],P=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const L of S){const B=this.pointRayIntersection(L);if(B.t<0)return!0;const $=this.rayIntersectionCoordinate(B);if($.x<P||$.y<0||$.x>R||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+f.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new f.pointGeometry(0,0),new f.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,h){const _=f.length(f.sub([],this._camera.position,i)),b=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(b)}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.pointGeometry(0,i))}}function tu(p,i){let h=!1,_=null;const b=()=>{_=null,h&&(p(),_=setTimeout(b,i),h=!1)};return()=>(h=!0,_||b(),_)}class nu{constructor(i){this._hashName=i&&encodeURIComponent(i),f.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=tu(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,f.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),f.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(i){const h=this._map;if(!h)return"";const _=h.getCenter(),b=Math.round(100*h.getZoom())/100,w=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,w),S=Math.round(_.lng*C)/C,P=Math.round(_.lat*C)/C,R=h.getBearing(),L=h.getPitch();let B="";if(B+=i?`/${S}/${P}/${b}`:`${b}/${P}/${S}`,(R||L)&&(B+="/"+Math.round(10*R)/10),L&&(B+=`/${Math.round(L)}`),this._hashName){const $=this._hashName;let W=!1;const q=f.window.location.hash.slice(1).split("&").map(V=>{const re=V.split("=")[0];return re===$?(W=!0,`${re}=${B}`):V}).filter(V=>V);return W||q.push(`${$}=${B}`),`#${q.join("&")}`}return`#${B}`}_getCurrentHash(){const i=f.window.location.hash.replace("#","");if(this._hashName){let h;return i.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(h[3]||0):i.getBearing();return i.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=f.window.location.href.replace(/(#.+)?$/,this.getHashString());f.window.history.replaceState(f.window.history.state,null,i)}}const gn={linearity:.3,easing:f.bezier(0,0,.3,1)},Bf=f.extend({deceleration:2500,maxSpeed:1400},gn),gd=f.extend({deceleration:20,maxSpeed:1400},gn),_d=f.extend({deceleration:1e3,maxSpeed:360},gn),yd=f.extend({deceleration:1e3,maxSpeed:90},gn);class Ku{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:f.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,h=f.exported.now();for(;i.length>0&&h-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new f.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(h.pan.mag()){const w=vi(h.pan.mag(),_,f.extend({},Bf,i||{}));b.offset=h.pan.mult(w.amount/h.pan.mag()),b.center=this._map.transform.center,oc(b,w)}if(h.zoom){const w=vi(h.zoom,_,gd);b.zoom=this._map.transform.zoom+w.amount,oc(b,w)}if(h.bearing){const w=vi(h.bearing,_,_d);b.bearing=this._map.transform.bearing+f.clamp(w.amount,-179,179),oc(b,w)}if(h.pitch){const w=vi(h.pitch,_,yd);b.pitch=this._map.transform.pitch+w.amount,oc(b,w)}if(b.zoom||b.bearing){const w=void 0===h.pinchAround?h.around:h.pinchAround;b.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function oc(p,i){(!p.duration||p.duration<i.duration)&&(p.duration=i.duration,p.easing=i.easing)}function vi(p,i,h){const{maxSpeed:_,linearity:b,deceleration:w}=h,C=f.clamp(p*b/(i/1e3),-_,_),S=Math.abs(C)/(w*b);return{easing:h.easing,duration:1e3*S,amount:C*(S/2)}}class nt extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,_,b={}){const w=Ze(h.getCanvasContainer(),_),C=h.unproject(w);super(i,f.extend({point:w,lngLat:C,originalEvent:_},b)),this._defaultPrevented=!1,this.target=h}}class Qn extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,_){const b="touchend"===i?_.changedTouches:_.touches,w=De(h.getCanvasContainer(),b),C=w.map(P=>h.unproject(P)),S=w.reduce((P,R,L,B)=>P.add(R.div(B.length)),new f.pointGeometry(0,0));super(i,{points:w,point:S,lngLats:C,lngLat:h.unproject(S),originalEvent:_}),this._defaultPrevented=!1}}class Uf extends f.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,_){super(i,{originalEvent:_}),this._defaultPrevented=!1}}class xi{constructor(i,h){this._map=i,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Uf(i.type,this._map,i))}mousedown(i,h){return this._mousedownPos=h,this._firePreventable(new nt(i.type,this._map,i))}mouseup(i){this._map.fire(new nt(i.type,this._map,i))}preclick(i){const h=f.extend({},i);h.type="preclick",this._map.fire(new nt(h.type,this._map,h))}click(i,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(i),this._map.fire(new nt(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new nt(i.type,this._map,i))}mouseover(i){this._map.fire(new nt(i.type,this._map,i))}mouseout(i){this._map.fire(new nt(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Qn(i.type,this._map,i))}touchmove(i){this._map.fire(new Qn(i.type,this._map,i))}touchend(i){this._map.fire(new Qn(i.type,this._map,i))}touchcancel(i){this._map.fire(new Qn(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ks{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new nt(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new nt("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new nt(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Dl{constructor(i,h){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,h){this.isEnabled()&&i.shiftKey&&0===i.button&&(Le(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(i,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=me("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const w=Math.min(b.x,_.x),C=Math.max(b.x,_.x),S=Math.min(b.y,_.y),P=Math.max(b.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${S}px)`,this._box.style.width=C-w+"px",this._box.style.height=P-S+"px")})}mouseupWindow(i,h){if(!this._active||0!==i.button)return;const _=this._startPos,b=h;if(this.reset(),rt(),_.x!==b.x||_.y!==b.y)return this._map.fire(new f.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(_,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),yt(),delete this._startPos,delete this._lastPos}_fireEvent(i,h){return this._map.fire(new f.Event(i,{originalEvent:h}))}}function zi(p,i){const h={};for(let _=0;_<p.length;_++)h[p[_].identifier]=i[_];return h}class Go{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=i.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const w=new f.pointGeometry(0,0);for(const C of b)w._add(C);return w.div(b.length)}(h),this.touches=zi(_,h)))}touchmove(i,h,_){if(this.aborted||!this.centroid)return;const b=zi(_,h);for(const w in this.touches){const C=this.touches[w],S=b[w];(!S||S.dist(C)>30)&&(this.aborted=!0)}}touchend(i,h,_){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Xs{constructor(i){this.singleTap=new Go(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,h,_){this.singleTap.touchstart(i,h,_)}touchmove(i,h,_){this.singleTap.touchmove(i,h,_)}touchend(i,h,_){const b=this.singleTap.touchend(i,h,_);if(b){const w=i.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(b)<30;if(w&&C||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Rt{constructor(){this._zoomIn=new Xs({numTouches:1,numTaps:2}),this._zoomOut=new Xs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,h,_){this._zoomIn.touchstart(i,h,_),this._zoomOut.touchstart(i,h,_)}touchmove(i,h,_){this._zoomIn.touchmove(i,h,_),this._zoomOut.touchmove(i,h,_)}touchend(i,h,_){const b=this._zoomIn.touchend(i,h,_),w=this._zoomOut.touchend(i,h,_);return b?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(b)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const vd={0:1,2:2};class Ha{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,h){return!1}_move(i,h){return{}}mousedown(i,h){if(this._lastPoint)return;const _=Ge(i);this._correctButton(i,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(i,h){const _=this._lastPoint;if(_)if(i.preventDefault(),null!=this._eventButton&&function(b,w){const C=vd[w];return void 0===b.buttons||(b.buttons&C)!==C}(i,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(i){this._lastPoint&&Ge(i)===this._eventButton&&(this._moved&&rt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class va extends Ha{mousedown(i,h){super.mousedown(i,h),this._lastPoint&&(this._active=!0)}_correctButton(i,h){return 0===h&&!i.ctrlKey}_move(i,h){return{around:h,panDelta:h.sub(i)}}}class mi extends Ha{_correctButton(i,h){return 0===h&&i.ctrlKey||2===h}_move(i,h){const _=.8*(h.x-i.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(i){i.preventDefault()}}class as extends Ha{_correctButton(i,h){return 0===h&&i.ctrlKey||2===h}_move(i,h){const _=-.5*(h.y-i.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(i){i.preventDefault()}}class Yu{constructor(i,h){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),f.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new f.pointGeometry(0,0)}touchstart(i,h,_){return this._calculateTransform(i,h,_)}touchmove(i,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,h,_)}}touchend(i,h,_){this._calculateTransform(i,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,h,_){_.length>0&&(this._active=!0);const b=zi(_,h),w=new f.pointGeometry(0,0),C=new f.pointGeometry(0,0);let S=0;for(const R in b){const L=b[R],B=this._touches[R];B&&(w._add(L),C._add(L.sub(B)),S++,b[R]=L)}if(this._touches=b,S<this._minTouches||!C.mag())return;const P=C.div(S);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(S),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Ks{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,h,_){return{}}touchstart(i,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(i,h,_){const b=this._firstTwoTouches;if(!b)return;i.preventDefault();const[w,C]=b,S=Ao(_,h,w),P=Ao(_,h,C);if(!S||!P)return;const R=this._aroundCenter?null:S.add(P).div(2);return this._move([S,P],R,i)}touchend(i,h,_){if(!this._firstTwoTouches)return;const[b,w]=this._firstTwoTouches,C=Ao(_,h,b),S=Ao(_,h,w);C&&S||(this._active&&rt(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ao(p,i,h){for(let _=0;_<p.length;_++)if(p[_].identifier===h)return i[_]}function Ju(p,i){return Math.log(p/i)/Math.LN2}class Qu extends Ks{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,h){const _=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Ju(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ju(this._distance,_),pinchAround:h}}}function eh(p,i){return 180*p.angleWith(i)/Math.PI}class ru extends Ks{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,h){const _=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:eh(this._vector,_),pinchAround:h}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const h=25/(Math.PI*this._minDiameter)*360,_=eh(i,this._startVector);return Math.abs(_)<h}}function qa(p){return Math.abs(p.y)>Math.abs(p.x)}class Sl extends Ks{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,qa(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,h,_){const b=this._lastPoints;if(!b)return;const w=i[0].sub(b[0]),C=i[1].sub(b[1]);return this._map._cooperativeGestures&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,C,_.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(w.y+C.y)/2*-.5})}gestureBeginsVertically(i,h,_){if(void 0!==this._valid)return this._valid;const b=i.mag()>=2,w=h.mag()>=2;if(!b&&!w)return;if(!b||!w)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const C=i.y>0==h.y>0;return qa(i)&&qa(h)&&C}}const th={panStep:100,bearingStep:15,pitchStep:10};class iu{constructor(){const i=th;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let h=0,_=0,b=0,w=0,C=0;switch(i.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:i.shiftKey?_=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?_=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?b=1:(i.preventDefault(),C=-1);break;case 40:i.shiftKey?b=-1:(i.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:S=>{const P=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:xd,zoom:h?Math.round(P)+h*(i.shiftKey?2:1):P,bearing:S.getBearing()+_*this._bearingStep,pitch:S.getPitch()+b*this._pitchStep,offset:[-w*this._panStep,-C*this._panStep],center:S.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xd(p){return p*(2-p)}const ou=4.000244140625;class sc{constructor(i,h){this._map=i,this._el=i.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,f.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=i.deltaMode===f.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const _=f.exported.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%ou==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(b*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),i.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=i,this._delta-=h,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Ze(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,h=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>ou?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==R&&(R=1/R);const L=h(),B=Math.pow(2,L),$="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom($*R))),"wheel"===this._type&&(this._startZoom=h(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),b=this._startZoom,w=this._easing;let C,S=!1;if("wheel"===this._type&&b&&w){const P=Math.min((f.exported.now()-this._lastWheelEventTime)/200,1),R=w(P);C=f.number(b,_,R),P<1?this._frameId||(this._frameId=!0):S=!0}else C=_,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:C-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let h=f.ease;if(this._prevEase){const _=this._prevEase,b=(f.exported.now()-_.start)/_.duration,w=_.easing(b+.01)-_.easing(b),C=.27/Math.sqrt(w*w+1e-4)*.01,S=Math.sqrt(.0729-C*C);h=f.bezier(C,S,.25,1)}return this._prevEase={start:f.exported.now(),duration:i,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(f.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!f.window.document.fullscreenElement||!!f.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class nh{constructor(i,h){this._clickZoom=i,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,h){return i.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(i.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class su{constructor(){this._tap=new Xs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,h,_){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(i,h,_))}touchmove(i,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=h[0],w=b.y-this._swipePoint.y;return this._swipePoint=b,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,h,_)}touchend(i,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(i,h,_)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ih{constructor(i,h,_){this._el=i,this._mousePan=h,this._touchPan=_}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ac{constructor(i,h,_){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bd{constructor(i,h,_,b){this._el=i,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const lc=p=>p.zoom||p.drag||p.pitch||p.rotate;class Ni extends f.Event{}class Ys{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,h){const _=f.sub([],h,i);this.radius=f.length(_[2]<0?f.div([],_,this.constants):[_[0],_[1],0])}projectRay(i){f.div(i,i,this.constants),f.normalize(i,i),f.mul$1(i,i,this.constants);const h=f.scale$2([],i,this.radius);if(h[2]>0){const _=f.scale$2([],[0,0,1],f.dot(h,[0,0,1])),b=f.scale$2([],f.normalize([],[h[0],h[1],0]),this.radius),w=f.add([],h,f.scale$2([],f.sub([],f.add([],b,_),h),2));h[0]=w[0],h[1]=w[1]}return h}}function Nr(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class wd{constructor(i,h){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ku(i),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ys,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),f.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[f.window.document,"mousemove",{capture:!0}],[f.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[f.window,"blur",void 0]];for(const[b,w,C]of this._listeners)b.addEventListener(w,b===f.window.document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[i,h,_]of this._listeners)i.removeEventListener(h,i===f.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(i){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new xi(h,i));const b=h.boxZoom=new Dl(h,i);this._add("boxZoom",b);const w=new Rt,C=new rh;h.doubleClickZoom=new nh(C,w),this._add("tapZoom",w),this._add("clickZoom",C);const S=new su;this._add("tapDragZoom",S);const P=h.touchPitch=new Sl(h);this._add("touchPitch",P);const R=new mi(i),L=new as(i);h.dragRotate=new ac(i,R,L),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const B=new va(i),$=new Yu(h,i);h.dragPan=new ih(_,B,$),this._add("mousePan",B),this._add("touchPan",$,["touchZoom","touchRotate"]);const W=new ru,q=new Qu;h.touchZoomRotate=new bd(_,q,W,S),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ks(h));const V=h.scrollZoom=new sc(h,this);this._add("scrollZoom",V,["mousePan"]);const re=h.keyboard=new iu;this._add("keyboard",re);for(const J of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[J]&&h[J].enable(i[J])}_add(i,h,_){this._handlers.push({handlerName:i,handler:h,allowed:_}),this._handlersById[i]=h}stop(i){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!lc(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,h,_){for(const b in i)if(b!==_&&(!h||h.indexOf(b)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const h=[];for(const _ of i)this._el.contains(_.target)&&h.push(_);return h}handleEvent(i,h){this._updatingCamera=!0;const _="renderFrame"===i.type,b=_?void 0:i,w={needsRenderFrame:!1},C={},S={},P=i.touches?this._getMapTouches(i.touches):void 0,R=P?De(this._el,P):_?void 0:Ze(this._el,i);for(const{handlerName:$,handler:W,allowed:q}of this._handlers){if(!W.isEnabled())continue;let V;this._blockedByActive(S,q,$)?W.reset():W[h||i.type]&&(V=W[h||i.type](i,R,P),this.mergeHandlerResult(w,C,V,$,b),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||W.isActive())&&(S[$]=W)}const L={};for(const $ in this._previousActiveHandlers)S[$]||(L[$]=b);this._previousActiveHandlers=S,(Object.keys(L).length||Nr(w))&&(this._changes.push([w,C,L]),this._triggerRenderFrame()),(Object.keys(S).length||Nr(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=w;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(i,h,_,b,w){if(!_)return;f.extend(i,_);const C={handlerName:b,originalEvent:_.originalEvent||w};void 0!==_.zoomDelta&&(h.zoom=C),void 0!==_.panDelta&&(h.drag=C),void 0!==_.pitchDelta&&(h.pitch=C),void 0!==_.bearingDelta&&(h.rotate=C)}_applyChanges(){const i={},h={},_={};for(const[b,w,C]of this._changes)b.panDelta&&(i.panDelta=(i.panDelta||new f.pointGeometry(0,0))._add(b.panDelta)),b.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(i.around=b.around),void 0!==b.aroundCoord&&(i.aroundCoord=b.aroundCoord),void 0!==b.pinchAround&&(i.pinchAround=b.pinchAround),b.noInertia&&(i.noInertia=b.noInertia),f.extend(h,w),f.extend(_,C);this._updateMapTransform(i,h,_),this._changes=[]}_updateMapTransform(i,h,_){const b=this._map,w=b.transform,C=te=>[te.x,te.y,te.z];if((te=>{const ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!Nr(i)){const te=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",te!==w.zoom&&this._map._update(!0)}if(!Nr(i))return void this._fireEvents(h,_,!0);let{panDelta:S,zoomDelta:P,bearingDelta:R,pitchDelta:L,around:B,aroundCoord:$,pinchAround:W}=i;void 0!==W&&(B=W),(te=>h.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=C(w.pointCoordinate3D(B)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",b._stop(!0),B=B||b.transform.centerPoint,R&&(w.bearing+=R),L&&(w.pitch+=L),w._updateCameraState();const q=[0,0,0];if(S){const te=w.pointCoordinate(B);if("globe"===w.projection.name){const ie=f.latFromMercatorY(te.y),le=w.center.lat,ee=Math.min(f.mercatorZfromAltitude(1,ie)/f.mercatorZfromAltitude(1,le),2);S=S.rotate(-w.angle),q[0]=-S.x/w.worldSize*ee,q[1]=-S.y/w.worldSize*ee}else{const ie=w.pointCoordinate(B.sub(S));te&&ie&&(q[0]=ie.x-te.x,q[1]=ie.y-te.y)}}const V=w.zoom,re=[0,0,0];if(P){const te=C($||w.pointCoordinate3D(B)),ie={dir:f.normalize([],f.sub([],te,w._camera.position))};if(ie.dir[2]<0){const le=w.zoomDeltaToMovement(te,P);f.scale$2(re,ie.dir,le)}}const J=f.add(q,q,re);w._translateCameraConstrained(J),P&&Math.abs(w.zoom-V)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(h,_,!0)}_fireEvents(i,h,_){const b=lc(this._eventsInProgress),w=lc(i),C={};for(const L in i){const{originalEvent:B}=i[L];this._eventsInProgress[L]||(C[`${L}start`]=B),this._eventsInProgress[L]=i[L]}!b&&w&&this._fireEvent("movestart",w.originalEvent);for(const L in C)this._fireEvent(L,C[L]);w&&this._fireEvent("move",w.originalEvent);for(const L in i){const{originalEvent:B}=i[L];this._fireEvent(L,B)}const S={};let P;for(const L in this._eventsInProgress){const{handlerName:B,originalEvent:$}=this._eventsInProgress[L];this._handlersById[B].isActive()||(delete this._eventsInProgress[L],P=h[B]||$,S[`${L}end`]=P)}for(const L in S)this._fireEvent(L,S[L]);const R=lc(this._eventsInProgress);if(_&&(b||w)&&!R){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=$=>0!==$&&-this._bearingSnap<$&&$<this._bearingSnap;L?(B(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:P})):(this._map.fire(new f.Event("moveend",{originalEvent:P})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,h){this._map.fire(new f.Event(i,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Ni("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const au="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class oh extends f.Evented{constructor(i,h){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=h.bearingSnap,f.bindAll(["_renderFrameCallback"],this)}getCenter(){return new f.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,h){return this.jumpTo({center:i},h)}panBy(i,h,_){return i=f.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,f.extend({offset:i},h),_)}panTo(i,h,_){return this.easeTo(f.extend({center:i},h),_)}getZoom(){return this.transform.zoom}setZoom(i,h){return this.jumpTo({zoom:i},h),this}zoomTo(i,h,_){return this.easeTo(f.extend({zoom:i},h),_)}zoomIn(i,h){return this.zoomTo(this.getZoom()+1,i,h),this}zoomOut(i,h){return this.zoomTo(this.getZoom()-1,i,h),this}getBearing(){return this.transform.bearing}setBearing(i,h){return this.jumpTo({bearing:i},h),this}getPadding(){return this.transform.padding}setPadding(i,h){return this.jumpTo({padding:i},h),this}rotateTo(i,h,_){return this.easeTo(f.extend({bearing:i},h),_)}resetNorth(i,h){return this.rotateTo(0,f.extend({duration:1e3},i),h),this}resetNorthPitch(i,h){return this.easeTo(f.extend({bearing:0,pitch:0,duration:1e3},i),h),this}snapToNorth(i,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,h):this}getPitch(){return this.transform.pitch}setPitch(i,h){return this.jumpTo({pitch:i},h),this}cameraForBounds(i,h){i=f.LngLatBounds.convert(i);const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),_,h)}_extendCameraOptions(i){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=f.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const _=i.padding;i.padding={top:_,bottom:_,right:_,left:_}}return i.padding=f.extend(h,i.padding),i}_cameraForBoxAndBearing(i,h,_,b){const w=this._extendCameraOptions(b),C=this.transform,S=C.padding,P=C.project(f.LngLat.convert(i)),R=C.project(f.LngLat.convert(h)),L=new f.pointGeometry(P.x,R.y),B=new f.pointGeometry(R.x,P.y),$=-f.degToRad(_),W=P.rotate($),q=R.rotate($),V=L.rotate($),re=B.rotate($),J=new f.pointGeometry(Math.max(W.x,q.x,V.x,re.x),Math.max(W.y,q.y,V.y,re.y)),te=new f.pointGeometry(Math.min(W.x,q.x,V.x,re.x),Math.min(W.y,q.y,V.y,re.y)),ie=J.sub(te),le=(C.width-((S.left||0)+(S.right||0)+w.padding.left+w.padding.right))/ie.x,ee=(C.height-((S.top||0)+(S.bottom||0)+w.padding.top+w.padding.bottom))/ie.y;if(ee<0||le<0)return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const he=Math.min(C.scaleZoom(C.scale*Math.min(le,ee)),w.maxZoom),Ae="number"==typeof w.offset.x&&"number"==typeof w.offset.y?new f.pointGeometry(w.offset.x,w.offset.y):f.pointGeometry.convert(w.offset),ze=new f.pointGeometry((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(_*Math.PI/180),$e=Ae.add(ze).mult(C.scale/C.zoomScale(he));return{center:C.unproject(P.add(R).div(2).sub($e)),zoom:he,bearing:_}}_cameraForBox(i,h,_,b,w){const C=this._extendCameraOptions(w);_=_||0,b=b||0,i=f.LngLat.convert(i),h=f.LngLat.convert(h);const S=this.transform.clone();S.padding=C.padding;const P=this.getFreeCameraOptions(),R=new f.LngLat(.5*(i.lng+h.lng),.5*(i.lat+h.lat)),L=.5*(_+b);if(S._camera.position[2]<f.mercatorZfromAltitude(L,R.lat))return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");P.lookAtPoint(R),S.setFreeCameraOptions(P);const B=f.MercatorCoordinate.fromLngLat(i),$=f.MercatorCoordinate.fromLngLat(h),W=S.pointRayIntersection(S.centerPoint,L),q=[(V=S.rayIntersectionCoordinate(W)).x,V.y,V.z];var V;const re=S.screenPointToMercatorRay(S.centerPoint),J="globe"!==S.projection.name;let te,ie=0;do{const le=Math.floor(S.zoom),ee=1<<le,he=Math.min(ee*B.x,ee*$.x),Ae=Math.min(ee*B.y,ee*$.y),ze=Math.max(ee*B.x,ee*$.x),$e=Math.max(ee*B.y,ee*$.y),je=new f.Aabb([he,Ae,_],[ze,$e,b]),mt=f.Frustum.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,le,J);if(2!==je.intersects(mt)){te&&(S._camera.position=f.scaleAndAdd([],S._camera.position,re.dir,-te),S._updateStateFromCamera());break}const Me=f.sub([],S._camera.position,q);te=.5*f.length(Me),S._camera.position=f.scaleAndAdd([],S._camera.position,re.dir,te);try{S._updateStateFromCamera()}catch(at){return void f.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ie<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(i,h,_){return this._fitInternal(this.cameraForBounds(i,h),h,_)}_raycastElevationBox(i,h){const _=this.transform.elevation;if(!_)return;const b=new f.pointGeometry(i.x,h.y),w=new f.pointGeometry(h.x,i.y),C=_.pointCoordinate(i);if(!C)return;const S=_.pointCoordinate(h);if(!S)return;const P=_.pointCoordinate(b);if(!P)return;const R=_.pointCoordinate(w);if(!R)return;const L=new f.MercatorCoordinate(C[0],C[1]).toLngLat(),B=new f.MercatorCoordinate(S[0],S[1]).toLngLat(),$=new f.MercatorCoordinate(P[0],P[1]).toLngLat(),W=new f.MercatorCoordinate(R[0],R[1]).toLngLat(),q=Math.min(L.lng,Math.min(B.lng,Math.min($.lng,W.lng))),V=Math.min(L.lat,Math.min(B.lat,Math.min($.lat,W.lat))),re=Math.max(L.lng,Math.max(B.lng,Math.max($.lng,W.lng))),J=Math.max(L.lat,Math.max(B.lat,Math.max($.lat,W.lat))),te=Math.min(C[3],Math.min(S[3],Math.min(P[3],R[3]))),ie=Math.max(C[3],Math.max(S[3],Math.max(P[3],R[3])));return{minLngLat:new f.LngLat(q,V),maxLngLat:new f.LngLat(re,J),minAltitude:te,maxAltitude:ie}}fitScreenCoordinates(i,h,_,b,w){let C,S,P,R;const L=f.pointGeometry.convert(i),B=f.pointGeometry.convert(h),$=this._raycastElevationBox(L,B);if($)C=$.minLngLat,S=$.maxLngLat,P=$.minAltitude,R=$.maxAltitude;else{if(this.transform.anyCornerOffEdge(L,B))return this;C=this.transform.pointLocation(L),S=this.transform.pointLocation(B)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(f.pointGeometry.convert(i)),this.transform.pointLocation(f.pointGeometry.convert(h)),_,b):this._cameraForBox(C,S,P,R,b),b,w)}_fitInternal(i,h,_){return i?(delete(h=f.extend(i,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(i,h){this.stop();const _=i.preloadOnly?this.transform.clone():this.transform;let b=!1,w=!1,C=!1;return"zoom"in i&&_.zoom!==+i.zoom&&(b=!0,_.zoom=+i.zoom),void 0!==i.center&&(_.center=f.LngLat.convert(i.center)),"bearing"in i&&_.bearing!==+i.bearing&&(w=!0,_.bearing=+i.bearing),"pitch"in i&&_.pitch!==+i.pitch&&(C=!0,_.pitch=+i.pitch),null==i.padding||_.isPaddingEqual(i.padding)||(_.padding=i.padding),i.preloadOnly?(this._preloadTiles(_),this):(this.fire(new f.Event("movestart",h)).fire(new f.Event("move",h)),b&&this.fire(new f.Event("zoomstart",h)).fire(new f.Event("zoom",h)).fire(new f.Event("zoomend",h)),w&&this.fire(new f.Event("rotatestart",h)).fire(new f.Event("rotate",h)).fire(new f.Event("rotateend",h)),C&&this.fire(new f.Event("pitchstart",h)).fire(new f.Event("pitch",h)).fire(new f.Event("pitchend",h)),this.fire(new f.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||f.warnOnce(au),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return f.warnOnce(au),this;this.stop();const b=_.zoom,w=_.pitch,C=_.bearing;_.setFreeCameraOptions(i);const S=b!==_.zoom,P=w!==_.pitch,R=C!==_.bearing;return this.fire(new f.Event("movestart",h)).fire(new f.Event("move",h)),S&&this.fire(new f.Event("zoomstart",h)).fire(new f.Event("zoom",h)).fire(new f.Event("zoomend",h)),R&&this.fire(new f.Event("rotatestart",h)).fire(new f.Event("rotate",h)).fire(new f.Event("rotateend",h)),P&&this.fire(new f.Event("pitchstart",h)).fire(new f.Event("pitch",h)).fire(new f.Event("pitchend",h)),this.fire(new f.Event("moveend",h)),this}easeTo(i,h){this._stop(!1,i.easeId),(!1===(i=f.extend({offset:[0,0],duration:500,easing:f.ease},i)).animate||!i.essential&&f.exported.prefersReducedMotion)&&(i.duration=0);const _=this.transform,b=this.getZoom(),w=this.getBearing(),C=this.getPitch(),S=this.getPadding(),P="zoom"in i?+i.zoom:b,R="bearing"in i?this._normalizeBearing(i.bearing,w):w,L="pitch"in i?+i.pitch:C,B="padding"in i?i.padding:_.padding,$=f.pointGeometry.convert(i.offset);let W,q,V;if("globe"===_.projection.name){const $e=f.MercatorCoordinate.fromLngLat(_.center),je=$.rotate(-_.angle);$e.x+=je.x/_.worldSize,$e.y+=je.y/_.worldSize;const mt=$e.toLngLat(),Me=f.LngLat.convert(i.center||mt);this._normalizeCenter(Me),W=_.centerPoint.add(je),q=new f.pointGeometry($e.x,$e.y).mult(_.worldSize),V=new f.pointGeometry(f.mercatorXfromLng(Me.lng),f.mercatorYfromLat(Me.lat)).mult(_.worldSize).sub(q)}else{W=_.centerPoint.add($);const $e=_.pointLocation(W),je=f.LngLat.convert(i.center||$e);this._normalizeCenter(je),q=_.project($e),V=_.project(je).sub(q)}const re=_.zoomScale(P-b);let J,te;i.around&&(J=f.LngLat.convert(i.around),te=_.locationPoint(J));const ie=this._zooming||P!==b,le=this._rotating||w!==R,ee=this._pitching||L!==C,he=!_.isPaddingEqual(B),Ae=$e=>je=>{if(ie&&($e.zoom=f.number(b,P,je)),le&&($e.bearing=f.number(w,R,je)),ee&&($e.pitch=f.number(C,L,je)),he&&($e.interpolatePadding(S,B,je),W=$e.centerPoint.add($)),J)$e.setLocationAtPoint(J,te);else{const mt=$e.zoomScale($e.zoom-b),Me=P>b?Math.min(2,re):Math.max(.5,re),at=Math.pow(Me,1-je),ut=$e.unproject(q.add(V.mult(je*at)).mult(mt));$e.setLocationAtPoint($e.renderWorldCopies?ut.wrap():ut,W)}return i.preloadOnly||this._fireMoveEvents(h),$e};if(i.preloadOnly){const $e=this._emulate(Ae,i.duration,_);return this._preloadTiles($e),this}const ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=le,this._pitching=ee,this._padding=he,this._easeId=i.easeId,this._prepareEase(h,i.noMoveStart,ze),this._ease(Ae(_),$e=>{_.recenterOnTerrain(),this._afterEase(h,$e)},i),this}_prepareEase(i,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new f.Event("movestart",i)),this._zooming&&!_.zooming&&this.fire(new f.Event("zoomstart",i)),this._rotating&&!_.rotating&&this.fire(new f.Event("rotatestart",i)),this._pitching&&!_.pitching&&this.fire(new f.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new f.Event("move",i)),this._zooming&&this.fire(new f.Event("zoom",i)),this._rotating&&this.fire(new f.Event("rotate",i)),this._pitching&&this.fire(new f.Event("pitch",i))}_afterEase(i,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,b=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new f.Event("zoomend",i)),b&&this.fire(new f.Event("rotateend",i)),w&&this.fire(new f.Event("pitchend",i)),this.fire(new f.Event("moveend",i))}flyTo(i,h){if(!i.essential&&f.exported.prefersReducedMotion){const At=f.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(At,h)}this.stop(),i=f.extend({offset:[0,0],speed:1.2,curve:1.42,easing:f.ease},i);const _=this.transform,b=this.getZoom(),w=this.getBearing(),C=this.getPitch(),S=this.getPadding(),P="zoom"in i?f.clamp(+i.zoom,_.minZoom,_.maxZoom):b,R="bearing"in i?this._normalizeBearing(i.bearing,w):w,L="pitch"in i?+i.pitch:C,B="padding"in i?i.padding:_.padding,$=_.zoomScale(P-b),W=f.pointGeometry.convert(i.offset);let q=_.centerPoint.add(W);const V=_.pointLocation(q),re=f.LngLat.convert(i.center||V);this._normalizeCenter(re);const J=_.project(V),te=_.project(re).sub(J);let ie=i.curve;const le=Math.max(_.width,_.height),ee=le/$,he=te.mag();if("minZoom"in i){const At=f.clamp(Math.min(i.minZoom,b,P),_.minZoom,_.maxZoom),Ft=le/_.zoomScale(At-b);ie=Math.sqrt(Ft/he*2)}const Ae=ie*ie;function ze(At){const Ft=(ee*ee-le*le+(At?-1:1)*Ae*Ae*he*he)/(2*(At?ee:le)*Ae*he);return Math.log(Math.sqrt(Ft*Ft+1)-Ft)}function $e(At){return(Math.exp(At)-Math.exp(-At))/2}function je(At){return(Math.exp(At)+Math.exp(-At))/2}const mt=ze(0);let Me=function(At){return je(mt)/je(mt+ie*At)},at=function(At){return le*((je(mt)*($e(Ft=mt+ie*At)/je(Ft))-$e(mt))/Ae)/he;var Ft},ut=(ze(1)-mt)/ie;if(Math.abs(he)<1e-6||!isFinite(ut)){if(Math.abs(le-ee)<1e-6)return this.easeTo(i,h);const At=ee<le?-1:1;ut=Math.abs(Math.log(ee/le))/ie,at=function(){return 0},Me=function(Ft){return Math.exp(At*ie*Ft)}}i.duration="duration"in i?+i.duration:1e3*ut/("screenSpeed"in i?+i.screenSpeed/ie:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Lt=w!==R,Ne=L!==C,jt=!_.isPaddingEqual(B),Ht=At=>Ft=>{const tn=Ft*ut,_n=1/Me(tn);At.zoom=1===Ft?P:b+At.scaleZoom(_n),Lt&&(At.bearing=f.number(w,R,Ft)),Ne&&(At.pitch=f.number(C,L,Ft)),jt&&(At.interpolatePadding(S,B,Ft),q=At.centerPoint.add(W));const qt=1===Ft?re:At.unproject(J.add(te.mult(at(tn))).mult(_n));return At.setLocationAtPoint(At.renderWorldCopies?qt.wrap():qt,q),At._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(h),At};if(i.preloadOnly){const At=this._emulate(Ht,i.duration,_);return this._preloadTiles(At),this}return this._zooming=!0,this._rotating=Lt,this._pitching=Ne,this._padding=jt,this._prepareEase(h,!1),this._ease(Ht(_),()=>this._afterEase(h),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!i){const _=this.handlers;_&&_.stop(!1)}return this}_ease(i,h,_){!1===_.animate||0===_.duration?(i(1),h()):(this._easeStart=f.exported.now(),this._easeOptions=_,this._onEaseFrame=i,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((f.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,h){i=f.wrap(i,-180,180);const _=Math.abs(i-h);return Math.abs(i-360-h)<_&&(i-=360),Math.abs(i+360-h)<_&&(i+=360),i}_normalizeCenter(i){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=i.lng-h.center.lng;i.lng+=_>180?-360:_<-180?360:0}_emulate(i,h,_){const b=Math.ceil(15*h/1e3),w=[],C=i(_.clone());for(let S=0;S<=b;S++){const P=C(S/b);w.push(P.clone())}return w}}class lu{constructor(i={}){this.options=i,f.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const h=this.options&&this.options.compact;return this._map=i,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=me("button","mapboxgl-ctrl-attrib-button",this._container),me("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=me("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,h){const _=this._map._getUIString(`AttributionControl.${h}`);i.setAttribute("aria-label",_),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||f.config.ACCESS_TOKEN}];if(i){const _=h.reduce((b,w,C)=>(w.value&&(b+=`${w.key}=${w.value}${C<h.length-1?"&":""}`),b),"?");i.href=`${f.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const h=this._map.style._sourceCaches;for(const b in h){const w=h[b];if(w.used){const C=w.getSource();C.attribution&&i.indexOf(C.attribution)<0&&i.push(C.attribution)}}i.sort((b,w)=>b.length-w.length),i=i.filter((b,w)=>{for(let C=w+1;C<i.length;C++)if(i[C].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const _=i.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,i.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ed{constructor(){f.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=me("div","mapboxgl-ctrl");const h=me("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const h in i){const _=i[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const h=i[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class Td{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const h=++this._id;return this._queue.push({callback:i,id:h,cancelled:!1}),h}remove(i){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const b of _)if(b.id===i)return void(b.cancelled=!0)}run(i=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Za(p,i,h){if(p=new f.LngLat(p.lng,p.lat),i){const _=new f.LngLat(p.lng-360,p.lat),b=new f.LngLat(p.lng+360,p.lat),w=360*Math.ceil(Math.abs(p.lng-h.center.lng)/360),C=h.locationPoint(p).distSqr(i),S=i.x<0||i.y<0||i.x>h.width||i.y>h.height;h.locationPoint(_).distSqr(i)<C&&(S||Math.abs(_.lng-h.center.lng)<w)?p=_:h.locationPoint(b).distSqr(i)<C&&(S||Math.abs(b.lng-h.center.lng)<w)&&(p=b)}for(;Math.abs(p.lng-h.center.lng)>180;){const _=h.locationPoint(p);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;p.lng>h.center.lng?p.lng-=360:p.lng+=360}return p}const Wa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Xa extends f.Evented{constructor(i,h){if(super(),(i instanceof f.window.HTMLElement||h)&&(i=f.extend({element:i},h)),f.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&"auto"!==i.pitchAlignment?i.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),i&&i.element)this._element=i.element,this._offset=f.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=me("div");const b=41,w=27,C=ae("svg",{display:"block",height:b*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${b}`},this._element),S=ae("radialGradient",{id:"shadowGradient"},ae("defs",{},C));ae("stop",{offset:"10%","stop-opacity":.4},S),ae("stop",{offset:"100%","stop-opacity":.05},S),ae("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),ae("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),ae("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),ae("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=f.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});const _=this._element.classList;for(const b in Wa)_.remove(`mapboxgl-marker-anchor-${b}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=f.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(24.6+b)],"bottom-right":[-b,-1*(24.6+b)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const h=i.code,_=i.charCode||i.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(i){const h=i.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const i=this._map;if(!i)return;const h=this._pos;if(!h||h.x<0||h.x>i.transform.width||h.y<0||h.y>i.transform.height)return void this._clearFadeTimer();const _=i.unproject(h);let b=!1;if(i.transform._terrainEnabled()&&i.getTerrain()){const C=i.getFreeCameraOptions();if(C.position){const S=C.position.toLngLat();b=S.distanceTo(_)<.9*S.distanceTo(this._lngLat)}}const w=(1-i._queryFogOpacity(_))*(b?.2:1);this._element.style.opacity=`${w}`,this._popup&&this._popup._setOpacity(`${w}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i)return;const h=this._offset.mult(this._scale),_=this._calculatePitch(),b=this._calculateRotation();this._element.style.transform=`\n            translate(${i.x}px, ${i.y}px) ${Wa[this._anchor]}\n            rotateX(${_}deg) rotateZ(${b}deg)\n            translate(${h.x}px, ${h.y}px)\n        `}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:this._map&&"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:this._map&&"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(i){f.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Za(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===i?this._updateFrameId=f.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!h.getTerrain()&&!h.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=f.pointGeometry.convert(i),this._update(),this}_onMove(i){const h=this._map;if(h){if(!this._isDragging){const _=this._clickTolerance||h._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new f.Event("dragstart"))),this.fire(new f.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new f.Event("dragend")),this._state="inactive"}_addDragHandler(i){const h=this._map;h&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos),this._pointerdownPos=i.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const h=this._map;return h&&(i?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&"auto"!==i?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class sh{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const h=f.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,h,_){this._start=this.getValue(h),this._end=i,this._startTime=h,this._endTime=h+_}}const Cd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ah={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Ho(p){p.parentNode&&p.parentNode.removeChild(p)}const Ka={showCompass:!0,showZoom:!0,visualizePitch:!1};class lh{constructor(i,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new mi({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,_&&(this.mousePitch=new as({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),f.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(i,h){this.mouseRotate.mousedown(i,h),this.mousePitch&&this.mousePitch.mousedown(i,h),Le()}move(i,h){const _=this.map,b=this.mouseRotate.mousemoveWindow(i,h),w=b&&b.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const C=this.mousePitch.mousemoveWindow(i,h),S=C&&C.pitchDelta;S&&_.setPitch(_.getPitch()+S)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){yt(),f.window.removeEventListener("mousemove",this.mousemove),f.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(f.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Ze(this.element,i)),f.window.addEventListener("mousemove",this.mousemove),f.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Ze(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=De(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=De(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const _o={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Bi,Ya=0,Ja=!1;const ch={maxWidth:100,unit:"metric"};function uh(p,i,h){const _=h&&h.maxWidth||100,b=p._containerHeight/2,w=p._containerWidth/2-_/2,C=p.unproject([w,b]),S=p.unproject([w+_,b]),P=C.distanceTo(S);if(h&&"imperial"===h.unit){const R=3.2808*P;R>5280?cc(i,_,R/5280,p._getUIString("ScaleControl.Miles"),p):cc(i,_,R,p._getUIString("ScaleControl.Feet"),p)}else h&&"nautical"===h.unit?cc(i,_,P/1852,p._getUIString("ScaleControl.NauticalMiles"),p):P>=1e3?cc(i,_,P/1e3,p._getUIString("ScaleControl.Kilometers"),p):cc(i,_,P,p._getUIString("ScaleControl.Meters"),p)}function cc(p,i,h,_,b){const w=function(S){const P=Math.pow(10,`${Math.floor(S)}`.length-1);let R=S/P;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(L){const B=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*B)/B}(R),P*R}(h),C=w/h;b._requestDomTask(()=>{p.style.width=i*C+"px",p.innerHTML=`${w}&nbsp;${_}`})}const oo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ir=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qa(p=new f.pointGeometry(0,0),i="bottom"){if("number"==typeof p){const h=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(i){case"top":return new f.pointGeometry(0,p);case"top-left":return new f.pointGeometry(h,h);case"top-right":return new f.pointGeometry(-h,h);case"bottom":return new f.pointGeometry(0,-p);case"bottom-left":return new f.pointGeometry(h,-h);case"bottom-right":return new f.pointGeometry(-h,-h);case"left":return new f.pointGeometry(p,0);case"right":return new f.pointGeometry(-p,0)}return new f.pointGeometry(0,0)}return p instanceof f.pointGeometry||Array.isArray(p)?f.pointGeometry.convert(p):f.pointGeometry.convert(p[i]||[0,0])}const Js={version:f.version,supported:Se,setRTLTextPlugin:f.setRTLTextPlugin,getRTLTextPluginStatus:f.getRTLTextPluginStatus,Map:class extends oh{constructor(p){if(null!=(p=f.extend({},ah,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&f.isSafariWithAntialiasingBug(f.window)&&(p.antialias=!1,f.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ss(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._renderTaskQueue=new Td,this._domRenderTaskQueue=new Td,this._controls=[],this._markers=[],this._mapId=f.uniqueId(),this._locale=f.extend({},Cd,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new sh(0),this._explicitProjection=null,this._requestManager=new f.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=f.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof f.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&f.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),f.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==f.window&&(f.window.addEventListener("online",this._onWindowOnline,!1),f.window.addEventListener("resize",this._onWindowResize,!1),f.window.addEventListener("orientationchange",this._onWindowResize,!1),f.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new wd(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new nu("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,f.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new lu({customAttribution:p.customAttribution})),this._logoControl=new Ed,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new f.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new f.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(p,i){if(void 0===i&&(i=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=p.onAdd(this);this._controls.push(p);const _=this._controlPositions[i];return-1!==i.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new f.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(p);return i>-1&&this._controls.splice(i,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new f.Event("movestart",p)).fire(new f.Event("move",p)),this.fire(new f.Event("resize",p)),i&&this.fire(new f.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(f.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=null==p?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=null==p?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new f.Event("zoomstart")).fire(new f.Event("zoom")).fire(new f.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=null==p?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=null==p?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new f.Event("pitchstart")).fire(new f.Event("pitch")).fire(new f.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._updateProjection(p)}_updateProjection(p){null===p&&(this._explicitProjection=null);const i=p||this.getProjection(),h=this.transform.setProjection(i);if(p&&(this._explicitProjection=this.transform.getProjection()),h){this.painter.clearBackgroundTiles();for(const _ in this.style._sourceCaches)this.style._sourceCaches[_].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(p){return this.transform.locationPoint3D(f.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(f.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,i,h){if("mouseenter"===p||"mouseover"===p){let _=!1;const b=C=>{const S=i.filter(R=>this.getLayer(R)),P=S.length?this.queryRenderedFeatures(C.point,{layers:S}):[];P.length?_||(_=!0,h.call(this,new nt(p,this,C.originalEvent,{features:P}))):_=!1},w=()=>{_=!1};return{layers:new Set(i),listener:h,delegates:{mousemove:b,mouseout:w}}}if("mouseleave"===p||"mouseout"===p){let _=!1;const b=C=>{const S=i.filter(P=>this.getLayer(P));(S.length?this.queryRenderedFeatures(C.point,{layers:S}):[]).length?_=!0:_&&(_=!1,h.call(this,new nt(p,this,C.originalEvent)))},w=C=>{_&&(_=!1,h.call(this,new nt(p,this,C.originalEvent)))};return{layers:new Set(i),listener:h,delegates:{mousemove:b,mouseout:w}}}{const _=b=>{const w=i.filter(S=>this.getLayer(S)),C=w.length?this.queryRenderedFeatures(b.point,{layers:w}):[];C.length&&(b.features=C,h.call(this,b),delete b.features)};return{layers:new Set(i),listener:h,delegates:{[p]:_}}}}on(p,i,h){if(void 0===h)return super.on(p,i);Array.isArray(i)||(i=[i]);const _=this._createDelegatedListener(p,i,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(_);for(const b in _.delegates)this.on(b,_.delegates[b]);return this}once(p,i,h){if(void 0===h)return super.once(p,i);Array.isArray(i)||(i=[i]);const _=this._createDelegatedListener(p,i,h);for(const b in _.delegates)this.once(b,_.delegates[b]);return this}off(p,i,h){if(void 0===h)return super.off(p,i);i=new Set(Array.isArray(i)?i:[i]);const _=(w,C)=>{if(w.size!==C.size)return!1;for(const S of w)if(!C.has(S))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[p]:void 0;return b&&(w=>{for(let C=0;C<w.length;C++){const S=w[C];if(S.listener===h&&_(S.layers,i)){for(const P in S.delegates)this.off(P,S.delegates[P]);return w.splice(C,1),this}}})(b),this}queryRenderedFeatures(p,i){return this.style?(void 0!==i||void 0===p||p instanceof f.pointGeometry||Array.isArray(p)||(i=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(p,i){return this.style.querySourceFeatures(p,i)}queryTerrainElevation(p,i){const h=this.transform.elevation;return h?(i=f.extend({},{exaggerated:!0},i),h.getAtPoint(f.MercatorCoordinate.fromLngLat(p),null,i.exaggerated)):null}setStyle(p,i){return!1!==(i=f.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(p,i))}_getUIString(p){const i=this._locale[p];if(null==i)throw new Error(`Missing UI string '${p}'`);return i}_updateStyle(p,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new fr(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new fr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,i){if("string"==typeof p){const h=this._requestManager.normalizeStyleURL(p),_=this._requestManager.transformRequest(h,f.ResourceType.Style);f.getJSON(_,(b,w)=>{b?this.fire(new f.ErrorEvent(b)):w&&this._updateDiff(w,i)})}else"object"==typeof p&&this._updateDiff(p,i)}_updateDiff(p,i){try{this.style.setState(p)&&this._update(!0)}catch(h){f.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(p,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(f.warnOnce("There is no style added to the map."),!1)}addSource(p,i){return this._lazyInitEmptyStyle(),this.style.addSource(p,i),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const i in p){const h=p[i]._tiles;for(const _ in h){const b=h[_];if("loaded"!==b.state&&"errored"!==b.state)return!1}}return!0}addSourceType(p,i,h){this._lazyInitEmptyStyle(),this.style.addSourceType(p,i,h)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,i,{pixelRatio:h=1,sdf:_=!1,stretchX:b,stretchY:w,content:C}={}){if(this._lazyInitEmptyStyle(),i instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&i instanceof f.window.ImageBitmap){const{width:S,height:P,data:R}=f.exported.getImageData(i);this.style.addImage(p,{data:new f.RGBAImage({width:S,height:P},R),pixelRatio:h,stretchX:b,stretchY:w,content:C,sdf:_,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:P}=i,R=i;this.style.addImage(p,{data:new f.RGBAImage({width:S,height:P},new Uint8Array(R.data)),pixelRatio:h,stretchX:b,stretchY:w,content:C,sdf:_,version:0,userImage:R}),R.onAdd&&R.onAdd(this,p)}}updateImage(p,i){const h=this.style.getImage(p);if(!h)return void this.fire(new f.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=i instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&i instanceof f.window.ImageBitmap?f.exported.getImageData(i):i,{width:b,height:w}=_;void 0!==b&&void 0!==w?b===h.data.width&&w===h.data.height?(h.data.replace(_.data,!(i instanceof f.window.HTMLImageElement||f.window.ImageBitmap&&i instanceof f.window.ImageBitmap)),this.style.updateImage(p,h)):this.fire(new f.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new f.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new f.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,i){f.getImage(this._requestManager.transformRequest(p,f.ResourceType.Image),(h,_)=>{i(h,_ instanceof f.window.HTMLImageElement?f.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(p,i){return this._lazyInitEmptyStyle(),this.style.addLayer(p,i),this._update(!0)}moveLayer(p,i){return this.style.moveLayer(p,i),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,i,h){return this.style.setLayerZoomRange(p,i,h),this._update(!0)}setFilter(p,i,h={}){return this.style.setFilter(p,i,h),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,i,h,_={}){return this.style.setPaintProperty(p,i,h,_),this._update(!0)}getPaintProperty(p,i){return this.style.getPaintProperty(p,i)}setLayoutProperty(p,i,h,_={}){return this.style.setLayoutProperty(p,i,h,_),this._update(!0)}getLayoutProperty(p,i){return this.style.getLayoutProperty(p,i)}setLight(p,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(f.LngLat.convert(p),this.transform):0}setFeatureState(p,i){return this.style.setFeatureState(p,i),this._update()}removeFeatureState(p,i){return this.style.removeFeatureState(p,i),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let h,_,b,w=this._container;for(;w&&(!_||!b);){const C=f.window.getComputedStyle(w).transform;C&&"none"!==C&&(h=C.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(b=h[3])),w=w.parentElement}this._containerWidth=_?Math.abs(p/_):p,this._containerHeight=b?Math.abs(i/b):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==f.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&f.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=me("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=me("div","mapboxgl-canvas-container",p);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=me("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=me("div","mapboxgl-control-container",p),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=me("div",`mapboxgl-ctrl-${b}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,i){const h=f.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(p),this._canvas.height=h*Math.ceil(i),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${i}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const i=this._markers.indexOf(p);-1!==i&&this._markers.splice(i,1)}_setupPainter(){const p=f.extend({},Se.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);i?(f.storeAuthState(i,!0),this.painter=new fd(i,this.transform),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),f.exported$1.testSupport(i)):this.fire(new f.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new f.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new f.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let i;const h=this.painter.context.extTimerQuery,_=f.exported.now();if(this.listens("gpu-timing-frame")&&(i=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;let b=!1;const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,R=this.transform.pitch,L=f.exported.now();this.style.zoomHistory.update(P,L);const B=new f.EvaluationParameters(P,{now:L,fadeDuration:w,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),$=B.crossFadingFactor();1===$&&$===this._crossFadingFactor||(b=!0,this._crossFadingFactor=$),this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerUpdate()):C=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new f.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new f.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=f.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,i),setTimeout(()=>{const R=h.getQueryObjectEXT(i,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(i),this.fire(new f.Event("gpu-timing-frame",{cpuTime:P,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(P);this.fire(new f.Event("gpu-timing-layer",{layerTimes:R}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(S||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(C=this._updateAverageElevation(_,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new f.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new f.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,i=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((i||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const _=this.transform.averageElevation;let b=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=p;const C=Math.abs(_-b);if(C>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(b),h(b);this._averageElevation.easeTo(b,p,300)}else if(C>1e-4)return this._averageElevation.jumpTo(b),h(b)}return!!this._averageElevation.isEasing(p)&&h(this._averageElevation.getValue(p))}_authenticate(){f.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===f.AUTH_ERR_MSG||401===p.status)){const i=this.painter.context.gl;f.storeAuthState(i,!1),this._logoControl instanceof Ed&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new f.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),f.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function b(w){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,w,0);const C=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,C),C}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(b(p),i.canvasCopies.map(b),i.timeStamps)}_canvasPixelComparison(p,i,h){let _=h[1]-h[0];const b=p.length/4;for(let w=0;w<i.length;w++){const C=i[w];let S=0;for(let P=0;P<C.length;P+=4)C[P]===p[P]&&C[P+1]===p[P+1]&&C[P+2]===p[P+2]&&C[P+3]===p[P+3]&&(S+=1);_+=(h[w+2]-h[w+1])*(1-S/b)}return _}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==f.window&&(f.window.removeEventListener("resize",this._onWindowResize,!1),f.window.removeEventListener("orientationchange",this._onWindowResize,!1),f.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),f.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),Ho(this._canvasContainer),Ho(this._controlContainer),Ho(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),f.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new f.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=f.exported.frame(i=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(i)}))}_preloadTiles(p){const i=this.style?Object.values(this.style._sourceCaches):[];return f.asyncAll(i,(h,_)=>h._preloadTiles(p,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,i){f.setCacheLimits(p,i)}get version(){return f.version}},NavigationControl:class{constructor(p){this.options=f.extend({},Ka,p),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(f.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),me("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),me("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(f.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:i}):h.resetNorth({},{originalEvent:i}))}),this._compassIcon=me("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const i=p.getZoom(),h=i===p.getMaxZoom(),_=i===p.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lh(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,i){const h=me("button",p,this._container);return h.type="button",h.addEventListener("click",i),h}_setButtonTitle(p,i){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${i}`);p.setAttribute("aria-label",h),p.firstElementChild&&p.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends f.Evented{constructor(p){super(),this.options=f.extend({},_o,p),f.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=tu(this._updateMarkerRotation,20)}onAdd(p){var i;return this._map=p,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==Bi?i(Bi):void 0!==f.window.navigator.permissions?f.window.navigator.permissions.query({name:"geolocation"}).then(h=>{Bi="denied"!==h.state,i(Bi)}):(Bi=!!f.window.navigator.geolocation,i(Bi)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(f.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Ya=0,Ja=!1}_isOutOfMapMaxBounds(p){const i=this._map.getMaxBounds(),h=p.coords;return!!i&&(h.longitude<i.getWest()||h.longitude>i.getEast()||h.latitude<i.getSouth()||h.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new f.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("geolocate",p)),this._finish()}}_updateCamera(p){const i=new f.LngLat(p.coords.longitude,p.coords.latitude),h=p.coords.accuracy,_=this._map.getBearing(),b=f.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(h),b,{geolocateSource:!0})}_updateMarker(p){if(p){const i=new f.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._containerHeight/2,i=this._map.unproject([0,p]),h=this._map.unproject([100,p]),_=i.distanceTo(h)/100,b=Math.ceil(2*this._accuracy/_);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&Ja)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new f.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=me("button","mapboxgl-ctrl-geolocate",this._container),me("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){f.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me("div","mapboxgl-user-location"),this._dotElement.appendChild(me("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(me("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xa({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=me("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new f.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return f.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ya--,Ja=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new f.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ya++,Ya>1?(p={maximumAge:6e5,timeout:0},Ja=!0):(p=this.options.positionOptions,Ja=!1),this._geolocationWatchID=f.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else f.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{f.window.addEventListener("ondeviceorientationabsolute"in f.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==f.window.DeviceMotionEvent&&"function"==typeof f.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&p()}).catch(console.error):p()}_clearWatch(){f.window.navigator.geolocation.clearWatch(this._geolocationWatchID),f.window.removeEventListener("deviceorientation",this._onDeviceOrientation),f.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:lu,ScaleControl:class{constructor(p){this.options=f.extend({},ch,p),f.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){uh(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,uh(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof f.window.HTMLElement?this._container=p.container:f.warnOnce("Full screen control 'container' must be a DOM element.")),f.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in f.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in f.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",f.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,f.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!f.window.document.fullscreenEnabled&&!f.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=me("button","mapboxgl-ctrl-fullscreen",this._controlContainer);me("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),f.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(f.window.document.fullscreenElement||f.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?f.window.document.exitFullscreen?f.window.document.exitFullscreen():f.window.document.webkitCancelFullScreen&&f.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends f.Evented{constructor(p){super(),this.options=f.extend(Object.create(oo),p),f.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new f.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new f.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=f.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(f.window.document.createTextNode(p))}setHTML(p){const i=f.window.document.createDocumentFragment(),h=f.window.document.createElement("body");let _;for(h.innerHTML=p;_=h.firstChild,_;)i.appendChild(_);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=me("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(p),this.options.closeButton){const h=this._closeButton=me("button","mapboxgl-popup-close-button",i);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let i;return this._classList.delete(p)?i=!1:(this._classList.add(p),i=!0),this._updateClassList(),i}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const i=this._map,h=this._container,_=this._pos;if(!i||!h||!_)return"bottom";const b=h.offsetWidth,w=h.offsetHeight,C=_.x<b/2,S=_.x>i.transform.width-b/2;if(_.y+p<w)return C?"top-left":S?"top-right":"top";if(_.y>i.transform.height-w){if(C)return"bottom-left";if(S)return"bottom-right"}return C?"left":S?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),p.className=i.join(" ")}_update(p){const i=this._map,h=this._content;if(!i||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=me("div","mapboxgl-popup",i.getContainer()),this._tip=me("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Za(this._lngLat,this._pos,i.transform)),!this._trackPointer||p){const b=this._pos=this._trackPointer&&p?p:i.project(this._lngLat),w=Qa(this.options.offset),C=this._anchor=this._getAnchor(w.y),S=Qa(this.options.offset,C),P=b.add(S).round();i._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${Wa[C]} translate(${P.x}px,${P.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Ir);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._content&&(this._content.style.opacity=p),this._tip&&(this._tip.style.opacity=p)}},Marker:Xa,Style:fr,LngLat:f.LngLat,LngLatBounds:f.LngLatBounds,Point:f.pointGeometry,MercatorCoordinate:f.MercatorCoordinate,FreeCameraOptions:Zi,Evented:f.Evented,config:f.config,prewarm:function(){Xt().acquire(Yt)},clearPrewarmedResources:function(){const p=Ut;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(Yt),Ut=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return f.config.ACCESS_TOKEN},set accessToken(p){f.config.ACCESS_TOKEN=p},get baseApiUrl(){return f.config.API_URL},set baseApiUrl(p){f.config.API_URL=p},get workerCount(){return Bt.workerCount},set workerCount(p){Bt.workerCount=p},get maxParallelImageRequests(){return f.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){f.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){f.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:f.exported.setNow,restoreNow:f.exported.restoreNow};return Js}),pa}()},147:Xl=>{"use strict";Xl.exports={i8:"0.0.7"}}},Xl=>{Xl(Xl.s=167)}]);